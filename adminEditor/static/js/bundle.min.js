(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):(global=typeof globalThis!=='undefined'?globalThis:global||self,global.bootstrap=factory());})(this,(function(){'use strict';const MAX_UID=1000000;const MILLISECONDS_MULTIPLIER=1000;const TRANSITION_END='transitionend';const toType=object=>{if(object===null||object===undefined){return`${object}`;}
return Object.prototype.toString.call(object).match(/\s([a-z]+)/i)[1].toLowerCase();};const getUID=prefix=>{do{prefix+=Math.floor(Math.random()*MAX_UID);}while(document.getElementById(prefix));return prefix;};const getSelector=element=>{let selector=element.getAttribute('data-bs-target');if(!selector||selector==='#'){let hrefAttribute=element.getAttribute('href');if(!hrefAttribute||!hrefAttribute.includes('#')&&!hrefAttribute.startsWith('.')){return null;}
if(hrefAttribute.includes('#')&&!hrefAttribute.startsWith('#')){hrefAttribute=`#${hrefAttribute.split('#')[1]}`;}
selector=hrefAttribute&&hrefAttribute!=='#'?hrefAttribute.trim():null;}
return selector;};const getSelectorFromElement=element=>{const selector=getSelector(element);if(selector){return document.querySelector(selector)?selector:null;}
return null;};const getElementFromSelector=element=>{const selector=getSelector(element);return selector?document.querySelector(selector):null;};const getTransitionDurationFromElement=element=>{if(!element){return 0;}
let{transitionDuration,transitionDelay}=window.getComputedStyle(element);const floatTransitionDuration=Number.parseFloat(transitionDuration);const floatTransitionDelay=Number.parseFloat(transitionDelay);if(!floatTransitionDuration&&!floatTransitionDelay){return 0;}
transitionDuration=transitionDuration.split(',')[0];transitionDelay=transitionDelay.split(',')[0];return(Number.parseFloat(transitionDuration)+Number.parseFloat(transitionDelay))*MILLISECONDS_MULTIPLIER;};const triggerTransitionEnd=element=>{element.dispatchEvent(new Event(TRANSITION_END));};const isElement$1=object=>{if(!object||typeof object!=='object'){return false;}
if(typeof object.jquery!=='undefined'){object=object[0];}
return typeof object.nodeType!=='undefined';};const getElement=object=>{if(isElement$1(object)){return object.jquery?object[0]:object;}
if(typeof object==='string'&&object.length>0){return document.querySelector(object);}
return null;};const isVisible=element=>{if(!isElement$1(element)||element.getClientRects().length===0){return false;}
const elementIsVisible=getComputedStyle(element).getPropertyValue('visibility')==='visible';const closedDetails=element.closest('details:not([open])');if(!closedDetails){return elementIsVisible;}
if(closedDetails!==element){const summary=element.closest('summary');if(summary&&summary.parentNode!==closedDetails){return false;}
if(summary===null){return false;}}
return elementIsVisible;};const isDisabled=element=>{if(!element||element.nodeType!==Node.ELEMENT_NODE){return true;}
if(element.classList.contains('disabled')){return true;}
if(typeof element.disabled!=='undefined'){return element.disabled;}
return element.hasAttribute('disabled')&&element.getAttribute('disabled')!=='false';};const findShadowRoot=element=>{if(!document.documentElement.attachShadow){return null;}
if(typeof element.getRootNode==='function'){const root=element.getRootNode();return root instanceof ShadowRoot?root:null;}
if(element instanceof ShadowRoot){return element;}
if(!element.parentNode){return null;}
return findShadowRoot(element.parentNode);};const noop=()=>{};const reflow=element=>{element.offsetHeight;};const getjQuery=()=>{if(window.jQuery&&!document.body.hasAttribute('data-bs-no-jquery')){return window.jQuery;}
return null;};const DOMContentLoadedCallbacks=[];const onDOMContentLoaded=callback=>{if(document.readyState==='loading'){if(!DOMContentLoadedCallbacks.length){document.addEventListener('DOMContentLoaded',()=>{for(const callback of DOMContentLoadedCallbacks){callback();}});}
DOMContentLoadedCallbacks.push(callback);}else{callback();}};const isRTL=()=>document.documentElement.dir==='rtl';const defineJQueryPlugin=plugin=>{onDOMContentLoaded(()=>{const $=getjQuery();if($){const name=plugin.NAME;const JQUERY_NO_CONFLICT=$.fn[name];$.fn[name]=plugin.jQueryInterface;$.fn[name].Constructor=plugin;$.fn[name].noConflict=()=>{$.fn[name]=JQUERY_NO_CONFLICT;return plugin.jQueryInterface;};}});};const execute=callback=>{if(typeof callback==='function'){callback();}};const executeAfterTransition=(callback,transitionElement,waitForTransition=true)=>{if(!waitForTransition){execute(callback);return;}
const durationPadding=5;const emulatedDuration=getTransitionDurationFromElement(transitionElement)+durationPadding;let called=false;const handler=({target})=>{if(target!==transitionElement){return;}
called=true;transitionElement.removeEventListener(TRANSITION_END,handler);execute(callback);};transitionElement.addEventListener(TRANSITION_END,handler);setTimeout(()=>{if(!called){triggerTransitionEnd(transitionElement);}},emulatedDuration);};const getNextActiveElement=(list,activeElement,shouldGetNext,isCycleAllowed)=>{const listLength=list.length;let index=list.indexOf(activeElement);if(index===-1){return!shouldGetNext&&isCycleAllowed?list[listLength-1]:list[0];}
index+=shouldGetNext?1:-1;if(isCycleAllowed){index=(index+listLength)%listLength;}
return list[Math.max(0,Math.min(index,listLength-1))];};const namespaceRegex=/[^.]*(?=\..*)\.|.*/;const stripNameRegex=/\..*/;const stripUidRegex=/::\d+$/;const eventRegistry={};let uidEvent=1;const customEvents={mouseenter:'mouseover',mouseleave:'mouseout'};const nativeEvents=new Set(['click','dblclick','mouseup','mousedown','contextmenu','mousewheel','DOMMouseScroll','mouseover','mouseout','mousemove','selectstart','selectend','keydown','keypress','keyup','orientationchange','touchstart','touchmove','touchend','touchcancel','pointerdown','pointermove','pointerup','pointerleave','pointercancel','gesturestart','gesturechange','gestureend','focus','blur','change','reset','select','submit','focusin','focusout','load','unload','beforeunload','resize','move','DOMContentLoaded','readystatechange','error','abort','scroll']);function makeEventUid(element,uid){return uid&&`${uid}::${uidEvent++}`||element.uidEvent||uidEvent++;}
function getElementEvents(element){const uid=makeEventUid(element);element.uidEvent=uid;eventRegistry[uid]=eventRegistry[uid]||{};return eventRegistry[uid];}
function bootstrapHandler(element,fn){return function handler(event){hydrateObj(event,{delegateTarget:element});if(handler.oneOff){EventHandler.off(element,event.type,fn);}
return fn.apply(element,[event]);};}
function bootstrapDelegationHandler(element,selector,fn){return function handler(event){const domElements=element.querySelectorAll(selector);for(let{target}=event;target&&target!==this;target=target.parentNode){for(const domElement of domElements){if(domElement!==target){continue;}
hydrateObj(event,{delegateTarget:target});if(handler.oneOff){EventHandler.off(element,event.type,selector,fn);}
return fn.apply(target,[event]);}}};}
function findHandler(events,callable,delegationSelector=null){return Object.values(events).find(event=>event.callable===callable&&event.delegationSelector===delegationSelector);}
function normalizeParameters(originalTypeEvent,handler,delegationFunction){const isDelegated=typeof handler==='string';const callable=isDelegated?delegationFunction:handler||delegationFunction;let typeEvent=getTypeEvent(originalTypeEvent);if(!nativeEvents.has(typeEvent)){typeEvent=originalTypeEvent;}
return[isDelegated,callable,typeEvent];}
function addHandler(element,originalTypeEvent,handler,delegationFunction,oneOff){if(typeof originalTypeEvent!=='string'||!element){return;}
let[isDelegated,callable,typeEvent]=normalizeParameters(originalTypeEvent,handler,delegationFunction);if(originalTypeEvent in customEvents){const wrapFunction=fn=>{return function(event){if(!event.relatedTarget||event.relatedTarget!==event.delegateTarget&&!event.delegateTarget.contains(event.relatedTarget)){return fn.call(this,event);}};};callable=wrapFunction(callable);}
const events=getElementEvents(element);const handlers=events[typeEvent]||(events[typeEvent]={});const previousFunction=findHandler(handlers,callable,isDelegated?handler:null);if(previousFunction){previousFunction.oneOff=previousFunction.oneOff&&oneOff;return;}
const uid=makeEventUid(callable,originalTypeEvent.replace(namespaceRegex,''));const fn=isDelegated?bootstrapDelegationHandler(element,handler,callable):bootstrapHandler(element,callable);fn.delegationSelector=isDelegated?handler:null;fn.callable=callable;fn.oneOff=oneOff;fn.uidEvent=uid;handlers[uid]=fn;element.addEventListener(typeEvent,fn,isDelegated);}
function removeHandler(element,events,typeEvent,handler,delegationSelector){const fn=findHandler(events[typeEvent],handler,delegationSelector);if(!fn){return;}
element.removeEventListener(typeEvent,fn,Boolean(delegationSelector));delete events[typeEvent][fn.uidEvent];}
function removeNamespacedHandlers(element,events,typeEvent,namespace){const storeElementEvent=events[typeEvent]||{};for(const handlerKey of Object.keys(storeElementEvent)){if(handlerKey.includes(namespace)){const event=storeElementEvent[handlerKey];removeHandler(element,events,typeEvent,event.callable,event.delegationSelector);}}}
function getTypeEvent(event){event=event.replace(stripNameRegex,'');return customEvents[event]||event;}
const EventHandler={on(element,event,handler,delegationFunction){addHandler(element,event,handler,delegationFunction,false);},one(element,event,handler,delegationFunction){addHandler(element,event,handler,delegationFunction,true);},off(element,originalTypeEvent,handler,delegationFunction){if(typeof originalTypeEvent!=='string'||!element){return;}
const[isDelegated,callable,typeEvent]=normalizeParameters(originalTypeEvent,handler,delegationFunction);const inNamespace=typeEvent!==originalTypeEvent;const events=getElementEvents(element);const storeElementEvent=events[typeEvent]||{};const isNamespace=originalTypeEvent.startsWith('.');if(typeof callable!=='undefined'){if(!Object.keys(storeElementEvent).length){return;}
removeHandler(element,events,typeEvent,callable,isDelegated?handler:null);return;}
if(isNamespace){for(const elementEvent of Object.keys(events)){removeNamespacedHandlers(element,events,elementEvent,originalTypeEvent.slice(1));}}
for(const keyHandlers of Object.keys(storeElementEvent)){const handlerKey=keyHandlers.replace(stripUidRegex,'');if(!inNamespace||originalTypeEvent.includes(handlerKey)){const event=storeElementEvent[keyHandlers];removeHandler(element,events,typeEvent,event.callable,event.delegationSelector);}}},trigger(element,event,args){if(typeof event!=='string'||!element){return null;}
const $=getjQuery();const typeEvent=getTypeEvent(event);const inNamespace=event!==typeEvent;let jQueryEvent=null;let bubbles=true;let nativeDispatch=true;let defaultPrevented=false;if(inNamespace&&$){jQueryEvent=$.Event(event,args);$(element).trigger(jQueryEvent);bubbles=!jQueryEvent.isPropagationStopped();nativeDispatch=!jQueryEvent.isImmediatePropagationStopped();defaultPrevented=jQueryEvent.isDefaultPrevented();}
let evt=new Event(event,{bubbles,cancelable:true});evt=hydrateObj(evt,args);if(defaultPrevented){evt.preventDefault();}
if(nativeDispatch){element.dispatchEvent(evt);}
if(evt.defaultPrevented&&jQueryEvent){jQueryEvent.preventDefault();}
return evt;}};function hydrateObj(obj,meta){for(const[key,value]of Object.entries(meta||{})){try{obj[key]=value;}catch(_unused){Object.defineProperty(obj,key,{configurable:true,get(){return value;}});}}
return obj;}
const elementMap=new Map();const Data={set(element,key,instance){if(!elementMap.has(element)){elementMap.set(element,new Map());}
const instanceMap=elementMap.get(element);if(!instanceMap.has(key)&&instanceMap.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(instanceMap.keys())[0]}.`);return;}
instanceMap.set(key,instance);},get(element,key){if(elementMap.has(element)){return elementMap.get(element).get(key)||null;}
return null;},remove(element,key){if(!elementMap.has(element)){return;}
const instanceMap=elementMap.get(element);instanceMap.delete(key);if(instanceMap.size===0){elementMap.delete(element);}}};function normalizeData(value){if(value==='true'){return true;}
if(value==='false'){return false;}
if(value===Number(value).toString()){return Number(value);}
if(value===''||value==='null'){return null;}
if(typeof value!=='string'){return value;}
try{return JSON.parse(decodeURIComponent(value));}catch(_unused){return value;}}
function normalizeDataKey(key){return key.replace(/[A-Z]/g,chr=>`-${chr.toLowerCase()}`);}
const Manipulator={setDataAttribute(element,key,value){element.setAttribute(`data-bs-${normalizeDataKey(key)}`,value);},removeDataAttribute(element,key){element.removeAttribute(`data-bs-${normalizeDataKey(key)}`);},getDataAttributes(element){if(!element){return{};}
const attributes={};const bsKeys=Object.keys(element.dataset).filter(key=>key.startsWith('bs')&&!key.startsWith('bsConfig'));for(const key of bsKeys){let pureKey=key.replace(/^bs/,'');pureKey=pureKey.charAt(0).toLowerCase()+pureKey.slice(1,pureKey.length);attributes[pureKey]=normalizeData(element.dataset[key]);}
return attributes;},getDataAttribute(element,key){return normalizeData(element.getAttribute(`data-bs-${normalizeDataKey(key)}`));}};class Config{static get Default(){return{};}
static get DefaultType(){return{};}
static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!');}
_getConfig(config){config=this._mergeConfigObj(config);config=this._configAfterMerge(config);this._typeCheckConfig(config);return config;}
_configAfterMerge(config){return config;}
_mergeConfigObj(config,element){const jsonConfig=isElement$1(element)?Manipulator.getDataAttribute(element,'config'):{};return{...this.constructor.Default,...(typeof jsonConfig==='object'?jsonConfig:{}),...(isElement$1(element)?Manipulator.getDataAttributes(element):{}),...(typeof config==='object'?config:{})};}
_typeCheckConfig(config,configTypes=this.constructor.DefaultType){for(const property of Object.keys(configTypes)){const expectedTypes=configTypes[property];const value=config[property];const valueType=isElement$1(value)?'element':toType(value);if(!new RegExp(expectedTypes).test(valueType)){throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${property}" provided type "${valueType}" but expected type "${expectedTypes}".`);}}}}
const VERSION='5.2.3';class BaseComponent extends Config{constructor(element,config){super();element=getElement(element);if(!element){return;}
this._element=element;this._config=this._getConfig(config);Data.set(this._element,this.constructor.DATA_KEY,this);}
dispose(){Data.remove(this._element,this.constructor.DATA_KEY);EventHandler.off(this._element,this.constructor.EVENT_KEY);for(const propertyName of Object.getOwnPropertyNames(this)){this[propertyName]=null;}}
_queueCallback(callback,element,isAnimated=true){executeAfterTransition(callback,element,isAnimated);}
_getConfig(config){config=this._mergeConfigObj(config,this._element);config=this._configAfterMerge(config);this._typeCheckConfig(config);return config;}
static getInstance(element){return Data.get(getElement(element),this.DATA_KEY);}
static getOrCreateInstance(element,config={}){return this.getInstance(element)||new this(element,typeof config==='object'?config:null);}
static get VERSION(){return VERSION;}
static get DATA_KEY(){return`bs.${this.NAME}`;}
static get EVENT_KEY(){return`.${this.DATA_KEY}`;}
static eventName(name){return`${name}${this.EVENT_KEY}`;}}
const enableDismissTrigger=(component,method='hide')=>{const clickEvent=`click.dismiss${component.EVENT_KEY}`;const name=component.NAME;EventHandler.on(document,clickEvent,`[data-bs-dismiss="${name}"]`,function(event){if(['A','AREA'].includes(this.tagName)){event.preventDefault();}
if(isDisabled(this)){return;}
const target=getElementFromSelector(this)||this.closest(`.${name}`);const instance=component.getOrCreateInstance(target);instance[method]();});};const NAME$f='alert';const DATA_KEY$a='bs.alert';const EVENT_KEY$b=`.${DATA_KEY$a}`;const EVENT_CLOSE=`close${EVENT_KEY$b}`;const EVENT_CLOSED=`closed${EVENT_KEY$b}`;const CLASS_NAME_FADE$5='fade';const CLASS_NAME_SHOW$8='show';class Alert extends BaseComponent{static get NAME(){return NAME$f;}
close(){const closeEvent=EventHandler.trigger(this._element,EVENT_CLOSE);if(closeEvent.defaultPrevented){return;}
this._element.classList.remove(CLASS_NAME_SHOW$8);const isAnimated=this._element.classList.contains(CLASS_NAME_FADE$5);this._queueCallback(()=>this._destroyElement(),this._element,isAnimated);}
_destroyElement(){this._element.remove();EventHandler.trigger(this._element,EVENT_CLOSED);this.dispose();}
static jQueryInterface(config){return this.each(function(){const data=Alert.getOrCreateInstance(this);if(typeof config!=='string'){return;}
if(data[config]===undefined||config.startsWith('_')||config==='constructor'){throw new TypeError(`No method named "${config}"`);}
data[config](this);});}}
enableDismissTrigger(Alert,'close');defineJQueryPlugin(Alert);const NAME$e='button';const DATA_KEY$9='bs.button';const EVENT_KEY$a=`.${DATA_KEY$9}`;const DATA_API_KEY$6='.data-api';const CLASS_NAME_ACTIVE$3='active';const SELECTOR_DATA_TOGGLE$5='[data-bs-toggle="button"]';const EVENT_CLICK_DATA_API$6=`click${EVENT_KEY$a}${DATA_API_KEY$6}`;class Button extends BaseComponent{static get NAME(){return NAME$e;}
toggle(){this._element.setAttribute('aria-pressed',this._element.classList.toggle(CLASS_NAME_ACTIVE$3));}
static jQueryInterface(config){return this.each(function(){const data=Button.getOrCreateInstance(this);if(config==='toggle'){data[config]();}});}}
EventHandler.on(document,EVENT_CLICK_DATA_API$6,SELECTOR_DATA_TOGGLE$5,event=>{event.preventDefault();const button=event.target.closest(SELECTOR_DATA_TOGGLE$5);const data=Button.getOrCreateInstance(button);data.toggle();});defineJQueryPlugin(Button);const SelectorEngine={find(selector,element=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(element,selector));},findOne(selector,element=document.documentElement){return Element.prototype.querySelector.call(element,selector);},children(element,selector){return[].concat(...element.children).filter(child=>child.matches(selector));},parents(element,selector){const parents=[];let ancestor=element.parentNode.closest(selector);while(ancestor){parents.push(ancestor);ancestor=ancestor.parentNode.closest(selector);}
return parents;},prev(element,selector){let previous=element.previousElementSibling;while(previous){if(previous.matches(selector)){return[previous];}
previous=previous.previousElementSibling;}
return[];},next(element,selector){let next=element.nextElementSibling;while(next){if(next.matches(selector)){return[next];}
next=next.nextElementSibling;}
return[];},focusableChildren(element){const focusables=['a','button','input','textarea','select','details','[tabindex]','[contenteditable="true"]'].map(selector=>`${selector}:not([tabindex^="-"])`).join(',');return this.find(focusables,element).filter(el=>!isDisabled(el)&&isVisible(el));}};const NAME$d='swipe';const EVENT_KEY$9='.bs.swipe';const EVENT_TOUCHSTART=`touchstart${EVENT_KEY$9}`;const EVENT_TOUCHMOVE=`touchmove${EVENT_KEY$9}`;const EVENT_TOUCHEND=`touchend${EVENT_KEY$9}`;const EVENT_POINTERDOWN=`pointerdown${EVENT_KEY$9}`;const EVENT_POINTERUP=`pointerup${EVENT_KEY$9}`;const POINTER_TYPE_TOUCH='touch';const POINTER_TYPE_PEN='pen';const CLASS_NAME_POINTER_EVENT='pointer-event';const SWIPE_THRESHOLD=40;const Default$c={endCallback:null,leftCallback:null,rightCallback:null};const DefaultType$c={endCallback:'(function|null)',leftCallback:'(function|null)',rightCallback:'(function|null)'};class Swipe extends Config{constructor(element,config){super();this._element=element;if(!element||!Swipe.isSupported()){return;}
this._config=this._getConfig(config);this._deltaX=0;this._supportPointerEvents=Boolean(window.PointerEvent);this._initEvents();}
static get Default(){return Default$c;}
static get DefaultType(){return DefaultType$c;}
static get NAME(){return NAME$d;}
dispose(){EventHandler.off(this._element,EVENT_KEY$9);}
_start(event){if(!this._supportPointerEvents){this._deltaX=event.touches[0].clientX;return;}
if(this._eventIsPointerPenTouch(event)){this._deltaX=event.clientX;}}
_end(event){if(this._eventIsPointerPenTouch(event)){this._deltaX=event.clientX-this._deltaX;}
this._handleSwipe();execute(this._config.endCallback);}
_move(event){this._deltaX=event.touches&&event.touches.length>1?0:event.touches[0].clientX-this._deltaX;}
_handleSwipe(){const absDeltaX=Math.abs(this._deltaX);if(absDeltaX<=SWIPE_THRESHOLD){return;}
const direction=absDeltaX/this._deltaX;this._deltaX=0;if(!direction){return;}
execute(direction>0?this._config.rightCallback:this._config.leftCallback);}
_initEvents(){if(this._supportPointerEvents){EventHandler.on(this._element,EVENT_POINTERDOWN,event=>this._start(event));EventHandler.on(this._element,EVENT_POINTERUP,event=>this._end(event));this._element.classList.add(CLASS_NAME_POINTER_EVENT);}else{EventHandler.on(this._element,EVENT_TOUCHSTART,event=>this._start(event));EventHandler.on(this._element,EVENT_TOUCHMOVE,event=>this._move(event));EventHandler.on(this._element,EVENT_TOUCHEND,event=>this._end(event));}}
_eventIsPointerPenTouch(event){return this._supportPointerEvents&&(event.pointerType===POINTER_TYPE_PEN||event.pointerType===POINTER_TYPE_TOUCH);}
static isSupported(){return'ontouchstart'in document.documentElement||navigator.maxTouchPoints>0;}}
const NAME$c='carousel';const DATA_KEY$8='bs.carousel';const EVENT_KEY$8=`.${DATA_KEY$8}`;const DATA_API_KEY$5='.data-api';const ARROW_LEFT_KEY$1='ArrowLeft';const ARROW_RIGHT_KEY$1='ArrowRight';const TOUCHEVENT_COMPAT_WAIT=500;const ORDER_NEXT='next';const ORDER_PREV='prev';const DIRECTION_LEFT='left';const DIRECTION_RIGHT='right';const EVENT_SLIDE=`slide${EVENT_KEY$8}`;const EVENT_SLID=`slid${EVENT_KEY$8}`;const EVENT_KEYDOWN$1=`keydown${EVENT_KEY$8}`;const EVENT_MOUSEENTER$1=`mouseenter${EVENT_KEY$8}`;const EVENT_MOUSELEAVE$1=`mouseleave${EVENT_KEY$8}`;const EVENT_DRAG_START=`dragstart${EVENT_KEY$8}`;const EVENT_LOAD_DATA_API$3=`load${EVENT_KEY$8}${DATA_API_KEY$5}`;const EVENT_CLICK_DATA_API$5=`click${EVENT_KEY$8}${DATA_API_KEY$5}`;const CLASS_NAME_CAROUSEL='carousel';const CLASS_NAME_ACTIVE$2='active';const CLASS_NAME_SLIDE='slide';const CLASS_NAME_END='carousel-item-end';const CLASS_NAME_START='carousel-item-start';const CLASS_NAME_NEXT='carousel-item-next';const CLASS_NAME_PREV='carousel-item-prev';const SELECTOR_ACTIVE='.active';const SELECTOR_ITEM='.carousel-item';const SELECTOR_ACTIVE_ITEM=SELECTOR_ACTIVE+SELECTOR_ITEM;const SELECTOR_ITEM_IMG='.carousel-item img';const SELECTOR_INDICATORS='.carousel-indicators';const SELECTOR_DATA_SLIDE='[data-bs-slide], [data-bs-slide-to]';const SELECTOR_DATA_RIDE='[data-bs-ride="carousel"]';const KEY_TO_DIRECTION={[ARROW_LEFT_KEY$1]:DIRECTION_RIGHT,[ARROW_RIGHT_KEY$1]:DIRECTION_LEFT};const Default$b={interval:5000,keyboard:true,pause:'hover',ride:false,touch:true,wrap:true};const DefaultType$b={interval:'(number|boolean)',keyboard:'boolean',pause:'(string|boolean)',ride:'(boolean|string)',touch:'boolean',wrap:'boolean'};class Carousel extends BaseComponent{constructor(element,config){super(element,config);this._interval=null;this._activeElement=null;this._isSliding=false;this.touchTimeout=null;this._swipeHelper=null;this._indicatorsElement=SelectorEngine.findOne(SELECTOR_INDICATORS,this._element);this._addEventListeners();if(this._config.ride===CLASS_NAME_CAROUSEL){this.cycle();}}
static get Default(){return Default$b;}
static get DefaultType(){return DefaultType$b;}
static get NAME(){return NAME$c;}
next(){this._slide(ORDER_NEXT);}
nextWhenVisible(){if(!document.hidden&&isVisible(this._element)){this.next();}}
prev(){this._slide(ORDER_PREV);}
pause(){if(this._isSliding){triggerTransitionEnd(this._element);}
this._clearInterval();}
cycle(){this._clearInterval();this._updateInterval();this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval);}
_maybeEnableCycle(){if(!this._config.ride){return;}
if(this._isSliding){EventHandler.one(this._element,EVENT_SLID,()=>this.cycle());return;}
this.cycle();}
to(index){const items=this._getItems();if(index>items.length-1||index<0){return;}
if(this._isSliding){EventHandler.one(this._element,EVENT_SLID,()=>this.to(index));return;}
const activeIndex=this._getItemIndex(this._getActive());if(activeIndex===index){return;}
const order=index>activeIndex?ORDER_NEXT:ORDER_PREV;this._slide(order,items[index]);}
dispose(){if(this._swipeHelper){this._swipeHelper.dispose();}
super.dispose();}
_configAfterMerge(config){config.defaultInterval=config.interval;return config;}
_addEventListeners(){if(this._config.keyboard){EventHandler.on(this._element,EVENT_KEYDOWN$1,event=>this._keydown(event));}
if(this._config.pause==='hover'){EventHandler.on(this._element,EVENT_MOUSEENTER$1,()=>this.pause());EventHandler.on(this._element,EVENT_MOUSELEAVE$1,()=>this._maybeEnableCycle());}
if(this._config.touch&&Swipe.isSupported()){this._addTouchEventListeners();}}
_addTouchEventListeners(){for(const img of SelectorEngine.find(SELECTOR_ITEM_IMG,this._element)){EventHandler.on(img,EVENT_DRAG_START,event=>event.preventDefault());}
const endCallBack=()=>{if(this._config.pause!=='hover'){return;}
this.pause();if(this.touchTimeout){clearTimeout(this.touchTimeout);}
this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),TOUCHEVENT_COMPAT_WAIT+this._config.interval);};const swipeConfig={leftCallback:()=>this._slide(this._directionToOrder(DIRECTION_LEFT)),rightCallback:()=>this._slide(this._directionToOrder(DIRECTION_RIGHT)),endCallback:endCallBack};this._swipeHelper=new Swipe(this._element,swipeConfig);}
_keydown(event){if(/input|textarea/i.test(event.target.tagName)){return;}
const direction=KEY_TO_DIRECTION[event.key];if(direction){event.preventDefault();this._slide(this._directionToOrder(direction));}}
_getItemIndex(element){return this._getItems().indexOf(element);}
_setActiveIndicatorElement(index){if(!this._indicatorsElement){return;}
const activeIndicator=SelectorEngine.findOne(SELECTOR_ACTIVE,this._indicatorsElement);activeIndicator.classList.remove(CLASS_NAME_ACTIVE$2);activeIndicator.removeAttribute('aria-current');const newActiveIndicator=SelectorEngine.findOne(`[data-bs-slide-to="${index}"]`,this._indicatorsElement);if(newActiveIndicator){newActiveIndicator.classList.add(CLASS_NAME_ACTIVE$2);newActiveIndicator.setAttribute('aria-current','true');}}
_updateInterval(){const element=this._activeElement||this._getActive();if(!element){return;}
const elementInterval=Number.parseInt(element.getAttribute('data-bs-interval'),10);this._config.interval=elementInterval||this._config.defaultInterval;}
_slide(order,element=null){if(this._isSliding){return;}
const activeElement=this._getActive();const isNext=order===ORDER_NEXT;const nextElement=element||getNextActiveElement(this._getItems(),activeElement,isNext,this._config.wrap);if(nextElement===activeElement){return;}
const nextElementIndex=this._getItemIndex(nextElement);const triggerEvent=eventName=>{return EventHandler.trigger(this._element,eventName,{relatedTarget:nextElement,direction:this._orderToDirection(order),from:this._getItemIndex(activeElement),to:nextElementIndex});};const slideEvent=triggerEvent(EVENT_SLIDE);if(slideEvent.defaultPrevented){return;}
if(!activeElement||!nextElement){return;}
const isCycling=Boolean(this._interval);this.pause();this._isSliding=true;this._setActiveIndicatorElement(nextElementIndex);this._activeElement=nextElement;const directionalClassName=isNext?CLASS_NAME_START:CLASS_NAME_END;const orderClassName=isNext?CLASS_NAME_NEXT:CLASS_NAME_PREV;nextElement.classList.add(orderClassName);reflow(nextElement);activeElement.classList.add(directionalClassName);nextElement.classList.add(directionalClassName);const completeCallBack=()=>{nextElement.classList.remove(directionalClassName,orderClassName);nextElement.classList.add(CLASS_NAME_ACTIVE$2);activeElement.classList.remove(CLASS_NAME_ACTIVE$2,orderClassName,directionalClassName);this._isSliding=false;triggerEvent(EVENT_SLID);};this._queueCallback(completeCallBack,activeElement,this._isAnimated());if(isCycling){this.cycle();}}
_isAnimated(){return this._element.classList.contains(CLASS_NAME_SLIDE);}
_getActive(){return SelectorEngine.findOne(SELECTOR_ACTIVE_ITEM,this._element);}
_getItems(){return SelectorEngine.find(SELECTOR_ITEM,this._element);}
_clearInterval(){if(this._interval){clearInterval(this._interval);this._interval=null;}}
_directionToOrder(direction){if(isRTL()){return direction===DIRECTION_LEFT?ORDER_PREV:ORDER_NEXT;}
return direction===DIRECTION_LEFT?ORDER_NEXT:ORDER_PREV;}
_orderToDirection(order){if(isRTL()){return order===ORDER_PREV?DIRECTION_LEFT:DIRECTION_RIGHT;}
return order===ORDER_PREV?DIRECTION_RIGHT:DIRECTION_LEFT;}
static jQueryInterface(config){return this.each(function(){const data=Carousel.getOrCreateInstance(this,config);if(typeof config==='number'){data.to(config);return;}
if(typeof config==='string'){if(data[config]===undefined||config.startsWith('_')||config==='constructor'){throw new TypeError(`No method named "${config}"`);}
data[config]();}});}}
EventHandler.on(document,EVENT_CLICK_DATA_API$5,SELECTOR_DATA_SLIDE,function(event){const target=getElementFromSelector(this);if(!target||!target.classList.contains(CLASS_NAME_CAROUSEL)){return;}
event.preventDefault();const carousel=Carousel.getOrCreateInstance(target);const slideIndex=this.getAttribute('data-bs-slide-to');if(slideIndex){carousel.to(slideIndex);carousel._maybeEnableCycle();return;}
if(Manipulator.getDataAttribute(this,'slide')==='next'){carousel.next();carousel._maybeEnableCycle();return;}
carousel.prev();carousel._maybeEnableCycle();});EventHandler.on(window,EVENT_LOAD_DATA_API$3,()=>{const carousels=SelectorEngine.find(SELECTOR_DATA_RIDE);for(const carousel of carousels){Carousel.getOrCreateInstance(carousel);}});defineJQueryPlugin(Carousel);const NAME$b='collapse';const DATA_KEY$7='bs.collapse';const EVENT_KEY$7=`.${DATA_KEY$7}`;const DATA_API_KEY$4='.data-api';const EVENT_SHOW$6=`show${EVENT_KEY$7}`;const EVENT_SHOWN$6=`shown${EVENT_KEY$7}`;const EVENT_HIDE$6=`hide${EVENT_KEY$7}`;const EVENT_HIDDEN$6=`hidden${EVENT_KEY$7}`;const EVENT_CLICK_DATA_API$4=`click${EVENT_KEY$7}${DATA_API_KEY$4}`;const CLASS_NAME_SHOW$7='show';const CLASS_NAME_COLLAPSE='collapse';const CLASS_NAME_COLLAPSING='collapsing';const CLASS_NAME_COLLAPSED='collapsed';const CLASS_NAME_DEEPER_CHILDREN=`:scope .${CLASS_NAME_COLLAPSE} .${CLASS_NAME_COLLAPSE}`;const CLASS_NAME_HORIZONTAL='collapse-horizontal';const WIDTH='width';const HEIGHT='height';const SELECTOR_ACTIVES='.collapse.show, .collapse.collapsing';const SELECTOR_DATA_TOGGLE$4='[data-bs-toggle="collapse"]';const Default$a={parent:null,toggle:true};const DefaultType$a={parent:'(null|element)',toggle:'boolean'};class Collapse extends BaseComponent{constructor(element,config){super(element,config);this._isTransitioning=false;this._triggerArray=[];const toggleList=SelectorEngine.find(SELECTOR_DATA_TOGGLE$4);for(const elem of toggleList){const selector=getSelectorFromElement(elem);const filterElement=SelectorEngine.find(selector).filter(foundElement=>foundElement===this._element);if(selector!==null&&filterElement.length){this._triggerArray.push(elem);}}
this._initializeChildren();if(!this._config.parent){this._addAriaAndCollapsedClass(this._triggerArray,this._isShown());}
if(this._config.toggle){this.toggle();}}
static get Default(){return Default$a;}
static get DefaultType(){return DefaultType$a;}
static get NAME(){return NAME$b;}
toggle(){if(this._isShown()){this.hide();}else{this.show();}}
show(){if(this._isTransitioning||this._isShown()){return;}
let activeChildren=[];if(this._config.parent){activeChildren=this._getFirstLevelChildren(SELECTOR_ACTIVES).filter(element=>element!==this._element).map(element=>Collapse.getOrCreateInstance(element,{toggle:false}));}
if(activeChildren.length&&activeChildren[0]._isTransitioning){return;}
const startEvent=EventHandler.trigger(this._element,EVENT_SHOW$6);if(startEvent.defaultPrevented){return;}
for(const activeInstance of activeChildren){activeInstance.hide();}
const dimension=this._getDimension();this._element.classList.remove(CLASS_NAME_COLLAPSE);this._element.classList.add(CLASS_NAME_COLLAPSING);this._element.style[dimension]=0;this._addAriaAndCollapsedClass(this._triggerArray,true);this._isTransitioning=true;const complete=()=>{this._isTransitioning=false;this._element.classList.remove(CLASS_NAME_COLLAPSING);this._element.classList.add(CLASS_NAME_COLLAPSE,CLASS_NAME_SHOW$7);this._element.style[dimension]='';EventHandler.trigger(this._element,EVENT_SHOWN$6);};const capitalizedDimension=dimension[0].toUpperCase()+dimension.slice(1);const scrollSize=`scroll${capitalizedDimension}`;this._queueCallback(complete,this._element,true);this._element.style[dimension]=`${this._element[scrollSize]}px`;}
hide(){if(this._isTransitioning||!this._isShown()){return;}
const startEvent=EventHandler.trigger(this._element,EVENT_HIDE$6);if(startEvent.defaultPrevented){return;}
const dimension=this._getDimension();this._element.style[dimension]=`${this._element.getBoundingClientRect()[dimension]}px`;reflow(this._element);this._element.classList.add(CLASS_NAME_COLLAPSING);this._element.classList.remove(CLASS_NAME_COLLAPSE,CLASS_NAME_SHOW$7);for(const trigger of this._triggerArray){const element=getElementFromSelector(trigger);if(element&&!this._isShown(element)){this._addAriaAndCollapsedClass([trigger],false);}}
this._isTransitioning=true;const complete=()=>{this._isTransitioning=false;this._element.classList.remove(CLASS_NAME_COLLAPSING);this._element.classList.add(CLASS_NAME_COLLAPSE);EventHandler.trigger(this._element,EVENT_HIDDEN$6);};this._element.style[dimension]='';this._queueCallback(complete,this._element,true);}
_isShown(element=this._element){return element.classList.contains(CLASS_NAME_SHOW$7);}
_configAfterMerge(config){config.toggle=Boolean(config.toggle);config.parent=getElement(config.parent);return config;}
_getDimension(){return this._element.classList.contains(CLASS_NAME_HORIZONTAL)?WIDTH:HEIGHT;}
_initializeChildren(){if(!this._config.parent){return;}
const children=this._getFirstLevelChildren(SELECTOR_DATA_TOGGLE$4);for(const element of children){const selected=getElementFromSelector(element);if(selected){this._addAriaAndCollapsedClass([element],this._isShown(selected));}}}
_getFirstLevelChildren(selector){const children=SelectorEngine.find(CLASS_NAME_DEEPER_CHILDREN,this._config.parent);return SelectorEngine.find(selector,this._config.parent).filter(element=>!children.includes(element));}
_addAriaAndCollapsedClass(triggerArray,isOpen){if(!triggerArray.length){return;}
for(const element of triggerArray){element.classList.toggle(CLASS_NAME_COLLAPSED,!isOpen);element.setAttribute('aria-expanded',isOpen);}}
static jQueryInterface(config){const _config={};if(typeof config==='string'&&/show|hide/.test(config)){_config.toggle=false;}
return this.each(function(){const data=Collapse.getOrCreateInstance(this,_config);if(typeof config==='string'){if(typeof data[config]==='undefined'){throw new TypeError(`No method named "${config}"`);}
data[config]();}});}}
EventHandler.on(document,EVENT_CLICK_DATA_API$4,SELECTOR_DATA_TOGGLE$4,function(event){if(event.target.tagName==='A'||event.delegateTarget&&event.delegateTarget.tagName==='A'){event.preventDefault();}
const selector=getSelectorFromElement(this);const selectorElements=SelectorEngine.find(selector);for(const element of selectorElements){Collapse.getOrCreateInstance(element,{toggle:false}).toggle();}});defineJQueryPlugin(Collapse);var top='top';var bottom='bottom';var right='right';var left='left';var auto='auto';var basePlacements=[top,bottom,right,left];var start='start';var end='end';var clippingParents='clippingParents';var viewport='viewport';var popper='popper';var reference='reference';var variationPlacements=basePlacements.reduce(function(acc,placement){return acc.concat([placement+"-"+start,placement+"-"+end]);},[]);var placements=[].concat(basePlacements,[auto]).reduce(function(acc,placement){return acc.concat([placement,placement+"-"+start,placement+"-"+end]);},[]);var beforeRead='beforeRead';var read='read';var afterRead='afterRead';var beforeMain='beforeMain';var main='main';var afterMain='afterMain';var beforeWrite='beforeWrite';var write='write';var afterWrite='afterWrite';var modifierPhases=[beforeRead,read,afterRead,beforeMain,main,afterMain,beforeWrite,write,afterWrite];function getNodeName(element){return element?(element.nodeName||'').toLowerCase():null;}
function getWindow(node){if(node==null){return window;}
if(node.toString()!=='[object Window]'){var ownerDocument=node.ownerDocument;return ownerDocument?ownerDocument.defaultView||window:window;}
return node;}
function isElement(node){var OwnElement=getWindow(node).Element;return node instanceof OwnElement||node instanceof Element;}
function isHTMLElement(node){var OwnElement=getWindow(node).HTMLElement;return node instanceof OwnElement||node instanceof HTMLElement;}
function isShadowRoot(node){if(typeof ShadowRoot==='undefined'){return false;}
var OwnElement=getWindow(node).ShadowRoot;return node instanceof OwnElement||node instanceof ShadowRoot;}
function applyStyles(_ref){var state=_ref.state;Object.keys(state.elements).forEach(function(name){var style=state.styles[name]||{};var attributes=state.attributes[name]||{};var element=state.elements[name];if(!isHTMLElement(element)||!getNodeName(element)){return;}
Object.assign(element.style,style);Object.keys(attributes).forEach(function(name){var value=attributes[name];if(value===false){element.removeAttribute(name);}else{element.setAttribute(name,value===true?'':value);}});});}
function effect$2(_ref2){var state=_ref2.state;var initialStyles={popper:{position:state.options.strategy,left:'0',top:'0',margin:'0'},arrow:{position:'absolute'},reference:{}};Object.assign(state.elements.popper.style,initialStyles.popper);state.styles=initialStyles;if(state.elements.arrow){Object.assign(state.elements.arrow.style,initialStyles.arrow);}
return function(){Object.keys(state.elements).forEach(function(name){var element=state.elements[name];var attributes=state.attributes[name]||{};var styleProperties=Object.keys(state.styles.hasOwnProperty(name)?state.styles[name]:initialStyles[name]);var style=styleProperties.reduce(function(style,property){style[property]='';return style;},{});if(!isHTMLElement(element)||!getNodeName(element)){return;}
Object.assign(element.style,style);Object.keys(attributes).forEach(function(attribute){element.removeAttribute(attribute);});});};}
const applyStyles$1={name:'applyStyles',enabled:true,phase:'write',fn:applyStyles,effect:effect$2,requires:['computeStyles']};function getBasePlacement(placement){return placement.split('-')[0];}
var max=Math.max;var min=Math.min;var round=Math.round;function getUAString(){var uaData=navigator.userAgentData;if(uaData!=null&&uaData.brands){return uaData.brands.map(function(item){return item.brand+"/"+item.version;}).join(' ');}
return navigator.userAgent;}
function isLayoutViewport(){return!/^((?!chrome|android).)*safari/i.test(getUAString());}
function getBoundingClientRect(element,includeScale,isFixedStrategy){if(includeScale===void 0){includeScale=false;}
if(isFixedStrategy===void 0){isFixedStrategy=false;}
var clientRect=element.getBoundingClientRect();var scaleX=1;var scaleY=1;if(includeScale&&isHTMLElement(element)){scaleX=element.offsetWidth>0?round(clientRect.width)/element.offsetWidth||1:1;scaleY=element.offsetHeight>0?round(clientRect.height)/element.offsetHeight||1:1;}
var _ref=isElement(element)?getWindow(element):window,visualViewport=_ref.visualViewport;var addVisualOffsets=!isLayoutViewport()&&isFixedStrategy;var x=(clientRect.left+(addVisualOffsets&&visualViewport?visualViewport.offsetLeft:0))/scaleX;var y=(clientRect.top+(addVisualOffsets&&visualViewport?visualViewport.offsetTop:0))/scaleY;var width=clientRect.width/scaleX;var height=clientRect.height/scaleY;return{width:width,height:height,top:y,right:x+width,bottom:y+height,left:x,x:x,y:y};}
function getLayoutRect(element){var clientRect=getBoundingClientRect(element);var width=element.offsetWidth;var height=element.offsetHeight;if(Math.abs(clientRect.width-width)<=1){width=clientRect.width;}
if(Math.abs(clientRect.height-height)<=1){height=clientRect.height;}
return{x:element.offsetLeft,y:element.offsetTop,width:width,height:height};}
function contains(parent,child){var rootNode=child.getRootNode&&child.getRootNode();if(parent.contains(child)){return true;}
else if(rootNode&&isShadowRoot(rootNode)){var next=child;do{if(next&&parent.isSameNode(next)){return true;}
next=next.parentNode||next.host;}while(next);}
return false;}
function getComputedStyle$1(element){return getWindow(element).getComputedStyle(element);}
function isTableElement(element){return['table','td','th'].indexOf(getNodeName(element))>=0;}
function getDocumentElement(element){return((isElement(element)?element.ownerDocument:element.document)||window.document).documentElement;}
function getParentNode(element){if(getNodeName(element)==='html'){return element;}
return(element.assignedSlot||element.parentNode||(isShadowRoot(element)?element.host:null)||getDocumentElement(element));}
function getTrueOffsetParent(element){if(!isHTMLElement(element)||getComputedStyle$1(element).position==='fixed'){return null;}
return element.offsetParent;}
function getContainingBlock(element){var isFirefox=/firefox/i.test(getUAString());var isIE=/Trident/i.test(getUAString());if(isIE&&isHTMLElement(element)){var elementCss=getComputedStyle$1(element);if(elementCss.position==='fixed'){return null;}}
var currentNode=getParentNode(element);if(isShadowRoot(currentNode)){currentNode=currentNode.host;}
while(isHTMLElement(currentNode)&&['html','body'].indexOf(getNodeName(currentNode))<0){var css=getComputedStyle$1(currentNode);if(css.transform!=='none'||css.perspective!=='none'||css.contain==='paint'||['transform','perspective'].indexOf(css.willChange)!==-1||isFirefox&&css.willChange==='filter'||isFirefox&&css.filter&&css.filter!=='none'){return currentNode;}else{currentNode=currentNode.parentNode;}}
return null;}
function getOffsetParent(element){var window=getWindow(element);var offsetParent=getTrueOffsetParent(element);while(offsetParent&&isTableElement(offsetParent)&&getComputedStyle$1(offsetParent).position==='static'){offsetParent=getTrueOffsetParent(offsetParent);}
if(offsetParent&&(getNodeName(offsetParent)==='html'||getNodeName(offsetParent)==='body'&&getComputedStyle$1(offsetParent).position==='static')){return window;}
return offsetParent||getContainingBlock(element)||window;}
function getMainAxisFromPlacement(placement){return['top','bottom'].indexOf(placement)>=0?'x':'y';}
function within(min$1,value,max$1){return max(min$1,min(value,max$1));}
function withinMaxClamp(min,value,max){var v=within(min,value,max);return v>max?max:v;}
function getFreshSideObject(){return{top:0,right:0,bottom:0,left:0};}
function mergePaddingObject(paddingObject){return Object.assign({},getFreshSideObject(),paddingObject);}
function expandToHashMap(value,keys){return keys.reduce(function(hashMap,key){hashMap[key]=value;return hashMap;},{});}
var toPaddingObject=function toPaddingObject(padding,state){padding=typeof padding==='function'?padding(Object.assign({},state.rects,{placement:state.placement})):padding;return mergePaddingObject(typeof padding!=='number'?padding:expandToHashMap(padding,basePlacements));};function arrow(_ref){var _state$modifiersData$;var state=_ref.state,name=_ref.name,options=_ref.options;var arrowElement=state.elements.arrow;var popperOffsets=state.modifiersData.popperOffsets;var basePlacement=getBasePlacement(state.placement);var axis=getMainAxisFromPlacement(basePlacement);var isVertical=[left,right].indexOf(basePlacement)>=0;var len=isVertical?'height':'width';if(!arrowElement||!popperOffsets){return;}
var paddingObject=toPaddingObject(options.padding,state);var arrowRect=getLayoutRect(arrowElement);var minProp=axis==='y'?top:left;var maxProp=axis==='y'?bottom:right;var endDiff=state.rects.reference[len]+state.rects.reference[axis]-popperOffsets[axis]-state.rects.popper[len];var startDiff=popperOffsets[axis]-state.rects.reference[axis];var arrowOffsetParent=getOffsetParent(arrowElement);var clientSize=arrowOffsetParent?axis==='y'?arrowOffsetParent.clientHeight||0:arrowOffsetParent.clientWidth||0:0;var centerToReference=endDiff/2-startDiff/2;var min=paddingObject[minProp];var max=clientSize-arrowRect[len]-paddingObject[maxProp];var center=clientSize/2-arrowRect[len]/2+centerToReference;var offset=within(min,center,max);var axisProp=axis;state.modifiersData[name]=(_state$modifiersData$={},_state$modifiersData$[axisProp]=offset,_state$modifiersData$.centerOffset=offset-center,_state$modifiersData$);}
function effect$1(_ref2){var state=_ref2.state,options=_ref2.options;var _options$element=options.element,arrowElement=_options$element===void 0?'[data-popper-arrow]':_options$element;if(arrowElement==null){return;}
if(typeof arrowElement==='string'){arrowElement=state.elements.popper.querySelector(arrowElement);if(!arrowElement){return;}}
if(!contains(state.elements.popper,arrowElement)){return;}
state.elements.arrow=arrowElement;}
const arrow$1={name:'arrow',enabled:true,phase:'main',fn:arrow,effect:effect$1,requires:['popperOffsets'],requiresIfExists:['preventOverflow']};function getVariation(placement){return placement.split('-')[1];}
var unsetSides={top:'auto',right:'auto',bottom:'auto',left:'auto'};function roundOffsetsByDPR(_ref){var x=_ref.x,y=_ref.y;var win=window;var dpr=win.devicePixelRatio||1;return{x:round(x*dpr)/dpr||0,y:round(y*dpr)/dpr||0};}
function mapToStyles(_ref2){var _Object$assign2;var popper=_ref2.popper,popperRect=_ref2.popperRect,placement=_ref2.placement,variation=_ref2.variation,offsets=_ref2.offsets,position=_ref2.position,gpuAcceleration=_ref2.gpuAcceleration,adaptive=_ref2.adaptive,roundOffsets=_ref2.roundOffsets,isFixed=_ref2.isFixed;var _offsets$x=offsets.x,x=_offsets$x===void 0?0:_offsets$x,_offsets$y=offsets.y,y=_offsets$y===void 0?0:_offsets$y;var _ref3=typeof roundOffsets==='function'?roundOffsets({x:x,y:y}):{x:x,y:y};x=_ref3.x;y=_ref3.y;var hasX=offsets.hasOwnProperty('x');var hasY=offsets.hasOwnProperty('y');var sideX=left;var sideY=top;var win=window;if(adaptive){var offsetParent=getOffsetParent(popper);var heightProp='clientHeight';var widthProp='clientWidth';if(offsetParent===getWindow(popper)){offsetParent=getDocumentElement(popper);if(getComputedStyle$1(offsetParent).position!=='static'&&position==='absolute'){heightProp='scrollHeight';widthProp='scrollWidth';}}
offsetParent=offsetParent;if(placement===top||(placement===left||placement===right)&&variation===end){sideY=bottom;var offsetY=isFixed&&offsetParent===win&&win.visualViewport?win.visualViewport.height:offsetParent[heightProp];y-=offsetY-popperRect.height;y*=gpuAcceleration?1:-1;}
if(placement===left||(placement===top||placement===bottom)&&variation===end){sideX=right;var offsetX=isFixed&&offsetParent===win&&win.visualViewport?win.visualViewport.width:offsetParent[widthProp];x-=offsetX-popperRect.width;x*=gpuAcceleration?1:-1;}}
var commonStyles=Object.assign({position:position},adaptive&&unsetSides);var _ref4=roundOffsets===true?roundOffsetsByDPR({x:x,y:y}):{x:x,y:y};x=_ref4.x;y=_ref4.y;if(gpuAcceleration){var _Object$assign;return Object.assign({},commonStyles,(_Object$assign={},_Object$assign[sideY]=hasY?'0':'',_Object$assign[sideX]=hasX?'0':'',_Object$assign.transform=(win.devicePixelRatio||1)<=1?"translate("+x+"px, "+y+"px)":"translate3d("+x+"px, "+y+"px, 0)",_Object$assign));}
return Object.assign({},commonStyles,(_Object$assign2={},_Object$assign2[sideY]=hasY?y+"px":'',_Object$assign2[sideX]=hasX?x+"px":'',_Object$assign2.transform='',_Object$assign2));}
function computeStyles(_ref5){var state=_ref5.state,options=_ref5.options;var _options$gpuAccelerat=options.gpuAcceleration,gpuAcceleration=_options$gpuAccelerat===void 0?true:_options$gpuAccelerat,_options$adaptive=options.adaptive,adaptive=_options$adaptive===void 0?true:_options$adaptive,_options$roundOffsets=options.roundOffsets,roundOffsets=_options$roundOffsets===void 0?true:_options$roundOffsets;var commonStyles={placement:getBasePlacement(state.placement),variation:getVariation(state.placement),popper:state.elements.popper,popperRect:state.rects.popper,gpuAcceleration:gpuAcceleration,isFixed:state.options.strategy==='fixed'};if(state.modifiersData.popperOffsets!=null){state.styles.popper=Object.assign({},state.styles.popper,mapToStyles(Object.assign({},commonStyles,{offsets:state.modifiersData.popperOffsets,position:state.options.strategy,adaptive:adaptive,roundOffsets:roundOffsets})));}
if(state.modifiersData.arrow!=null){state.styles.arrow=Object.assign({},state.styles.arrow,mapToStyles(Object.assign({},commonStyles,{offsets:state.modifiersData.arrow,position:'absolute',adaptive:false,roundOffsets:roundOffsets})));}
state.attributes.popper=Object.assign({},state.attributes.popper,{'data-popper-placement':state.placement});}
const computeStyles$1={name:'computeStyles',enabled:true,phase:'beforeWrite',fn:computeStyles,data:{}};var passive={passive:true};function effect(_ref){var state=_ref.state,instance=_ref.instance,options=_ref.options;var _options$scroll=options.scroll,scroll=_options$scroll===void 0?true:_options$scroll,_options$resize=options.resize,resize=_options$resize===void 0?true:_options$resize;var window=getWindow(state.elements.popper);var scrollParents=[].concat(state.scrollParents.reference,state.scrollParents.popper);if(scroll){scrollParents.forEach(function(scrollParent){scrollParent.addEventListener('scroll',instance.update,passive);});}
if(resize){window.addEventListener('resize',instance.update,passive);}
return function(){if(scroll){scrollParents.forEach(function(scrollParent){scrollParent.removeEventListener('scroll',instance.update,passive);});}
if(resize){window.removeEventListener('resize',instance.update,passive);}};}
const eventListeners={name:'eventListeners',enabled:true,phase:'write',fn:function fn(){},effect:effect,data:{}};var hash$1={left:'right',right:'left',bottom:'top',top:'bottom'};function getOppositePlacement(placement){return placement.replace(/left|right|bottom|top/g,function(matched){return hash$1[matched];});}
var hash={start:'end',end:'start'};function getOppositeVariationPlacement(placement){return placement.replace(/start|end/g,function(matched){return hash[matched];});}
function getWindowScroll(node){var win=getWindow(node);var scrollLeft=win.pageXOffset;var scrollTop=win.pageYOffset;return{scrollLeft:scrollLeft,scrollTop:scrollTop};}
function getWindowScrollBarX(element){return getBoundingClientRect(getDocumentElement(element)).left+getWindowScroll(element).scrollLeft;}
function getViewportRect(element,strategy){var win=getWindow(element);var html=getDocumentElement(element);var visualViewport=win.visualViewport;var width=html.clientWidth;var height=html.clientHeight;var x=0;var y=0;if(visualViewport){width=visualViewport.width;height=visualViewport.height;var layoutViewport=isLayoutViewport();if(layoutViewport||!layoutViewport&&strategy==='fixed'){x=visualViewport.offsetLeft;y=visualViewport.offsetTop;}}
return{width:width,height:height,x:x+getWindowScrollBarX(element),y:y};}
function getDocumentRect(element){var _element$ownerDocumen;var html=getDocumentElement(element);var winScroll=getWindowScroll(element);var body=(_element$ownerDocumen=element.ownerDocument)==null?void 0:_element$ownerDocumen.body;var width=max(html.scrollWidth,html.clientWidth,body?body.scrollWidth:0,body?body.clientWidth:0);var height=max(html.scrollHeight,html.clientHeight,body?body.scrollHeight:0,body?body.clientHeight:0);var x=-winScroll.scrollLeft+getWindowScrollBarX(element);var y=-winScroll.scrollTop;if(getComputedStyle$1(body||html).direction==='rtl'){x+=max(html.clientWidth,body?body.clientWidth:0)-width;}
return{width:width,height:height,x:x,y:y};}
function isScrollParent(element){var _getComputedStyle=getComputedStyle$1(element),overflow=_getComputedStyle.overflow,overflowX=_getComputedStyle.overflowX,overflowY=_getComputedStyle.overflowY;return/auto|scroll|overlay|hidden/.test(overflow+overflowY+overflowX);}
function getScrollParent(node){if(['html','body','#document'].indexOf(getNodeName(node))>=0){return node.ownerDocument.body;}
if(isHTMLElement(node)&&isScrollParent(node)){return node;}
return getScrollParent(getParentNode(node));}
function listScrollParents(element,list){var _element$ownerDocumen;if(list===void 0){list=[];}
var scrollParent=getScrollParent(element);var isBody=scrollParent===((_element$ownerDocumen=element.ownerDocument)==null?void 0:_element$ownerDocumen.body);var win=getWindow(scrollParent);var target=isBody?[win].concat(win.visualViewport||[],isScrollParent(scrollParent)?scrollParent:[]):scrollParent;var updatedList=list.concat(target);return isBody?updatedList:updatedList.concat(listScrollParents(getParentNode(target)));}
function rectToClientRect(rect){return Object.assign({},rect,{left:rect.x,top:rect.y,right:rect.x+rect.width,bottom:rect.y+rect.height});}
function getInnerBoundingClientRect(element,strategy){var rect=getBoundingClientRect(element,false,strategy==='fixed');rect.top=rect.top+element.clientTop;rect.left=rect.left+element.clientLeft;rect.bottom=rect.top+element.clientHeight;rect.right=rect.left+element.clientWidth;rect.width=element.clientWidth;rect.height=element.clientHeight;rect.x=rect.left;rect.y=rect.top;return rect;}
function getClientRectFromMixedType(element,clippingParent,strategy){return clippingParent===viewport?rectToClientRect(getViewportRect(element,strategy)):isElement(clippingParent)?getInnerBoundingClientRect(clippingParent,strategy):rectToClientRect(getDocumentRect(getDocumentElement(element)));}
function getClippingParents(element){var clippingParents=listScrollParents(getParentNode(element));var canEscapeClipping=['absolute','fixed'].indexOf(getComputedStyle$1(element).position)>=0;var clipperElement=canEscapeClipping&&isHTMLElement(element)?getOffsetParent(element):element;if(!isElement(clipperElement)){return[];}
return clippingParents.filter(function(clippingParent){return isElement(clippingParent)&&contains(clippingParent,clipperElement)&&getNodeName(clippingParent)!=='body';});}
function getClippingRect(element,boundary,rootBoundary,strategy){var mainClippingParents=boundary==='clippingParents'?getClippingParents(element):[].concat(boundary);var clippingParents=[].concat(mainClippingParents,[rootBoundary]);var firstClippingParent=clippingParents[0];var clippingRect=clippingParents.reduce(function(accRect,clippingParent){var rect=getClientRectFromMixedType(element,clippingParent,strategy);accRect.top=max(rect.top,accRect.top);accRect.right=min(rect.right,accRect.right);accRect.bottom=min(rect.bottom,accRect.bottom);accRect.left=max(rect.left,accRect.left);return accRect;},getClientRectFromMixedType(element,firstClippingParent,strategy));clippingRect.width=clippingRect.right-clippingRect.left;clippingRect.height=clippingRect.bottom-clippingRect.top;clippingRect.x=clippingRect.left;clippingRect.y=clippingRect.top;return clippingRect;}
function computeOffsets(_ref){var reference=_ref.reference,element=_ref.element,placement=_ref.placement;var basePlacement=placement?getBasePlacement(placement):null;var variation=placement?getVariation(placement):null;var commonX=reference.x+reference.width/2-element.width/2;var commonY=reference.y+reference.height/2-element.height/2;var offsets;switch(basePlacement){case top:offsets={x:commonX,y:reference.y-element.height};break;case bottom:offsets={x:commonX,y:reference.y+reference.height};break;case right:offsets={x:reference.x+reference.width,y:commonY};break;case left:offsets={x:reference.x-element.width,y:commonY};break;default:offsets={x:reference.x,y:reference.y};}
var mainAxis=basePlacement?getMainAxisFromPlacement(basePlacement):null;if(mainAxis!=null){var len=mainAxis==='y'?'height':'width';switch(variation){case start:offsets[mainAxis]=offsets[mainAxis]-(reference[len]/2-element[len]/2);break;case end:offsets[mainAxis]=offsets[mainAxis]+(reference[len]/2-element[len]/2);break;}}
return offsets;}
function detectOverflow(state,options){if(options===void 0){options={};}
var _options=options,_options$placement=_options.placement,placement=_options$placement===void 0?state.placement:_options$placement,_options$strategy=_options.strategy,strategy=_options$strategy===void 0?state.strategy:_options$strategy,_options$boundary=_options.boundary,boundary=_options$boundary===void 0?clippingParents:_options$boundary,_options$rootBoundary=_options.rootBoundary,rootBoundary=_options$rootBoundary===void 0?viewport:_options$rootBoundary,_options$elementConte=_options.elementContext,elementContext=_options$elementConte===void 0?popper:_options$elementConte,_options$altBoundary=_options.altBoundary,altBoundary=_options$altBoundary===void 0?false:_options$altBoundary,_options$padding=_options.padding,padding=_options$padding===void 0?0:_options$padding;var paddingObject=mergePaddingObject(typeof padding!=='number'?padding:expandToHashMap(padding,basePlacements));var altContext=elementContext===popper?reference:popper;var popperRect=state.rects.popper;var element=state.elements[altBoundary?altContext:elementContext];var clippingClientRect=getClippingRect(isElement(element)?element:element.contextElement||getDocumentElement(state.elements.popper),boundary,rootBoundary,strategy);var referenceClientRect=getBoundingClientRect(state.elements.reference);var popperOffsets=computeOffsets({reference:referenceClientRect,element:popperRect,strategy:'absolute',placement:placement});var popperClientRect=rectToClientRect(Object.assign({},popperRect,popperOffsets));var elementClientRect=elementContext===popper?popperClientRect:referenceClientRect;var overflowOffsets={top:clippingClientRect.top-elementClientRect.top+paddingObject.top,bottom:elementClientRect.bottom-clippingClientRect.bottom+paddingObject.bottom,left:clippingClientRect.left-elementClientRect.left+paddingObject.left,right:elementClientRect.right-clippingClientRect.right+paddingObject.right};var offsetData=state.modifiersData.offset;if(elementContext===popper&&offsetData){var offset=offsetData[placement];Object.keys(overflowOffsets).forEach(function(key){var multiply=[right,bottom].indexOf(key)>=0?1:-1;var axis=[top,bottom].indexOf(key)>=0?'y':'x';overflowOffsets[key]+=offset[axis]*multiply;});}
return overflowOffsets;}
function computeAutoPlacement(state,options){if(options===void 0){options={};}
var _options=options,placement=_options.placement,boundary=_options.boundary,rootBoundary=_options.rootBoundary,padding=_options.padding,flipVariations=_options.flipVariations,_options$allowedAutoP=_options.allowedAutoPlacements,allowedAutoPlacements=_options$allowedAutoP===void 0?placements:_options$allowedAutoP;var variation=getVariation(placement);var placements$1=variation?flipVariations?variationPlacements:variationPlacements.filter(function(placement){return getVariation(placement)===variation;}):basePlacements;var allowedPlacements=placements$1.filter(function(placement){return allowedAutoPlacements.indexOf(placement)>=0;});if(allowedPlacements.length===0){allowedPlacements=placements$1;}
var overflows=allowedPlacements.reduce(function(acc,placement){acc[placement]=detectOverflow(state,{placement:placement,boundary:boundary,rootBoundary:rootBoundary,padding:padding})[getBasePlacement(placement)];return acc;},{});return Object.keys(overflows).sort(function(a,b){return overflows[a]-overflows[b];});}
function getExpandedFallbackPlacements(placement){if(getBasePlacement(placement)===auto){return[];}
var oppositePlacement=getOppositePlacement(placement);return[getOppositeVariationPlacement(placement),oppositePlacement,getOppositeVariationPlacement(oppositePlacement)];}
function flip(_ref){var state=_ref.state,options=_ref.options,name=_ref.name;if(state.modifiersData[name]._skip){return;}
var _options$mainAxis=options.mainAxis,checkMainAxis=_options$mainAxis===void 0?true:_options$mainAxis,_options$altAxis=options.altAxis,checkAltAxis=_options$altAxis===void 0?true:_options$altAxis,specifiedFallbackPlacements=options.fallbackPlacements,padding=options.padding,boundary=options.boundary,rootBoundary=options.rootBoundary,altBoundary=options.altBoundary,_options$flipVariatio=options.flipVariations,flipVariations=_options$flipVariatio===void 0?true:_options$flipVariatio,allowedAutoPlacements=options.allowedAutoPlacements;var preferredPlacement=state.options.placement;var basePlacement=getBasePlacement(preferredPlacement);var isBasePlacement=basePlacement===preferredPlacement;var fallbackPlacements=specifiedFallbackPlacements||(isBasePlacement||!flipVariations?[getOppositePlacement(preferredPlacement)]:getExpandedFallbackPlacements(preferredPlacement));var placements=[preferredPlacement].concat(fallbackPlacements).reduce(function(acc,placement){return acc.concat(getBasePlacement(placement)===auto?computeAutoPlacement(state,{placement:placement,boundary:boundary,rootBoundary:rootBoundary,padding:padding,flipVariations:flipVariations,allowedAutoPlacements:allowedAutoPlacements}):placement);},[]);var referenceRect=state.rects.reference;var popperRect=state.rects.popper;var checksMap=new Map();var makeFallbackChecks=true;var firstFittingPlacement=placements[0];for(var i=0;i<placements.length;i++){var placement=placements[i];var _basePlacement=getBasePlacement(placement);var isStartVariation=getVariation(placement)===start;var isVertical=[top,bottom].indexOf(_basePlacement)>=0;var len=isVertical?'width':'height';var overflow=detectOverflow(state,{placement:placement,boundary:boundary,rootBoundary:rootBoundary,altBoundary:altBoundary,padding:padding});var mainVariationSide=isVertical?isStartVariation?right:left:isStartVariation?bottom:top;if(referenceRect[len]>popperRect[len]){mainVariationSide=getOppositePlacement(mainVariationSide);}
var altVariationSide=getOppositePlacement(mainVariationSide);var checks=[];if(checkMainAxis){checks.push(overflow[_basePlacement]<=0);}
if(checkAltAxis){checks.push(overflow[mainVariationSide]<=0,overflow[altVariationSide]<=0);}
if(checks.every(function(check){return check;})){firstFittingPlacement=placement;makeFallbackChecks=false;break;}
checksMap.set(placement,checks);}
if(makeFallbackChecks){var numberOfChecks=flipVariations?3:1;var _loop=function _loop(_i){var fittingPlacement=placements.find(function(placement){var checks=checksMap.get(placement);if(checks){return checks.slice(0,_i).every(function(check){return check;});}});if(fittingPlacement){firstFittingPlacement=fittingPlacement;return"break";}};for(var _i=numberOfChecks;_i>0;_i--){var _ret=_loop(_i);if(_ret==="break")break;}}
if(state.placement!==firstFittingPlacement){state.modifiersData[name]._skip=true;state.placement=firstFittingPlacement;state.reset=true;}}
const flip$1={name:'flip',enabled:true,phase:'main',fn:flip,requiresIfExists:['offset'],data:{_skip:false}};function getSideOffsets(overflow,rect,preventedOffsets){if(preventedOffsets===void 0){preventedOffsets={x:0,y:0};}
return{top:overflow.top-rect.height-preventedOffsets.y,right:overflow.right-rect.width+preventedOffsets.x,bottom:overflow.bottom-rect.height+preventedOffsets.y,left:overflow.left-rect.width-preventedOffsets.x};}
function isAnySideFullyClipped(overflow){return[top,right,bottom,left].some(function(side){return overflow[side]>=0;});}
function hide(_ref){var state=_ref.state,name=_ref.name;var referenceRect=state.rects.reference;var popperRect=state.rects.popper;var preventedOffsets=state.modifiersData.preventOverflow;var referenceOverflow=detectOverflow(state,{elementContext:'reference'});var popperAltOverflow=detectOverflow(state,{altBoundary:true});var referenceClippingOffsets=getSideOffsets(referenceOverflow,referenceRect);var popperEscapeOffsets=getSideOffsets(popperAltOverflow,popperRect,preventedOffsets);var isReferenceHidden=isAnySideFullyClipped(referenceClippingOffsets);var hasPopperEscaped=isAnySideFullyClipped(popperEscapeOffsets);state.modifiersData[name]={referenceClippingOffsets:referenceClippingOffsets,popperEscapeOffsets:popperEscapeOffsets,isReferenceHidden:isReferenceHidden,hasPopperEscaped:hasPopperEscaped};state.attributes.popper=Object.assign({},state.attributes.popper,{'data-popper-reference-hidden':isReferenceHidden,'data-popper-escaped':hasPopperEscaped});}
const hide$1={name:'hide',enabled:true,phase:'main',requiresIfExists:['preventOverflow'],fn:hide};function distanceAndSkiddingToXY(placement,rects,offset){var basePlacement=getBasePlacement(placement);var invertDistance=[left,top].indexOf(basePlacement)>=0?-1:1;var _ref=typeof offset==='function'?offset(Object.assign({},rects,{placement:placement})):offset,skidding=_ref[0],distance=_ref[1];skidding=skidding||0;distance=(distance||0)*invertDistance;return[left,right].indexOf(basePlacement)>=0?{x:distance,y:skidding}:{x:skidding,y:distance};}
function offset(_ref2){var state=_ref2.state,options=_ref2.options,name=_ref2.name;var _options$offset=options.offset,offset=_options$offset===void 0?[0,0]:_options$offset;var data=placements.reduce(function(acc,placement){acc[placement]=distanceAndSkiddingToXY(placement,state.rects,offset);return acc;},{});var _data$state$placement=data[state.placement],x=_data$state$placement.x,y=_data$state$placement.y;if(state.modifiersData.popperOffsets!=null){state.modifiersData.popperOffsets.x+=x;state.modifiersData.popperOffsets.y+=y;}
state.modifiersData[name]=data;}
const offset$1={name:'offset',enabled:true,phase:'main',requires:['popperOffsets'],fn:offset};function popperOffsets(_ref){var state=_ref.state,name=_ref.name;state.modifiersData[name]=computeOffsets({reference:state.rects.reference,element:state.rects.popper,strategy:'absolute',placement:state.placement});}
const popperOffsets$1={name:'popperOffsets',enabled:true,phase:'read',fn:popperOffsets,data:{}};function getAltAxis(axis){return axis==='x'?'y':'x';}
function preventOverflow(_ref){var state=_ref.state,options=_ref.options,name=_ref.name;var _options$mainAxis=options.mainAxis,checkMainAxis=_options$mainAxis===void 0?true:_options$mainAxis,_options$altAxis=options.altAxis,checkAltAxis=_options$altAxis===void 0?false:_options$altAxis,boundary=options.boundary,rootBoundary=options.rootBoundary,altBoundary=options.altBoundary,padding=options.padding,_options$tether=options.tether,tether=_options$tether===void 0?true:_options$tether,_options$tetherOffset=options.tetherOffset,tetherOffset=_options$tetherOffset===void 0?0:_options$tetherOffset;var overflow=detectOverflow(state,{boundary:boundary,rootBoundary:rootBoundary,padding:padding,altBoundary:altBoundary});var basePlacement=getBasePlacement(state.placement);var variation=getVariation(state.placement);var isBasePlacement=!variation;var mainAxis=getMainAxisFromPlacement(basePlacement);var altAxis=getAltAxis(mainAxis);var popperOffsets=state.modifiersData.popperOffsets;var referenceRect=state.rects.reference;var popperRect=state.rects.popper;var tetherOffsetValue=typeof tetherOffset==='function'?tetherOffset(Object.assign({},state.rects,{placement:state.placement})):tetherOffset;var normalizedTetherOffsetValue=typeof tetherOffsetValue==='number'?{mainAxis:tetherOffsetValue,altAxis:tetherOffsetValue}:Object.assign({mainAxis:0,altAxis:0},tetherOffsetValue);var offsetModifierState=state.modifiersData.offset?state.modifiersData.offset[state.placement]:null;var data={x:0,y:0};if(!popperOffsets){return;}
if(checkMainAxis){var _offsetModifierState$;var mainSide=mainAxis==='y'?top:left;var altSide=mainAxis==='y'?bottom:right;var len=mainAxis==='y'?'height':'width';var offset=popperOffsets[mainAxis];var min$1=offset+overflow[mainSide];var max$1=offset-overflow[altSide];var additive=tether?-popperRect[len]/2:0;var minLen=variation===start?referenceRect[len]:popperRect[len];var maxLen=variation===start?-popperRect[len]:-referenceRect[len];var arrowElement=state.elements.arrow;var arrowRect=tether&&arrowElement?getLayoutRect(arrowElement):{width:0,height:0};var arrowPaddingObject=state.modifiersData['arrow#persistent']?state.modifiersData['arrow#persistent'].padding:getFreshSideObject();var arrowPaddingMin=arrowPaddingObject[mainSide];var arrowPaddingMax=arrowPaddingObject[altSide];var arrowLen=within(0,referenceRect[len],arrowRect[len]);var minOffset=isBasePlacement?referenceRect[len]/2-additive-arrowLen-arrowPaddingMin-normalizedTetherOffsetValue.mainAxis:minLen-arrowLen-arrowPaddingMin-normalizedTetherOffsetValue.mainAxis;var maxOffset=isBasePlacement?-referenceRect[len]/2+additive+arrowLen+arrowPaddingMax+normalizedTetherOffsetValue.mainAxis:maxLen+arrowLen+arrowPaddingMax+normalizedTetherOffsetValue.mainAxis;var arrowOffsetParent=state.elements.arrow&&getOffsetParent(state.elements.arrow);var clientOffset=arrowOffsetParent?mainAxis==='y'?arrowOffsetParent.clientTop||0:arrowOffsetParent.clientLeft||0:0;var offsetModifierValue=(_offsetModifierState$=offsetModifierState==null?void 0:offsetModifierState[mainAxis])!=null?_offsetModifierState$:0;var tetherMin=offset+minOffset-offsetModifierValue-clientOffset;var tetherMax=offset+maxOffset-offsetModifierValue;var preventedOffset=within(tether?min(min$1,tetherMin):min$1,offset,tether?max(max$1,tetherMax):max$1);popperOffsets[mainAxis]=preventedOffset;data[mainAxis]=preventedOffset-offset;}
if(checkAltAxis){var _offsetModifierState$2;var _mainSide=mainAxis==='x'?top:left;var _altSide=mainAxis==='x'?bottom:right;var _offset=popperOffsets[altAxis];var _len=altAxis==='y'?'height':'width';var _min=_offset+overflow[_mainSide];var _max=_offset-overflow[_altSide];var isOriginSide=[top,left].indexOf(basePlacement)!==-1;var _offsetModifierValue=(_offsetModifierState$2=offsetModifierState==null?void 0:offsetModifierState[altAxis])!=null?_offsetModifierState$2:0;var _tetherMin=isOriginSide?_min:_offset-referenceRect[_len]-popperRect[_len]-_offsetModifierValue+normalizedTetherOffsetValue.altAxis;var _tetherMax=isOriginSide?_offset+referenceRect[_len]+popperRect[_len]-_offsetModifierValue-normalizedTetherOffsetValue.altAxis:_max;var _preventedOffset=tether&&isOriginSide?withinMaxClamp(_tetherMin,_offset,_tetherMax):within(tether?_tetherMin:_min,_offset,tether?_tetherMax:_max);popperOffsets[altAxis]=_preventedOffset;data[altAxis]=_preventedOffset-_offset;}
state.modifiersData[name]=data;}
const preventOverflow$1={name:'preventOverflow',enabled:true,phase:'main',fn:preventOverflow,requiresIfExists:['offset']};function getHTMLElementScroll(element){return{scrollLeft:element.scrollLeft,scrollTop:element.scrollTop};}
function getNodeScroll(node){if(node===getWindow(node)||!isHTMLElement(node)){return getWindowScroll(node);}else{return getHTMLElementScroll(node);}}
function isElementScaled(element){var rect=element.getBoundingClientRect();var scaleX=round(rect.width)/element.offsetWidth||1;var scaleY=round(rect.height)/element.offsetHeight||1;return scaleX!==1||scaleY!==1;}
function getCompositeRect(elementOrVirtualElement,offsetParent,isFixed){if(isFixed===void 0){isFixed=false;}
var isOffsetParentAnElement=isHTMLElement(offsetParent);var offsetParentIsScaled=isHTMLElement(offsetParent)&&isElementScaled(offsetParent);var documentElement=getDocumentElement(offsetParent);var rect=getBoundingClientRect(elementOrVirtualElement,offsetParentIsScaled,isFixed);var scroll={scrollLeft:0,scrollTop:0};var offsets={x:0,y:0};if(isOffsetParentAnElement||!isOffsetParentAnElement&&!isFixed){if(getNodeName(offsetParent)!=='body'||isScrollParent(documentElement)){scroll=getNodeScroll(offsetParent);}
if(isHTMLElement(offsetParent)){offsets=getBoundingClientRect(offsetParent,true);offsets.x+=offsetParent.clientLeft;offsets.y+=offsetParent.clientTop;}else if(documentElement){offsets.x=getWindowScrollBarX(documentElement);}}
return{x:rect.left+scroll.scrollLeft-offsets.x,y:rect.top+scroll.scrollTop-offsets.y,width:rect.width,height:rect.height};}
function order(modifiers){var map=new Map();var visited=new Set();var result=[];modifiers.forEach(function(modifier){map.set(modifier.name,modifier);});function sort(modifier){visited.add(modifier.name);var requires=[].concat(modifier.requires||[],modifier.requiresIfExists||[]);requires.forEach(function(dep){if(!visited.has(dep)){var depModifier=map.get(dep);if(depModifier){sort(depModifier);}}});result.push(modifier);}
modifiers.forEach(function(modifier){if(!visited.has(modifier.name)){sort(modifier);}});return result;}
function orderModifiers(modifiers){var orderedModifiers=order(modifiers);return modifierPhases.reduce(function(acc,phase){return acc.concat(orderedModifiers.filter(function(modifier){return modifier.phase===phase;}));},[]);}
function debounce(fn){var pending;return function(){if(!pending){pending=new Promise(function(resolve){Promise.resolve().then(function(){pending=undefined;resolve(fn());});});}
return pending;};}
function mergeByName(modifiers){var merged=modifiers.reduce(function(merged,current){var existing=merged[current.name];merged[current.name]=existing?Object.assign({},existing,current,{options:Object.assign({},existing.options,current.options),data:Object.assign({},existing.data,current.data)}):current;return merged;},{});return Object.keys(merged).map(function(key){return merged[key];});}
var DEFAULT_OPTIONS={placement:'bottom',modifiers:[],strategy:'absolute'};function areValidElements(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}
return!args.some(function(element){return!(element&&typeof element.getBoundingClientRect==='function');});}
function popperGenerator(generatorOptions){if(generatorOptions===void 0){generatorOptions={};}
var _generatorOptions=generatorOptions,_generatorOptions$def=_generatorOptions.defaultModifiers,defaultModifiers=_generatorOptions$def===void 0?[]:_generatorOptions$def,_generatorOptions$def2=_generatorOptions.defaultOptions,defaultOptions=_generatorOptions$def2===void 0?DEFAULT_OPTIONS:_generatorOptions$def2;return function createPopper(reference,popper,options){if(options===void 0){options=defaultOptions;}
var state={placement:'bottom',orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,defaultOptions),modifiersData:{},elements:{reference:reference,popper:popper},attributes:{},styles:{}};var effectCleanupFns=[];var isDestroyed=false;var instance={state:state,setOptions:function setOptions(setOptionsAction){var options=typeof setOptionsAction==='function'?setOptionsAction(state.options):setOptionsAction;cleanupModifierEffects();state.options=Object.assign({},defaultOptions,state.options,options);state.scrollParents={reference:isElement(reference)?listScrollParents(reference):reference.contextElement?listScrollParents(reference.contextElement):[],popper:listScrollParents(popper)};var orderedModifiers=orderModifiers(mergeByName([].concat(defaultModifiers,state.options.modifiers)));state.orderedModifiers=orderedModifiers.filter(function(m){return m.enabled;});runModifierEffects();return instance.update();},forceUpdate:function forceUpdate(){if(isDestroyed){return;}
var _state$elements=state.elements,reference=_state$elements.reference,popper=_state$elements.popper;if(!areValidElements(reference,popper)){return;}
state.rects={reference:getCompositeRect(reference,getOffsetParent(popper),state.options.strategy==='fixed'),popper:getLayoutRect(popper)};state.reset=false;state.placement=state.options.placement;state.orderedModifiers.forEach(function(modifier){return state.modifiersData[modifier.name]=Object.assign({},modifier.data);});for(var index=0;index<state.orderedModifiers.length;index++){if(state.reset===true){state.reset=false;index=-1;continue;}
var _state$orderedModifie=state.orderedModifiers[index],fn=_state$orderedModifie.fn,_state$orderedModifie2=_state$orderedModifie.options,_options=_state$orderedModifie2===void 0?{}:_state$orderedModifie2,name=_state$orderedModifie.name;if(typeof fn==='function'){state=fn({state:state,options:_options,name:name,instance:instance})||state;}}},update:debounce(function(){return new Promise(function(resolve){instance.forceUpdate();resolve(state);});}),destroy:function destroy(){cleanupModifierEffects();isDestroyed=true;}};if(!areValidElements(reference,popper)){return instance;}
instance.setOptions(options).then(function(state){if(!isDestroyed&&options.onFirstUpdate){options.onFirstUpdate(state);}});function runModifierEffects(){state.orderedModifiers.forEach(function(_ref3){var name=_ref3.name,_ref3$options=_ref3.options,options=_ref3$options===void 0?{}:_ref3$options,effect=_ref3.effect;if(typeof effect==='function'){var cleanupFn=effect({state:state,name:name,instance:instance,options:options});var noopFn=function noopFn(){};effectCleanupFns.push(cleanupFn||noopFn);}});}
function cleanupModifierEffects(){effectCleanupFns.forEach(function(fn){return fn();});effectCleanupFns=[];}
return instance;};}
var createPopper$2=popperGenerator();var defaultModifiers$1=[eventListeners,popperOffsets$1,computeStyles$1,applyStyles$1];var createPopper$1=popperGenerator({defaultModifiers:defaultModifiers$1});var defaultModifiers=[eventListeners,popperOffsets$1,computeStyles$1,applyStyles$1,offset$1,flip$1,preventOverflow$1,arrow$1,hide$1];var createPopper=popperGenerator({defaultModifiers:defaultModifiers});const Popper=Object.freeze(Object.defineProperty({__proto__:null,popperGenerator,detectOverflow,createPopperBase:createPopper$2,createPopper,createPopperLite:createPopper$1,top,bottom,right,left,auto,basePlacements,start,end,clippingParents,viewport,popper,reference,variationPlacements,placements,beforeRead,read,afterRead,beforeMain,main,afterMain,beforeWrite,write,afterWrite,modifierPhases,applyStyles:applyStyles$1,arrow:arrow$1,computeStyles:computeStyles$1,eventListeners,flip:flip$1,hide:hide$1,offset:offset$1,popperOffsets:popperOffsets$1,preventOverflow:preventOverflow$1},Symbol.toStringTag,{value:'Module'}));const NAME$a='dropdown';const DATA_KEY$6='bs.dropdown';const EVENT_KEY$6=`.${DATA_KEY$6}`;const DATA_API_KEY$3='.data-api';const ESCAPE_KEY$2='Escape';const TAB_KEY$1='Tab';const ARROW_UP_KEY$1='ArrowUp';const ARROW_DOWN_KEY$1='ArrowDown';const RIGHT_MOUSE_BUTTON=2;const EVENT_HIDE$5=`hide${EVENT_KEY$6}`;const EVENT_HIDDEN$5=`hidden${EVENT_KEY$6}`;const EVENT_SHOW$5=`show${EVENT_KEY$6}`;const EVENT_SHOWN$5=`shown${EVENT_KEY$6}`;const EVENT_CLICK_DATA_API$3=`click${EVENT_KEY$6}${DATA_API_KEY$3}`;const EVENT_KEYDOWN_DATA_API=`keydown${EVENT_KEY$6}${DATA_API_KEY$3}`;const EVENT_KEYUP_DATA_API=`keyup${EVENT_KEY$6}${DATA_API_KEY$3}`;const CLASS_NAME_SHOW$6='show';const CLASS_NAME_DROPUP='dropup';const CLASS_NAME_DROPEND='dropend';const CLASS_NAME_DROPSTART='dropstart';const CLASS_NAME_DROPUP_CENTER='dropup-center';const CLASS_NAME_DROPDOWN_CENTER='dropdown-center';const SELECTOR_DATA_TOGGLE$3='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)';const SELECTOR_DATA_TOGGLE_SHOWN=`${SELECTOR_DATA_TOGGLE$3}.${CLASS_NAME_SHOW$6}`;const SELECTOR_MENU='.dropdown-menu';const SELECTOR_NAVBAR='.navbar';const SELECTOR_NAVBAR_NAV='.navbar-nav';const SELECTOR_VISIBLE_ITEMS='.dropdown-menu .dropdown-item:not(.disabled):not(:disabled)';const PLACEMENT_TOP=isRTL()?'top-end':'top-start';const PLACEMENT_TOPEND=isRTL()?'top-start':'top-end';const PLACEMENT_BOTTOM=isRTL()?'bottom-end':'bottom-start';const PLACEMENT_BOTTOMEND=isRTL()?'bottom-start':'bottom-end';const PLACEMENT_RIGHT=isRTL()?'left-start':'right-start';const PLACEMENT_LEFT=isRTL()?'right-start':'left-start';const PLACEMENT_TOPCENTER='top';const PLACEMENT_BOTTOMCENTER='bottom';const Default$9={autoClose:true,boundary:'clippingParents',display:'dynamic',offset:[0,2],popperConfig:null,reference:'toggle'};const DefaultType$9={autoClose:'(boolean|string)',boundary:'(string|element)',display:'string',offset:'(array|string|function)',popperConfig:'(null|object|function)',reference:'(string|element|object)'};class Dropdown extends BaseComponent{constructor(element,config){super(element,config);this._popper=null;this._parent=this._element.parentNode;this._menu=SelectorEngine.next(this._element,SELECTOR_MENU)[0]||SelectorEngine.prev(this._element,SELECTOR_MENU)[0]||SelectorEngine.findOne(SELECTOR_MENU,this._parent);this._inNavbar=this._detectNavbar();}
static get Default(){return Default$9;}
static get DefaultType(){return DefaultType$9;}
static get NAME(){return NAME$a;}
toggle(){return this._isShown()?this.hide():this.show();}
show(){if(isDisabled(this._element)||this._isShown()){return;}
const relatedTarget={relatedTarget:this._element};const showEvent=EventHandler.trigger(this._element,EVENT_SHOW$5,relatedTarget);if(showEvent.defaultPrevented){return;}
this._createPopper();if('ontouchstart'in document.documentElement&&!this._parent.closest(SELECTOR_NAVBAR_NAV)){for(const element of[].concat(...document.body.children)){EventHandler.on(element,'mouseover',noop);}}
this._element.focus();this._element.setAttribute('aria-expanded',true);this._menu.classList.add(CLASS_NAME_SHOW$6);this._element.classList.add(CLASS_NAME_SHOW$6);EventHandler.trigger(this._element,EVENT_SHOWN$5,relatedTarget);}
hide(){if(isDisabled(this._element)||!this._isShown()){return;}
const relatedTarget={relatedTarget:this._element};this._completeHide(relatedTarget);}
dispose(){if(this._popper){this._popper.destroy();}
super.dispose();}
update(){this._inNavbar=this._detectNavbar();if(this._popper){this._popper.update();}}
_completeHide(relatedTarget){const hideEvent=EventHandler.trigger(this._element,EVENT_HIDE$5,relatedTarget);if(hideEvent.defaultPrevented){return;}
if('ontouchstart'in document.documentElement){for(const element of[].concat(...document.body.children)){EventHandler.off(element,'mouseover',noop);}}
if(this._popper){this._popper.destroy();}
this._menu.classList.remove(CLASS_NAME_SHOW$6);this._element.classList.remove(CLASS_NAME_SHOW$6);this._element.setAttribute('aria-expanded','false');Manipulator.removeDataAttribute(this._menu,'popper');EventHandler.trigger(this._element,EVENT_HIDDEN$5,relatedTarget);}
_getConfig(config){config=super._getConfig(config);if(typeof config.reference==='object'&&!isElement$1(config.reference)&&typeof config.reference.getBoundingClientRect!=='function'){throw new TypeError(`${NAME$a.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);}
return config;}
_createPopper(){if(typeof Popper==='undefined'){throw new TypeError('Bootstrap\'s dropdowns require Popper (https://popper.js.org)');}
let referenceElement=this._element;if(this._config.reference==='parent'){referenceElement=this._parent;}else if(isElement$1(this._config.reference)){referenceElement=getElement(this._config.reference);}else if(typeof this._config.reference==='object'){referenceElement=this._config.reference;}
const popperConfig=this._getPopperConfig();this._popper=createPopper(referenceElement,this._menu,popperConfig);}
_isShown(){return this._menu.classList.contains(CLASS_NAME_SHOW$6);}
_getPlacement(){const parentDropdown=this._parent;if(parentDropdown.classList.contains(CLASS_NAME_DROPEND)){return PLACEMENT_RIGHT;}
if(parentDropdown.classList.contains(CLASS_NAME_DROPSTART)){return PLACEMENT_LEFT;}
if(parentDropdown.classList.contains(CLASS_NAME_DROPUP_CENTER)){return PLACEMENT_TOPCENTER;}
if(parentDropdown.classList.contains(CLASS_NAME_DROPDOWN_CENTER)){return PLACEMENT_BOTTOMCENTER;}
const isEnd=getComputedStyle(this._menu).getPropertyValue('--bs-position').trim()==='end';if(parentDropdown.classList.contains(CLASS_NAME_DROPUP)){return isEnd?PLACEMENT_TOPEND:PLACEMENT_TOP;}
return isEnd?PLACEMENT_BOTTOMEND:PLACEMENT_BOTTOM;}
_detectNavbar(){return this._element.closest(SELECTOR_NAVBAR)!==null;}
_getOffset(){const{offset}=this._config;if(typeof offset==='string'){return offset.split(',').map(value=>Number.parseInt(value,10));}
if(typeof offset==='function'){return popperData=>offset(popperData,this._element);}
return offset;}
_getPopperConfig(){const defaultBsPopperConfig={placement:this._getPlacement(),modifiers:[{name:'preventOverflow',options:{boundary:this._config.boundary}},{name:'offset',options:{offset:this._getOffset()}}]};if(this._inNavbar||this._config.display==='static'){Manipulator.setDataAttribute(this._menu,'popper','static');defaultBsPopperConfig.modifiers=[{name:'applyStyles',enabled:false}];}
return{...defaultBsPopperConfig,...(typeof this._config.popperConfig==='function'?this._config.popperConfig(defaultBsPopperConfig):this._config.popperConfig)};}
_selectMenuItem({key,target}){const items=SelectorEngine.find(SELECTOR_VISIBLE_ITEMS,this._menu).filter(element=>isVisible(element));if(!items.length){return;}
getNextActiveElement(items,target,key===ARROW_DOWN_KEY$1,!items.includes(target)).focus();}
static jQueryInterface(config){return this.each(function(){const data=Dropdown.getOrCreateInstance(this,config);if(typeof config!=='string'){return;}
if(typeof data[config]==='undefined'){throw new TypeError(`No method named "${config}"`);}
data[config]();});}
static clearMenus(event){if(event.button===RIGHT_MOUSE_BUTTON||event.type==='keyup'&&event.key!==TAB_KEY$1){return;}
const openToggles=SelectorEngine.find(SELECTOR_DATA_TOGGLE_SHOWN);for(const toggle of openToggles){const context=Dropdown.getInstance(toggle);if(!context||context._config.autoClose===false){continue;}
const composedPath=event.composedPath();const isMenuTarget=composedPath.includes(context._menu);if(composedPath.includes(context._element)||context._config.autoClose==='inside'&&!isMenuTarget||context._config.autoClose==='outside'&&isMenuTarget){continue;}
if(context._menu.contains(event.target)&&(event.type==='keyup'&&event.key===TAB_KEY$1||/input|select|option|textarea|form/i.test(event.target.tagName))){continue;}
const relatedTarget={relatedTarget:context._element};if(event.type==='click'){relatedTarget.clickEvent=event;}
context._completeHide(relatedTarget);}}
static dataApiKeydownHandler(event){const isInput=/input|textarea/i.test(event.target.tagName);const isEscapeEvent=event.key===ESCAPE_KEY$2;const isUpOrDownEvent=[ARROW_UP_KEY$1,ARROW_DOWN_KEY$1].includes(event.key);if(!isUpOrDownEvent&&!isEscapeEvent){return;}
if(isInput&&!isEscapeEvent){return;}
event.preventDefault();const getToggleButton=this.matches(SELECTOR_DATA_TOGGLE$3)?this:SelectorEngine.prev(this,SELECTOR_DATA_TOGGLE$3)[0]||SelectorEngine.next(this,SELECTOR_DATA_TOGGLE$3)[0]||SelectorEngine.findOne(SELECTOR_DATA_TOGGLE$3,event.delegateTarget.parentNode);const instance=Dropdown.getOrCreateInstance(getToggleButton);if(isUpOrDownEvent){event.stopPropagation();instance.show();instance._selectMenuItem(event);return;}
if(instance._isShown()){event.stopPropagation();instance.hide();getToggleButton.focus();}}}
EventHandler.on(document,EVENT_KEYDOWN_DATA_API,SELECTOR_DATA_TOGGLE$3,Dropdown.dataApiKeydownHandler);EventHandler.on(document,EVENT_KEYDOWN_DATA_API,SELECTOR_MENU,Dropdown.dataApiKeydownHandler);EventHandler.on(document,EVENT_CLICK_DATA_API$3,Dropdown.clearMenus);EventHandler.on(document,EVENT_KEYUP_DATA_API,Dropdown.clearMenus);EventHandler.on(document,EVENT_CLICK_DATA_API$3,SELECTOR_DATA_TOGGLE$3,function(event){event.preventDefault();Dropdown.getOrCreateInstance(this).toggle();});defineJQueryPlugin(Dropdown);const SELECTOR_FIXED_CONTENT='.fixed-top, .fixed-bottom, .is-fixed, .sticky-top';const SELECTOR_STICKY_CONTENT='.sticky-top';const PROPERTY_PADDING='padding-right';const PROPERTY_MARGIN='margin-right';class ScrollBarHelper{constructor(){this._element=document.body;}
getWidth(){const documentWidth=document.documentElement.clientWidth;return Math.abs(window.innerWidth-documentWidth);}
hide(){const width=this.getWidth();this._disableOverFlow();this._setElementAttributes(this._element,PROPERTY_PADDING,calculatedValue=>calculatedValue+width);this._setElementAttributes(SELECTOR_FIXED_CONTENT,PROPERTY_PADDING,calculatedValue=>calculatedValue+width);this._setElementAttributes(SELECTOR_STICKY_CONTENT,PROPERTY_MARGIN,calculatedValue=>calculatedValue-width);}
reset(){this._resetElementAttributes(this._element,'overflow');this._resetElementAttributes(this._element,PROPERTY_PADDING);this._resetElementAttributes(SELECTOR_FIXED_CONTENT,PROPERTY_PADDING);this._resetElementAttributes(SELECTOR_STICKY_CONTENT,PROPERTY_MARGIN);}
isOverflowing(){return this.getWidth()>0;}
_disableOverFlow(){this._saveInitialAttribute(this._element,'overflow');this._element.style.overflow='hidden';}
_setElementAttributes(selector,styleProperty,callback){const scrollbarWidth=this.getWidth();const manipulationCallBack=element=>{if(element!==this._element&&window.innerWidth>element.clientWidth+scrollbarWidth){return;}
this._saveInitialAttribute(element,styleProperty);const calculatedValue=window.getComputedStyle(element).getPropertyValue(styleProperty);element.style.setProperty(styleProperty,`${callback(Number.parseFloat(calculatedValue))}px`);};this._applyManipulationCallback(selector,manipulationCallBack);}
_saveInitialAttribute(element,styleProperty){const actualValue=element.style.getPropertyValue(styleProperty);if(actualValue){Manipulator.setDataAttribute(element,styleProperty,actualValue);}}
_resetElementAttributes(selector,styleProperty){const manipulationCallBack=element=>{const value=Manipulator.getDataAttribute(element,styleProperty);if(value===null){element.style.removeProperty(styleProperty);return;}
Manipulator.removeDataAttribute(element,styleProperty);element.style.setProperty(styleProperty,value);};this._applyManipulationCallback(selector,manipulationCallBack);}
_applyManipulationCallback(selector,callBack){if(isElement$1(selector)){callBack(selector);return;}
for(const sel of SelectorEngine.find(selector,this._element)){callBack(sel);}}}
const NAME$9='backdrop';const CLASS_NAME_FADE$4='fade';const CLASS_NAME_SHOW$5='show';const EVENT_MOUSEDOWN=`mousedown.bs.${NAME$9}`;const Default$8={className:'modal-backdrop',clickCallback:null,isAnimated:false,isVisible:true,rootElement:'body'};const DefaultType$8={className:'string',clickCallback:'(function|null)',isAnimated:'boolean',isVisible:'boolean',rootElement:'(element|string)'};class Backdrop extends Config{constructor(config){super();this._config=this._getConfig(config);this._isAppended=false;this._element=null;}
static get Default(){return Default$8;}
static get DefaultType(){return DefaultType$8;}
static get NAME(){return NAME$9;}
show(callback){if(!this._config.isVisible){execute(callback);return;}
this._append();const element=this._getElement();if(this._config.isAnimated){reflow(element);}
element.classList.add(CLASS_NAME_SHOW$5);this._emulateAnimation(()=>{execute(callback);});}
hide(callback){if(!this._config.isVisible){execute(callback);return;}
this._getElement().classList.remove(CLASS_NAME_SHOW$5);this._emulateAnimation(()=>{this.dispose();execute(callback);});}
dispose(){if(!this._isAppended){return;}
EventHandler.off(this._element,EVENT_MOUSEDOWN);this._element.remove();this._isAppended=false;}
_getElement(){if(!this._element){const backdrop=document.createElement('div');backdrop.className=this._config.className;if(this._config.isAnimated){backdrop.classList.add(CLASS_NAME_FADE$4);}
this._element=backdrop;}
return this._element;}
_configAfterMerge(config){config.rootElement=getElement(config.rootElement);return config;}
_append(){if(this._isAppended){return;}
const element=this._getElement();this._config.rootElement.append(element);EventHandler.on(element,EVENT_MOUSEDOWN,()=>{execute(this._config.clickCallback);});this._isAppended=true;}
_emulateAnimation(callback){executeAfterTransition(callback,this._getElement(),this._config.isAnimated);}}
const NAME$8='focustrap';const DATA_KEY$5='bs.focustrap';const EVENT_KEY$5=`.${DATA_KEY$5}`;const EVENT_FOCUSIN$2=`focusin${EVENT_KEY$5}`;const EVENT_KEYDOWN_TAB=`keydown.tab${EVENT_KEY$5}`;const TAB_KEY='Tab';const TAB_NAV_FORWARD='forward';const TAB_NAV_BACKWARD='backward';const Default$7={autofocus:true,trapElement:null};const DefaultType$7={autofocus:'boolean',trapElement:'element'};class FocusTrap extends Config{constructor(config){super();this._config=this._getConfig(config);this._isActive=false;this._lastTabNavDirection=null;}
static get Default(){return Default$7;}
static get DefaultType(){return DefaultType$7;}
static get NAME(){return NAME$8;}
activate(){if(this._isActive){return;}
if(this._config.autofocus){this._config.trapElement.focus();}
EventHandler.off(document,EVENT_KEY$5);EventHandler.on(document,EVENT_FOCUSIN$2,event=>this._handleFocusin(event));EventHandler.on(document,EVENT_KEYDOWN_TAB,event=>this._handleKeydown(event));this._isActive=true;}
deactivate(){if(!this._isActive){return;}
this._isActive=false;EventHandler.off(document,EVENT_KEY$5);}
_handleFocusin(event){const{trapElement}=this._config;if(event.target===document||event.target===trapElement||trapElement.contains(event.target)){return;}
const elements=SelectorEngine.focusableChildren(trapElement);if(elements.length===0){trapElement.focus();}else if(this._lastTabNavDirection===TAB_NAV_BACKWARD){elements[elements.length-1].focus();}else{elements[0].focus();}}
_handleKeydown(event){if(event.key!==TAB_KEY){return;}
this._lastTabNavDirection=event.shiftKey?TAB_NAV_BACKWARD:TAB_NAV_FORWARD;}}
const NAME$7='modal';const DATA_KEY$4='bs.modal';const EVENT_KEY$4=`.${DATA_KEY$4}`;const DATA_API_KEY$2='.data-api';const ESCAPE_KEY$1='Escape';const EVENT_HIDE$4=`hide${EVENT_KEY$4}`;const EVENT_HIDE_PREVENTED$1=`hidePrevented${EVENT_KEY$4}`;const EVENT_HIDDEN$4=`hidden${EVENT_KEY$4}`;const EVENT_SHOW$4=`show${EVENT_KEY$4}`;const EVENT_SHOWN$4=`shown${EVENT_KEY$4}`;const EVENT_RESIZE$1=`resize${EVENT_KEY$4}`;const EVENT_CLICK_DISMISS=`click.dismiss${EVENT_KEY$4}`;const EVENT_MOUSEDOWN_DISMISS=`mousedown.dismiss${EVENT_KEY$4}`;const EVENT_KEYDOWN_DISMISS$1=`keydown.dismiss${EVENT_KEY$4}`;const EVENT_CLICK_DATA_API$2=`click${EVENT_KEY$4}${DATA_API_KEY$2}`;const CLASS_NAME_OPEN='modal-open';const CLASS_NAME_FADE$3='fade';const CLASS_NAME_SHOW$4='show';const CLASS_NAME_STATIC='modal-static';const OPEN_SELECTOR$1='.modal.show';const SELECTOR_DIALOG='.modal-dialog';const SELECTOR_MODAL_BODY='.modal-body';const SELECTOR_DATA_TOGGLE$2='[data-bs-toggle="modal"]';const Default$6={backdrop:true,focus:true,keyboard:true};const DefaultType$6={backdrop:'(boolean|string)',focus:'boolean',keyboard:'boolean'};class Modal extends BaseComponent{constructor(element,config){super(element,config);this._dialog=SelectorEngine.findOne(SELECTOR_DIALOG,this._element);this._backdrop=this._initializeBackDrop();this._focustrap=this._initializeFocusTrap();this._isShown=false;this._isTransitioning=false;this._scrollBar=new ScrollBarHelper();this._addEventListeners();}
static get Default(){return Default$6;}
static get DefaultType(){return DefaultType$6;}
static get NAME(){return NAME$7;}
toggle(relatedTarget){return this._isShown?this.hide():this.show(relatedTarget);}
show(relatedTarget){if(this._isShown||this._isTransitioning){return;}
const showEvent=EventHandler.trigger(this._element,EVENT_SHOW$4,{relatedTarget});if(showEvent.defaultPrevented){return;}
this._isShown=true;this._isTransitioning=true;this._scrollBar.hide();document.body.classList.add(CLASS_NAME_OPEN);this._adjustDialog();this._backdrop.show(()=>this._showElement(relatedTarget));}
hide(){if(!this._isShown||this._isTransitioning){return;}
const hideEvent=EventHandler.trigger(this._element,EVENT_HIDE$4);if(hideEvent.defaultPrevented){return;}
this._isShown=false;this._isTransitioning=true;this._focustrap.deactivate();this._element.classList.remove(CLASS_NAME_SHOW$4);this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated());}
dispose(){for(const htmlElement of[window,this._dialog]){EventHandler.off(htmlElement,EVENT_KEY$4);}
this._backdrop.dispose();this._focustrap.deactivate();super.dispose();}
handleUpdate(){this._adjustDialog();}
_initializeBackDrop(){return new Backdrop({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()});}
_initializeFocusTrap(){return new FocusTrap({trapElement:this._element});}
_showElement(relatedTarget){if(!document.body.contains(this._element)){document.body.append(this._element);}
this._element.style.display='block';this._element.removeAttribute('aria-hidden');this._element.setAttribute('aria-modal',true);this._element.setAttribute('role','dialog');this._element.scrollTop=0;const modalBody=SelectorEngine.findOne(SELECTOR_MODAL_BODY,this._dialog);if(modalBody){modalBody.scrollTop=0;}
reflow(this._element);this._element.classList.add(CLASS_NAME_SHOW$4);const transitionComplete=()=>{if(this._config.focus){this._focustrap.activate();}
this._isTransitioning=false;EventHandler.trigger(this._element,EVENT_SHOWN$4,{relatedTarget});};this._queueCallback(transitionComplete,this._dialog,this._isAnimated());}
_addEventListeners(){EventHandler.on(this._element,EVENT_KEYDOWN_DISMISS$1,event=>{if(event.key!==ESCAPE_KEY$1){return;}
if(this._config.keyboard){event.preventDefault();this.hide();return;}
this._triggerBackdropTransition();});EventHandler.on(window,EVENT_RESIZE$1,()=>{if(this._isShown&&!this._isTransitioning){this._adjustDialog();}});EventHandler.on(this._element,EVENT_MOUSEDOWN_DISMISS,event=>{EventHandler.one(this._element,EVENT_CLICK_DISMISS,event2=>{if(this._element!==event.target||this._element!==event2.target){return;}
if(this._config.backdrop==='static'){this._triggerBackdropTransition();return;}
if(this._config.backdrop){this.hide();}});});}
_hideModal(){this._element.style.display='none';this._element.setAttribute('aria-hidden',true);this._element.removeAttribute('aria-modal');this._element.removeAttribute('role');this._isTransitioning=false;this._backdrop.hide(()=>{document.body.classList.remove(CLASS_NAME_OPEN);this._resetAdjustments();this._scrollBar.reset();EventHandler.trigger(this._element,EVENT_HIDDEN$4);});}
_isAnimated(){return this._element.classList.contains(CLASS_NAME_FADE$3);}
_triggerBackdropTransition(){const hideEvent=EventHandler.trigger(this._element,EVENT_HIDE_PREVENTED$1);if(hideEvent.defaultPrevented){return;}
const isModalOverflowing=this._element.scrollHeight>document.documentElement.clientHeight;const initialOverflowY=this._element.style.overflowY;if(initialOverflowY==='hidden'||this._element.classList.contains(CLASS_NAME_STATIC)){return;}
if(!isModalOverflowing){this._element.style.overflowY='hidden';}
this._element.classList.add(CLASS_NAME_STATIC);this._queueCallback(()=>{this._element.classList.remove(CLASS_NAME_STATIC);this._queueCallback(()=>{this._element.style.overflowY=initialOverflowY;},this._dialog);},this._dialog);this._element.focus();}
_adjustDialog(){const isModalOverflowing=this._element.scrollHeight>document.documentElement.clientHeight;const scrollbarWidth=this._scrollBar.getWidth();const isBodyOverflowing=scrollbarWidth>0;if(isBodyOverflowing&&!isModalOverflowing){const property=isRTL()?'paddingLeft':'paddingRight';this._element.style[property]=`${scrollbarWidth}px`;}
if(!isBodyOverflowing&&isModalOverflowing){const property=isRTL()?'paddingRight':'paddingLeft';this._element.style[property]=`${scrollbarWidth}px`;}}
_resetAdjustments(){this._element.style.paddingLeft='';this._element.style.paddingRight='';}
static jQueryInterface(config,relatedTarget){return this.each(function(){const data=Modal.getOrCreateInstance(this,config);if(typeof config!=='string'){return;}
if(typeof data[config]==='undefined'){throw new TypeError(`No method named "${config}"`);}
data[config](relatedTarget);});}}
EventHandler.on(document,EVENT_CLICK_DATA_API$2,SELECTOR_DATA_TOGGLE$2,function(event){const target=getElementFromSelector(this);if(['A','AREA'].includes(this.tagName)){event.preventDefault();}
EventHandler.one(target,EVENT_SHOW$4,showEvent=>{if(showEvent.defaultPrevented){return;}
EventHandler.one(target,EVENT_HIDDEN$4,()=>{if(isVisible(this)){this.focus();}});});const alreadyOpen=SelectorEngine.findOne(OPEN_SELECTOR$1);if(alreadyOpen){Modal.getInstance(alreadyOpen).hide();}
const data=Modal.getOrCreateInstance(target);data.toggle(this);});enableDismissTrigger(Modal);defineJQueryPlugin(Modal);const NAME$6='offcanvas';const DATA_KEY$3='bs.offcanvas';const EVENT_KEY$3=`.${DATA_KEY$3}`;const DATA_API_KEY$1='.data-api';const EVENT_LOAD_DATA_API$2=`load${EVENT_KEY$3}${DATA_API_KEY$1}`;const ESCAPE_KEY='Escape';const CLASS_NAME_SHOW$3='show';const CLASS_NAME_SHOWING$1='showing';const CLASS_NAME_HIDING='hiding';const CLASS_NAME_BACKDROP='offcanvas-backdrop';const OPEN_SELECTOR='.offcanvas.show';const EVENT_SHOW$3=`show${EVENT_KEY$3}`;const EVENT_SHOWN$3=`shown${EVENT_KEY$3}`;const EVENT_HIDE$3=`hide${EVENT_KEY$3}`;const EVENT_HIDE_PREVENTED=`hidePrevented${EVENT_KEY$3}`;const EVENT_HIDDEN$3=`hidden${EVENT_KEY$3}`;const EVENT_RESIZE=`resize${EVENT_KEY$3}`;const EVENT_CLICK_DATA_API$1=`click${EVENT_KEY$3}${DATA_API_KEY$1}`;const EVENT_KEYDOWN_DISMISS=`keydown.dismiss${EVENT_KEY$3}`;const SELECTOR_DATA_TOGGLE$1='[data-bs-toggle="offcanvas"]';const Default$5={backdrop:true,keyboard:true,scroll:false};const DefaultType$5={backdrop:'(boolean|string)',keyboard:'boolean',scroll:'boolean'};class Offcanvas extends BaseComponent{constructor(element,config){super(element,config);this._isShown=false;this._backdrop=this._initializeBackDrop();this._focustrap=this._initializeFocusTrap();this._addEventListeners();}
static get Default(){return Default$5;}
static get DefaultType(){return DefaultType$5;}
static get NAME(){return NAME$6;}
toggle(relatedTarget){return this._isShown?this.hide():this.show(relatedTarget);}
show(relatedTarget){if(this._isShown){return;}
const showEvent=EventHandler.trigger(this._element,EVENT_SHOW$3,{relatedTarget});if(showEvent.defaultPrevented){return;}
this._isShown=true;this._backdrop.show();if(!this._config.scroll){new ScrollBarHelper().hide();}
this._element.setAttribute('aria-modal',true);this._element.setAttribute('role','dialog');this._element.classList.add(CLASS_NAME_SHOWING$1);const completeCallBack=()=>{if(!this._config.scroll||this._config.backdrop){this._focustrap.activate();}
this._element.classList.add(CLASS_NAME_SHOW$3);this._element.classList.remove(CLASS_NAME_SHOWING$1);EventHandler.trigger(this._element,EVENT_SHOWN$3,{relatedTarget});};this._queueCallback(completeCallBack,this._element,true);}
hide(){if(!this._isShown){return;}
const hideEvent=EventHandler.trigger(this._element,EVENT_HIDE$3);if(hideEvent.defaultPrevented){return;}
this._focustrap.deactivate();this._element.blur();this._isShown=false;this._element.classList.add(CLASS_NAME_HIDING);this._backdrop.hide();const completeCallback=()=>{this._element.classList.remove(CLASS_NAME_SHOW$3,CLASS_NAME_HIDING);this._element.removeAttribute('aria-modal');this._element.removeAttribute('role');if(!this._config.scroll){new ScrollBarHelper().reset();}
EventHandler.trigger(this._element,EVENT_HIDDEN$3);};this._queueCallback(completeCallback,this._element,true);}
dispose(){this._backdrop.dispose();this._focustrap.deactivate();super.dispose();}
_initializeBackDrop(){const clickCallback=()=>{if(this._config.backdrop==='static'){EventHandler.trigger(this._element,EVENT_HIDE_PREVENTED);return;}
this.hide();};const isVisible=Boolean(this._config.backdrop);return new Backdrop({className:CLASS_NAME_BACKDROP,isVisible,isAnimated:true,rootElement:this._element.parentNode,clickCallback:isVisible?clickCallback:null});}
_initializeFocusTrap(){return new FocusTrap({trapElement:this._element});}
_addEventListeners(){EventHandler.on(this._element,EVENT_KEYDOWN_DISMISS,event=>{if(event.key!==ESCAPE_KEY){return;}
if(!this._config.keyboard){EventHandler.trigger(this._element,EVENT_HIDE_PREVENTED);return;}
this.hide();});}
static jQueryInterface(config){return this.each(function(){const data=Offcanvas.getOrCreateInstance(this,config);if(typeof config!=='string'){return;}
if(data[config]===undefined||config.startsWith('_')||config==='constructor'){throw new TypeError(`No method named "${config}"`);}
data[config](this);});}}
EventHandler.on(document,EVENT_CLICK_DATA_API$1,SELECTOR_DATA_TOGGLE$1,function(event){const target=getElementFromSelector(this);if(['A','AREA'].includes(this.tagName)){event.preventDefault();}
if(isDisabled(this)){return;}
EventHandler.one(target,EVENT_HIDDEN$3,()=>{if(isVisible(this)){this.focus();}});const alreadyOpen=SelectorEngine.findOne(OPEN_SELECTOR);if(alreadyOpen&&alreadyOpen!==target){Offcanvas.getInstance(alreadyOpen).hide();}
const data=Offcanvas.getOrCreateInstance(target);data.toggle(this);});EventHandler.on(window,EVENT_LOAD_DATA_API$2,()=>{for(const selector of SelectorEngine.find(OPEN_SELECTOR)){Offcanvas.getOrCreateInstance(selector).show();}});EventHandler.on(window,EVENT_RESIZE,()=>{for(const element of SelectorEngine.find('[aria-modal][class*=show][class*=offcanvas-]')){if(getComputedStyle(element).position!=='fixed'){Offcanvas.getOrCreateInstance(element).hide();}}});enableDismissTrigger(Offcanvas);defineJQueryPlugin(Offcanvas);const uriAttributes=new Set(['background','cite','href','itemtype','longdesc','poster','src','xlink:href']);const ARIA_ATTRIBUTE_PATTERN=/^aria-[\w-]*$/i;const SAFE_URL_PATTERN=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^#&/:?]*(?:[#/?]|$))/i;const DATA_URL_PATTERN=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i;const allowedAttribute=(attribute,allowedAttributeList)=>{const attributeName=attribute.nodeName.toLowerCase();if(allowedAttributeList.includes(attributeName)){if(uriAttributes.has(attributeName)){return Boolean(SAFE_URL_PATTERN.test(attribute.nodeValue)||DATA_URL_PATTERN.test(attribute.nodeValue));}
return true;}
return allowedAttributeList.filter(attributeRegex=>attributeRegex instanceof RegExp).some(regex=>regex.test(attributeName));};const DefaultAllowlist={'*':['class','dir','id','lang','role',ARIA_ATTRIBUTE_PATTERN],a:['target','href','title','rel'],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:['src','srcset','alt','title','width','height'],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]};function sanitizeHtml(unsafeHtml,allowList,sanitizeFunction){if(!unsafeHtml.length){return unsafeHtml;}
if(sanitizeFunction&&typeof sanitizeFunction==='function'){return sanitizeFunction(unsafeHtml);}
const domParser=new window.DOMParser();const createdDocument=domParser.parseFromString(unsafeHtml,'text/html');const elements=[].concat(...createdDocument.body.querySelectorAll('*'));for(const element of elements){const elementName=element.nodeName.toLowerCase();if(!Object.keys(allowList).includes(elementName)){element.remove();continue;}
const attributeList=[].concat(...element.attributes);const allowedAttributes=[].concat(allowList['*']||[],allowList[elementName]||[]);for(const attribute of attributeList){if(!allowedAttribute(attribute,allowedAttributes)){element.removeAttribute(attribute.nodeName);}}}
return createdDocument.body.innerHTML;}
const NAME$5='TemplateFactory';const Default$4={allowList:DefaultAllowlist,content:{},extraClass:'',html:false,sanitize:true,sanitizeFn:null,template:'<div></div>'};const DefaultType$4={allowList:'object',content:'object',extraClass:'(string|function)',html:'boolean',sanitize:'boolean',sanitizeFn:'(null|function)',template:'string'};const DefaultContentType={entry:'(string|element|function|null)',selector:'(string|element)'};class TemplateFactory extends Config{constructor(config){super();this._config=this._getConfig(config);}
static get Default(){return Default$4;}
static get DefaultType(){return DefaultType$4;}
static get NAME(){return NAME$5;}
getContent(){return Object.values(this._config.content).map(config=>this._resolvePossibleFunction(config)).filter(Boolean);}
hasContent(){return this.getContent().length>0;}
changeContent(content){this._checkContent(content);this._config.content={...this._config.content,...content};return this;}
toHtml(){const templateWrapper=document.createElement('div');templateWrapper.innerHTML=this._maybeSanitize(this._config.template);for(const[selector,text]of Object.entries(this._config.content)){this._setContent(templateWrapper,text,selector);}
const template=templateWrapper.children[0];const extraClass=this._resolvePossibleFunction(this._config.extraClass);if(extraClass){template.classList.add(...extraClass.split(' '));}
return template;}
_typeCheckConfig(config){super._typeCheckConfig(config);this._checkContent(config.content);}
_checkContent(arg){for(const[selector,content]of Object.entries(arg)){super._typeCheckConfig({selector,entry:content},DefaultContentType);}}
_setContent(template,content,selector){const templateElement=SelectorEngine.findOne(selector,template);if(!templateElement){return;}
content=this._resolvePossibleFunction(content);if(!content){templateElement.remove();return;}
if(isElement$1(content)){this._putElementInTemplate(getElement(content),templateElement);return;}
if(this._config.html){templateElement.innerHTML=this._maybeSanitize(content);return;}
templateElement.textContent=content;}
_maybeSanitize(arg){return this._config.sanitize?sanitizeHtml(arg,this._config.allowList,this._config.sanitizeFn):arg;}
_resolvePossibleFunction(arg){return typeof arg==='function'?arg(this):arg;}
_putElementInTemplate(element,templateElement){if(this._config.html){templateElement.innerHTML='';templateElement.append(element);return;}
templateElement.textContent=element.textContent;}}
const NAME$4='tooltip';const DISALLOWED_ATTRIBUTES=new Set(['sanitize','allowList','sanitizeFn']);const CLASS_NAME_FADE$2='fade';const CLASS_NAME_MODAL='modal';const CLASS_NAME_SHOW$2='show';const SELECTOR_TOOLTIP_INNER='.tooltip-inner';const SELECTOR_MODAL=`.${CLASS_NAME_MODAL}`;const EVENT_MODAL_HIDE='hide.bs.modal';const TRIGGER_HOVER='hover';const TRIGGER_FOCUS='focus';const TRIGGER_CLICK='click';const TRIGGER_MANUAL='manual';const EVENT_HIDE$2='hide';const EVENT_HIDDEN$2='hidden';const EVENT_SHOW$2='show';const EVENT_SHOWN$2='shown';const EVENT_INSERTED='inserted';const EVENT_CLICK$1='click';const EVENT_FOCUSIN$1='focusin';const EVENT_FOCUSOUT$1='focusout';const EVENT_MOUSEENTER='mouseenter';const EVENT_MOUSELEAVE='mouseleave';const AttachmentMap={AUTO:'auto',TOP:'top',RIGHT:isRTL()?'left':'right',BOTTOM:'bottom',LEFT:isRTL()?'right':'left'};const Default$3={allowList:DefaultAllowlist,animation:true,boundary:'clippingParents',container:false,customClass:'',delay:0,fallbackPlacements:['top','right','bottom','left'],html:false,offset:[0,0],placement:'top',popperConfig:null,sanitize:true,sanitizeFn:null,selector:false,template:'<div class="tooltip" role="tooltip">'+'<div class="tooltip-arrow"></div>'+'<div class="tooltip-inner"></div>'+'</div>',title:'',trigger:'hover focus'};const DefaultType$3={allowList:'object',animation:'boolean',boundary:'(string|element)',container:'(string|element|boolean)',customClass:'(string|function)',delay:'(number|object)',fallbackPlacements:'array',html:'boolean',offset:'(array|string|function)',placement:'(string|function)',popperConfig:'(null|object|function)',sanitize:'boolean',sanitizeFn:'(null|function)',selector:'(string|boolean)',template:'string',title:'(string|element|function)',trigger:'string'};class Tooltip extends BaseComponent{constructor(element,config){if(typeof Popper==='undefined'){throw new TypeError('Bootstrap\'s tooltips require Popper (https://popper.js.org)');}
super(element,config);this._isEnabled=true;this._timeout=0;this._isHovered=null;this._activeTrigger={};this._popper=null;this._templateFactory=null;this._newContent=null;this.tip=null;this._setListeners();if(!this._config.selector){this._fixTitle();}}
static get Default(){return Default$3;}
static get DefaultType(){return DefaultType$3;}
static get NAME(){return NAME$4;}
enable(){this._isEnabled=true;}
disable(){this._isEnabled=false;}
toggleEnabled(){this._isEnabled=!this._isEnabled;}
toggle(){if(!this._isEnabled){return;}
this._activeTrigger.click=!this._activeTrigger.click;if(this._isShown()){this._leave();return;}
this._enter();}
dispose(){clearTimeout(this._timeout);EventHandler.off(this._element.closest(SELECTOR_MODAL),EVENT_MODAL_HIDE,this._hideModalHandler);if(this._element.getAttribute('data-bs-original-title')){this._element.setAttribute('title',this._element.getAttribute('data-bs-original-title'));}
this._disposePopper();super.dispose();}
show(){if(this._element.style.display==='none'){throw new Error('Please use show on visible elements');}
if(!(this._isWithContent()&&this._isEnabled)){return;}
const showEvent=EventHandler.trigger(this._element,this.constructor.eventName(EVENT_SHOW$2));const shadowRoot=findShadowRoot(this._element);const isInTheDom=(shadowRoot||this._element.ownerDocument.documentElement).contains(this._element);if(showEvent.defaultPrevented||!isInTheDom){return;}
this._disposePopper();const tip=this._getTipElement();this._element.setAttribute('aria-describedby',tip.getAttribute('id'));const{container}=this._config;if(!this._element.ownerDocument.documentElement.contains(this.tip)){container.append(tip);EventHandler.trigger(this._element,this.constructor.eventName(EVENT_INSERTED));}
this._popper=this._createPopper(tip);tip.classList.add(CLASS_NAME_SHOW$2);if('ontouchstart'in document.documentElement){for(const element of[].concat(...document.body.children)){EventHandler.on(element,'mouseover',noop);}}
const complete=()=>{EventHandler.trigger(this._element,this.constructor.eventName(EVENT_SHOWN$2));if(this._isHovered===false){this._leave();}
this._isHovered=false;};this._queueCallback(complete,this.tip,this._isAnimated());}
hide(){if(!this._isShown()){return;}
const hideEvent=EventHandler.trigger(this._element,this.constructor.eventName(EVENT_HIDE$2));if(hideEvent.defaultPrevented){return;}
const tip=this._getTipElement();tip.classList.remove(CLASS_NAME_SHOW$2);if('ontouchstart'in document.documentElement){for(const element of[].concat(...document.body.children)){EventHandler.off(element,'mouseover',noop);}}
this._activeTrigger[TRIGGER_CLICK]=false;this._activeTrigger[TRIGGER_FOCUS]=false;this._activeTrigger[TRIGGER_HOVER]=false;this._isHovered=null;const complete=()=>{if(this._isWithActiveTrigger()){return;}
if(!this._isHovered){this._disposePopper();}
this._element.removeAttribute('aria-describedby');EventHandler.trigger(this._element,this.constructor.eventName(EVENT_HIDDEN$2));};this._queueCallback(complete,this.tip,this._isAnimated());}
update(){if(this._popper){this._popper.update();}}
_isWithContent(){return Boolean(this._getTitle());}
_getTipElement(){if(!this.tip){this.tip=this._createTipElement(this._newContent||this._getContentForTemplate());}
return this.tip;}
_createTipElement(content){const tip=this._getTemplateFactory(content).toHtml();if(!tip){return null;}
tip.classList.remove(CLASS_NAME_FADE$2,CLASS_NAME_SHOW$2);tip.classList.add(`bs-${this.constructor.NAME}-auto`);const tipId=getUID(this.constructor.NAME).toString();tip.setAttribute('id',tipId);if(this._isAnimated()){tip.classList.add(CLASS_NAME_FADE$2);}
return tip;}
setContent(content){this._newContent=content;if(this._isShown()){this._disposePopper();this.show();}}
_getTemplateFactory(content){if(this._templateFactory){this._templateFactory.changeContent(content);}else{this._templateFactory=new TemplateFactory({...this._config,content,extraClass:this._resolvePossibleFunction(this._config.customClass)});}
return this._templateFactory;}
_getContentForTemplate(){return{[SELECTOR_TOOLTIP_INNER]:this._getTitle()};}
_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute('data-bs-original-title');}
_initializeOnDelegatedTarget(event){return this.constructor.getOrCreateInstance(event.delegateTarget,this._getDelegateConfig());}
_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(CLASS_NAME_FADE$2);}
_isShown(){return this.tip&&this.tip.classList.contains(CLASS_NAME_SHOW$2);}
_createPopper(tip){const placement=typeof this._config.placement==='function'?this._config.placement.call(this,tip,this._element):this._config.placement;const attachment=AttachmentMap[placement.toUpperCase()];return createPopper(this._element,tip,this._getPopperConfig(attachment));}
_getOffset(){const{offset}=this._config;if(typeof offset==='string'){return offset.split(',').map(value=>Number.parseInt(value,10));}
if(typeof offset==='function'){return popperData=>offset(popperData,this._element);}
return offset;}
_resolvePossibleFunction(arg){return typeof arg==='function'?arg.call(this._element):arg;}
_getPopperConfig(attachment){const defaultBsPopperConfig={placement:attachment,modifiers:[{name:'flip',options:{fallbackPlacements:this._config.fallbackPlacements}},{name:'offset',options:{offset:this._getOffset()}},{name:'preventOverflow',options:{boundary:this._config.boundary}},{name:'arrow',options:{element:`.${this.constructor.NAME}-arrow`}},{name:'preSetPlacement',enabled:true,phase:'beforeMain',fn:data=>{this._getTipElement().setAttribute('data-popper-placement',data.state.placement);}}]};return{...defaultBsPopperConfig,...(typeof this._config.popperConfig==='function'?this._config.popperConfig(defaultBsPopperConfig):this._config.popperConfig)};}
_setListeners(){const triggers=this._config.trigger.split(' ');for(const trigger of triggers){if(trigger==='click'){EventHandler.on(this._element,this.constructor.eventName(EVENT_CLICK$1),this._config.selector,event=>{const context=this._initializeOnDelegatedTarget(event);context.toggle();});}else if(trigger!==TRIGGER_MANUAL){const eventIn=trigger===TRIGGER_HOVER?this.constructor.eventName(EVENT_MOUSEENTER):this.constructor.eventName(EVENT_FOCUSIN$1);const eventOut=trigger===TRIGGER_HOVER?this.constructor.eventName(EVENT_MOUSELEAVE):this.constructor.eventName(EVENT_FOCUSOUT$1);EventHandler.on(this._element,eventIn,this._config.selector,event=>{const context=this._initializeOnDelegatedTarget(event);context._activeTrigger[event.type==='focusin'?TRIGGER_FOCUS:TRIGGER_HOVER]=true;context._enter();});EventHandler.on(this._element,eventOut,this._config.selector,event=>{const context=this._initializeOnDelegatedTarget(event);context._activeTrigger[event.type==='focusout'?TRIGGER_FOCUS:TRIGGER_HOVER]=context._element.contains(event.relatedTarget);context._leave();});}}
this._hideModalHandler=()=>{if(this._element){this.hide();}};EventHandler.on(this._element.closest(SELECTOR_MODAL),EVENT_MODAL_HIDE,this._hideModalHandler);}
_fixTitle(){const title=this._element.getAttribute('title');if(!title){return;}
if(!this._element.getAttribute('aria-label')&&!this._element.textContent.trim()){this._element.setAttribute('aria-label',title);}
this._element.setAttribute('data-bs-original-title',title);this._element.removeAttribute('title');}
_enter(){if(this._isShown()||this._isHovered){this._isHovered=true;return;}
this._isHovered=true;this._setTimeout(()=>{if(this._isHovered){this.show();}},this._config.delay.show);}
_leave(){if(this._isWithActiveTrigger()){return;}
this._isHovered=false;this._setTimeout(()=>{if(!this._isHovered){this.hide();}},this._config.delay.hide);}
_setTimeout(handler,timeout){clearTimeout(this._timeout);this._timeout=setTimeout(handler,timeout);}
_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(true);}
_getConfig(config){const dataAttributes=Manipulator.getDataAttributes(this._element);for(const dataAttribute of Object.keys(dataAttributes)){if(DISALLOWED_ATTRIBUTES.has(dataAttribute)){delete dataAttributes[dataAttribute];}}
config={...dataAttributes,...(typeof config==='object'&&config?config:{})};config=this._mergeConfigObj(config);config=this._configAfterMerge(config);this._typeCheckConfig(config);return config;}
_configAfterMerge(config){config.container=config.container===false?document.body:getElement(config.container);if(typeof config.delay==='number'){config.delay={show:config.delay,hide:config.delay};}
if(typeof config.title==='number'){config.title=config.title.toString();}
if(typeof config.content==='number'){config.content=config.content.toString();}
return config;}
_getDelegateConfig(){const config={};for(const key in this._config){if(this.constructor.Default[key]!==this._config[key]){config[key]=this._config[key];}}
config.selector=false;config.trigger='manual';return config;}
_disposePopper(){if(this._popper){this._popper.destroy();this._popper=null;}
if(this.tip){this.tip.remove();this.tip=null;}}
static jQueryInterface(config){return this.each(function(){const data=Tooltip.getOrCreateInstance(this,config);if(typeof config!=='string'){return;}
if(typeof data[config]==='undefined'){throw new TypeError(`No method named "${config}"`);}
data[config]();});}}
defineJQueryPlugin(Tooltip);const NAME$3='popover';const SELECTOR_TITLE='.popover-header';const SELECTOR_CONTENT='.popover-body';const Default$2={...Tooltip.Default,content:'',offset:[0,8],placement:'right',template:'<div class="popover" role="tooltip">'+'<div class="popover-arrow"></div>'+'<h3 class="popover-header"></h3>'+'<div class="popover-body"></div>'+'</div>',trigger:'click'};const DefaultType$2={...Tooltip.DefaultType,content:'(null|string|element|function)'};class Popover extends Tooltip{static get Default(){return Default$2;}
static get DefaultType(){return DefaultType$2;}
static get NAME(){return NAME$3;}
_isWithContent(){return this._getTitle()||this._getContent();}
_getContentForTemplate(){return{[SELECTOR_TITLE]:this._getTitle(),[SELECTOR_CONTENT]:this._getContent()};}
_getContent(){return this._resolvePossibleFunction(this._config.content);}
static jQueryInterface(config){return this.each(function(){const data=Popover.getOrCreateInstance(this,config);if(typeof config!=='string'){return;}
if(typeof data[config]==='undefined'){throw new TypeError(`No method named "${config}"`);}
data[config]();});}}
defineJQueryPlugin(Popover);const NAME$2='scrollspy';const DATA_KEY$2='bs.scrollspy';const EVENT_KEY$2=`.${DATA_KEY$2}`;const DATA_API_KEY='.data-api';const EVENT_ACTIVATE=`activate${EVENT_KEY$2}`;const EVENT_CLICK=`click${EVENT_KEY$2}`;const EVENT_LOAD_DATA_API$1=`load${EVENT_KEY$2}${DATA_API_KEY}`;const CLASS_NAME_DROPDOWN_ITEM='dropdown-item';const CLASS_NAME_ACTIVE$1='active';const SELECTOR_DATA_SPY='[data-bs-spy="scroll"]';const SELECTOR_TARGET_LINKS='[href]';const SELECTOR_NAV_LIST_GROUP='.nav, .list-group';const SELECTOR_NAV_LINKS='.nav-link';const SELECTOR_NAV_ITEMS='.nav-item';const SELECTOR_LIST_ITEMS='.list-group-item';const SELECTOR_LINK_ITEMS=`${SELECTOR_NAV_LINKS}, ${SELECTOR_NAV_ITEMS} > ${SELECTOR_NAV_LINKS}, ${SELECTOR_LIST_ITEMS}`;const SELECTOR_DROPDOWN='.dropdown';const SELECTOR_DROPDOWN_TOGGLE$1='.dropdown-toggle';const Default$1={offset:null,rootMargin:'0px 0px -25%',smoothScroll:false,target:null,threshold:[0.1,0.5,1]};const DefaultType$1={offset:'(number|null)',rootMargin:'string',smoothScroll:'boolean',target:'element',threshold:'array'};class ScrollSpy extends BaseComponent{constructor(element,config){super(element,config);this._targetLinks=new Map();this._observableSections=new Map();this._rootElement=getComputedStyle(this._element).overflowY==='visible'?null:this._element;this._activeTarget=null;this._observer=null;this._previousScrollData={visibleEntryTop:0,parentScrollTop:0};this.refresh();}
static get Default(){return Default$1;}
static get DefaultType(){return DefaultType$1;}
static get NAME(){return NAME$2;}
refresh(){this._initializeTargetsAndObservables();this._maybeEnableSmoothScroll();if(this._observer){this._observer.disconnect();}else{this._observer=this._getNewObserver();}
for(const section of this._observableSections.values()){this._observer.observe(section);}}
dispose(){this._observer.disconnect();super.dispose();}
_configAfterMerge(config){config.target=getElement(config.target)||document.body;config.rootMargin=config.offset?`${config.offset}px 0px -30%`:config.rootMargin;if(typeof config.threshold==='string'){config.threshold=config.threshold.split(',').map(value=>Number.parseFloat(value));}
return config;}
_maybeEnableSmoothScroll(){if(!this._config.smoothScroll){return;}
EventHandler.off(this._config.target,EVENT_CLICK);EventHandler.on(this._config.target,EVENT_CLICK,SELECTOR_TARGET_LINKS,event=>{const observableSection=this._observableSections.get(event.target.hash);if(observableSection){event.preventDefault();const root=this._rootElement||window;const height=observableSection.offsetTop-this._element.offsetTop;if(root.scrollTo){root.scrollTo({top:height,behavior:'smooth'});return;}
root.scrollTop=height;}});}
_getNewObserver(){const options={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(entries=>this._observerCallback(entries),options);}
_observerCallback(entries){const targetElement=entry=>this._targetLinks.get(`#${entry.target.id}`);const activate=entry=>{this._previousScrollData.visibleEntryTop=entry.target.offsetTop;this._process(targetElement(entry));};const parentScrollTop=(this._rootElement||document.documentElement).scrollTop;const userScrollsDown=parentScrollTop>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=parentScrollTop;for(const entry of entries){if(!entry.isIntersecting){this._activeTarget=null;this._clearActiveClass(targetElement(entry));continue;}
const entryIsLowerThanPrevious=entry.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(userScrollsDown&&entryIsLowerThanPrevious){activate(entry);if(!parentScrollTop){return;}
continue;}
if(!userScrollsDown&&!entryIsLowerThanPrevious){activate(entry);}}}
_initializeTargetsAndObservables(){this._targetLinks=new Map();this._observableSections=new Map();const targetLinks=SelectorEngine.find(SELECTOR_TARGET_LINKS,this._config.target);for(const anchor of targetLinks){if(!anchor.hash||isDisabled(anchor)){continue;}
const observableSection=SelectorEngine.findOne(anchor.hash,this._element);if(isVisible(observableSection)){this._targetLinks.set(anchor.hash,anchor);this._observableSections.set(anchor.hash,observableSection);}}}
_process(target){if(this._activeTarget===target){return;}
this._clearActiveClass(this._config.target);this._activeTarget=target;target.classList.add(CLASS_NAME_ACTIVE$1);this._activateParents(target);EventHandler.trigger(this._element,EVENT_ACTIVATE,{relatedTarget:target});}
_activateParents(target){if(target.classList.contains(CLASS_NAME_DROPDOWN_ITEM)){SelectorEngine.findOne(SELECTOR_DROPDOWN_TOGGLE$1,target.closest(SELECTOR_DROPDOWN)).classList.add(CLASS_NAME_ACTIVE$1);return;}
for(const listGroup of SelectorEngine.parents(target,SELECTOR_NAV_LIST_GROUP)){for(const item of SelectorEngine.prev(listGroup,SELECTOR_LINK_ITEMS)){item.classList.add(CLASS_NAME_ACTIVE$1);}}}
_clearActiveClass(parent){parent.classList.remove(CLASS_NAME_ACTIVE$1);const activeNodes=SelectorEngine.find(`${SELECTOR_TARGET_LINKS}.${CLASS_NAME_ACTIVE$1}`,parent);for(const node of activeNodes){node.classList.remove(CLASS_NAME_ACTIVE$1);}}
static jQueryInterface(config){return this.each(function(){const data=ScrollSpy.getOrCreateInstance(this,config);if(typeof config!=='string'){return;}
if(data[config]===undefined||config.startsWith('_')||config==='constructor'){throw new TypeError(`No method named "${config}"`);}
data[config]();});}}
EventHandler.on(window,EVENT_LOAD_DATA_API$1,()=>{for(const spy of SelectorEngine.find(SELECTOR_DATA_SPY)){ScrollSpy.getOrCreateInstance(spy);}});defineJQueryPlugin(ScrollSpy);const NAME$1='tab';const DATA_KEY$1='bs.tab';const EVENT_KEY$1=`.${DATA_KEY$1}`;const EVENT_HIDE$1=`hide${EVENT_KEY$1}`;const EVENT_HIDDEN$1=`hidden${EVENT_KEY$1}`;const EVENT_SHOW$1=`show${EVENT_KEY$1}`;const EVENT_SHOWN$1=`shown${EVENT_KEY$1}`;const EVENT_CLICK_DATA_API=`click${EVENT_KEY$1}`;const EVENT_KEYDOWN=`keydown${EVENT_KEY$1}`;const EVENT_LOAD_DATA_API=`load${EVENT_KEY$1}`;const ARROW_LEFT_KEY='ArrowLeft';const ARROW_RIGHT_KEY='ArrowRight';const ARROW_UP_KEY='ArrowUp';const ARROW_DOWN_KEY='ArrowDown';const CLASS_NAME_ACTIVE='active';const CLASS_NAME_FADE$1='fade';const CLASS_NAME_SHOW$1='show';const CLASS_DROPDOWN='dropdown';const SELECTOR_DROPDOWN_TOGGLE='.dropdown-toggle';const SELECTOR_DROPDOWN_MENU='.dropdown-menu';const NOT_SELECTOR_DROPDOWN_TOGGLE=':not(.dropdown-toggle)';const SELECTOR_TAB_PANEL='.list-group, .nav, [role="tablist"]';const SELECTOR_OUTER='.nav-item, .list-group-item';const SELECTOR_INNER=`.nav-link${NOT_SELECTOR_DROPDOWN_TOGGLE}, .list-group-item${NOT_SELECTOR_DROPDOWN_TOGGLE}, [role="tab"]${NOT_SELECTOR_DROPDOWN_TOGGLE}`;const SELECTOR_DATA_TOGGLE='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]';const SELECTOR_INNER_ELEM=`${SELECTOR_INNER}, ${SELECTOR_DATA_TOGGLE}`;const SELECTOR_DATA_TOGGLE_ACTIVE=`.${CLASS_NAME_ACTIVE}[data-bs-toggle="tab"], .${CLASS_NAME_ACTIVE}[data-bs-toggle="pill"], .${CLASS_NAME_ACTIVE}[data-bs-toggle="list"]`;class Tab extends BaseComponent{constructor(element){super(element);this._parent=this._element.closest(SELECTOR_TAB_PANEL);if(!this._parent){return;}
this._setInitialAttributes(this._parent,this._getChildren());EventHandler.on(this._element,EVENT_KEYDOWN,event=>this._keydown(event));}
static get NAME(){return NAME$1;}
show(){const innerElem=this._element;if(this._elemIsActive(innerElem)){return;}
const active=this._getActiveElem();const hideEvent=active?EventHandler.trigger(active,EVENT_HIDE$1,{relatedTarget:innerElem}):null;const showEvent=EventHandler.trigger(innerElem,EVENT_SHOW$1,{relatedTarget:active});if(showEvent.defaultPrevented||hideEvent&&hideEvent.defaultPrevented){return;}
this._deactivate(active,innerElem);this._activate(innerElem,active);}
_activate(element,relatedElem){if(!element){return;}
element.classList.add(CLASS_NAME_ACTIVE);this._activate(getElementFromSelector(element));const complete=()=>{if(element.getAttribute('role')!=='tab'){element.classList.add(CLASS_NAME_SHOW$1);return;}
element.removeAttribute('tabindex');element.setAttribute('aria-selected',true);this._toggleDropDown(element,true);EventHandler.trigger(element,EVENT_SHOWN$1,{relatedTarget:relatedElem});};this._queueCallback(complete,element,element.classList.contains(CLASS_NAME_FADE$1));}
_deactivate(element,relatedElem){if(!element){return;}
element.classList.remove(CLASS_NAME_ACTIVE);element.blur();this._deactivate(getElementFromSelector(element));const complete=()=>{if(element.getAttribute('role')!=='tab'){element.classList.remove(CLASS_NAME_SHOW$1);return;}
element.setAttribute('aria-selected',false);element.setAttribute('tabindex','-1');this._toggleDropDown(element,false);EventHandler.trigger(element,EVENT_HIDDEN$1,{relatedTarget:relatedElem});};this._queueCallback(complete,element,element.classList.contains(CLASS_NAME_FADE$1));}
_keydown(event){if(![ARROW_LEFT_KEY,ARROW_RIGHT_KEY,ARROW_UP_KEY,ARROW_DOWN_KEY].includes(event.key)){return;}
event.stopPropagation();event.preventDefault();const isNext=[ARROW_RIGHT_KEY,ARROW_DOWN_KEY].includes(event.key);const nextActiveElement=getNextActiveElement(this._getChildren().filter(element=>!isDisabled(element)),event.target,isNext,true);if(nextActiveElement){nextActiveElement.focus({preventScroll:true});Tab.getOrCreateInstance(nextActiveElement).show();}}
_getChildren(){return SelectorEngine.find(SELECTOR_INNER_ELEM,this._parent);}
_getActiveElem(){return this._getChildren().find(child=>this._elemIsActive(child))||null;}
_setInitialAttributes(parent,children){this._setAttributeIfNotExists(parent,'role','tablist');for(const child of children){this._setInitialAttributesOnChild(child);}}
_setInitialAttributesOnChild(child){child=this._getInnerElement(child);const isActive=this._elemIsActive(child);const outerElem=this._getOuterElement(child);child.setAttribute('aria-selected',isActive);if(outerElem!==child){this._setAttributeIfNotExists(outerElem,'role','presentation');}
if(!isActive){child.setAttribute('tabindex','-1');}
this._setAttributeIfNotExists(child,'role','tab');this._setInitialAttributesOnTargetPanel(child);}
_setInitialAttributesOnTargetPanel(child){const target=getElementFromSelector(child);if(!target){return;}
this._setAttributeIfNotExists(target,'role','tabpanel');if(child.id){this._setAttributeIfNotExists(target,'aria-labelledby',`#${child.id}`);}}
_toggleDropDown(element,open){const outerElem=this._getOuterElement(element);if(!outerElem.classList.contains(CLASS_DROPDOWN)){return;}
const toggle=(selector,className)=>{const element=SelectorEngine.findOne(selector,outerElem);if(element){element.classList.toggle(className,open);}};toggle(SELECTOR_DROPDOWN_TOGGLE,CLASS_NAME_ACTIVE);toggle(SELECTOR_DROPDOWN_MENU,CLASS_NAME_SHOW$1);outerElem.setAttribute('aria-expanded',open);}
_setAttributeIfNotExists(element,attribute,value){if(!element.hasAttribute(attribute)){element.setAttribute(attribute,value);}}
_elemIsActive(elem){return elem.classList.contains(CLASS_NAME_ACTIVE);}
_getInnerElement(elem){return elem.matches(SELECTOR_INNER_ELEM)?elem:SelectorEngine.findOne(SELECTOR_INNER_ELEM,elem);}
_getOuterElement(elem){return elem.closest(SELECTOR_OUTER)||elem;}
static jQueryInterface(config){return this.each(function(){const data=Tab.getOrCreateInstance(this);if(typeof config!=='string'){return;}
if(data[config]===undefined||config.startsWith('_')||config==='constructor'){throw new TypeError(`No method named "${config}"`);}
data[config]();});}}
EventHandler.on(document,EVENT_CLICK_DATA_API,SELECTOR_DATA_TOGGLE,function(event){if(['A','AREA'].includes(this.tagName)){event.preventDefault();}
if(isDisabled(this)){return;}
Tab.getOrCreateInstance(this).show();});EventHandler.on(window,EVENT_LOAD_DATA_API,()=>{for(const element of SelectorEngine.find(SELECTOR_DATA_TOGGLE_ACTIVE)){Tab.getOrCreateInstance(element);}});defineJQueryPlugin(Tab);const NAME='toast';const DATA_KEY='bs.toast';const EVENT_KEY=`.${DATA_KEY}`;const EVENT_MOUSEOVER=`mouseover${EVENT_KEY}`;const EVENT_MOUSEOUT=`mouseout${EVENT_KEY}`;const EVENT_FOCUSIN=`focusin${EVENT_KEY}`;const EVENT_FOCUSOUT=`focusout${EVENT_KEY}`;const EVENT_HIDE=`hide${EVENT_KEY}`;const EVENT_HIDDEN=`hidden${EVENT_KEY}`;const EVENT_SHOW=`show${EVENT_KEY}`;const EVENT_SHOWN=`shown${EVENT_KEY}`;const CLASS_NAME_FADE='fade';const CLASS_NAME_HIDE='hide';const CLASS_NAME_SHOW='show';const CLASS_NAME_SHOWING='showing';const DefaultType={animation:'boolean',autohide:'boolean',delay:'number'};const Default={animation:true,autohide:true,delay:5000};class Toast extends BaseComponent{constructor(element,config){super(element,config);this._timeout=null;this._hasMouseInteraction=false;this._hasKeyboardInteraction=false;this._setListeners();}
static get Default(){return Default;}
static get DefaultType(){return DefaultType;}
static get NAME(){return NAME;}
show(){const showEvent=EventHandler.trigger(this._element,EVENT_SHOW);if(showEvent.defaultPrevented){return;}
this._clearTimeout();if(this._config.animation){this._element.classList.add(CLASS_NAME_FADE);}
const complete=()=>{this._element.classList.remove(CLASS_NAME_SHOWING);EventHandler.trigger(this._element,EVENT_SHOWN);this._maybeScheduleHide();};this._element.classList.remove(CLASS_NAME_HIDE);reflow(this._element);this._element.classList.add(CLASS_NAME_SHOW,CLASS_NAME_SHOWING);this._queueCallback(complete,this._element,this._config.animation);}
hide(){if(!this.isShown()){return;}
const hideEvent=EventHandler.trigger(this._element,EVENT_HIDE);if(hideEvent.defaultPrevented){return;}
const complete=()=>{this._element.classList.add(CLASS_NAME_HIDE);this._element.classList.remove(CLASS_NAME_SHOWING,CLASS_NAME_SHOW);EventHandler.trigger(this._element,EVENT_HIDDEN);};this._element.classList.add(CLASS_NAME_SHOWING);this._queueCallback(complete,this._element,this._config.animation);}
dispose(){this._clearTimeout();if(this.isShown()){this._element.classList.remove(CLASS_NAME_SHOW);}
super.dispose();}
isShown(){return this._element.classList.contains(CLASS_NAME_SHOW);}
_maybeScheduleHide(){if(!this._config.autohide){return;}
if(this._hasMouseInteraction||this._hasKeyboardInteraction){return;}
this._timeout=setTimeout(()=>{this.hide();},this._config.delay);}
_onInteraction(event,isInteracting){switch(event.type){case'mouseover':case'mouseout':{this._hasMouseInteraction=isInteracting;break;}
case'focusin':case'focusout':{this._hasKeyboardInteraction=isInteracting;break;}}
if(isInteracting){this._clearTimeout();return;}
const nextElement=event.relatedTarget;if(this._element===nextElement||this._element.contains(nextElement)){return;}
this._maybeScheduleHide();}
_setListeners(){EventHandler.on(this._element,EVENT_MOUSEOVER,event=>this._onInteraction(event,true));EventHandler.on(this._element,EVENT_MOUSEOUT,event=>this._onInteraction(event,false));EventHandler.on(this._element,EVENT_FOCUSIN,event=>this._onInteraction(event,true));EventHandler.on(this._element,EVENT_FOCUSOUT,event=>this._onInteraction(event,false));}
_clearTimeout(){clearTimeout(this._timeout);this._timeout=null;}
static jQueryInterface(config){return this.each(function(){const data=Toast.getOrCreateInstance(this,config);if(typeof config==='string'){if(typeof data[config]==='undefined'){throw new TypeError(`No method named "${config}"`);}
data[config](this);}});}}
enableDismissTrigger(Toast);defineJQueryPlugin(Toast);const index_umd={Alert,Button,Carousel,Collapse,Dropdown,Modal,Offcanvas,Popover,ScrollSpy,Tab,Toast,Tooltip};return index_umd;}));(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):(global=global||self,global.CodeMirror=factory());}(this,(function(){'use strict';var userAgent=navigator.userAgent;var platform=navigator.platform;var gecko=/gecko\/\d/i.test(userAgent);var ie_upto10=/MSIE \d/.test(userAgent);var ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(userAgent);var edge=/Edge\/(\d+)/.exec(userAgent);var ie=ie_upto10||ie_11up||edge;var ie_version=ie&&(ie_upto10?document.documentMode||6:+(edge||ie_11up)[1]);var webkit=!edge&&/WebKit\//.test(userAgent);var qtwebkit=webkit&&/Qt\/\d+\.\d+/.test(userAgent);var chrome=!edge&&/Chrome\/(\d+)/.exec(userAgent);var chrome_version=chrome&&+chrome[1];var presto=/Opera\//.test(userAgent);var safari=/Apple Computer/.test(navigator.vendor);var mac_geMountainLion=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(userAgent);var phantom=/PhantomJS/.test(userAgent);var ios=safari&&(/Mobile\/\w+/.test(userAgent)||navigator.maxTouchPoints>2);var android=/Android/.test(userAgent);var mobile=ios||android||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);var mac=ios||/Mac/.test(platform);var chromeOS=/\bCrOS\b/.test(userAgent);var windows=/win/i.test(platform);var presto_version=presto&&userAgent.match(/Version\/(\d*\.\d*)/);if(presto_version){presto_version=Number(presto_version[1]);}
if(presto_version&&presto_version>=15){presto=false;webkit=true;}
var flipCtrlCmd=mac&&(qtwebkit||presto&&(presto_version==null||presto_version<12.11));var captureRightClick=gecko||(ie&&ie_version>=9);function classTest(cls){return new RegExp("(^|\\s)"+cls+"(?:$|\\s)\\s*")}
var rmClass=function(node,cls){var current=node.className;var match=classTest(cls).exec(current);if(match){var after=current.slice(match.index+match[0].length);node.className=current.slice(0,match.index)+(after?match[1]+after:"");}};function removeChildren(e){for(var count=e.childNodes.length;count>0;--count)
{e.removeChild(e.firstChild);}
return e}
function removeChildrenAndAdd(parent,e){return removeChildren(parent).appendChild(e)}
function elt(tag,content,className,style){var e=document.createElement(tag);if(className){e.className=className;}
if(style){e.style.cssText=style;}
if(typeof content=="string"){e.appendChild(document.createTextNode(content));}
else if(content){for(var i=0;i<content.length;++i){e.appendChild(content[i]);}}
return e}
function eltP(tag,content,className,style){var e=elt(tag,content,className,style);e.setAttribute("role","presentation");return e}
var range;if(document.createRange){range=function(node,start,end,endNode){var r=document.createRange();r.setEnd(endNode||node,end);r.setStart(node,start);return r};}
else{range=function(node,start,end){var r=document.body.createTextRange();try{r.moveToElementText(node.parentNode);}
catch(e){return r}
r.collapse(true);r.moveEnd("character",end);r.moveStart("character",start);return r};}
function contains(parent,child){if(child.nodeType==3)
{child=child.parentNode;}
if(parent.contains)
{return parent.contains(child)}
do{if(child.nodeType==11){child=child.host;}
if(child==parent){return true}}while(child=child.parentNode)}
function activeElt(doc){var activeElement;try{activeElement=doc.activeElement;}catch(e){activeElement=doc.body||null;}
while(activeElement&&activeElement.shadowRoot&&activeElement.shadowRoot.activeElement)
{activeElement=activeElement.shadowRoot.activeElement;}
return activeElement}
function addClass(node,cls){var current=node.className;if(!classTest(cls).test(current)){node.className+=(current?" ":"")+cls;}}
function joinClasses(a,b){var as=a.split(" ");for(var i=0;i<as.length;i++)
{if(as[i]&&!classTest(as[i]).test(b)){b+=" "+as[i];}}
return b}
var selectInput=function(node){node.select();};if(ios)
{selectInput=function(node){node.selectionStart=0;node.selectionEnd=node.value.length;};}
else if(ie)
{selectInput=function(node){try{node.select();}catch(_e){}};}
function doc(cm){return cm.display.wrapper.ownerDocument}
function win(cm){return doc(cm).defaultView}
function bind(f){var args=Array.prototype.slice.call(arguments,1);return function(){return f.apply(null,args)}}
function copyObj(obj,target,overwrite){if(!target){target={};}
for(var prop in obj)
{if(obj.hasOwnProperty(prop)&&(overwrite!==false||!target.hasOwnProperty(prop)))
{target[prop]=obj[prop];}}
return target}
function countColumn(string,end,tabSize,startIndex,startValue){if(end==null){end=string.search(/[^\s\u00a0]/);if(end==-1){end=string.length;}}
for(var i=startIndex||0,n=startValue||0;;){var nextTab=string.indexOf("\t",i);if(nextTab<0||nextTab>=end)
{return n+(end-i)}
n+=nextTab-i;n+=tabSize-(n%tabSize);i=nextTab+1;}}
var Delayed=function(){this.id=null;this.f=null;this.time=0;this.handler=bind(this.onTimeout,this);};Delayed.prototype.onTimeout=function(self){self.id=0;if(self.time<=+new Date){self.f();}else{setTimeout(self.handler,self.time-+new Date);}};Delayed.prototype.set=function(ms,f){this.f=f;var time=+new Date+ms;if(!this.id||time<this.time){clearTimeout(this.id);this.id=setTimeout(this.handler,ms);this.time=time;}};function indexOf(array,elt){for(var i=0;i<array.length;++i)
{if(array[i]==elt){return i}}
return-1}
var scrollerGap=50;var Pass={toString:function(){return"CodeMirror.Pass"}};var sel_dontScroll={scroll:false},sel_mouse={origin:"*mouse"},sel_move={origin:"+move"};function findColumn(string,goal,tabSize){for(var pos=0,col=0;;){var nextTab=string.indexOf("\t",pos);if(nextTab==-1){nextTab=string.length;}
var skipped=nextTab-pos;if(nextTab==string.length||col+skipped>=goal)
{return pos+Math.min(skipped,goal-col)}
col+=nextTab-pos;col+=tabSize-(col%tabSize);pos=nextTab+1;if(col>=goal){return pos}}}
var spaceStrs=[""];function spaceStr(n){while(spaceStrs.length<=n)
{spaceStrs.push(lst(spaceStrs)+" ");}
return spaceStrs[n]}
function lst(arr){return arr[arr.length-1]}
function map(array,f){var out=[];for(var i=0;i<array.length;i++){out[i]=f(array[i],i);}
return out}
function insertSorted(array,value,score){var pos=0,priority=score(value);while(pos<array.length&&score(array[pos])<=priority){pos++;}
array.splice(pos,0,value);}
function nothing(){}
function createObj(base,props){var inst;if(Object.create){inst=Object.create(base);}else{nothing.prototype=base;inst=new nothing();}
if(props){copyObj(props,inst);}
return inst}
var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function isWordCharBasic(ch){return/\w/.test(ch)||ch>"\x80"&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch))}
function isWordChar(ch,helper){if(!helper){return isWordCharBasic(ch)}
if(helper.source.indexOf("\\w")>-1&&isWordCharBasic(ch)){return true}
return helper.test(ch)}
function isEmpty(obj){for(var n in obj){if(obj.hasOwnProperty(n)&&obj[n]){return false}}
return true}
var extendingChars=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function isExtendingChar(ch){return ch.charCodeAt(0)>=768&&extendingChars.test(ch)}
function skipExtendingChars(str,pos,dir){while((dir<0?pos>0:pos<str.length)&&isExtendingChar(str.charAt(pos))){pos+=dir;}
return pos}
function findFirst(pred,from,to){var dir=from>to?-1:1;for(;;){if(from==to){return from}
var midF=(from+to)/2,mid=dir<0?Math.ceil(midF):Math.floor(midF);if(mid==from){return pred(mid)?from:to}
if(pred(mid)){to=mid;}
else{from=mid+dir;}}}
function iterateBidiSections(order,from,to,f){if(!order){return f(from,to,"ltr",0)}
var found=false;for(var i=0;i<order.length;++i){var part=order[i];if(part.from<to&&part.to>from||from==to&&part.to==from){f(Math.max(part.from,from),Math.min(part.to,to),part.level==1?"rtl":"ltr",i);found=true;}}
if(!found){f(from,to,"ltr");}}
var bidiOther=null;function getBidiPartAt(order,ch,sticky){var found;bidiOther=null;for(var i=0;i<order.length;++i){var cur=order[i];if(cur.from<ch&&cur.to>ch){return i}
if(cur.to==ch){if(cur.from!=cur.to&&sticky=="before"){found=i;}
else{bidiOther=i;}}
if(cur.from==ch){if(cur.from!=cur.to&&sticky!="before"){found=i;}
else{bidiOther=i;}}}
return found!=null?found:bidiOther}
var bidiOrdering=(function(){var lowTypes="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";var arabicTypes="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function charType(code){if(code<=0xf7){return lowTypes.charAt(code)}
else if(0x590<=code&&code<=0x5f4){return"R"}
else if(0x600<=code&&code<=0x6f9){return arabicTypes.charAt(code-0x600)}
else if(0x6ee<=code&&code<=0x8ac){return"r"}
else if(0x2000<=code&&code<=0x200b){return"w"}
else if(code==0x200c){return"b"}
else{return"L"}}
var bidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var isNeutral=/[stwN]/,isStrong=/[LRr]/,countsAsLeft=/[Lb1n]/,countsAsNum=/[1n]/;function BidiSpan(level,from,to){this.level=level;this.from=from;this.to=to;}
return function(str,direction){var outerType=direction=="ltr"?"L":"R";if(str.length==0||direction=="ltr"&&!bidiRE.test(str)){return false}
var len=str.length,types=[];for(var i=0;i<len;++i)
{types.push(charType(str.charCodeAt(i)));}
for(var i$1=0,prev=outerType;i$1<len;++i$1){var type=types[i$1];if(type=="m"){types[i$1]=prev;}
else{prev=type;}}
for(var i$2=0,cur=outerType;i$2<len;++i$2){var type$1=types[i$2];if(type$1=="1"&&cur=="r"){types[i$2]="n";}
else if(isStrong.test(type$1)){cur=type$1;if(type$1=="r"){types[i$2]="R";}}}
for(var i$3=1,prev$1=types[0];i$3<len-1;++i$3){var type$2=types[i$3];if(type$2=="+"&&prev$1=="1"&&types[i$3+1]=="1"){types[i$3]="1";}
else if(type$2==","&&prev$1==types[i$3+1]&&(prev$1=="1"||prev$1=="n")){types[i$3]=prev$1;}
prev$1=type$2;}
for(var i$4=0;i$4<len;++i$4){var type$3=types[i$4];if(type$3==","){types[i$4]="N";}
else if(type$3=="%"){var end=(void 0);for(end=i$4+1;end<len&&types[end]=="%";++end){}
var replace=(i$4&&types[i$4-1]=="!")||(end<len&&types[end]=="1")?"1":"N";for(var j=i$4;j<end;++j){types[j]=replace;}
i$4=end-1;}}
for(var i$5=0,cur$1=outerType;i$5<len;++i$5){var type$4=types[i$5];if(cur$1=="L"&&type$4=="1"){types[i$5]="L";}
else if(isStrong.test(type$4)){cur$1=type$4;}}
for(var i$6=0;i$6<len;++i$6){if(isNeutral.test(types[i$6])){var end$1=(void 0);for(end$1=i$6+1;end$1<len&&isNeutral.test(types[end$1]);++end$1){}
var before=(i$6?types[i$6-1]:outerType)=="L";var after=(end$1<len?types[end$1]:outerType)=="L";var replace$1=before==after?(before?"L":"R"):outerType;for(var j$1=i$6;j$1<end$1;++j$1){types[j$1]=replace$1;}
i$6=end$1-1;}}
var order=[],m;for(var i$7=0;i$7<len;){if(countsAsLeft.test(types[i$7])){var start=i$7;for(++i$7;i$7<len&&countsAsLeft.test(types[i$7]);++i$7){}
order.push(new BidiSpan(0,start,i$7));}else{var pos=i$7,at=order.length,isRTL=direction=="rtl"?1:0;for(++i$7;i$7<len&&types[i$7]!="L";++i$7){}
for(var j$2=pos;j$2<i$7;){if(countsAsNum.test(types[j$2])){if(pos<j$2){order.splice(at,0,new BidiSpan(1,pos,j$2));at+=isRTL;}
var nstart=j$2;for(++j$2;j$2<i$7&&countsAsNum.test(types[j$2]);++j$2){}
order.splice(at,0,new BidiSpan(2,nstart,j$2));at+=isRTL;pos=j$2;}else{++j$2;}}
if(pos<i$7){order.splice(at,0,new BidiSpan(1,pos,i$7));}}}
if(direction=="ltr"){if(order[0].level==1&&(m=str.match(/^\s+/))){order[0].from=m[0].length;order.unshift(new BidiSpan(0,0,m[0].length));}
if(lst(order).level==1&&(m=str.match(/\s+$/))){lst(order).to-=m[0].length;order.push(new BidiSpan(0,len-m[0].length,len));}}
return direction=="rtl"?order.reverse():order}})();function getOrder(line,direction){var order=line.order;if(order==null){order=line.order=bidiOrdering(line.text,direction);}
return order}
var noHandlers=[];var on=function(emitter,type,f){if(emitter.addEventListener){emitter.addEventListener(type,f,false);}else if(emitter.attachEvent){emitter.attachEvent("on"+type,f);}else{var map=emitter._handlers||(emitter._handlers={});map[type]=(map[type]||noHandlers).concat(f);}};function getHandlers(emitter,type){return emitter._handlers&&emitter._handlers[type]||noHandlers}
function off(emitter,type,f){if(emitter.removeEventListener){emitter.removeEventListener(type,f,false);}else if(emitter.detachEvent){emitter.detachEvent("on"+type,f);}else{var map=emitter._handlers,arr=map&&map[type];if(arr){var index=indexOf(arr,f);if(index>-1)
{map[type]=arr.slice(0,index).concat(arr.slice(index+1));}}}}
function signal(emitter,type){var handlers=getHandlers(emitter,type);if(!handlers.length){return}
var args=Array.prototype.slice.call(arguments,2);for(var i=0;i<handlers.length;++i){handlers[i].apply(null,args);}}
function signalDOMEvent(cm,e,override){if(typeof e=="string")
{e={type:e,preventDefault:function(){this.defaultPrevented=true;}};}
signal(cm,override||e.type,cm,e);return e_defaultPrevented(e)||e.codemirrorIgnore}
function signalCursorActivity(cm){var arr=cm._handlers&&cm._handlers.cursorActivity;if(!arr){return}
var set=cm.curOp.cursorActivityHandlers||(cm.curOp.cursorActivityHandlers=[]);for(var i=0;i<arr.length;++i){if(indexOf(set,arr[i])==-1)
{set.push(arr[i]);}}}
function hasHandler(emitter,type){return getHandlers(emitter,type).length>0}
function eventMixin(ctor){ctor.prototype.on=function(type,f){on(this,type,f);};ctor.prototype.off=function(type,f){off(this,type,f);};}
function e_preventDefault(e){if(e.preventDefault){e.preventDefault();}
else{e.returnValue=false;}}
function e_stopPropagation(e){if(e.stopPropagation){e.stopPropagation();}
else{e.cancelBubble=true;}}
function e_defaultPrevented(e){return e.defaultPrevented!=null?e.defaultPrevented:e.returnValue==false}
function e_stop(e){e_preventDefault(e);e_stopPropagation(e);}
function e_target(e){return e.target||e.srcElement}
function e_button(e){var b=e.which;if(b==null){if(e.button&1){b=1;}
else if(e.button&2){b=3;}
else if(e.button&4){b=2;}}
if(mac&&e.ctrlKey&&b==1){b=3;}
return b}
var dragAndDrop=function(){if(ie&&ie_version<9){return false}
var div=elt('div');return"draggable"in div||"dragDrop"in div}();var zwspSupported;function zeroWidthElement(measure){if(zwspSupported==null){var test=elt("span","\u200b");removeChildrenAndAdd(measure,elt("span",[test,document.createTextNode("x")]));if(measure.firstChild.offsetHeight!=0)
{zwspSupported=test.offsetWidth<=1&&test.offsetHeight>2&&!(ie&&ie_version<8);}}
var node=zwspSupported?elt("span","\u200b"):elt("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");node.setAttribute("cm-text","");return node}
var badBidiRects;function hasBadBidiRects(measure){if(badBidiRects!=null){return badBidiRects}
var txt=removeChildrenAndAdd(measure,document.createTextNode("A\u062eA"));var r0=range(txt,0,1).getBoundingClientRect();var r1=range(txt,1,2).getBoundingClientRect();removeChildren(measure);if(!r0||r0.left==r0.right){return false}
return badBidiRects=(r1.right-r0.right<3)}
var splitLinesAuto="\n\nb".split(/\n/).length!=3?function(string){var pos=0,result=[],l=string.length;while(pos<=l){var nl=string.indexOf("\n",pos);if(nl==-1){nl=string.length;}
var line=string.slice(pos,string.charAt(nl-1)=="\r"?nl-1:nl);var rt=line.indexOf("\r");if(rt!=-1){result.push(line.slice(0,rt));pos+=rt+1;}else{result.push(line);pos=nl+1;}}
return result}:function(string){return string.split(/\r\n?|\n/);};var hasSelection=window.getSelection?function(te){try{return te.selectionStart!=te.selectionEnd}
catch(e){return false}}:function(te){var range;try{range=te.ownerDocument.selection.createRange();}
catch(e){}
if(!range||range.parentElement()!=te){return false}
return range.compareEndPoints("StartToEnd",range)!=0};var hasCopyEvent=(function(){var e=elt("div");if("oncopy"in e){return true}
e.setAttribute("oncopy","return;");return typeof e.oncopy=="function"})();var badZoomedRects=null;function hasBadZoomedRects(measure){if(badZoomedRects!=null){return badZoomedRects}
var node=removeChildrenAndAdd(measure,elt("span","x"));var normal=node.getBoundingClientRect();var fromRange=range(node,0,1).getBoundingClientRect();return badZoomedRects=Math.abs(normal.left-fromRange.left)>1}
var modes={},mimeModes={};function defineMode(name,mode){if(arguments.length>2)
{mode.dependencies=Array.prototype.slice.call(arguments,2);}
modes[name]=mode;}
function defineMIME(mime,spec){mimeModes[mime]=spec;}
function resolveMode(spec){if(typeof spec=="string"&&mimeModes.hasOwnProperty(spec)){spec=mimeModes[spec];}else if(spec&&typeof spec.name=="string"&&mimeModes.hasOwnProperty(spec.name)){var found=mimeModes[spec.name];if(typeof found=="string"){found={name:found};}
spec=createObj(found,spec);spec.name=found.name;}else if(typeof spec=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(spec)){return resolveMode("application/xml")}else if(typeof spec=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(spec)){return resolveMode("application/json")}
if(typeof spec=="string"){return{name:spec}}
else{return spec||{name:"null"}}}
function getMode(options,spec){spec=resolveMode(spec);var mfactory=modes[spec.name];if(!mfactory){return getMode(options,"text/plain")}
var modeObj=mfactory(options,spec);if(modeExtensions.hasOwnProperty(spec.name)){var exts=modeExtensions[spec.name];for(var prop in exts){if(!exts.hasOwnProperty(prop)){continue}
if(modeObj.hasOwnProperty(prop)){modeObj["_"+prop]=modeObj[prop];}
modeObj[prop]=exts[prop];}}
modeObj.name=spec.name;if(spec.helperType){modeObj.helperType=spec.helperType;}
if(spec.modeProps){for(var prop$1 in spec.modeProps)
{modeObj[prop$1]=spec.modeProps[prop$1];}}
return modeObj}
var modeExtensions={};function extendMode(mode,properties){var exts=modeExtensions.hasOwnProperty(mode)?modeExtensions[mode]:(modeExtensions[mode]={});copyObj(properties,exts);}
function copyState(mode,state){if(state===true){return state}
if(mode.copyState){return mode.copyState(state)}
var nstate={};for(var n in state){var val=state[n];if(val instanceof Array){val=val.concat([]);}
nstate[n]=val;}
return nstate}
function innerMode(mode,state){var info;while(mode.innerMode){info=mode.innerMode(state);if(!info||info.mode==mode){break}
state=info.state;mode=info.mode;}
return info||{mode:mode,state:state}}
function startState(mode,a1,a2){return mode.startState?mode.startState(a1,a2):true}
var StringStream=function(string,tabSize,lineOracle){this.pos=this.start=0;this.string=string;this.tabSize=tabSize||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;this.lineOracle=lineOracle;};StringStream.prototype.eol=function(){return this.pos>=this.string.length};StringStream.prototype.sol=function(){return this.pos==this.lineStart};StringStream.prototype.peek=function(){return this.string.charAt(this.pos)||undefined};StringStream.prototype.next=function(){if(this.pos<this.string.length)
{return this.string.charAt(this.pos++)}};StringStream.prototype.eat=function(match){var ch=this.string.charAt(this.pos);var ok;if(typeof match=="string"){ok=ch==match;}
else{ok=ch&&(match.test?match.test(ch):match(ch));}
if(ok){++this.pos;return ch}};StringStream.prototype.eatWhile=function(match){var start=this.pos;while(this.eat(match)){}
return this.pos>start};StringStream.prototype.eatSpace=function(){var start=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++this.pos;}
return this.pos>start};StringStream.prototype.skipToEnd=function(){this.pos=this.string.length;};StringStream.prototype.skipTo=function(ch){var found=this.string.indexOf(ch,this.pos);if(found>-1){this.pos=found;return true}};StringStream.prototype.backUp=function(n){this.pos-=n;};StringStream.prototype.column=function(){if(this.lastColumnPos<this.start){this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);this.lastColumnPos=this.start;}
return this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};StringStream.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-
(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};StringStream.prototype.match=function(pattern,consume,caseInsensitive){if(typeof pattern=="string"){var cased=function(str){return caseInsensitive?str.toLowerCase():str;};var substr=this.string.substr(this.pos,pattern.length);if(cased(substr)==cased(pattern)){if(consume!==false){this.pos+=pattern.length;}
return true}}else{var match=this.string.slice(this.pos).match(pattern);if(match&&match.index>0){return null}
if(match&&consume!==false){this.pos+=match[0].length;}
return match}};StringStream.prototype.current=function(){return this.string.slice(this.start,this.pos)};StringStream.prototype.hideFirstChars=function(n,inner){this.lineStart+=n;try{return inner()}
finally{this.lineStart-=n;}};StringStream.prototype.lookAhead=function(n){var oracle=this.lineOracle;return oracle&&oracle.lookAhead(n)};StringStream.prototype.baseToken=function(){var oracle=this.lineOracle;return oracle&&oracle.baseToken(this.pos)};function getLine(doc,n){n-=doc.first;if(n<0||n>=doc.size){throw new Error("There is no line "+(n+doc.first)+" in the document.")}
var chunk=doc;while(!chunk.lines){for(var i=0;;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;break}
n-=sz;}}
return chunk.lines[n]}
function getBetween(doc,start,end){var out=[],n=start.line;doc.iter(start.line,end.line+1,function(line){var text=line.text;if(n==end.line){text=text.slice(0,end.ch);}
if(n==start.line){text=text.slice(start.ch);}
out.push(text);++n;});return out}
function getLines(doc,from,to){var out=[];doc.iter(from,to,function(line){out.push(line.text);});return out}
function updateLineHeight(line,height){var diff=height-line.height;if(diff){for(var n=line;n;n=n.parent){n.height+=diff;}}}
function lineNo(line){if(line.parent==null){return null}
var cur=line.parent,no=indexOf(cur.lines,line);for(var chunk=cur.parent;chunk;cur=chunk,chunk=chunk.parent){for(var i=0;;++i){if(chunk.children[i]==cur){break}
no+=chunk.children[i].chunkSize();}}
return no+cur.first}
function lineAtHeight(chunk,h){var n=chunk.first;outer:do{for(var i$1=0;i$1<chunk.children.length;++i$1){var child=chunk.children[i$1],ch=child.height;if(h<ch){chunk=child;continue outer}
h-=ch;n+=child.chunkSize();}
return n}while(!chunk.lines)
var i=0;for(;i<chunk.lines.length;++i){var line=chunk.lines[i],lh=line.height;if(h<lh){break}
h-=lh;}
return n+i}
function isLine(doc,l){return l>=doc.first&&l<doc.first+doc.size}
function lineNumberFor(options,i){return String(options.lineNumberFormatter(i+options.firstLineNumber))}
function Pos(line,ch,sticky){if(sticky===void 0)sticky=null;if(!(this instanceof Pos)){return new Pos(line,ch,sticky)}
this.line=line;this.ch=ch;this.sticky=sticky;}
function cmp(a,b){return a.line-b.line||a.ch-b.ch}
function equalCursorPos(a,b){return a.sticky==b.sticky&&cmp(a,b)==0}
function copyPos(x){return Pos(x.line,x.ch)}
function maxPos(a,b){return cmp(a,b)<0?b:a}
function minPos(a,b){return cmp(a,b)<0?a:b}
function clipLine(doc,n){return Math.max(doc.first,Math.min(n,doc.first+doc.size-1))}
function clipPos(doc,pos){if(pos.line<doc.first){return Pos(doc.first,0)}
var last=doc.first+doc.size-1;if(pos.line>last){return Pos(last,getLine(doc,last).text.length)}
return clipToLen(pos,getLine(doc,pos.line).text.length)}
function clipToLen(pos,linelen){var ch=pos.ch;if(ch==null||ch>linelen){return Pos(pos.line,linelen)}
else if(ch<0){return Pos(pos.line,0)}
else{return pos}}
function clipPosArray(doc,array){var out=[];for(var i=0;i<array.length;i++){out[i]=clipPos(doc,array[i]);}
return out}
var SavedContext=function(state,lookAhead){this.state=state;this.lookAhead=lookAhead;};var Context=function(doc,state,line,lookAhead){this.state=state;this.doc=doc;this.line=line;this.maxLookAhead=lookAhead||0;this.baseTokens=null;this.baseTokenPos=1;};Context.prototype.lookAhead=function(n){var line=this.doc.getLine(this.line+n);if(line!=null&&n>this.maxLookAhead){this.maxLookAhead=n;}
return line};Context.prototype.baseToken=function(n){if(!this.baseTokens){return null}
while(this.baseTokens[this.baseTokenPos]<=n)
{this.baseTokenPos+=2;}
var type=this.baseTokens[this.baseTokenPos+1];return{type:type&&type.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-n}};Context.prototype.nextLine=function(){this.line++;if(this.maxLookAhead>0){this.maxLookAhead--;}};Context.fromSaved=function(doc,saved,line){if(saved instanceof SavedContext)
{return new Context(doc,copyState(doc.mode,saved.state),line,saved.lookAhead)}
else
{return new Context(doc,copyState(doc.mode,saved),line)}};Context.prototype.save=function(copy){var state=copy!==false?copyState(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new SavedContext(state,this.maxLookAhead):state};function highlightLine(cm,line,context,forceToEnd){var st=[cm.state.modeGen],lineClasses={};runMode(cm,line.text,cm.doc.mode,context,function(end,style){return st.push(end,style);},lineClasses,forceToEnd);var state=context.state;var loop=function(o){context.baseTokens=st;var overlay=cm.state.overlays[o],i=1,at=0;context.state=true;runMode(cm,line.text,overlay.mode,context,function(end,style){var start=i;while(at<end){var i_end=st[i];if(i_end>end)
{st.splice(i,1,end,st[i+1],i_end);}
i+=2;at=Math.min(end,i_end);}
if(!style){return}
if(overlay.opaque){st.splice(start,i-start,end,"overlay "+style);i=start+2;}else{for(;start<i;start+=2){var cur=st[start+1];st[start+1]=(cur?cur+" ":"")+"overlay "+style;}}},lineClasses);context.state=state;context.baseTokens=null;context.baseTokenPos=1;};for(var o=0;o<cm.state.overlays.length;++o)loop(o);return{styles:st,classes:lineClasses.bgClass||lineClasses.textClass?lineClasses:null}}
function getLineStyles(cm,line,updateFrontier){if(!line.styles||line.styles[0]!=cm.state.modeGen){var context=getContextBefore(cm,lineNo(line));var resetState=line.text.length>cm.options.maxHighlightLength&&copyState(cm.doc.mode,context.state);var result=highlightLine(cm,line,context);if(resetState){context.state=resetState;}
line.stateAfter=context.save(!resetState);line.styles=result.styles;if(result.classes){line.styleClasses=result.classes;}
else if(line.styleClasses){line.styleClasses=null;}
if(updateFrontier===cm.doc.highlightFrontier)
{cm.doc.modeFrontier=Math.max(cm.doc.modeFrontier,++cm.doc.highlightFrontier);}}
return line.styles}
function getContextBefore(cm,n,precise){var doc=cm.doc,display=cm.display;if(!doc.mode.startState){return new Context(doc,true,n)}
var start=findStartLine(cm,n,precise);var saved=start>doc.first&&getLine(doc,start-1).stateAfter;var context=saved?Context.fromSaved(doc,saved,start):new Context(doc,startState(doc.mode),start);doc.iter(start,n,function(line){processLine(cm,line.text,context);var pos=context.line;line.stateAfter=pos==n-1||pos%5==0||pos>=display.viewFrom&&pos<display.viewTo?context.save():null;context.nextLine();});if(precise){doc.modeFrontier=context.line;}
return context}
function processLine(cm,text,context,startAt){var mode=cm.doc.mode;var stream=new StringStream(text,cm.options.tabSize,context);stream.start=stream.pos=startAt||0;if(text==""){callBlankLine(mode,context.state);}
while(!stream.eol()){readToken(mode,stream,context.state);stream.start=stream.pos;}}
function callBlankLine(mode,state){if(mode.blankLine){return mode.blankLine(state)}
if(!mode.innerMode){return}
var inner=innerMode(mode,state);if(inner.mode.blankLine){return inner.mode.blankLine(inner.state)}}
function readToken(mode,stream,state,inner){for(var i=0;i<10;i++){if(inner){inner[0]=innerMode(mode,state).mode;}
var style=mode.token(stream,state);if(stream.pos>stream.start){return style}}
throw new Error("Mode "+mode.name+" failed to advance stream.")}
var Token=function(stream,type,state){this.start=stream.start;this.end=stream.pos;this.string=stream.current();this.type=type||null;this.state=state;};function takeToken(cm,pos,precise,asArray){var doc=cm.doc,mode=doc.mode,style;pos=clipPos(doc,pos);var line=getLine(doc,pos.line),context=getContextBefore(cm,pos.line,precise);var stream=new StringStream(line.text,cm.options.tabSize,context),tokens;if(asArray){tokens=[];}
while((asArray||stream.pos<pos.ch)&&!stream.eol()){stream.start=stream.pos;style=readToken(mode,stream,context.state);if(asArray){tokens.push(new Token(stream,style,copyState(doc.mode,context.state)));}}
return asArray?tokens:new Token(stream,style,context.state)}
function extractLineClasses(type,output){if(type){for(;;){var lineClass=type.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!lineClass){break}
type=type.slice(0,lineClass.index)+type.slice(lineClass.index+lineClass[0].length);var prop=lineClass[1]?"bgClass":"textClass";if(output[prop]==null)
{output[prop]=lineClass[2];}
else if(!(new RegExp("(?:^|\\s)"+lineClass[2]+"(?:$|\\s)")).test(output[prop]))
{output[prop]+=" "+lineClass[2];}}}
return type}
function runMode(cm,text,mode,context,f,lineClasses,forceToEnd){var flattenSpans=mode.flattenSpans;if(flattenSpans==null){flattenSpans=cm.options.flattenSpans;}
var curStart=0,curStyle=null;var stream=new StringStream(text,cm.options.tabSize,context),style;var inner=cm.options.addModeClass&&[null];if(text==""){extractLineClasses(callBlankLine(mode,context.state),lineClasses);}
while(!stream.eol()){if(stream.pos>cm.options.maxHighlightLength){flattenSpans=false;if(forceToEnd){processLine(cm,text,context,stream.pos);}
stream.pos=text.length;style=null;}else{style=extractLineClasses(readToken(mode,stream,context.state,inner),lineClasses);}
if(inner){var mName=inner[0].name;if(mName){style="m-"+(style?mName+" "+style:mName);}}
if(!flattenSpans||curStyle!=style){while(curStart<stream.start){curStart=Math.min(stream.start,curStart+5000);f(curStart,curStyle);}
curStyle=style;}
stream.start=stream.pos;}
while(curStart<stream.pos){var pos=Math.min(stream.pos,curStart+5000);f(pos,curStyle);curStart=pos;}}
function findStartLine(cm,n,precise){var minindent,minline,doc=cm.doc;var lim=precise?-1:n-(cm.doc.mode.innerMode?1000:100);for(var search=n;search>lim;--search){if(search<=doc.first){return doc.first}
var line=getLine(doc,search-1),after=line.stateAfter;if(after&&(!precise||search+(after instanceof SavedContext?after.lookAhead:0)<=doc.modeFrontier))
{return search}
var indented=countColumn(line.text,null,cm.options.tabSize);if(minline==null||minindent>indented){minline=search-1;minindent=indented;}}
return minline}
function retreatFrontier(doc,n){doc.modeFrontier=Math.min(doc.modeFrontier,n);if(doc.highlightFrontier<n-10){return}
var start=doc.first;for(var line=n-1;line>start;line--){var saved=getLine(doc,line).stateAfter;if(saved&&(!(saved instanceof SavedContext)||line+saved.lookAhead<n)){start=line+1;break}}
doc.highlightFrontier=Math.min(doc.highlightFrontier,start);}
var sawReadOnlySpans=false,sawCollapsedSpans=false;function seeReadOnlySpans(){sawReadOnlySpans=true;}
function seeCollapsedSpans(){sawCollapsedSpans=true;}
function MarkedSpan(marker,from,to){this.marker=marker;this.from=from;this.to=to;}
function getMarkedSpanFor(spans,marker){if(spans){for(var i=0;i<spans.length;++i){var span=spans[i];if(span.marker==marker){return span}}}}
function removeMarkedSpan(spans,span){var r;for(var i=0;i<spans.length;++i)
{if(spans[i]!=span){(r||(r=[])).push(spans[i]);}}
return r}
function addMarkedSpan(line,span,op){var inThisOp=op&&window.WeakSet&&(op.markedSpans||(op.markedSpans=new WeakSet));if(inThisOp&&line.markedSpans&&inThisOp.has(line.markedSpans)){line.markedSpans.push(span);}else{line.markedSpans=line.markedSpans?line.markedSpans.concat([span]):[span];if(inThisOp){inThisOp.add(line.markedSpans);}}
span.marker.attachLine(line);}
function markedSpansBefore(old,startCh,isInsert){var nw;if(old){for(var i=0;i<old.length;++i){var span=old[i],marker=span.marker;var startsBefore=span.from==null||(marker.inclusiveLeft?span.from<=startCh:span.from<startCh);if(startsBefore||span.from==startCh&&marker.type=="bookmark"&&(!isInsert||!span.marker.insertLeft)){var endsAfter=span.to==null||(marker.inclusiveRight?span.to>=startCh:span.to>startCh);(nw||(nw=[])).push(new MarkedSpan(marker,span.from,endsAfter?null:span.to));}}}
return nw}
function markedSpansAfter(old,endCh,isInsert){var nw;if(old){for(var i=0;i<old.length;++i){var span=old[i],marker=span.marker;var endsAfter=span.to==null||(marker.inclusiveRight?span.to>=endCh:span.to>endCh);if(endsAfter||span.from==endCh&&marker.type=="bookmark"&&(!isInsert||span.marker.insertLeft)){var startsBefore=span.from==null||(marker.inclusiveLeft?span.from<=endCh:span.from<endCh);(nw||(nw=[])).push(new MarkedSpan(marker,startsBefore?null:span.from-endCh,span.to==null?null:span.to-endCh));}}}
return nw}
function stretchSpansOverChange(doc,change){if(change.full){return null}
var oldFirst=isLine(doc,change.from.line)&&getLine(doc,change.from.line).markedSpans;var oldLast=isLine(doc,change.to.line)&&getLine(doc,change.to.line).markedSpans;if(!oldFirst&&!oldLast){return null}
var startCh=change.from.ch,endCh=change.to.ch,isInsert=cmp(change.from,change.to)==0;var first=markedSpansBefore(oldFirst,startCh,isInsert);var last=markedSpansAfter(oldLast,endCh,isInsert);var sameLine=change.text.length==1,offset=lst(change.text).length+(sameLine?startCh:0);if(first){for(var i=0;i<first.length;++i){var span=first[i];if(span.to==null){var found=getMarkedSpanFor(last,span.marker);if(!found){span.to=startCh;}
else if(sameLine){span.to=found.to==null?null:found.to+offset;}}}}
if(last){for(var i$1=0;i$1<last.length;++i$1){var span$1=last[i$1];if(span$1.to!=null){span$1.to+=offset;}
if(span$1.from==null){var found$1=getMarkedSpanFor(first,span$1.marker);if(!found$1){span$1.from=offset;if(sameLine){(first||(first=[])).push(span$1);}}}else{span$1.from+=offset;if(sameLine){(first||(first=[])).push(span$1);}}}}
if(first){first=clearEmptySpans(first);}
if(last&&last!=first){last=clearEmptySpans(last);}
var newMarkers=[first];if(!sameLine){var gap=change.text.length-2,gapMarkers;if(gap>0&&first)
{for(var i$2=0;i$2<first.length;++i$2)
{if(first[i$2].to==null)
{(gapMarkers||(gapMarkers=[])).push(new MarkedSpan(first[i$2].marker,null,null));}}}
for(var i$3=0;i$3<gap;++i$3)
{newMarkers.push(gapMarkers);}
newMarkers.push(last);}
return newMarkers}
function clearEmptySpans(spans){for(var i=0;i<spans.length;++i){var span=spans[i];if(span.from!=null&&span.from==span.to&&span.marker.clearWhenEmpty!==false)
{spans.splice(i--,1);}}
if(!spans.length){return null}
return spans}
function removeReadOnlyRanges(doc,from,to){var markers=null;doc.iter(from.line,to.line+1,function(line){if(line.markedSpans){for(var i=0;i<line.markedSpans.length;++i){var mark=line.markedSpans[i].marker;if(mark.readOnly&&(!markers||indexOf(markers,mark)==-1))
{(markers||(markers=[])).push(mark);}}}});if(!markers){return null}
var parts=[{from:from,to:to}];for(var i=0;i<markers.length;++i){var mk=markers[i],m=mk.find(0);for(var j=0;j<parts.length;++j){var p=parts[j];if(cmp(p.to,m.from)<0||cmp(p.from,m.to)>0){continue}
var newParts=[j,1],dfrom=cmp(p.from,m.from),dto=cmp(p.to,m.to);if(dfrom<0||!mk.inclusiveLeft&&!dfrom)
{newParts.push({from:p.from,to:m.from});}
if(dto>0||!mk.inclusiveRight&&!dto)
{newParts.push({from:m.to,to:p.to});}
parts.splice.apply(parts,newParts);j+=newParts.length-3;}}
return parts}
function detachMarkedSpans(line){var spans=line.markedSpans;if(!spans){return}
for(var i=0;i<spans.length;++i)
{spans[i].marker.detachLine(line);}
line.markedSpans=null;}
function attachMarkedSpans(line,spans){if(!spans){return}
for(var i=0;i<spans.length;++i)
{spans[i].marker.attachLine(line);}
line.markedSpans=spans;}
function extraLeft(marker){return marker.inclusiveLeft?-1:0}
function extraRight(marker){return marker.inclusiveRight?1:0}
function compareCollapsedMarkers(a,b){var lenDiff=a.lines.length-b.lines.length;if(lenDiff!=0){return lenDiff}
var aPos=a.find(),bPos=b.find();var fromCmp=cmp(aPos.from,bPos.from)||extraLeft(a)-extraLeft(b);if(fromCmp){return-fromCmp}
var toCmp=cmp(aPos.to,bPos.to)||extraRight(a)-extraRight(b);if(toCmp){return toCmp}
return b.id-a.id}
function collapsedSpanAtSide(line,start){var sps=sawCollapsedSpans&&line.markedSpans,found;if(sps){for(var sp=(void 0),i=0;i<sps.length;++i){sp=sps[i];if(sp.marker.collapsed&&(start?sp.from:sp.to)==null&&(!found||compareCollapsedMarkers(found,sp.marker)<0))
{found=sp.marker;}}}
return found}
function collapsedSpanAtStart(line){return collapsedSpanAtSide(line,true)}
function collapsedSpanAtEnd(line){return collapsedSpanAtSide(line,false)}
function collapsedSpanAround(line,ch){var sps=sawCollapsedSpans&&line.markedSpans,found;if(sps){for(var i=0;i<sps.length;++i){var sp=sps[i];if(sp.marker.collapsed&&(sp.from==null||sp.from<ch)&&(sp.to==null||sp.to>ch)&&(!found||compareCollapsedMarkers(found,sp.marker)<0)){found=sp.marker;}}}
return found}
function conflictingCollapsedRange(doc,lineNo,from,to,marker){var line=getLine(doc,lineNo);var sps=sawCollapsedSpans&&line.markedSpans;if(sps){for(var i=0;i<sps.length;++i){var sp=sps[i];if(!sp.marker.collapsed){continue}
var found=sp.marker.find(0);var fromCmp=cmp(found.from,from)||extraLeft(sp.marker)-extraLeft(marker);var toCmp=cmp(found.to,to)||extraRight(sp.marker)-extraRight(marker);if(fromCmp>=0&&toCmp<=0||fromCmp<=0&&toCmp>=0){continue}
if(fromCmp<=0&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?cmp(found.to,from)>=0:cmp(found.to,from)>0)||fromCmp>=0&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?cmp(found.from,to)<=0:cmp(found.from,to)<0))
{return true}}}}
function visualLine(line){var merged;while(merged=collapsedSpanAtStart(line))
{line=merged.find(-1,true).line;}
return line}
function visualLineEnd(line){var merged;while(merged=collapsedSpanAtEnd(line))
{line=merged.find(1,true).line;}
return line}
function visualLineContinued(line){var merged,lines;while(merged=collapsedSpanAtEnd(line)){line=merged.find(1,true).line;(lines||(lines=[])).push(line);}
return lines}
function visualLineNo(doc,lineN){var line=getLine(doc,lineN),vis=visualLine(line);if(line==vis){return lineN}
return lineNo(vis)}
function visualLineEndNo(doc,lineN){if(lineN>doc.lastLine()){return lineN}
var line=getLine(doc,lineN),merged;if(!lineIsHidden(doc,line)){return lineN}
while(merged=collapsedSpanAtEnd(line))
{line=merged.find(1,true).line;}
return lineNo(line)+1}
function lineIsHidden(doc,line){var sps=sawCollapsedSpans&&line.markedSpans;if(sps){for(var sp=(void 0),i=0;i<sps.length;++i){sp=sps[i];if(!sp.marker.collapsed){continue}
if(sp.from==null){return true}
if(sp.marker.widgetNode){continue}
if(sp.from==0&&sp.marker.inclusiveLeft&&lineIsHiddenInner(doc,line,sp))
{return true}}}}
function lineIsHiddenInner(doc,line,span){if(span.to==null){var end=span.marker.find(1,true);return lineIsHiddenInner(doc,end.line,getMarkedSpanFor(end.line.markedSpans,span.marker))}
if(span.marker.inclusiveRight&&span.to==line.text.length)
{return true}
for(var sp=(void 0),i=0;i<line.markedSpans.length;++i){sp=line.markedSpans[i];if(sp.marker.collapsed&&!sp.marker.widgetNode&&sp.from==span.to&&(sp.to==null||sp.to!=span.from)&&(sp.marker.inclusiveLeft||span.marker.inclusiveRight)&&lineIsHiddenInner(doc,line,sp)){return true}}}
function heightAtLine(lineObj){lineObj=visualLine(lineObj);var h=0,chunk=lineObj.parent;for(var i=0;i<chunk.lines.length;++i){var line=chunk.lines[i];if(line==lineObj){break}
else{h+=line.height;}}
for(var p=chunk.parent;p;chunk=p,p=chunk.parent){for(var i$1=0;i$1<p.children.length;++i$1){var cur=p.children[i$1];if(cur==chunk){break}
else{h+=cur.height;}}}
return h}
function lineLength(line){if(line.height==0){return 0}
var len=line.text.length,merged,cur=line;while(merged=collapsedSpanAtStart(cur)){var found=merged.find(0,true);cur=found.from.line;len+=found.from.ch-found.to.ch;}
cur=line;while(merged=collapsedSpanAtEnd(cur)){var found$1=merged.find(0,true);len-=cur.text.length-found$1.from.ch;cur=found$1.to.line;len+=cur.text.length-found$1.to.ch;}
return len}
function findMaxLine(cm){var d=cm.display,doc=cm.doc;d.maxLine=getLine(doc,doc.first);d.maxLineLength=lineLength(d.maxLine);d.maxLineChanged=true;doc.iter(function(line){var len=lineLength(line);if(len>d.maxLineLength){d.maxLineLength=len;d.maxLine=line;}});}
var Line=function(text,markedSpans,estimateHeight){this.text=text;attachMarkedSpans(this,markedSpans);this.height=estimateHeight?estimateHeight(this):1;};Line.prototype.lineNo=function(){return lineNo(this)};eventMixin(Line);function updateLine(line,text,markedSpans,estimateHeight){line.text=text;if(line.stateAfter){line.stateAfter=null;}
if(line.styles){line.styles=null;}
if(line.order!=null){line.order=null;}
detachMarkedSpans(line);attachMarkedSpans(line,markedSpans);var estHeight=estimateHeight?estimateHeight(line):1;if(estHeight!=line.height){updateLineHeight(line,estHeight);}}
function cleanUpLine(line){line.parent=null;detachMarkedSpans(line);}
var styleToClassCache={},styleToClassCacheWithMode={};function interpretTokenStyle(style,options){if(!style||/^\s*$/.test(style)){return null}
var cache=options.addModeClass?styleToClassCacheWithMode:styleToClassCache;return cache[style]||(cache[style]=style.replace(/\S+/g,"cm-$&"))}
function buildLineContent(cm,lineView){var content=eltP("span",null,null,webkit?"padding-right: .1px":null);var builder={pre:eltP("pre",[content],"CodeMirror-line"),content:content,col:0,pos:0,cm:cm,trailingSpace:false,splitSpaces:cm.getOption("lineWrapping")};lineView.measure={};for(var i=0;i<=(lineView.rest?lineView.rest.length:0);i++){var line=i?lineView.rest[i-1]:lineView.line,order=(void 0);builder.pos=0;builder.addToken=buildToken;if(hasBadBidiRects(cm.display.measure)&&(order=getOrder(line,cm.doc.direction)))
{builder.addToken=buildTokenBadBidi(builder.addToken,order);}
builder.map=[];var allowFrontierUpdate=lineView!=cm.display.externalMeasured&&lineNo(line);insertLineContent(line,builder,getLineStyles(cm,line,allowFrontierUpdate));if(line.styleClasses){if(line.styleClasses.bgClass)
{builder.bgClass=joinClasses(line.styleClasses.bgClass,builder.bgClass||"");}
if(line.styleClasses.textClass)
{builder.textClass=joinClasses(line.styleClasses.textClass,builder.textClass||"");}}
if(builder.map.length==0)
{builder.map.push(0,0,builder.content.appendChild(zeroWidthElement(cm.display.measure)));}
if(i==0){lineView.measure.map=builder.map;lineView.measure.cache={};}else{(lineView.measure.maps||(lineView.measure.maps=[])).push(builder.map);(lineView.measure.caches||(lineView.measure.caches=[])).push({});}}
if(webkit){var last=builder.content.lastChild;if(/\bcm-tab\b/.test(last.className)||(last.querySelector&&last.querySelector(".cm-tab")))
{builder.content.className="cm-tab-wrap-hack";}}
signal(cm,"renderLine",cm,lineView.line,builder.pre);if(builder.pre.className)
{builder.textClass=joinClasses(builder.pre.className,builder.textClass||"");}
return builder}
function defaultSpecialCharPlaceholder(ch){var token=elt("span","\u2022","cm-invalidchar");token.title="\\u"+ch.charCodeAt(0).toString(16);token.setAttribute("aria-label",token.title);return token}
function buildToken(builder,text,style,startStyle,endStyle,css,attributes){if(!text){return}
var displayText=builder.splitSpaces?splitSpaces(text,builder.trailingSpace):text;var special=builder.cm.state.specialChars,mustWrap=false;var content;if(!special.test(text)){builder.col+=text.length;content=document.createTextNode(displayText);builder.map.push(builder.pos,builder.pos+text.length,content);if(ie&&ie_version<9){mustWrap=true;}
builder.pos+=text.length;}else{content=document.createDocumentFragment();var pos=0;while(true){special.lastIndex=pos;var m=special.exec(text);var skipped=m?m.index-pos:text.length-pos;if(skipped){var txt=document.createTextNode(displayText.slice(pos,pos+skipped));if(ie&&ie_version<9){content.appendChild(elt("span",[txt]));}
else{content.appendChild(txt);}
builder.map.push(builder.pos,builder.pos+skipped,txt);builder.col+=skipped;builder.pos+=skipped;}
if(!m){break}
pos+=skipped+1;var txt$1=(void 0);if(m[0]=="\t"){var tabSize=builder.cm.options.tabSize,tabWidth=tabSize-builder.col%tabSize;txt$1=content.appendChild(elt("span",spaceStr(tabWidth),"cm-tab"));txt$1.setAttribute("role","presentation");txt$1.setAttribute("cm-text","\t");builder.col+=tabWidth;}else if(m[0]=="\r"||m[0]=="\n"){txt$1=content.appendChild(elt("span",m[0]=="\r"?"\u240d":"\u2424","cm-invalidchar"));txt$1.setAttribute("cm-text",m[0]);builder.col+=1;}else{txt$1=builder.cm.options.specialCharPlaceholder(m[0]);txt$1.setAttribute("cm-text",m[0]);if(ie&&ie_version<9){content.appendChild(elt("span",[txt$1]));}
else{content.appendChild(txt$1);}
builder.col+=1;}
builder.map.push(builder.pos,builder.pos+1,txt$1);builder.pos++;}}
builder.trailingSpace=displayText.charCodeAt(text.length-1)==32;if(style||startStyle||endStyle||mustWrap||css||attributes){var fullStyle=style||"";if(startStyle){fullStyle+=startStyle;}
if(endStyle){fullStyle+=endStyle;}
var token=elt("span",[content],fullStyle,css);if(attributes){for(var attr in attributes){if(attributes.hasOwnProperty(attr)&&attr!="style"&&attr!="class")
{token.setAttribute(attr,attributes[attr]);}}}
return builder.content.appendChild(token)}
builder.content.appendChild(content);}
function splitSpaces(text,trailingBefore){if(text.length>1&&!/  /.test(text)){return text}
var spaceBefore=trailingBefore,result="";for(var i=0;i<text.length;i++){var ch=text.charAt(i);if(ch==" "&&spaceBefore&&(i==text.length-1||text.charCodeAt(i+1)==32))
{ch="\u00a0";}
result+=ch;spaceBefore=ch==" ";}
return result}
function buildTokenBadBidi(inner,order){return function(builder,text,style,startStyle,endStyle,css,attributes){style=style?style+" cm-force-border":"cm-force-border";var start=builder.pos,end=start+text.length;for(;;){var part=(void 0);for(var i=0;i<order.length;i++){part=order[i];if(part.to>start&&part.from<=start){break}}
if(part.to>=end){return inner(builder,text,style,startStyle,endStyle,css,attributes)}
inner(builder,text.slice(0,part.to-start),style,startStyle,null,css,attributes);startStyle=null;text=text.slice(part.to-start);start=part.to;}}}
function buildCollapsedSpan(builder,size,marker,ignoreWidget){var widget=!ignoreWidget&&marker.widgetNode;if(widget){builder.map.push(builder.pos,builder.pos+size,widget);}
if(!ignoreWidget&&builder.cm.display.input.needsContentAttribute){if(!widget)
{widget=builder.content.appendChild(document.createElement("span"));}
widget.setAttribute("cm-marker",marker.id);}
if(widget){builder.cm.display.input.setUneditable(widget);builder.content.appendChild(widget);}
builder.pos+=size;builder.trailingSpace=false;}
function insertLineContent(line,builder,styles){var spans=line.markedSpans,allText=line.text,at=0;if(!spans){for(var i$1=1;i$1<styles.length;i$1+=2)
{builder.addToken(builder,allText.slice(at,at=styles[i$1]),interpretTokenStyle(styles[i$1+1],builder.cm.options));}
return}
var len=allText.length,pos=0,i=1,text="",style,css;var nextChange=0,spanStyle,spanEndStyle,spanStartStyle,collapsed,attributes;for(;;){if(nextChange==pos){spanStyle=spanEndStyle=spanStartStyle=css="";attributes=null;collapsed=null;nextChange=Infinity;var foundBookmarks=[],endStyles=(void 0);for(var j=0;j<spans.length;++j){var sp=spans[j],m=sp.marker;if(m.type=="bookmark"&&sp.from==pos&&m.widgetNode){foundBookmarks.push(m);}else if(sp.from<=pos&&(sp.to==null||sp.to>pos||m.collapsed&&sp.to==pos&&sp.from==pos)){if(sp.to!=null&&sp.to!=pos&&nextChange>sp.to){nextChange=sp.to;spanEndStyle="";}
if(m.className){spanStyle+=" "+m.className;}
if(m.css){css=(css?css+";":"")+m.css;}
if(m.startStyle&&sp.from==pos){spanStartStyle+=" "+m.startStyle;}
if(m.endStyle&&sp.to==nextChange){(endStyles||(endStyles=[])).push(m.endStyle,sp.to);}
if(m.title){(attributes||(attributes={})).title=m.title;}
if(m.attributes){for(var attr in m.attributes)
{(attributes||(attributes={}))[attr]=m.attributes[attr];}}
if(m.collapsed&&(!collapsed||compareCollapsedMarkers(collapsed.marker,m)<0))
{collapsed=sp;}}else if(sp.from>pos&&nextChange>sp.from){nextChange=sp.from;}}
if(endStyles){for(var j$1=0;j$1<endStyles.length;j$1+=2)
{if(endStyles[j$1+1]==nextChange){spanEndStyle+=" "+endStyles[j$1];}}}
if(!collapsed||collapsed.from==pos){for(var j$2=0;j$2<foundBookmarks.length;++j$2)
{buildCollapsedSpan(builder,0,foundBookmarks[j$2]);}}
if(collapsed&&(collapsed.from||0)==pos){buildCollapsedSpan(builder,(collapsed.to==null?len+1:collapsed.to)-pos,collapsed.marker,collapsed.from==null);if(collapsed.to==null){return}
if(collapsed.to==pos){collapsed=false;}}}
if(pos>=len){break}
var upto=Math.min(len,nextChange);while(true){if(text){var end=pos+text.length;if(!collapsed){var tokenText=end>upto?text.slice(0,upto-pos):text;builder.addToken(builder,tokenText,style?style+spanStyle:spanStyle,spanStartStyle,pos+tokenText.length==nextChange?spanEndStyle:"",css,attributes);}
if(end>=upto){text=text.slice(upto-pos);pos=upto;break}
pos=end;spanStartStyle="";}
text=allText.slice(at,at=styles[i++]);style=interpretTokenStyle(styles[i++],builder.cm.options);}}}
function LineView(doc,line,lineN){this.line=line;this.rest=visualLineContinued(line);this.size=this.rest?lineNo(lst(this.rest))-lineN+1:1;this.node=this.text=null;this.hidden=lineIsHidden(doc,line);}
function buildViewArray(cm,from,to){var array=[],nextPos;for(var pos=from;pos<to;pos=nextPos){var view=new LineView(cm.doc,getLine(cm.doc,pos),pos);nextPos=pos+view.size;array.push(view);}
return array}
var operationGroup=null;function pushOperation(op){if(operationGroup){operationGroup.ops.push(op);}else{op.ownsGroup=operationGroup={ops:[op],delayedCallbacks:[]};}}
function fireCallbacksForOps(group){var callbacks=group.delayedCallbacks,i=0;do{for(;i<callbacks.length;i++)
{callbacks[i].call(null);}
for(var j=0;j<group.ops.length;j++){var op=group.ops[j];if(op.cursorActivityHandlers)
{while(op.cursorActivityCalled<op.cursorActivityHandlers.length)
{op.cursorActivityHandlers[op.cursorActivityCalled++].call(null,op.cm);}}}}while(i<callbacks.length)}
function finishOperation(op,endCb){var group=op.ownsGroup;if(!group){return}
try{fireCallbacksForOps(group);}
finally{operationGroup=null;endCb(group);}}
var orphanDelayedCallbacks=null;function signalLater(emitter,type){var arr=getHandlers(emitter,type);if(!arr.length){return}
var args=Array.prototype.slice.call(arguments,2),list;if(operationGroup){list=operationGroup.delayedCallbacks;}else if(orphanDelayedCallbacks){list=orphanDelayedCallbacks;}else{list=orphanDelayedCallbacks=[];setTimeout(fireOrphanDelayed,0);}
var loop=function(i){list.push(function(){return arr[i].apply(null,args);});};for(var i=0;i<arr.length;++i)
loop(i);}
function fireOrphanDelayed(){var delayed=orphanDelayedCallbacks;orphanDelayedCallbacks=null;for(var i=0;i<delayed.length;++i){delayed[i]();}}
function updateLineForChanges(cm,lineView,lineN,dims){for(var j=0;j<lineView.changes.length;j++){var type=lineView.changes[j];if(type=="text"){updateLineText(cm,lineView);}
else if(type=="gutter"){updateLineGutter(cm,lineView,lineN,dims);}
else if(type=="class"){updateLineClasses(cm,lineView);}
else if(type=="widget"){updateLineWidgets(cm,lineView,dims);}}
lineView.changes=null;}
function ensureLineWrapped(lineView){if(lineView.node==lineView.text){lineView.node=elt("div",null,null,"position: relative");if(lineView.text.parentNode)
{lineView.text.parentNode.replaceChild(lineView.node,lineView.text);}
lineView.node.appendChild(lineView.text);if(ie&&ie_version<8){lineView.node.style.zIndex=2;}}
return lineView.node}
function updateLineBackground(cm,lineView){var cls=lineView.bgClass?lineView.bgClass+" "+(lineView.line.bgClass||""):lineView.line.bgClass;if(cls){cls+=" CodeMirror-linebackground";}
if(lineView.background){if(cls){lineView.background.className=cls;}
else{lineView.background.parentNode.removeChild(lineView.background);lineView.background=null;}}else if(cls){var wrap=ensureLineWrapped(lineView);lineView.background=wrap.insertBefore(elt("div",null,cls),wrap.firstChild);cm.display.input.setUneditable(lineView.background);}}
function getLineContent(cm,lineView){var ext=cm.display.externalMeasured;if(ext&&ext.line==lineView.line){cm.display.externalMeasured=null;lineView.measure=ext.measure;return ext.built}
return buildLineContent(cm,lineView)}
function updateLineText(cm,lineView){var cls=lineView.text.className;var built=getLineContent(cm,lineView);if(lineView.text==lineView.node){lineView.node=built.pre;}
lineView.text.parentNode.replaceChild(built.pre,lineView.text);lineView.text=built.pre;if(built.bgClass!=lineView.bgClass||built.textClass!=lineView.textClass){lineView.bgClass=built.bgClass;lineView.textClass=built.textClass;updateLineClasses(cm,lineView);}else if(cls){lineView.text.className=cls;}}
function updateLineClasses(cm,lineView){updateLineBackground(cm,lineView);if(lineView.line.wrapClass)
{ensureLineWrapped(lineView).className=lineView.line.wrapClass;}
else if(lineView.node!=lineView.text)
{lineView.node.className="";}
var textClass=lineView.textClass?lineView.textClass+" "+(lineView.line.textClass||""):lineView.line.textClass;lineView.text.className=textClass||"";}
function updateLineGutter(cm,lineView,lineN,dims){if(lineView.gutter){lineView.node.removeChild(lineView.gutter);lineView.gutter=null;}
if(lineView.gutterBackground){lineView.node.removeChild(lineView.gutterBackground);lineView.gutterBackground=null;}
if(lineView.line.gutterClass){var wrap=ensureLineWrapped(lineView);lineView.gutterBackground=elt("div",null,"CodeMirror-gutter-background "+lineView.line.gutterClass,("left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px; width: "+(dims.gutterTotalWidth)+"px"));cm.display.input.setUneditable(lineView.gutterBackground);wrap.insertBefore(lineView.gutterBackground,lineView.text);}
var markers=lineView.line.gutterMarkers;if(cm.options.lineNumbers||markers){var wrap$1=ensureLineWrapped(lineView);var gutterWrap=lineView.gutter=elt("div",null,"CodeMirror-gutter-wrapper",("left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px"));gutterWrap.setAttribute("aria-hidden","true");cm.display.input.setUneditable(gutterWrap);wrap$1.insertBefore(gutterWrap,lineView.text);if(lineView.line.gutterClass)
{gutterWrap.className+=" "+lineView.line.gutterClass;}
if(cm.options.lineNumbers&&(!markers||!markers["CodeMirror-linenumbers"]))
{lineView.lineNumber=gutterWrap.appendChild(elt("div",lineNumberFor(cm.options,lineN),"CodeMirror-linenumber CodeMirror-gutter-elt",("left: "+(dims.gutterLeft["CodeMirror-linenumbers"])+"px; width: "+(cm.display.lineNumInnerWidth)+"px")));}
if(markers){for(var k=0;k<cm.display.gutterSpecs.length;++k){var id=cm.display.gutterSpecs[k].className,found=markers.hasOwnProperty(id)&&markers[id];if(found)
{gutterWrap.appendChild(elt("div",[found],"CodeMirror-gutter-elt",("left: "+(dims.gutterLeft[id])+"px; width: "+(dims.gutterWidth[id])+"px")));}}}}}
function updateLineWidgets(cm,lineView,dims){if(lineView.alignable){lineView.alignable=null;}
var isWidget=classTest("CodeMirror-linewidget");for(var node=lineView.node.firstChild,next=(void 0);node;node=next){next=node.nextSibling;if(isWidget.test(node.className)){lineView.node.removeChild(node);}}
insertLineWidgets(cm,lineView,dims);}
function buildLineElement(cm,lineView,lineN,dims){var built=getLineContent(cm,lineView);lineView.text=lineView.node=built.pre;if(built.bgClass){lineView.bgClass=built.bgClass;}
if(built.textClass){lineView.textClass=built.textClass;}
updateLineClasses(cm,lineView);updateLineGutter(cm,lineView,lineN,dims);insertLineWidgets(cm,lineView,dims);return lineView.node}
function insertLineWidgets(cm,lineView,dims){insertLineWidgetsFor(cm,lineView.line,lineView,dims,true);if(lineView.rest){for(var i=0;i<lineView.rest.length;i++)
{insertLineWidgetsFor(cm,lineView.rest[i],lineView,dims,false);}}}
function insertLineWidgetsFor(cm,line,lineView,dims,allowAbove){if(!line.widgets){return}
var wrap=ensureLineWrapped(lineView);for(var i=0,ws=line.widgets;i<ws.length;++i){var widget=ws[i],node=elt("div",[widget.node],"CodeMirror-linewidget"+(widget.className?" "+widget.className:""));if(!widget.handleMouseEvents){node.setAttribute("cm-ignore-events","true");}
positionLineWidget(widget,node,lineView,dims);cm.display.input.setUneditable(node);if(allowAbove&&widget.above)
{wrap.insertBefore(node,lineView.gutter||lineView.text);}
else
{wrap.appendChild(node);}
signalLater(widget,"redraw");}}
function positionLineWidget(widget,node,lineView,dims){if(widget.noHScroll){(lineView.alignable||(lineView.alignable=[])).push(node);var width=dims.wrapperWidth;node.style.left=dims.fixedPos+"px";if(!widget.coverGutter){width-=dims.gutterTotalWidth;node.style.paddingLeft=dims.gutterTotalWidth+"px";}
node.style.width=width+"px";}
if(widget.coverGutter){node.style.zIndex=5;node.style.position="relative";if(!widget.noHScroll){node.style.marginLeft=-dims.gutterTotalWidth+"px";}}}
function widgetHeight(widget){if(widget.height!=null){return widget.height}
var cm=widget.doc.cm;if(!cm){return 0}
if(!contains(document.body,widget.node)){var parentStyle="position: relative;";if(widget.coverGutter)
{parentStyle+="margin-left: -"+cm.display.gutters.offsetWidth+"px;";}
if(widget.noHScroll)
{parentStyle+="width: "+cm.display.wrapper.clientWidth+"px;";}
removeChildrenAndAdd(cm.display.measure,elt("div",[widget.node],null,parentStyle));}
return widget.height=widget.node.parentNode.offsetHeight}
function eventInWidget(display,e){for(var n=e_target(e);n!=display.wrapper;n=n.parentNode){if(!n||(n.nodeType==1&&n.getAttribute("cm-ignore-events")=="true")||(n.parentNode==display.sizer&&n!=display.mover))
{return true}}}
function paddingTop(display){return display.lineSpace.offsetTop}
function paddingVert(display){return display.mover.offsetHeight-display.lineSpace.offsetHeight}
function paddingH(display){if(display.cachedPaddingH){return display.cachedPaddingH}
var e=removeChildrenAndAdd(display.measure,elt("pre","x","CodeMirror-line-like"));var style=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle;var data={left:parseInt(style.paddingLeft),right:parseInt(style.paddingRight)};if(!isNaN(data.left)&&!isNaN(data.right)){display.cachedPaddingH=data;}
return data}
function scrollGap(cm){return scrollerGap-cm.display.nativeBarWidth}
function displayWidth(cm){return cm.display.scroller.clientWidth-scrollGap(cm)-cm.display.barWidth}
function displayHeight(cm){return cm.display.scroller.clientHeight-scrollGap(cm)-cm.display.barHeight}
function ensureLineHeights(cm,lineView,rect){var wrapping=cm.options.lineWrapping;var curWidth=wrapping&&displayWidth(cm);if(!lineView.measure.heights||wrapping&&lineView.measure.width!=curWidth){var heights=lineView.measure.heights=[];if(wrapping){lineView.measure.width=curWidth;var rects=lineView.text.firstChild.getClientRects();for(var i=0;i<rects.length-1;i++){var cur=rects[i],next=rects[i+1];if(Math.abs(cur.bottom-next.bottom)>2)
{heights.push((cur.bottom+next.top)/2-rect.top);}}}
heights.push(rect.bottom-rect.top);}}
function mapFromLineView(lineView,line,lineN){if(lineView.line==line)
{return{map:lineView.measure.map,cache:lineView.measure.cache}}
if(lineView.rest){for(var i=0;i<lineView.rest.length;i++)
{if(lineView.rest[i]==line)
{return{map:lineView.measure.maps[i],cache:lineView.measure.caches[i]}}}
for(var i$1=0;i$1<lineView.rest.length;i$1++)
{if(lineNo(lineView.rest[i$1])>lineN)
{return{map:lineView.measure.maps[i$1],cache:lineView.measure.caches[i$1],before:true}}}}}
function updateExternalMeasurement(cm,line){line=visualLine(line);var lineN=lineNo(line);var view=cm.display.externalMeasured=new LineView(cm.doc,line,lineN);view.lineN=lineN;var built=view.built=buildLineContent(cm,view);view.text=built.pre;removeChildrenAndAdd(cm.display.lineMeasure,built.pre);return view}
function measureChar(cm,line,ch,bias){return measureCharPrepared(cm,prepareMeasureForLine(cm,line),ch,bias)}
function findViewForLine(cm,lineN){if(lineN>=cm.display.viewFrom&&lineN<cm.display.viewTo)
{return cm.display.view[findViewIndex(cm,lineN)]}
var ext=cm.display.externalMeasured;if(ext&&lineN>=ext.lineN&&lineN<ext.lineN+ext.size)
{return ext}}
function prepareMeasureForLine(cm,line){var lineN=lineNo(line);var view=findViewForLine(cm,lineN);if(view&&!view.text){view=null;}else if(view&&view.changes){updateLineForChanges(cm,view,lineN,getDimensions(cm));cm.curOp.forceUpdate=true;}
if(!view)
{view=updateExternalMeasurement(cm,line);}
var info=mapFromLineView(view,line,lineN);return{line:line,view:view,rect:null,map:info.map,cache:info.cache,before:info.before,hasHeights:false}}
function measureCharPrepared(cm,prepared,ch,bias,varHeight){if(prepared.before){ch=-1;}
var key=ch+(bias||""),found;if(prepared.cache.hasOwnProperty(key)){found=prepared.cache[key];}else{if(!prepared.rect)
{prepared.rect=prepared.view.text.getBoundingClientRect();}
if(!prepared.hasHeights){ensureLineHeights(cm,prepared.view,prepared.rect);prepared.hasHeights=true;}
found=measureCharInner(cm,prepared,ch,bias);if(!found.bogus){prepared.cache[key]=found;}}
return{left:found.left,right:found.right,top:varHeight?found.rtop:found.top,bottom:varHeight?found.rbottom:found.bottom}}
var nullRect={left:0,right:0,top:0,bottom:0};function nodeAndOffsetInLineMap(map,ch,bias){var node,start,end,collapse,mStart,mEnd;for(var i=0;i<map.length;i+=3){mStart=map[i];mEnd=map[i+1];if(ch<mStart){start=0;end=1;collapse="left";}else if(ch<mEnd){start=ch-mStart;end=start+1;}else if(i==map.length-3||ch==mEnd&&map[i+3]>ch){end=mEnd-mStart;start=end-1;if(ch>=mEnd){collapse="right";}}
if(start!=null){node=map[i+2];if(mStart==mEnd&&bias==(node.insertLeft?"left":"right"))
{collapse=bias;}
if(bias=="left"&&start==0)
{while(i&&map[i-2]==map[i-3]&&map[i-1].insertLeft){node=map[(i-=3)+2];collapse="left";}}
if(bias=="right"&&start==mEnd-mStart)
{while(i<map.length-3&&map[i+3]==map[i+4]&&!map[i+5].insertLeft){node=map[(i+=3)+2];collapse="right";}}
break}}
return{node:node,start:start,end:end,collapse:collapse,coverStart:mStart,coverEnd:mEnd}}
function getUsefulRect(rects,bias){var rect=nullRect;if(bias=="left"){for(var i=0;i<rects.length;i++){if((rect=rects[i]).left!=rect.right){break}}}else{for(var i$1=rects.length-1;i$1>=0;i$1--){if((rect=rects[i$1]).left!=rect.right){break}}}
return rect}
function measureCharInner(cm,prepared,ch,bias){var place=nodeAndOffsetInLineMap(prepared.map,ch,bias);var node=place.node,start=place.start,end=place.end,collapse=place.collapse;var rect;if(node.nodeType==3){for(var i$1=0;i$1<4;i$1++){while(start&&isExtendingChar(prepared.line.text.charAt(place.coverStart+start))){--start;}
while(place.coverStart+end<place.coverEnd&&isExtendingChar(prepared.line.text.charAt(place.coverStart+end))){++end;}
if(ie&&ie_version<9&&start==0&&end==place.coverEnd-place.coverStart)
{rect=node.parentNode.getBoundingClientRect();}
else
{rect=getUsefulRect(range(node,start,end).getClientRects(),bias);}
if(rect.left||rect.right||start==0){break}
end=start;start=start-1;collapse="right";}
if(ie&&ie_version<11){rect=maybeUpdateRectForZooming(cm.display.measure,rect);}}else{if(start>0){collapse=bias="right";}
var rects;if(cm.options.lineWrapping&&(rects=node.getClientRects()).length>1)
{rect=rects[bias=="right"?rects.length-1:0];}
else
{rect=node.getBoundingClientRect();}}
if(ie&&ie_version<9&&!start&&(!rect||!rect.left&&!rect.right)){var rSpan=node.parentNode.getClientRects()[0];if(rSpan)
{rect={left:rSpan.left,right:rSpan.left+charWidth(cm.display),top:rSpan.top,bottom:rSpan.bottom};}
else
{rect=nullRect;}}
var rtop=rect.top-prepared.rect.top,rbot=rect.bottom-prepared.rect.top;var mid=(rtop+rbot)/2;var heights=prepared.view.measure.heights;var i=0;for(;i<heights.length-1;i++)
{if(mid<heights[i]){break}}
var top=i?heights[i-1]:0,bot=heights[i];var result={left:(collapse=="right"?rect.right:rect.left)-prepared.rect.left,right:(collapse=="left"?rect.left:rect.right)-prepared.rect.left,top:top,bottom:bot};if(!rect.left&&!rect.right){result.bogus=true;}
if(!cm.options.singleCursorHeightPerLine){result.rtop=rtop;result.rbottom=rbot;}
return result}
function maybeUpdateRectForZooming(measure,rect){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!hasBadZoomedRects(measure))
{return rect}
var scaleX=screen.logicalXDPI/screen.deviceXDPI;var scaleY=screen.logicalYDPI/screen.deviceYDPI;return{left:rect.left*scaleX,right:rect.right*scaleX,top:rect.top*scaleY,bottom:rect.bottom*scaleY}}
function clearLineMeasurementCacheFor(lineView){if(lineView.measure){lineView.measure.cache={};lineView.measure.heights=null;if(lineView.rest){for(var i=0;i<lineView.rest.length;i++)
{lineView.measure.caches[i]={};}}}}
function clearLineMeasurementCache(cm){cm.display.externalMeasure=null;removeChildren(cm.display.lineMeasure);for(var i=0;i<cm.display.view.length;i++)
{clearLineMeasurementCacheFor(cm.display.view[i]);}}
function clearCaches(cm){clearLineMeasurementCache(cm);cm.display.cachedCharWidth=cm.display.cachedTextHeight=cm.display.cachedPaddingH=null;if(!cm.options.lineWrapping){cm.display.maxLineChanged=true;}
cm.display.lineNumChars=null;}
function pageScrollX(doc){if(chrome&&android){return-(doc.body.getBoundingClientRect().left-parseInt(getComputedStyle(doc.body).marginLeft))}
return doc.defaultView.pageXOffset||(doc.documentElement||doc.body).scrollLeft}
function pageScrollY(doc){if(chrome&&android){return-(doc.body.getBoundingClientRect().top-parseInt(getComputedStyle(doc.body).marginTop))}
return doc.defaultView.pageYOffset||(doc.documentElement||doc.body).scrollTop}
function widgetTopHeight(lineObj){var ref=visualLine(lineObj);var widgets=ref.widgets;var height=0;if(widgets){for(var i=0;i<widgets.length;++i){if(widgets[i].above)
{height+=widgetHeight(widgets[i]);}}}
return height}
function intoCoordSystem(cm,lineObj,rect,context,includeWidgets){if(!includeWidgets){var height=widgetTopHeight(lineObj);rect.top+=height;rect.bottom+=height;}
if(context=="line"){return rect}
if(!context){context="local";}
var yOff=heightAtLine(lineObj);if(context=="local"){yOff+=paddingTop(cm.display);}
else{yOff-=cm.display.viewOffset;}
if(context=="page"||context=="window"){var lOff=cm.display.lineSpace.getBoundingClientRect();yOff+=lOff.top+(context=="window"?0:pageScrollY(doc(cm)));var xOff=lOff.left+(context=="window"?0:pageScrollX(doc(cm)));rect.left+=xOff;rect.right+=xOff;}
rect.top+=yOff;rect.bottom+=yOff;return rect}
function fromCoordSystem(cm,coords,context){if(context=="div"){return coords}
var left=coords.left,top=coords.top;if(context=="page"){left-=pageScrollX(doc(cm));top-=pageScrollY(doc(cm));}else if(context=="local"||!context){var localBox=cm.display.sizer.getBoundingClientRect();left+=localBox.left;top+=localBox.top;}
var lineSpaceBox=cm.display.lineSpace.getBoundingClientRect();return{left:left-lineSpaceBox.left,top:top-lineSpaceBox.top}}
function charCoords(cm,pos,context,lineObj,bias){if(!lineObj){lineObj=getLine(cm.doc,pos.line);}
return intoCoordSystem(cm,lineObj,measureChar(cm,lineObj,pos.ch,bias),context)}
function cursorCoords(cm,pos,context,lineObj,preparedMeasure,varHeight){lineObj=lineObj||getLine(cm.doc,pos.line);if(!preparedMeasure){preparedMeasure=prepareMeasureForLine(cm,lineObj);}
function get(ch,right){var m=measureCharPrepared(cm,preparedMeasure,ch,right?"right":"left",varHeight);if(right){m.left=m.right;}else{m.right=m.left;}
return intoCoordSystem(cm,lineObj,m,context)}
var order=getOrder(lineObj,cm.doc.direction),ch=pos.ch,sticky=pos.sticky;if(ch>=lineObj.text.length){ch=lineObj.text.length;sticky="before";}else if(ch<=0){ch=0;sticky="after";}
if(!order){return get(sticky=="before"?ch-1:ch,sticky=="before")}
function getBidi(ch,partPos,invert){var part=order[partPos],right=part.level==1;return get(invert?ch-1:ch,right!=invert)}
var partPos=getBidiPartAt(order,ch,sticky);var other=bidiOther;var val=getBidi(ch,partPos,sticky=="before");if(other!=null){val.other=getBidi(ch,other,sticky!="before");}
return val}
function estimateCoords(cm,pos){var left=0;pos=clipPos(cm.doc,pos);if(!cm.options.lineWrapping){left=charWidth(cm.display)*pos.ch;}
var lineObj=getLine(cm.doc,pos.line);var top=heightAtLine(lineObj)+paddingTop(cm.display);return{left:left,right:left,top:top,bottom:top+lineObj.height}}
function PosWithInfo(line,ch,sticky,outside,xRel){var pos=Pos(line,ch,sticky);pos.xRel=xRel;if(outside){pos.outside=outside;}
return pos}
function coordsChar(cm,x,y){var doc=cm.doc;y+=cm.display.viewOffset;if(y<0){return PosWithInfo(doc.first,0,null,-1,-1)}
var lineN=lineAtHeight(doc,y),last=doc.first+doc.size-1;if(lineN>last)
{return PosWithInfo(doc.first+doc.size-1,getLine(doc,last).text.length,null,1,1)}
if(x<0){x=0;}
var lineObj=getLine(doc,lineN);for(;;){var found=coordsCharInner(cm,lineObj,lineN,x,y);var collapsed=collapsedSpanAround(lineObj,found.ch+(found.xRel>0||found.outside>0?1:0));if(!collapsed){return found}
var rangeEnd=collapsed.find(1);if(rangeEnd.line==lineN){return rangeEnd}
lineObj=getLine(doc,lineN=rangeEnd.line);}}
function wrappedLineExtent(cm,lineObj,preparedMeasure,y){y-=widgetTopHeight(lineObj);var end=lineObj.text.length;var begin=findFirst(function(ch){return measureCharPrepared(cm,preparedMeasure,ch-1).bottom<=y;},end,0);end=findFirst(function(ch){return measureCharPrepared(cm,preparedMeasure,ch).top>y;},begin,end);return{begin:begin,end:end}}
function wrappedLineExtentChar(cm,lineObj,preparedMeasure,target){if(!preparedMeasure){preparedMeasure=prepareMeasureForLine(cm,lineObj);}
var targetTop=intoCoordSystem(cm,lineObj,measureCharPrepared(cm,preparedMeasure,target),"line").top;return wrappedLineExtent(cm,lineObj,preparedMeasure,targetTop)}
function boxIsAfter(box,x,y,left){return box.bottom<=y?false:box.top>y?true:(left?box.left:box.right)>x}
function coordsCharInner(cm,lineObj,lineNo,x,y){y-=heightAtLine(lineObj);var preparedMeasure=prepareMeasureForLine(cm,lineObj);var widgetHeight=widgetTopHeight(lineObj);var begin=0,end=lineObj.text.length,ltr=true;var order=getOrder(lineObj,cm.doc.direction);if(order){var part=(cm.options.lineWrapping?coordsBidiPartWrapped:coordsBidiPart)
(cm,lineObj,lineNo,preparedMeasure,order,x,y);ltr=part.level!=1;begin=ltr?part.from:part.to-1;end=ltr?part.to:part.from-1;}
var chAround=null,boxAround=null;var ch=findFirst(function(ch){var box=measureCharPrepared(cm,preparedMeasure,ch);box.top+=widgetHeight;box.bottom+=widgetHeight;if(!boxIsAfter(box,x,y,false)){return false}
if(box.top<=y&&box.left<=x){chAround=ch;boxAround=box;}
return true},begin,end);var baseX,sticky,outside=false;if(boxAround){var atLeft=x-boxAround.left<boxAround.right-x,atStart=atLeft==ltr;ch=chAround+(atStart?0:1);sticky=atStart?"after":"before";baseX=atLeft?boxAround.left:boxAround.right;}else{if(!ltr&&(ch==end||ch==begin)){ch++;}
sticky=ch==0?"after":ch==lineObj.text.length?"before":(measureCharPrepared(cm,preparedMeasure,ch-(ltr?1:0)).bottom+widgetHeight<=y)==ltr?"after":"before";var coords=cursorCoords(cm,Pos(lineNo,ch,sticky),"line",lineObj,preparedMeasure);baseX=coords.left;outside=y<coords.top?-1:y>=coords.bottom?1:0;}
ch=skipExtendingChars(lineObj.text,ch,1);return PosWithInfo(lineNo,ch,sticky,outside,x-baseX)}
function coordsBidiPart(cm,lineObj,lineNo,preparedMeasure,order,x,y){var index=findFirst(function(i){var part=order[i],ltr=part.level!=1;return boxIsAfter(cursorCoords(cm,Pos(lineNo,ltr?part.to:part.from,ltr?"before":"after"),"line",lineObj,preparedMeasure),x,y,true)},0,order.length-1);var part=order[index];if(index>0){var ltr=part.level!=1;var start=cursorCoords(cm,Pos(lineNo,ltr?part.from:part.to,ltr?"after":"before"),"line",lineObj,preparedMeasure);if(boxIsAfter(start,x,y,true)&&start.top>y)
{part=order[index-1];}}
return part}
function coordsBidiPartWrapped(cm,lineObj,_lineNo,preparedMeasure,order,x,y){var ref=wrappedLineExtent(cm,lineObj,preparedMeasure,y);var begin=ref.begin;var end=ref.end;if(/\s/.test(lineObj.text.charAt(end-1))){end--;}
var part=null,closestDist=null;for(var i=0;i<order.length;i++){var p=order[i];if(p.from>=end||p.to<=begin){continue}
var ltr=p.level!=1;var endX=measureCharPrepared(cm,preparedMeasure,ltr?Math.min(end,p.to)-1:Math.max(begin,p.from)).right;var dist=endX<x?x-endX+1e9:endX-x;if(!part||closestDist>dist){part=p;closestDist=dist;}}
if(!part){part=order[order.length-1];}
if(part.from<begin){part={from:begin,to:part.to,level:part.level};}
if(part.to>end){part={from:part.from,to:end,level:part.level};}
return part}
var measureText;function textHeight(display){if(display.cachedTextHeight!=null){return display.cachedTextHeight}
if(measureText==null){measureText=elt("pre",null,"CodeMirror-line-like");for(var i=0;i<49;++i){measureText.appendChild(document.createTextNode("x"));measureText.appendChild(elt("br"));}
measureText.appendChild(document.createTextNode("x"));}
removeChildrenAndAdd(display.measure,measureText);var height=measureText.offsetHeight/50;if(height>3){display.cachedTextHeight=height;}
removeChildren(display.measure);return height||1}
function charWidth(display){if(display.cachedCharWidth!=null){return display.cachedCharWidth}
var anchor=elt("span","xxxxxxxxxx");var pre=elt("pre",[anchor],"CodeMirror-line-like");removeChildrenAndAdd(display.measure,pre);var rect=anchor.getBoundingClientRect(),width=(rect.right-rect.left)/10;if(width>2){display.cachedCharWidth=width;}
return width||10}
function getDimensions(cm){var d=cm.display,left={},width={};var gutterLeft=d.gutters.clientLeft;for(var n=d.gutters.firstChild,i=0;n;n=n.nextSibling,++i){var id=cm.display.gutterSpecs[i].className;left[id]=n.offsetLeft+n.clientLeft+gutterLeft;width[id]=n.clientWidth;}
return{fixedPos:compensateForHScroll(d),gutterTotalWidth:d.gutters.offsetWidth,gutterLeft:left,gutterWidth:width,wrapperWidth:d.wrapper.clientWidth}}
function compensateForHScroll(display){return display.scroller.getBoundingClientRect().left-display.sizer.getBoundingClientRect().left}
function estimateHeight(cm){var th=textHeight(cm.display),wrapping=cm.options.lineWrapping;var perLine=wrapping&&Math.max(5,cm.display.scroller.clientWidth/charWidth(cm.display)-3);return function(line){if(lineIsHidden(cm.doc,line)){return 0}
var widgetsHeight=0;if(line.widgets){for(var i=0;i<line.widgets.length;i++){if(line.widgets[i].height){widgetsHeight+=line.widgets[i].height;}}}
if(wrapping)
{return widgetsHeight+(Math.ceil(line.text.length/perLine)||1)*th}
else
{return widgetsHeight+th}}}
function estimateLineHeights(cm){var doc=cm.doc,est=estimateHeight(cm);doc.iter(function(line){var estHeight=est(line);if(estHeight!=line.height){updateLineHeight(line,estHeight);}});}
function posFromMouse(cm,e,liberal,forRect){var display=cm.display;if(!liberal&&e_target(e).getAttribute("cm-not-content")=="true"){return null}
var x,y,space=display.lineSpace.getBoundingClientRect();try{x=e.clientX-space.left;y=e.clientY-space.top;}
catch(e$1){return null}
var coords=coordsChar(cm,x,y),line;if(forRect&&coords.xRel>0&&(line=getLine(cm.doc,coords.line).text).length==coords.ch){var colDiff=countColumn(line,line.length,cm.options.tabSize)-line.length;coords=Pos(coords.line,Math.max(0,Math.round((x-paddingH(cm.display).left)/charWidth(cm.display))-colDiff));}
return coords}
function findViewIndex(cm,n){if(n>=cm.display.viewTo){return null}
n-=cm.display.viewFrom;if(n<0){return null}
var view=cm.display.view;for(var i=0;i<view.length;i++){n-=view[i].size;if(n<0){return i}}}
function regChange(cm,from,to,lendiff){if(from==null){from=cm.doc.first;}
if(to==null){to=cm.doc.first+cm.doc.size;}
if(!lendiff){lendiff=0;}
var display=cm.display;if(lendiff&&to<display.viewTo&&(display.updateLineNumbers==null||display.updateLineNumbers>from))
{display.updateLineNumbers=from;}
cm.curOp.viewChanged=true;if(from>=display.viewTo){if(sawCollapsedSpans&&visualLineNo(cm.doc,from)<display.viewTo)
{resetView(cm);}}else if(to<=display.viewFrom){if(sawCollapsedSpans&&visualLineEndNo(cm.doc,to+lendiff)>display.viewFrom){resetView(cm);}else{display.viewFrom+=lendiff;display.viewTo+=lendiff;}}else if(from<=display.viewFrom&&to>=display.viewTo){resetView(cm);}else if(from<=display.viewFrom){var cut=viewCuttingPoint(cm,to,to+lendiff,1);if(cut){display.view=display.view.slice(cut.index);display.viewFrom=cut.lineN;display.viewTo+=lendiff;}else{resetView(cm);}}else if(to>=display.viewTo){var cut$1=viewCuttingPoint(cm,from,from,-1);if(cut$1){display.view=display.view.slice(0,cut$1.index);display.viewTo=cut$1.lineN;}else{resetView(cm);}}else{var cutTop=viewCuttingPoint(cm,from,from,-1);var cutBot=viewCuttingPoint(cm,to,to+lendiff,1);if(cutTop&&cutBot){display.view=display.view.slice(0,cutTop.index).concat(buildViewArray(cm,cutTop.lineN,cutBot.lineN)).concat(display.view.slice(cutBot.index));display.viewTo+=lendiff;}else{resetView(cm);}}
var ext=display.externalMeasured;if(ext){if(to<ext.lineN)
{ext.lineN+=lendiff;}
else if(from<ext.lineN+ext.size)
{display.externalMeasured=null;}}}
function regLineChange(cm,line,type){cm.curOp.viewChanged=true;var display=cm.display,ext=cm.display.externalMeasured;if(ext&&line>=ext.lineN&&line<ext.lineN+ext.size)
{display.externalMeasured=null;}
if(line<display.viewFrom||line>=display.viewTo){return}
var lineView=display.view[findViewIndex(cm,line)];if(lineView.node==null){return}
var arr=lineView.changes||(lineView.changes=[]);if(indexOf(arr,type)==-1){arr.push(type);}}
function resetView(cm){cm.display.viewFrom=cm.display.viewTo=cm.doc.first;cm.display.view=[];cm.display.viewOffset=0;}
function viewCuttingPoint(cm,oldN,newN,dir){var index=findViewIndex(cm,oldN),diff,view=cm.display.view;if(!sawCollapsedSpans||newN==cm.doc.first+cm.doc.size)
{return{index:index,lineN:newN}}
var n=cm.display.viewFrom;for(var i=0;i<index;i++)
{n+=view[i].size;}
if(n!=oldN){if(dir>0){if(index==view.length-1){return null}
diff=(n+view[index].size)-oldN;index++;}else{diff=n-oldN;}
oldN+=diff;newN+=diff;}
while(visualLineNo(cm.doc,newN)!=newN){if(index==(dir<0?0:view.length-1)){return null}
newN+=dir*view[index-(dir<0?1:0)].size;index+=dir;}
return{index:index,lineN:newN}}
function adjustView(cm,from,to){var display=cm.display,view=display.view;if(view.length==0||from>=display.viewTo||to<=display.viewFrom){display.view=buildViewArray(cm,from,to);display.viewFrom=from;}else{if(display.viewFrom>from)
{display.view=buildViewArray(cm,from,display.viewFrom).concat(display.view);}
else if(display.viewFrom<from)
{display.view=display.view.slice(findViewIndex(cm,from));}
display.viewFrom=from;if(display.viewTo<to)
{display.view=display.view.concat(buildViewArray(cm,display.viewTo,to));}
else if(display.viewTo>to)
{display.view=display.view.slice(0,findViewIndex(cm,to));}}
display.viewTo=to;}
function countDirtyView(cm){var view=cm.display.view,dirty=0;for(var i=0;i<view.length;i++){var lineView=view[i];if(!lineView.hidden&&(!lineView.node||lineView.changes)){++dirty;}}
return dirty}
function updateSelection(cm){cm.display.input.showSelection(cm.display.input.prepareSelection());}
function prepareSelection(cm,primary){if(primary===void 0)primary=true;var doc=cm.doc,result={};var curFragment=result.cursors=document.createDocumentFragment();var selFragment=result.selection=document.createDocumentFragment();var customCursor=cm.options.$customCursor;if(customCursor){primary=true;}
for(var i=0;i<doc.sel.ranges.length;i++){if(!primary&&i==doc.sel.primIndex){continue}
var range=doc.sel.ranges[i];if(range.from().line>=cm.display.viewTo||range.to().line<cm.display.viewFrom){continue}
var collapsed=range.empty();if(customCursor){var head=customCursor(cm,range);if(head){drawSelectionCursor(cm,head,curFragment);}}else if(collapsed||cm.options.showCursorWhenSelecting){drawSelectionCursor(cm,range.head,curFragment);}
if(!collapsed)
{drawSelectionRange(cm,range,selFragment);}}
return result}
function drawSelectionCursor(cm,head,output){var pos=cursorCoords(cm,head,"div",null,null,!cm.options.singleCursorHeightPerLine);var cursor=output.appendChild(elt("div","\u00a0","CodeMirror-cursor"));cursor.style.left=pos.left+"px";cursor.style.top=pos.top+"px";cursor.style.height=Math.max(0,pos.bottom-pos.top)*cm.options.cursorHeight+"px";if(/\bcm-fat-cursor\b/.test(cm.getWrapperElement().className)){var charPos=charCoords(cm,head,"div",null,null);var width=charPos.right-charPos.left;cursor.style.width=(width>0?width:cm.defaultCharWidth())+"px";}
if(pos.other){var otherCursor=output.appendChild(elt("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor"));otherCursor.style.display="";otherCursor.style.left=pos.other.left+"px";otherCursor.style.top=pos.other.top+"px";otherCursor.style.height=(pos.other.bottom-pos.other.top)*.85+"px";}}
function cmpCoords(a,b){return a.top-b.top||a.left-b.left}
function drawSelectionRange(cm,range,output){var display=cm.display,doc=cm.doc;var fragment=document.createDocumentFragment();var padding=paddingH(cm.display),leftSide=padding.left;var rightSide=Math.max(display.sizerWidth,displayWidth(cm)-display.sizer.offsetLeft)-padding.right;var docLTR=doc.direction=="ltr";function add(left,top,width,bottom){if(top<0){top=0;}
top=Math.round(top);bottom=Math.round(bottom);fragment.appendChild(elt("div",null,"CodeMirror-selected",("position: absolute; left: "+left+"px;\n                             top: "+top+"px; width: "+(width==null?rightSide-left:width)+"px;\n                             height: "+(bottom-top)+"px")));}
function drawForLine(line,fromArg,toArg){var lineObj=getLine(doc,line);var lineLen=lineObj.text.length;var start,end;function coords(ch,bias){return charCoords(cm,Pos(line,ch),"div",lineObj,bias)}
function wrapX(pos,dir,side){var extent=wrappedLineExtentChar(cm,lineObj,null,pos);var prop=(dir=="ltr")==(side=="after")?"left":"right";var ch=side=="after"?extent.begin:extent.end-(/\s/.test(lineObj.text.charAt(extent.end-1))?2:1);return coords(ch,prop)[prop]}
var order=getOrder(lineObj,doc.direction);iterateBidiSections(order,fromArg||0,toArg==null?lineLen:toArg,function(from,to,dir,i){var ltr=dir=="ltr";var fromPos=coords(from,ltr?"left":"right");var toPos=coords(to-1,ltr?"right":"left");var openStart=fromArg==null&&from==0,openEnd=toArg==null&&to==lineLen;var first=i==0,last=!order||i==order.length-1;if(toPos.top-fromPos.top<=3){var openLeft=(docLTR?openStart:openEnd)&&first;var openRight=(docLTR?openEnd:openStart)&&last;var left=openLeft?leftSide:(ltr?fromPos:toPos).left;var right=openRight?rightSide:(ltr?toPos:fromPos).right;add(left,fromPos.top,right-left,fromPos.bottom);}else{var topLeft,topRight,botLeft,botRight;if(ltr){topLeft=docLTR&&openStart&&first?leftSide:fromPos.left;topRight=docLTR?rightSide:wrapX(from,dir,"before");botLeft=docLTR?leftSide:wrapX(to,dir,"after");botRight=docLTR&&openEnd&&last?rightSide:toPos.right;}else{topLeft=!docLTR?leftSide:wrapX(from,dir,"before");topRight=!docLTR&&openStart&&first?rightSide:fromPos.right;botLeft=!docLTR&&openEnd&&last?leftSide:toPos.left;botRight=!docLTR?rightSide:wrapX(to,dir,"after");}
add(topLeft,fromPos.top,topRight-topLeft,fromPos.bottom);if(fromPos.bottom<toPos.top){add(leftSide,fromPos.bottom,null,toPos.top);}
add(botLeft,toPos.top,botRight-botLeft,toPos.bottom);}
if(!start||cmpCoords(fromPos,start)<0){start=fromPos;}
if(cmpCoords(toPos,start)<0){start=toPos;}
if(!end||cmpCoords(fromPos,end)<0){end=fromPos;}
if(cmpCoords(toPos,end)<0){end=toPos;}});return{start:start,end:end}}
var sFrom=range.from(),sTo=range.to();if(sFrom.line==sTo.line){drawForLine(sFrom.line,sFrom.ch,sTo.ch);}else{var fromLine=getLine(doc,sFrom.line),toLine=getLine(doc,sTo.line);var singleVLine=visualLine(fromLine)==visualLine(toLine);var leftEnd=drawForLine(sFrom.line,sFrom.ch,singleVLine?fromLine.text.length+1:null).end;var rightStart=drawForLine(sTo.line,singleVLine?0:null,sTo.ch).start;if(singleVLine){if(leftEnd.top<rightStart.top-2){add(leftEnd.right,leftEnd.top,null,leftEnd.bottom);add(leftSide,rightStart.top,rightStart.left,rightStart.bottom);}else{add(leftEnd.right,leftEnd.top,rightStart.left-leftEnd.right,leftEnd.bottom);}}
if(leftEnd.bottom<rightStart.top)
{add(leftSide,leftEnd.bottom,null,rightStart.top);}}
output.appendChild(fragment);}
function restartBlink(cm){if(!cm.state.focused){return}
var display=cm.display;clearInterval(display.blinker);var on=true;display.cursorDiv.style.visibility="";if(cm.options.cursorBlinkRate>0)
{display.blinker=setInterval(function(){if(!cm.hasFocus()){onBlur(cm);}
display.cursorDiv.style.visibility=(on=!on)?"":"hidden";},cm.options.cursorBlinkRate);}
else if(cm.options.cursorBlinkRate<0)
{display.cursorDiv.style.visibility="hidden";}}
function ensureFocus(cm){if(!cm.hasFocus()){cm.display.input.focus();if(!cm.state.focused){onFocus(cm);}}}
function delayBlurEvent(cm){cm.state.delayingBlurEvent=true;setTimeout(function(){if(cm.state.delayingBlurEvent){cm.state.delayingBlurEvent=false;if(cm.state.focused){onBlur(cm);}}},100);}
function onFocus(cm,e){if(cm.state.delayingBlurEvent&&!cm.state.draggingText){cm.state.delayingBlurEvent=false;}
if(cm.options.readOnly=="nocursor"){return}
if(!cm.state.focused){signal(cm,"focus",cm,e);cm.state.focused=true;addClass(cm.display.wrapper,"CodeMirror-focused");if(!cm.curOp&&cm.display.selForContextMenu!=cm.doc.sel){cm.display.input.reset();if(webkit){setTimeout(function(){return cm.display.input.reset(true);},20);}}
cm.display.input.receivedFocus();}
restartBlink(cm);}
function onBlur(cm,e){if(cm.state.delayingBlurEvent){return}
if(cm.state.focused){signal(cm,"blur",cm,e);cm.state.focused=false;rmClass(cm.display.wrapper,"CodeMirror-focused");}
clearInterval(cm.display.blinker);setTimeout(function(){if(!cm.state.focused){cm.display.shift=false;}},150);}
function updateHeightsInViewport(cm){var display=cm.display;var prevBottom=display.lineDiv.offsetTop;var viewTop=Math.max(0,display.scroller.getBoundingClientRect().top);var oldHeight=display.lineDiv.getBoundingClientRect().top;var mustScroll=0;for(var i=0;i<display.view.length;i++){var cur=display.view[i],wrapping=cm.options.lineWrapping;var height=(void 0),width=0;if(cur.hidden){continue}
oldHeight+=cur.line.height;if(ie&&ie_version<8){var bot=cur.node.offsetTop+cur.node.offsetHeight;height=bot-prevBottom;prevBottom=bot;}else{var box=cur.node.getBoundingClientRect();height=box.bottom-box.top;if(!wrapping&&cur.text.firstChild)
{width=cur.text.firstChild.getBoundingClientRect().right-box.left-1;}}
var diff=cur.line.height-height;if(diff>.005||diff<-.005){if(oldHeight<viewTop){mustScroll-=diff;}
updateLineHeight(cur.line,height);updateWidgetHeight(cur.line);if(cur.rest){for(var j=0;j<cur.rest.length;j++)
{updateWidgetHeight(cur.rest[j]);}}}
if(width>cm.display.sizerWidth){var chWidth=Math.ceil(width/charWidth(cm.display));if(chWidth>cm.display.maxLineLength){cm.display.maxLineLength=chWidth;cm.display.maxLine=cur.line;cm.display.maxLineChanged=true;}}}
if(Math.abs(mustScroll)>2){display.scroller.scrollTop+=mustScroll;}}
function updateWidgetHeight(line){if(line.widgets){for(var i=0;i<line.widgets.length;++i){var w=line.widgets[i],parent=w.node.parentNode;if(parent){w.height=parent.offsetHeight;}}}}
function visibleLines(display,doc,viewport){var top=viewport&&viewport.top!=null?Math.max(0,viewport.top):display.scroller.scrollTop;top=Math.floor(top-paddingTop(display));var bottom=viewport&&viewport.bottom!=null?viewport.bottom:top+display.wrapper.clientHeight;var from=lineAtHeight(doc,top),to=lineAtHeight(doc,bottom);if(viewport&&viewport.ensure){var ensureFrom=viewport.ensure.from.line,ensureTo=viewport.ensure.to.line;if(ensureFrom<from){from=ensureFrom;to=lineAtHeight(doc,heightAtLine(getLine(doc,ensureFrom))+display.wrapper.clientHeight);}else if(Math.min(ensureTo,doc.lastLine())>=to){from=lineAtHeight(doc,heightAtLine(getLine(doc,ensureTo))-display.wrapper.clientHeight);to=ensureTo;}}
return{from:from,to:Math.max(to,from+1)}}
function maybeScrollWindow(cm,rect){if(signalDOMEvent(cm,"scrollCursorIntoView")){return}
var display=cm.display,box=display.sizer.getBoundingClientRect(),doScroll=null;var doc=display.wrapper.ownerDocument;if(rect.top+box.top<0){doScroll=true;}
else if(rect.bottom+box.top>(doc.defaultView.innerHeight||doc.documentElement.clientHeight)){doScroll=false;}
if(doScroll!=null&&!phantom){var scrollNode=elt("div","\u200b",null,("position: absolute;\n                         top: "+(rect.top-display.viewOffset-paddingTop(cm.display))+"px;\n                         height: "+(rect.bottom-rect.top+scrollGap(cm)+display.barHeight)+"px;\n                         left: "+(rect.left)+"px; width: "+(Math.max(2,rect.right-rect.left))+"px;"));cm.display.lineSpace.appendChild(scrollNode);scrollNode.scrollIntoView(doScroll);cm.display.lineSpace.removeChild(scrollNode);}}
function scrollPosIntoView(cm,pos,end,margin){if(margin==null){margin=0;}
var rect;if(!cm.options.lineWrapping&&pos==end){end=pos.sticky=="before"?Pos(pos.line,pos.ch+1,"before"):pos;pos=pos.ch?Pos(pos.line,pos.sticky=="before"?pos.ch-1:pos.ch,"after"):pos;}
for(var limit=0;limit<5;limit++){var changed=false;var coords=cursorCoords(cm,pos);var endCoords=!end||end==pos?coords:cursorCoords(cm,end);rect={left:Math.min(coords.left,endCoords.left),top:Math.min(coords.top,endCoords.top)-margin,right:Math.max(coords.left,endCoords.left),bottom:Math.max(coords.bottom,endCoords.bottom)+margin};var scrollPos=calculateScrollPos(cm,rect);var startTop=cm.doc.scrollTop,startLeft=cm.doc.scrollLeft;if(scrollPos.scrollTop!=null){updateScrollTop(cm,scrollPos.scrollTop);if(Math.abs(cm.doc.scrollTop-startTop)>1){changed=true;}}
if(scrollPos.scrollLeft!=null){setScrollLeft(cm,scrollPos.scrollLeft);if(Math.abs(cm.doc.scrollLeft-startLeft)>1){changed=true;}}
if(!changed){break}}
return rect}
function scrollIntoView(cm,rect){var scrollPos=calculateScrollPos(cm,rect);if(scrollPos.scrollTop!=null){updateScrollTop(cm,scrollPos.scrollTop);}
if(scrollPos.scrollLeft!=null){setScrollLeft(cm,scrollPos.scrollLeft);}}
function calculateScrollPos(cm,rect){var display=cm.display,snapMargin=textHeight(cm.display);if(rect.top<0){rect.top=0;}
var screentop=cm.curOp&&cm.curOp.scrollTop!=null?cm.curOp.scrollTop:display.scroller.scrollTop;var screen=displayHeight(cm),result={};if(rect.bottom-rect.top>screen){rect.bottom=rect.top+screen;}
var docBottom=cm.doc.height+paddingVert(display);var atTop=rect.top<snapMargin,atBottom=rect.bottom>docBottom-snapMargin;if(rect.top<screentop){result.scrollTop=atTop?0:rect.top;}else if(rect.bottom>screentop+screen){var newTop=Math.min(rect.top,(atBottom?docBottom:rect.bottom)-screen);if(newTop!=screentop){result.scrollTop=newTop;}}
var gutterSpace=cm.options.fixedGutter?0:display.gutters.offsetWidth;var screenleft=cm.curOp&&cm.curOp.scrollLeft!=null?cm.curOp.scrollLeft:display.scroller.scrollLeft-gutterSpace;var screenw=displayWidth(cm)-display.gutters.offsetWidth;var tooWide=rect.right-rect.left>screenw;if(tooWide){rect.right=rect.left+screenw;}
if(rect.left<10)
{result.scrollLeft=0;}
else if(rect.left<screenleft)
{result.scrollLeft=Math.max(0,rect.left+gutterSpace-(tooWide?0:10));}
else if(rect.right>screenw+screenleft-3)
{result.scrollLeft=rect.right+(tooWide?0:10)-screenw;}
return result}
function addToScrollTop(cm,top){if(top==null){return}
resolveScrollToPos(cm);cm.curOp.scrollTop=(cm.curOp.scrollTop==null?cm.doc.scrollTop:cm.curOp.scrollTop)+top;}
function ensureCursorVisible(cm){resolveScrollToPos(cm);var cur=cm.getCursor();cm.curOp.scrollToPos={from:cur,to:cur,margin:cm.options.cursorScrollMargin};}
function scrollToCoords(cm,x,y){if(x!=null||y!=null){resolveScrollToPos(cm);}
if(x!=null){cm.curOp.scrollLeft=x;}
if(y!=null){cm.curOp.scrollTop=y;}}
function scrollToRange(cm,range){resolveScrollToPos(cm);cm.curOp.scrollToPos=range;}
function resolveScrollToPos(cm){var range=cm.curOp.scrollToPos;if(range){cm.curOp.scrollToPos=null;var from=estimateCoords(cm,range.from),to=estimateCoords(cm,range.to);scrollToCoordsRange(cm,from,to,range.margin);}}
function scrollToCoordsRange(cm,from,to,margin){var sPos=calculateScrollPos(cm,{left:Math.min(from.left,to.left),top:Math.min(from.top,to.top)-margin,right:Math.max(from.right,to.right),bottom:Math.max(from.bottom,to.bottom)+margin});scrollToCoords(cm,sPos.scrollLeft,sPos.scrollTop);}
function updateScrollTop(cm,val){if(Math.abs(cm.doc.scrollTop-val)<2){return}
if(!gecko){updateDisplaySimple(cm,{top:val});}
setScrollTop(cm,val,true);if(gecko){updateDisplaySimple(cm);}
startWorker(cm,100);}
function setScrollTop(cm,val,forceScroll){val=Math.max(0,Math.min(cm.display.scroller.scrollHeight-cm.display.scroller.clientHeight,val));if(cm.display.scroller.scrollTop==val&&!forceScroll){return}
cm.doc.scrollTop=val;cm.display.scrollbars.setScrollTop(val);if(cm.display.scroller.scrollTop!=val){cm.display.scroller.scrollTop=val;}}
function setScrollLeft(cm,val,isScroller,forceScroll){val=Math.max(0,Math.min(val,cm.display.scroller.scrollWidth-cm.display.scroller.clientWidth));if((isScroller?val==cm.doc.scrollLeft:Math.abs(cm.doc.scrollLeft-val)<2)&&!forceScroll){return}
cm.doc.scrollLeft=val;alignHorizontally(cm);if(cm.display.scroller.scrollLeft!=val){cm.display.scroller.scrollLeft=val;}
cm.display.scrollbars.setScrollLeft(val);}
function measureForScrollbars(cm){var d=cm.display,gutterW=d.gutters.offsetWidth;var docH=Math.round(cm.doc.height+paddingVert(cm.display));return{clientHeight:d.scroller.clientHeight,viewHeight:d.wrapper.clientHeight,scrollWidth:d.scroller.scrollWidth,clientWidth:d.scroller.clientWidth,viewWidth:d.wrapper.clientWidth,barLeft:cm.options.fixedGutter?gutterW:0,docHeight:docH,scrollHeight:docH+scrollGap(cm)+d.barHeight,nativeBarWidth:d.nativeBarWidth,gutterWidth:gutterW}}
var NativeScrollbars=function(place,scroll,cm){this.cm=cm;var vert=this.vert=elt("div",[elt("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar");var horiz=this.horiz=elt("div",[elt("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");vert.tabIndex=horiz.tabIndex=-1;place(vert);place(horiz);on(vert,"scroll",function(){if(vert.clientHeight){scroll(vert.scrollTop,"vertical");}});on(horiz,"scroll",function(){if(horiz.clientWidth){scroll(horiz.scrollLeft,"horizontal");}});this.checkedZeroWidth=false;if(ie&&ie_version<8){this.horiz.style.minHeight=this.vert.style.minWidth="18px";}};NativeScrollbars.prototype.update=function(measure){var needsH=measure.scrollWidth>measure.clientWidth+1;var needsV=measure.scrollHeight>measure.clientHeight+1;var sWidth=measure.nativeBarWidth;if(needsV){this.vert.style.display="block";this.vert.style.bottom=needsH?sWidth+"px":"0";var totalHeight=measure.viewHeight-(needsH?sWidth:0);this.vert.firstChild.style.height=Math.max(0,measure.scrollHeight-measure.clientHeight+totalHeight)+"px";}else{this.vert.scrollTop=0;this.vert.style.display="";this.vert.firstChild.style.height="0";}
if(needsH){this.horiz.style.display="block";this.horiz.style.right=needsV?sWidth+"px":"0";this.horiz.style.left=measure.barLeft+"px";var totalWidth=measure.viewWidth-measure.barLeft-(needsV?sWidth:0);this.horiz.firstChild.style.width=Math.max(0,measure.scrollWidth-measure.clientWidth+totalWidth)+"px";}else{this.horiz.style.display="";this.horiz.firstChild.style.width="0";}
if(!this.checkedZeroWidth&&measure.clientHeight>0){if(sWidth==0){this.zeroWidthHack();}
this.checkedZeroWidth=true;}
return{right:needsV?sWidth:0,bottom:needsH?sWidth:0}};NativeScrollbars.prototype.setScrollLeft=function(pos){if(this.horiz.scrollLeft!=pos){this.horiz.scrollLeft=pos;}
if(this.disableHoriz){this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz");}};NativeScrollbars.prototype.setScrollTop=function(pos){if(this.vert.scrollTop!=pos){this.vert.scrollTop=pos;}
if(this.disableVert){this.enableZeroWidthBar(this.vert,this.disableVert,"vert");}};NativeScrollbars.prototype.zeroWidthHack=function(){var w=mac&&!mac_geMountainLion?"12px":"18px";this.horiz.style.height=this.vert.style.width=w;this.horiz.style.visibility=this.vert.style.visibility="hidden";this.disableHoriz=new Delayed;this.disableVert=new Delayed;};NativeScrollbars.prototype.enableZeroWidthBar=function(bar,delay,type){bar.style.visibility="";function maybeDisable(){var box=bar.getBoundingClientRect();var elt=type=="vert"?document.elementFromPoint(box.right-1,(box.top+box.bottom)/2):document.elementFromPoint((box.right+box.left)/2,box.bottom-1);if(elt!=bar){bar.style.visibility="hidden";}
else{delay.set(1000,maybeDisable);}}
delay.set(1000,maybeDisable);};NativeScrollbars.prototype.clear=function(){var parent=this.horiz.parentNode;parent.removeChild(this.horiz);parent.removeChild(this.vert);};var NullScrollbars=function(){};NullScrollbars.prototype.update=function(){return{bottom:0,right:0}};NullScrollbars.prototype.setScrollLeft=function(){};NullScrollbars.prototype.setScrollTop=function(){};NullScrollbars.prototype.clear=function(){};function updateScrollbars(cm,measure){if(!measure){measure=measureForScrollbars(cm);}
var startWidth=cm.display.barWidth,startHeight=cm.display.barHeight;updateScrollbarsInner(cm,measure);for(var i=0;i<4&&startWidth!=cm.display.barWidth||startHeight!=cm.display.barHeight;i++){if(startWidth!=cm.display.barWidth&&cm.options.lineWrapping)
{updateHeightsInViewport(cm);}
updateScrollbarsInner(cm,measureForScrollbars(cm));startWidth=cm.display.barWidth;startHeight=cm.display.barHeight;}}
function updateScrollbarsInner(cm,measure){var d=cm.display;var sizes=d.scrollbars.update(measure);d.sizer.style.paddingRight=(d.barWidth=sizes.right)+"px";d.sizer.style.paddingBottom=(d.barHeight=sizes.bottom)+"px";d.heightForcer.style.borderBottom=sizes.bottom+"px solid transparent";if(sizes.right&&sizes.bottom){d.scrollbarFiller.style.display="block";d.scrollbarFiller.style.height=sizes.bottom+"px";d.scrollbarFiller.style.width=sizes.right+"px";}else{d.scrollbarFiller.style.display="";}
if(sizes.bottom&&cm.options.coverGutterNextToScrollbar&&cm.options.fixedGutter){d.gutterFiller.style.display="block";d.gutterFiller.style.height=sizes.bottom+"px";d.gutterFiller.style.width=measure.gutterWidth+"px";}else{d.gutterFiller.style.display="";}}
var scrollbarModel={"native":NativeScrollbars,"null":NullScrollbars};function initScrollbars(cm){if(cm.display.scrollbars){cm.display.scrollbars.clear();if(cm.display.scrollbars.addClass)
{rmClass(cm.display.wrapper,cm.display.scrollbars.addClass);}}
cm.display.scrollbars=new scrollbarModel[cm.options.scrollbarStyle](function(node){cm.display.wrapper.insertBefore(node,cm.display.scrollbarFiller);on(node,"mousedown",function(){if(cm.state.focused){setTimeout(function(){return cm.display.input.focus();},0);}});node.setAttribute("cm-not-content","true");},function(pos,axis){if(axis=="horizontal"){setScrollLeft(cm,pos);}
else{updateScrollTop(cm,pos);}},cm);if(cm.display.scrollbars.addClass)
{addClass(cm.display.wrapper,cm.display.scrollbars.addClass);}}
var nextOpId=0;function startOperation(cm){cm.curOp={cm:cm,viewChanged:false,startHeight:cm.doc.height,forceUpdate:false,updateInput:0,typing:false,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:false,updateMaxLine:false,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:false,id:++nextOpId,markArrays:null};pushOperation(cm.curOp);}
function endOperation(cm){var op=cm.curOp;if(op){finishOperation(op,function(group){for(var i=0;i<group.ops.length;i++)
{group.ops[i].cm.curOp=null;}
endOperations(group);});}}
function endOperations(group){var ops=group.ops;for(var i=0;i<ops.length;i++)
{endOperation_R1(ops[i]);}
for(var i$1=0;i$1<ops.length;i$1++)
{endOperation_W1(ops[i$1]);}
for(var i$2=0;i$2<ops.length;i$2++)
{endOperation_R2(ops[i$2]);}
for(var i$3=0;i$3<ops.length;i$3++)
{endOperation_W2(ops[i$3]);}
for(var i$4=0;i$4<ops.length;i$4++)
{endOperation_finish(ops[i$4]);}}
function endOperation_R1(op){var cm=op.cm,display=cm.display;maybeClipScrollbars(cm);if(op.updateMaxLine){findMaxLine(cm);}
op.mustUpdate=op.viewChanged||op.forceUpdate||op.scrollTop!=null||op.scrollToPos&&(op.scrollToPos.from.line<display.viewFrom||op.scrollToPos.to.line>=display.viewTo)||display.maxLineChanged&&cm.options.lineWrapping;op.update=op.mustUpdate&&new DisplayUpdate(cm,op.mustUpdate&&{top:op.scrollTop,ensure:op.scrollToPos},op.forceUpdate);}
function endOperation_W1(op){op.updatedDisplay=op.mustUpdate&&updateDisplayIfNeeded(op.cm,op.update);}
function endOperation_R2(op){var cm=op.cm,display=cm.display;if(op.updatedDisplay){updateHeightsInViewport(cm);}
op.barMeasure=measureForScrollbars(cm);if(display.maxLineChanged&&!cm.options.lineWrapping){op.adjustWidthTo=measureChar(cm,display.maxLine,display.maxLine.text.length).left+3;cm.display.sizerWidth=op.adjustWidthTo;op.barMeasure.scrollWidth=Math.max(display.scroller.clientWidth,display.sizer.offsetLeft+op.adjustWidthTo+scrollGap(cm)+cm.display.barWidth);op.maxScrollLeft=Math.max(0,display.sizer.offsetLeft+op.adjustWidthTo-displayWidth(cm));}
if(op.updatedDisplay||op.selectionChanged)
{op.preparedSelection=display.input.prepareSelection();}}
function endOperation_W2(op){var cm=op.cm;if(op.adjustWidthTo!=null){cm.display.sizer.style.minWidth=op.adjustWidthTo+"px";if(op.maxScrollLeft<cm.doc.scrollLeft)
{setScrollLeft(cm,Math.min(cm.display.scroller.scrollLeft,op.maxScrollLeft),true);}
cm.display.maxLineChanged=false;}
var takeFocus=op.focus&&op.focus==activeElt(doc(cm));if(op.preparedSelection)
{cm.display.input.showSelection(op.preparedSelection,takeFocus);}
if(op.updatedDisplay||op.startHeight!=cm.doc.height)
{updateScrollbars(cm,op.barMeasure);}
if(op.updatedDisplay)
{setDocumentHeight(cm,op.barMeasure);}
if(op.selectionChanged){restartBlink(cm);}
if(cm.state.focused&&op.updateInput)
{cm.display.input.reset(op.typing);}
if(takeFocus){ensureFocus(op.cm);}}
function endOperation_finish(op){var cm=op.cm,display=cm.display,doc=cm.doc;if(op.updatedDisplay){postUpdateDisplay(cm,op.update);}
if(display.wheelStartX!=null&&(op.scrollTop!=null||op.scrollLeft!=null||op.scrollToPos))
{display.wheelStartX=display.wheelStartY=null;}
if(op.scrollTop!=null){setScrollTop(cm,op.scrollTop,op.forceScroll);}
if(op.scrollLeft!=null){setScrollLeft(cm,op.scrollLeft,true,true);}
if(op.scrollToPos){var rect=scrollPosIntoView(cm,clipPos(doc,op.scrollToPos.from),clipPos(doc,op.scrollToPos.to),op.scrollToPos.margin);maybeScrollWindow(cm,rect);}
var hidden=op.maybeHiddenMarkers,unhidden=op.maybeUnhiddenMarkers;if(hidden){for(var i=0;i<hidden.length;++i)
{if(!hidden[i].lines.length){signal(hidden[i],"hide");}}}
if(unhidden){for(var i$1=0;i$1<unhidden.length;++i$1)
{if(unhidden[i$1].lines.length){signal(unhidden[i$1],"unhide");}}}
if(display.wrapper.offsetHeight)
{doc.scrollTop=cm.display.scroller.scrollTop;}
if(op.changeObjs)
{signal(cm,"changes",cm,op.changeObjs);}
if(op.update)
{op.update.finish();}}
function runInOp(cm,f){if(cm.curOp){return f()}
startOperation(cm);try{return f()}
finally{endOperation(cm);}}
function operation(cm,f){return function(){if(cm.curOp){return f.apply(cm,arguments)}
startOperation(cm);try{return f.apply(cm,arguments)}
finally{endOperation(cm);}}}
function methodOp(f){return function(){if(this.curOp){return f.apply(this,arguments)}
startOperation(this);try{return f.apply(this,arguments)}
finally{endOperation(this);}}}
function docMethodOp(f){return function(){var cm=this.cm;if(!cm||cm.curOp){return f.apply(this,arguments)}
startOperation(cm);try{return f.apply(this,arguments)}
finally{endOperation(cm);}}}
function startWorker(cm,time){if(cm.doc.highlightFrontier<cm.display.viewTo)
{cm.state.highlight.set(time,bind(highlightWorker,cm));}}
function highlightWorker(cm){var doc=cm.doc;if(doc.highlightFrontier>=cm.display.viewTo){return}
var end=+new Date+cm.options.workTime;var context=getContextBefore(cm,doc.highlightFrontier);var changedLines=[];doc.iter(context.line,Math.min(doc.first+doc.size,cm.display.viewTo+500),function(line){if(context.line>=cm.display.viewFrom){var oldStyles=line.styles;var resetState=line.text.length>cm.options.maxHighlightLength?copyState(doc.mode,context.state):null;var highlighted=highlightLine(cm,line,context,true);if(resetState){context.state=resetState;}
line.styles=highlighted.styles;var oldCls=line.styleClasses,newCls=highlighted.classes;if(newCls){line.styleClasses=newCls;}
else if(oldCls){line.styleClasses=null;}
var ischange=!oldStyles||oldStyles.length!=line.styles.length||oldCls!=newCls&&(!oldCls||!newCls||oldCls.bgClass!=newCls.bgClass||oldCls.textClass!=newCls.textClass);for(var i=0;!ischange&&i<oldStyles.length;++i){ischange=oldStyles[i]!=line.styles[i];}
if(ischange){changedLines.push(context.line);}
line.stateAfter=context.save();context.nextLine();}else{if(line.text.length<=cm.options.maxHighlightLength)
{processLine(cm,line.text,context);}
line.stateAfter=context.line%5==0?context.save():null;context.nextLine();}
if(+new Date>end){startWorker(cm,cm.options.workDelay);return true}});doc.highlightFrontier=context.line;doc.modeFrontier=Math.max(doc.modeFrontier,context.line);if(changedLines.length){runInOp(cm,function(){for(var i=0;i<changedLines.length;i++)
{regLineChange(cm,changedLines[i],"text");}});}}
var DisplayUpdate=function(cm,viewport,force){var display=cm.display;this.viewport=viewport;this.visible=visibleLines(display,cm.doc,viewport);this.editorIsHidden=!display.wrapper.offsetWidth;this.wrapperHeight=display.wrapper.clientHeight;this.wrapperWidth=display.wrapper.clientWidth;this.oldDisplayWidth=displayWidth(cm);this.force=force;this.dims=getDimensions(cm);this.events=[];};DisplayUpdate.prototype.signal=function(emitter,type){if(hasHandler(emitter,type))
{this.events.push(arguments);}};DisplayUpdate.prototype.finish=function(){for(var i=0;i<this.events.length;i++)
{signal.apply(null,this.events[i]);}};function maybeClipScrollbars(cm){var display=cm.display;if(!display.scrollbarsClipped&&display.scroller.offsetWidth){display.nativeBarWidth=display.scroller.offsetWidth-display.scroller.clientWidth;display.heightForcer.style.height=scrollGap(cm)+"px";display.sizer.style.marginBottom=-display.nativeBarWidth+"px";display.sizer.style.borderRightWidth=scrollGap(cm)+"px";display.scrollbarsClipped=true;}}
function selectionSnapshot(cm){if(cm.hasFocus()){return null}
var active=activeElt(doc(cm));if(!active||!contains(cm.display.lineDiv,active)){return null}
var result={activeElt:active};if(window.getSelection){var sel=win(cm).getSelection();if(sel.anchorNode&&sel.extend&&contains(cm.display.lineDiv,sel.anchorNode)){result.anchorNode=sel.anchorNode;result.anchorOffset=sel.anchorOffset;result.focusNode=sel.focusNode;result.focusOffset=sel.focusOffset;}}
return result}
function restoreSelection(snapshot){if(!snapshot||!snapshot.activeElt||snapshot.activeElt==activeElt(snapshot.activeElt.ownerDocument)){return}
snapshot.activeElt.focus();if(!/^(INPUT|TEXTAREA)$/.test(snapshot.activeElt.nodeName)&&snapshot.anchorNode&&contains(document.body,snapshot.anchorNode)&&contains(document.body,snapshot.focusNode)){var doc=snapshot.activeElt.ownerDocument;var sel=doc.defaultView.getSelection(),range=doc.createRange();range.setEnd(snapshot.anchorNode,snapshot.anchorOffset);range.collapse(false);sel.removeAllRanges();sel.addRange(range);sel.extend(snapshot.focusNode,snapshot.focusOffset);}}
function updateDisplayIfNeeded(cm,update){var display=cm.display,doc=cm.doc;if(update.editorIsHidden){resetView(cm);return false}
if(!update.force&&update.visible.from>=display.viewFrom&&update.visible.to<=display.viewTo&&(display.updateLineNumbers==null||display.updateLineNumbers>=display.viewTo)&&display.renderedView==display.view&&countDirtyView(cm)==0)
{return false}
if(maybeUpdateLineNumberWidth(cm)){resetView(cm);update.dims=getDimensions(cm);}
var end=doc.first+doc.size;var from=Math.max(update.visible.from-cm.options.viewportMargin,doc.first);var to=Math.min(end,update.visible.to+cm.options.viewportMargin);if(display.viewFrom<from&&from-display.viewFrom<20){from=Math.max(doc.first,display.viewFrom);}
if(display.viewTo>to&&display.viewTo-to<20){to=Math.min(end,display.viewTo);}
if(sawCollapsedSpans){from=visualLineNo(cm.doc,from);to=visualLineEndNo(cm.doc,to);}
var different=from!=display.viewFrom||to!=display.viewTo||display.lastWrapHeight!=update.wrapperHeight||display.lastWrapWidth!=update.wrapperWidth;adjustView(cm,from,to);display.viewOffset=heightAtLine(getLine(cm.doc,display.viewFrom));cm.display.mover.style.top=display.viewOffset+"px";var toUpdate=countDirtyView(cm);if(!different&&toUpdate==0&&!update.force&&display.renderedView==display.view&&(display.updateLineNumbers==null||display.updateLineNumbers>=display.viewTo))
{return false}
var selSnapshot=selectionSnapshot(cm);if(toUpdate>4){display.lineDiv.style.display="none";}
patchDisplay(cm,display.updateLineNumbers,update.dims);if(toUpdate>4){display.lineDiv.style.display="";}
display.renderedView=display.view;restoreSelection(selSnapshot);removeChildren(display.cursorDiv);removeChildren(display.selectionDiv);display.gutters.style.height=display.sizer.style.minHeight=0;if(different){display.lastWrapHeight=update.wrapperHeight;display.lastWrapWidth=update.wrapperWidth;startWorker(cm,400);}
display.updateLineNumbers=null;return true}
function postUpdateDisplay(cm,update){var viewport=update.viewport;for(var first=true;;first=false){if(!first||!cm.options.lineWrapping||update.oldDisplayWidth==displayWidth(cm)){if(viewport&&viewport.top!=null)
{viewport={top:Math.min(cm.doc.height+paddingVert(cm.display)-displayHeight(cm),viewport.top)};}
update.visible=visibleLines(cm.display,cm.doc,viewport);if(update.visible.from>=cm.display.viewFrom&&update.visible.to<=cm.display.viewTo)
{break}}else if(first){update.visible=visibleLines(cm.display,cm.doc,viewport);}
if(!updateDisplayIfNeeded(cm,update)){break}
updateHeightsInViewport(cm);var barMeasure=measureForScrollbars(cm);updateSelection(cm);updateScrollbars(cm,barMeasure);setDocumentHeight(cm,barMeasure);update.force=false;}
update.signal(cm,"update",cm);if(cm.display.viewFrom!=cm.display.reportedViewFrom||cm.display.viewTo!=cm.display.reportedViewTo){update.signal(cm,"viewportChange",cm,cm.display.viewFrom,cm.display.viewTo);cm.display.reportedViewFrom=cm.display.viewFrom;cm.display.reportedViewTo=cm.display.viewTo;}}
function updateDisplaySimple(cm,viewport){var update=new DisplayUpdate(cm,viewport);if(updateDisplayIfNeeded(cm,update)){updateHeightsInViewport(cm);postUpdateDisplay(cm,update);var barMeasure=measureForScrollbars(cm);updateSelection(cm);updateScrollbars(cm,barMeasure);setDocumentHeight(cm,barMeasure);update.finish();}}
function patchDisplay(cm,updateNumbersFrom,dims){var display=cm.display,lineNumbers=cm.options.lineNumbers;var container=display.lineDiv,cur=container.firstChild;function rm(node){var next=node.nextSibling;if(webkit&&mac&&cm.display.currentWheelTarget==node)
{node.style.display="none";}
else
{node.parentNode.removeChild(node);}
return next}
var view=display.view,lineN=display.viewFrom;for(var i=0;i<view.length;i++){var lineView=view[i];if(lineView.hidden);else if(!lineView.node||lineView.node.parentNode!=container){var node=buildLineElement(cm,lineView,lineN,dims);container.insertBefore(node,cur);}else{while(cur!=lineView.node){cur=rm(cur);}
var updateNumber=lineNumbers&&updateNumbersFrom!=null&&updateNumbersFrom<=lineN&&lineView.lineNumber;if(lineView.changes){if(indexOf(lineView.changes,"gutter")>-1){updateNumber=false;}
updateLineForChanges(cm,lineView,lineN,dims);}
if(updateNumber){removeChildren(lineView.lineNumber);lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options,lineN)));}
cur=lineView.node.nextSibling;}
lineN+=lineView.size;}
while(cur){cur=rm(cur);}}
function updateGutterSpace(display){var width=display.gutters.offsetWidth;display.sizer.style.marginLeft=width+"px";signalLater(display,"gutterChanged",display);}
function setDocumentHeight(cm,measure){cm.display.sizer.style.minHeight=measure.docHeight+"px";cm.display.heightForcer.style.top=measure.docHeight+"px";cm.display.gutters.style.height=(measure.docHeight+cm.display.barHeight+scrollGap(cm))+"px";}
function alignHorizontally(cm){var display=cm.display,view=display.view;if(!display.alignWidgets&&(!display.gutters.firstChild||!cm.options.fixedGutter)){return}
var comp=compensateForHScroll(display)-display.scroller.scrollLeft+cm.doc.scrollLeft;var gutterW=display.gutters.offsetWidth,left=comp+"px";for(var i=0;i<view.length;i++){if(!view[i].hidden){if(cm.options.fixedGutter){if(view[i].gutter)
{view[i].gutter.style.left=left;}
if(view[i].gutterBackground)
{view[i].gutterBackground.style.left=left;}}
var align=view[i].alignable;if(align){for(var j=0;j<align.length;j++)
{align[j].style.left=left;}}}}
if(cm.options.fixedGutter)
{display.gutters.style.left=(comp+gutterW)+"px";}}
function maybeUpdateLineNumberWidth(cm){if(!cm.options.lineNumbers){return false}
var doc=cm.doc,last=lineNumberFor(cm.options,doc.first+doc.size-1),display=cm.display;if(last.length!=display.lineNumChars){var test=display.measure.appendChild(elt("div",[elt("div",last)],"CodeMirror-linenumber CodeMirror-gutter-elt"));var innerW=test.firstChild.offsetWidth,padding=test.offsetWidth-innerW;display.lineGutter.style.width="";display.lineNumInnerWidth=Math.max(innerW,display.lineGutter.offsetWidth-padding)+1;display.lineNumWidth=display.lineNumInnerWidth+padding;display.lineNumChars=display.lineNumInnerWidth?last.length:-1;display.lineGutter.style.width=display.lineNumWidth+"px";updateGutterSpace(cm.display);return true}
return false}
function getGutters(gutters,lineNumbers){var result=[],sawLineNumbers=false;for(var i=0;i<gutters.length;i++){var name=gutters[i],style=null;if(typeof name!="string"){style=name.style;name=name.className;}
if(name=="CodeMirror-linenumbers"){if(!lineNumbers){continue}
else{sawLineNumbers=true;}}
result.push({className:name,style:style});}
if(lineNumbers&&!sawLineNumbers){result.push({className:"CodeMirror-linenumbers",style:null});}
return result}
function renderGutters(display){var gutters=display.gutters,specs=display.gutterSpecs;removeChildren(gutters);display.lineGutter=null;for(var i=0;i<specs.length;++i){var ref=specs[i];var className=ref.className;var style=ref.style;var gElt=gutters.appendChild(elt("div",null,"CodeMirror-gutter "+className));if(style){gElt.style.cssText=style;}
if(className=="CodeMirror-linenumbers"){display.lineGutter=gElt;gElt.style.width=(display.lineNumWidth||1)+"px";}}
gutters.style.display=specs.length?"":"none";updateGutterSpace(display);}
function updateGutters(cm){renderGutters(cm.display);regChange(cm);alignHorizontally(cm);}
function Display(place,doc,input,options){var d=this;this.input=input;d.scrollbarFiller=elt("div",null,"CodeMirror-scrollbar-filler");d.scrollbarFiller.setAttribute("cm-not-content","true");d.gutterFiller=elt("div",null,"CodeMirror-gutter-filler");d.gutterFiller.setAttribute("cm-not-content","true");d.lineDiv=eltP("div",null,"CodeMirror-code");d.selectionDiv=elt("div",null,null,"position: relative; z-index: 1");d.cursorDiv=elt("div",null,"CodeMirror-cursors");d.measure=elt("div",null,"CodeMirror-measure");d.lineMeasure=elt("div",null,"CodeMirror-measure");d.lineSpace=eltP("div",[d.measure,d.lineMeasure,d.selectionDiv,d.cursorDiv,d.lineDiv],null,"position: relative; outline: none");var lines=eltP("div",[d.lineSpace],"CodeMirror-lines");d.mover=elt("div",[lines],null,"position: relative");d.sizer=elt("div",[d.mover],"CodeMirror-sizer");d.sizerWidth=null;d.heightForcer=elt("div",null,null,"position: absolute; height: "+scrollerGap+"px; width: 1px;");d.gutters=elt("div",null,"CodeMirror-gutters");d.lineGutter=null;d.scroller=elt("div",[d.sizer,d.heightForcer,d.gutters],"CodeMirror-scroll");d.scroller.setAttribute("tabIndex","-1");d.wrapper=elt("div",[d.scrollbarFiller,d.gutterFiller,d.scroller],"CodeMirror");d.wrapper.setAttribute('translate','no');if(ie&&ie_version<8){d.gutters.style.zIndex=-1;d.scroller.style.paddingRight=0;}
if(!webkit&&!(gecko&&mobile)){d.scroller.draggable=true;}
if(place){if(place.appendChild){place.appendChild(d.wrapper);}
else{place(d.wrapper);}}
d.viewFrom=d.viewTo=doc.first;d.reportedViewFrom=d.reportedViewTo=doc.first;d.view=[];d.renderedView=null;d.externalMeasured=null;d.viewOffset=0;d.lastWrapHeight=d.lastWrapWidth=0;d.updateLineNumbers=null;d.nativeBarWidth=d.barHeight=d.barWidth=0;d.scrollbarsClipped=false;d.lineNumWidth=d.lineNumInnerWidth=d.lineNumChars=null;d.alignWidgets=false;d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null;d.maxLine=null;d.maxLineLength=0;d.maxLineChanged=false;d.wheelDX=d.wheelDY=d.wheelStartX=d.wheelStartY=null;d.shift=false;d.selForContextMenu=null;d.activeTouch=null;d.gutterSpecs=getGutters(options.gutters,options.lineNumbers);renderGutters(d);input.init(d);}
var wheelSamples=0,wheelPixelsPerUnit=null;if(ie){wheelPixelsPerUnit=-.53;}
else if(gecko){wheelPixelsPerUnit=15;}
else if(chrome){wheelPixelsPerUnit=-.7;}
else if(safari){wheelPixelsPerUnit=-1/3;}
function wheelEventDelta(e){var dx=e.wheelDeltaX,dy=e.wheelDeltaY;if(dx==null&&e.detail&&e.axis==e.HORIZONTAL_AXIS){dx=e.detail;}
if(dy==null&&e.detail&&e.axis==e.VERTICAL_AXIS){dy=e.detail;}
else if(dy==null){dy=e.wheelDelta;}
return{x:dx,y:dy}}
function wheelEventPixels(e){var delta=wheelEventDelta(e);delta.x*=wheelPixelsPerUnit;delta.y*=wheelPixelsPerUnit;return delta}
function onScrollWheel(cm,e){if(chrome&&chrome_version==102){if(cm.display.chromeScrollHack==null){cm.display.sizer.style.pointerEvents="none";}
else{clearTimeout(cm.display.chromeScrollHack);}
cm.display.chromeScrollHack=setTimeout(function(){cm.display.chromeScrollHack=null;cm.display.sizer.style.pointerEvents="";},100);}
var delta=wheelEventDelta(e),dx=delta.x,dy=delta.y;var pixelsPerUnit=wheelPixelsPerUnit;if(e.deltaMode===0){dx=e.deltaX;dy=e.deltaY;pixelsPerUnit=1;}
var display=cm.display,scroll=display.scroller;var canScrollX=scroll.scrollWidth>scroll.clientWidth;var canScrollY=scroll.scrollHeight>scroll.clientHeight;if(!(dx&&canScrollX||dy&&canScrollY)){return}
if(dy&&mac&&webkit){outer:for(var cur=e.target,view=display.view;cur!=scroll;cur=cur.parentNode){for(var i=0;i<view.length;i++){if(view[i].node==cur){cm.display.currentWheelTarget=cur;break outer}}}}
if(dx&&!gecko&&!presto&&pixelsPerUnit!=null){if(dy&&canScrollY)
{updateScrollTop(cm,Math.max(0,scroll.scrollTop+dy*pixelsPerUnit));}
setScrollLeft(cm,Math.max(0,scroll.scrollLeft+dx*pixelsPerUnit));if(!dy||(dy&&canScrollY))
{e_preventDefault(e);}
display.wheelStartX=null;return}
if(dy&&pixelsPerUnit!=null){var pixels=dy*pixelsPerUnit;var top=cm.doc.scrollTop,bot=top+display.wrapper.clientHeight;if(pixels<0){top=Math.max(0,top+pixels-50);}
else{bot=Math.min(cm.doc.height,bot+pixels+50);}
updateDisplaySimple(cm,{top:top,bottom:bot});}
if(wheelSamples<20&&e.deltaMode!==0){if(display.wheelStartX==null){display.wheelStartX=scroll.scrollLeft;display.wheelStartY=scroll.scrollTop;display.wheelDX=dx;display.wheelDY=dy;setTimeout(function(){if(display.wheelStartX==null){return}
var movedX=scroll.scrollLeft-display.wheelStartX;var movedY=scroll.scrollTop-display.wheelStartY;var sample=(movedY&&display.wheelDY&&movedY/display.wheelDY)||(movedX&&display.wheelDX&&movedX/display.wheelDX);display.wheelStartX=display.wheelStartY=null;if(!sample){return}
wheelPixelsPerUnit=(wheelPixelsPerUnit*wheelSamples+sample)/(wheelSamples+1);++wheelSamples;},200);}else{display.wheelDX+=dx;display.wheelDY+=dy;}}}
var Selection=function(ranges,primIndex){this.ranges=ranges;this.primIndex=primIndex;};Selection.prototype.primary=function(){return this.ranges[this.primIndex]};Selection.prototype.equals=function(other){if(other==this){return true}
if(other.primIndex!=this.primIndex||other.ranges.length!=this.ranges.length){return false}
for(var i=0;i<this.ranges.length;i++){var here=this.ranges[i],there=other.ranges[i];if(!equalCursorPos(here.anchor,there.anchor)||!equalCursorPos(here.head,there.head)){return false}}
return true};Selection.prototype.deepCopy=function(){var out=[];for(var i=0;i<this.ranges.length;i++)
{out[i]=new Range(copyPos(this.ranges[i].anchor),copyPos(this.ranges[i].head));}
return new Selection(out,this.primIndex)};Selection.prototype.somethingSelected=function(){for(var i=0;i<this.ranges.length;i++)
{if(!this.ranges[i].empty()){return true}}
return false};Selection.prototype.contains=function(pos,end){if(!end){end=pos;}
for(var i=0;i<this.ranges.length;i++){var range=this.ranges[i];if(cmp(end,range.from())>=0&&cmp(pos,range.to())<=0)
{return i}}
return-1};var Range=function(anchor,head){this.anchor=anchor;this.head=head;};Range.prototype.from=function(){return minPos(this.anchor,this.head)};Range.prototype.to=function(){return maxPos(this.anchor,this.head)};Range.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function normalizeSelection(cm,ranges,primIndex){var mayTouch=cm&&cm.options.selectionsMayTouch;var prim=ranges[primIndex];ranges.sort(function(a,b){return cmp(a.from(),b.from());});primIndex=indexOf(ranges,prim);for(var i=1;i<ranges.length;i++){var cur=ranges[i],prev=ranges[i-1];var diff=cmp(prev.to(),cur.from());if(mayTouch&&!cur.empty()?diff>0:diff>=0){var from=minPos(prev.from(),cur.from()),to=maxPos(prev.to(),cur.to());var inv=prev.empty()?cur.from()==cur.head:prev.from()==prev.head;if(i<=primIndex){--primIndex;}
ranges.splice(--i,2,new Range(inv?to:from,inv?from:to));}}
return new Selection(ranges,primIndex)}
function simpleSelection(anchor,head){return new Selection([new Range(anchor,head||anchor)],0)}
function changeEnd(change){if(!change.text){return change.to}
return Pos(change.from.line+change.text.length-1,lst(change.text).length+(change.text.length==1?change.from.ch:0))}
function adjustForChange(pos,change){if(cmp(pos,change.from)<0){return pos}
if(cmp(pos,change.to)<=0){return changeEnd(change)}
var line=pos.line+change.text.length-(change.to.line-change.from.line)-1,ch=pos.ch;if(pos.line==change.to.line){ch+=changeEnd(change).ch-change.to.ch;}
return Pos(line,ch)}
function computeSelAfterChange(doc,change){var out=[];for(var i=0;i<doc.sel.ranges.length;i++){var range=doc.sel.ranges[i];out.push(new Range(adjustForChange(range.anchor,change),adjustForChange(range.head,change)));}
return normalizeSelection(doc.cm,out,doc.sel.primIndex)}
function offsetPos(pos,old,nw){if(pos.line==old.line)
{return Pos(nw.line,pos.ch-old.ch+nw.ch)}
else
{return Pos(nw.line+(pos.line-old.line),pos.ch)}}
function computeReplacedSel(doc,changes,hint){var out=[];var oldPrev=Pos(doc.first,0),newPrev=oldPrev;for(var i=0;i<changes.length;i++){var change=changes[i];var from=offsetPos(change.from,oldPrev,newPrev);var to=offsetPos(changeEnd(change),oldPrev,newPrev);oldPrev=change.to;newPrev=to;if(hint=="around"){var range=doc.sel.ranges[i],inv=cmp(range.head,range.anchor)<0;out[i]=new Range(inv?to:from,inv?from:to);}else{out[i]=new Range(from,from);}}
return new Selection(out,doc.sel.primIndex)}
function loadMode(cm){cm.doc.mode=getMode(cm.options,cm.doc.modeOption);resetModeState(cm);}
function resetModeState(cm){cm.doc.iter(function(line){if(line.stateAfter){line.stateAfter=null;}
if(line.styles){line.styles=null;}});cm.doc.modeFrontier=cm.doc.highlightFrontier=cm.doc.first;startWorker(cm,100);cm.state.modeGen++;if(cm.curOp){regChange(cm);}}
function isWholeLineUpdate(doc,change){return change.from.ch==0&&change.to.ch==0&&lst(change.text)==""&&(!doc.cm||doc.cm.options.wholeLineUpdateBefore)}
function updateDoc(doc,change,markedSpans,estimateHeight){function spansFor(n){return markedSpans?markedSpans[n]:null}
function update(line,text,spans){updateLine(line,text,spans,estimateHeight);signalLater(line,"change",line,change);}
function linesFor(start,end){var result=[];for(var i=start;i<end;++i)
{result.push(new Line(text[i],spansFor(i),estimateHeight));}
return result}
var from=change.from,to=change.to,text=change.text;var firstLine=getLine(doc,from.line),lastLine=getLine(doc,to.line);var lastText=lst(text),lastSpans=spansFor(text.length-1),nlines=to.line-from.line;if(change.full){doc.insert(0,linesFor(0,text.length));doc.remove(text.length,doc.size-text.length);}else if(isWholeLineUpdate(doc,change)){var added=linesFor(0,text.length-1);update(lastLine,lastLine.text,lastSpans);if(nlines){doc.remove(from.line,nlines);}
if(added.length){doc.insert(from.line,added);}}else if(firstLine==lastLine){if(text.length==1){update(firstLine,firstLine.text.slice(0,from.ch)+lastText+firstLine.text.slice(to.ch),lastSpans);}else{var added$1=linesFor(1,text.length-1);added$1.push(new Line(lastText+firstLine.text.slice(to.ch),lastSpans,estimateHeight));update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0));doc.insert(from.line+1,added$1);}}else if(text.length==1){update(firstLine,firstLine.text.slice(0,from.ch)+text[0]+lastLine.text.slice(to.ch),spansFor(0));doc.remove(from.line+1,nlines);}else{update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0));update(lastLine,lastText+lastLine.text.slice(to.ch),lastSpans);var added$2=linesFor(1,text.length-1);if(nlines>1){doc.remove(from.line+1,nlines-1);}
doc.insert(from.line+1,added$2);}
signalLater(doc,"change",doc,change);}
function linkedDocs(doc,f,sharedHistOnly){function propagate(doc,skip,sharedHist){if(doc.linked){for(var i=0;i<doc.linked.length;++i){var rel=doc.linked[i];if(rel.doc==skip){continue}
var shared=sharedHist&&rel.sharedHist;if(sharedHistOnly&&!shared){continue}
f(rel.doc,shared);propagate(rel.doc,doc,shared);}}}
propagate(doc,null,true);}
function attachDoc(cm,doc){if(doc.cm){throw new Error("This document is already in use.")}
cm.doc=doc;doc.cm=cm;estimateLineHeights(cm);loadMode(cm);setDirectionClass(cm);cm.options.direction=doc.direction;if(!cm.options.lineWrapping){findMaxLine(cm);}
cm.options.mode=doc.modeOption;regChange(cm);}
function setDirectionClass(cm){(cm.doc.direction=="rtl"?addClass:rmClass)(cm.display.lineDiv,"CodeMirror-rtl");}
function directionChanged(cm){runInOp(cm,function(){setDirectionClass(cm);regChange(cm);});}
function History(prev){this.done=[];this.undone=[];this.undoDepth=prev?prev.undoDepth:Infinity;this.lastModTime=this.lastSelTime=0;this.lastOp=this.lastSelOp=null;this.lastOrigin=this.lastSelOrigin=null;this.generation=this.maxGeneration=prev?prev.maxGeneration:1;}
function historyChangeFromChange(doc,change){var histChange={from:copyPos(change.from),to:changeEnd(change),text:getBetween(doc,change.from,change.to)};attachLocalSpans(doc,histChange,change.from.line,change.to.line+1);linkedDocs(doc,function(doc){return attachLocalSpans(doc,histChange,change.from.line,change.to.line+1);},true);return histChange}
function clearSelectionEvents(array){while(array.length){var last=lst(array);if(last.ranges){array.pop();}
else{break}}}
function lastChangeEvent(hist,force){if(force){clearSelectionEvents(hist.done);return lst(hist.done)}else if(hist.done.length&&!lst(hist.done).ranges){return lst(hist.done)}else if(hist.done.length>1&&!hist.done[hist.done.length-2].ranges){hist.done.pop();return lst(hist.done)}}
function addChangeToHistory(doc,change,selAfter,opId){var hist=doc.history;hist.undone.length=0;var time=+new Date,cur;var last;if((hist.lastOp==opId||hist.lastOrigin==change.origin&&change.origin&&((change.origin.charAt(0)=="+"&&hist.lastModTime>time-(doc.cm?doc.cm.options.historyEventDelay:500))||change.origin.charAt(0)=="*"))&&(cur=lastChangeEvent(hist,hist.lastOp==opId))){last=lst(cur.changes);if(cmp(change.from,change.to)==0&&cmp(change.from,last.to)==0){last.to=changeEnd(change);}else{cur.changes.push(historyChangeFromChange(doc,change));}}else{var before=lst(hist.done);if(!before||!before.ranges)
{pushSelectionToHistory(doc.sel,hist.done);}
cur={changes:[historyChangeFromChange(doc,change)],generation:hist.generation};hist.done.push(cur);while(hist.done.length>hist.undoDepth){hist.done.shift();if(!hist.done[0].ranges){hist.done.shift();}}}
hist.done.push(selAfter);hist.generation=++hist.maxGeneration;hist.lastModTime=hist.lastSelTime=time;hist.lastOp=hist.lastSelOp=opId;hist.lastOrigin=hist.lastSelOrigin=change.origin;if(!last){signal(doc,"historyAdded");}}
function selectionEventCanBeMerged(doc,origin,prev,sel){var ch=origin.charAt(0);return ch=="*"||ch=="+"&&prev.ranges.length==sel.ranges.length&&prev.somethingSelected()==sel.somethingSelected()&&new Date-doc.history.lastSelTime<=(doc.cm?doc.cm.options.historyEventDelay:500)}
function addSelectionToHistory(doc,sel,opId,options){var hist=doc.history,origin=options&&options.origin;if(opId==hist.lastSelOp||(origin&&hist.lastSelOrigin==origin&&(hist.lastModTime==hist.lastSelTime&&hist.lastOrigin==origin||selectionEventCanBeMerged(doc,origin,lst(hist.done),sel))))
{hist.done[hist.done.length-1]=sel;}
else
{pushSelectionToHistory(sel,hist.done);}
hist.lastSelTime=+new Date;hist.lastSelOrigin=origin;hist.lastSelOp=opId;if(options&&options.clearRedo!==false)
{clearSelectionEvents(hist.undone);}}
function pushSelectionToHistory(sel,dest){var top=lst(dest);if(!(top&&top.ranges&&top.equals(sel)))
{dest.push(sel);}}
function attachLocalSpans(doc,change,from,to){var existing=change["spans_"+doc.id],n=0;doc.iter(Math.max(doc.first,from),Math.min(doc.first+doc.size,to),function(line){if(line.markedSpans)
{(existing||(existing=change["spans_"+doc.id]={}))[n]=line.markedSpans;}
++n;});}
function removeClearedSpans(spans){if(!spans){return null}
var out;for(var i=0;i<spans.length;++i){if(spans[i].marker.explicitlyCleared){if(!out){out=spans.slice(0,i);}}
else if(out){out.push(spans[i]);}}
return!out?spans:out.length?out:null}
function getOldSpans(doc,change){var found=change["spans_"+doc.id];if(!found){return null}
var nw=[];for(var i=0;i<change.text.length;++i)
{nw.push(removeClearedSpans(found[i]));}
return nw}
function mergeOldSpans(doc,change){var old=getOldSpans(doc,change);var stretched=stretchSpansOverChange(doc,change);if(!old){return stretched}
if(!stretched){return old}
for(var i=0;i<old.length;++i){var oldCur=old[i],stretchCur=stretched[i];if(oldCur&&stretchCur){spans:for(var j=0;j<stretchCur.length;++j){var span=stretchCur[j];for(var k=0;k<oldCur.length;++k)
{if(oldCur[k].marker==span.marker){continue spans}}
oldCur.push(span);}}else if(stretchCur){old[i]=stretchCur;}}
return old}
function copyHistoryArray(events,newGroup,instantiateSel){var copy=[];for(var i=0;i<events.length;++i){var event=events[i];if(event.ranges){copy.push(instantiateSel?Selection.prototype.deepCopy.call(event):event);continue}
var changes=event.changes,newChanges=[];copy.push({changes:newChanges});for(var j=0;j<changes.length;++j){var change=changes[j],m=(void 0);newChanges.push({from:change.from,to:change.to,text:change.text});if(newGroup){for(var prop in change){if(m=prop.match(/^spans_(\d+)$/)){if(indexOf(newGroup,Number(m[1]))>-1){lst(newChanges)[prop]=change[prop];delete change[prop];}}}}}}
return copy}
function extendRange(range,head,other,extend){if(extend){var anchor=range.anchor;if(other){var posBefore=cmp(head,anchor)<0;if(posBefore!=(cmp(other,anchor)<0)){anchor=head;head=other;}else if(posBefore!=(cmp(head,other)<0)){head=other;}}
return new Range(anchor,head)}else{return new Range(other||head,head)}}
function extendSelection(doc,head,other,options,extend){if(extend==null){extend=doc.cm&&(doc.cm.display.shift||doc.extend);}
setSelection(doc,new Selection([extendRange(doc.sel.primary(),head,other,extend)],0),options);}
function extendSelections(doc,heads,options){var out=[];var extend=doc.cm&&(doc.cm.display.shift||doc.extend);for(var i=0;i<doc.sel.ranges.length;i++)
{out[i]=extendRange(doc.sel.ranges[i],heads[i],null,extend);}
var newSel=normalizeSelection(doc.cm,out,doc.sel.primIndex);setSelection(doc,newSel,options);}
function replaceOneSelection(doc,i,range,options){var ranges=doc.sel.ranges.slice(0);ranges[i]=range;setSelection(doc,normalizeSelection(doc.cm,ranges,doc.sel.primIndex),options);}
function setSimpleSelection(doc,anchor,head,options){setSelection(doc,simpleSelection(anchor,head),options);}
function filterSelectionChange(doc,sel,options){var obj={ranges:sel.ranges,update:function(ranges){this.ranges=[];for(var i=0;i<ranges.length;i++)
{this.ranges[i]=new Range(clipPos(doc,ranges[i].anchor),clipPos(doc,ranges[i].head));}},origin:options&&options.origin};signal(doc,"beforeSelectionChange",doc,obj);if(doc.cm){signal(doc.cm,"beforeSelectionChange",doc.cm,obj);}
if(obj.ranges!=sel.ranges){return normalizeSelection(doc.cm,obj.ranges,obj.ranges.length-1)}
else{return sel}}
function setSelectionReplaceHistory(doc,sel,options){var done=doc.history.done,last=lst(done);if(last&&last.ranges){done[done.length-1]=sel;setSelectionNoUndo(doc,sel,options);}else{setSelection(doc,sel,options);}}
function setSelection(doc,sel,options){setSelectionNoUndo(doc,sel,options);addSelectionToHistory(doc,doc.sel,doc.cm?doc.cm.curOp.id:NaN,options);}
function setSelectionNoUndo(doc,sel,options){if(hasHandler(doc,"beforeSelectionChange")||doc.cm&&hasHandler(doc.cm,"beforeSelectionChange"))
{sel=filterSelectionChange(doc,sel,options);}
var bias=options&&options.bias||(cmp(sel.primary().head,doc.sel.primary().head)<0?-1:1);setSelectionInner(doc,skipAtomicInSelection(doc,sel,bias,true));if(!(options&&options.scroll===false)&&doc.cm&&doc.cm.getOption("readOnly")!="nocursor")
{ensureCursorVisible(doc.cm);}}
function setSelectionInner(doc,sel){if(sel.equals(doc.sel)){return}
doc.sel=sel;if(doc.cm){doc.cm.curOp.updateInput=1;doc.cm.curOp.selectionChanged=true;signalCursorActivity(doc.cm);}
signalLater(doc,"cursorActivity",doc);}
function reCheckSelection(doc){setSelectionInner(doc,skipAtomicInSelection(doc,doc.sel,null,false));}
function skipAtomicInSelection(doc,sel,bias,mayClear){var out;for(var i=0;i<sel.ranges.length;i++){var range=sel.ranges[i];var old=sel.ranges.length==doc.sel.ranges.length&&doc.sel.ranges[i];var newAnchor=skipAtomic(doc,range.anchor,old&&old.anchor,bias,mayClear);var newHead=range.head==range.anchor?newAnchor:skipAtomic(doc,range.head,old&&old.head,bias,mayClear);if(out||newAnchor!=range.anchor||newHead!=range.head){if(!out){out=sel.ranges.slice(0,i);}
out[i]=new Range(newAnchor,newHead);}}
return out?normalizeSelection(doc.cm,out,sel.primIndex):sel}
function skipAtomicInner(doc,pos,oldPos,dir,mayClear){var line=getLine(doc,pos.line);if(line.markedSpans){for(var i=0;i<line.markedSpans.length;++i){var sp=line.markedSpans[i],m=sp.marker;var preventCursorLeft=("selectLeft"in m)?!m.selectLeft:m.inclusiveLeft;var preventCursorRight=("selectRight"in m)?!m.selectRight:m.inclusiveRight;if((sp.from==null||(preventCursorLeft?sp.from<=pos.ch:sp.from<pos.ch))&&(sp.to==null||(preventCursorRight?sp.to>=pos.ch:sp.to>pos.ch))){if(mayClear){signal(m,"beforeCursorEnter");if(m.explicitlyCleared){if(!line.markedSpans){break}
else{--i;continue}}}
if(!m.atomic){continue}
if(oldPos){var near=m.find(dir<0?1:-1),diff=(void 0);if(dir<0?preventCursorRight:preventCursorLeft)
{near=movePos(doc,near,-dir,near&&near.line==pos.line?line:null);}
if(near&&near.line==pos.line&&(diff=cmp(near,oldPos))&&(dir<0?diff<0:diff>0))
{return skipAtomicInner(doc,near,pos,dir,mayClear)}}
var far=m.find(dir<0?-1:1);if(dir<0?preventCursorLeft:preventCursorRight)
{far=movePos(doc,far,dir,far.line==pos.line?line:null);}
return far?skipAtomicInner(doc,far,pos,dir,mayClear):null}}}
return pos}
function skipAtomic(doc,pos,oldPos,bias,mayClear){var dir=bias||1;var found=skipAtomicInner(doc,pos,oldPos,dir,mayClear)||(!mayClear&&skipAtomicInner(doc,pos,oldPos,dir,true))||skipAtomicInner(doc,pos,oldPos,-dir,mayClear)||(!mayClear&&skipAtomicInner(doc,pos,oldPos,-dir,true));if(!found){doc.cantEdit=true;return Pos(doc.first,0)}
return found}
function movePos(doc,pos,dir,line){if(dir<0&&pos.ch==0){if(pos.line>doc.first){return clipPos(doc,Pos(pos.line-1))}
else{return null}}else if(dir>0&&pos.ch==(line||getLine(doc,pos.line)).text.length){if(pos.line<doc.first+doc.size-1){return Pos(pos.line+1,0)}
else{return null}}else{return new Pos(pos.line,pos.ch+dir)}}
function selectAll(cm){cm.setSelection(Pos(cm.firstLine(),0),Pos(cm.lastLine()),sel_dontScroll);}
function filterChange(doc,change,update){var obj={canceled:false,from:change.from,to:change.to,text:change.text,origin:change.origin,cancel:function(){return obj.canceled=true;}};if(update){obj.update=function(from,to,text,origin){if(from){obj.from=clipPos(doc,from);}
if(to){obj.to=clipPos(doc,to);}
if(text){obj.text=text;}
if(origin!==undefined){obj.origin=origin;}};}
signal(doc,"beforeChange",doc,obj);if(doc.cm){signal(doc.cm,"beforeChange",doc.cm,obj);}
if(obj.canceled){if(doc.cm){doc.cm.curOp.updateInput=2;}
return null}
return{from:obj.from,to:obj.to,text:obj.text,origin:obj.origin}}
function makeChange(doc,change,ignoreReadOnly){if(doc.cm){if(!doc.cm.curOp){return operation(doc.cm,makeChange)(doc,change,ignoreReadOnly)}
if(doc.cm.state.suppressEdits){return}}
if(hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange")){change=filterChange(doc,change,true);if(!change){return}}
var split=sawReadOnlySpans&&!ignoreReadOnly&&removeReadOnlyRanges(doc,change.from,change.to);if(split){for(var i=split.length-1;i>=0;--i)
{makeChangeInner(doc,{from:split[i].from,to:split[i].to,text:i?[""]:change.text,origin:change.origin});}}else{makeChangeInner(doc,change);}}
function makeChangeInner(doc,change){if(change.text.length==1&&change.text[0]==""&&cmp(change.from,change.to)==0){return}
var selAfter=computeSelAfterChange(doc,change);addChangeToHistory(doc,change,selAfter,doc.cm?doc.cm.curOp.id:NaN);makeChangeSingleDoc(doc,change,selAfter,stretchSpansOverChange(doc,change));var rebased=[];linkedDocs(doc,function(doc,sharedHist){if(!sharedHist&&indexOf(rebased,doc.history)==-1){rebaseHist(doc.history,change);rebased.push(doc.history);}
makeChangeSingleDoc(doc,change,null,stretchSpansOverChange(doc,change));});}
function makeChangeFromHistory(doc,type,allowSelectionOnly){var suppress=doc.cm&&doc.cm.state.suppressEdits;if(suppress&&!allowSelectionOnly){return}
var hist=doc.history,event,selAfter=doc.sel;var source=type=="undo"?hist.done:hist.undone,dest=type=="undo"?hist.undone:hist.done;var i=0;for(;i<source.length;i++){event=source[i];if(allowSelectionOnly?event.ranges&&!event.equals(doc.sel):!event.ranges)
{break}}
if(i==source.length){return}
hist.lastOrigin=hist.lastSelOrigin=null;for(;;){event=source.pop();if(event.ranges){pushSelectionToHistory(event,dest);if(allowSelectionOnly&&!event.equals(doc.sel)){setSelection(doc,event,{clearRedo:false});return}
selAfter=event;}else if(suppress){source.push(event);return}else{break}}
var antiChanges=[];pushSelectionToHistory(selAfter,dest);dest.push({changes:antiChanges,generation:hist.generation});hist.generation=event.generation||++hist.maxGeneration;var filter=hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange");var loop=function(i){var change=event.changes[i];change.origin=type;if(filter&&!filterChange(doc,change,false)){source.length=0;return{}}
antiChanges.push(historyChangeFromChange(doc,change));var after=i?computeSelAfterChange(doc,change):lst(source);makeChangeSingleDoc(doc,change,after,mergeOldSpans(doc,change));if(!i&&doc.cm){doc.cm.scrollIntoView({from:change.from,to:changeEnd(change)});}
var rebased=[];linkedDocs(doc,function(doc,sharedHist){if(!sharedHist&&indexOf(rebased,doc.history)==-1){rebaseHist(doc.history,change);rebased.push(doc.history);}
makeChangeSingleDoc(doc,change,null,mergeOldSpans(doc,change));});};for(var i$1=event.changes.length-1;i$1>=0;--i$1){var returned=loop(i$1);if(returned)return returned.v;}}
function shiftDoc(doc,distance){if(distance==0){return}
doc.first+=distance;doc.sel=new Selection(map(doc.sel.ranges,function(range){return new Range(Pos(range.anchor.line+distance,range.anchor.ch),Pos(range.head.line+distance,range.head.ch));}),doc.sel.primIndex);if(doc.cm){regChange(doc.cm,doc.first,doc.first-distance,distance);for(var d=doc.cm.display,l=d.viewFrom;l<d.viewTo;l++)
{regLineChange(doc.cm,l,"gutter");}}}
function makeChangeSingleDoc(doc,change,selAfter,spans){if(doc.cm&&!doc.cm.curOp)
{return operation(doc.cm,makeChangeSingleDoc)(doc,change,selAfter,spans)}
if(change.to.line<doc.first){shiftDoc(doc,change.text.length-1-(change.to.line-change.from.line));return}
if(change.from.line>doc.lastLine()){return}
if(change.from.line<doc.first){var shift=change.text.length-1-(doc.first-change.from.line);shiftDoc(doc,shift);change={from:Pos(doc.first,0),to:Pos(change.to.line+shift,change.to.ch),text:[lst(change.text)],origin:change.origin};}
var last=doc.lastLine();if(change.to.line>last){change={from:change.from,to:Pos(last,getLine(doc,last).text.length),text:[change.text[0]],origin:change.origin};}
change.removed=getBetween(doc,change.from,change.to);if(!selAfter){selAfter=computeSelAfterChange(doc,change);}
if(doc.cm){makeChangeSingleDocInEditor(doc.cm,change,spans);}
else{updateDoc(doc,change,spans);}
setSelectionNoUndo(doc,selAfter,sel_dontScroll);if(doc.cantEdit&&skipAtomic(doc,Pos(doc.firstLine(),0)))
{doc.cantEdit=false;}}
function makeChangeSingleDocInEditor(cm,change,spans){var doc=cm.doc,display=cm.display,from=change.from,to=change.to;var recomputeMaxLength=false,checkWidthStart=from.line;if(!cm.options.lineWrapping){checkWidthStart=lineNo(visualLine(getLine(doc,from.line)));doc.iter(checkWidthStart,to.line+1,function(line){if(line==display.maxLine){recomputeMaxLength=true;return true}});}
if(doc.sel.contains(change.from,change.to)>-1)
{signalCursorActivity(cm);}
updateDoc(doc,change,spans,estimateHeight(cm));if(!cm.options.lineWrapping){doc.iter(checkWidthStart,from.line+change.text.length,function(line){var len=lineLength(line);if(len>display.maxLineLength){display.maxLine=line;display.maxLineLength=len;display.maxLineChanged=true;recomputeMaxLength=false;}});if(recomputeMaxLength){cm.curOp.updateMaxLine=true;}}
retreatFrontier(doc,from.line);startWorker(cm,400);var lendiff=change.text.length-(to.line-from.line)-1;if(change.full)
{regChange(cm);}
else if(from.line==to.line&&change.text.length==1&&!isWholeLineUpdate(cm.doc,change))
{regLineChange(cm,from.line,"text");}
else
{regChange(cm,from.line,to.line+1,lendiff);}
var changesHandler=hasHandler(cm,"changes"),changeHandler=hasHandler(cm,"change");if(changeHandler||changesHandler){var obj={from:from,to:to,text:change.text,removed:change.removed,origin:change.origin};if(changeHandler){signalLater(cm,"change",cm,obj);}
if(changesHandler){(cm.curOp.changeObjs||(cm.curOp.changeObjs=[])).push(obj);}}
cm.display.selForContextMenu=null;}
function replaceRange(doc,code,from,to,origin){var assign;if(!to){to=from;}
if(cmp(to,from)<0){(assign=[to,from],from=assign[0],to=assign[1]);}
if(typeof code=="string"){code=doc.splitLines(code);}
makeChange(doc,{from:from,to:to,text:code,origin:origin});}
function rebaseHistSelSingle(pos,from,to,diff){if(to<pos.line){pos.line+=diff;}else if(from<pos.line){pos.line=from;pos.ch=0;}}
function rebaseHistArray(array,from,to,diff){for(var i=0;i<array.length;++i){var sub=array[i],ok=true;if(sub.ranges){if(!sub.copied){sub=array[i]=sub.deepCopy();sub.copied=true;}
for(var j=0;j<sub.ranges.length;j++){rebaseHistSelSingle(sub.ranges[j].anchor,from,to,diff);rebaseHistSelSingle(sub.ranges[j].head,from,to,diff);}
continue}
for(var j$1=0;j$1<sub.changes.length;++j$1){var cur=sub.changes[j$1];if(to<cur.from.line){cur.from=Pos(cur.from.line+diff,cur.from.ch);cur.to=Pos(cur.to.line+diff,cur.to.ch);}else if(from<=cur.to.line){ok=false;break}}
if(!ok){array.splice(0,i+1);i=0;}}}
function rebaseHist(hist,change){var from=change.from.line,to=change.to.line,diff=change.text.length-(to-from)-1;rebaseHistArray(hist.done,from,to,diff);rebaseHistArray(hist.undone,from,to,diff);}
function changeLine(doc,handle,changeType,op){var no=handle,line=handle;if(typeof handle=="number"){line=getLine(doc,clipLine(doc,handle));}
else{no=lineNo(handle);}
if(no==null){return null}
if(op(line,no)&&doc.cm){regLineChange(doc.cm,no,changeType);}
return line}
function LeafChunk(lines){this.lines=lines;this.parent=null;var height=0;for(var i=0;i<lines.length;++i){lines[i].parent=this;height+=lines[i].height;}
this.height=height;}
LeafChunk.prototype={chunkSize:function(){return this.lines.length},removeInner:function(at,n){for(var i=at,e=at+n;i<e;++i){var line=this.lines[i];this.height-=line.height;cleanUpLine(line);signalLater(line,"delete");}
this.lines.splice(at,n);},collapse:function(lines){lines.push.apply(lines,this.lines);},insertInner:function(at,lines,height){this.height+=height;this.lines=this.lines.slice(0,at).concat(lines).concat(this.lines.slice(at));for(var i=0;i<lines.length;++i){lines[i].parent=this;}},iterN:function(at,n,op){for(var e=at+n;at<e;++at)
{if(op(this.lines[at])){return true}}}};function BranchChunk(children){this.children=children;var size=0,height=0;for(var i=0;i<children.length;++i){var ch=children[i];size+=ch.chunkSize();height+=ch.height;ch.parent=this;}
this.size=size;this.height=height;this.parent=null;}
BranchChunk.prototype={chunkSize:function(){return this.size},removeInner:function(at,n){this.size-=n;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var rm=Math.min(n,sz-at),oldHeight=child.height;child.removeInner(at,rm);this.height-=oldHeight-child.height;if(sz==rm){this.children.splice(i--,1);child.parent=null;}
if((n-=rm)==0){break}
at=0;}else{at-=sz;}}
if(this.size-n<25&&(this.children.length>1||!(this.children[0]instanceof LeafChunk))){var lines=[];this.collapse(lines);this.children=[new LeafChunk(lines)];this.children[0].parent=this;}},collapse:function(lines){for(var i=0;i<this.children.length;++i){this.children[i].collapse(lines);}},insertInner:function(at,lines,height){this.size+=lines.length;this.height+=height;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<=sz){child.insertInner(at,lines,height);if(child.lines&&child.lines.length>50){var remaining=child.lines.length%25+25;for(var pos=remaining;pos<child.lines.length;){var leaf=new LeafChunk(child.lines.slice(pos,pos+=25));child.height-=leaf.height;this.children.splice(++i,0,leaf);leaf.parent=this;}
child.lines=child.lines.slice(0,remaining);this.maybeSpill();}
break}
at-=sz;}},maybeSpill:function(){if(this.children.length<=10){return}
var me=this;do{var spilled=me.children.splice(me.children.length-5,5);var sibling=new BranchChunk(spilled);if(!me.parent){var copy=new BranchChunk(me.children);copy.parent=me;me.children=[copy,sibling];me=copy;}else{me.size-=sibling.size;me.height-=sibling.height;var myIndex=indexOf(me.parent.children,me);me.parent.children.splice(myIndex+1,0,sibling);}
sibling.parent=me.parent;}while(me.children.length>10)
me.parent.maybeSpill();},iterN:function(at,n,op){for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var used=Math.min(n,sz-at);if(child.iterN(at,used,op)){return true}
if((n-=used)==0){break}
at=0;}else{at-=sz;}}}};var LineWidget=function(doc,node,options){if(options){for(var opt in options){if(options.hasOwnProperty(opt))
{this[opt]=options[opt];}}}
this.doc=doc;this.node=node;};LineWidget.prototype.clear=function(){var cm=this.doc.cm,ws=this.line.widgets,line=this.line,no=lineNo(line);if(no==null||!ws){return}
for(var i=0;i<ws.length;++i){if(ws[i]==this){ws.splice(i--,1);}}
if(!ws.length){line.widgets=null;}
var height=widgetHeight(this);updateLineHeight(line,Math.max(0,line.height-height));if(cm){runInOp(cm,function(){adjustScrollWhenAboveVisible(cm,line,-height);regLineChange(cm,no,"widget");});signalLater(cm,"lineWidgetCleared",cm,this,no);}};LineWidget.prototype.changed=function(){var this$1=this;var oldH=this.height,cm=this.doc.cm,line=this.line;this.height=null;var diff=widgetHeight(this)-oldH;if(!diff){return}
if(!lineIsHidden(this.doc,line)){updateLineHeight(line,line.height+diff);}
if(cm){runInOp(cm,function(){cm.curOp.forceUpdate=true;adjustScrollWhenAboveVisible(cm,line,diff);signalLater(cm,"lineWidgetChanged",cm,this$1,lineNo(line));});}};eventMixin(LineWidget);function adjustScrollWhenAboveVisible(cm,line,diff){if(heightAtLine(line)<((cm.curOp&&cm.curOp.scrollTop)||cm.doc.scrollTop))
{addToScrollTop(cm,diff);}}
function addLineWidget(doc,handle,node,options){var widget=new LineWidget(doc,node,options);var cm=doc.cm;if(cm&&widget.noHScroll){cm.display.alignWidgets=true;}
changeLine(doc,handle,"widget",function(line){var widgets=line.widgets||(line.widgets=[]);if(widget.insertAt==null){widgets.push(widget);}
else{widgets.splice(Math.min(widgets.length,Math.max(0,widget.insertAt)),0,widget);}
widget.line=line;if(cm&&!lineIsHidden(doc,line)){var aboveVisible=heightAtLine(line)<doc.scrollTop;updateLineHeight(line,line.height+widgetHeight(widget));if(aboveVisible){addToScrollTop(cm,widget.height);}
cm.curOp.forceUpdate=true;}
return true});if(cm){signalLater(cm,"lineWidgetAdded",cm,widget,typeof handle=="number"?handle:lineNo(handle));}
return widget}
var nextMarkerId=0;var TextMarker=function(doc,type){this.lines=[];this.type=type;this.doc=doc;this.id=++nextMarkerId;};TextMarker.prototype.clear=function(){if(this.explicitlyCleared){return}
var cm=this.doc.cm,withOp=cm&&!cm.curOp;if(withOp){startOperation(cm);}
if(hasHandler(this,"clear")){var found=this.find();if(found){signalLater(this,"clear",found.from,found.to);}}
var min=null,max=null;for(var i=0;i<this.lines.length;++i){var line=this.lines[i];var span=getMarkedSpanFor(line.markedSpans,this);if(cm&&!this.collapsed){regLineChange(cm,lineNo(line),"text");}
else if(cm){if(span.to!=null){max=lineNo(line);}
if(span.from!=null){min=lineNo(line);}}
line.markedSpans=removeMarkedSpan(line.markedSpans,span);if(span.from==null&&this.collapsed&&!lineIsHidden(this.doc,line)&&cm)
{updateLineHeight(line,textHeight(cm.display));}}
if(cm&&this.collapsed&&!cm.options.lineWrapping){for(var i$1=0;i$1<this.lines.length;++i$1){var visual=visualLine(this.lines[i$1]),len=lineLength(visual);if(len>cm.display.maxLineLength){cm.display.maxLine=visual;cm.display.maxLineLength=len;cm.display.maxLineChanged=true;}}}
if(min!=null&&cm&&this.collapsed){regChange(cm,min,max+1);}
this.lines.length=0;this.explicitlyCleared=true;if(this.atomic&&this.doc.cantEdit){this.doc.cantEdit=false;if(cm){reCheckSelection(cm.doc);}}
if(cm){signalLater(cm,"markerCleared",cm,this,min,max);}
if(withOp){endOperation(cm);}
if(this.parent){this.parent.clear();}};TextMarker.prototype.find=function(side,lineObj){if(side==null&&this.type=="bookmark"){side=1;}
var from,to;for(var i=0;i<this.lines.length;++i){var line=this.lines[i];var span=getMarkedSpanFor(line.markedSpans,this);if(span.from!=null){from=Pos(lineObj?line:lineNo(line),span.from);if(side==-1){return from}}
if(span.to!=null){to=Pos(lineObj?line:lineNo(line),span.to);if(side==1){return to}}}
return from&&{from:from,to:to}};TextMarker.prototype.changed=function(){var this$1=this;var pos=this.find(-1,true),widget=this,cm=this.doc.cm;if(!pos||!cm){return}
runInOp(cm,function(){var line=pos.line,lineN=lineNo(pos.line);var view=findViewForLine(cm,lineN);if(view){clearLineMeasurementCacheFor(view);cm.curOp.selectionChanged=cm.curOp.forceUpdate=true;}
cm.curOp.updateMaxLine=true;if(!lineIsHidden(widget.doc,line)&&widget.height!=null){var oldHeight=widget.height;widget.height=null;var dHeight=widgetHeight(widget)-oldHeight;if(dHeight)
{updateLineHeight(line,line.height+dHeight);}}
signalLater(cm,"markerChanged",cm,this$1);});};TextMarker.prototype.attachLine=function(line){if(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;if(!op.maybeHiddenMarkers||indexOf(op.maybeHiddenMarkers,this)==-1)
{(op.maybeUnhiddenMarkers||(op.maybeUnhiddenMarkers=[])).push(this);}}
this.lines.push(line);};TextMarker.prototype.detachLine=function(line){this.lines.splice(indexOf(this.lines,line),1);if(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;(op.maybeHiddenMarkers||(op.maybeHiddenMarkers=[])).push(this);}};eventMixin(TextMarker);function markText(doc,from,to,options,type){if(options&&options.shared){return markTextShared(doc,from,to,options,type)}
if(doc.cm&&!doc.cm.curOp){return operation(doc.cm,markText)(doc,from,to,options,type)}
var marker=new TextMarker(doc,type),diff=cmp(from,to);if(options){copyObj(options,marker,false);}
if(diff>0||diff==0&&marker.clearWhenEmpty!==false)
{return marker}
if(marker.replacedWith){marker.collapsed=true;marker.widgetNode=eltP("span",[marker.replacedWith],"CodeMirror-widget");if(!options.handleMouseEvents){marker.widgetNode.setAttribute("cm-ignore-events","true");}
if(options.insertLeft){marker.widgetNode.insertLeft=true;}}
if(marker.collapsed){if(conflictingCollapsedRange(doc,from.line,from,to,marker)||from.line!=to.line&&conflictingCollapsedRange(doc,to.line,from,to,marker))
{throw new Error("Inserting collapsed marker partially overlapping an existing one")}
seeCollapsedSpans();}
if(marker.addToHistory)
{addChangeToHistory(doc,{from:from,to:to,origin:"markText"},doc.sel,NaN);}
var curLine=from.line,cm=doc.cm,updateMaxLine;doc.iter(curLine,to.line+1,function(line){if(cm&&marker.collapsed&&!cm.options.lineWrapping&&visualLine(line)==cm.display.maxLine)
{updateMaxLine=true;}
if(marker.collapsed&&curLine!=from.line){updateLineHeight(line,0);}
addMarkedSpan(line,new MarkedSpan(marker,curLine==from.line?from.ch:null,curLine==to.line?to.ch:null),doc.cm&&doc.cm.curOp);++curLine;});if(marker.collapsed){doc.iter(from.line,to.line+1,function(line){if(lineIsHidden(doc,line)){updateLineHeight(line,0);}});}
if(marker.clearOnEnter){on(marker,"beforeCursorEnter",function(){return marker.clear();});}
if(marker.readOnly){seeReadOnlySpans();if(doc.history.done.length||doc.history.undone.length)
{doc.clearHistory();}}
if(marker.collapsed){marker.id=++nextMarkerId;marker.atomic=true;}
if(cm){if(updateMaxLine){cm.curOp.updateMaxLine=true;}
if(marker.collapsed)
{regChange(cm,from.line,to.line+1);}
else if(marker.className||marker.startStyle||marker.endStyle||marker.css||marker.attributes||marker.title)
{for(var i=from.line;i<=to.line;i++){regLineChange(cm,i,"text");}}
if(marker.atomic){reCheckSelection(cm.doc);}
signalLater(cm,"markerAdded",cm,marker);}
return marker}
var SharedTextMarker=function(markers,primary){this.markers=markers;this.primary=primary;for(var i=0;i<markers.length;++i)
{markers[i].parent=this;}};SharedTextMarker.prototype.clear=function(){if(this.explicitlyCleared){return}
this.explicitlyCleared=true;for(var i=0;i<this.markers.length;++i)
{this.markers[i].clear();}
signalLater(this,"clear");};SharedTextMarker.prototype.find=function(side,lineObj){return this.primary.find(side,lineObj)};eventMixin(SharedTextMarker);function markTextShared(doc,from,to,options,type){options=copyObj(options);options.shared=false;var markers=[markText(doc,from,to,options,type)],primary=markers[0];var widget=options.widgetNode;linkedDocs(doc,function(doc){if(widget){options.widgetNode=widget.cloneNode(true);}
markers.push(markText(doc,clipPos(doc,from),clipPos(doc,to),options,type));for(var i=0;i<doc.linked.length;++i)
{if(doc.linked[i].isParent){return}}
primary=lst(markers);});return new SharedTextMarker(markers,primary)}
function findSharedMarkers(doc){return doc.findMarks(Pos(doc.first,0),doc.clipPos(Pos(doc.lastLine())),function(m){return m.parent;})}
function copySharedMarkers(doc,markers){for(var i=0;i<markers.length;i++){var marker=markers[i],pos=marker.find();var mFrom=doc.clipPos(pos.from),mTo=doc.clipPos(pos.to);if(cmp(mFrom,mTo)){var subMark=markText(doc,mFrom,mTo,marker.primary,marker.primary.type);marker.markers.push(subMark);subMark.parent=marker;}}}
function detachSharedMarkers(markers){var loop=function(i){var marker=markers[i],linked=[marker.primary.doc];linkedDocs(marker.primary.doc,function(d){return linked.push(d);});for(var j=0;j<marker.markers.length;j++){var subMarker=marker.markers[j];if(indexOf(linked,subMarker.doc)==-1){subMarker.parent=null;marker.markers.splice(j--,1);}}};for(var i=0;i<markers.length;i++)loop(i);}
var nextDocId=0;var Doc=function(text,mode,firstLine,lineSep,direction){if(!(this instanceof Doc)){return new Doc(text,mode,firstLine,lineSep,direction)}
if(firstLine==null){firstLine=0;}
BranchChunk.call(this,[new LeafChunk([new Line("",null)])]);this.first=firstLine;this.scrollTop=this.scrollLeft=0;this.cantEdit=false;this.cleanGeneration=1;this.modeFrontier=this.highlightFrontier=firstLine;var start=Pos(firstLine,0);this.sel=simpleSelection(start);this.history=new History(null);this.id=++nextDocId;this.modeOption=mode;this.lineSep=lineSep;this.direction=(direction=="rtl")?"rtl":"ltr";this.extend=false;if(typeof text=="string"){text=this.splitLines(text);}
updateDoc(this,{from:start,to:start,text:text});setSelection(this,simpleSelection(start),sel_dontScroll);};Doc.prototype=createObj(BranchChunk.prototype,{constructor:Doc,iter:function(from,to,op){if(op){this.iterN(from-this.first,to-from,op);}
else{this.iterN(this.first,this.first+this.size,from);}},insert:function(at,lines){var height=0;for(var i=0;i<lines.length;++i){height+=lines[i].height;}
this.insertInner(at-this.first,lines,height);},remove:function(at,n){this.removeInner(at-this.first,n);},getValue:function(lineSep){var lines=getLines(this,this.first,this.first+this.size);if(lineSep===false){return lines}
return lines.join(lineSep||this.lineSeparator())},setValue:docMethodOp(function(code){var top=Pos(this.first,0),last=this.first+this.size-1;makeChange(this,{from:top,to:Pos(last,getLine(this,last).text.length),text:this.splitLines(code),origin:"setValue",full:true},true);if(this.cm){scrollToCoords(this.cm,0,0);}
setSelection(this,simpleSelection(top),sel_dontScroll);}),replaceRange:function(code,from,to,origin){from=clipPos(this,from);to=to?clipPos(this,to):from;replaceRange(this,code,from,to,origin);},getRange:function(from,to,lineSep){var lines=getBetween(this,clipPos(this,from),clipPos(this,to));if(lineSep===false){return lines}
if(lineSep===''){return lines.join('')}
return lines.join(lineSep||this.lineSeparator())},getLine:function(line){var l=this.getLineHandle(line);return l&&l.text},getLineHandle:function(line){if(isLine(this,line)){return getLine(this,line)}},getLineNumber:function(line){return lineNo(line)},getLineHandleVisualStart:function(line){if(typeof line=="number"){line=getLine(this,line);}
return visualLine(line)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(pos){return clipPos(this,pos)},getCursor:function(start){var range=this.sel.primary(),pos;if(start==null||start=="head"){pos=range.head;}
else if(start=="anchor"){pos=range.anchor;}
else if(start=="end"||start=="to"||start===false){pos=range.to();}
else{pos=range.from();}
return pos},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:docMethodOp(function(line,ch,options){setSimpleSelection(this,clipPos(this,typeof line=="number"?Pos(line,ch||0):line),null,options);}),setSelection:docMethodOp(function(anchor,head,options){setSimpleSelection(this,clipPos(this,anchor),clipPos(this,head||anchor),options);}),extendSelection:docMethodOp(function(head,other,options){extendSelection(this,clipPos(this,head),other&&clipPos(this,other),options);}),extendSelections:docMethodOp(function(heads,options){extendSelections(this,clipPosArray(this,heads),options);}),extendSelectionsBy:docMethodOp(function(f,options){var heads=map(this.sel.ranges,f);extendSelections(this,clipPosArray(this,heads),options);}),setSelections:docMethodOp(function(ranges,primary,options){if(!ranges.length){return}
var out=[];for(var i=0;i<ranges.length;i++)
{out[i]=new Range(clipPos(this,ranges[i].anchor),clipPos(this,ranges[i].head||ranges[i].anchor));}
if(primary==null){primary=Math.min(ranges.length-1,this.sel.primIndex);}
setSelection(this,normalizeSelection(this.cm,out,primary),options);}),addSelection:docMethodOp(function(anchor,head,options){var ranges=this.sel.ranges.slice(0);ranges.push(new Range(clipPos(this,anchor),clipPos(this,head||anchor)));setSelection(this,normalizeSelection(this.cm,ranges,ranges.length-1),options);}),getSelection:function(lineSep){var ranges=this.sel.ranges,lines;for(var i=0;i<ranges.length;i++){var sel=getBetween(this,ranges[i].from(),ranges[i].to());lines=lines?lines.concat(sel):sel;}
if(lineSep===false){return lines}
else{return lines.join(lineSep||this.lineSeparator())}},getSelections:function(lineSep){var parts=[],ranges=this.sel.ranges;for(var i=0;i<ranges.length;i++){var sel=getBetween(this,ranges[i].from(),ranges[i].to());if(lineSep!==false){sel=sel.join(lineSep||this.lineSeparator());}
parts[i]=sel;}
return parts},replaceSelection:function(code,collapse,origin){var dup=[];for(var i=0;i<this.sel.ranges.length;i++)
{dup[i]=code;}
this.replaceSelections(dup,collapse,origin||"+input");},replaceSelections:docMethodOp(function(code,collapse,origin){var changes=[],sel=this.sel;for(var i=0;i<sel.ranges.length;i++){var range=sel.ranges[i];changes[i]={from:range.from(),to:range.to(),text:this.splitLines(code[i]),origin:origin};}
var newSel=collapse&&collapse!="end"&&computeReplacedSel(this,changes,collapse);for(var i$1=changes.length-1;i$1>=0;i$1--)
{makeChange(this,changes[i$1]);}
if(newSel){setSelectionReplaceHistory(this,newSel);}
else if(this.cm){ensureCursorVisible(this.cm);}}),undo:docMethodOp(function(){makeChangeFromHistory(this,"undo");}),redo:docMethodOp(function(){makeChangeFromHistory(this,"redo");}),undoSelection:docMethodOp(function(){makeChangeFromHistory(this,"undo",true);}),redoSelection:docMethodOp(function(){makeChangeFromHistory(this,"redo",true);}),setExtending:function(val){this.extend=val;},getExtending:function(){return this.extend},historySize:function(){var hist=this.history,done=0,undone=0;for(var i=0;i<hist.done.length;i++){if(!hist.done[i].ranges){++done;}}
for(var i$1=0;i$1<hist.undone.length;i$1++){if(!hist.undone[i$1].ranges){++undone;}}
return{undo:done,redo:undone}},clearHistory:function(){var this$1=this;this.history=new History(this.history);linkedDocs(this,function(doc){return doc.history=this$1.history;},true);},markClean:function(){this.cleanGeneration=this.changeGeneration(true);},changeGeneration:function(forceSplit){if(forceSplit)
{this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null;}
return this.history.generation},isClean:function(gen){return this.history.generation==(gen||this.cleanGeneration)},getHistory:function(){return{done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)}},setHistory:function(histData){var hist=this.history=new History(this.history);hist.done=copyHistoryArray(histData.done.slice(0),null,true);hist.undone=copyHistoryArray(histData.undone.slice(0),null,true);},setGutterMarker:docMethodOp(function(line,gutterID,value){return changeLine(this,line,"gutter",function(line){var markers=line.gutterMarkers||(line.gutterMarkers={});markers[gutterID]=value;if(!value&&isEmpty(markers)){line.gutterMarkers=null;}
return true})}),clearGutter:docMethodOp(function(gutterID){var this$1=this;this.iter(function(line){if(line.gutterMarkers&&line.gutterMarkers[gutterID]){changeLine(this$1,line,"gutter",function(){line.gutterMarkers[gutterID]=null;if(isEmpty(line.gutterMarkers)){line.gutterMarkers=null;}
return true});}});}),lineInfo:function(line){var n;if(typeof line=="number"){if(!isLine(this,line)){return null}
n=line;line=getLine(this,line);if(!line){return null}}else{n=lineNo(line);if(n==null){return null}}
return{line:n,handle:line,text:line.text,gutterMarkers:line.gutterMarkers,textClass:line.textClass,bgClass:line.bgClass,wrapClass:line.wrapClass,widgets:line.widgets}},addLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,where=="gutter"?"gutter":"class",function(line){var prop=where=="text"?"textClass":where=="background"?"bgClass":where=="gutter"?"gutterClass":"wrapClass";if(!line[prop]){line[prop]=cls;}
else if(classTest(cls).test(line[prop])){return false}
else{line[prop]+=" "+cls;}
return true})}),removeLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,where=="gutter"?"gutter":"class",function(line){var prop=where=="text"?"textClass":where=="background"?"bgClass":where=="gutter"?"gutterClass":"wrapClass";var cur=line[prop];if(!cur){return false}
else if(cls==null){line[prop]=null;}
else{var found=cur.match(classTest(cls));if(!found){return false}
var end=found.index+found[0].length;line[prop]=cur.slice(0,found.index)+(!found.index||end==cur.length?"":" ")+cur.slice(end)||null;}
return true})}),addLineWidget:docMethodOp(function(handle,node,options){return addLineWidget(this,handle,node,options)}),removeLineWidget:function(widget){widget.clear();},markText:function(from,to,options){return markText(this,clipPos(this,from),clipPos(this,to),options,options&&options.type||"range")},setBookmark:function(pos,options){var realOpts={replacedWith:options&&(options.nodeType==null?options.widget:options),insertLeft:options&&options.insertLeft,clearWhenEmpty:false,shared:options&&options.shared,handleMouseEvents:options&&options.handleMouseEvents};pos=clipPos(this,pos);return markText(this,pos,pos,realOpts,"bookmark")},findMarksAt:function(pos){pos=clipPos(this,pos);var markers=[],spans=getLine(this,pos.line).markedSpans;if(spans){for(var i=0;i<spans.length;++i){var span=spans[i];if((span.from==null||span.from<=pos.ch)&&(span.to==null||span.to>=pos.ch))
{markers.push(span.marker.parent||span.marker);}}}
return markers},findMarks:function(from,to,filter){from=clipPos(this,from);to=clipPos(this,to);var found=[],lineNo=from.line;this.iter(from.line,to.line+1,function(line){var spans=line.markedSpans;if(spans){for(var i=0;i<spans.length;i++){var span=spans[i];if(!(span.to!=null&&lineNo==from.line&&from.ch>=span.to||span.from==null&&lineNo!=from.line||span.from!=null&&lineNo==to.line&&span.from>=to.ch)&&(!filter||filter(span.marker)))
{found.push(span.marker.parent||span.marker);}}}
++lineNo;});return found},getAllMarks:function(){var markers=[];this.iter(function(line){var sps=line.markedSpans;if(sps){for(var i=0;i<sps.length;++i)
{if(sps[i].from!=null){markers.push(sps[i].marker);}}}});return markers},posFromIndex:function(off){var ch,lineNo=this.first,sepSize=this.lineSeparator().length;this.iter(function(line){var sz=line.text.length+sepSize;if(sz>off){ch=off;return true}
off-=sz;++lineNo;});return clipPos(this,Pos(lineNo,ch))},indexFromPos:function(coords){coords=clipPos(this,coords);var index=coords.ch;if(coords.line<this.first||coords.ch<0){return 0}
var sepSize=this.lineSeparator().length;this.iter(this.first,coords.line,function(line){index+=line.text.length+sepSize;});return index},copy:function(copyHistory){var doc=new Doc(getLines(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);doc.scrollTop=this.scrollTop;doc.scrollLeft=this.scrollLeft;doc.sel=this.sel;doc.extend=false;if(copyHistory){doc.history.undoDepth=this.history.undoDepth;doc.setHistory(this.getHistory());}
return doc},linkedDoc:function(options){if(!options){options={};}
var from=this.first,to=this.first+this.size;if(options.from!=null&&options.from>from){from=options.from;}
if(options.to!=null&&options.to<to){to=options.to;}
var copy=new Doc(getLines(this,from,to),options.mode||this.modeOption,from,this.lineSep,this.direction);if(options.sharedHist){copy.history=this.history;}(this.linked||(this.linked=[])).push({doc:copy,sharedHist:options.sharedHist});copy.linked=[{doc:this,isParent:true,sharedHist:options.sharedHist}];copySharedMarkers(copy,findSharedMarkers(this));return copy},unlinkDoc:function(other){if(other instanceof CodeMirror){other=other.doc;}
if(this.linked){for(var i=0;i<this.linked.length;++i){var link=this.linked[i];if(link.doc!=other){continue}
this.linked.splice(i,1);other.unlinkDoc(this);detachSharedMarkers(findSharedMarkers(this));break}}
if(other.history==this.history){var splitIds=[other.id];linkedDocs(other,function(doc){return splitIds.push(doc.id);},true);other.history=new History(null);other.history.done=copyHistoryArray(this.history.done,splitIds);other.history.undone=copyHistoryArray(this.history.undone,splitIds);}},iterLinkedDocs:function(f){linkedDocs(this,f);},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(str){if(this.lineSep){return str.split(this.lineSep)}
return splitLinesAuto(str)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:docMethodOp(function(dir){if(dir!="rtl"){dir="ltr";}
if(dir==this.direction){return}
this.direction=dir;this.iter(function(line){return line.order=null;});if(this.cm){directionChanged(this.cm);}})});Doc.prototype.eachLine=Doc.prototype.iter;var lastDrop=0;function onDrop(e){var cm=this;clearDragCursor(cm);if(signalDOMEvent(cm,e)||eventInWidget(cm.display,e))
{return}
e_preventDefault(e);if(ie){lastDrop=+new Date;}
var pos=posFromMouse(cm,e,true),files=e.dataTransfer.files;if(!pos||cm.isReadOnly()){return}
if(files&&files.length&&window.FileReader&&window.File){var n=files.length,text=Array(n),read=0;var markAsReadAndPasteIfAllFilesAreRead=function(){if(++read==n){operation(cm,function(){pos=clipPos(cm.doc,pos);var change={from:pos,to:pos,text:cm.doc.splitLines(text.filter(function(t){return t!=null;}).join(cm.doc.lineSeparator())),origin:"paste"};makeChange(cm.doc,change);setSelectionReplaceHistory(cm.doc,simpleSelection(clipPos(cm.doc,pos),clipPos(cm.doc,changeEnd(change))));})();}};var readTextFromFile=function(file,i){if(cm.options.allowDropFileTypes&&indexOf(cm.options.allowDropFileTypes,file.type)==-1){markAsReadAndPasteIfAllFilesAreRead();return}
var reader=new FileReader;reader.onerror=function(){return markAsReadAndPasteIfAllFilesAreRead();};reader.onload=function(){var content=reader.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(content)){markAsReadAndPasteIfAllFilesAreRead();return}
text[i]=content;markAsReadAndPasteIfAllFilesAreRead();};reader.readAsText(file);};for(var i=0;i<files.length;i++){readTextFromFile(files[i],i);}}else{if(cm.state.draggingText&&cm.doc.sel.contains(pos)>-1){cm.state.draggingText(e);setTimeout(function(){return cm.display.input.focus();},20);return}
try{var text$1=e.dataTransfer.getData("Text");if(text$1){var selected;if(cm.state.draggingText&&!cm.state.draggingText.copy)
{selected=cm.listSelections();}
setSelectionNoUndo(cm.doc,simpleSelection(pos,pos));if(selected){for(var i$1=0;i$1<selected.length;++i$1)
{replaceRange(cm.doc,"",selected[i$1].anchor,selected[i$1].head,"drag");}}
cm.replaceSelection(text$1,"around","paste");cm.display.input.focus();}}
catch(e$1){}}}
function onDragStart(cm,e){if(ie&&(!cm.state.draggingText||+new Date-lastDrop<100)){e_stop(e);return}
if(signalDOMEvent(cm,e)||eventInWidget(cm.display,e)){return}
e.dataTransfer.setData("Text",cm.getSelection());e.dataTransfer.effectAllowed="copyMove";if(e.dataTransfer.setDragImage&&!safari){var img=elt("img",null,null,"position: fixed; left: 0; top: 0;");img.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";if(presto){img.width=img.height=1;cm.display.wrapper.appendChild(img);img._top=img.offsetTop;}
e.dataTransfer.setDragImage(img,0,0);if(presto){img.parentNode.removeChild(img);}}}
function onDragOver(cm,e){var pos=posFromMouse(cm,e);if(!pos){return}
var frag=document.createDocumentFragment();drawSelectionCursor(cm,pos,frag);if(!cm.display.dragCursor){cm.display.dragCursor=elt("div",null,"CodeMirror-cursors CodeMirror-dragcursors");cm.display.lineSpace.insertBefore(cm.display.dragCursor,cm.display.cursorDiv);}
removeChildrenAndAdd(cm.display.dragCursor,frag);}
function clearDragCursor(cm){if(cm.display.dragCursor){cm.display.lineSpace.removeChild(cm.display.dragCursor);cm.display.dragCursor=null;}}
function forEachCodeMirror(f){if(!document.getElementsByClassName){return}
var byClass=document.getElementsByClassName("CodeMirror"),editors=[];for(var i=0;i<byClass.length;i++){var cm=byClass[i].CodeMirror;if(cm){editors.push(cm);}}
if(editors.length){editors[0].operation(function(){for(var i=0;i<editors.length;i++){f(editors[i]);}});}}
var globalsRegistered=false;function ensureGlobalHandlers(){if(globalsRegistered){return}
registerGlobalHandlers();globalsRegistered=true;}
function registerGlobalHandlers(){var resizeTimer;on(window,"resize",function(){if(resizeTimer==null){resizeTimer=setTimeout(function(){resizeTimer=null;forEachCodeMirror(onResize);},100);}});on(window,"blur",function(){return forEachCodeMirror(onBlur);});}
function onResize(cm){var d=cm.display;d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null;d.scrollbarsClipped=false;cm.setSize();}
var keyNames={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};for(var i=0;i<10;i++){keyNames[i+48]=keyNames[i+96]=String(i);}
for(var i$1=65;i$1<=90;i$1++){keyNames[i$1]=String.fromCharCode(i$1);}
for(var i$2=1;i$2<=12;i$2++){keyNames[i$2+111]=keyNames[i$2+63235]="F"+i$2;}
var keyMap={};keyMap.basic={"Left":"goCharLeft","Right":"goCharRight","Up":"goLineUp","Down":"goLineDown","End":"goLineEnd","Home":"goLineStartSmart","PageUp":"goPageUp","PageDown":"goPageDown","Delete":"delCharAfter","Backspace":"delCharBefore","Shift-Backspace":"delCharBefore","Tab":"defaultTab","Shift-Tab":"indentAuto","Enter":"newlineAndIndent","Insert":"toggleOverwrite","Esc":"singleSelection"};keyMap.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection","fallthrough":"basic"};keyMap.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"};keyMap.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd","fallthrough":["basic","emacsy"]};keyMap["default"]=mac?keyMap.macDefault:keyMap.pcDefault;function normalizeKeyName(name){var parts=name.split(/-(?!$)/);name=parts[parts.length-1];var alt,ctrl,shift,cmd;for(var i=0;i<parts.length-1;i++){var mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod)){cmd=true;}
else if(/^a(lt)?$/i.test(mod)){alt=true;}
else if(/^(c|ctrl|control)$/i.test(mod)){ctrl=true;}
else if(/^s(hift)?$/i.test(mod)){shift=true;}
else{throw new Error("Unrecognized modifier name: "+mod)}}
if(alt){name="Alt-"+name;}
if(ctrl){name="Ctrl-"+name;}
if(cmd){name="Cmd-"+name;}
if(shift){name="Shift-"+name;}
return name}
function normalizeKeyMap(keymap){var copy={};for(var keyname in keymap){if(keymap.hasOwnProperty(keyname)){var value=keymap[keyname];if(/^(name|fallthrough|(de|at)tach)$/.test(keyname)){continue}
if(value=="..."){delete keymap[keyname];continue}
var keys=map(keyname.split(" "),normalizeKeyName);for(var i=0;i<keys.length;i++){var val=(void 0),name=(void 0);if(i==keys.length-1){name=keys.join(" ");val=value;}else{name=keys.slice(0,i+1).join(" ");val="...";}
var prev=copy[name];if(!prev){copy[name]=val;}
else if(prev!=val){throw new Error("Inconsistent bindings for "+name)}}
delete keymap[keyname];}}
for(var prop in copy){keymap[prop]=copy[prop];}
return keymap}
function lookupKey(key,map,handle,context){map=getKeyMap(map);var found=map.call?map.call(key,context):map[key];if(found===false){return"nothing"}
if(found==="..."){return"multi"}
if(found!=null&&handle(found)){return"handled"}
if(map.fallthrough){if(Object.prototype.toString.call(map.fallthrough)!="[object Array]")
{return lookupKey(key,map.fallthrough,handle,context)}
for(var i=0;i<map.fallthrough.length;i++){var result=lookupKey(key,map.fallthrough[i],handle,context);if(result){return result}}}}
function isModifierKey(value){var name=typeof value=="string"?value:keyNames[value.keyCode];return name=="Ctrl"||name=="Alt"||name=="Shift"||name=="Mod"}
function addModifierNames(name,event,noShift){var base=name;if(event.altKey&&base!="Alt"){name="Alt-"+name;}
if((flipCtrlCmd?event.metaKey:event.ctrlKey)&&base!="Ctrl"){name="Ctrl-"+name;}
if((flipCtrlCmd?event.ctrlKey:event.metaKey)&&base!="Mod"){name="Cmd-"+name;}
if(!noShift&&event.shiftKey&&base!="Shift"){name="Shift-"+name;}
return name}
function keyName(event,noShift){if(presto&&event.keyCode==34&&event["char"]){return false}
var name=keyNames[event.keyCode];if(name==null||event.altGraphKey){return false}
if(event.keyCode==3&&event.code){name=event.code;}
return addModifierNames(name,event,noShift)}
function getKeyMap(val){return typeof val=="string"?keyMap[val]:val}
function deleteNearSelection(cm,compute){var ranges=cm.doc.sel.ranges,kill=[];for(var i=0;i<ranges.length;i++){var toKill=compute(ranges[i]);while(kill.length&&cmp(toKill.from,lst(kill).to)<=0){var replaced=kill.pop();if(cmp(replaced.from,toKill.from)<0){toKill.from=replaced.from;break}}
kill.push(toKill);}
runInOp(cm,function(){for(var i=kill.length-1;i>=0;i--)
{replaceRange(cm.doc,"",kill[i].from,kill[i].to,"+delete");}
ensureCursorVisible(cm);});}
function moveCharLogically(line,ch,dir){var target=skipExtendingChars(line.text,ch+dir,dir);return target<0||target>line.text.length?null:target}
function moveLogically(line,start,dir){var ch=moveCharLogically(line,start.ch,dir);return ch==null?null:new Pos(start.line,ch,dir<0?"after":"before")}
function endOfLine(visually,cm,lineObj,lineNo,dir){if(visually){if(cm.doc.direction=="rtl"){dir=-dir;}
var order=getOrder(lineObj,cm.doc.direction);if(order){var part=dir<0?lst(order):order[0];var moveInStorageOrder=(dir<0)==(part.level==1);var sticky=moveInStorageOrder?"after":"before";var ch;if(part.level>0||cm.doc.direction=="rtl"){var prep=prepareMeasureForLine(cm,lineObj);ch=dir<0?lineObj.text.length-1:0;var targetTop=measureCharPrepared(cm,prep,ch).top;ch=findFirst(function(ch){return measureCharPrepared(cm,prep,ch).top==targetTop;},(dir<0)==(part.level==1)?part.from:part.to-1,ch);if(sticky=="before"){ch=moveCharLogically(lineObj,ch,1);}}else{ch=dir<0?part.to:part.from;}
return new Pos(lineNo,ch,sticky)}}
return new Pos(lineNo,dir<0?lineObj.text.length:0,dir<0?"before":"after")}
function moveVisually(cm,line,start,dir){var bidi=getOrder(line,cm.doc.direction);if(!bidi){return moveLogically(line,start,dir)}
if(start.ch>=line.text.length){start.ch=line.text.length;start.sticky="before";}else if(start.ch<=0){start.ch=0;start.sticky="after";}
var partPos=getBidiPartAt(bidi,start.ch,start.sticky),part=bidi[partPos];if(cm.doc.direction=="ltr"&&part.level%2==0&&(dir>0?part.to>start.ch:part.from<start.ch)){return moveLogically(line,start,dir)}
var mv=function(pos,dir){return moveCharLogically(line,pos instanceof Pos?pos.ch:pos,dir);};var prep;var getWrappedLineExtent=function(ch){if(!cm.options.lineWrapping){return{begin:0,end:line.text.length}}
prep=prep||prepareMeasureForLine(cm,line);return wrappedLineExtentChar(cm,line,prep,ch)};var wrappedLineExtent=getWrappedLineExtent(start.sticky=="before"?mv(start,-1):start.ch);if(cm.doc.direction=="rtl"||part.level==1){var moveInStorageOrder=(part.level==1)==(dir<0);var ch=mv(start,moveInStorageOrder?1:-1);if(ch!=null&&(!moveInStorageOrder?ch>=part.from&&ch>=wrappedLineExtent.begin:ch<=part.to&&ch<=wrappedLineExtent.end)){var sticky=moveInStorageOrder?"before":"after";return new Pos(start.line,ch,sticky)}}
var searchInVisualLine=function(partPos,dir,wrappedLineExtent){var getRes=function(ch,moveInStorageOrder){return moveInStorageOrder?new Pos(start.line,mv(ch,1),"before"):new Pos(start.line,ch,"after");};for(;partPos>=0&&partPos<bidi.length;partPos+=dir){var part=bidi[partPos];var moveInStorageOrder=(dir>0)==(part.level!=1);var ch=moveInStorageOrder?wrappedLineExtent.begin:mv(wrappedLineExtent.end,-1);if(part.from<=ch&&ch<part.to){return getRes(ch,moveInStorageOrder)}
ch=moveInStorageOrder?part.from:mv(part.to,-1);if(wrappedLineExtent.begin<=ch&&ch<wrappedLineExtent.end){return getRes(ch,moveInStorageOrder)}}};var res=searchInVisualLine(partPos+dir,dir,wrappedLineExtent);if(res){return res}
var nextCh=dir>0?wrappedLineExtent.end:mv(wrappedLineExtent.begin,-1);if(nextCh!=null&&!(dir>0&&nextCh==line.text.length)){res=searchInVisualLine(dir>0?0:bidi.length-1,dir,getWrappedLineExtent(nextCh));if(res){return res}}
return null}
var commands={selectAll:selectAll,singleSelection:function(cm){return cm.setSelection(cm.getCursor("anchor"),cm.getCursor("head"),sel_dontScroll);},killLine:function(cm){return deleteNearSelection(cm,function(range){if(range.empty()){var len=getLine(cm.doc,range.head.line).text.length;if(range.head.ch==len&&range.head.line<cm.lastLine())
{return{from:range.head,to:Pos(range.head.line+1,0)}}
else
{return{from:range.head,to:Pos(range.head.line,len)}}}else{return{from:range.from(),to:range.to()}}});},deleteLine:function(cm){return deleteNearSelection(cm,function(range){return({from:Pos(range.from().line,0),to:clipPos(cm.doc,Pos(range.to().line+1,0))});});},delLineLeft:function(cm){return deleteNearSelection(cm,function(range){return({from:Pos(range.from().line,0),to:range.from()});});},delWrappedLineLeft:function(cm){return deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5;var leftPos=cm.coordsChar({left:0,top:top},"div");return{from:leftPos,to:range.from()}});},delWrappedLineRight:function(cm){return deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5;var rightPos=cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div");return{from:range.from(),to:rightPos}});},undo:function(cm){return cm.undo();},redo:function(cm){return cm.redo();},undoSelection:function(cm){return cm.undoSelection();},redoSelection:function(cm){return cm.redoSelection();},goDocStart:function(cm){return cm.extendSelection(Pos(cm.firstLine(),0));},goDocEnd:function(cm){return cm.extendSelection(Pos(cm.lastLine()));},goLineStart:function(cm){return cm.extendSelectionsBy(function(range){return lineStart(cm,range.head.line);},{origin:"+move",bias:1});},goLineStartSmart:function(cm){return cm.extendSelectionsBy(function(range){return lineStartSmart(cm,range.head);},{origin:"+move",bias:1});},goLineEnd:function(cm){return cm.extendSelectionsBy(function(range){return lineEnd(cm,range.head.line);},{origin:"+move",bias:-1});},goLineRight:function(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5;return cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div")},sel_move);},goLineLeft:function(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5;return cm.coordsChar({left:0,top:top},"div")},sel_move);},goLineLeftSmart:function(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5;var pos=cm.coordsChar({left:0,top:top},"div");if(pos.ch<cm.getLine(pos.line).search(/\S/)){return lineStartSmart(cm,range.head)}
return pos},sel_move);},goLineUp:function(cm){return cm.moveV(-1,"line");},goLineDown:function(cm){return cm.moveV(1,"line");},goPageUp:function(cm){return cm.moveV(-1,"page");},goPageDown:function(cm){return cm.moveV(1,"page");},goCharLeft:function(cm){return cm.moveH(-1,"char");},goCharRight:function(cm){return cm.moveH(1,"char");},goColumnLeft:function(cm){return cm.moveH(-1,"column");},goColumnRight:function(cm){return cm.moveH(1,"column");},goWordLeft:function(cm){return cm.moveH(-1,"word");},goGroupRight:function(cm){return cm.moveH(1,"group");},goGroupLeft:function(cm){return cm.moveH(-1,"group");},goWordRight:function(cm){return cm.moveH(1,"word");},delCharBefore:function(cm){return cm.deleteH(-1,"codepoint");},delCharAfter:function(cm){return cm.deleteH(1,"char");},delWordBefore:function(cm){return cm.deleteH(-1,"word");},delWordAfter:function(cm){return cm.deleteH(1,"word");},delGroupBefore:function(cm){return cm.deleteH(-1,"group");},delGroupAfter:function(cm){return cm.deleteH(1,"group");},indentAuto:function(cm){return cm.indentSelection("smart");},indentMore:function(cm){return cm.indentSelection("add");},indentLess:function(cm){return cm.indentSelection("subtract");},insertTab:function(cm){return cm.replaceSelection("\t");},insertSoftTab:function(cm){var spaces=[],ranges=cm.listSelections(),tabSize=cm.options.tabSize;for(var i=0;i<ranges.length;i++){var pos=ranges[i].from();var col=countColumn(cm.getLine(pos.line),pos.ch,tabSize);spaces.push(spaceStr(tabSize-col%tabSize));}
cm.replaceSelections(spaces);},defaultTab:function(cm){if(cm.somethingSelected()){cm.indentSelection("add");}
else{cm.execCommand("insertTab");}},transposeChars:function(cm){return runInOp(cm,function(){var ranges=cm.listSelections(),newSel=[];for(var i=0;i<ranges.length;i++){if(!ranges[i].empty()){continue}
var cur=ranges[i].head,line=getLine(cm.doc,cur.line).text;if(line){if(cur.ch==line.length){cur=new Pos(cur.line,cur.ch-1);}
if(cur.ch>0){cur=new Pos(cur.line,cur.ch+1);cm.replaceRange(line.charAt(cur.ch-1)+line.charAt(cur.ch-2),Pos(cur.line,cur.ch-2),cur,"+transpose");}else if(cur.line>cm.doc.first){var prev=getLine(cm.doc,cur.line-1).text;if(prev){cur=new Pos(cur.line,1);cm.replaceRange(line.charAt(0)+cm.doc.lineSeparator()+
prev.charAt(prev.length-1),Pos(cur.line-1,prev.length-1),cur,"+transpose");}}}
newSel.push(new Range(cur,cur));}
cm.setSelections(newSel);});},newlineAndIndent:function(cm){return runInOp(cm,function(){var sels=cm.listSelections();for(var i=sels.length-1;i>=0;i--)
{cm.replaceRange(cm.doc.lineSeparator(),sels[i].anchor,sels[i].head,"+input");}
sels=cm.listSelections();for(var i$1=0;i$1<sels.length;i$1++)
{cm.indentLine(sels[i$1].from().line,null,true);}
ensureCursorVisible(cm);});},openLine:function(cm){return cm.replaceSelection("\n","start");},toggleOverwrite:function(cm){return cm.toggleOverwrite();}};function lineStart(cm,lineN){var line=getLine(cm.doc,lineN);var visual=visualLine(line);if(visual!=line){lineN=lineNo(visual);}
return endOfLine(true,cm,visual,lineN,1)}
function lineEnd(cm,lineN){var line=getLine(cm.doc,lineN);var visual=visualLineEnd(line);if(visual!=line){lineN=lineNo(visual);}
return endOfLine(true,cm,line,lineN,-1)}
function lineStartSmart(cm,pos){var start=lineStart(cm,pos.line);var line=getLine(cm.doc,start.line);var order=getOrder(line,cm.doc.direction);if(!order||order[0].level==0){var firstNonWS=Math.max(start.ch,line.text.search(/\S/));var inWS=pos.line==start.line&&pos.ch<=firstNonWS&&pos.ch;return Pos(start.line,inWS?0:firstNonWS,start.sticky)}
return start}
function doHandleBinding(cm,bound,dropShift){if(typeof bound=="string"){bound=commands[bound];if(!bound){return false}}
cm.display.input.ensurePolled();var prevShift=cm.display.shift,done=false;try{if(cm.isReadOnly()){cm.state.suppressEdits=true;}
if(dropShift){cm.display.shift=false;}
done=bound(cm)!=Pass;}finally{cm.display.shift=prevShift;cm.state.suppressEdits=false;}
return done}
function lookupKeyForEditor(cm,name,handle){for(var i=0;i<cm.state.keyMaps.length;i++){var result=lookupKey(name,cm.state.keyMaps[i],handle,cm);if(result){return result}}
return(cm.options.extraKeys&&lookupKey(name,cm.options.extraKeys,handle,cm))||lookupKey(name,cm.options.keyMap,handle,cm)}
var stopSeq=new Delayed;function dispatchKey(cm,name,e,handle){var seq=cm.state.keySeq;if(seq){if(isModifierKey(name)){return"handled"}
if(/\'$/.test(name))
{cm.state.keySeq=null;}
else
{stopSeq.set(50,function(){if(cm.state.keySeq==seq){cm.state.keySeq=null;cm.display.input.reset();}});}
if(dispatchKeyInner(cm,seq+" "+name,e,handle)){return true}}
return dispatchKeyInner(cm,name,e,handle)}
function dispatchKeyInner(cm,name,e,handle){var result=lookupKeyForEditor(cm,name,handle);if(result=="multi")
{cm.state.keySeq=name;}
if(result=="handled")
{signalLater(cm,"keyHandled",cm,name,e);}
if(result=="handled"||result=="multi"){e_preventDefault(e);restartBlink(cm);}
return!!result}
function handleKeyBinding(cm,e){var name=keyName(e,true);if(!name){return false}
if(e.shiftKey&&!cm.state.keySeq){return dispatchKey(cm,"Shift-"+name,e,function(b){return doHandleBinding(cm,b,true);})||dispatchKey(cm,name,e,function(b){if(typeof b=="string"?/^go[A-Z]/.test(b):b.motion)
{return doHandleBinding(cm,b)}})}else{return dispatchKey(cm,name,e,function(b){return doHandleBinding(cm,b);})}}
function handleCharBinding(cm,e,ch){return dispatchKey(cm,"'"+ch+"'",e,function(b){return doHandleBinding(cm,b,true);})}
var lastStoppedKey=null;function onKeyDown(e){var cm=this;if(e.target&&e.target!=cm.display.input.getField()){return}
cm.curOp.focus=activeElt(doc(cm));if(signalDOMEvent(cm,e)){return}
if(ie&&ie_version<11&&e.keyCode==27){e.returnValue=false;}
var code=e.keyCode;cm.display.shift=code==16||e.shiftKey;var handled=handleKeyBinding(cm,e);if(presto){lastStoppedKey=handled?code:null;if(!handled&&code==88&&!hasCopyEvent&&(mac?e.metaKey:e.ctrlKey))
{cm.replaceSelection("",null,"cut");}}
if(gecko&&!mac&&!handled&&code==46&&e.shiftKey&&!e.ctrlKey&&document.execCommand)
{document.execCommand("cut");}
if(code==18&&!/\bCodeMirror-crosshair\b/.test(cm.display.lineDiv.className))
{showCrossHair(cm);}}
function showCrossHair(cm){var lineDiv=cm.display.lineDiv;addClass(lineDiv,"CodeMirror-crosshair");function up(e){if(e.keyCode==18||!e.altKey){rmClass(lineDiv,"CodeMirror-crosshair");off(document,"keyup",up);off(document,"mouseover",up);}}
on(document,"keyup",up);on(document,"mouseover",up);}
function onKeyUp(e){if(e.keyCode==16){this.doc.sel.shift=false;}
signalDOMEvent(this,e);}
function onKeyPress(e){var cm=this;if(e.target&&e.target!=cm.display.input.getField()){return}
if(eventInWidget(cm.display,e)||signalDOMEvent(cm,e)||e.ctrlKey&&!e.altKey||mac&&e.metaKey){return}
var keyCode=e.keyCode,charCode=e.charCode;if(presto&&keyCode==lastStoppedKey){lastStoppedKey=null;e_preventDefault(e);return}
if((presto&&(!e.which||e.which<10))&&handleKeyBinding(cm,e)){return}
var ch=String.fromCharCode(charCode==null?keyCode:charCode);if(ch=="\x08"){return}
if(handleCharBinding(cm,e,ch)){return}
cm.display.input.onKeyPress(e);}
var DOUBLECLICK_DELAY=400;var PastClick=function(time,pos,button){this.time=time;this.pos=pos;this.button=button;};PastClick.prototype.compare=function(time,pos,button){return this.time+DOUBLECLICK_DELAY>time&&cmp(pos,this.pos)==0&&button==this.button};var lastClick,lastDoubleClick;function clickRepeat(pos,button){var now=+new Date;if(lastDoubleClick&&lastDoubleClick.compare(now,pos,button)){lastClick=lastDoubleClick=null;return"triple"}else if(lastClick&&lastClick.compare(now,pos,button)){lastDoubleClick=new PastClick(now,pos,button);lastClick=null;return"double"}else{lastClick=new PastClick(now,pos,button);lastDoubleClick=null;return"single"}}
function onMouseDown(e){var cm=this,display=cm.display;if(signalDOMEvent(cm,e)||display.activeTouch&&display.input.supportsTouch()){return}
display.input.ensurePolled();display.shift=e.shiftKey;if(eventInWidget(display,e)){if(!webkit){display.scroller.draggable=false;setTimeout(function(){return display.scroller.draggable=true;},100);}
return}
if(clickInGutter(cm,e)){return}
var pos=posFromMouse(cm,e),button=e_button(e),repeat=pos?clickRepeat(pos,button):"single";win(cm).focus();if(button==1&&cm.state.selectingText)
{cm.state.selectingText(e);}
if(pos&&handleMappedButton(cm,button,pos,repeat,e)){return}
if(button==1){if(pos){leftButtonDown(cm,pos,repeat,e);}
else if(e_target(e)==display.scroller){e_preventDefault(e);}}else if(button==2){if(pos){extendSelection(cm.doc,pos);}
setTimeout(function(){return display.input.focus();},20);}else if(button==3){if(captureRightClick){cm.display.input.onContextMenu(e);}
else{delayBlurEvent(cm);}}}
function handleMappedButton(cm,button,pos,repeat,event){var name="Click";if(repeat=="double"){name="Double"+name;}
else if(repeat=="triple"){name="Triple"+name;}
name=(button==1?"Left":button==2?"Middle":"Right")+name;return dispatchKey(cm,addModifierNames(name,event),event,function(bound){if(typeof bound=="string"){bound=commands[bound];}
if(!bound){return false}
var done=false;try{if(cm.isReadOnly()){cm.state.suppressEdits=true;}
done=bound(cm,pos)!=Pass;}finally{cm.state.suppressEdits=false;}
return done})}
function configureMouse(cm,repeat,event){var option=cm.getOption("configureMouse");var value=option?option(cm,repeat,event):{};if(value.unit==null){var rect=chromeOS?event.shiftKey&&event.metaKey:event.altKey;value.unit=rect?"rectangle":repeat=="single"?"char":repeat=="double"?"word":"line";}
if(value.extend==null||cm.doc.extend){value.extend=cm.doc.extend||event.shiftKey;}
if(value.addNew==null){value.addNew=mac?event.metaKey:event.ctrlKey;}
if(value.moveOnDrag==null){value.moveOnDrag=!(mac?event.altKey:event.ctrlKey);}
return value}
function leftButtonDown(cm,pos,repeat,event){if(ie){setTimeout(bind(ensureFocus,cm),0);}
else{cm.curOp.focus=activeElt(doc(cm));}
var behavior=configureMouse(cm,repeat,event);var sel=cm.doc.sel,contained;if(cm.options.dragDrop&&dragAndDrop&&!cm.isReadOnly()&&repeat=="single"&&(contained=sel.contains(pos))>-1&&(cmp((contained=sel.ranges[contained]).from(),pos)<0||pos.xRel>0)&&(cmp(contained.to(),pos)>0||pos.xRel<0))
{leftButtonStartDrag(cm,event,pos,behavior);}
else
{leftButtonSelect(cm,event,pos,behavior);}}
function leftButtonStartDrag(cm,event,pos,behavior){var display=cm.display,moved=false;var dragEnd=operation(cm,function(e){if(webkit){display.scroller.draggable=false;}
cm.state.draggingText=false;if(cm.state.delayingBlurEvent){if(cm.hasFocus()){cm.state.delayingBlurEvent=false;}
else{delayBlurEvent(cm);}}
off(display.wrapper.ownerDocument,"mouseup",dragEnd);off(display.wrapper.ownerDocument,"mousemove",mouseMove);off(display.scroller,"dragstart",dragStart);off(display.scroller,"drop",dragEnd);if(!moved){e_preventDefault(e);if(!behavior.addNew)
{extendSelection(cm.doc,pos,null,null,behavior.extend);}
if((webkit&&!safari)||ie&&ie_version==9)
{setTimeout(function(){display.wrapper.ownerDocument.body.focus({preventScroll:true});display.input.focus();},20);}
else
{display.input.focus();}}});var mouseMove=function(e2){moved=moved||Math.abs(event.clientX-e2.clientX)+Math.abs(event.clientY-e2.clientY)>=10;};var dragStart=function(){return moved=true;};if(webkit){display.scroller.draggable=true;}
cm.state.draggingText=dragEnd;dragEnd.copy=!behavior.moveOnDrag;on(display.wrapper.ownerDocument,"mouseup",dragEnd);on(display.wrapper.ownerDocument,"mousemove",mouseMove);on(display.scroller,"dragstart",dragStart);on(display.scroller,"drop",dragEnd);cm.state.delayingBlurEvent=true;setTimeout(function(){return display.input.focus();},20);if(display.scroller.dragDrop){display.scroller.dragDrop();}}
function rangeForUnit(cm,pos,unit){if(unit=="char"){return new Range(pos,pos)}
if(unit=="word"){return cm.findWordAt(pos)}
if(unit=="line"){return new Range(Pos(pos.line,0),clipPos(cm.doc,Pos(pos.line+1,0)))}
var result=unit(cm,pos);return new Range(result.from,result.to)}
function leftButtonSelect(cm,event,start,behavior){if(ie){delayBlurEvent(cm);}
var display=cm.display,doc$1=cm.doc;e_preventDefault(event);var ourRange,ourIndex,startSel=doc$1.sel,ranges=startSel.ranges;if(behavior.addNew&&!behavior.extend){ourIndex=doc$1.sel.contains(start);if(ourIndex>-1)
{ourRange=ranges[ourIndex];}
else
{ourRange=new Range(start,start);}}else{ourRange=doc$1.sel.primary();ourIndex=doc$1.sel.primIndex;}
if(behavior.unit=="rectangle"){if(!behavior.addNew){ourRange=new Range(start,start);}
start=posFromMouse(cm,event,true,true);ourIndex=-1;}else{var range=rangeForUnit(cm,start,behavior.unit);if(behavior.extend)
{ourRange=extendRange(ourRange,range.anchor,range.head,behavior.extend);}
else
{ourRange=range;}}
if(!behavior.addNew){ourIndex=0;setSelection(doc$1,new Selection([ourRange],0),sel_mouse);startSel=doc$1.sel;}else if(ourIndex==-1){ourIndex=ranges.length;setSelection(doc$1,normalizeSelection(cm,ranges.concat([ourRange]),ourIndex),{scroll:false,origin:"*mouse"});}else if(ranges.length>1&&ranges[ourIndex].empty()&&behavior.unit=="char"&&!behavior.extend){setSelection(doc$1,normalizeSelection(cm,ranges.slice(0,ourIndex).concat(ranges.slice(ourIndex+1)),0),{scroll:false,origin:"*mouse"});startSel=doc$1.sel;}else{replaceOneSelection(doc$1,ourIndex,ourRange,sel_mouse);}
var lastPos=start;function extendTo(pos){if(cmp(lastPos,pos)==0){return}
lastPos=pos;if(behavior.unit=="rectangle"){var ranges=[],tabSize=cm.options.tabSize;var startCol=countColumn(getLine(doc$1,start.line).text,start.ch,tabSize);var posCol=countColumn(getLine(doc$1,pos.line).text,pos.ch,tabSize);var left=Math.min(startCol,posCol),right=Math.max(startCol,posCol);for(var line=Math.min(start.line,pos.line),end=Math.min(cm.lastLine(),Math.max(start.line,pos.line));line<=end;line++){var text=getLine(doc$1,line).text,leftPos=findColumn(text,left,tabSize);if(left==right)
{ranges.push(new Range(Pos(line,leftPos),Pos(line,leftPos)));}
else if(text.length>leftPos)
{ranges.push(new Range(Pos(line,leftPos),Pos(line,findColumn(text,right,tabSize))));}}
if(!ranges.length){ranges.push(new Range(start,start));}
setSelection(doc$1,normalizeSelection(cm,startSel.ranges.slice(0,ourIndex).concat(ranges),ourIndex),{origin:"*mouse",scroll:false});cm.scrollIntoView(pos);}else{var oldRange=ourRange;var range=rangeForUnit(cm,pos,behavior.unit);var anchor=oldRange.anchor,head;if(cmp(range.anchor,anchor)>0){head=range.head;anchor=minPos(oldRange.from(),range.anchor);}else{head=range.anchor;anchor=maxPos(oldRange.to(),range.head);}
var ranges$1=startSel.ranges.slice(0);ranges$1[ourIndex]=bidiSimplify(cm,new Range(clipPos(doc$1,anchor),head));setSelection(doc$1,normalizeSelection(cm,ranges$1,ourIndex),sel_mouse);}}
var editorSize=display.wrapper.getBoundingClientRect();var counter=0;function extend(e){var curCount=++counter;var cur=posFromMouse(cm,e,true,behavior.unit=="rectangle");if(!cur){return}
if(cmp(cur,lastPos)!=0){cm.curOp.focus=activeElt(doc(cm));extendTo(cur);var visible=visibleLines(display,doc$1);if(cur.line>=visible.to||cur.line<visible.from)
{setTimeout(operation(cm,function(){if(counter==curCount){extend(e);}}),150);}}else{var outside=e.clientY<editorSize.top?-20:e.clientY>editorSize.bottom?20:0;if(outside){setTimeout(operation(cm,function(){if(counter!=curCount){return}
display.scroller.scrollTop+=outside;extend(e);}),50);}}}
function done(e){cm.state.selectingText=false;counter=Infinity;if(e){e_preventDefault(e);display.input.focus();}
off(display.wrapper.ownerDocument,"mousemove",move);off(display.wrapper.ownerDocument,"mouseup",up);doc$1.history.lastSelOrigin=null;}
var move=operation(cm,function(e){if(e.buttons===0||!e_button(e)){done(e);}
else{extend(e);}});var up=operation(cm,done);cm.state.selectingText=up;on(display.wrapper.ownerDocument,"mousemove",move);on(display.wrapper.ownerDocument,"mouseup",up);}
function bidiSimplify(cm,range){var anchor=range.anchor;var head=range.head;var anchorLine=getLine(cm.doc,anchor.line);if(cmp(anchor,head)==0&&anchor.sticky==head.sticky){return range}
var order=getOrder(anchorLine);if(!order){return range}
var index=getBidiPartAt(order,anchor.ch,anchor.sticky),part=order[index];if(part.from!=anchor.ch&&part.to!=anchor.ch){return range}
var boundary=index+((part.from==anchor.ch)==(part.level!=1)?0:1);if(boundary==0||boundary==order.length){return range}
var leftSide;if(head.line!=anchor.line){leftSide=(head.line-anchor.line)*(cm.doc.direction=="ltr"?1:-1)>0;}else{var headIndex=getBidiPartAt(order,head.ch,head.sticky);var dir=headIndex-index||(head.ch-anchor.ch)*(part.level==1?-1:1);if(headIndex==boundary-1||headIndex==boundary)
{leftSide=dir<0;}
else
{leftSide=dir>0;}}
var usePart=order[boundary+(leftSide?-1:0)];var from=leftSide==(usePart.level==1);var ch=from?usePart.from:usePart.to,sticky=from?"after":"before";return anchor.ch==ch&&anchor.sticky==sticky?range:new Range(new Pos(anchor.line,ch,sticky),head)}
function gutterEvent(cm,e,type,prevent){var mX,mY;if(e.touches){mX=e.touches[0].clientX;mY=e.touches[0].clientY;}else{try{mX=e.clientX;mY=e.clientY;}
catch(e$1){return false}}
if(mX>=Math.floor(cm.display.gutters.getBoundingClientRect().right)){return false}
if(prevent){e_preventDefault(e);}
var display=cm.display;var lineBox=display.lineDiv.getBoundingClientRect();if(mY>lineBox.bottom||!hasHandler(cm,type)){return e_defaultPrevented(e)}
mY-=lineBox.top-display.viewOffset;for(var i=0;i<cm.display.gutterSpecs.length;++i){var g=display.gutters.childNodes[i];if(g&&g.getBoundingClientRect().right>=mX){var line=lineAtHeight(cm.doc,mY);var gutter=cm.display.gutterSpecs[i];signal(cm,type,cm,line,gutter.className,e);return e_defaultPrevented(e)}}}
function clickInGutter(cm,e){return gutterEvent(cm,e,"gutterClick",true)}
function onContextMenu(cm,e){if(eventInWidget(cm.display,e)||contextMenuInGutter(cm,e)){return}
if(signalDOMEvent(cm,e,"contextmenu")){return}
if(!captureRightClick){cm.display.input.onContextMenu(e);}}
function contextMenuInGutter(cm,e){if(!hasHandler(cm,"gutterContextMenu")){return false}
return gutterEvent(cm,e,"gutterContextMenu",false)}
function themeChanged(cm){cm.display.wrapper.className=cm.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+
cm.options.theme.replace(/(^|\s)\s*/g," cm-s-");clearCaches(cm);}
var Init={toString:function(){return"CodeMirror.Init"}};var defaults={};var optionHandlers={};function defineOptions(CodeMirror){var optionHandlers=CodeMirror.optionHandlers;function option(name,deflt,handle,notOnInit){CodeMirror.defaults[name]=deflt;if(handle){optionHandlers[name]=notOnInit?function(cm,val,old){if(old!=Init){handle(cm,val,old);}}:handle;}}
CodeMirror.defineOption=option;CodeMirror.Init=Init;option("value","",function(cm,val){return cm.setValue(val);},true);option("mode",null,function(cm,val){cm.doc.modeOption=val;loadMode(cm);},true);option("indentUnit",2,loadMode,true);option("indentWithTabs",false);option("smartIndent",true);option("tabSize",4,function(cm){resetModeState(cm);clearCaches(cm);regChange(cm);},true);option("lineSeparator",null,function(cm,val){cm.doc.lineSep=val;if(!val){return}
var newBreaks=[],lineNo=cm.doc.first;cm.doc.iter(function(line){for(var pos=0;;){var found=line.text.indexOf(val,pos);if(found==-1){break}
pos=found+val.length;newBreaks.push(Pos(lineNo,found));}
lineNo++;});for(var i=newBreaks.length-1;i>=0;i--)
{replaceRange(cm.doc,val,newBreaks[i],Pos(newBreaks[i].line,newBreaks[i].ch+val.length));}});option("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,function(cm,val,old){cm.state.specialChars=new RegExp(val.source+(val.test("\t")?"":"|\t"),"g");if(old!=Init){cm.refresh();}});option("specialCharPlaceholder",defaultSpecialCharPlaceholder,function(cm){return cm.refresh();},true);option("electricChars",true);option("inputStyle",mobile?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},true);option("spellcheck",false,function(cm,val){return cm.getInputField().spellcheck=val;},true);option("autocorrect",false,function(cm,val){return cm.getInputField().autocorrect=val;},true);option("autocapitalize",false,function(cm,val){return cm.getInputField().autocapitalize=val;},true);option("rtlMoveVisually",!windows);option("wholeLineUpdateBefore",true);option("theme","default",function(cm){themeChanged(cm);updateGutters(cm);},true);option("keyMap","default",function(cm,val,old){var next=getKeyMap(val);var prev=old!=Init&&getKeyMap(old);if(prev&&prev.detach){prev.detach(cm,next);}
if(next.attach){next.attach(cm,prev||null);}});option("extraKeys",null);option("configureMouse",null);option("lineWrapping",false,wrappingChanged,true);option("gutters",[],function(cm,val){cm.display.gutterSpecs=getGutters(val,cm.options.lineNumbers);updateGutters(cm);},true);option("fixedGutter",true,function(cm,val){cm.display.gutters.style.left=val?compensateForHScroll(cm.display)+"px":"0";cm.refresh();},true);option("coverGutterNextToScrollbar",false,function(cm){return updateScrollbars(cm);},true);option("scrollbarStyle","native",function(cm){initScrollbars(cm);updateScrollbars(cm);cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);},true);option("lineNumbers",false,function(cm,val){cm.display.gutterSpecs=getGutters(cm.options.gutters,val);updateGutters(cm);},true);option("firstLineNumber",1,updateGutters,true);option("lineNumberFormatter",function(integer){return integer;},updateGutters,true);option("showCursorWhenSelecting",false,updateSelection,true);option("resetSelectionOnContextMenu",true);option("lineWiseCopyCut",true);option("pasteLinesPerSelection",true);option("selectionsMayTouch",false);option("readOnly",false,function(cm,val){if(val=="nocursor"){onBlur(cm);cm.display.input.blur();}
cm.display.input.readOnlyChanged(val);});option("screenReaderLabel",null,function(cm,val){val=(val==='')?null:val;cm.display.input.screenReaderLabelChanged(val);});option("disableInput",false,function(cm,val){if(!val){cm.display.input.reset();}},true);option("dragDrop",true,dragDropChanged);option("allowDropFileTypes",null);option("cursorBlinkRate",530);option("cursorScrollMargin",0);option("cursorHeight",1,updateSelection,true);option("singleCursorHeightPerLine",true,updateSelection,true);option("workTime",100);option("workDelay",100);option("flattenSpans",true,resetModeState,true);option("addModeClass",false,resetModeState,true);option("pollInterval",100);option("undoDepth",200,function(cm,val){return cm.doc.history.undoDepth=val;});option("historyEventDelay",1250);option("viewportMargin",10,function(cm){return cm.refresh();},true);option("maxHighlightLength",10000,resetModeState,true);option("moveInputWithCursor",true,function(cm,val){if(!val){cm.display.input.resetPosition();}});option("tabindex",null,function(cm,val){return cm.display.input.getField().tabIndex=val||"";});option("autofocus",null);option("direction","ltr",function(cm,val){return cm.doc.setDirection(val);},true);option("phrases",null);}
function dragDropChanged(cm,value,old){var wasOn=old&&old!=Init;if(!value!=!wasOn){var funcs=cm.display.dragFunctions;var toggle=value?on:off;toggle(cm.display.scroller,"dragstart",funcs.start);toggle(cm.display.scroller,"dragenter",funcs.enter);toggle(cm.display.scroller,"dragover",funcs.over);toggle(cm.display.scroller,"dragleave",funcs.leave);toggle(cm.display.scroller,"drop",funcs.drop);}}
function wrappingChanged(cm){if(cm.options.lineWrapping){addClass(cm.display.wrapper,"CodeMirror-wrap");cm.display.sizer.style.minWidth="";cm.display.sizerWidth=null;}else{rmClass(cm.display.wrapper,"CodeMirror-wrap");findMaxLine(cm);}
estimateLineHeights(cm);regChange(cm);clearCaches(cm);setTimeout(function(){return updateScrollbars(cm);},100);}
function CodeMirror(place,options){var this$1=this;if(!(this instanceof CodeMirror)){return new CodeMirror(place,options)}
this.options=options=options?copyObj(options):{};copyObj(defaults,options,false);var doc=options.value;if(typeof doc=="string"){doc=new Doc(doc,options.mode,null,options.lineSeparator,options.direction);}
else if(options.mode){doc.modeOption=options.mode;}
this.doc=doc;var input=new CodeMirror.inputStyles[options.inputStyle](this);var display=this.display=new Display(place,doc,input,options);display.wrapper.CodeMirror=this;themeChanged(this);if(options.lineWrapping)
{this.display.wrapper.className+=" CodeMirror-wrap";}
initScrollbars(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:false,delayingBlurEvent:false,focused:false,suppressEdits:false,pasteIncoming:-1,cutIncoming:-1,selectingText:false,draggingText:false,highlight:new Delayed(),keySeq:null,specialChars:null};if(options.autofocus&&!mobile){display.input.focus();}
if(ie&&ie_version<11){setTimeout(function(){return this$1.display.input.reset(true);},20);}
registerEventHandlers(this);ensureGlobalHandlers();startOperation(this);this.curOp.forceUpdate=true;attachDoc(this,doc);if((options.autofocus&&!mobile)||this.hasFocus())
{setTimeout(function(){if(this$1.hasFocus()&&!this$1.state.focused){onFocus(this$1);}},20);}
else
{onBlur(this);}
for(var opt in optionHandlers){if(optionHandlers.hasOwnProperty(opt))
{optionHandlers[opt](this,options[opt],Init);}}
maybeUpdateLineNumberWidth(this);if(options.finishInit){options.finishInit(this);}
for(var i=0;i<initHooks.length;++i){initHooks[i](this);}
endOperation(this);if(webkit&&options.lineWrapping&&getComputedStyle(display.lineDiv).textRendering=="optimizelegibility")
{display.lineDiv.style.textRendering="auto";}}
CodeMirror.defaults=defaults;CodeMirror.optionHandlers=optionHandlers;function registerEventHandlers(cm){var d=cm.display;on(d.scroller,"mousedown",operation(cm,onMouseDown));if(ie&&ie_version<11)
{on(d.scroller,"dblclick",operation(cm,function(e){if(signalDOMEvent(cm,e)){return}
var pos=posFromMouse(cm,e);if(!pos||clickInGutter(cm,e)||eventInWidget(cm.display,e)){return}
e_preventDefault(e);var word=cm.findWordAt(pos);extendSelection(cm.doc,word.anchor,word.head);}));}
else
{on(d.scroller,"dblclick",function(e){return signalDOMEvent(cm,e)||e_preventDefault(e);});}
on(d.scroller,"contextmenu",function(e){return onContextMenu(cm,e);});on(d.input.getField(),"contextmenu",function(e){if(!d.scroller.contains(e.target)){onContextMenu(cm,e);}});var touchFinished,prevTouch={end:0};function finishTouch(){if(d.activeTouch){touchFinished=setTimeout(function(){return d.activeTouch=null;},1000);prevTouch=d.activeTouch;prevTouch.end=+new Date;}}
function isMouseLikeTouchEvent(e){if(e.touches.length!=1){return false}
var touch=e.touches[0];return touch.radiusX<=1&&touch.radiusY<=1}
function farAway(touch,other){if(other.left==null){return true}
var dx=other.left-touch.left,dy=other.top-touch.top;return dx*dx+dy*dy>20*20}
on(d.scroller,"touchstart",function(e){if(!signalDOMEvent(cm,e)&&!isMouseLikeTouchEvent(e)&&!clickInGutter(cm,e)){d.input.ensurePolled();clearTimeout(touchFinished);var now=+new Date;d.activeTouch={start:now,moved:false,prev:now-prevTouch.end<=300?prevTouch:null};if(e.touches.length==1){d.activeTouch.left=e.touches[0].pageX;d.activeTouch.top=e.touches[0].pageY;}}});on(d.scroller,"touchmove",function(){if(d.activeTouch){d.activeTouch.moved=true;}});on(d.scroller,"touchend",function(e){var touch=d.activeTouch;if(touch&&!eventInWidget(d,e)&&touch.left!=null&&!touch.moved&&new Date-touch.start<300){var pos=cm.coordsChar(d.activeTouch,"page"),range;if(!touch.prev||farAway(touch,touch.prev))
{range=new Range(pos,pos);}
else if(!touch.prev.prev||farAway(touch,touch.prev.prev))
{range=cm.findWordAt(pos);}
else
{range=new Range(Pos(pos.line,0),clipPos(cm.doc,Pos(pos.line+1,0)));}
cm.setSelection(range.anchor,range.head);cm.focus();e_preventDefault(e);}
finishTouch();});on(d.scroller,"touchcancel",finishTouch);on(d.scroller,"scroll",function(){if(d.scroller.clientHeight){updateScrollTop(cm,d.scroller.scrollTop);setScrollLeft(cm,d.scroller.scrollLeft,true);signal(cm,"scroll",cm);}});on(d.scroller,"mousewheel",function(e){return onScrollWheel(cm,e);});on(d.scroller,"DOMMouseScroll",function(e){return onScrollWheel(cm,e);});on(d.wrapper,"scroll",function(){return d.wrapper.scrollTop=d.wrapper.scrollLeft=0;});d.dragFunctions={enter:function(e){if(!signalDOMEvent(cm,e)){e_stop(e);}},over:function(e){if(!signalDOMEvent(cm,e)){onDragOver(cm,e);e_stop(e);}},start:function(e){return onDragStart(cm,e);},drop:operation(cm,onDrop),leave:function(e){if(!signalDOMEvent(cm,e)){clearDragCursor(cm);}}};var inp=d.input.getField();on(inp,"keyup",function(e){return onKeyUp.call(cm,e);});on(inp,"keydown",operation(cm,onKeyDown));on(inp,"keypress",operation(cm,onKeyPress));on(inp,"focus",function(e){return onFocus(cm,e);});on(inp,"blur",function(e){return onBlur(cm,e);});}
var initHooks=[];CodeMirror.defineInitHook=function(f){return initHooks.push(f);};function indentLine(cm,n,how,aggressive){var doc=cm.doc,state;if(how==null){how="add";}
if(how=="smart"){if(!doc.mode.indent){how="prev";}
else{state=getContextBefore(cm,n).state;}}
var tabSize=cm.options.tabSize;var line=getLine(doc,n),curSpace=countColumn(line.text,null,tabSize);if(line.stateAfter){line.stateAfter=null;}
var curSpaceString=line.text.match(/^\s*/)[0],indentation;if(!aggressive&&!/\S/.test(line.text)){indentation=0;how="not";}else if(how=="smart"){indentation=doc.mode.indent(state,line.text.slice(curSpaceString.length),line.text);if(indentation==Pass||indentation>150){if(!aggressive){return}
how="prev";}}
if(how=="prev"){if(n>doc.first){indentation=countColumn(getLine(doc,n-1).text,null,tabSize);}
else{indentation=0;}}else if(how=="add"){indentation=curSpace+cm.options.indentUnit;}else if(how=="subtract"){indentation=curSpace-cm.options.indentUnit;}else if(typeof how=="number"){indentation=curSpace+how;}
indentation=Math.max(0,indentation);var indentString="",pos=0;if(cm.options.indentWithTabs)
{for(var i=Math.floor(indentation/tabSize);i;--i){pos+=tabSize;indentString+="\t";}}
if(pos<indentation){indentString+=spaceStr(indentation-pos);}
if(indentString!=curSpaceString){replaceRange(doc,indentString,Pos(n,0),Pos(n,curSpaceString.length),"+input");line.stateAfter=null;return true}else{for(var i$1=0;i$1<doc.sel.ranges.length;i$1++){var range=doc.sel.ranges[i$1];if(range.head.line==n&&range.head.ch<curSpaceString.length){var pos$1=Pos(n,curSpaceString.length);replaceOneSelection(doc,i$1,new Range(pos$1,pos$1));break}}}}
var lastCopied=null;function setLastCopied(newLastCopied){lastCopied=newLastCopied;}
function applyTextInput(cm,inserted,deleted,sel,origin){var doc=cm.doc;cm.display.shift=false;if(!sel){sel=doc.sel;}
var recent=+new Date-200;var paste=origin=="paste"||cm.state.pasteIncoming>recent;var textLines=splitLinesAuto(inserted),multiPaste=null;if(paste&&sel.ranges.length>1){if(lastCopied&&lastCopied.text.join("\n")==inserted){if(sel.ranges.length%lastCopied.text.length==0){multiPaste=[];for(var i=0;i<lastCopied.text.length;i++)
{multiPaste.push(doc.splitLines(lastCopied.text[i]));}}}else if(textLines.length==sel.ranges.length&&cm.options.pasteLinesPerSelection){multiPaste=map(textLines,function(l){return[l];});}}
var updateInput=cm.curOp.updateInput;for(var i$1=sel.ranges.length-1;i$1>=0;i$1--){var range=sel.ranges[i$1];var from=range.from(),to=range.to();if(range.empty()){if(deleted&&deleted>0)
{from=Pos(from.line,from.ch-deleted);}
else if(cm.state.overwrite&&!paste)
{to=Pos(to.line,Math.min(getLine(doc,to.line).text.length,to.ch+lst(textLines).length));}
else if(paste&&lastCopied&&lastCopied.lineWise&&lastCopied.text.join("\n")==textLines.join("\n"))
{from=to=Pos(from.line,0);}}
var changeEvent={from:from,to:to,text:multiPaste?multiPaste[i$1%multiPaste.length]:textLines,origin:origin||(paste?"paste":cm.state.cutIncoming>recent?"cut":"+input")};makeChange(cm.doc,changeEvent);signalLater(cm,"inputRead",cm,changeEvent);}
if(inserted&&!paste)
{triggerElectric(cm,inserted);}
ensureCursorVisible(cm);if(cm.curOp.updateInput<2){cm.curOp.updateInput=updateInput;}
cm.curOp.typing=true;cm.state.pasteIncoming=cm.state.cutIncoming=-1;}
function handlePaste(e,cm){var pasted=e.clipboardData&&e.clipboardData.getData("Text");if(pasted){e.preventDefault();if(!cm.isReadOnly()&&!cm.options.disableInput&&cm.hasFocus())
{runInOp(cm,function(){return applyTextInput(cm,pasted,0,null,"paste");});}
return true}}
function triggerElectric(cm,inserted){if(!cm.options.electricChars||!cm.options.smartIndent){return}
var sel=cm.doc.sel;for(var i=sel.ranges.length-1;i>=0;i--){var range=sel.ranges[i];if(range.head.ch>100||(i&&sel.ranges[i-1].head.line==range.head.line)){continue}
var mode=cm.getModeAt(range.head);var indented=false;if(mode.electricChars){for(var j=0;j<mode.electricChars.length;j++)
{if(inserted.indexOf(mode.electricChars.charAt(j))>-1){indented=indentLine(cm,range.head.line,"smart");break}}}else if(mode.electricInput){if(mode.electricInput.test(getLine(cm.doc,range.head.line).text.slice(0,range.head.ch)))
{indented=indentLine(cm,range.head.line,"smart");}}
if(indented){signalLater(cm,"electricInput",cm,range.head.line);}}}
function copyableRanges(cm){var text=[],ranges=[];for(var i=0;i<cm.doc.sel.ranges.length;i++){var line=cm.doc.sel.ranges[i].head.line;var lineRange={anchor:Pos(line,0),head:Pos(line+1,0)};ranges.push(lineRange);text.push(cm.getRange(lineRange.anchor,lineRange.head));}
return{text:text,ranges:ranges}}
function disableBrowserMagic(field,spellcheck,autocorrect,autocapitalize){field.setAttribute("autocorrect",autocorrect?"":"off");field.setAttribute("autocapitalize",autocapitalize?"":"off");field.setAttribute("spellcheck",!!spellcheck);}
function hiddenTextarea(){var te=elt("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none");var div=elt("div",[te],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");if(webkit){te.style.width="1000px";}
else{te.setAttribute("wrap","off");}
if(ios){te.style.border="1px solid black";}
disableBrowserMagic(te);return div}
function addEditorMethods(CodeMirror){var optionHandlers=CodeMirror.optionHandlers;var helpers=CodeMirror.helpers={};CodeMirror.prototype={constructor:CodeMirror,focus:function(){win(this).focus();this.display.input.focus();},setOption:function(option,value){var options=this.options,old=options[option];if(options[option]==value&&option!="mode"){return}
options[option]=value;if(optionHandlers.hasOwnProperty(option))
{operation(this,optionHandlers[option])(this,value,old);}
signal(this,"optionChange",this,option);},getOption:function(option){return this.options[option]},getDoc:function(){return this.doc},addKeyMap:function(map,bottom){this.state.keyMaps[bottom?"push":"unshift"](getKeyMap(map));},removeKeyMap:function(map){var maps=this.state.keyMaps;for(var i=0;i<maps.length;++i)
{if(maps[i]==map||maps[i].name==map){maps.splice(i,1);return true}}},addOverlay:methodOp(function(spec,options){var mode=spec.token?spec:CodeMirror.getMode(this.options,spec);if(mode.startState){throw new Error("Overlays may not be stateful.")}
insertSorted(this.state.overlays,{mode:mode,modeSpec:spec,opaque:options&&options.opaque,priority:(options&&options.priority)||0},function(overlay){return overlay.priority;});this.state.modeGen++;regChange(this);}),removeOverlay:methodOp(function(spec){var overlays=this.state.overlays;for(var i=0;i<overlays.length;++i){var cur=overlays[i].modeSpec;if(cur==spec||typeof spec=="string"&&cur.name==spec){overlays.splice(i,1);this.state.modeGen++;regChange(this);return}}}),indentLine:methodOp(function(n,dir,aggressive){if(typeof dir!="string"&&typeof dir!="number"){if(dir==null){dir=this.options.smartIndent?"smart":"prev";}
else{dir=dir?"add":"subtract";}}
if(isLine(this.doc,n)){indentLine(this,n,dir,aggressive);}}),indentSelection:methodOp(function(how){var ranges=this.doc.sel.ranges,end=-1;for(var i=0;i<ranges.length;i++){var range=ranges[i];if(!range.empty()){var from=range.from(),to=range.to();var start=Math.max(end,from.line);end=Math.min(this.lastLine(),to.line-(to.ch?0:1))+1;for(var j=start;j<end;++j)
{indentLine(this,j,how);}
var newRanges=this.doc.sel.ranges;if(from.ch==0&&ranges.length==newRanges.length&&newRanges[i].from().ch>0)
{replaceOneSelection(this.doc,i,new Range(from,newRanges[i].to()),sel_dontScroll);}}else if(range.head.line>end){indentLine(this,range.head.line,how,true);end=range.head.line;if(i==this.doc.sel.primIndex){ensureCursorVisible(this);}}}}),getTokenAt:function(pos,precise){return takeToken(this,pos,precise)},getLineTokens:function(line,precise){return takeToken(this,Pos(line),precise,true)},getTokenTypeAt:function(pos){pos=clipPos(this.doc,pos);var styles=getLineStyles(this,getLine(this.doc,pos.line));var before=0,after=(styles.length-1)/2,ch=pos.ch;var type;if(ch==0){type=styles[2];}
else{for(;;){var mid=(before+after)>>1;if((mid?styles[mid*2-1]:0)>=ch){after=mid;}
else if(styles[mid*2+1]<ch){before=mid+1;}
else{type=styles[mid*2+2];break}}}
var cut=type?type.indexOf("overlay "):-1;return cut<0?type:cut==0?null:type.slice(0,cut-1)},getModeAt:function(pos){var mode=this.doc.mode;if(!mode.innerMode){return mode}
return CodeMirror.innerMode(mode,this.getTokenAt(pos).state).mode},getHelper:function(pos,type){return this.getHelpers(pos,type)[0]},getHelpers:function(pos,type){var found=[];if(!helpers.hasOwnProperty(type)){return found}
var help=helpers[type],mode=this.getModeAt(pos);if(typeof mode[type]=="string"){if(help[mode[type]]){found.push(help[mode[type]]);}}else if(mode[type]){for(var i=0;i<mode[type].length;i++){var val=help[mode[type][i]];if(val){found.push(val);}}}else if(mode.helperType&&help[mode.helperType]){found.push(help[mode.helperType]);}else if(help[mode.name]){found.push(help[mode.name]);}
for(var i$1=0;i$1<help._global.length;i$1++){var cur=help._global[i$1];if(cur.pred(mode,this)&&indexOf(found,cur.val)==-1)
{found.push(cur.val);}}
return found},getStateAfter:function(line,precise){var doc=this.doc;line=clipLine(doc,line==null?doc.first+doc.size-1:line);return getContextBefore(this,line+1,precise).state},cursorCoords:function(start,mode){var pos,range=this.doc.sel.primary();if(start==null){pos=range.head;}
else if(typeof start=="object"){pos=clipPos(this.doc,start);}
else{pos=start?range.from():range.to();}
return cursorCoords(this,pos,mode||"page")},charCoords:function(pos,mode){return charCoords(this,clipPos(this.doc,pos),mode||"page")},coordsChar:function(coords,mode){coords=fromCoordSystem(this,coords,mode||"page");return coordsChar(this,coords.left,coords.top)},lineAtHeight:function(height,mode){height=fromCoordSystem(this,{top:height,left:0},mode||"page").top;return lineAtHeight(this.doc,height+this.display.viewOffset)},heightAtLine:function(line,mode,includeWidgets){var end=false,lineObj;if(typeof line=="number"){var last=this.doc.first+this.doc.size-1;if(line<this.doc.first){line=this.doc.first;}
else if(line>last){line=last;end=true;}
lineObj=getLine(this.doc,line);}else{lineObj=line;}
return intoCoordSystem(this,lineObj,{top:0,left:0},mode||"page",includeWidgets||end).top+
(end?this.doc.height-heightAtLine(lineObj):0)},defaultTextHeight:function(){return textHeight(this.display)},defaultCharWidth:function(){return charWidth(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(pos,node,scroll,vert,horiz){var display=this.display;pos=cursorCoords(this,clipPos(this.doc,pos));var top=pos.bottom,left=pos.left;node.style.position="absolute";node.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(node);display.sizer.appendChild(node);if(vert=="over"){top=pos.top;}else if(vert=="above"||vert=="near"){var vspace=Math.max(display.wrapper.clientHeight,this.doc.height),hspace=Math.max(display.sizer.clientWidth,display.lineSpace.clientWidth);if((vert=='above'||pos.bottom+node.offsetHeight>vspace)&&pos.top>node.offsetHeight)
{top=pos.top-node.offsetHeight;}
else if(pos.bottom+node.offsetHeight<=vspace)
{top=pos.bottom;}
if(left+node.offsetWidth>hspace)
{left=hspace-node.offsetWidth;}}
node.style.top=top+"px";node.style.left=node.style.right="";if(horiz=="right"){left=display.sizer.clientWidth-node.offsetWidth;node.style.right="0px";}else{if(horiz=="left"){left=0;}
else if(horiz=="middle"){left=(display.sizer.clientWidth-node.offsetWidth)/2;}
node.style.left=left+"px";}
if(scroll)
{scrollIntoView(this,{left:left,top:top,right:left+node.offsetWidth,bottom:top+node.offsetHeight});}},triggerOnKeyDown:methodOp(onKeyDown),triggerOnKeyPress:methodOp(onKeyPress),triggerOnKeyUp:onKeyUp,triggerOnMouseDown:methodOp(onMouseDown),execCommand:function(cmd){if(commands.hasOwnProperty(cmd))
{return commands[cmd].call(null,this)}},triggerElectric:methodOp(function(text){triggerElectric(this,text);}),findPosH:function(from,amount,unit,visually){var dir=1;if(amount<0){dir=-1;amount=-amount;}
var cur=clipPos(this.doc,from);for(var i=0;i<amount;++i){cur=findPosH(this.doc,cur,dir,unit,visually);if(cur.hitSide){break}}
return cur},moveH:methodOp(function(dir,unit){var this$1=this;this.extendSelectionsBy(function(range){if(this$1.display.shift||this$1.doc.extend||range.empty())
{return findPosH(this$1.doc,range.head,dir,unit,this$1.options.rtlMoveVisually)}
else
{return dir<0?range.from():range.to()}},sel_move);}),deleteH:methodOp(function(dir,unit){var sel=this.doc.sel,doc=this.doc;if(sel.somethingSelected())
{doc.replaceSelection("",null,"+delete");}
else
{deleteNearSelection(this,function(range){var other=findPosH(doc,range.head,dir,unit,false);return dir<0?{from:other,to:range.head}:{from:range.head,to:other}});}}),findPosV:function(from,amount,unit,goalColumn){var dir=1,x=goalColumn;if(amount<0){dir=-1;amount=-amount;}
var cur=clipPos(this.doc,from);for(var i=0;i<amount;++i){var coords=cursorCoords(this,cur,"div");if(x==null){x=coords.left;}
else{coords.left=x;}
cur=findPosV(this,coords,dir,unit);if(cur.hitSide){break}}
return cur},moveV:methodOp(function(dir,unit){var this$1=this;var doc=this.doc,goals=[];var collapse=!this.display.shift&&!doc.extend&&doc.sel.somethingSelected();doc.extendSelectionsBy(function(range){if(collapse)
{return dir<0?range.from():range.to()}
var headPos=cursorCoords(this$1,range.head,"div");if(range.goalColumn!=null){headPos.left=range.goalColumn;}
goals.push(headPos.left);var pos=findPosV(this$1,headPos,dir,unit);if(unit=="page"&&range==doc.sel.primary())
{addToScrollTop(this$1,charCoords(this$1,pos,"div").top-headPos.top);}
return pos},sel_move);if(goals.length){for(var i=0;i<doc.sel.ranges.length;i++)
{doc.sel.ranges[i].goalColumn=goals[i];}}}),findWordAt:function(pos){var doc=this.doc,line=getLine(doc,pos.line).text;var start=pos.ch,end=pos.ch;if(line){var helper=this.getHelper(pos,"wordChars");if((pos.sticky=="before"||end==line.length)&&start){--start;}else{++end;}
var startChar=line.charAt(start);var check=isWordChar(startChar,helper)?function(ch){return isWordChar(ch,helper);}:/\s/.test(startChar)?function(ch){return/\s/.test(ch);}:function(ch){return(!/\s/.test(ch)&&!isWordChar(ch));};while(start>0&&check(line.charAt(start-1))){--start;}
while(end<line.length&&check(line.charAt(end))){++end;}}
return new Range(Pos(pos.line,start),Pos(pos.line,end))},toggleOverwrite:function(value){if(value!=null&&value==this.state.overwrite){return}
if(this.state.overwrite=!this.state.overwrite)
{addClass(this.display.cursorDiv,"CodeMirror-overwrite");}
else
{rmClass(this.display.cursorDiv,"CodeMirror-overwrite");}
signal(this,"overwriteToggle",this,this.state.overwrite);},hasFocus:function(){return this.display.input.getField()==activeElt(doc(this))},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:methodOp(function(x,y){scrollToCoords(this,x,y);}),getScrollInfo:function(){var scroller=this.display.scroller;return{left:scroller.scrollLeft,top:scroller.scrollTop,height:scroller.scrollHeight-scrollGap(this)-this.display.barHeight,width:scroller.scrollWidth-scrollGap(this)-this.display.barWidth,clientHeight:displayHeight(this),clientWidth:displayWidth(this)}},scrollIntoView:methodOp(function(range,margin){if(range==null){range={from:this.doc.sel.primary().head,to:null};if(margin==null){margin=this.options.cursorScrollMargin;}}else if(typeof range=="number"){range={from:Pos(range,0),to:null};}else if(range.from==null){range={from:range,to:null};}
if(!range.to){range.to=range.from;}
range.margin=margin||0;if(range.from.line!=null){scrollToRange(this,range);}else{scrollToCoordsRange(this,range.from,range.to,range.margin);}}),setSize:methodOp(function(width,height){var this$1=this;var interpret=function(val){return typeof val=="number"||/^\d+$/.test(String(val))?val+"px":val;};if(width!=null){this.display.wrapper.style.width=interpret(width);}
if(height!=null){this.display.wrapper.style.height=interpret(height);}
if(this.options.lineWrapping){clearLineMeasurementCache(this);}
var lineNo=this.display.viewFrom;this.doc.iter(lineNo,this.display.viewTo,function(line){if(line.widgets){for(var i=0;i<line.widgets.length;i++)
{if(line.widgets[i].noHScroll){regLineChange(this$1,lineNo,"widget");break}}}
++lineNo;});this.curOp.forceUpdate=true;signal(this,"refresh",this);}),operation:function(f){return runInOp(this,f)},startOperation:function(){return startOperation(this)},endOperation:function(){return endOperation(this)},refresh:methodOp(function(){var oldHeight=this.display.cachedTextHeight;regChange(this);this.curOp.forceUpdate=true;clearCaches(this);scrollToCoords(this,this.doc.scrollLeft,this.doc.scrollTop);updateGutterSpace(this.display);if(oldHeight==null||Math.abs(oldHeight-textHeight(this.display))>.5||this.options.lineWrapping)
{estimateLineHeights(this);}
signal(this,"refresh",this);}),swapDoc:methodOp(function(doc){var old=this.doc;old.cm=null;if(this.state.selectingText){this.state.selectingText();}
attachDoc(this,doc);clearCaches(this);this.display.input.reset();scrollToCoords(this,doc.scrollLeft,doc.scrollTop);this.curOp.forceScroll=true;signalLater(this,"swapDoc",this,old);return old}),phrase:function(phraseText){var phrases=this.options.phrases;return phrases&&Object.prototype.hasOwnProperty.call(phrases,phraseText)?phrases[phraseText]:phraseText},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};eventMixin(CodeMirror);CodeMirror.registerHelper=function(type,name,value){if(!helpers.hasOwnProperty(type)){helpers[type]=CodeMirror[type]={_global:[]};}
helpers[type][name]=value;};CodeMirror.registerGlobalHelper=function(type,name,predicate,value){CodeMirror.registerHelper(type,name,value);helpers[type]._global.push({pred:predicate,val:value});};}
function findPosH(doc,pos,dir,unit,visually){var oldPos=pos;var origDir=dir;var lineObj=getLine(doc,pos.line);var lineDir=visually&&doc.direction=="rtl"?-dir:dir;function findNextLine(){var l=pos.line+lineDir;if(l<doc.first||l>=doc.first+doc.size){return false}
pos=new Pos(l,pos.ch,pos.sticky);return lineObj=getLine(doc,l)}
function moveOnce(boundToLine){var next;if(unit=="codepoint"){var ch=lineObj.text.charCodeAt(pos.ch+(dir>0?0:-1));if(isNaN(ch)){next=null;}else{var astral=dir>0?ch>=0xD800&&ch<0xDC00:ch>=0xDC00&&ch<0xDFFF;next=new Pos(pos.line,Math.max(0,Math.min(lineObj.text.length,pos.ch+dir*(astral?2:1))),-dir);}}else if(visually){next=moveVisually(doc.cm,lineObj,pos,dir);}else{next=moveLogically(lineObj,pos,dir);}
if(next==null){if(!boundToLine&&findNextLine())
{pos=endOfLine(visually,doc.cm,lineObj,pos.line,lineDir);}
else
{return false}}else{pos=next;}
return true}
if(unit=="char"||unit=="codepoint"){moveOnce();}else if(unit=="column"){moveOnce(true);}else if(unit=="word"||unit=="group"){var sawType=null,group=unit=="group";var helper=doc.cm&&doc.cm.getHelper(pos,"wordChars");for(var first=true;;first=false){if(dir<0&&!moveOnce(!first)){break}
var cur=lineObj.text.charAt(pos.ch)||"\n";var type=isWordChar(cur,helper)?"w":group&&cur=="\n"?"n":!group||/\s/.test(cur)?null:"p";if(group&&!first&&!type){type="s";}
if(sawType&&sawType!=type){if(dir<0){dir=1;moveOnce();pos.sticky="after";}
break}
if(type){sawType=type;}
if(dir>0&&!moveOnce(!first)){break}}}
var result=skipAtomic(doc,pos,oldPos,origDir,true);if(equalCursorPos(oldPos,result)){result.hitSide=true;}
return result}
function findPosV(cm,pos,dir,unit){var doc=cm.doc,x=pos.left,y;if(unit=="page"){var pageSize=Math.min(cm.display.wrapper.clientHeight,win(cm).innerHeight||doc(cm).documentElement.clientHeight);var moveAmount=Math.max(pageSize-.5*textHeight(cm.display),3);y=(dir>0?pos.bottom:pos.top)+dir*moveAmount;}else if(unit=="line"){y=dir>0?pos.bottom+3:pos.top-3;}
var target;for(;;){target=coordsChar(cm,x,y);if(!target.outside){break}
if(dir<0?y<=0:y>=doc.height){target.hitSide=true;break}
y+=dir*5;}
return target}
var ContentEditableInput=function(cm){this.cm=cm;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new Delayed();this.composing=null;this.gracePeriod=false;this.readDOMTimeout=null;};ContentEditableInput.prototype.init=function(display){var this$1=this;var input=this,cm=input.cm;var div=input.div=display.lineDiv;div.contentEditable=true;disableBrowserMagic(div,cm.options.spellcheck,cm.options.autocorrect,cm.options.autocapitalize);function belongsToInput(e){for(var t=e.target;t;t=t.parentNode){if(t==div){return true}
if(/\bCodeMirror-(?:line)?widget\b/.test(t.className)){break}}
return false}
on(div,"paste",function(e){if(!belongsToInput(e)||signalDOMEvent(cm,e)||handlePaste(e,cm)){return}
if(ie_version<=11){setTimeout(operation(cm,function(){return this$1.updateFromDOM();}),20);}});on(div,"compositionstart",function(e){this$1.composing={data:e.data,done:false};});on(div,"compositionupdate",function(e){if(!this$1.composing){this$1.composing={data:e.data,done:false};}});on(div,"compositionend",function(e){if(this$1.composing){if(e.data!=this$1.composing.data){this$1.readFromDOMSoon();}
this$1.composing.done=true;}});on(div,"touchstart",function(){return input.forceCompositionEnd();});on(div,"input",function(){if(!this$1.composing){this$1.readFromDOMSoon();}});function onCopyCut(e){if(!belongsToInput(e)||signalDOMEvent(cm,e)){return}
if(cm.somethingSelected()){setLastCopied({lineWise:false,text:cm.getSelections()});if(e.type=="cut"){cm.replaceSelection("",null,"cut");}}else if(!cm.options.lineWiseCopyCut){return}else{var ranges=copyableRanges(cm);setLastCopied({lineWise:true,text:ranges.text});if(e.type=="cut"){cm.operation(function(){cm.setSelections(ranges.ranges,0,sel_dontScroll);cm.replaceSelection("",null,"cut");});}}
if(e.clipboardData){e.clipboardData.clearData();var content=lastCopied.text.join("\n");e.clipboardData.setData("Text",content);if(e.clipboardData.getData("Text")==content){e.preventDefault();return}}
var kludge=hiddenTextarea(),te=kludge.firstChild;cm.display.lineSpace.insertBefore(kludge,cm.display.lineSpace.firstChild);te.value=lastCopied.text.join("\n");var hadFocus=activeElt(div.ownerDocument);selectInput(te);setTimeout(function(){cm.display.lineSpace.removeChild(kludge);hadFocus.focus();if(hadFocus==div){input.showPrimarySelection();}},50);}
on(div,"copy",onCopyCut);on(div,"cut",onCopyCut);};ContentEditableInput.prototype.screenReaderLabelChanged=function(label){if(label){this.div.setAttribute('aria-label',label);}else{this.div.removeAttribute('aria-label');}};ContentEditableInput.prototype.prepareSelection=function(){var result=prepareSelection(this.cm,false);result.focus=activeElt(this.div.ownerDocument)==this.div;return result};ContentEditableInput.prototype.showSelection=function(info,takeFocus){if(!info||!this.cm.display.view.length){return}
if(info.focus||takeFocus){this.showPrimarySelection();}
this.showMultipleSelections(info);};ContentEditableInput.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()};ContentEditableInput.prototype.showPrimarySelection=function(){var sel=this.getSelection(),cm=this.cm,prim=cm.doc.sel.primary();var from=prim.from(),to=prim.to();if(cm.display.viewTo==cm.display.viewFrom||from.line>=cm.display.viewTo||to.line<cm.display.viewFrom){sel.removeAllRanges();return}
var curAnchor=domToPos(cm,sel.anchorNode,sel.anchorOffset);var curFocus=domToPos(cm,sel.focusNode,sel.focusOffset);if(curAnchor&&!curAnchor.bad&&curFocus&&!curFocus.bad&&cmp(minPos(curAnchor,curFocus),from)==0&&cmp(maxPos(curAnchor,curFocus),to)==0)
{return}
var view=cm.display.view;var start=(from.line>=cm.display.viewFrom&&posToDOM(cm,from))||{node:view[0].measure.map[2],offset:0};var end=to.line<cm.display.viewTo&&posToDOM(cm,to);if(!end){var measure=view[view.length-1].measure;var map=measure.maps?measure.maps[measure.maps.length-1]:measure.map;end={node:map[map.length-1],offset:map[map.length-2]-map[map.length-3]};}
if(!start||!end){sel.removeAllRanges();return}
var old=sel.rangeCount&&sel.getRangeAt(0),rng;try{rng=range(start.node,start.offset,end.offset,end.node);}
catch(e){}
if(rng){if(!gecko&&cm.state.focused){sel.collapse(start.node,start.offset);if(!rng.collapsed){sel.removeAllRanges();sel.addRange(rng);}}else{sel.removeAllRanges();sel.addRange(rng);}
if(old&&sel.anchorNode==null){sel.addRange(old);}
else if(gecko){this.startGracePeriod();}}
this.rememberSelection();};ContentEditableInput.prototype.startGracePeriod=function(){var this$1=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){this$1.gracePeriod=false;if(this$1.selectionChanged())
{this$1.cm.operation(function(){return this$1.cm.curOp.selectionChanged=true;});}},20);};ContentEditableInput.prototype.showMultipleSelections=function(info){removeChildrenAndAdd(this.cm.display.cursorDiv,info.cursors);removeChildrenAndAdd(this.cm.display.selectionDiv,info.selection);};ContentEditableInput.prototype.rememberSelection=function(){var sel=this.getSelection();this.lastAnchorNode=sel.anchorNode;this.lastAnchorOffset=sel.anchorOffset;this.lastFocusNode=sel.focusNode;this.lastFocusOffset=sel.focusOffset;};ContentEditableInput.prototype.selectionInEditor=function(){var sel=this.getSelection();if(!sel.rangeCount){return false}
var node=sel.getRangeAt(0).commonAncestorContainer;return contains(this.div,node)};ContentEditableInput.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"){if(!this.selectionInEditor()||activeElt(this.div.ownerDocument)!=this.div)
{this.showSelection(this.prepareSelection(),true);}
this.div.focus();}};ContentEditableInput.prototype.blur=function(){this.div.blur();};ContentEditableInput.prototype.getField=function(){return this.div};ContentEditableInput.prototype.supportsTouch=function(){return true};ContentEditableInput.prototype.receivedFocus=function(){var this$1=this;var input=this;if(this.selectionInEditor())
{setTimeout(function(){return this$1.pollSelection();},20);}
else
{runInOp(this.cm,function(){return input.cm.curOp.selectionChanged=true;});}
function poll(){if(input.cm.state.focused){input.pollSelection();input.polling.set(input.cm.options.pollInterval,poll);}}
this.polling.set(this.cm.options.pollInterval,poll);};ContentEditableInput.prototype.selectionChanged=function(){var sel=this.getSelection();return sel.anchorNode!=this.lastAnchorNode||sel.anchorOffset!=this.lastAnchorOffset||sel.focusNode!=this.lastFocusNode||sel.focusOffset!=this.lastFocusOffset};ContentEditableInput.prototype.pollSelection=function(){if(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged()){return}
var sel=this.getSelection(),cm=this.cm;if(android&&chrome&&this.cm.display.gutterSpecs.length&&isInGutter(sel.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs});this.blur();this.focus();return}
if(this.composing){return}
this.rememberSelection();var anchor=domToPos(cm,sel.anchorNode,sel.anchorOffset);var head=domToPos(cm,sel.focusNode,sel.focusOffset);if(anchor&&head){runInOp(cm,function(){setSelection(cm.doc,simpleSelection(anchor,head),sel_dontScroll);if(anchor.bad||head.bad){cm.curOp.selectionChanged=true;}});}};ContentEditableInput.prototype.pollContent=function(){if(this.readDOMTimeout!=null){clearTimeout(this.readDOMTimeout);this.readDOMTimeout=null;}
var cm=this.cm,display=cm.display,sel=cm.doc.sel.primary();var from=sel.from(),to=sel.to();if(from.ch==0&&from.line>cm.firstLine())
{from=Pos(from.line-1,getLine(cm.doc,from.line-1).length);}
if(to.ch==getLine(cm.doc,to.line).text.length&&to.line<cm.lastLine())
{to=Pos(to.line+1,0);}
if(from.line<display.viewFrom||to.line>display.viewTo-1){return false}
var fromIndex,fromLine,fromNode;if(from.line==display.viewFrom||(fromIndex=findViewIndex(cm,from.line))==0){fromLine=lineNo(display.view[0].line);fromNode=display.view[0].node;}else{fromLine=lineNo(display.view[fromIndex].line);fromNode=display.view[fromIndex-1].node.nextSibling;}
var toIndex=findViewIndex(cm,to.line);var toLine,toNode;if(toIndex==display.view.length-1){toLine=display.viewTo-1;toNode=display.lineDiv.lastChild;}else{toLine=lineNo(display.view[toIndex+1].line)-1;toNode=display.view[toIndex+1].node.previousSibling;}
if(!fromNode){return false}
var newText=cm.doc.splitLines(domTextBetween(cm,fromNode,toNode,fromLine,toLine));var oldText=getBetween(cm.doc,Pos(fromLine,0),Pos(toLine,getLine(cm.doc,toLine).text.length));while(newText.length>1&&oldText.length>1){if(lst(newText)==lst(oldText)){newText.pop();oldText.pop();toLine--;}
else if(newText[0]==oldText[0]){newText.shift();oldText.shift();fromLine++;}
else{break}}
var cutFront=0,cutEnd=0;var newTop=newText[0],oldTop=oldText[0],maxCutFront=Math.min(newTop.length,oldTop.length);while(cutFront<maxCutFront&&newTop.charCodeAt(cutFront)==oldTop.charCodeAt(cutFront))
{++cutFront;}
var newBot=lst(newText),oldBot=lst(oldText);var maxCutEnd=Math.min(newBot.length-(newText.length==1?cutFront:0),oldBot.length-(oldText.length==1?cutFront:0));while(cutEnd<maxCutEnd&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1))
{++cutEnd;}
if(newText.length==1&&oldText.length==1&&fromLine==from.line){while(cutFront&&cutFront>from.ch&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1)){cutFront--;cutEnd++;}}
newText[newText.length-1]=newBot.slice(0,newBot.length-cutEnd).replace(/^\u200b+/,"");newText[0]=newText[0].slice(cutFront).replace(/\u200b+$/,"");var chFrom=Pos(fromLine,cutFront);var chTo=Pos(toLine,oldText.length?lst(oldText).length-cutEnd:0);if(newText.length>1||newText[0]||cmp(chFrom,chTo)){replaceRange(cm.doc,newText,chFrom,chTo,"+input");return true}};ContentEditableInput.prototype.ensurePolled=function(){this.forceCompositionEnd();};ContentEditableInput.prototype.reset=function(){this.forceCompositionEnd();};ContentEditableInput.prototype.forceCompositionEnd=function(){if(!this.composing){return}
clearTimeout(this.readDOMTimeout);this.composing=null;this.updateFromDOM();this.div.blur();this.div.focus();};ContentEditableInput.prototype.readFromDOMSoon=function(){var this$1=this;if(this.readDOMTimeout!=null){return}
this.readDOMTimeout=setTimeout(function(){this$1.readDOMTimeout=null;if(this$1.composing){if(this$1.composing.done){this$1.composing=null;}
else{return}}
this$1.updateFromDOM();},80);};ContentEditableInput.prototype.updateFromDOM=function(){var this$1=this;if(this.cm.isReadOnly()||!this.pollContent())
{runInOp(this.cm,function(){return regChange(this$1.cm);});}};ContentEditableInput.prototype.setUneditable=function(node){node.contentEditable="false";};ContentEditableInput.prototype.onKeyPress=function(e){if(e.charCode==0||this.composing){return}
e.preventDefault();if(!this.cm.isReadOnly())
{operation(this.cm,applyTextInput)(this.cm,String.fromCharCode(e.charCode==null?e.keyCode:e.charCode),0);}};ContentEditableInput.prototype.readOnlyChanged=function(val){this.div.contentEditable=String(val!="nocursor");};ContentEditableInput.prototype.onContextMenu=function(){};ContentEditableInput.prototype.resetPosition=function(){};ContentEditableInput.prototype.needsContentAttribute=true;function posToDOM(cm,pos){var view=findViewForLine(cm,pos.line);if(!view||view.hidden){return null}
var line=getLine(cm.doc,pos.line);var info=mapFromLineView(view,line,pos.line);var order=getOrder(line,cm.doc.direction),side="left";if(order){var partPos=getBidiPartAt(order,pos.ch);side=partPos%2?"right":"left";}
var result=nodeAndOffsetInLineMap(info.map,pos.ch,side);result.offset=result.collapse=="right"?result.end:result.start;return result}
function isInGutter(node){for(var scan=node;scan;scan=scan.parentNode)
{if(/CodeMirror-gutter-wrapper/.test(scan.className)){return true}}
return false}
function badPos(pos,bad){if(bad){pos.bad=true;}return pos}
function domTextBetween(cm,from,to,fromLine,toLine){var text="",closing=false,lineSep=cm.doc.lineSeparator(),extraLinebreak=false;function recognizeMarker(id){return function(marker){return marker.id==id;}}
function close(){if(closing){text+=lineSep;if(extraLinebreak){text+=lineSep;}
closing=extraLinebreak=false;}}
function addText(str){if(str){close();text+=str;}}
function walk(node){if(node.nodeType==1){var cmText=node.getAttribute("cm-text");if(cmText){addText(cmText);return}
var markerID=node.getAttribute("cm-marker"),range;if(markerID){var found=cm.findMarks(Pos(fromLine,0),Pos(toLine+1,0),recognizeMarker(+markerID));if(found.length&&(range=found[0].find(0)))
{addText(getBetween(cm.doc,range.from,range.to).join(lineSep));}
return}
if(node.getAttribute("contenteditable")=="false"){return}
var isBlock=/^(pre|div|p|li|table|br)$/i.test(node.nodeName);if(!/^br$/i.test(node.nodeName)&&node.textContent.length==0){return}
if(isBlock){close();}
for(var i=0;i<node.childNodes.length;i++)
{walk(node.childNodes[i]);}
if(/^(pre|p)$/i.test(node.nodeName)){extraLinebreak=true;}
if(isBlock){closing=true;}}else if(node.nodeType==3){addText(node.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "));}}
for(;;){walk(from);if(from==to){break}
from=from.nextSibling;extraLinebreak=false;}
return text}
function domToPos(cm,node,offset){var lineNode;if(node==cm.display.lineDiv){lineNode=cm.display.lineDiv.childNodes[offset];if(!lineNode){return badPos(cm.clipPos(Pos(cm.display.viewTo-1)),true)}
node=null;offset=0;}else{for(lineNode=node;;lineNode=lineNode.parentNode){if(!lineNode||lineNode==cm.display.lineDiv){return null}
if(lineNode.parentNode&&lineNode.parentNode==cm.display.lineDiv){break}}}
for(var i=0;i<cm.display.view.length;i++){var lineView=cm.display.view[i];if(lineView.node==lineNode)
{return locateNodeInLineView(lineView,node,offset)}}}
function locateNodeInLineView(lineView,node,offset){var wrapper=lineView.text.firstChild,bad=false;if(!node||!contains(wrapper,node)){return badPos(Pos(lineNo(lineView.line),0),true)}
if(node==wrapper){bad=true;node=wrapper.childNodes[offset];offset=0;if(!node){var line=lineView.rest?lst(lineView.rest):lineView.line;return badPos(Pos(lineNo(line),line.text.length),bad)}}
var textNode=node.nodeType==3?node:null,topNode=node;if(!textNode&&node.childNodes.length==1&&node.firstChild.nodeType==3){textNode=node.firstChild;if(offset){offset=textNode.nodeValue.length;}}
while(topNode.parentNode!=wrapper){topNode=topNode.parentNode;}
var measure=lineView.measure,maps=measure.maps;function find(textNode,topNode,offset){for(var i=-1;i<(maps?maps.length:0);i++){var map=i<0?measure.map:maps[i];for(var j=0;j<map.length;j+=3){var curNode=map[j+2];if(curNode==textNode||curNode==topNode){var line=lineNo(i<0?lineView.line:lineView.rest[i]);var ch=map[j]+offset;if(offset<0||curNode!=textNode){ch=map[j+(offset?1:0)];}
return Pos(line,ch)}}}}
var found=find(textNode,topNode,offset);if(found){return badPos(found,bad)}
for(var after=topNode.nextSibling,dist=textNode?textNode.nodeValue.length-offset:0;after;after=after.nextSibling){found=find(after,after.firstChild,0);if(found)
{return badPos(Pos(found.line,found.ch-dist),bad)}
else
{dist+=after.textContent.length;}}
for(var before=topNode.previousSibling,dist$1=offset;before;before=before.previousSibling){found=find(before,before.firstChild,-1);if(found)
{return badPos(Pos(found.line,found.ch+dist$1),bad)}
else
{dist$1+=before.textContent.length;}}}
var TextareaInput=function(cm){this.cm=cm;this.prevInput="";this.pollingFast=false;this.polling=new Delayed();this.hasSelection=false;this.composing=null;};TextareaInput.prototype.init=function(display){var this$1=this;var input=this,cm=this.cm;this.createField(display);var te=this.textarea;display.wrapper.insertBefore(this.wrapper,display.wrapper.firstChild);if(ios){te.style.width="0px";}
on(te,"input",function(){if(ie&&ie_version>=9&&this$1.hasSelection){this$1.hasSelection=null;}
input.poll();});on(te,"paste",function(e){if(signalDOMEvent(cm,e)||handlePaste(e,cm)){return}
cm.state.pasteIncoming=+new Date;input.fastPoll();});function prepareCopyCut(e){if(signalDOMEvent(cm,e)){return}
if(cm.somethingSelected()){setLastCopied({lineWise:false,text:cm.getSelections()});}else if(!cm.options.lineWiseCopyCut){return}else{var ranges=copyableRanges(cm);setLastCopied({lineWise:true,text:ranges.text});if(e.type=="cut"){cm.setSelections(ranges.ranges,null,sel_dontScroll);}else{input.prevInput="";te.value=ranges.text.join("\n");selectInput(te);}}
if(e.type=="cut"){cm.state.cutIncoming=+new Date;}}
on(te,"cut",prepareCopyCut);on(te,"copy",prepareCopyCut);on(display.scroller,"paste",function(e){if(eventInWidget(display,e)||signalDOMEvent(cm,e)){return}
if(!te.dispatchEvent){cm.state.pasteIncoming=+new Date;input.focus();return}
var event=new Event("paste");event.clipboardData=e.clipboardData;te.dispatchEvent(event);});on(display.lineSpace,"selectstart",function(e){if(!eventInWidget(display,e)){e_preventDefault(e);}});on(te,"compositionstart",function(){var start=cm.getCursor("from");if(input.composing){input.composing.range.clear();}
input.composing={start:start,range:cm.markText(start,cm.getCursor("to"),{className:"CodeMirror-composing"})};});on(te,"compositionend",function(){if(input.composing){input.poll();input.composing.range.clear();input.composing=null;}});};TextareaInput.prototype.createField=function(_display){this.wrapper=hiddenTextarea();this.textarea=this.wrapper.firstChild;};TextareaInput.prototype.screenReaderLabelChanged=function(label){if(label){this.textarea.setAttribute('aria-label',label);}else{this.textarea.removeAttribute('aria-label');}};TextareaInput.prototype.prepareSelection=function(){var cm=this.cm,display=cm.display,doc=cm.doc;var result=prepareSelection(cm);if(cm.options.moveInputWithCursor){var headPos=cursorCoords(cm,doc.sel.primary().head,"div");var wrapOff=display.wrapper.getBoundingClientRect(),lineOff=display.lineDiv.getBoundingClientRect();result.teTop=Math.max(0,Math.min(display.wrapper.clientHeight-10,headPos.top+lineOff.top-wrapOff.top));result.teLeft=Math.max(0,Math.min(display.wrapper.clientWidth-10,headPos.left+lineOff.left-wrapOff.left));}
return result};TextareaInput.prototype.showSelection=function(drawn){var cm=this.cm,display=cm.display;removeChildrenAndAdd(display.cursorDiv,drawn.cursors);removeChildrenAndAdd(display.selectionDiv,drawn.selection);if(drawn.teTop!=null){this.wrapper.style.top=drawn.teTop+"px";this.wrapper.style.left=drawn.teLeft+"px";}};TextareaInput.prototype.reset=function(typing){if(this.contextMenuPending||this.composing){return}
var cm=this.cm;if(cm.somethingSelected()){this.prevInput="";var content=cm.getSelection();this.textarea.value=content;if(cm.state.focused){selectInput(this.textarea);}
if(ie&&ie_version>=9){this.hasSelection=content;}}else if(!typing){this.prevInput=this.textarea.value="";if(ie&&ie_version>=9){this.hasSelection=null;}}};TextareaInput.prototype.getField=function(){return this.textarea};TextareaInput.prototype.supportsTouch=function(){return false};TextareaInput.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!mobile||activeElt(this.textarea.ownerDocument)!=this.textarea)){try{this.textarea.focus();}
catch(e){}}};TextareaInput.prototype.blur=function(){this.textarea.blur();};TextareaInput.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0;};TextareaInput.prototype.receivedFocus=function(){this.slowPoll();};TextareaInput.prototype.slowPoll=function(){var this$1=this;if(this.pollingFast){return}
this.polling.set(this.cm.options.pollInterval,function(){this$1.poll();if(this$1.cm.state.focused){this$1.slowPoll();}});};TextareaInput.prototype.fastPoll=function(){var missed=false,input=this;input.pollingFast=true;function p(){var changed=input.poll();if(!changed&&!missed){missed=true;input.polling.set(60,p);}
else{input.pollingFast=false;input.slowPoll();}}
input.polling.set(20,p);};TextareaInput.prototype.poll=function(){var this$1=this;var cm=this.cm,input=this.textarea,prevInput=this.prevInput;if(this.contextMenuPending||!cm.state.focused||(hasSelection(input)&&!prevInput&&!this.composing)||cm.isReadOnly()||cm.options.disableInput||cm.state.keySeq)
{return false}
var text=input.value;if(text==prevInput&&!cm.somethingSelected()){return false}
if(ie&&ie_version>=9&&this.hasSelection===text||mac&&/[\uf700-\uf7ff]/.test(text)){cm.display.input.reset();return false}
if(cm.doc.sel==cm.display.selForContextMenu){var first=text.charCodeAt(0);if(first==0x200b&&!prevInput){prevInput="\u200b";}
if(first==0x21da){this.reset();return this.cm.execCommand("undo")}}
var same=0,l=Math.min(prevInput.length,text.length);while(same<l&&prevInput.charCodeAt(same)==text.charCodeAt(same)){++same;}
runInOp(cm,function(){applyTextInput(cm,text.slice(same),prevInput.length-same,null,this$1.composing?"*compose":null);if(text.length>1000||text.indexOf("\n")>-1){input.value=this$1.prevInput="";}
else{this$1.prevInput=text;}
if(this$1.composing){this$1.composing.range.clear();this$1.composing.range=cm.markText(this$1.composing.start,cm.getCursor("to"),{className:"CodeMirror-composing"});}});return true};TextareaInput.prototype.ensurePolled=function(){if(this.pollingFast&&this.poll()){this.pollingFast=false;}};TextareaInput.prototype.onKeyPress=function(){if(ie&&ie_version>=9){this.hasSelection=null;}
this.fastPoll();};TextareaInput.prototype.onContextMenu=function(e){var input=this,cm=input.cm,display=cm.display,te=input.textarea;if(input.contextMenuPending){input.contextMenuPending();}
var pos=posFromMouse(cm,e),scrollPos=display.scroller.scrollTop;if(!pos||presto){return}
var reset=cm.options.resetSelectionOnContextMenu;if(reset&&cm.doc.sel.contains(pos)==-1)
{operation(cm,setSelection)(cm.doc,simpleSelection(pos),sel_dontScroll);}
var oldCSS=te.style.cssText,oldWrapperCSS=input.wrapper.style.cssText;var wrapperBox=input.wrapper.offsetParent.getBoundingClientRect();input.wrapper.style.cssText="position: static";te.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-wrapperBox.top-5)+"px; left: "+(e.clientX-wrapperBox.left-5)+"px;\n      z-index: 1000; background: "+(ie?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var oldScrollY;if(webkit){oldScrollY=te.ownerDocument.defaultView.scrollY;}
display.input.focus();if(webkit){te.ownerDocument.defaultView.scrollTo(null,oldScrollY);}
display.input.reset();if(!cm.somethingSelected()){te.value=input.prevInput=" ";}
input.contextMenuPending=rehide;display.selForContextMenu=cm.doc.sel;clearTimeout(display.detectingSelectAll);function prepareSelectAllHack(){if(te.selectionStart!=null){var selected=cm.somethingSelected();var extval="\u200b"+(selected?te.value:"");te.value="\u21da";te.value=extval;input.prevInput=selected?"":"\u200b";te.selectionStart=1;te.selectionEnd=extval.length;display.selForContextMenu=cm.doc.sel;}}
function rehide(){if(input.contextMenuPending!=rehide){return}
input.contextMenuPending=false;input.wrapper.style.cssText=oldWrapperCSS;te.style.cssText=oldCSS;if(ie&&ie_version<9){display.scrollbars.setScrollTop(display.scroller.scrollTop=scrollPos);}
if(te.selectionStart!=null){if(!ie||(ie&&ie_version<9)){prepareSelectAllHack();}
var i=0,poll=function(){if(display.selForContextMenu==cm.doc.sel&&te.selectionStart==0&&te.selectionEnd>0&&input.prevInput=="\u200b"){operation(cm,selectAll)(cm);}else if(i++<10){display.detectingSelectAll=setTimeout(poll,500);}else{display.selForContextMenu=null;display.input.reset();}};display.detectingSelectAll=setTimeout(poll,200);}}
if(ie&&ie_version>=9){prepareSelectAllHack();}
if(captureRightClick){e_stop(e);var mouseup=function(){off(window,"mouseup",mouseup);setTimeout(rehide,20);};on(window,"mouseup",mouseup);}else{setTimeout(rehide,50);}};TextareaInput.prototype.readOnlyChanged=function(val){if(!val){this.reset();}
this.textarea.disabled=val=="nocursor";this.textarea.readOnly=!!val;};TextareaInput.prototype.setUneditable=function(){};TextareaInput.prototype.needsContentAttribute=false;function fromTextArea(textarea,options){options=options?copyObj(options):{};options.value=textarea.value;if(!options.tabindex&&textarea.tabIndex)
{options.tabindex=textarea.tabIndex;}
if(!options.placeholder&&textarea.placeholder)
{options.placeholder=textarea.placeholder;}
if(options.autofocus==null){var hasFocus=activeElt(textarea.ownerDocument);options.autofocus=hasFocus==textarea||textarea.getAttribute("autofocus")!=null&&hasFocus==document.body;}
function save(){textarea.value=cm.getValue();}
var realSubmit;if(textarea.form){on(textarea.form,"submit",save);if(!options.leaveSubmitMethodAlone){var form=textarea.form;realSubmit=form.submit;try{var wrappedSubmit=form.submit=function(){save();form.submit=realSubmit;form.submit();form.submit=wrappedSubmit;};}catch(e){}}}
options.finishInit=function(cm){cm.save=save;cm.getTextArea=function(){return textarea;};cm.toTextArea=function(){cm.toTextArea=isNaN;save();textarea.parentNode.removeChild(cm.getWrapperElement());textarea.style.display="";if(textarea.form){off(textarea.form,"submit",save);if(!options.leaveSubmitMethodAlone&&typeof textarea.form.submit=="function")
{textarea.form.submit=realSubmit;}}};};textarea.style.display="none";var cm=CodeMirror(function(node){return textarea.parentNode.insertBefore(node,textarea.nextSibling);},options);return cm}
function addLegacyProps(CodeMirror){CodeMirror.off=off;CodeMirror.on=on;CodeMirror.wheelEventPixels=wheelEventPixels;CodeMirror.Doc=Doc;CodeMirror.splitLines=splitLinesAuto;CodeMirror.countColumn=countColumn;CodeMirror.findColumn=findColumn;CodeMirror.isWordChar=isWordCharBasic;CodeMirror.Pass=Pass;CodeMirror.signal=signal;CodeMirror.Line=Line;CodeMirror.changeEnd=changeEnd;CodeMirror.scrollbarModel=scrollbarModel;CodeMirror.Pos=Pos;CodeMirror.cmpPos=cmp;CodeMirror.modes=modes;CodeMirror.mimeModes=mimeModes;CodeMirror.resolveMode=resolveMode;CodeMirror.getMode=getMode;CodeMirror.modeExtensions=modeExtensions;CodeMirror.extendMode=extendMode;CodeMirror.copyState=copyState;CodeMirror.startState=startState;CodeMirror.innerMode=innerMode;CodeMirror.commands=commands;CodeMirror.keyMap=keyMap;CodeMirror.keyName=keyName;CodeMirror.isModifierKey=isModifierKey;CodeMirror.lookupKey=lookupKey;CodeMirror.normalizeKeyMap=normalizeKeyMap;CodeMirror.StringStream=StringStream;CodeMirror.SharedTextMarker=SharedTextMarker;CodeMirror.TextMarker=TextMarker;CodeMirror.LineWidget=LineWidget;CodeMirror.e_preventDefault=e_preventDefault;CodeMirror.e_stopPropagation=e_stopPropagation;CodeMirror.e_stop=e_stop;CodeMirror.addClass=addClass;CodeMirror.contains=contains;CodeMirror.rmClass=rmClass;CodeMirror.keyNames=keyNames;}
defineOptions(CodeMirror);addEditorMethods(CodeMirror);var dontDelegate="iter insert remove copy getEditor constructor".split(" ");for(var prop in Doc.prototype){if(Doc.prototype.hasOwnProperty(prop)&&indexOf(dontDelegate,prop)<0)
{CodeMirror.prototype[prop]=(function(method){return function(){return method.apply(this.doc,arguments)}})(Doc.prototype[prop]);}}
eventMixin(Doc);CodeMirror.inputStyles={"textarea":TextareaInput,"contenteditable":ContentEditableInput};CodeMirror.defineMode=function(name){if(!CodeMirror.defaults.mode&&name!="null"){CodeMirror.defaults.mode=name;}
defineMode.apply(this,arguments);};CodeMirror.defineMIME=defineMIME;CodeMirror.defineMode("null",function(){return({token:function(stream){return stream.skipToEnd();}});});CodeMirror.defineMIME("text/plain","null");CodeMirror.defineExtension=function(name,func){CodeMirror.prototype[name]=func;};CodeMirror.defineDocExtension=function(name,func){Doc.prototype[name]=func;};CodeMirror.fromTextArea=fromTextArea;addLegacyProps(CodeMirror);CodeMirror.version="5.65.7";return CodeMirror;})));(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror","../xml/xml","../meta"],mod);else
mod(CodeMirror);})(function(CodeMirror){"use strict";CodeMirror.defineMode("markdown",function(cmCfg,modeCfg){var htmlMode=CodeMirror.getMode(cmCfg,"text/html");var htmlModeMissing=htmlMode.name=="null"
function getMode(name){if(CodeMirror.findModeByName){var found=CodeMirror.findModeByName(name);if(found)name=found.mime||found.mimes[0];}
var mode=CodeMirror.getMode(cmCfg,name);return mode.name=="null"?null:mode;}
if(modeCfg.highlightFormatting===undefined)
modeCfg.highlightFormatting=false;if(modeCfg.maxBlockquoteDepth===undefined)
modeCfg.maxBlockquoteDepth=0;if(modeCfg.taskLists===undefined)modeCfg.taskLists=false;if(modeCfg.strikethrough===undefined)
modeCfg.strikethrough=false;if(modeCfg.emoji===undefined)
modeCfg.emoji=false;if(modeCfg.fencedCodeBlockHighlighting===undefined)
modeCfg.fencedCodeBlockHighlighting=true;if(modeCfg.fencedCodeBlockDefaultMode===undefined)
modeCfg.fencedCodeBlockDefaultMode='text/plain';if(modeCfg.xml===undefined)
modeCfg.xml=true;if(modeCfg.tokenTypeOverrides===undefined)
modeCfg.tokenTypeOverrides={};var tokenTypes={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough",emoji:"builtin"};for(var tokenType in tokenTypes){if(tokenTypes.hasOwnProperty(tokenType)&&modeCfg.tokenTypeOverrides[tokenType]){tokenTypes[tokenType]=modeCfg.tokenTypeOverrides[tokenType];}}
var hrRE=/^([*\-_])(?:\s*\1){2,}\s*$/,listRE=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,taskListRE=/^\[(x| )\](?=\s)/i,atxHeaderRE=modeCfg.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,setextHeaderRE=/^ {0,3}(?:\={1,}|-{2,})\s*$/,textRE=/^[^#!\[\]*_\\<>` "'(~:]+/,fencedCodeRE=/^(~~~+|```+)[ \t]*([\w\/+#-]*)[^\n`]*$/,linkDefRE=/^\s*\[[^\]]+?\]:.*$/,punctuation=/[!"#$%&'()*+,\-.\/:;<=>?@\[\\\]^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]/,expandedTab="    "
function switchInline(stream,state,f){state.f=state.inline=f;return f(stream,state);}
function switchBlock(stream,state,f){state.f=state.block=f;return f(stream,state);}
function lineIsEmpty(line){return!line||!/\S/.test(line.string)}
function blankLine(state){state.linkTitle=false;state.linkHref=false;state.linkText=false;state.em=false;state.strong=false;state.strikethrough=false;state.quote=0;state.indentedCode=false;if(state.f==htmlBlock){var exit=htmlModeMissing
if(!exit){var inner=CodeMirror.innerMode(htmlMode,state.htmlState)
exit=inner.mode.name=="xml"&&inner.state.tagStart===null&&(!inner.state.context&&inner.state.tokenize.isInText)}
if(exit){state.f=inlineNormal;state.block=blockNormal;state.htmlState=null;}}
state.trailingSpace=0;state.trailingSpaceNewLine=false;state.prevLine=state.thisLine
state.thisLine={stream:null}
return null;}
function blockNormal(stream,state){var firstTokenOnLine=stream.column()===state.indentation;var prevLineLineIsEmpty=lineIsEmpty(state.prevLine.stream);var prevLineIsIndentedCode=state.indentedCode;var prevLineIsHr=state.prevLine.hr;var prevLineIsList=state.list!==false;var maxNonCodeIndentation=(state.listStack[state.listStack.length-1]||0)+3;state.indentedCode=false;var lineIndentation=state.indentation;if(state.indentationDiff===null){state.indentationDiff=state.indentation;if(prevLineIsList){state.list=null;while(lineIndentation<state.listStack[state.listStack.length-1]){state.listStack.pop();if(state.listStack.length){state.indentation=state.listStack[state.listStack.length-1];}else{state.list=false;}}
if(state.list!==false){state.indentationDiff=lineIndentation-state.listStack[state.listStack.length-1]}}}
var allowsInlineContinuation=(!prevLineLineIsEmpty&&!prevLineIsHr&&!state.prevLine.header&&(!prevLineIsList||!prevLineIsIndentedCode)&&!state.prevLine.fencedCodeEnd);var isHr=(state.list===false||prevLineIsHr||prevLineLineIsEmpty)&&state.indentation<=maxNonCodeIndentation&&stream.match(hrRE);var match=null;if(state.indentationDiff>=4&&(prevLineIsIndentedCode||state.prevLine.fencedCodeEnd||state.prevLine.header||prevLineLineIsEmpty)){stream.skipToEnd();state.indentedCode=true;return tokenTypes.code;}else if(stream.eatSpace()){return null;}else if(firstTokenOnLine&&state.indentation<=maxNonCodeIndentation&&(match=stream.match(atxHeaderRE))&&match[1].length<=6){state.quote=0;state.header=match[1].length;state.thisLine.header=true;if(modeCfg.highlightFormatting)state.formatting="header";state.f=state.inline;return getType(state);}else if(state.indentation<=maxNonCodeIndentation&&stream.eat('>')){state.quote=firstTokenOnLine?1:state.quote+1;if(modeCfg.highlightFormatting)state.formatting="quote";stream.eatSpace();return getType(state);}else if(!isHr&&!state.setext&&firstTokenOnLine&&state.indentation<=maxNonCodeIndentation&&(match=stream.match(listRE))){var listType=match[1]?"ol":"ul";state.indentation=lineIndentation+stream.current().length;state.list=true;state.quote=0;state.listStack.push(state.indentation);state.em=false;state.strong=false;state.code=false;state.strikethrough=false;if(modeCfg.taskLists&&stream.match(taskListRE,false)){state.taskList=true;}
state.f=state.inline;if(modeCfg.highlightFormatting)state.formatting=["list","list-"+listType];return getType(state);}else if(firstTokenOnLine&&state.indentation<=maxNonCodeIndentation&&(match=stream.match(fencedCodeRE,true))){state.quote=0;state.fencedEndRE=new RegExp(match[1]+"+ *$");state.localMode=modeCfg.fencedCodeBlockHighlighting&&getMode(match[2]||modeCfg.fencedCodeBlockDefaultMode);if(state.localMode)state.localState=CodeMirror.startState(state.localMode);state.f=state.block=local;if(modeCfg.highlightFormatting)state.formatting="code-block";state.code=-1
return getType(state);}else if(state.setext||((!allowsInlineContinuation||!prevLineIsList)&&!state.quote&&state.list===false&&!state.code&&!isHr&&!linkDefRE.test(stream.string)&&(match=stream.lookAhead(1))&&(match=match.match(setextHeaderRE)))){if(!state.setext){state.header=match[0].charAt(0)=='='?1:2;state.setext=state.header;}else{state.header=state.setext;state.setext=0;stream.skipToEnd();if(modeCfg.highlightFormatting)state.formatting="header";}
state.thisLine.header=true;state.f=state.inline;return getType(state);}else if(isHr){stream.skipToEnd();state.hr=true;state.thisLine.hr=true;return tokenTypes.hr;}else if(stream.peek()==='['){return switchInline(stream,state,footnoteLink);}
return switchInline(stream,state,state.inline);}
function htmlBlock(stream,state){var style=htmlMode.token(stream,state.htmlState);if(!htmlModeMissing){var inner=CodeMirror.innerMode(htmlMode,state.htmlState)
if((inner.mode.name=="xml"&&inner.state.tagStart===null&&(!inner.state.context&&inner.state.tokenize.isInText))||(state.md_inside&&stream.current().indexOf(">")>-1)){state.f=inlineNormal;state.block=blockNormal;state.htmlState=null;}}
return style;}
function local(stream,state){var currListInd=state.listStack[state.listStack.length-1]||0;var hasExitedList=state.indentation<currListInd;var maxFencedEndInd=currListInd+3;if(state.fencedEndRE&&state.indentation<=maxFencedEndInd&&(hasExitedList||stream.match(state.fencedEndRE))){if(modeCfg.highlightFormatting)state.formatting="code-block";var returnType;if(!hasExitedList)returnType=getType(state)
state.localMode=state.localState=null;state.block=blockNormal;state.f=inlineNormal;state.fencedEndRE=null;state.code=0
state.thisLine.fencedCodeEnd=true;if(hasExitedList)return switchBlock(stream,state,state.block);return returnType;}else if(state.localMode){return state.localMode.token(stream,state.localState);}else{stream.skipToEnd();return tokenTypes.code;}}
function getType(state){var styles=[];if(state.formatting){styles.push(tokenTypes.formatting);if(typeof state.formatting==="string")state.formatting=[state.formatting];for(var i=0;i<state.formatting.length;i++){styles.push(tokenTypes.formatting+"-"+state.formatting[i]);if(state.formatting[i]==="header"){styles.push(tokenTypes.formatting+"-"+state.formatting[i]+"-"+state.header);}
if(state.formatting[i]==="quote"){if(!modeCfg.maxBlockquoteDepth||modeCfg.maxBlockquoteDepth>=state.quote){styles.push(tokenTypes.formatting+"-"+state.formatting[i]+"-"+state.quote);}else{styles.push("error");}}}}
if(state.taskOpen){styles.push("meta");return styles.length?styles.join(' '):null;}
if(state.taskClosed){styles.push("property");return styles.length?styles.join(' '):null;}
if(state.linkHref){styles.push(tokenTypes.linkHref,"url");}else{if(state.strong){styles.push(tokenTypes.strong);}
if(state.em){styles.push(tokenTypes.em);}
if(state.strikethrough){styles.push(tokenTypes.strikethrough);}
if(state.emoji){styles.push(tokenTypes.emoji);}
if(state.linkText){styles.push(tokenTypes.linkText);}
if(state.code){styles.push(tokenTypes.code);}
if(state.image){styles.push(tokenTypes.image);}
if(state.imageAltText){styles.push(tokenTypes.imageAltText,"link");}
if(state.imageMarker){styles.push(tokenTypes.imageMarker);}}
if(state.header){styles.push(tokenTypes.header,tokenTypes.header+"-"+state.header);}
if(state.quote){styles.push(tokenTypes.quote);if(!modeCfg.maxBlockquoteDepth||modeCfg.maxBlockquoteDepth>=state.quote){styles.push(tokenTypes.quote+"-"+state.quote);}else{styles.push(tokenTypes.quote+"-"+modeCfg.maxBlockquoteDepth);}}
if(state.list!==false){var listMod=(state.listStack.length-1)%3;if(!listMod){styles.push(tokenTypes.list1);}else if(listMod===1){styles.push(tokenTypes.list2);}else{styles.push(tokenTypes.list3);}}
if(state.trailingSpaceNewLine){styles.push("trailing-space-new-line");}else if(state.trailingSpace){styles.push("trailing-space-"+(state.trailingSpace%2?"a":"b"));}
return styles.length?styles.join(' '):null;}
function handleText(stream,state){if(stream.match(textRE,true)){return getType(state);}
return undefined;}
function inlineNormal(stream,state){var style=state.text(stream,state);if(typeof style!=='undefined')
return style;if(state.list){state.list=null;return getType(state);}
if(state.taskList){var taskOpen=stream.match(taskListRE,true)[1]===" ";if(taskOpen)state.taskOpen=true;else state.taskClosed=true;if(modeCfg.highlightFormatting)state.formatting="task";state.taskList=false;return getType(state);}
state.taskOpen=false;state.taskClosed=false;if(state.header&&stream.match(/^#+$/,true)){if(modeCfg.highlightFormatting)state.formatting="header";return getType(state);}
var ch=stream.next();if(state.linkTitle){state.linkTitle=false;var matchCh=ch;if(ch==='('){matchCh=')';}
matchCh=(matchCh+'').replace(/([.?*+^\[\]\\(){}|-])/g,"\\$1");var regex='^\\s*(?:[^'+matchCh+'\\\\]+|\\\\\\\\|\\\\.)'+matchCh;if(stream.match(new RegExp(regex),true)){return tokenTypes.linkHref;}}
if(ch==='`'){var previousFormatting=state.formatting;if(modeCfg.highlightFormatting)state.formatting="code";stream.eatWhile('`');var count=stream.current().length
if(state.code==0&&(!state.quote||count==1)){state.code=count
return getType(state)}else if(count==state.code){var t=getType(state)
state.code=0
return t}else{state.formatting=previousFormatting
return getType(state)}}else if(state.code){return getType(state);}
if(ch==='\\'){stream.next();if(modeCfg.highlightFormatting){var type=getType(state);var formattingEscape=tokenTypes.formatting+"-escape";return type?type+" "+formattingEscape:formattingEscape;}}
if(ch==='!'&&stream.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){state.imageMarker=true;state.image=true;if(modeCfg.highlightFormatting)state.formatting="image";return getType(state);}
if(ch==='['&&state.imageMarker&&stream.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,false)){state.imageMarker=false;state.imageAltText=true
if(modeCfg.highlightFormatting)state.formatting="image";return getType(state);}
if(ch===']'&&state.imageAltText){if(modeCfg.highlightFormatting)state.formatting="image";var type=getType(state);state.imageAltText=false;state.image=false;state.inline=state.f=linkHref;return type;}
if(ch==='['&&!state.image){if(state.linkText&&stream.match(/^.*?\]/))return getType(state)
state.linkText=true;if(modeCfg.highlightFormatting)state.formatting="link";return getType(state);}
if(ch===']'&&state.linkText){if(modeCfg.highlightFormatting)state.formatting="link";var type=getType(state);state.linkText=false;state.inline=state.f=stream.match(/\(.*?\)| ?\[.*?\]/,false)?linkHref:inlineNormal
return type;}
if(ch==='<'&&stream.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){state.f=state.inline=linkInline;if(modeCfg.highlightFormatting)state.formatting="link";var type=getType(state);if(type){type+=" ";}else{type="";}
return type+tokenTypes.linkInline;}
if(ch==='<'&&stream.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){state.f=state.inline=linkInline;if(modeCfg.highlightFormatting)state.formatting="link";var type=getType(state);if(type){type+=" ";}else{type="";}
return type+tokenTypes.linkEmail;}
if(modeCfg.xml&&ch==='<'&&stream.match(/^(!--|\?|!\[CDATA\[|[a-z][a-z0-9-]*(?:\s+[a-z_:.\-]+(?:\s*=\s*[^>]+)?)*\s*(?:>|$))/i,false)){var end=stream.string.indexOf(">",stream.pos);if(end!=-1){var atts=stream.string.substring(stream.start,end);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(atts))state.md_inside=true;}
stream.backUp(1);state.htmlState=CodeMirror.startState(htmlMode);return switchBlock(stream,state,htmlBlock);}
if(modeCfg.xml&&ch==='<'&&stream.match(/^\/\w*?>/)){state.md_inside=false;return"tag";}else if(ch==="*"||ch==="_"){var len=1,before=stream.pos==1?" ":stream.string.charAt(stream.pos-2)
while(len<3&&stream.eat(ch))len++
var after=stream.peek()||" "
var leftFlanking=!/\s/.test(after)&&(!punctuation.test(after)||/\s/.test(before)||punctuation.test(before))
var rightFlanking=!/\s/.test(before)&&(!punctuation.test(before)||/\s/.test(after)||punctuation.test(after))
var setEm=null,setStrong=null
if(len%2){if(!state.em&&leftFlanking&&(ch==="*"||!rightFlanking||punctuation.test(before)))
setEm=true
else if(state.em==ch&&rightFlanking&&(ch==="*"||!leftFlanking||punctuation.test(after)))
setEm=false}
if(len>1){if(!state.strong&&leftFlanking&&(ch==="*"||!rightFlanking||punctuation.test(before)))
setStrong=true
else if(state.strong==ch&&rightFlanking&&(ch==="*"||!leftFlanking||punctuation.test(after)))
setStrong=false}
if(setStrong!=null||setEm!=null){if(modeCfg.highlightFormatting)state.formatting=setEm==null?"strong":setStrong==null?"em":"strong em"
if(setEm===true)state.em=ch
if(setStrong===true)state.strong=ch
var t=getType(state)
if(setEm===false)state.em=false
if(setStrong===false)state.strong=false
return t}}else if(ch===' '){if(stream.eat('*')||stream.eat('_')){if(stream.peek()===' '){return getType(state);}else{stream.backUp(1);}}}
if(modeCfg.strikethrough){if(ch==='~'&&stream.eatWhile(ch)){if(state.strikethrough){if(modeCfg.highlightFormatting)state.formatting="strikethrough";var t=getType(state);state.strikethrough=false;return t;}else if(stream.match(/^[^\s]/,false)){state.strikethrough=true;if(modeCfg.highlightFormatting)state.formatting="strikethrough";return getType(state);}}else if(ch===' '){if(stream.match('~~',true)){if(stream.peek()===' '){return getType(state);}else{stream.backUp(2);}}}}
if(modeCfg.emoji&&ch===":"&&stream.match(/^(?:[a-z_\d+][a-z_\d+-]*|\-[a-z_\d+][a-z_\d+-]*):/)){state.emoji=true;if(modeCfg.highlightFormatting)state.formatting="emoji";var retType=getType(state);state.emoji=false;return retType;}
if(ch===' '){if(stream.match(/^ +$/,false)){state.trailingSpace++;}else if(state.trailingSpace){state.trailingSpaceNewLine=true;}}
return getType(state);}
function linkInline(stream,state){var ch=stream.next();if(ch===">"){state.f=state.inline=inlineNormal;if(modeCfg.highlightFormatting)state.formatting="link";var type=getType(state);if(type){type+=" ";}else{type="";}
return type+tokenTypes.linkInline;}
stream.match(/^[^>]+/,true);return tokenTypes.linkInline;}
function linkHref(stream,state){if(stream.eatSpace()){return null;}
var ch=stream.next();if(ch==='('||ch==='['){state.f=state.inline=getLinkHrefInside(ch==="("?")":"]");if(modeCfg.highlightFormatting)state.formatting="link-string";state.linkHref=true;return getType(state);}
return'error';}
var linkRE={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\]]|\\.)*\])*?(?=\])/}
function getLinkHrefInside(endChar){return function(stream,state){var ch=stream.next();if(ch===endChar){state.f=state.inline=inlineNormal;if(modeCfg.highlightFormatting)state.formatting="link-string";var returnState=getType(state);state.linkHref=false;return returnState;}
stream.match(linkRE[endChar])
state.linkHref=true;return getType(state);};}
function footnoteLink(stream,state){if(stream.match(/^([^\]\\]|\\.)*\]:/,false)){state.f=footnoteLinkInside;stream.next();if(modeCfg.highlightFormatting)state.formatting="link";state.linkText=true;return getType(state);}
return switchInline(stream,state,inlineNormal);}
function footnoteLinkInside(stream,state){if(stream.match(']:',true)){state.f=state.inline=footnoteUrl;if(modeCfg.highlightFormatting)state.formatting="link";var returnType=getType(state);state.linkText=false;return returnType;}
stream.match(/^([^\]\\]|\\.)+/,true);return tokenTypes.linkText;}
function footnoteUrl(stream,state){if(stream.eatSpace()){return null;}
stream.match(/^[^\s]+/,true);if(stream.peek()===undefined){state.linkTitle=true;}else{stream.match(/^(?:\s+(?:"(?:[^"\\]|\\.)+"|'(?:[^'\\]|\\.)+'|\((?:[^)\\]|\\.)+\)))?/,true);}
state.f=state.inline=inlineNormal;return tokenTypes.linkHref+" url";}
var mode={startState:function(){return{f:blockNormal,prevLine:{stream:null},thisLine:{stream:null},block:blockNormal,htmlState:null,indentation:0,inline:inlineNormal,text:handleText,formatting:false,linkText:false,linkHref:false,linkTitle:false,code:0,em:false,strong:false,header:0,setext:0,hr:false,taskList:false,list:false,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false,emoji:false,fencedEndRE:null};},copyState:function(s){return{f:s.f,prevLine:s.prevLine,thisLine:s.thisLine,block:s.block,htmlState:s.htmlState&&CodeMirror.copyState(htmlMode,s.htmlState),indentation:s.indentation,localMode:s.localMode,localState:s.localMode?CodeMirror.copyState(s.localMode,s.localState):null,inline:s.inline,text:s.text,formatting:false,linkText:s.linkText,linkTitle:s.linkTitle,linkHref:s.linkHref,code:s.code,em:s.em,strong:s.strong,strikethrough:s.strikethrough,emoji:s.emoji,header:s.header,setext:s.setext,hr:s.hr,taskList:s.taskList,list:s.list,listStack:s.listStack.slice(0),quote:s.quote,indentedCode:s.indentedCode,trailingSpace:s.trailingSpace,trailingSpaceNewLine:s.trailingSpaceNewLine,md_inside:s.md_inside,fencedEndRE:s.fencedEndRE};},token:function(stream,state){state.formatting=false;if(stream!=state.thisLine.stream){state.header=0;state.hr=false;if(stream.match(/^\s*$/,true)){blankLine(state);return null;}
state.prevLine=state.thisLine
state.thisLine={stream:stream}
state.taskList=false;state.trailingSpace=0;state.trailingSpaceNewLine=false;if(!state.localState){state.f=state.block;if(state.f!=htmlBlock){var indentation=stream.match(/^\s*/,true)[0].replace(/\t/g,expandedTab).length;state.indentation=indentation;state.indentationDiff=null;if(indentation>0)return null;}}}
return state.f(stream,state);},innerMode:function(state){if(state.block==htmlBlock)return{state:state.htmlState,mode:htmlMode};if(state.localState)return{state:state.localState,mode:state.localMode};return{state:state,mode:mode};},indent:function(state,textAfter,line){if(state.block==htmlBlock&&htmlMode.indent)return htmlMode.indent(state.htmlState,textAfter,line)
if(state.localState&&state.localMode.indent)return state.localMode.indent(state.localState,textAfter,line)
return CodeMirror.Pass},blankLine:blankLine,getType:getType,blockCommentStart:"<!--",blockCommentEnd:"-->",closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return mode;},"xml");CodeMirror.defineMIME("text/markdown","markdown");CodeMirror.defineMIME("text/x-markdown","markdown");});(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],mod);else
mod(CodeMirror);})(function(CodeMirror){"use strict";CodeMirror.defineOption("search",{bottom:false});function searchOverlay(query,caseInsensitive){if(typeof query=="string")
query=new RegExp(query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),caseInsensitive?"gi":"g");else if(!query.global)
query=new RegExp(query.source,query.ignoreCase?"gi":"g");return{token:function(stream){query.lastIndex=stream.pos;var match=query.exec(stream.string);if(match&&match.index==stream.pos){stream.pos+=match[0].length||1;return"searching";}else if(match){stream.pos=match.index;}else{stream.skipToEnd();}}};}
function SearchState(){this.posFrom=this.posTo=this.lastQuery=this.query=null;this.overlay=null;}
function getSearchState(cm){return cm.state.search||(cm.state.search=new SearchState());}
function queryCaseInsensitive(query){return typeof query=="string"&&query==query.toLowerCase();}
function getSearchCursor(cm,query,pos){return cm.getSearchCursor(query,pos,{caseFold:queryCaseInsensitive(query),multiline:true});}
function persistentDialog(cm,text,deflt,onEnter,onKeyDown){cm.openDialog(text,onEnter,{value:deflt,selectValueOnOpen:true,closeOnEnter:false,onClose:function(){clearSearch(cm);},onKeyDown:onKeyDown,bottom:cm.options.search.bottom});}
function dialog(cm,text,shortText,deflt,f){if(cm.openDialog)cm.openDialog(text,f,{value:deflt,selectValueOnOpen:true,bottom:cm.options.search.bottom});else f(prompt(shortText,deflt));}
function confirmDialog(cm,text,shortText,fs){if(cm.openConfirm)cm.openConfirm(text,fs);else if(confirm(shortText))fs[0]();}
function parseString(string){return string.replace(/\\([nrt\\])/g,function(match,ch){if(ch=="n")return"\n"
if(ch=="r")return"\r"
if(ch=="t")return"\t"
if(ch=="\\")return"\\"
return match})}
function parseQuery(query){var isRE=query.match(/^\/(.*)\/([a-z]*)$/);if(isRE){try{query=new RegExp(isRE[1],isRE[2].indexOf("i")==-1?"":"i");}
catch(e){}}else{query=parseString(query)}
if(typeof query=="string"?query=="":query.test(""))
query=/x^/;return query;}
function startSearch(cm,state,query){state.queryText=query;state.query=parseQuery(query);cm.removeOverlay(state.overlay,queryCaseInsensitive(state.query));state.overlay=searchOverlay(state.query,queryCaseInsensitive(state.query));cm.addOverlay(state.overlay);if(cm.showMatchesOnScrollbar){if(state.annotate){state.annotate.clear();state.annotate=null;}
state.annotate=cm.showMatchesOnScrollbar(state.query,queryCaseInsensitive(state.query));}}
function doSearch(cm,rev,persistent,immediate){var state=getSearchState(cm);if(state.query)return findNext(cm,rev);var q=cm.getSelection()||state.lastQuery;if(q instanceof RegExp&&q.source=="x^")q=null
if(persistent&&cm.openDialog){var hiding=null
var searchNext=function(query,event){CodeMirror.e_stop(event);if(!query)return;if(query!=state.queryText){startSearch(cm,state,query);state.posFrom=state.posTo=cm.getCursor();}
if(hiding)hiding.style.opacity=1
findNext(cm,event.shiftKey,function(_,to){var dialog
if(to.line<3&&document.querySelector&&(dialog=cm.display.wrapper.querySelector(".CodeMirror-dialog"))&&dialog.getBoundingClientRect().bottom-4>cm.cursorCoords(to,"window").top)
(hiding=dialog).style.opacity=.4})};persistentDialog(cm,getQueryDialog(cm),q,searchNext,function(event,query){var keyName=CodeMirror.keyName(event)
var extra=cm.getOption('extraKeys'),cmd=(extra&&extra[keyName])||CodeMirror.keyMap[cm.getOption("keyMap")][keyName]
if(cmd=="findNext"||cmd=="findPrev"||cmd=="findPersistentNext"||cmd=="findPersistentPrev"){CodeMirror.e_stop(event);startSearch(cm,getSearchState(cm),query);cm.execCommand(cmd);}else if(cmd=="find"||cmd=="findPersistent"){CodeMirror.e_stop(event);searchNext(query,event);}});if(immediate&&q){startSearch(cm,state,q);findNext(cm,rev);}}else{dialog(cm,getQueryDialog(cm),"Search for:",q,function(query){if(query&&!state.query)cm.operation(function(){startSearch(cm,state,query);state.posFrom=state.posTo=cm.getCursor();findNext(cm,rev);});});}}
function findNext(cm,rev,callback){cm.operation(function(){var state=getSearchState(cm);var cursor=getSearchCursor(cm,state.query,rev?state.posFrom:state.posTo);if(!cursor.find(rev)){cursor=getSearchCursor(cm,state.query,rev?CodeMirror.Pos(cm.lastLine()):CodeMirror.Pos(cm.firstLine(),0));if(!cursor.find(rev))return;}
cm.setSelection(cursor.from(),cursor.to());cm.scrollIntoView({from:cursor.from(),to:cursor.to()},20);state.posFrom=cursor.from();state.posTo=cursor.to();if(callback)callback(cursor.from(),cursor.to())});}
function clearSearch(cm){cm.operation(function(){var state=getSearchState(cm);state.lastQuery=state.query;if(!state.query)return;state.query=state.queryText=null;cm.removeOverlay(state.overlay);if(state.annotate){state.annotate.clear();state.annotate=null;}});}
function el(tag,attrs){var element=tag?document.createElement(tag):document.createDocumentFragment();for(var key in attrs){element[key]=attrs[key];}
for(var i=2;i<arguments.length;i++){var child=arguments[i]
element.appendChild(typeof child=="string"?document.createTextNode(child):child);}
return element;}
function getQueryDialog(cm){var label=el("label",{className:"CodeMirror-search-label"},cm.phrase("Search:"),el("input",{type:"text","style":"width: 10em",className:"CodeMirror-search-field",id:"CodeMirror-search-field"}));label.setAttribute("for","CodeMirror-search-field");return el("",null,label," ",el("span",{style:"color: #666",className:"CodeMirror-search-hint"},cm.phrase("(Use /re/ syntax for regexp search)")));}
function getReplaceQueryDialog(cm){return el("",null," ",el("input",{type:"text","style":"width: 10em",className:"CodeMirror-search-field"})," ",el("span",{style:"color: #666",className:"CodeMirror-search-hint"},cm.phrase("(Use /re/ syntax for regexp search)")));}
function getReplacementQueryDialog(cm){return el("",null,el("span",{className:"CodeMirror-search-label"},cm.phrase("With:"))," ",el("input",{type:"text","style":"width: 10em",className:"CodeMirror-search-field"}));}
function getDoReplaceConfirm(cm){return el("",null,el("span",{className:"CodeMirror-search-label"},cm.phrase("Replace?"))," ",el("button",{},cm.phrase("Yes"))," ",el("button",{},cm.phrase("No"))," ",el("button",{},cm.phrase("All"))," ",el("button",{},cm.phrase("Stop")));}
function replaceAll(cm,query,text){cm.operation(function(){for(var cursor=getSearchCursor(cm,query);cursor.findNext();){if(typeof query!="string"){var match=cm.getRange(cursor.from(),cursor.to()).match(query);cursor.replace(text.replace(/\$(\d)/g,function(_,i){return match[i];}));}else cursor.replace(text);}});}
function replace(cm,all){if(cm.getOption("readOnly"))return;var query=cm.getSelection()||getSearchState(cm).lastQuery;var dialogText=all?cm.phrase("Replace all:"):cm.phrase("Replace:")
var fragment=el("",null,el("span",{className:"CodeMirror-search-label"},dialogText),getReplaceQueryDialog(cm))
dialog(cm,fragment,dialogText,query,function(query){if(!query)return;query=parseQuery(query);dialog(cm,getReplacementQueryDialog(cm),cm.phrase("Replace with:"),"",function(text){text=parseString(text)
if(all){replaceAll(cm,query,text)}else{clearSearch(cm);var cursor=getSearchCursor(cm,query,cm.getCursor("from"));var advance=function(){var start=cursor.from(),match;if(!(match=cursor.findNext())){cursor=getSearchCursor(cm,query);if(!(match=cursor.findNext())||(start&&cursor.from().line==start.line&&cursor.from().ch==start.ch))return;}
cm.setSelection(cursor.from(),cursor.to());cm.scrollIntoView({from:cursor.from(),to:cursor.to()});confirmDialog(cm,getDoReplaceConfirm(cm),cm.phrase("Replace?"),[function(){doReplace(match);},advance,function(){replaceAll(cm,query,text)}]);};var doReplace=function(match){cursor.replace(typeof query=="string"?text:text.replace(/\$(\d)/g,function(_,i){return match[i];}));advance();};advance();}});});}
CodeMirror.commands.find=function(cm){clearSearch(cm);doSearch(cm);};CodeMirror.commands.findPersistent=function(cm){clearSearch(cm);doSearch(cm,false,true);};CodeMirror.commands.findPersistentNext=function(cm){doSearch(cm,false,true,true);};CodeMirror.commands.findPersistentPrev=function(cm){doSearch(cm,true,true,true);};CodeMirror.commands.findNext=doSearch;CodeMirror.commands.findPrev=function(cm){doSearch(cm,true);};CodeMirror.commands.clearSearch=clearSearch;CodeMirror.commands.replace=replace;CodeMirror.commands.replaceAll=function(cm){replace(cm,true);};});(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"))
else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror"],mod)
else
mod(CodeMirror)})(function(CodeMirror){"use strict"
var Pos=CodeMirror.Pos
function regexpFlags(regexp){var flags=regexp.flags
return flags!=null?flags:(regexp.ignoreCase?"i":"")
+(regexp.global?"g":"")
+(regexp.multiline?"m":"")}
function ensureFlags(regexp,flags){var current=regexpFlags(regexp),target=current
for(var i=0;i<flags.length;i++)if(target.indexOf(flags.charAt(i))==-1)
target+=flags.charAt(i)
return current==target?regexp:new RegExp(regexp.source,target)}
function maybeMultiline(regexp){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(regexp.source)}
function searchRegexpForward(doc,regexp,start){regexp=ensureFlags(regexp,"g")
for(var line=start.line,ch=start.ch,last=doc.lastLine();line<=last;line++,ch=0){regexp.lastIndex=ch
var string=doc.getLine(line),match=regexp.exec(string)
if(match)
return{from:Pos(line,match.index),to:Pos(line,match.index+match[0].length),match:match}}}
function searchRegexpForwardMultiline(doc,regexp,start){if(!maybeMultiline(regexp))return searchRegexpForward(doc,regexp,start)
regexp=ensureFlags(regexp,"gm")
var string,chunk=1
for(var line=start.line,last=doc.lastLine();line<=last;){for(var i=0;i<chunk;i++){if(line>last)break
var curLine=doc.getLine(line++)
string=string==null?curLine:string+"\n"+curLine}
chunk=chunk*2
regexp.lastIndex=start.ch
var match=regexp.exec(string)
if(match){var before=string.slice(0,match.index).split("\n"),inside=match[0].split("\n")
var startLine=start.line+before.length-1,startCh=before[before.length-1].length
return{from:Pos(startLine,startCh),to:Pos(startLine+inside.length-1,inside.length==1?startCh+inside[0].length:inside[inside.length-1].length),match:match}}}}
function lastMatchIn(string,regexp,endMargin){var match,from=0
while(from<=string.length){regexp.lastIndex=from
var newMatch=regexp.exec(string)
if(!newMatch)break
var end=newMatch.index+newMatch[0].length
if(end>string.length-endMargin)break
if(!match||end>match.index+match[0].length)
match=newMatch
from=newMatch.index+1}
return match}
function searchRegexpBackward(doc,regexp,start){regexp=ensureFlags(regexp,"g")
for(var line=start.line,ch=start.ch,first=doc.firstLine();line>=first;line--,ch=-1){var string=doc.getLine(line)
var match=lastMatchIn(string,regexp,ch<0?0:string.length-ch)
if(match)
return{from:Pos(line,match.index),to:Pos(line,match.index+match[0].length),match:match}}}
function searchRegexpBackwardMultiline(doc,regexp,start){if(!maybeMultiline(regexp))return searchRegexpBackward(doc,regexp,start)
regexp=ensureFlags(regexp,"gm")
var string,chunkSize=1,endMargin=doc.getLine(start.line).length-start.ch
for(var line=start.line,first=doc.firstLine();line>=first;){for(var i=0;i<chunkSize&&line>=first;i++){var curLine=doc.getLine(line--)
string=string==null?curLine:curLine+"\n"+string}
chunkSize*=2
var match=lastMatchIn(string,regexp,endMargin)
if(match){var before=string.slice(0,match.index).split("\n"),inside=match[0].split("\n")
var startLine=line+before.length,startCh=before[before.length-1].length
return{from:Pos(startLine,startCh),to:Pos(startLine+inside.length-1,inside.length==1?startCh+inside[0].length:inside[inside.length-1].length),match:match}}}}
var doFold,noFold
if(String.prototype.normalize){doFold=function(str){return str.normalize("NFD").toLowerCase()}
noFold=function(str){return str.normalize("NFD")}}else{doFold=function(str){return str.toLowerCase()}
noFold=function(str){return str}}
function adjustPos(orig,folded,pos,foldFunc){if(orig.length==folded.length)return pos
for(var min=0,max=pos+Math.max(0,orig.length-folded.length);;){if(min==max)return min
var mid=(min+max)>>1
var len=foldFunc(orig.slice(0,mid)).length
if(len==pos)return mid
else if(len>pos)max=mid
else min=mid+1}}
function searchStringForward(doc,query,start,caseFold){if(!query.length)return null
var fold=caseFold?doFold:noFold
var lines=fold(query).split(/\r|\n\r?/)
search:for(var line=start.line,ch=start.ch,last=doc.lastLine()+1-lines.length;line<=last;line++,ch=0){var orig=doc.getLine(line).slice(ch),string=fold(orig)
if(lines.length==1){var found=string.indexOf(lines[0])
if(found==-1)continue search
var start=adjustPos(orig,string,found,fold)+ch
return{from:Pos(line,adjustPos(orig,string,found,fold)+ch),to:Pos(line,adjustPos(orig,string,found+lines[0].length,fold)+ch)}}else{var cutFrom=string.length-lines[0].length
if(string.slice(cutFrom)!=lines[0])continue search
for(var i=1;i<lines.length-1;i++)
if(fold(doc.getLine(line+i))!=lines[i])continue search
var end=doc.getLine(line+lines.length-1),endString=fold(end),lastLine=lines[lines.length-1]
if(endString.slice(0,lastLine.length)!=lastLine)continue search
return{from:Pos(line,adjustPos(orig,string,cutFrom,fold)+ch),to:Pos(line+lines.length-1,adjustPos(end,endString,lastLine.length,fold))}}}}
function searchStringBackward(doc,query,start,caseFold){if(!query.length)return null
var fold=caseFold?doFold:noFold
var lines=fold(query).split(/\r|\n\r?/)
search:for(var line=start.line,ch=start.ch,first=doc.firstLine()-1+lines.length;line>=first;line--,ch=-1){var orig=doc.getLine(line)
if(ch>-1)orig=orig.slice(0,ch)
var string=fold(orig)
if(lines.length==1){var found=string.lastIndexOf(lines[0])
if(found==-1)continue search
return{from:Pos(line,adjustPos(orig,string,found,fold)),to:Pos(line,adjustPos(orig,string,found+lines[0].length,fold))}}else{var lastLine=lines[lines.length-1]
if(string.slice(0,lastLine.length)!=lastLine)continue search
for(var i=1,start=line-lines.length+1;i<lines.length-1;i++)
if(fold(doc.getLine(start+i))!=lines[i])continue search
var top=doc.getLine(line+1-lines.length),topString=fold(top)
if(topString.slice(topString.length-lines[0].length)!=lines[0])continue search
return{from:Pos(line+1-lines.length,adjustPos(top,topString,top.length-lines[0].length,fold)),to:Pos(line,adjustPos(orig,string,lastLine.length,fold))}}}}
function SearchCursor(doc,query,pos,options){this.atOccurrence=false
this.afterEmptyMatch=false
this.doc=doc
pos=pos?doc.clipPos(pos):Pos(0,0)
this.pos={from:pos,to:pos}
var caseFold
if(typeof options=="object"){caseFold=options.caseFold}else{caseFold=options
options=null}
if(typeof query=="string"){if(caseFold==null)caseFold=false
this.matches=function(reverse,pos){return(reverse?searchStringBackward:searchStringForward)(doc,query,pos,caseFold)}}else{query=ensureFlags(query,"gm")
if(!options||options.multiline!==false)
this.matches=function(reverse,pos){return(reverse?searchRegexpBackwardMultiline:searchRegexpForwardMultiline)(doc,query,pos)}
else
this.matches=function(reverse,pos){return(reverse?searchRegexpBackward:searchRegexpForward)(doc,query,pos)}}}
SearchCursor.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(reverse){var head=this.doc.clipPos(reverse?this.pos.from:this.pos.to);if(this.afterEmptyMatch&&this.atOccurrence){head=Pos(head.line,head.ch)
if(reverse){head.ch--;if(head.ch<0){head.line--;head.ch=(this.doc.getLine(head.line)||"").length;}}else{head.ch++;if(head.ch>(this.doc.getLine(head.line)||"").length){head.ch=0;head.line++;}}
if(CodeMirror.cmpPos(head,this.doc.clipPos(head))!=0){return this.atOccurrence=false}}
var result=this.matches(reverse,head)
this.afterEmptyMatch=result&&CodeMirror.cmpPos(result.from,result.to)==0
if(result){this.pos=result
this.atOccurrence=true
return this.pos.match||true}else{var end=Pos(reverse?this.doc.firstLine():this.doc.lastLine()+1,0)
this.pos={from:end,to:end}
return this.atOccurrence=false}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(newText,origin){if(!this.atOccurrence)return
var lines=CodeMirror.splitLines(newText)
this.doc.replaceRange(lines,this.pos.from,this.pos.to,origin)
this.pos.to=Pos(this.pos.from.line+lines.length-1,lines[lines.length-1].length+(lines.length==1?this.pos.from.ch:0))}}
CodeMirror.defineExtension("getSearchCursor",function(query,pos,caseFold){return new SearchCursor(this.doc,query,pos,caseFold)})
CodeMirror.defineDocExtension("getSearchCursor",function(query,pos,caseFold){return new SearchCursor(this,query,pos,caseFold)})
CodeMirror.defineExtension("selectMatches",function(query,caseFold){var ranges=[]
var cur=this.getSearchCursor(query,this.getCursor("from"),caseFold)
while(cur.findNext()){if(CodeMirror.cmpPos(cur.to(),this.getCursor("to"))>0)break
ranges.push({anchor:cur.from(),head:cur.to()})}
if(ranges.length)
this.setSelections(ranges,0)})});(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"),require("../dialog/dialog"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror","../dialog/dialog"],mod);else
mod(CodeMirror);})(function(CodeMirror){"use strict";CodeMirror.defineOption("search",{bottom:false});function dialog(cm,text,shortText,deflt,f){if(cm.openDialog)cm.openDialog(text,f,{value:deflt,selectValueOnOpen:true,bottom:cm.options.search.bottom});else f(prompt(shortText,deflt));}
function getJumpDialog(cm){return cm.phrase("Jump to line:")+' <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">'+cm.phrase("(Use line:column or scroll% syntax)")+'</span>';}
function interpretLine(cm,string){var num=Number(string)
if(/^[-+]/.test(string))return cm.getCursor().line+num
else return num-1}
CodeMirror.commands.jumpToLine=function(cm){var cur=cm.getCursor();dialog(cm,getJumpDialog(cm),cm.phrase("Jump to line:"),(cur.line+1)+":"+cur.ch,function(posStr){if(!posStr)return;var match;if(match=/^\s*([\+\-]?\d+)\s*\:\s*(\d+)\s*$/.exec(posStr)){cm.setCursor(interpretLine(cm,match[1]),Number(match[2]))}else if(match=/^\s*([\+\-]?\d+(\.\d+)?)\%\s*/.exec(posStr)){var line=Math.round(cm.lineCount()*Number(match[1])/100);if(/^[-+]/.test(match[1]))line=cur.line+line+1;cm.setCursor(line-1,cur.ch);}else if(match=/^\s*\:?\s*([\+\-]?\d+)\s*/.exec(posStr)){cm.setCursor(interpretLine(cm,match[1]),cur.ch);}});};CodeMirror.keyMap["default"]["Alt-G"]="jumpToLine";});(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror"],mod);else
mod(CodeMirror);})(function(CodeMirror){function dialogDiv(cm,template,bottom){var wrap=cm.getWrapperElement();var dialog;dialog=wrap.appendChild(document.createElement("div"));if(bottom)
dialog.className="CodeMirror-dialog CodeMirror-dialog-bottom";else
dialog.className="CodeMirror-dialog CodeMirror-dialog-top";if(typeof template=="string"){dialog.innerHTML=template;}else{dialog.appendChild(template);}
CodeMirror.addClass(wrap,'dialog-opened');return dialog;}
function closeNotification(cm,newVal){if(cm.state.currentNotificationClose)
cm.state.currentNotificationClose();cm.state.currentNotificationClose=newVal;}
CodeMirror.defineExtension("openDialog",function(template,callback,options){if(!options)options={};closeNotification(this,null);var dialog=dialogDiv(this,template,options.bottom);var closed=false,me=this;function close(newVal){if(typeof newVal=='string'){inp.value=newVal;}else{if(closed)return;closed=true;CodeMirror.rmClass(dialog.parentNode,'dialog-opened');dialog.parentNode.removeChild(dialog);me.focus();if(options.onClose)options.onClose(dialog);}}
var inp=dialog.getElementsByTagName("input")[0],button;if(inp){inp.focus();if(options.value){inp.value=options.value;if(options.selectValueOnOpen!==false){inp.select();}}
if(options.onInput)
CodeMirror.on(inp,"input",function(e){options.onInput(e,inp.value,close);});if(options.onKeyUp)
CodeMirror.on(inp,"keyup",function(e){options.onKeyUp(e,inp.value,close);});CodeMirror.on(inp,"keydown",function(e){if(options&&options.onKeyDown&&options.onKeyDown(e,inp.value,close)){return;}
if(e.keyCode==27||(options.closeOnEnter!==false&&e.keyCode==13)){inp.blur();CodeMirror.e_stop(e);close();}
if(e.keyCode==13)callback(inp.value,e);});if(options.closeOnBlur!==false)CodeMirror.on(dialog,"focusout",function(evt){if(evt.relatedTarget!==null)close();});}else if(button=dialog.getElementsByTagName("button")[0]){CodeMirror.on(button,"click",function(){close();me.focus();});if(options.closeOnBlur!==false)CodeMirror.on(button,"blur",close);button.focus();}
return close;});CodeMirror.defineExtension("openConfirm",function(template,callbacks,options){closeNotification(this,null);var dialog=dialogDiv(this,template,options&&options.bottom);var buttons=dialog.getElementsByTagName("button");var closed=false,me=this,blurring=1;function close(){if(closed)return;closed=true;CodeMirror.rmClass(dialog.parentNode,'dialog-opened');dialog.parentNode.removeChild(dialog);me.focus();}
buttons[0].focus();for(var i=0;i<buttons.length;++i){var b=buttons[i];(function(callback){CodeMirror.on(b,"click",function(e){CodeMirror.e_preventDefault(e);close();if(callback)callback(me);});})(callbacks[i]);CodeMirror.on(b,"blur",function(){--blurring;setTimeout(function(){if(blurring<=0)close();},200);});CodeMirror.on(b,"focus",function(){++blurring;});}});CodeMirror.defineExtension("openNotification",function(template,options){closeNotification(this,close);var dialog=dialogDiv(this,template,options&&options.bottom);var closed=false,doneTimer;var duration=options&&typeof options.duration!=="undefined"?options.duration:5000;function close(){if(closed)return;closed=true;clearTimeout(doneTimer);CodeMirror.rmClass(dialog.parentNode,'dialog-opened');dialog.parentNode.removeChild(dialog);}
CodeMirror.on(dialog,'click',function(e){CodeMirror.e_preventDefault(e);close();});if(duration)
doneTimer=setTimeout(close,duration);return close;});});(function(mod){if(typeof exports=="object"&&typeof module=="object")
mod(require("../../lib/codemirror"));else if(typeof define=="function"&&define.amd)
define(["../../lib/codemirror"],mod);else
mod(CodeMirror);})(function(CodeMirror){"use strict";CodeMirror.defineExtension("annotateScrollbar",function(options){if(typeof options=="string")options={className:options};return new Annotation(this,options);});CodeMirror.defineOption("scrollButtonHeight",0);function Annotation(cm,options){this.cm=cm;this.options=options;this.buttonHeight=options.scrollButtonHeight||cm.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=cm.getWrapperElement().appendChild(document.createElement("div"));this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();function scheduleRedraw(delay){clearTimeout(self.doRedraw);self.doRedraw=setTimeout(function(){self.redraw();},delay);}
var self=this;cm.on("refresh",this.resizeHandler=function(){clearTimeout(self.doUpdate);self.doUpdate=setTimeout(function(){if(self.computeScale())scheduleRedraw(20);},100);});cm.on("markerAdded",this.resizeHandler);cm.on("markerCleared",this.resizeHandler);if(options.listenForChanges!==false)
cm.on("changes",this.changeHandler=function(){scheduleRedraw(250);});}
Annotation.prototype.computeScale=function(){var cm=this.cm;var hScale=(cm.getWrapperElement().clientHeight-cm.display.barHeight-this.buttonHeight*2)/cm.getScrollerElement().scrollHeight
if(hScale!=this.hScale){this.hScale=hScale;return true;}};Annotation.prototype.update=function(annotations){this.annotations=annotations;this.redraw();};Annotation.prototype.redraw=function(compute){if(compute!==false)this.computeScale();var cm=this.cm,hScale=this.hScale;var frag=document.createDocumentFragment(),anns=this.annotations;var wrapping=cm.getOption("lineWrapping");var singleLineH=wrapping&&cm.defaultTextHeight()*1.5;var curLine=null,curLineObj=null;function getY(pos,top){if(curLine!=pos.line){curLine=pos.line
curLineObj=cm.getLineHandle(pos.line)
var visual=cm.getLineHandleVisualStart(curLineObj)
if(visual!=curLineObj){curLine=cm.getLineNumber(visual)
curLineObj=visual}}
if((curLineObj.widgets&&curLineObj.widgets.length)||(wrapping&&curLineObj.height>singleLineH))
return cm.charCoords(pos,"local")[top?"top":"bottom"];var topY=cm.heightAtLine(curLineObj,"local");return topY+(top?0:curLineObj.height);}
var lastLine=cm.lastLine()
if(cm.display.barWidth)for(var i=0,nextTop;i<anns.length;i++){var ann=anns[i];if(ann.to.line>lastLine)continue;var top=nextTop||getY(ann.from,true)*hScale;var bottom=getY(ann.to,false)*hScale;while(i<anns.length-1){if(anns[i+1].to.line>lastLine)break;nextTop=getY(anns[i+1].from,true)*hScale;if(nextTop>bottom+.9)break;ann=anns[++i];bottom=getY(ann.to,false)*hScale;}
if(bottom==top)continue;var height=Math.max(bottom-top,3);var elt=frag.appendChild(document.createElement("div"));elt.style.cssText="position: absolute; right: 0px; width: "+Math.max(cm.display.barWidth-1,2)+"px; top: "
+(top+this.buttonHeight)+"px; height: "+height+"px";elt.className=this.options.className;if(ann.id){elt.setAttribute("annotation-id",ann.id);}}
this.div.textContent="";this.div.appendChild(frag);};Annotation.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);if(this.changeHandler)this.cm.off("changes",this.changeHandler);this.div.parentNode.removeChild(this.div);};});!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).bootstrap=e()}(this,(function(){"use strict";const t="transitionend",e=t=>{let e=t.getAttribute("data-bs-target");if(!e||"#"===e){let i=t.getAttribute("href");if(!i||!i.includes("#")&&!i.startsWith("."))return null;i.includes("#")&&!i.startsWith("#")&&(i=`#${i.split("#")[1]}`),e=i&&"#"!==i?i.trim():null}return e},i=t=>{const i=e(t);return i&&document.querySelector(i)?i:null},n=t=>{const i=e(t);return i?document.querySelector(i):null},s=e=>{e.dispatchEvent(new Event(t))},o=t=>!(!t||"object"!=typeof t)&&(void 0!==t.jquery&&(t=t[0]),void 0!==t.nodeType),r=t=>o(t)?t.jquery?t[0]:t:"string"==typeof t&&t.length>0?document.querySelector(t):null,a=(t,e,i)=>{Object.keys(i).forEach((n=>{const s=i[n],r=e[n],a=r&&o(r)?"element":null==(l=r)?`${l}`:{}.toString.call(l).match(/\s([a-z]+)/i)[1].toLowerCase();var l;if(!new RegExp(s).test(a))throw new TypeError(`${t.toUpperCase()}: Option "${n}" provided type "${a}" but expected type "${s}".`)}))},l=t=>!(!o(t)||0===t.getClientRects().length)&&"visible"===getComputedStyle(t).getPropertyValue("visibility"),c=t=>!t||t.nodeType!==Node.ELEMENT_NODE||!!t.classList.contains("disabled")||(void 0!==t.disabled?t.disabled:t.hasAttribute("disabled")&&"false"!==t.getAttribute("disabled")),h=t=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof t.getRootNode){const e=t.getRootNode();return e instanceof ShadowRoot?e:null}return t instanceof ShadowRoot?t:t.parentNode?h(t.parentNode):null},d=()=>{},u=t=>{t.offsetHeight},f=()=>{const{jQuery:t}=window;return t&&!document.body.hasAttribute("data-bs-no-jquery")?t:null},p=[],m=()=>"rtl"===document.documentElement.dir,g=t=>{var e;e=()=>{const e=f();if(e){const i=t.NAME,n=e.fn[i];e.fn[i]=t.jQueryInterface,e.fn[i].Constructor=t,e.fn[i].noConflict=()=>(e.fn[i]=n,t.jQueryInterface)}},"loading"===document.readyState?(p.length||document.addEventListener("DOMContentLoaded",(()=>{p.forEach((t=>t()))})),p.push(e)):e()},_=t=>{"function"==typeof t&&t()},b=(e,i,n=!0)=>{if(!n)return void _(e);const o=(t=>{if(!t)return 0;let{transitionDuration:e,transitionDelay:i}=window.getComputedStyle(t);const n=Number.parseFloat(e),s=Number.parseFloat(i);return n||s?(e=e.split(",")[0],i=i.split(",")[0],1e3*(Number.parseFloat(e)+Number.parseFloat(i))):0})(i)+5;let r=!1;const a=({target:n})=>{n===i&&(r=!0,i.removeEventListener(t,a),_(e))};i.addEventListener(t,a),setTimeout((()=>{r||s(i)}),o)},v=(t,e,i,n)=>{let s=t.indexOf(e);if(-1===s)return t[!i&&n?t.length-1:0];const o=t.length;return s+=i?1:-1,n&&(s=(s+o)%o),t[Math.max(0,Math.min(s,o-1))]},y=/[^.]*(?=\..*)\.|.*/,w=/\..*/,E=/::\d+$/,A={};let T=1;const O={mouseenter:"mouseover",mouseleave:"mouseout"},C=/^(mouseenter|mouseleave)/i,k=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function L(t,e){return e&&`${e}::${T++}`||t.uidEvent||T++}function x(t){const e=L(t);return t.uidEvent=e,A[e]=A[e]||{},A[e]}function D(t,e,i=null){const n=Object.keys(t);for(let s=0,o=n.length;s<o;s++){const o=t[n[s]];if(o.originalHandler===e&&o.delegationSelector===i)return o}return null}function S(t,e,i){const n="string"==typeof e,s=n?i:e;let o=P(t);return k.has(o)||(o=t),[n,s,o]}function N(t,e,i,n,s){if("string"!=typeof e||!t)return;if(i||(i=n,n=null),C.test(e)){const t=t=>function(e){if(!e.relatedTarget||e.relatedTarget!==e.delegateTarget&&!e.delegateTarget.contains(e.relatedTarget))return t.call(this,e)};n?n=t(n):i=t(i)}const[o,r,a]=S(e,i,n),l=x(t),c=l[a]||(l[a]={}),h=D(c,r,o?i:null);if(h)return void(h.oneOff=h.oneOff&&s);const d=L(r,e.replace(y,"")),u=o?function(t,e,i){return function n(s){const o=t.querySelectorAll(e);for(let{target:r}=s;r&&r!==this;r=r.parentNode)for(let a=o.length;a--;)if(o[a]===r)return s.delegateTarget=r,n.oneOff&&j.off(t,s.type,e,i),i.apply(r,[s]);return null}}(t,i,n):function(t,e){return function i(n){return n.delegateTarget=t,i.oneOff&&j.off(t,n.type,e),e.apply(t,[n])}}(t,i);u.delegationSelector=o?i:null,u.originalHandler=r,u.oneOff=s,u.uidEvent=d,c[d]=u,t.addEventListener(a,u,o)}function I(t,e,i,n,s){const o=D(e[i],n,s);o&&(t.removeEventListener(i,o,Boolean(s)),delete e[i][o.uidEvent])}function P(t){return t=t.replace(w,""),O[t]||t}const j={on(t,e,i,n){N(t,e,i,n,!1)},one(t,e,i,n){N(t,e,i,n,!0)},off(t,e,i,n){if("string"!=typeof e||!t)return;const[s,o,r]=S(e,i,n),a=r!==e,l=x(t),c=e.startsWith(".");if(void 0!==o){if(!l||!l[r])return;return void I(t,l,r,o,s?i:null)}c&&Object.keys(l).forEach((i=>{!function(t,e,i,n){const s=e[i]||{};Object.keys(s).forEach((o=>{if(o.includes(n)){const n=s[o];I(t,e,i,n.originalHandler,n.delegationSelector)}}))}(t,l,i,e.slice(1))}));const h=l[r]||{};Object.keys(h).forEach((i=>{const n=i.replace(E,"");if(!a||e.includes(n)){const e=h[i];I(t,l,r,e.originalHandler,e.delegationSelector)}}))},trigger(t,e,i){if("string"!=typeof e||!t)return null;const n=f(),s=P(e),o=e!==s,r=k.has(s);let a,l=!0,c=!0,h=!1,d=null;return o&&n&&(a=n.Event(e,i),n(t).trigger(a),l=!a.isPropagationStopped(),c=!a.isImmediatePropagationStopped(),h=a.isDefaultPrevented()),r?(d=document.createEvent("HTMLEvents"),d.initEvent(s,l,!0)):d=new CustomEvent(e,{bubbles:l,cancelable:!0}),void 0!==i&&Object.keys(i).forEach((t=>{Object.defineProperty(d,t,{get:()=>i[t]})})),h&&d.preventDefault(),c&&t.dispatchEvent(d),d.defaultPrevented&&void 0!==a&&a.preventDefault(),d}},M=new Map,H={set(t,e,i){M.has(t)||M.set(t,new Map);const n=M.get(t);n.has(e)||0===n.size?n.set(e,i):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(n.keys())[0]}.`)},get:(t,e)=>M.has(t)&&M.get(t).get(e)||null,remove(t,e){if(!M.has(t))return;const i=M.get(t);i.delete(e),0===i.size&&M.delete(t)}};class B{constructor(t){(t=r(t))&&(this._element=t,H.set(this._element,this.constructor.DATA_KEY,this))}dispose(){H.remove(this._element,this.constructor.DATA_KEY),j.off(this._element,this.constructor.EVENT_KEY),Object.getOwnPropertyNames(this).forEach((t=>{this[t]=null}))}_queueCallback(t,e,i=!0){b(t,e,i)}static getInstance(t){return H.get(r(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,"object"==typeof e?e:null)}static get VERSION(){return"5.1.3"}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}}const R=(t,e="hide")=>{const i=`click.dismiss${t.EVENT_KEY}`,s=t.NAME;j.on(document,i,`[data-bs-dismiss="${s}"]`,(function(i){if(["A","AREA"].includes(this.tagName)&&i.preventDefault(),c(this))return;const o=n(this)||this.closest(`.${s}`);t.getOrCreateInstance(o)[e]()}))};class W extends B{static get NAME(){return"alert"}close(){if(j.trigger(this._element,"close.bs.alert").defaultPrevented)return;this._element.classList.remove("show");const t=this._element.classList.contains("fade");this._queueCallback((()=>this._destroyElement()),this._element,t)}_destroyElement(){this._element.remove(),j.trigger(this._element,"closed.bs.alert"),this.dispose()}static jQueryInterface(t){return this.each((function(){const e=W.getOrCreateInstance(this);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}R(W,"close"),g(W);const $='[data-bs-toggle="button"]';class z extends B{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(t){return this.each((function(){const e=z.getOrCreateInstance(this);"toggle"===t&&e[t]()}))}}function q(t){return"true"===t||"false"!==t&&(t===Number(t).toString()?Number(t):""===t||"null"===t?null:t)}function F(t){return t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`))}j.on(document,"click.bs.button.data-api",$,(t=>{t.preventDefault();const e=t.target.closest($);z.getOrCreateInstance(e).toggle()})),g(z);const U={setDataAttribute(t,e,i){t.setAttribute(`data-bs-${F(e)}`,i)},removeDataAttribute(t,e){t.removeAttribute(`data-bs-${F(e)}`)},getDataAttributes(t){if(!t)return{};const e={};return Object.keys(t.dataset).filter((t=>t.startsWith("bs"))).forEach((i=>{let n=i.replace(/^bs/,"");n=n.charAt(0).toLowerCase()+n.slice(1,n.length),e[n]=q(t.dataset[i])})),e},getDataAttribute:(t,e)=>q(t.getAttribute(`data-bs-${F(e)}`)),offset(t){const e=t.getBoundingClientRect();return{top:e.top+window.pageYOffset,left:e.left+window.pageXOffset}},position:t=>({top:t.offsetTop,left:t.offsetLeft})},V={find:(t,e=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(e,t)),findOne:(t,e=document.documentElement)=>Element.prototype.querySelector.call(e,t),children:(t,e)=>[].concat(...t.children).filter((t=>t.matches(e))),parents(t,e){const i=[];let n=t.parentNode;for(;n&&n.nodeType===Node.ELEMENT_NODE&&3!==n.nodeType;)n.matches(e)&&i.push(n),n=n.parentNode;return i},prev(t,e){let i=t.previousElementSibling;for(;i;){if(i.matches(e))return[i];i=i.previousElementSibling}return[]},next(t,e){let i=t.nextElementSibling;for(;i;){if(i.matches(e))return[i];i=i.nextElementSibling}return[]},focusableChildren(t){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((t=>`${t}:not([tabindex^="-"])`)).join(", ");return this.find(e,t).filter((t=>!c(t)&&l(t)))}},K="carousel",X={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},Y={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},Q="next",G="prev",Z="left",J="right",tt={ArrowLeft:J,ArrowRight:Z},et="slid.bs.carousel",it="active",nt=".active.carousel-item";class st extends B{constructor(t,e){super(t),this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(e),this._indicatorsElement=V.findOne(".carousel-indicators",this._element),this._touchSupported="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0,this._pointerEvent=Boolean(window.PointerEvent),this._addEventListeners()}static get Default(){return X}static get NAME(){return K}next(){this._slide(Q)}nextWhenVisible(){!document.hidden&&l(this._element)&&this.next()}prev(){this._slide(G)}pause(t){t||(this._isPaused=!0),V.findOne(".carousel-item-next, .carousel-item-prev",this._element)&&(s(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null}cycle(t){t||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config&&this._config.interval&&!this._isPaused&&(this._updateInterval(),this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))}to(t){this._activeElement=V.findOne(nt,this._element);const e=this._getItemIndex(this._activeElement);if(t>this._items.length-1||t<0)return;if(this._isSliding)return void j.one(this._element,et,(()=>this.to(t)));if(e===t)return this.pause(),void this.cycle();const i=t>e?Q:G;this._slide(i,this._items[t])}_getConfig(t){return t={...X,...U.getDataAttributes(this._element),..."object"==typeof t?t:{}},a(K,t,Y),t}_handleSwipe(){const t=Math.abs(this.touchDeltaX);if(t<=40)return;const e=t/this.touchDeltaX;this.touchDeltaX=0,e&&this._slide(e>0?J:Z)}_addEventListeners(){this._config.keyboard&&j.on(this._element,"keydown.bs.carousel",(t=>this._keydown(t))),"hover"===this._config.pause&&(j.on(this._element,"mouseenter.bs.carousel",(t=>this.pause(t))),j.on(this._element,"mouseleave.bs.carousel",(t=>this.cycle(t)))),this._config.touch&&this._touchSupported&&this._addTouchEventListeners()}_addTouchEventListeners(){const t=t=>this._pointerEvent&&("pen"===t.pointerType||"touch"===t.pointerType),e=e=>{t(e)?this.touchStartX=e.clientX:this._pointerEvent||(this.touchStartX=e.touches[0].clientX)},i=t=>{this.touchDeltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this.touchStartX},n=e=>{t(e)&&(this.touchDeltaX=e.clientX-this.touchStartX),this._handleSwipe(),"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout((t=>this.cycle(t)),500+this._config.interval))};V.find(".carousel-item img",this._element).forEach((t=>{j.on(t,"dragstart.bs.carousel",(t=>t.preventDefault()))})),this._pointerEvent?(j.on(this._element,"pointerdown.bs.carousel",(t=>e(t))),j.on(this._element,"pointerup.bs.carousel",(t=>n(t))),this._element.classList.add("pointer-event")):(j.on(this._element,"touchstart.bs.carousel",(t=>e(t))),j.on(this._element,"touchmove.bs.carousel",(t=>i(t))),j.on(this._element,"touchend.bs.carousel",(t=>n(t))))}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const e=tt[t.key];e&&(t.preventDefault(),this._slide(e))}_getItemIndex(t){return this._items=t&&t.parentNode?V.find(".carousel-item",t.parentNode):[],this._items.indexOf(t)}_getItemByOrder(t,e){const i=t===Q;return v(this._items,e,i,this._config.wrap)}_triggerSlideEvent(t,e){const i=this._getItemIndex(t),n=this._getItemIndex(V.findOne(nt,this._element));return j.trigger(this._element,"slide.bs.carousel",{relatedTarget:t,direction:e,from:n,to:i})}_setActiveIndicatorElement(t){if(this._indicatorsElement){const e=V.findOne(".active",this._indicatorsElement);e.classList.remove(it),e.removeAttribute("aria-current");const i=V.find("[data-bs-target]",this._indicatorsElement);for(let e=0;e<i.length;e++)if(Number.parseInt(i[e].getAttribute("data-bs-slide-to"),10)===this._getItemIndex(t)){i[e].classList.add(it),i[e].setAttribute("aria-current","true");break}}}_updateInterval(){const t=this._activeElement||V.findOne(nt,this._element);if(!t)return;const e=Number.parseInt(t.getAttribute("data-bs-interval"),10);e?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,this._config.interval=e):this._config.interval=this._config.defaultInterval||this._config.interval}_slide(t,e){const i=this._directionToOrder(t),n=V.findOne(nt,this._element),s=this._getItemIndex(n),o=e||this._getItemByOrder(i,n),r=this._getItemIndex(o),a=Boolean(this._interval),l=i===Q,c=l?"carousel-item-start":"carousel-item-end",h=l?"carousel-item-next":"carousel-item-prev",d=this._orderToDirection(i);if(o&&o.classList.contains(it))return void(this._isSliding=!1);if(this._isSliding)return;if(this._triggerSlideEvent(o,d).defaultPrevented)return;if(!n||!o)return;this._isSliding=!0,a&&this.pause(),this._setActiveIndicatorElement(o),this._activeElement=o;const f=()=>{j.trigger(this._element,et,{relatedTarget:o,direction:d,from:s,to:r})};if(this._element.classList.contains("slide")){o.classList.add(h),u(o),n.classList.add(c),o.classList.add(c);const t=()=>{o.classList.remove(c,h),o.classList.add(it),n.classList.remove(it,h,c),this._isSliding=!1,setTimeout(f,0)};this._queueCallback(t,n,!0)}else n.classList.remove(it),o.classList.add(it),this._isSliding=!1,f();a&&this.cycle()}_directionToOrder(t){return[J,Z].includes(t)?m()?t===Z?G:Q:t===Z?Q:G:t}_orderToDirection(t){return[Q,G].includes(t)?m()?t===G?Z:J:t===G?J:Z:t}static carouselInterface(t,e){const i=st.getOrCreateInstance(t,e);let{_config:n}=i;"object"==typeof e&&(n={...n,...e});const s="string"==typeof e?e:n.slide;if("number"==typeof e)i.to(e);else if("string"==typeof s){if(void 0===i[s])throw new TypeError(`No method named "${s}"`);i[s]()}else n.interval&&n.ride&&(i.pause(),i.cycle())}static jQueryInterface(t){return this.each((function(){st.carouselInterface(this,t)}))}static dataApiClickHandler(t){const e=n(this);if(!e||!e.classList.contains("carousel"))return;const i={...U.getDataAttributes(e),...U.getDataAttributes(this)},s=this.getAttribute("data-bs-slide-to");s&&(i.interval=!1),st.carouselInterface(e,i),s&&st.getInstance(e).to(s),t.preventDefault()}}j.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",st.dataApiClickHandler),j.on(window,"load.bs.carousel.data-api",(()=>{const t=V.find('[data-bs-ride="carousel"]');for(let e=0,i=t.length;e<i;e++)st.carouselInterface(t[e],st.getInstance(t[e]))})),g(st);const ot="collapse",rt={toggle:!0,parent:null},at={toggle:"boolean",parent:"(null|element)"},lt="show",ct="collapse",ht="collapsing",dt="collapsed",ut=":scope .collapse .collapse",ft='[data-bs-toggle="collapse"]';class pt extends B{constructor(t,e){super(t),this._isTransitioning=!1,this._config=this._getConfig(e),this._triggerArray=[];const n=V.find(ft);for(let t=0,e=n.length;t<e;t++){const e=n[t],s=i(e),o=V.find(s).filter((t=>t===this._element));null!==s&&o.length&&(this._selector=s,this._triggerArray.push(e))}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return rt}static get NAME(){return ot}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t,e=[];if(this._config.parent){const t=V.find(ut,this._config.parent);e=V.find(".collapse.show, .collapse.collapsing",this._config.parent).filter((e=>!t.includes(e)))}const i=V.findOne(this._selector);if(e.length){const n=e.find((t=>i!==t));if(t=n?pt.getInstance(n):null,t&&t._isTransitioning)return}if(j.trigger(this._element,"show.bs.collapse").defaultPrevented)return;e.forEach((e=>{i!==e&&pt.getOrCreateInstance(e,{toggle:!1}).hide(),t||H.set(e,"bs.collapse",null)}));const n=this._getDimension();this._element.classList.remove(ct),this._element.classList.add(ht),this._element.style[n]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const s=`scroll${n[0].toUpperCase()+n.slice(1)}`;this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(ht),this._element.classList.add(ct,lt),this._element.style[n]="",j.trigger(this._element,"shown.bs.collapse")}),this._element,!0),this._element.style[n]=`${this._element[s]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(j.trigger(this._element,"hide.bs.collapse").defaultPrevented)return;const t=this._getDimension();this._element.style[t]=`${this._element.getBoundingClientRect()[t]}px`,u(this._element),this._element.classList.add(ht),this._element.classList.remove(ct,lt);const e=this._triggerArray.length;for(let t=0;t<e;t++){const e=this._triggerArray[t],i=n(e);i&&!this._isShown(i)&&this._addAriaAndCollapsedClass([e],!1)}this._isTransitioning=!0,this._element.style[t]="",this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(ht),this._element.classList.add(ct),j.trigger(this._element,"hidden.bs.collapse")}),this._element,!0)}_isShown(t=this._element){return t.classList.contains(lt)}_getConfig(t){return(t={...rt,...U.getDataAttributes(this._element),...t}).toggle=Boolean(t.toggle),t.parent=r(t.parent),a(ot,t,at),t}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const t=V.find(ut,this._config.parent);V.find(ft,this._config.parent).filter((e=>!t.includes(e))).forEach((t=>{const e=n(t);e&&this._addAriaAndCollapsedClass([t],this._isShown(e))}))}_addAriaAndCollapsedClass(t,e){t.length&&t.forEach((t=>{e?t.classList.remove(dt):t.classList.add(dt),t.setAttribute("aria-expanded",e)}))}static jQueryInterface(t){return this.each((function(){const e={};"string"==typeof t&&/show|hide/.test(t)&&(e.toggle=!1);const i=pt.getOrCreateInstance(this,e);if("string"==typeof t){if(void 0===i[t])throw new TypeError(`No method named "${t}"`);i[t]()}}))}}j.on(document,"click.bs.collapse.data-api",ft,(function(t){("A"===t.target.tagName||t.delegateTarget&&"A"===t.delegateTarget.tagName)&&t.preventDefault();const e=i(this);V.find(e).forEach((t=>{pt.getOrCreateInstance(t,{toggle:!1}).toggle()}))})),g(pt);var mt="top",gt="bottom",_t="right",bt="left",vt="auto",yt=[mt,gt,_t,bt],wt="start",Et="end",At="clippingParents",Tt="viewport",Ot="popper",Ct="reference",kt=yt.reduce((function(t,e){return t.concat([e+"-"+wt,e+"-"+Et])}),[]),Lt=[].concat(yt,[vt]).reduce((function(t,e){return t.concat([e,e+"-"+wt,e+"-"+Et])}),[]),xt="beforeRead",Dt="read",St="afterRead",Nt="beforeMain",It="main",Pt="afterMain",jt="beforeWrite",Mt="write",Ht="afterWrite",Bt=[xt,Dt,St,Nt,It,Pt,jt,Mt,Ht];function Rt(t){return t?(t.nodeName||"").toLowerCase():null}function Wt(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function $t(t){return t instanceof Wt(t).Element||t instanceof Element}function zt(t){return t instanceof Wt(t).HTMLElement||t instanceof HTMLElement}function qt(t){return"undefined"!=typeof ShadowRoot&&(t instanceof Wt(t).ShadowRoot||t instanceof ShadowRoot)}const Ft={name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var i=e.styles[t]||{},n=e.attributes[t]||{},s=e.elements[t];zt(s)&&Rt(s)&&(Object.assign(s.style,i),Object.keys(n).forEach((function(t){var e=n[t];!1===e?s.removeAttribute(t):s.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach((function(t){var n=e.elements[t],s=e.attributes[t]||{},o=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:i[t]).reduce((function(t,e){return t[e]="",t}),{});zt(n)&&Rt(n)&&(Object.assign(n.style,o),Object.keys(s).forEach((function(t){n.removeAttribute(t)})))}))}},requires:["computeStyles"]};function Ut(t){return t.split("-")[0]}function Vt(t,e){var i=t.getBoundingClientRect();return{width:i.width/1,height:i.height/1,top:i.top/1,right:i.right/1,bottom:i.bottom/1,left:i.left/1,x:i.left/1,y:i.top/1}}function Kt(t){var e=Vt(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function Xt(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&qt(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Yt(t){return Wt(t).getComputedStyle(t)}function Qt(t){return["table","td","th"].indexOf(Rt(t))>=0}function Gt(t){return(($t(t)?t.ownerDocument:t.document)||window.document).documentElement}function Zt(t){return"html"===Rt(t)?t:t.assignedSlot||t.parentNode||(qt(t)?t.host:null)||Gt(t)}function Jt(t){return zt(t)&&"fixed"!==Yt(t).position?t.offsetParent:null}function te(t){for(var e=Wt(t),i=Jt(t);i&&Qt(i)&&"static"===Yt(i).position;)i=Jt(i);return i&&("html"===Rt(i)||"body"===Rt(i)&&"static"===Yt(i).position)?e:i||function(t){var e=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&zt(t)&&"fixed"===Yt(t).position)return null;for(var i=Zt(t);zt(i)&&["html","body"].indexOf(Rt(i))<0;){var n=Yt(i);if("none"!==n.transform||"none"!==n.perspective||"paint"===n.contain||-1!==["transform","perspective"].indexOf(n.willChange)||e&&"filter"===n.willChange||e&&n.filter&&"none"!==n.filter)return i;i=i.parentNode}return null}(t)||e}function ee(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}var ie=Math.max,ne=Math.min,se=Math.round;function oe(t,e,i){return ie(t,ne(e,i))}function re(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},t)}function ae(t,e){return e.reduce((function(e,i){return e[i]=t,e}),{})}const le={name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,i=t.state,n=t.name,s=t.options,o=i.elements.arrow,r=i.modifiersData.popperOffsets,a=Ut(i.placement),l=ee(a),c=[bt,_t].indexOf(a)>=0?"height":"width";if(o&&r){var h=function(t,e){return re("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:ae(t,yt))}(s.padding,i),d=Kt(o),u="y"===l?mt:bt,f="y"===l?gt:_t,p=i.rects.reference[c]+i.rects.reference[l]-r[l]-i.rects.popper[c],m=r[l]-i.rects.reference[l],g=te(o),_=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,b=p/2-m/2,v=h[u],y=_-d[c]-h[f],w=_/2-d[c]/2+b,E=oe(v,w,y),A=l;i.modifiersData[n]=((e={})[A]=E,e.centerOffset=E-w,e)}},effect:function(t){var e=t.state,i=t.options.element,n=void 0===i?"[data-popper-arrow]":i;null!=n&&("string"!=typeof n||(n=e.elements.popper.querySelector(n)))&&Xt(e.elements.popper,n)&&(e.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ce(t){return t.split("-")[1]}var he={top:"auto",right:"auto",bottom:"auto",left:"auto"};function de(t){var e,i=t.popper,n=t.popperRect,s=t.placement,o=t.variation,r=t.offsets,a=t.position,l=t.gpuAcceleration,c=t.adaptive,h=t.roundOffsets,d=!0===h?function(t){var e=t.x,i=t.y,n=window.devicePixelRatio||1;return{x:se(se(e*n)/n)||0,y:se(se(i*n)/n)||0}}(r):"function"==typeof h?h(r):r,u=d.x,f=void 0===u?0:u,p=d.y,m=void 0===p?0:p,g=r.hasOwnProperty("x"),_=r.hasOwnProperty("y"),b=bt,v=mt,y=window;if(c){var w=te(i),E="clientHeight",A="clientWidth";w===Wt(i)&&"static"!==Yt(w=Gt(i)).position&&"absolute"===a&&(E="scrollHeight",A="scrollWidth"),w=w,s!==mt&&(s!==bt&&s!==_t||o!==Et)||(v=gt,m-=w[E]-n.height,m*=l?1:-1),s!==bt&&(s!==mt&&s!==gt||o!==Et)||(b=_t,f-=w[A]-n.width,f*=l?1:-1)}var T,O=Object.assign({position:a},c&&he);return l?Object.assign({},O,((T={})[v]=_?"0":"",T[b]=g?"0":"",T.transform=(y.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",T)):Object.assign({},O,((e={})[v]=_?m+"px":"",e[b]=g?f+"px":"",e.transform="",e))}const ue={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,i=t.options,n=i.gpuAcceleration,s=void 0===n||n,o=i.adaptive,r=void 0===o||o,a=i.roundOffsets,l=void 0===a||a,c={placement:Ut(e.placement),variation:ce(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:s};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,de(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:r,roundOffsets:l})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,de(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}};var fe={passive:!0};const pe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,i=t.instance,n=t.options,s=n.scroll,o=void 0===s||s,r=n.resize,a=void 0===r||r,l=Wt(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&c.forEach((function(t){t.addEventListener("scroll",i.update,fe)})),a&&l.addEventListener("resize",i.update,fe),function(){o&&c.forEach((function(t){t.removeEventListener("scroll",i.update,fe)})),a&&l.removeEventListener("resize",i.update,fe)}},data:{}};var me={left:"right",right:"left",bottom:"top",top:"bottom"};function ge(t){return t.replace(/left|right|bottom|top/g,(function(t){return me[t]}))}var _e={start:"end",end:"start"};function be(t){return t.replace(/start|end/g,(function(t){return _e[t]}))}function ve(t){var e=Wt(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function ye(t){return Vt(Gt(t)).left+ve(t).scrollLeft}function we(t){var e=Yt(t),i=e.overflow,n=e.overflowX,s=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+s+n)}function Ee(t){return["html","body","#document"].indexOf(Rt(t))>=0?t.ownerDocument.body:zt(t)&&we(t)?t:Ee(Zt(t))}function Ae(t,e){var i;void 0===e&&(e=[]);var n=Ee(t),s=n===(null==(i=t.ownerDocument)?void 0:i.body),o=Wt(n),r=s?[o].concat(o.visualViewport||[],we(n)?n:[]):n,a=e.concat(r);return s?a:a.concat(Ae(Zt(r)))}function Te(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Oe(t,e){return e===Tt?Te(function(t){var e=Wt(t),i=Gt(t),n=e.visualViewport,s=i.clientWidth,o=i.clientHeight,r=0,a=0;return n&&(s=n.width,o=n.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(r=n.offsetLeft,a=n.offsetTop)),{width:s,height:o,x:r+ye(t),y:a}}(t)):zt(e)?function(t){var e=Vt(t);return e.top=e.top+t.clientTop,e.left=e.left+t.clientLeft,e.bottom=e.top+t.clientHeight,e.right=e.left+t.clientWidth,e.width=t.clientWidth,e.height=t.clientHeight,e.x=e.left,e.y=e.top,e}(e):Te(function(t){var e,i=Gt(t),n=ve(t),s=null==(e=t.ownerDocument)?void 0:e.body,o=ie(i.scrollWidth,i.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),r=ie(i.scrollHeight,i.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),a=-n.scrollLeft+ye(t),l=-n.scrollTop;return"rtl"===Yt(s||i).direction&&(a+=ie(i.clientWidth,s?s.clientWidth:0)-o),{width:o,height:r,x:a,y:l}}(Gt(t)))}function Ce(t){var e,i=t.reference,n=t.element,s=t.placement,o=s?Ut(s):null,r=s?ce(s):null,a=i.x+i.width/2-n.width/2,l=i.y+i.height/2-n.height/2;switch(o){case mt:e={x:a,y:i.y-n.height};break;case gt:e={x:a,y:i.y+i.height};break;case _t:e={x:i.x+i.width,y:l};break;case bt:e={x:i.x-n.width,y:l};break;default:e={x:i.x,y:i.y}}var c=o?ee(o):null;if(null!=c){var h="y"===c?"height":"width";switch(r){case wt:e[c]=e[c]-(i[h]/2-n[h]/2);break;case Et:e[c]=e[c]+(i[h]/2-n[h]/2)}}return e}function ke(t,e){void 0===e&&(e={});var i=e,n=i.placement,s=void 0===n?t.placement:n,o=i.boundary,r=void 0===o?At:o,a=i.rootBoundary,l=void 0===a?Tt:a,c=i.elementContext,h=void 0===c?Ot:c,d=i.altBoundary,u=void 0!==d&&d,f=i.padding,p=void 0===f?0:f,m=re("number"!=typeof p?p:ae(p,yt)),g=h===Ot?Ct:Ot,_=t.rects.popper,b=t.elements[u?g:h],v=function(t,e,i){var n="clippingParents"===e?function(t){var e=Ae(Zt(t)),i=["absolute","fixed"].indexOf(Yt(t).position)>=0&&zt(t)?te(t):t;return $t(i)?e.filter((function(t){return $t(t)&&Xt(t,i)&&"body"!==Rt(t)})):[]}(t):[].concat(e),s=[].concat(n,[i]),o=s[0],r=s.reduce((function(e,i){var n=Oe(t,i);return e.top=ie(n.top,e.top),e.right=ne(n.right,e.right),e.bottom=ne(n.bottom,e.bottom),e.left=ie(n.left,e.left),e}),Oe(t,o));return r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}($t(b)?b:b.contextElement||Gt(t.elements.popper),r,l),y=Vt(t.elements.reference),w=Ce({reference:y,element:_,strategy:"absolute",placement:s}),E=Te(Object.assign({},_,w)),A=h===Ot?E:y,T={top:v.top-A.top+m.top,bottom:A.bottom-v.bottom+m.bottom,left:v.left-A.left+m.left,right:A.right-v.right+m.right},O=t.modifiersData.offset;if(h===Ot&&O){var C=O[s];Object.keys(T).forEach((function(t){var e=[_t,gt].indexOf(t)>=0?1:-1,i=[mt,gt].indexOf(t)>=0?"y":"x";T[t]+=C[i]*e}))}return T}function Le(t,e){void 0===e&&(e={});var i=e,n=i.placement,s=i.boundary,o=i.rootBoundary,r=i.padding,a=i.flipVariations,l=i.allowedAutoPlacements,c=void 0===l?Lt:l,h=ce(n),d=h?a?kt:kt.filter((function(t){return ce(t)===h})):yt,u=d.filter((function(t){return c.indexOf(t)>=0}));0===u.length&&(u=d);var f=u.reduce((function(e,i){return e[i]=ke(t,{placement:i,boundary:s,rootBoundary:o,padding:r})[Ut(i)],e}),{});return Object.keys(f).sort((function(t,e){return f[t]-f[e]}))}const xe={name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var s=i.mainAxis,o=void 0===s||s,r=i.altAxis,a=void 0===r||r,l=i.fallbackPlacements,c=i.padding,h=i.boundary,d=i.rootBoundary,u=i.altBoundary,f=i.flipVariations,p=void 0===f||f,m=i.allowedAutoPlacements,g=e.options.placement,_=Ut(g),b=l||(_!==g&&p?function(t){if(Ut(t)===vt)return[];var e=ge(t);return[be(t),e,be(e)]}(g):[ge(g)]),v=[g].concat(b).reduce((function(t,i){return t.concat(Ut(i)===vt?Le(e,{placement:i,boundary:h,rootBoundary:d,padding:c,flipVariations:p,allowedAutoPlacements:m}):i)}),[]),y=e.rects.reference,w=e.rects.popper,E=new Map,A=!0,T=v[0],O=0;O<v.length;O++){var C=v[O],k=Ut(C),L=ce(C)===wt,x=[mt,gt].indexOf(k)>=0,D=x?"width":"height",S=ke(e,{placement:C,boundary:h,rootBoundary:d,altBoundary:u,padding:c}),N=x?L?_t:bt:L?gt:mt;y[D]>w[D]&&(N=ge(N));var I=ge(N),P=[];if(o&&P.push(S[k]<=0),a&&P.push(S[N]<=0,S[I]<=0),P.every((function(t){return t}))){T=C,A=!1;break}E.set(C,P)}if(A)for(var j=function(t){var e=v.find((function(e){var i=E.get(e);if(i)return i.slice(0,t).every((function(t){return t}))}));if(e)return T=e,"break"},M=p?3:1;M>0&&"break"!==j(M);M--);e.placement!==T&&(e.modifiersData[n]._skip=!0,e.placement=T,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function De(t,e,i){return void 0===i&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function Se(t){return[mt,_t,gt,bt].some((function(e){return t[e]>=0}))}const Ne={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,i=t.name,n=e.rects.reference,s=e.rects.popper,o=e.modifiersData.preventOverflow,r=ke(e,{elementContext:"reference"}),a=ke(e,{altBoundary:!0}),l=De(r,n),c=De(a,s,o),h=Se(l),d=Se(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:h,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":h,"data-popper-escaped":d})}},Ie={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,i=t.options,n=t.name,s=i.offset,o=void 0===s?[0,0]:s,r=Lt.reduce((function(t,i){return t[i]=function(t,e,i){var n=Ut(t),s=[bt,mt].indexOf(n)>=0?-1:1,o="function"==typeof i?i(Object.assign({},e,{placement:t})):i,r=o[0],a=o[1];return r=r||0,a=(a||0)*s,[bt,_t].indexOf(n)>=0?{x:a,y:r}:{x:r,y:a}}(i,e.rects,o),t}),{}),a=r[e.placement],l=a.x,c=a.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[n]=r}},Pe={name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,i=t.name;e.modifiersData[i]=Ce({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},je={name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,i=t.options,n=t.name,s=i.mainAxis,o=void 0===s||s,r=i.altAxis,a=void 0!==r&&r,l=i.boundary,c=i.rootBoundary,h=i.altBoundary,d=i.padding,u=i.tether,f=void 0===u||u,p=i.tetherOffset,m=void 0===p?0:p,g=ke(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:h}),_=Ut(e.placement),b=ce(e.placement),v=!b,y=ee(_),w="x"===y?"y":"x",E=e.modifiersData.popperOffsets,A=e.rects.reference,T=e.rects.popper,O="function"==typeof m?m(Object.assign({},e.rects,{placement:e.placement})):m,C={x:0,y:0};if(E){if(o||a){var k="y"===y?mt:bt,L="y"===y?gt:_t,x="y"===y?"height":"width",D=E[y],S=E[y]+g[k],N=E[y]-g[L],I=f?-T[x]/2:0,P=b===wt?A[x]:T[x],j=b===wt?-T[x]:-A[x],M=e.elements.arrow,H=f&&M?Kt(M):{width:0,height:0},B=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},R=B[k],W=B[L],$=oe(0,A[x],H[x]),z=v?A[x]/2-I-$-R-O:P-$-R-O,q=v?-A[x]/2+I+$+W+O:j+$+W+O,F=e.elements.arrow&&te(e.elements.arrow),U=F?"y"===y?F.clientTop||0:F.clientLeft||0:0,V=e.modifiersData.offset?e.modifiersData.offset[e.placement][y]:0,K=E[y]+z-V-U,X=E[y]+q-V;if(o){var Y=oe(f?ne(S,K):S,D,f?ie(N,X):N);E[y]=Y,C[y]=Y-D}if(a){var Q="x"===y?mt:bt,G="x"===y?gt:_t,Z=E[w],J=Z+g[Q],tt=Z-g[G],et=oe(f?ne(J,K):J,Z,f?ie(tt,X):tt);E[w]=et,C[w]=et-Z}}e.modifiersData[n]=C}},requiresIfExists:["offset"]};function Me(t,e,i){void 0===i&&(i=!1);var n=zt(e);zt(e)&&function(t){var e=t.getBoundingClientRect();e.width,t.offsetWidth,e.height,t.offsetHeight}(e);var s,o,r=Gt(e),a=Vt(t),l={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(n||!n&&!i)&&(("body"!==Rt(e)||we(r))&&(l=(s=e)!==Wt(s)&&zt(s)?{scrollLeft:(o=s).scrollLeft,scrollTop:o.scrollTop}:ve(s)),zt(e)?((c=Vt(e)).x+=e.clientLeft,c.y+=e.clientTop):r&&(c.x=ye(r))),{x:a.left+l.scrollLeft-c.x,y:a.top+l.scrollTop-c.y,width:a.width,height:a.height}}function He(t){var e=new Map,i=new Set,n=[];function s(t){i.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach((function(t){if(!i.has(t)){var n=e.get(t);n&&s(n)}})),n.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){i.has(t.name)||s(t)})),n}var Be={placement:"bottom",modifiers:[],strategy:"absolute"};function Re(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function We(t){void 0===t&&(t={});var e=t,i=e.defaultModifiers,n=void 0===i?[]:i,s=e.defaultOptions,o=void 0===s?Be:s;return function(t,e,i){void 0===i&&(i=o);var s,r,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},Be,o),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},l=[],c=!1,h={state:a,setOptions:function(i){var s="function"==typeof i?i(a.options):i;d(),a.options=Object.assign({},o,a.options,s),a.scrollParents={reference:$t(t)?Ae(t):t.contextElement?Ae(t.contextElement):[],popper:Ae(e)};var r,c,u=function(t){var e=He(t);return Bt.reduce((function(t,i){return t.concat(e.filter((function(t){return t.phase===i})))}),[])}((r=[].concat(n,a.options.modifiers),c=r.reduce((function(t,e){var i=t[e.name];return t[e.name]=i?Object.assign({},i,e,{options:Object.assign({},i.options,e.options),data:Object.assign({},i.data,e.data)}):e,t}),{}),Object.keys(c).map((function(t){return c[t]}))));return a.orderedModifiers=u.filter((function(t){return t.enabled})),a.orderedModifiers.forEach((function(t){var e=t.name,i=t.options,n=void 0===i?{}:i,s=t.effect;if("function"==typeof s){var o=s({state:a,name:e,instance:h,options:n});l.push(o||function(){})}})),h.update()},forceUpdate:function(){if(!c){var t=a.elements,e=t.reference,i=t.popper;if(Re(e,i)){a.rects={reference:Me(e,te(i),"fixed"===a.options.strategy),popper:Kt(i)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(t){return a.modifiersData[t.name]=Object.assign({},t.data)}));for(var n=0;n<a.orderedModifiers.length;n++)if(!0!==a.reset){var s=a.orderedModifiers[n],o=s.fn,r=s.options,l=void 0===r?{}:r,d=s.name;"function"==typeof o&&(a=o({state:a,options:l,name:d,instance:h})||a)}else a.reset=!1,n=-1}}},update:(s=function(){return new Promise((function(t){h.forceUpdate(),t(a)}))},function(){return r||(r=new Promise((function(t){Promise.resolve().then((function(){r=void 0,t(s())}))}))),r}),destroy:function(){d(),c=!0}};if(!Re(t,e))return h;function d(){l.forEach((function(t){return t()})),l=[]}return h.setOptions(i).then((function(t){!c&&i.onFirstUpdate&&i.onFirstUpdate(t)})),h}}var $e=We(),ze=We({defaultModifiers:[pe,Pe,ue,Ft]}),qe=We({defaultModifiers:[pe,Pe,ue,Ft,Ie,xe,je,le,Ne]});const Fe=Object.freeze({__proto__:null,popperGenerator:We,detectOverflow:ke,createPopperBase:$e,createPopper:qe,createPopperLite:ze,top:mt,bottom:gt,right:_t,left:bt,auto:vt,basePlacements:yt,start:wt,end:Et,clippingParents:At,viewport:Tt,popper:Ot,reference:Ct,variationPlacements:kt,placements:Lt,beforeRead:xt,read:Dt,afterRead:St,beforeMain:Nt,main:It,afterMain:Pt,beforeWrite:jt,write:Mt,afterWrite:Ht,modifierPhases:Bt,applyStyles:Ft,arrow:le,computeStyles:ue,eventListeners:pe,flip:xe,hide:Ne,offset:Ie,popperOffsets:Pe,preventOverflow:je}),Ue="dropdown",Ve="Escape",Ke="Space",Xe="ArrowUp",Ye="ArrowDown",Qe=new RegExp("ArrowUp|ArrowDown|Escape"),Ge="click.bs.dropdown.data-api",Ze="keydown.bs.dropdown.data-api",Je="show",ti='[data-bs-toggle="dropdown"]',ei=".dropdown-menu",ii=m()?"top-end":"top-start",ni=m()?"top-start":"top-end",si=m()?"bottom-end":"bottom-start",oi=m()?"bottom-start":"bottom-end",ri=m()?"left-start":"right-start",ai=m()?"right-start":"left-start",li={offset:[0,2],boundary:"clippingParents",reference:"toggle",display:"dynamic",popperConfig:null,autoClose:!0},ci={offset:"(array|string|function)",boundary:"(string|element)",reference:"(string|element|object)",display:"string",popperConfig:"(null|object|function)",autoClose:"(boolean|string)"};class hi extends B{constructor(t,e){super(t),this._popper=null,this._config=this._getConfig(e),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar()}static get Default(){return li}static get DefaultType(){return ci}static get NAME(){return Ue}toggle(){return this._isShown()?this.hide():this.show()}show(){if(c(this._element)||this._isShown(this._menu))return;const t={relatedTarget:this._element};if(j.trigger(this._element,"show.bs.dropdown",t).defaultPrevented)return;const e=hi.getParentFromElement(this._element);this._inNavbar?U.setDataAttribute(this._menu,"popper","none"):this._createPopper(e),"ontouchstart"in document.documentElement&&!e.closest(".navbar-nav")&&[].concat(...document.body.children).forEach((t=>j.on(t,"mouseover",d))),this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Je),this._element.classList.add(Je),j.trigger(this._element,"shown.bs.dropdown",t)}hide(){if(c(this._element)||!this._isShown(this._menu))return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){j.trigger(this._element,"hide.bs.dropdown",t).defaultPrevented||("ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach((t=>j.off(t,"mouseover",d))),this._popper&&this._popper.destroy(),this._menu.classList.remove(Je),this._element.classList.remove(Je),this._element.setAttribute("aria-expanded","false"),U.removeDataAttribute(this._menu,"popper"),j.trigger(this._element,"hidden.bs.dropdown",t))}_getConfig(t){if(t={...this.constructor.Default,...U.getDataAttributes(this._element),...t},a(Ue,t,this.constructor.DefaultType),"object"==typeof t.reference&&!o(t.reference)&&"function"!=typeof t.reference.getBoundingClientRect)throw new TypeError(`${Ue.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(t){if(void 0===Fe)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let e=this._element;"parent"===this._config.reference?e=t:o(this._config.reference)?e=r(this._config.reference):"object"==typeof this._config.reference&&(e=this._config.reference);const i=this._getPopperConfig(),n=i.modifiers.find((t=>"applyStyles"===t.name&&!1===t.enabled));this._popper=qe(e,this._menu,i),n&&U.setDataAttribute(this._menu,"popper","static")}_isShown(t=this._element){return t.classList.contains(Je)}_getMenuElement(){return V.next(this._element,ei)[0]}_getPlacement(){const t=this._element.parentNode;if(t.classList.contains("dropend"))return ri;if(t.classList.contains("dropstart"))return ai;const e="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return t.classList.contains("dropup")?e?ni:ii:e?oi:si}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:t}=this._config;return"string"==typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"==typeof t?e=>t(e,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return"static"===this._config.display&&(t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,..."function"==typeof this._config.popperConfig?this._config.popperConfig(t):this._config.popperConfig}}_selectMenuItem({key:t,target:e}){const i=V.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(l);i.length&&v(i,e,t===Ye,!i.includes(e)).focus()}static jQueryInterface(t){return this.each((function(){const e=hi.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}static clearMenus(t){if(t&&(2===t.button||"keyup"===t.type&&"Tab"!==t.key))return;const e=V.find(ti);for(let i=0,n=e.length;i<n;i++){const n=hi.getInstance(e[i]);if(!n||!1===n._config.autoClose)continue;if(!n._isShown())continue;const s={relatedTarget:n._element};if(t){const e=t.composedPath(),i=e.includes(n._menu);if(e.includes(n._element)||"inside"===n._config.autoClose&&!i||"outside"===n._config.autoClose&&i)continue;if(n._menu.contains(t.target)&&("keyup"===t.type&&"Tab"===t.key||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;"click"===t.type&&(s.clickEvent=t)}n._completeHide(s)}}static getParentFromElement(t){return n(t)||t.parentNode}static dataApiKeydownHandler(t){if(/input|textarea/i.test(t.target.tagName)?t.key===Ke||t.key!==Ve&&(t.key!==Ye&&t.key!==Xe||t.target.closest(ei)):!Qe.test(t.key))return;const e=this.classList.contains(Je);if(!e&&t.key===Ve)return;if(t.preventDefault(),t.stopPropagation(),c(this))return;const i=this.matches(ti)?this:V.prev(this,ti)[0],n=hi.getOrCreateInstance(i);if(t.key!==Ve)return t.key===Xe||t.key===Ye?(e||n.show(),void n._selectMenuItem(t)):void(e&&t.key!==Ke||hi.clearMenus());n.hide()}}j.on(document,Ze,ti,hi.dataApiKeydownHandler),j.on(document,Ze,ei,hi.dataApiKeydownHandler),j.on(document,Ge,hi.clearMenus),j.on(document,"keyup.bs.dropdown.data-api",hi.clearMenus),j.on(document,Ge,ti,(function(t){t.preventDefault(),hi.getOrCreateInstance(this).toggle()})),g(hi);const di=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",ui=".sticky-top";class fi{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,"paddingRight",(e=>e+t)),this._setElementAttributes(di,"paddingRight",(e=>e+t)),this._setElementAttributes(ui,"marginRight",(e=>e-t))}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,e,i){const n=this.getWidth();this._applyManipulationCallback(t,(t=>{if(t!==this._element&&window.innerWidth>t.clientWidth+n)return;this._saveInitialAttribute(t,e);const s=window.getComputedStyle(t)[e];t.style[e]=`${i(Number.parseFloat(s))}px`}))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,"paddingRight"),this._resetElementAttributes(di,"paddingRight"),this._resetElementAttributes(ui,"marginRight")}_saveInitialAttribute(t,e){const i=t.style[e];i&&U.setDataAttribute(t,e,i)}_resetElementAttributes(t,e){this._applyManipulationCallback(t,(t=>{const i=U.getDataAttribute(t,e);void 0===i?t.style.removeProperty(e):(U.removeDataAttribute(t,e),t.style[e]=i)}))}_applyManipulationCallback(t,e){o(t)?e(t):V.find(t,this._element).forEach(e)}isOverflowing(){return this.getWidth()>0}}const pi={className:"modal-backdrop",isVisible:!0,isAnimated:!1,rootElement:"body",clickCallback:null},mi={className:"string",isVisible:"boolean",isAnimated:"boolean",rootElement:"(element|string)",clickCallback:"(function|null)"},gi="show",_i="mousedown.bs.backdrop";class bi{constructor(t){this._config=this._getConfig(t),this._isAppended=!1,this._element=null}show(t){this._config.isVisible?(this._append(),this._config.isAnimated&&u(this._getElement()),this._getElement().classList.add(gi),this._emulateAnimation((()=>{_(t)}))):_(t)}hide(t){this._config.isVisible?(this._getElement().classList.remove(gi),this._emulateAnimation((()=>{this.dispose(),_(t)}))):_(t)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add("fade"),this._element=t}return this._element}_getConfig(t){return(t={...pi,..."object"==typeof t?t:{}}).rootElement=r(t.rootElement),a("backdrop",t,mi),t}_append(){this._isAppended||(this._config.rootElement.append(this._getElement()),j.on(this._getElement(),_i,(()=>{_(this._config.clickCallback)})),this._isAppended=!0)}dispose(){this._isAppended&&(j.off(this._element,_i),this._element.remove(),this._isAppended=!1)}_emulateAnimation(t){b(t,this._getElement(),this._config.isAnimated)}}const vi={trapElement:null,autofocus:!0},yi={trapElement:"element",autofocus:"boolean"},wi=".bs.focustrap",Ei="backward";class Ai{constructor(t){this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}activate(){const{trapElement:t,autofocus:e}=this._config;this._isActive||(e&&t.focus(),j.off(document,wi),j.on(document,"focusin.bs.focustrap",(t=>this._handleFocusin(t))),j.on(document,"keydown.tab.bs.focustrap",(t=>this._handleKeydown(t))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,j.off(document,wi))}_handleFocusin(t){const{target:e}=t,{trapElement:i}=this._config;if(e===document||e===i||i.contains(e))return;const n=V.focusableChildren(i);0===n.length?i.focus():this._lastTabNavDirection===Ei?n[n.length-1].focus():n[0].focus()}_handleKeydown(t){"Tab"===t.key&&(this._lastTabNavDirection=t.shiftKey?Ei:"forward")}_getConfig(t){return t={...vi,..."object"==typeof t?t:{}},a("focustrap",t,yi),t}}const Ti="modal",Oi="Escape",Ci={backdrop:!0,keyboard:!0,focus:!0},ki={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean"},Li="hidden.bs.modal",xi="show.bs.modal",Di="resize.bs.modal",Si="click.dismiss.bs.modal",Ni="keydown.dismiss.bs.modal",Ii="mousedown.dismiss.bs.modal",Pi="modal-open",ji="show",Mi="modal-static";class Hi extends B{constructor(t,e){super(t),this._config=this._getConfig(e),this._dialog=V.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollBar=new fi}static get Default(){return Ci}static get NAME(){return Ti}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||this._isTransitioning||j.trigger(this._element,xi,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isAnimated()&&(this._isTransitioning=!0),this._scrollBar.hide(),document.body.classList.add(Pi),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),j.on(this._dialog,Ii,(()=>{j.one(this._element,"mouseup.dismiss.bs.modal",(t=>{t.target===this._element&&(this._ignoreBackdropClick=!0)}))})),this._showBackdrop((()=>this._showElement(t))))}hide(){if(!this._isShown||this._isTransitioning)return;if(j.trigger(this._element,"hide.bs.modal").defaultPrevented)return;this._isShown=!1;const t=this._isAnimated();t&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),this._focustrap.deactivate(),this._element.classList.remove(ji),j.off(this._element,Si),j.off(this._dialog,Ii),this._queueCallback((()=>this._hideModal()),this._element,t)}dispose(){[window,this._dialog].forEach((t=>j.off(t,".bs.modal"))),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new bi({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Ai({trapElement:this._element})}_getConfig(t){return t={...Ci,...U.getDataAttributes(this._element),..."object"==typeof t?t:{}},a(Ti,t,ki),t}_showElement(t){const e=this._isAnimated(),i=V.findOne(".modal-body",this._dialog);this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0,i&&(i.scrollTop=0),e&&u(this._element),this._element.classList.add(ji),this._queueCallback((()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,j.trigger(this._element,"shown.bs.modal",{relatedTarget:t})}),this._dialog,e)}_setEscapeEvent(){this._isShown?j.on(this._element,Ni,(t=>{this._config.keyboard&&t.key===Oi?(t.preventDefault(),this.hide()):this._config.keyboard||t.key!==Oi||this._triggerBackdropTransition()})):j.off(this._element,Ni)}_setResizeEvent(){this._isShown?j.on(window,Di,(()=>this._adjustDialog())):j.off(window,Di)}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(Pi),this._resetAdjustments(),this._scrollBar.reset(),j.trigger(this._element,Li)}))}_showBackdrop(t){j.on(this._element,Si,(t=>{this._ignoreBackdropClick?this._ignoreBackdropClick=!1:t.target===t.currentTarget&&(!0===this._config.backdrop?this.hide():"static"===this._config.backdrop&&this._triggerBackdropTransition())})),this._backdrop.show(t)}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(j.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented)return;const{classList:t,scrollHeight:e,style:i}=this._element,n=e>document.documentElement.clientHeight;!n&&"hidden"===i.overflowY||t.contains(Mi)||(n||(i.overflowY="hidden"),t.add(Mi),this._queueCallback((()=>{t.remove(Mi),n||this._queueCallback((()=>{i.overflowY=""}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._scrollBar.getWidth(),i=e>0;(!i&&t&&!m()||i&&!t&&m())&&(this._element.style.paddingLeft=`${e}px`),(i&&!t&&!m()||!i&&t&&m())&&(this._element.style.paddingRight=`${e}px`)}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,e){return this.each((function(){const i=Hi.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===i[t])throw new TypeError(`No method named "${t}"`);i[t](e)}}))}}j.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',(function(t){const e=n(this);["A","AREA"].includes(this.tagName)&&t.preventDefault(),j.one(e,xi,(t=>{t.defaultPrevented||j.one(e,Li,(()=>{l(this)&&this.focus()}))}));const i=V.findOne(".modal.show");i&&Hi.getInstance(i).hide(),Hi.getOrCreateInstance(e).toggle(this)})),R(Hi),g(Hi);const Bi="offcanvas",Ri={backdrop:!0,keyboard:!0,scroll:!1},Wi={backdrop:"boolean",keyboard:"boolean",scroll:"boolean"},$i="show",zi=".offcanvas.show",qi="hidden.bs.offcanvas";class Fi extends B{constructor(t,e){super(t),this._config=this._getConfig(e),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get NAME(){return Bi}static get Default(){return Ri}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||j.trigger(this._element,"show.bs.offcanvas",{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._element.style.visibility="visible",this._backdrop.show(),this._config.scroll||(new fi).hide(),this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add($i),this._queueCallback((()=>{this._config.scroll||this._focustrap.activate(),j.trigger(this._element,"shown.bs.offcanvas",{relatedTarget:t})}),this._element,!0))}hide(){this._isShown&&(j.trigger(this._element,"hide.bs.offcanvas").defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.remove($i),this._backdrop.hide(),this._queueCallback((()=>{this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._element.style.visibility="hidden",this._config.scroll||(new fi).reset(),j.trigger(this._element,qi)}),this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_getConfig(t){return t={...Ri,...U.getDataAttributes(this._element),..."object"==typeof t?t:{}},a(Bi,t,Wi),t}_initializeBackDrop(){return new bi({className:"offcanvas-backdrop",isVisible:this._config.backdrop,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:()=>this.hide()})}_initializeFocusTrap(){return new Ai({trapElement:this._element})}_addEventListeners(){j.on(this._element,"keydown.dismiss.bs.offcanvas",(t=>{this._config.keyboard&&"Escape"===t.key&&this.hide()}))}static jQueryInterface(t){return this.each((function(){const e=Fi.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}j.on(document,"click.bs.offcanvas.data-api",'[data-bs-toggle="offcanvas"]',(function(t){const e=n(this);if(["A","AREA"].includes(this.tagName)&&t.preventDefault(),c(this))return;j.one(e,qi,(()=>{l(this)&&this.focus()}));const i=V.findOne(zi);i&&i!==e&&Fi.getInstance(i).hide(),Fi.getOrCreateInstance(e).toggle(this)})),j.on(window,"load.bs.offcanvas.data-api",(()=>V.find(zi).forEach((t=>Fi.getOrCreateInstance(t).show())))),R(Fi),g(Fi);const Ui=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Vi=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^#&/:?]*(?:[#/?]|$))/i,Ki=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i,Xi=(t,e)=>{const i=t.nodeName.toLowerCase();if(e.includes(i))return!Ui.has(i)||Boolean(Vi.test(t.nodeValue)||Ki.test(t.nodeValue));const n=e.filter((t=>t instanceof RegExp));for(let t=0,e=n.length;t<e;t++)if(n[t].test(i))return!0;return!1};function Yi(t,e,i){if(!t.length)return t;if(i&&"function"==typeof i)return i(t);const n=(new window.DOMParser).parseFromString(t,"text/html"),s=[].concat(...n.body.querySelectorAll("*"));for(let t=0,i=s.length;t<i;t++){const i=s[t],n=i.nodeName.toLowerCase();if(!Object.keys(e).includes(n)){i.remove();continue}const o=[].concat(...i.attributes),r=[].concat(e["*"]||[],e[n]||[]);o.forEach((t=>{Xi(t,r)||i.removeAttribute(t.nodeName)}))}return n.body.innerHTML}const Qi="tooltip",Gi=new Set(["sanitize","allowList","sanitizeFn"]),Zi={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(array|string|function)",container:"(string|element|boolean)",fallbackPlacements:"array",boundary:"(string|element)",customClass:"(string|function)",sanitize:"boolean",sanitizeFn:"(null|function)",allowList:"object",popperConfig:"(null|object|function)"},Ji={AUTO:"auto",TOP:"top",RIGHT:m()?"left":"right",BOTTOM:"bottom",LEFT:m()?"right":"left"},tn={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:[0,0],container:!1,fallbackPlacements:["top","right","bottom","left"],boundary:"clippingParents",customClass:"",sanitize:!0,sanitizeFn:null,allowList:{"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},popperConfig:null},en={HIDE:"hide.bs.tooltip",HIDDEN:"hidden.bs.tooltip",SHOW:"show.bs.tooltip",SHOWN:"shown.bs.tooltip",INSERTED:"inserted.bs.tooltip",CLICK:"click.bs.tooltip",FOCUSIN:"focusin.bs.tooltip",FOCUSOUT:"focusout.bs.tooltip",MOUSEENTER:"mouseenter.bs.tooltip",MOUSELEAVE:"mouseleave.bs.tooltip"},nn="fade",sn="show",on="show",rn="out",an=".tooltip-inner",ln=".modal",cn="hide.bs.modal",hn="hover",dn="focus";class un extends B{constructor(t,e){if(void 0===Fe)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(t),this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this._config=this._getConfig(e),this.tip=null,this._setListeners()}static get Default(){return tn}static get NAME(){return Qi}static get Event(){return en}static get DefaultType(){return Zi}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(t){if(this._isEnabled)if(t){const e=this._initializeOnDelegatedTarget(t);e._activeTrigger.click=!e._activeTrigger.click,e._isWithActiveTrigger()?e._enter(null,e):e._leave(null,e)}else{if(this.getTipElement().classList.contains(sn))return void this._leave(null,this);this._enter(null,this)}}dispose(){clearTimeout(this._timeout),j.off(this._element.closest(ln),cn,this._hideModalHandler),this.tip&&this.tip.remove(),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this.isWithContent()||!this._isEnabled)return;const t=j.trigger(this._element,this.constructor.Event.SHOW),e=h(this._element),i=null===e?this._element.ownerDocument.documentElement.contains(this._element):e.contains(this._element);if(t.defaultPrevented||!i)return;"tooltip"===this.constructor.NAME&&this.tip&&this.getTitle()!==this.tip.querySelector(an).innerHTML&&(this._disposePopper(),this.tip.remove(),this.tip=null);const n=this.getTipElement(),s=(t=>{do{t+=Math.floor(1e6*Math.random())}while(document.getElementById(t));return t})(this.constructor.NAME);n.setAttribute("id",s),this._element.setAttribute("aria-describedby",s),this._config.animation&&n.classList.add(nn);const o="function"==typeof this._config.placement?this._config.placement.call(this,n,this._element):this._config.placement,r=this._getAttachment(o);this._addAttachmentClass(r);const{container:a}=this._config;H.set(n,this.constructor.DATA_KEY,this),this._element.ownerDocument.documentElement.contains(this.tip)||(a.append(n),j.trigger(this._element,this.constructor.Event.INSERTED)),this._popper?this._popper.update():this._popper=qe(this._element,n,this._getPopperConfig(r)),n.classList.add(sn);const l=this._resolvePossibleFunction(this._config.customClass);l&&n.classList.add(...l.split(" ")),"ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach((t=>{j.on(t,"mouseover",d)}));const c=this.tip.classList.contains(nn);this._queueCallback((()=>{const t=this._hoverState;this._hoverState=null,j.trigger(this._element,this.constructor.Event.SHOWN),t===rn&&this._leave(null,this)}),this.tip,c)}hide(){if(!this._popper)return;const t=this.getTipElement();if(j.trigger(this._element,this.constructor.Event.HIDE).defaultPrevented)return;t.classList.remove(sn),"ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach((t=>j.off(t,"mouseover",d))),this._activeTrigger.click=!1,this._activeTrigger.focus=!1,this._activeTrigger.hover=!1;const e=this.tip.classList.contains(nn);this._queueCallback((()=>{this._isWithActiveTrigger()||(this._hoverState!==on&&t.remove(),this._cleanTipClass(),this._element.removeAttribute("aria-describedby"),j.trigger(this._element,this.constructor.Event.HIDDEN),this._disposePopper())}),this.tip,e),this._hoverState=""}update(){null!==this._popper&&this._popper.update()}isWithContent(){return Boolean(this.getTitle())}getTipElement(){if(this.tip)return this.tip;const t=document.createElement("div");t.innerHTML=this._config.template;const e=t.children[0];return this.setContent(e),e.classList.remove(nn,sn),this.tip=e,this.tip}setContent(t){this._sanitizeAndSetContent(t,this.getTitle(),an)}_sanitizeAndSetContent(t,e,i){const n=V.findOne(i,t);e||!n?this.setElementContent(n,e):n.remove()}setElementContent(t,e){if(null!==t)return o(e)?(e=r(e),void(this._config.html?e.parentNode!==t&&(t.innerHTML="",t.append(e)):t.textContent=e.textContent)):void(this._config.html?(this._config.sanitize&&(e=Yi(e,this._config.allowList,this._config.sanitizeFn)),t.innerHTML=e):t.textContent=e)}getTitle(){const t=this._element.getAttribute("data-bs-original-title")||this._config.title;return this._resolvePossibleFunction(t)}updateAttachment(t){return"right"===t?"end":"left"===t?"start":t}_initializeOnDelegatedTarget(t,e){return e||this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_getOffset(){const{offset:t}=this._config;return"string"==typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"==typeof t?e=>t(e,this._element):t}_resolvePossibleFunction(t){return"function"==typeof t?t.call(this._element):t}_getPopperConfig(t){const e={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"onChange",enabled:!0,phase:"afterWrite",fn:t=>this._handlePopperPlacementChange(t)}],onFirstUpdate:t=>{t.options.placement!==t.placement&&this._handlePopperPlacementChange(t)}};return{...e,..."function"==typeof this._config.popperConfig?this._config.popperConfig(e):this._config.popperConfig}}_addAttachmentClass(t){this.getTipElement().classList.add(`${this._getBasicClassPrefix()}-${this.updateAttachment(t)}`)}_getAttachment(t){return Ji[t.toUpperCase()]}_setListeners(){this._config.trigger.split(" ").forEach((t=>{if("click"===t)j.on(this._element,this.constructor.Event.CLICK,this._config.selector,(t=>this.toggle(t)));else if("manual"!==t){const e=t===hn?this.constructor.Event.MOUSEENTER:this.constructor.Event.FOCUSIN,i=t===hn?this.constructor.Event.MOUSELEAVE:this.constructor.Event.FOCUSOUT;j.on(this._element,e,this._config.selector,(t=>this._enter(t))),j.on(this._element,i,this._config.selector,(t=>this._leave(t)))}})),this._hideModalHandler=()=>{this._element&&this.hide()},j.on(this._element.closest(ln),cn,this._hideModalHandler),this._config.selector?this._config={...this._config,trigger:"manual",selector:""}:this._fixTitle()}_fixTitle(){const t=this._element.getAttribute("title"),e=typeof this._element.getAttribute("data-bs-original-title");(t||"string"!==e)&&(this._element.setAttribute("data-bs-original-title",t||""),!t||this._element.getAttribute("aria-label")||this._element.textContent||this._element.setAttribute("aria-label",t),this._element.setAttribute("title",""))}_enter(t,e){e=this._initializeOnDelegatedTarget(t,e),t&&(e._activeTrigger["focusin"===t.type?dn:hn]=!0),e.getTipElement().classList.contains(sn)||e._hoverState===on?e._hoverState=on:(clearTimeout(e._timeout),e._hoverState=on,e._config.delay&&e._config.delay.show?e._timeout=setTimeout((()=>{e._hoverState===on&&e.show()}),e._config.delay.show):e.show())}_leave(t,e){e=this._initializeOnDelegatedTarget(t,e),t&&(e._activeTrigger["focusout"===t.type?dn:hn]=e._element.contains(t.relatedTarget)),e._isWithActiveTrigger()||(clearTimeout(e._timeout),e._hoverState=rn,e._config.delay&&e._config.delay.hide?e._timeout=setTimeout((()=>{e._hoverState===rn&&e.hide()}),e._config.delay.hide):e.hide())}_isWithActiveTrigger(){for(const t in this._activeTrigger)if(this._activeTrigger[t])return!0;return!1}_getConfig(t){const e=U.getDataAttributes(this._element);return Object.keys(e).forEach((t=>{Gi.has(t)&&delete e[t]})),(t={...this.constructor.Default,...e,..."object"==typeof t&&t?t:{}}).container=!1===t.container?document.body:r(t.container),"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),"number"==typeof t.title&&(t.title=t.title.toString()),"number"==typeof t.content&&(t.content=t.content.toString()),a(Qi,t,this.constructor.DefaultType),t.sanitize&&(t.template=Yi(t.template,t.allowList,t.sanitizeFn)),t}_getDelegateConfig(){const t={};for(const e in this._config)this.constructor.Default[e]!==this._config[e]&&(t[e]=this._config[e]);return t}_cleanTipClass(){const t=this.getTipElement(),e=new RegExp(`(^|\\s)${this._getBasicClassPrefix()}\\S+`,"g"),i=t.getAttribute("class").match(e);null!==i&&i.length>0&&i.map((t=>t.trim())).forEach((e=>t.classList.remove(e)))}_getBasicClassPrefix(){return"bs-tooltip"}_handlePopperPlacementChange(t){const{state:e}=t;e&&(this.tip=e.elements.popper,this._cleanTipClass(),this._addAttachmentClass(this._getAttachment(e.placement)))}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null)}static jQueryInterface(t){return this.each((function(){const e=un.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}g(un);const fn={...un.Default,placement:"right",offset:[0,8],trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'},pn={...un.DefaultType,content:"(string|element|function)"},mn={HIDE:"hide.bs.popover",HIDDEN:"hidden.bs.popover",SHOW:"show.bs.popover",SHOWN:"shown.bs.popover",INSERTED:"inserted.bs.popover",CLICK:"click.bs.popover",FOCUSIN:"focusin.bs.popover",FOCUSOUT:"focusout.bs.popover",MOUSEENTER:"mouseenter.bs.popover",MOUSELEAVE:"mouseleave.bs.popover"};class gn extends un{static get Default(){return fn}static get NAME(){return"popover"}static get Event(){return mn}static get DefaultType(){return pn}isWithContent(){return this.getTitle()||this._getContent()}setContent(t){this._sanitizeAndSetContent(t,this.getTitle(),".popover-header"),this._sanitizeAndSetContent(t,this._getContent(),".popover-body")}_getContent(){return this._resolvePossibleFunction(this._config.content)}_getBasicClassPrefix(){return"bs-popover"}static jQueryInterface(t){return this.each((function(){const e=gn.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}g(gn);const _n="scrollspy",bn={offset:10,method:"auto",target:""},vn={offset:"number",method:"string",target:"(string|element)"},yn="active",wn=".nav-link, .list-group-item, .dropdown-item",En="position";class An extends B{constructor(t,e){super(t),this._scrollElement="BODY"===this._element.tagName?window:this._element,this._config=this._getConfig(e),this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,j.on(this._scrollElement,"scroll.bs.scrollspy",(()=>this._process())),this.refresh(),this._process()}static get Default(){return bn}static get NAME(){return _n}refresh(){const t=this._scrollElement===this._scrollElement.window?"offset":En,e="auto"===this._config.method?t:this._config.method,n=e===En?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),V.find(wn,this._config.target).map((t=>{const s=i(t),o=s?V.findOne(s):null;if(o){const t=o.getBoundingClientRect();if(t.width||t.height)return[U[e](o).top+n,s]}return null})).filter((t=>t)).sort(((t,e)=>t[0]-e[0])).forEach((t=>{this._offsets.push(t[0]),this._targets.push(t[1])}))}dispose(){j.off(this._scrollElement,".bs.scrollspy"),super.dispose()}_getConfig(t){return(t={...bn,...U.getDataAttributes(this._element),..."object"==typeof t&&t?t:{}}).target=r(t.target)||document.documentElement,a(_n,t,vn),t}_getScrollTop(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}_getScrollHeight(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}_getOffsetHeight(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}_process(){const t=this._getScrollTop()+this._config.offset,e=this._getScrollHeight(),i=this._config.offset+e-this._getOffsetHeight();if(this._scrollHeight!==e&&this.refresh(),t>=i){const t=this._targets[this._targets.length-1];this._activeTarget!==t&&this._activate(t)}else{if(this._activeTarget&&t<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(let e=this._offsets.length;e--;)this._activeTarget!==this._targets[e]&&t>=this._offsets[e]&&(void 0===this._offsets[e+1]||t<this._offsets[e+1])&&this._activate(this._targets[e])}}_activate(t){this._activeTarget=t,this._clear();const e=wn.split(",").map((e=>`${e}[data-bs-target="${t}"],${e}[href="${t}"]`)),i=V.findOne(e.join(","),this._config.target);i.classList.add(yn),i.classList.contains("dropdown-item")?V.findOne(".dropdown-toggle",i.closest(".dropdown")).classList.add(yn):V.parents(i,".nav, .list-group").forEach((t=>{V.prev(t,".nav-link, .list-group-item").forEach((t=>t.classList.add(yn))),V.prev(t,".nav-item").forEach((t=>{V.children(t,".nav-link").forEach((t=>t.classList.add(yn)))}))})),j.trigger(this._scrollElement,"activate.bs.scrollspy",{relatedTarget:t})}_clear(){V.find(wn,this._config.target).filter((t=>t.classList.contains(yn))).forEach((t=>t.classList.remove(yn)))}static jQueryInterface(t){return this.each((function(){const e=An.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}j.on(window,"load.bs.scrollspy.data-api",(()=>{V.find('[data-bs-spy="scroll"]').forEach((t=>new An(t)))})),g(An);const Tn="active",On="fade",Cn="show",kn=".active",Ln=":scope > li > .active";class xn extends B{static get NAME(){return"tab"}show(){if(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&this._element.classList.contains(Tn))return;let t;const e=n(this._element),i=this._element.closest(".nav, .list-group");if(i){const e="UL"===i.nodeName||"OL"===i.nodeName?Ln:kn;t=V.find(e,i),t=t[t.length-1]}const s=t?j.trigger(t,"hide.bs.tab",{relatedTarget:this._element}):null;if(j.trigger(this._element,"show.bs.tab",{relatedTarget:t}).defaultPrevented||null!==s&&s.defaultPrevented)return;this._activate(this._element,i);const o=()=>{j.trigger(t,"hidden.bs.tab",{relatedTarget:this._element}),j.trigger(this._element,"shown.bs.tab",{relatedTarget:t})};e?this._activate(e,e.parentNode,o):o()}_activate(t,e,i){const n=(!e||"UL"!==e.nodeName&&"OL"!==e.nodeName?V.children(e,kn):V.find(Ln,e))[0],s=i&&n&&n.classList.contains(On),o=()=>this._transitionComplete(t,n,i);n&&s?(n.classList.remove(Cn),this._queueCallback(o,t,!0)):o()}_transitionComplete(t,e,i){if(e){e.classList.remove(Tn);const t=V.findOne(":scope > .dropdown-menu .active",e.parentNode);t&&t.classList.remove(Tn),"tab"===e.getAttribute("role")&&e.setAttribute("aria-selected",!1)}t.classList.add(Tn),"tab"===t.getAttribute("role")&&t.setAttribute("aria-selected",!0),u(t),t.classList.contains(On)&&t.classList.add(Cn);let n=t.parentNode;if(n&&"LI"===n.nodeName&&(n=n.parentNode),n&&n.classList.contains("dropdown-menu")){const e=t.closest(".dropdown");e&&V.find(".dropdown-toggle",e).forEach((t=>t.classList.add(Tn))),t.setAttribute("aria-expanded",!0)}i&&i()}static jQueryInterface(t){return this.each((function(){const e=xn.getOrCreateInstance(this);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}j.on(document,"click.bs.tab.data-api",'[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',(function(t){["A","AREA"].includes(this.tagName)&&t.preventDefault(),c(this)||xn.getOrCreateInstance(this).show()})),g(xn);const Dn="toast",Sn="hide",Nn="show",In="showing",Pn={animation:"boolean",autohide:"boolean",delay:"number"},jn={animation:!0,autohide:!0,delay:5e3};class Mn extends B{constructor(t,e){super(t),this._config=this._getConfig(e),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get DefaultType(){return Pn}static get Default(){return jn}static get NAME(){return Dn}show(){j.trigger(this._element,"show.bs.toast").defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Sn),u(this._element),this._element.classList.add(Nn),this._element.classList.add(In),this._queueCallback((()=>{this._element.classList.remove(In),j.trigger(this._element,"shown.bs.toast"),this._maybeScheduleHide()}),this._element,this._config.animation))}hide(){this._element.classList.contains(Nn)&&(j.trigger(this._element,"hide.bs.toast").defaultPrevented||(this._element.classList.add(In),this._queueCallback((()=>{this._element.classList.add(Sn),this._element.classList.remove(In),this._element.classList.remove(Nn),j.trigger(this._element,"hidden.bs.toast")}),this._element,this._config.animation)))}dispose(){this._clearTimeout(),this._element.classList.contains(Nn)&&this._element.classList.remove(Nn),super.dispose()}_getConfig(t){return t={...jn,...U.getDataAttributes(this._element),..."object"==typeof t&&t?t:{}},a(Dn,t,this.constructor.DefaultType),t}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout((()=>{this.hide()}),this._config.delay)))}_onInteraction(t,e){switch(t.type){case"mouseover":case"mouseout":this._hasMouseInteraction=e;break;case"focusin":case"focusout":this._hasKeyboardInteraction=e}if(e)return void this._clearTimeout();const i=t.relatedTarget;this._element===i||this._element.contains(i)||this._maybeScheduleHide()}_setListeners(){j.on(this._element,"mouseover.bs.toast",(t=>this._onInteraction(t,!0))),j.on(this._element,"mouseout.bs.toast",(t=>this._onInteraction(t,!1))),j.on(this._element,"focusin.bs.toast",(t=>this._onInteraction(t,!0))),j.on(this._element,"focusout.bs.toast",(t=>this._onInteraction(t,!1)))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each((function(){const e=Mn.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}return R(Mn),g(Mn),{Alert:W,Button:z,Carousel:st,Collapse:pt,Dropdown:hi,Modal:Hi,Offcanvas:Fi,Popover:gn,ScrollSpy:An,Tab:xn,Toast:Mn,Tooltip:un}}));var fabric=fabric||{version:'5.1.0'};if(typeof exports!=='undefined'){exports.fabric=fabric;}
else if(typeof define==='function'&&define.amd){define([],function(){return fabric;});}
if(typeof document!=='undefined'&&typeof window!=='undefined'){if(document instanceof(typeof HTMLDocument!=='undefined'?HTMLDocument:Document)){fabric.document=document;}
else{fabric.document=document.implementation.createHTMLDocument('');}
fabric.window=window;}
else{var jsdom=require('jsdom');var virtualWindow=new jsdom.JSDOM(decodeURIComponent('%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E'),{features:{FetchExternalResources:['img']},resources:'usable'}).window;fabric.document=virtualWindow.document;fabric.jsdomImplForWrapper=require('jsdom/lib/jsdom/living/generated/utils').implForWrapper;fabric.nodeCanvas=require('jsdom/lib/jsdom/utils').Canvas;fabric.window=virtualWindow;DOMParser=fabric.window.DOMParser;}
fabric.isTouchSupported='ontouchstart'in fabric.window||'ontouchstart'in fabric.document||(fabric.window&&fabric.window.navigator&&fabric.window.navigator.maxTouchPoints>0);fabric.isLikelyNode=typeof Buffer!=='undefined'&&typeof window==='undefined';fabric.SHARED_ATTRIBUTES=['display','transform','fill','fill-opacity','fill-rule','opacity','stroke','stroke-dasharray','stroke-linecap','stroke-dashoffset','stroke-linejoin','stroke-miterlimit','stroke-opacity','stroke-width','id','paint-order','vector-effect','instantiated_by_use','clip-path',];fabric.DPI=96;fabric.reNum='(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)';fabric.commaWsp='(?:\\s+,?\\s*|,\\s*)';fabric.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig;fabric.reNonWord=/[ \n\.,;!\?\-]/;fabric.fontPaths={};fabric.iMatrix=[1,0,0,1,0,0];fabric.svgNS='http://www.w3.org/2000/svg';fabric.perfLimitSizeTotal=2097152;fabric.maxCacheSideLimit=4096;fabric.minCacheSideLimit=256;fabric.charWidthsCache={};fabric.textureSize=2048;fabric.disableStyleCopyPaste=false;fabric.enableGLFiltering=true;fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;fabric.browserShadowBlurConstant=1;fabric.arcToSegmentsCache={};fabric.boundsOfCurveCache={};fabric.cachesBoundsOfCurve=true;fabric.forceGLPutImageData=false;fabric.initFilterBackend=function(){if(fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)){console.log('max texture size: '+fabric.maxTextureSize);return(new fabric.WebglFilterBackend({tileSize:fabric.textureSize}));}
else if(fabric.Canvas2dFilterBackend){return(new fabric.Canvas2dFilterBackend());}};if(typeof document!=='undefined'&&typeof window!=='undefined'){window.fabric=fabric;}
(function(){function _removeEventListener(eventName,handler){if(!this.__eventListeners[eventName]){return;}
var eventListener=this.__eventListeners[eventName];if(handler){eventListener[eventListener.indexOf(handler)]=false;}
else{fabric.util.array.fill(eventListener,false);}}
function on(eventName,handler){if(!this.__eventListeners){this.__eventListeners={};}
if(arguments.length===1){for(var prop in eventName){this.on(prop,eventName[prop]);}}
else{if(!this.__eventListeners[eventName]){this.__eventListeners[eventName]=[];}
this.__eventListeners[eventName].push(handler);}
return this;}
function _once(eventName,handler){var _handler=function(){handler.apply(this,arguments);this.off(eventName,_handler);}.bind(this);this.on(eventName,_handler);}
function once(eventName,handler){if(arguments.length===1){for(var prop in eventName){_once.call(this,prop,eventName[prop]);}}
else{_once.call(this,eventName,handler);}
return this;}
function off(eventName,handler){if(!this.__eventListeners){return this;}
if(arguments.length===0){for(eventName in this.__eventListeners){_removeEventListener.call(this,eventName);}}
else if(arguments.length===1&&typeof arguments[0]==='object'){for(var prop in eventName){_removeEventListener.call(this,prop,eventName[prop]);}}
else{_removeEventListener.call(this,eventName,handler);}
return this;}
function fire(eventName,options){if(!this.__eventListeners){return this;}
var listenersForEvent=this.__eventListeners[eventName];if(!listenersForEvent){return this;}
for(var i=0,len=listenersForEvent.length;i<len;i++){listenersForEvent[i]&&listenersForEvent[i].call(this,options||{});}
this.__eventListeners[eventName]=listenersForEvent.filter(function(value){return value!==false;});return this;}
fabric.Observable={fire:fire,on:on,once:once,off:off,};})();fabric.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded){for(var i=0,length=arguments.length;i<length;i++){this._onObjectAdded(arguments[i]);}}
this.renderOnAddRemove&&this.requestRenderAll();return this;},insertAt:function(object,index,nonSplicing){var objects=this._objects;if(nonSplicing){objects[index]=object;}
else{objects.splice(index,0,object);}
this._onObjectAdded&&this._onObjectAdded(object);this.renderOnAddRemove&&this.requestRenderAll();return this;},remove:function(){var objects=this._objects,index,somethingRemoved=false;for(var i=0,length=arguments.length;i<length;i++){index=objects.indexOf(arguments[i]);if(index!==-1){somethingRemoved=true;objects.splice(index,1);this._onObjectRemoved&&this._onObjectRemoved(arguments[i]);}}
this.renderOnAddRemove&&somethingRemoved&&this.requestRenderAll();return this;},forEachObject:function(callback,context){var objects=this.getObjects();for(var i=0,len=objects.length;i<len;i++){callback.call(context,objects[i],i,objects);}
return this;},getObjects:function(type){if(typeof type==='undefined'){return this._objects.concat();}
return this._objects.filter(function(o){return o.type===type;});},item:function(index){return this._objects[index];},isEmpty:function(){return this._objects.length===0;},size:function(){return this._objects.length;},contains:function(object,deep){if(this._objects.indexOf(object)>-1){return true;}
else if(deep){return this._objects.some(function(obj){return typeof obj.contains==='function'&&obj.contains(object,true);});}
return false;},complexity:function(){return this._objects.reduce(function(memo,current){memo+=current.complexity?current.complexity():0;return memo;},0);}};fabric.CommonMethods={_setOptions:function(options){for(var prop in options){this.set(prop,options[prop]);}},_initGradient:function(filler,property){if(filler&&filler.colorStops&&!(filler instanceof fabric.Gradient)){this.set(property,new fabric.Gradient(filler));}},_initPattern:function(filler,property,callback){if(filler&&filler.source&&!(filler instanceof fabric.Pattern)){this.set(property,new fabric.Pattern(filler,callback));}
else{callback&&callback();}},_setObject:function(obj){for(var prop in obj){this._set(prop,obj[prop]);}},set:function(key,value){if(typeof key==='object'){this._setObject(key);}
else{this._set(key,value);}
return this;},_set:function(key,value){this[key]=value;},toggle:function(property){var value=this.get(property);if(typeof value==='boolean'){this.set(property,!value);}
return this;},get:function(property){return this[property];}};(function(global){var sqrt=Math.sqrt,atan2=Math.atan2,pow=Math.pow,PiBy180=Math.PI/180,PiBy2=Math.PI/2;fabric.util={cos:function(angle){if(angle===0){return 1;}
if(angle<0){angle=-angle;}
var angleSlice=angle/PiBy2;switch(angleSlice){case 1:case 3:return 0;case 2:return-1;}
return Math.cos(angle);},sin:function(angle){if(angle===0){return 0;}
var angleSlice=angle/PiBy2,sign=1;if(angle<0){sign=-1;}
switch(angleSlice){case 1:return sign;case 2:return 0;case 3:return-sign;}
return Math.sin(angle);},removeFromArray:function(array,value){var idx=array.indexOf(value);if(idx!==-1){array.splice(idx,1);}
return array;},getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min;},degreesToRadians:function(degrees){return degrees*PiBy180;},radiansToDegrees:function(radians){return radians/PiBy180;},rotatePoint:function(point,origin,radians){var newPoint=new fabric.Point(point.x-origin.x,point.y-origin.y),v=fabric.util.rotateVector(newPoint,radians);return new fabric.Point(v.x,v.y).addEquals(origin);},rotateVector:function(vector,radians){var sin=fabric.util.sin(radians),cos=fabric.util.cos(radians),rx=vector.x*cos-vector.y*sin,ry=vector.x*sin+vector.y*cos;return{x:rx,y:ry};},createVector:function(from,to){return new fabric.Point(to.x-from.x,to.y-from.y);},calcAngleBetweenVectors:function(a,b){return Math.acos((a.x*b.x+a.y*b.y)/(Math.hypot(a.x,a.y)*Math.hypot(b.x,b.y)));},getHatVector:function(v){return new fabric.Point(v.x,v.y).multiply(1/Math.hypot(v.x,v.y));},getBisector:function(A,B,C){var AB=fabric.util.createVector(A,B),AC=fabric.util.createVector(A,C);var alpha=fabric.util.calcAngleBetweenVectors(AB,AC);var ro=fabric.util.calcAngleBetweenVectors(fabric.util.rotateVector(AB,alpha),AC);var phi=alpha*(ro===0?1:-1)/2;return{vector:fabric.util.getHatVector(fabric.util.rotateVector(AB,phi)),angle:alpha};},projectStrokeOnPoints:function(points,options,openPath){var coords=[],s=options.strokeWidth/2,strokeUniformScalar=options.strokeUniform?new fabric.Point(1/options.scaleX,1/options.scaleY):new fabric.Point(1,1),getStrokeHatVector=function(v){var scalar=s/(Math.hypot(v.x,v.y));return new fabric.Point(v.x*scalar*strokeUniformScalar.x,v.y*scalar*strokeUniformScalar.y);};if(points.length<=1){return coords;}
points.forEach(function(p,index){var A=new fabric.Point(p.x,p.y),B,C;if(index===0){C=points[index+1];B=openPath?getStrokeHatVector(fabric.util.createVector(C,A)).addEquals(A):points[points.length-1];}
else if(index===points.length-1){B=points[index-1];C=openPath?getStrokeHatVector(fabric.util.createVector(B,A)).addEquals(A):points[0];}
else{B=points[index-1];C=points[index+1];}
var bisector=fabric.util.getBisector(A,B,C),bisectorVector=bisector.vector,alpha=bisector.angle,scalar,miterVector;if(options.strokeLineJoin==='miter'){scalar=-s/Math.sin(alpha/2);miterVector=new fabric.Point(bisectorVector.x*scalar*strokeUniformScalar.x,bisectorVector.y*scalar*strokeUniformScalar.y);if(Math.hypot(miterVector.x,miterVector.y)/s<=options.strokeMiterLimit){coords.push(A.add(miterVector));coords.push(A.subtract(miterVector));return;}}
scalar=-s*Math.SQRT2;miterVector=new fabric.Point(bisectorVector.x*scalar*strokeUniformScalar.x,bisectorVector.y*scalar*strokeUniformScalar.y);coords.push(A.add(miterVector));coords.push(A.subtract(miterVector));});return coords;},transformPoint:function(p,t,ignoreOffset){if(ignoreOffset){return new fabric.Point(t[0]*p.x+t[2]*p.y,t[1]*p.x+t[3]*p.y);}
return new fabric.Point(t[0]*p.x+t[2]*p.y+t[4],t[1]*p.x+t[3]*p.y+t[5]);},makeBoundingBoxFromPoints:function(points,transform){if(transform){for(var i=0;i<points.length;i++){points[i]=fabric.util.transformPoint(points[i],transform);}}
var xPoints=[points[0].x,points[1].x,points[2].x,points[3].x],minX=fabric.util.array.min(xPoints),maxX=fabric.util.array.max(xPoints),width=maxX-minX,yPoints=[points[0].y,points[1].y,points[2].y,points[3].y],minY=fabric.util.array.min(yPoints),maxY=fabric.util.array.max(yPoints),height=maxY-minY;return{left:minX,top:minY,width:width,height:height};},invertTransform:function(t){var a=1/(t[0]*t[3]-t[1]*t[2]),r=[a*t[3],-a*t[1],-a*t[2],a*t[0]],o=fabric.util.transformPoint({x:t[4],y:t[5]},r,true);r[4]=-o.x;r[5]=-o.y;return r;},toFixed:function(number,fractionDigits){return parseFloat(Number(number).toFixed(fractionDigits));},parseUnit:function(value,fontSize){var unit=/\D{0,2}$/.exec(value),number=parseFloat(value);if(!fontSize){fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE;}
switch(unit[0]){case'mm':return number*fabric.DPI/25.4;case'cm':return number*fabric.DPI/2.54;case'in':return number*fabric.DPI;case'pt':return number*fabric.DPI/72;case'pc':return number*fabric.DPI/72*12;case'em':return number*fontSize;default:return number;}},falseFunction:function(){return false;},getKlass:function(type,namespace){type=fabric.util.string.camelize(type.charAt(0).toUpperCase()+type.slice(1));return fabric.util.resolveNamespace(namespace)[type];},getSvgAttributes:function(type){var attributes=['instantiated_by_use','style','id','class'];switch(type){case'linearGradient':attributes=attributes.concat(['x1','y1','x2','y2','gradientUnits','gradientTransform']);break;case'radialGradient':attributes=attributes.concat(['gradientUnits','gradientTransform','cx','cy','r','fx','fy','fr']);break;case'stop':attributes=attributes.concat(['offset','stop-color','stop-opacity']);break;}
return attributes;},resolveNamespace:function(namespace){if(!namespace){return fabric;}
var parts=namespace.split('.'),len=parts.length,i,obj=global||fabric.window;for(i=0;i<len;++i){obj=obj[parts[i]];}
return obj;},loadImage:function(url,callback,context,crossOrigin){if(!url){callback&&callback.call(context,url);return;}
var img=fabric.util.createImage();var onLoadCallback=function(){callback&&callback.call(context,img,false);img=img.onload=img.onerror=null;};img.onload=onLoadCallback;img.onerror=function(){fabric.log('Error loading '+img.src);callback&&callback.call(context,null,true);img=img.onload=img.onerror=null;};if(url.indexOf('data')!==0&&crossOrigin!==undefined&&crossOrigin!==null){img.crossOrigin=crossOrigin;}
if(url.substring(0,14)==='data:image/svg'){img.onload=null;fabric.util.loadImageInDom(img,onLoadCallback);}
img.src=url;},loadImageInDom:function(img,onLoadCallback){var div=fabric.document.createElement('div');div.style.width=div.style.height='1px';div.style.left=div.style.top='-100%';div.style.position='absolute';div.appendChild(img);fabric.document.querySelector('body').appendChild(div);img.onload=function(){onLoadCallback();div.parentNode.removeChild(div);div=null;};},enlivenObjects:function(objects,callback,namespace,reviver){objects=objects||[];var enlivenedObjects=[],numLoadedObjects=0,numTotalObjects=objects.length;function onLoaded(){if(++numLoadedObjects===numTotalObjects){callback&&callback(enlivenedObjects.filter(function(obj){return obj;}));}}
if(!numTotalObjects){callback&&callback(enlivenedObjects);return;}
objects.forEach(function(o,index){if(!o||!o.type){onLoaded();return;}
var klass=fabric.util.getKlass(o.type,namespace);klass.fromObject(o,function(obj,error){error||(enlivenedObjects[index]=obj);reviver&&reviver(o,obj,error);onLoaded();});});},enlivenObjectEnlivables:function(object,context,callback){var enlivenProps=fabric.Object.ENLIVEN_PROPS.filter(function(key){return!!object[key];});fabric.util.enlivenObjects(enlivenProps.map(function(key){return object[key];}),function(enlivedProps){var objects={};enlivenProps.forEach(function(key,index){objects[key]=enlivedProps[index];context&&(context[key]=enlivedProps[index]);});callback&&callback(objects);});},enlivenPatterns:function(patterns,callback){patterns=patterns||[];function onLoaded(){if(++numLoadedPatterns===numPatterns){callback&&callback(enlivenedPatterns);}}
var enlivenedPatterns=[],numLoadedPatterns=0,numPatterns=patterns.length;if(!numPatterns){callback&&callback(enlivenedPatterns);return;}
patterns.forEach(function(p,index){if(p&&p.source){new fabric.Pattern(p,function(pattern){enlivenedPatterns[index]=pattern;onLoaded();});}
else{enlivenedPatterns[index]=p;onLoaded();}});},groupSVGElements:function(elements,options,path){var object;if(elements&&elements.length===1){return elements[0];}
if(options){if(options.width&&options.height){options.centerPoint={x:options.width/2,y:options.height/2};}
else{delete options.width;delete options.height;}}
object=new fabric.Group(elements,options);if(typeof path!=='undefined'){object.sourcePath=path;}
return object;},populateWithProperties:function(source,destination,properties){if(properties&&Object.prototype.toString.call(properties)==='[object Array]'){for(var i=0,len=properties.length;i<len;i++){if(properties[i]in source){destination[properties[i]]=source[properties[i]];}}}},createCanvasElement:function(){return fabric.document.createElement('canvas');},copyCanvasElement:function(canvas){var newCanvas=fabric.util.createCanvasElement();newCanvas.width=canvas.width;newCanvas.height=canvas.height;newCanvas.getContext('2d').drawImage(canvas,0,0);return newCanvas;},toDataURL:function(canvasEl,format,quality){return canvasEl.toDataURL('image/'+format,quality);},createImage:function(){return fabric.document.createElement('img');},multiplyTransformMatrices:function(a,b,is2x2){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],is2x2?0:a[0]*b[4]+a[2]*b[5]+a[4],is2x2?0:a[1]*b[4]+a[3]*b[5]+a[5]];},qrDecompose:function(a){var angle=atan2(a[1],a[0]),denom=pow(a[0],2)+pow(a[1],2),scaleX=sqrt(denom),scaleY=(a[0]*a[3]-a[2]*a[1])/scaleX,skewX=atan2(a[0]*a[2]+a[1]*a[3],denom);return{angle:angle/PiBy180,scaleX:scaleX,scaleY:scaleY,skewX:skewX/PiBy180,skewY:0,translateX:a[4],translateY:a[5]};},calcRotateMatrix:function(options){if(!options.angle){return fabric.iMatrix.concat();}
var theta=fabric.util.degreesToRadians(options.angle),cos=fabric.util.cos(theta),sin=fabric.util.sin(theta);return[cos,sin,-sin,cos,0,0];},calcDimensionsMatrix:function(options){var scaleX=typeof options.scaleX==='undefined'?1:options.scaleX,scaleY=typeof options.scaleY==='undefined'?1:options.scaleY,scaleMatrix=[options.flipX?-scaleX:scaleX,0,0,options.flipY?-scaleY:scaleY,0,0],multiply=fabric.util.multiplyTransformMatrices,degreesToRadians=fabric.util.degreesToRadians;if(options.skewX){scaleMatrix=multiply(scaleMatrix,[1,0,Math.tan(degreesToRadians(options.skewX)),1],true);}
if(options.skewY){scaleMatrix=multiply(scaleMatrix,[1,Math.tan(degreesToRadians(options.skewY)),0,1],true);}
return scaleMatrix;},composeMatrix:function(options){var matrix=[1,0,0,1,options.translateX||0,options.translateY||0],multiply=fabric.util.multiplyTransformMatrices;if(options.angle){matrix=multiply(matrix,fabric.util.calcRotateMatrix(options));}
if(options.scaleX!==1||options.scaleY!==1||options.skewX||options.skewY||options.flipX||options.flipY){matrix=multiply(matrix,fabric.util.calcDimensionsMatrix(options));}
return matrix;},resetObjectTransform:function(target){target.scaleX=1;target.scaleY=1;target.skewX=0;target.skewY=0;target.flipX=false;target.flipY=false;target.rotate(0);},saveObjectTransform:function(target){return{scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,angle:target.angle,left:target.left,flipX:target.flipX,flipY:target.flipY,top:target.top};},isTransparent:function(ctx,x,y,tolerance){if(tolerance>0){if(x>tolerance){x-=tolerance;}
else{x=0;}
if(y>tolerance){y-=tolerance;}
else{y=0;}}
var _isTransparent=true,i,temp,imageData=ctx.getImageData(x,y,(tolerance*2)||1,(tolerance*2)||1),l=imageData.data.length;for(i=3;i<l;i+=4){temp=imageData.data[i];_isTransparent=temp<=0;if(_isTransparent===false){break;}}
imageData=null;return _isTransparent;},parsePreserveAspectRatioAttribute:function(attribute){var meetOrSlice='meet',alignX='Mid',alignY='Mid',aspectRatioAttrs=attribute.split(' '),align;if(aspectRatioAttrs&&aspectRatioAttrs.length){meetOrSlice=aspectRatioAttrs.pop();if(meetOrSlice!=='meet'&&meetOrSlice!=='slice'){align=meetOrSlice;meetOrSlice='meet';}
else if(aspectRatioAttrs.length){align=aspectRatioAttrs.pop();}}
alignX=align!=='none'?align.slice(1,4):'none';alignY=align!=='none'?align.slice(5,8):'none';return{meetOrSlice:meetOrSlice,alignX:alignX,alignY:alignY};},clearFabricFontCache:function(fontFamily){fontFamily=(fontFamily||'').toLowerCase();if(!fontFamily){fabric.charWidthsCache={};}
else if(fabric.charWidthsCache[fontFamily]){delete fabric.charWidthsCache[fontFamily];}},limitDimsByArea:function(ar,maximumArea){var roughWidth=Math.sqrt(maximumArea*ar),perfLimitSizeY=Math.floor(maximumArea/roughWidth);return{x:Math.floor(roughWidth),y:perfLimitSizeY};},capValue:function(min,value,max){return Math.max(min,Math.min(value,max));},findScaleToFit:function(source,destination){return Math.min(destination.width/source.width,destination.height/source.height);},findScaleToCover:function(source,destination){return Math.max(destination.width/source.width,destination.height/source.height);},matrixToSVG:function(transform){return'matrix('+transform.map(function(value){return fabric.util.toFixed(value,fabric.Object.NUM_FRACTION_DIGITS);}).join(' ')+')';},removeTransformFromObject:function(object,transform){var inverted=fabric.util.invertTransform(transform),finalTransform=fabric.util.multiplyTransformMatrices(inverted,object.calcOwnMatrix());fabric.util.applyTransformToObject(object,finalTransform);},addTransformToObject:function(object,transform){fabric.util.applyTransformToObject(object,fabric.util.multiplyTransformMatrices(transform,object.calcOwnMatrix()));},applyTransformToObject:function(object,transform){var options=fabric.util.qrDecompose(transform),center=new fabric.Point(options.translateX,options.translateY);object.flipX=false;object.flipY=false;object.set('scaleX',options.scaleX);object.set('scaleY',options.scaleY);object.skewX=options.skewX;object.skewY=options.skewY;object.angle=options.angle;object.setPositionByOrigin(center,'center','center');},sizeAfterTransform:function(width,height,options){var dimX=width/2,dimY=height/2,points=[{x:-dimX,y:-dimY},{x:dimX,y:-dimY},{x:-dimX,y:dimY},{x:dimX,y:dimY}],transformMatrix=fabric.util.calcDimensionsMatrix(options),bbox=fabric.util.makeBoundingBoxFromPoints(points,transformMatrix);return{x:bbox.width,y:bbox.height,};},mergeClipPaths:function(c1,c2){var a=c1,b=c2;if(a.inverted&&!b.inverted){a=c2;b=c1;}
fabric.util.applyTransformToObject(b,fabric.util.multiplyTransformMatrices(fabric.util.invertTransform(a.calcTransformMatrix()),b.calcTransformMatrix()));var inverted=a.inverted&&b.inverted;if(inverted){a.inverted=b.inverted=false;}
return new fabric.Group([a],{clipPath:b,inverted:inverted});},};})(typeof exports!=='undefined'?exports:this);(function(){var _join=Array.prototype.join,commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},repeatedCommands={m:'l',M:'L'};function segmentToBezier(th2,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY){var costh2=fabric.util.cos(th2),sinth2=fabric.util.sin(th2),costh3=fabric.util.cos(th3),sinth3=fabric.util.sin(th3),toX=cosTh*rx*costh3-sinTh*ry*sinth3+cx1,toY=sinTh*rx*costh3+cosTh*ry*sinth3+cy1,cp1X=fromX+mT*(-cosTh*rx*sinth2-sinTh*ry*costh2),cp1Y=fromY+mT*(-sinTh*rx*sinth2+cosTh*ry*costh2),cp2X=toX+mT*(cosTh*rx*sinth3+sinTh*ry*costh3),cp2Y=toY+mT*(sinTh*rx*sinth3-cosTh*ry*costh3);return['C',cp1X,cp1Y,cp2X,cp2Y,toX,toY];}
function arcToSegments(toX,toY,rx,ry,large,sweep,rotateX){var PI=Math.PI,th=rotateX*PI/180,sinTh=fabric.util.sin(th),cosTh=fabric.util.cos(th),fromX=0,fromY=0;rx=Math.abs(rx);ry=Math.abs(ry);var px=-cosTh*toX*0.5-sinTh*toY*0.5,py=-cosTh*toY*0.5+sinTh*toX*0.5,rx2=rx*rx,ry2=ry*ry,py2=py*py,px2=px*px,pl=rx2*ry2-rx2*py2-ry2*px2,root=0;if(pl<0){var s=Math.sqrt(1-pl/(rx2*ry2));rx*=s;ry*=s;}
else{root=(large===sweep?-1.0:1.0)*Math.sqrt(pl/(rx2*py2+ry2*px2));}
var cx=root*rx*py/ry,cy=-root*ry*px/rx,cx1=cosTh*cx-sinTh*cy+toX*0.5,cy1=sinTh*cx+cosTh*cy+toY*0.5,mTheta=calcVectorAngle(1,0,(px-cx)/rx,(py-cy)/ry),dtheta=calcVectorAngle((px-cx)/rx,(py-cy)/ry,(-px-cx)/rx,(-py-cy)/ry);if(sweep===0&&dtheta>0){dtheta-=2*PI;}
else if(sweep===1&&dtheta<0){dtheta+=2*PI;}
var segments=Math.ceil(Math.abs(dtheta/PI*2)),result=[],mDelta=dtheta/segments,mT=8/3*Math.sin(mDelta/4)*Math.sin(mDelta/4)/Math.sin(mDelta/2),th3=mTheta+mDelta;for(var i=0;i<segments;i++){result[i]=segmentToBezier(mTheta,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY);fromX=result[i][5];fromY=result[i][6];mTheta=th3;th3+=mDelta;}
return result;}
function calcVectorAngle(ux,uy,vx,vy){var ta=Math.atan2(uy,ux),tb=Math.atan2(vy,vx);if(tb>=ta){return tb-ta;}
else{return 2*Math.PI-(ta-tb);}}
function getBoundsOfCurve(x0,y0,x1,y1,x2,y2,x3,y3){var argsString;if(fabric.cachesBoundsOfCurve){argsString=_join.call(arguments);if(fabric.boundsOfCurveCache[argsString]){return fabric.boundsOfCurveCache[argsString];}}
var sqrt=Math.sqrt,min=Math.min,max=Math.max,abs=Math.abs,tvalues=[],bounds=[[],[]],a,b,c,t,t1,t2,b2ac,sqrtb2ac;b=6*x0-12*x1+6*x2;a=-3*x0+9*x1-9*x2+3*x3;c=3*x1-3*x0;for(var i=0;i<2;++i){if(i>0){b=6*y0-12*y1+6*y2;a=-3*y0+9*y1-9*y2+3*y3;c=3*y1-3*y0;}
if(abs(a)<1e-12){if(abs(b)<1e-12){continue;}
t=-c/b;if(0<t&&t<1){tvalues.push(t);}
continue;}
b2ac=b*b-4*c*a;if(b2ac<0){continue;}
sqrtb2ac=sqrt(b2ac);t1=(-b+sqrtb2ac)/(2*a);if(0<t1&&t1<1){tvalues.push(t1);}
t2=(-b-sqrtb2ac)/(2*a);if(0<t2&&t2<1){tvalues.push(t2);}}
var x,y,j=tvalues.length,jlen=j,mt;while(j--){t=tvalues[j];mt=1-t;x=(mt*mt*mt*x0)+(3*mt*mt*t*x1)+(3*mt*t*t*x2)+(t*t*t*x3);bounds[0][j]=x;y=(mt*mt*mt*y0)+(3*mt*mt*t*y1)+(3*mt*t*t*y2)+(t*t*t*y3);bounds[1][j]=y;}
bounds[0][jlen]=x0;bounds[1][jlen]=y0;bounds[0][jlen+1]=x3;bounds[1][jlen+1]=y3;var result=[{x:min.apply(null,bounds[0]),y:min.apply(null,bounds[1])},{x:max.apply(null,bounds[0]),y:max.apply(null,bounds[1])}];if(fabric.cachesBoundsOfCurve){fabric.boundsOfCurveCache[argsString]=result;}
return result;}
function fromArcToBeziers(fx,fy,coords){var rx=coords[1],ry=coords[2],rot=coords[3],large=coords[4],sweep=coords[5],tx=coords[6],ty=coords[7],segsNorm=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot);for(var i=0,len=segsNorm.length;i<len;i++){segsNorm[i][1]+=fx;segsNorm[i][2]+=fy;segsNorm[i][3]+=fx;segsNorm[i][4]+=fy;segsNorm[i][5]+=fx;segsNorm[i][6]+=fy;}
return segsNorm;};function makePathSimpler(path){var x=0,y=0,len=path.length,x1=0,y1=0,current,i,converted,destinationPath=[],previous,controlX,controlY;for(i=0;i<len;++i){converted=false;current=path[i].slice(0);switch(current[0]){case'l':current[0]='L';current[1]+=x;current[2]+=y;case'L':x=current[1];y=current[2];break;case'h':current[1]+=x;case'H':current[0]='L';current[2]=y;x=current[1];break;case'v':current[1]+=y;case'V':current[0]='L';y=current[1];current[1]=x;current[2]=y;break;case'm':current[0]='M';current[1]+=x;current[2]+=y;case'M':x=current[1];y=current[2];x1=current[1];y1=current[2];break;case'c':current[0]='C';current[1]+=x;current[2]+=y;current[3]+=x;current[4]+=y;current[5]+=x;current[6]+=y;case'C':controlX=current[3];controlY=current[4];x=current[5];y=current[6];break;case's':current[0]='S';current[1]+=x;current[2]+=y;current[3]+=x;current[4]+=y;case'S':if(previous==='C'){controlX=2*x-controlX;controlY=2*y-controlY;}
else{controlX=x;controlY=y;}
x=current[3];y=current[4];current[0]='C';current[5]=current[3];current[6]=current[4];current[3]=current[1];current[4]=current[2];current[1]=controlX;current[2]=controlY;controlX=current[3];controlY=current[4];break;case'q':current[0]='Q';current[1]+=x;current[2]+=y;current[3]+=x;current[4]+=y;case'Q':controlX=current[1];controlY=current[2];x=current[3];y=current[4];break;case't':current[0]='T';current[1]+=x;current[2]+=y;case'T':if(previous==='Q'){controlX=2*x-controlX;controlY=2*y-controlY;}
else{controlX=x;controlY=y;}
current[0]='Q';x=current[1];y=current[2];current[1]=controlX;current[2]=controlY;current[3]=x;current[4]=y;break;case'a':current[0]='A';current[6]+=x;current[7]+=y;case'A':converted=true;destinationPath=destinationPath.concat(fromArcToBeziers(x,y,current));x=current[6];y=current[7];break;case'z':case'Z':x=x1;y=y1;break;default:}
if(!converted){destinationPath.push(current);}
previous=current[0];}
return destinationPath;};function calcLineLength(x1,y1,x2,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1));}
function CB1(t){return t*t*t;}
function CB2(t){return 3*t*t*(1-t);}
function CB3(t){return 3*t*(1-t)*(1-t);}
function CB4(t){return(1-t)*(1-t)*(1-t);}
function getPointOnCubicBezierIterator(p1x,p1y,p2x,p2y,p3x,p3y,p4x,p4y){return function(pct){var c1=CB1(pct),c2=CB2(pct),c3=CB3(pct),c4=CB4(pct);return{x:p4x*c1+p3x*c2+p2x*c3+p1x*c4,y:p4y*c1+p3y*c2+p2y*c3+p1y*c4};};}
function getTangentCubicIterator(p1x,p1y,p2x,p2y,p3x,p3y,p4x,p4y){return function(pct){var invT=1-pct,tangentX=(3*invT*invT*(p2x-p1x))+(6*invT*pct*(p3x-p2x))+
(3*pct*pct*(p4x-p3x)),tangentY=(3*invT*invT*(p2y-p1y))+(6*invT*pct*(p3y-p2y))+
(3*pct*pct*(p4y-p3y));return Math.atan2(tangentY,tangentX);};}
function QB1(t){return t*t;}
function QB2(t){return 2*t*(1-t);}
function QB3(t){return(1-t)*(1-t);}
function getPointOnQuadraticBezierIterator(p1x,p1y,p2x,p2y,p3x,p3y){return function(pct){var c1=QB1(pct),c2=QB2(pct),c3=QB3(pct);return{x:p3x*c1+p2x*c2+p1x*c3,y:p3y*c1+p2y*c2+p1y*c3};};}
function getTangentQuadraticIterator(p1x,p1y,p2x,p2y,p3x,p3y){return function(pct){var invT=1-pct,tangentX=(2*invT*(p2x-p1x))+(2*pct*(p3x-p2x)),tangentY=(2*invT*(p2y-p1y))+(2*pct*(p3y-p2y));return Math.atan2(tangentY,tangentX);};}
function pathIterator(iterator,x1,y1){var tempP={x:x1,y:y1},p,tmpLen=0,perc;for(perc=1;perc<=100;perc+=1){p=iterator(perc/100);tmpLen+=calcLineLength(tempP.x,tempP.y,p.x,p.y);tempP=p;}
return tmpLen;}
function findPercentageForDistance(segInfo,distance){var perc=0,tmpLen=0,iterator=segInfo.iterator,tempP={x:segInfo.x,y:segInfo.y},p,nextLen,nextStep=0.01,angleFinder=segInfo.angleFinder,lastPerc;while(tmpLen<distance&&nextStep>0.0001){p=iterator(perc);lastPerc=perc;nextLen=calcLineLength(tempP.x,tempP.y,p.x,p.y);if((nextLen+tmpLen)>distance){perc-=nextStep;nextStep/=2;}
else{tempP=p;perc+=nextStep;tmpLen+=nextLen;}}
p.angle=angleFinder(lastPerc);return p;}
function getPathSegmentsInfo(path){var totalLength=0,len=path.length,current,x1=0,y1=0,x2=0,y2=0,info=[],iterator,tempInfo,angleFinder;for(var i=0;i<len;i++){current=path[i];tempInfo={x:x1,y:y1,command:current[0],};switch(current[0]){case'M':tempInfo.length=0;x2=x1=current[1];y2=y1=current[2];break;case'L':tempInfo.length=calcLineLength(x1,y1,current[1],current[2]);x1=current[1];y1=current[2];break;case'C':iterator=getPointOnCubicBezierIterator(x1,y1,current[1],current[2],current[3],current[4],current[5],current[6]);angleFinder=getTangentCubicIterator(x1,y1,current[1],current[2],current[3],current[4],current[5],current[6]);tempInfo.iterator=iterator;tempInfo.angleFinder=angleFinder;tempInfo.length=pathIterator(iterator,x1,y1);x1=current[5];y1=current[6];break;case'Q':iterator=getPointOnQuadraticBezierIterator(x1,y1,current[1],current[2],current[3],current[4]);angleFinder=getTangentQuadraticIterator(x1,y1,current[1],current[2],current[3],current[4]);tempInfo.iterator=iterator;tempInfo.angleFinder=angleFinder;tempInfo.length=pathIterator(iterator,x1,y1);x1=current[3];y1=current[4];break;case'Z':case'z':tempInfo.destX=x2;tempInfo.destY=y2;tempInfo.length=calcLineLength(x1,y1,x2,y2);x1=x2;y1=y2;break;}
totalLength+=tempInfo.length;info.push(tempInfo);}
info.push({length:totalLength,x:x1,y:y1});return info;}
function getPointOnPath(path,distance,infos){if(!infos){infos=getPathSegmentsInfo(path);}
var i=0;while((distance-infos[i].length>0)&&i<(infos.length-2)){distance-=infos[i].length;i++;}
var segInfo=infos[i],segPercent=distance/segInfo.length,command=segInfo.command,segment=path[i],info;switch(command){case'M':return{x:segInfo.x,y:segInfo.y,angle:0};case'Z':case'z':info=new fabric.Point(segInfo.x,segInfo.y).lerp(new fabric.Point(segInfo.destX,segInfo.destY),segPercent);info.angle=Math.atan2(segInfo.destY-segInfo.y,segInfo.destX-segInfo.x);return info;case'L':info=new fabric.Point(segInfo.x,segInfo.y).lerp(new fabric.Point(segment[1],segment[2]),segPercent);info.angle=Math.atan2(segment[2]-segInfo.y,segment[1]-segInfo.x);return info;case'C':return findPercentageForDistance(segInfo,distance);case'Q':return findPercentageForDistance(segInfo,distance);}}
function parsePath(pathString){var result=[],coords=[],currentPath,parsed,re=fabric.rePathCommand,rNumber='[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*',rNumberCommaWsp='('+rNumber+')'+fabric.commaWsp,rFlagCommaWsp='([01])'+fabric.commaWsp+'?',rArcSeq=rNumberCommaWsp+'?'+rNumberCommaWsp+'?'+rNumberCommaWsp+rFlagCommaWsp+rFlagCommaWsp+
rNumberCommaWsp+'?('+rNumber+')',regArcArgumentSequence=new RegExp(rArcSeq,'g'),match,coordsStr,path;if(!pathString||!pathString.match){return result;}
path=pathString.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var i=0,coordsParsed,len=path.length;i<len;i++){currentPath=path[i];coordsStr=currentPath.slice(1).trim();coords.length=0;var command=currentPath.charAt(0);coordsParsed=[command];if(command.toLowerCase()==='a'){for(var args;(args=regArcArgumentSequence.exec(coordsStr));){for(var j=1;j<args.length;j++){coords.push(args[j]);}}}
else{while((match=re.exec(coordsStr))){coords.push(match[0]);}}
for(var j=0,jlen=coords.length;j<jlen;j++){parsed=parseFloat(coords[j]);if(!isNaN(parsed)){coordsParsed.push(parsed);}}
var commandLength=commandLengths[command.toLowerCase()],repeatedCommand=repeatedCommands[command]||command;if(coordsParsed.length-1>commandLength){for(var k=1,klen=coordsParsed.length;k<klen;k+=commandLength){result.push([command].concat(coordsParsed.slice(k,k+commandLength)));command=repeatedCommand;}}
else{result.push(coordsParsed);}}
return result;};function getSmoothPathFromPoints(points,correction){var path=[],i,p1=new fabric.Point(points[0].x,points[0].y),p2=new fabric.Point(points[1].x,points[1].y),len=points.length,multSignX=1,multSignY=0,manyPoints=len>2;correction=correction||0;if(manyPoints){multSignX=points[2].x<p2.x?-1:points[2].x===p2.x?0:1;multSignY=points[2].y<p2.y?-1:points[2].y===p2.y?0:1;}
path.push(['M',p1.x-multSignX*correction,p1.y-multSignY*correction]);for(i=1;i<len;i++){if(!p1.eq(p2)){var midPoint=p1.midPointFrom(p2);path.push(['Q',p1.x,p1.y,midPoint.x,midPoint.y]);}
p1=points[i];if((i+1)<points.length){p2=points[i+1];}}
if(manyPoints){multSignX=p1.x>points[i-2].x?1:p1.x===points[i-2].x?0:-1;multSignY=p1.y>points[i-2].y?1:p1.y===points[i-2].y?0:-1;}
path.push(['L',p1.x+multSignX*correction,p1.y+multSignY*correction]);return path;}
function transformPath(path,transform,pathOffset){if(pathOffset){transform=fabric.util.multiplyTransformMatrices(transform,[1,0,0,1,-pathOffset.x,-pathOffset.y]);}
return path.map(function(pathSegment){var newSegment=pathSegment.slice(0),point={};for(var i=1;i<pathSegment.length-1;i+=2){point.x=pathSegment[i];point.y=pathSegment[i+1];point=fabric.util.transformPoint(point,transform);newSegment[i]=point.x;newSegment[i+1]=point.y;}
return newSegment;});}
fabric.util.joinPath=function(pathData){return pathData.map(function(segment){return segment.join(' ');}).join(' ');};fabric.util.parsePath=parsePath;fabric.util.makePathSimpler=makePathSimpler;fabric.util.getSmoothPathFromPoints=getSmoothPathFromPoints;fabric.util.getPathSegmentsInfo=getPathSegmentsInfo;fabric.util.getBoundsOfCurve=getBoundsOfCurve;fabric.util.getPointOnPath=getPointOnPath;fabric.util.transformPath=transformPath;})();(function(){var slice=Array.prototype.slice;function invoke(array,method){var args=slice.call(arguments,2),result=[];for(var i=0,len=array.length;i<len;i++){result[i]=args.length?array[i][method].apply(array[i],args):array[i][method].call(array[i]);}
return result;}
function max(array,byProperty){return find(array,byProperty,function(value1,value2){return value1>=value2;});}
function min(array,byProperty){return find(array,byProperty,function(value1,value2){return value1<value2;});}
function fill(array,value){var k=array.length;while(k--){array[k]=value;}
return array;}
function find(array,byProperty,condition){if(!array||array.length===0){return;}
var i=array.length-1,result=byProperty?array[i][byProperty]:array[i];if(byProperty){while(i--){if(condition(array[i][byProperty],result)){result=array[i][byProperty];}}}
else{while(i--){if(condition(array[i],result)){result=array[i];}}}
return result;}
fabric.util.array={fill:fill,invoke:invoke,min:min,max:max};})();(function(){function extend(destination,source,deep){if(deep){if(!fabric.isLikelyNode&&source instanceof Element){destination=source;}
else if(source instanceof Array){destination=[];for(var i=0,len=source.length;i<len;i++){destination[i]=extend({},source[i],deep);}}
else if(source&&typeof source==='object'){for(var property in source){if(property==='canvas'||property==='group'){destination[property]=null;}
else if(source.hasOwnProperty(property)){destination[property]=extend({},source[property],deep);}}}
else{destination=source;}}
else{for(var property in source){destination[property]=source[property];}}
return destination;}
function clone(object,deep){return extend({},object,deep);}
fabric.util.object={extend:extend,clone:clone};fabric.util.object.extend(fabric.util,fabric.Observable);})();(function(){function camelize(string){return string.replace(/-+(.)?/g,function(match,character){return character?character.toUpperCase():'';});}
function capitalize(string,firstLetterOnly){return string.charAt(0).toUpperCase()+
(firstLetterOnly?string.slice(1):string.slice(1).toLowerCase());}
function escapeXml(string){return string.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&apos;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function graphemeSplit(textstring){var i=0,chr,graphemes=[];for(i=0,chr;i<textstring.length;i++){if((chr=getWholeChar(textstring,i))===false){continue;}
graphemes.push(chr);}
return graphemes;}
function getWholeChar(str,i){var code=str.charCodeAt(i);if(isNaN(code)){return'';}
if(code<0xD800||code>0xDFFF){return str.charAt(i);}
if(0xD800<=code&&code<=0xDBFF){if(str.length<=(i+1)){throw'High surrogate without following low surrogate';}
var next=str.charCodeAt(i+1);if(0xDC00>next||next>0xDFFF){throw'High surrogate without following low surrogate';}
return str.charAt(i)+str.charAt(i+1);}
if(i===0){throw'Low surrogate without preceding high surrogate';}
var prev=str.charCodeAt(i-1);if(0xD800>prev||prev>0xDBFF){throw'Low surrogate without preceding high surrogate';}
return false;}
fabric.util.string={camelize:camelize,capitalize:capitalize,escapeXml:escapeXml,graphemeSplit:graphemeSplit};})();(function(){var slice=Array.prototype.slice,emptyFunction=function(){},IS_DONTENUM_BUGGY=(function(){for(var p in{toString:1}){if(p==='toString'){return false;}}
return true;})(),addMethods=function(klass,source,parent){for(var property in source){if(property in klass.prototype&&typeof klass.prototype[property]==='function'&&(source[property]+'').indexOf('callSuper')>-1){klass.prototype[property]=(function(property){return function(){var superclass=this.constructor.superclass;this.constructor.superclass=parent;var returnValue=source[property].apply(this,arguments);this.constructor.superclass=superclass;if(property!=='initialize'){return returnValue;}};})(property);}
else{klass.prototype[property]=source[property];}
if(IS_DONTENUM_BUGGY){if(source.toString!==Object.prototype.toString){klass.prototype.toString=source.toString;}
if(source.valueOf!==Object.prototype.valueOf){klass.prototype.valueOf=source.valueOf;}}}};function Subclass(){}
function callSuper(methodName){var parentMethod=null,_this=this;while(_this.constructor.superclass){var superClassMethod=_this.constructor.superclass.prototype[methodName];if(_this[methodName]!==superClassMethod){parentMethod=superClassMethod;break;}
_this=_this.constructor.superclass.prototype;}
if(!parentMethod){return console.log('tried to callSuper '+methodName+', method not found in prototype chain',this);}
return(arguments.length>1)?parentMethod.apply(this,slice.call(arguments,1)):parentMethod.call(this);}
function createClass(){var parent=null,properties=slice.call(arguments,0);if(typeof properties[0]==='function'){parent=properties.shift();}
function klass(){this.initialize.apply(this,arguments);}
klass.superclass=parent;klass.subclasses=[];if(parent){Subclass.prototype=parent.prototype;klass.prototype=new Subclass();parent.subclasses.push(klass);}
for(var i=0,length=properties.length;i<length;i++){addMethods(klass,properties[i],parent);}
if(!klass.prototype.initialize){klass.prototype.initialize=emptyFunction;}
klass.prototype.constructor=klass;klass.prototype.callSuper=callSuper;return klass;}
fabric.util.createClass=createClass;})();(function(){var couldUseAttachEvent=!!fabric.document.createElement('div').attachEvent,touchEvents=['touchstart','touchmove','touchend'];fabric.util.addListener=function(element,eventName,handler,options){element&&element.addEventListener(eventName,handler,couldUseAttachEvent?false:options);};fabric.util.removeListener=function(element,eventName,handler,options){element&&element.removeEventListener(eventName,handler,couldUseAttachEvent?false:options);};function getTouchInfo(event){var touchProp=event.changedTouches;if(touchProp&&touchProp[0]){return touchProp[0];}
return event;}
fabric.util.getPointer=function(event){var element=event.target,scroll=fabric.util.getScrollLeftTop(element),_evt=getTouchInfo(event);return{x:_evt.clientX+scroll.left,y:_evt.clientY+scroll.top};};fabric.util.isTouchEvent=function(event){return touchEvents.indexOf(event.type)>-1||event.pointerType==='touch';};})();(function(){function setStyle(element,styles){var elementStyle=element.style;if(!elementStyle){return element;}
if(typeof styles==='string'){element.style.cssText+=';'+styles;return styles.indexOf('opacity')>-1?setOpacity(element,styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;}
for(var property in styles){if(property==='opacity'){setOpacity(element,styles[property]);}
else{var normalizedProperty=(property==='float'||property==='cssFloat')?(typeof elementStyle.styleFloat==='undefined'?'cssFloat':'styleFloat'):property;elementStyle[normalizedProperty]=styles[property];}}
return element;}
var parseEl=fabric.document.createElement('div'),supportsOpacity=typeof parseEl.style.opacity==='string',supportsFilters=typeof parseEl.style.filter==='string',reOpacity=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,setOpacity=function(element){return element;};if(supportsOpacity){setOpacity=function(element,value){element.style.opacity=value;return element;};}
else if(supportsFilters){setOpacity=function(element,value){var es=element.style;if(element.currentStyle&&!element.currentStyle.hasLayout){es.zoom=1;}
if(reOpacity.test(es.filter)){value=value>=0.9999?'':('alpha(opacity='+(value*100)+')');es.filter=es.filter.replace(reOpacity,value);}
else{es.filter+=' alpha(opacity='+(value*100)+')';}
return element;};}
fabric.util.setStyle=setStyle;})();(function(){var _slice=Array.prototype.slice;function getById(id){return typeof id==='string'?fabric.document.getElementById(id):id;}
var sliceCanConvertNodelists,toArray=function(arrayLike){return _slice.call(arrayLike,0);};try{sliceCanConvertNodelists=toArray(fabric.document.childNodes)instanceof Array;}
catch(err){}
if(!sliceCanConvertNodelists){toArray=function(arrayLike){var arr=new Array(arrayLike.length),i=arrayLike.length;while(i--){arr[i]=arrayLike[i];}
return arr;};}
function makeElement(tagName,attributes){var el=fabric.document.createElement(tagName);for(var prop in attributes){if(prop==='class'){el.className=attributes[prop];}
else if(prop==='for'){el.htmlFor=attributes[prop];}
else{el.setAttribute(prop,attributes[prop]);}}
return el;}
function addClass(element,className){if(element&&(' '+element.className+' ').indexOf(' '+className+' ')===-1){element.className+=(element.className?' ':'')+className;}}
function wrapElement(element,wrapper,attributes){if(typeof wrapper==='string'){wrapper=makeElement(wrapper,attributes);}
if(element.parentNode){element.parentNode.replaceChild(wrapper,element);}
wrapper.appendChild(element);return wrapper;}
function getScrollLeftTop(element){var left=0,top=0,docElement=fabric.document.documentElement,body=fabric.document.body||{scrollLeft:0,scrollTop:0};while(element&&(element.parentNode||element.host)){element=element.parentNode||element.host;if(element===fabric.document){left=body.scrollLeft||docElement.scrollLeft||0;top=body.scrollTop||docElement.scrollTop||0;}
else{left+=element.scrollLeft||0;top+=element.scrollTop||0;}
if(element.nodeType===1&&element.style.position==='fixed'){break;}}
return{left:left,top:top};}
function getElementOffset(element){var docElem,doc=element&&element.ownerDocument,box={left:0,top:0},offset={left:0,top:0},scrollLeftTop,offsetAttributes={borderLeftWidth:'left',borderTopWidth:'top',paddingLeft:'left',paddingTop:'top'};if(!doc){return offset;}
for(var attr in offsetAttributes){offset[offsetAttributes[attr]]+=parseInt(getElementStyle(element,attr),10)||0;}
docElem=doc.documentElement;if(typeof element.getBoundingClientRect!=='undefined'){box=element.getBoundingClientRect();}
scrollLeftTop=getScrollLeftTop(element);return{left:box.left+scrollLeftTop.left-(docElem.clientLeft||0)+offset.left,top:box.top+scrollLeftTop.top-(docElem.clientTop||0)+offset.top};}
var getElementStyle;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){getElementStyle=function(element,attr){var style=fabric.document.defaultView.getComputedStyle(element,null);return style?style[attr]:undefined;};}
else{getElementStyle=function(element,attr){var value=element.style[attr];if(!value&&element.currentStyle){value=element.currentStyle[attr];}
return value;};}
(function(){var style=fabric.document.documentElement.style,selectProp='userSelect'in style?'userSelect':'MozUserSelect'in style?'MozUserSelect':'WebkitUserSelect'in style?'WebkitUserSelect':'KhtmlUserSelect'in style?'KhtmlUserSelect':'';function makeElementUnselectable(element){if(typeof element.onselectstart!=='undefined'){element.onselectstart=fabric.util.falseFunction;}
if(selectProp){element.style[selectProp]='none';}
else if(typeof element.unselectable==='string'){element.unselectable='on';}
return element;}
function makeElementSelectable(element){if(typeof element.onselectstart!=='undefined'){element.onselectstart=null;}
if(selectProp){element.style[selectProp]='';}
else if(typeof element.unselectable==='string'){element.unselectable='';}
return element;}
fabric.util.makeElementUnselectable=makeElementUnselectable;fabric.util.makeElementSelectable=makeElementSelectable;})();function getNodeCanvas(element){var impl=fabric.jsdomImplForWrapper(element);return impl._canvas||impl._image;};function cleanUpJsdomNode(element){if(!fabric.isLikelyNode){return;}
var impl=fabric.jsdomImplForWrapper(element);if(impl){impl._image=null;impl._canvas=null;impl._currentSrc=null;impl._attributes=null;impl._classList=null;}}
function setImageSmoothing(ctx,value){ctx.imageSmoothingEnabled=ctx.imageSmoothingEnabled||ctx.webkitImageSmoothingEnabled||ctx.mozImageSmoothingEnabled||ctx.msImageSmoothingEnabled||ctx.oImageSmoothingEnabled;ctx.imageSmoothingEnabled=value;}
fabric.util.setImageSmoothing=setImageSmoothing;fabric.util.getById=getById;fabric.util.toArray=toArray;fabric.util.addClass=addClass;fabric.util.makeElement=makeElement;fabric.util.wrapElement=wrapElement;fabric.util.getScrollLeftTop=getScrollLeftTop;fabric.util.getElementOffset=getElementOffset;fabric.util.getNodeCanvas=getNodeCanvas;fabric.util.cleanUpJsdomNode=cleanUpJsdomNode;})();(function(){function addParamToUrl(url,param){return url+(/\?/.test(url)?'&':'?')+param;}
function emptyFn(){}
function request(url,options){options||(options={});var method=options.method?options.method.toUpperCase():'GET',onComplete=options.onComplete||function(){},xhr=new fabric.window.XMLHttpRequest(),body=options.body||options.parameters;xhr.onreadystatechange=function(){if(xhr.readyState===4){onComplete(xhr);xhr.onreadystatechange=emptyFn;}};if(method==='GET'){body=null;if(typeof options.parameters==='string'){url=addParamToUrl(url,options.parameters);}}
xhr.open(method,url,true);if(method==='POST'||method==='PUT'){xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
xhr.send(body);return xhr;}
fabric.util.request=request;})();fabric.log=console.log;fabric.warn=console.warn;(function(){var extend=fabric.util.object.extend,clone=fabric.util.object.clone;var RUNNING_ANIMATIONS=[];fabric.util.object.extend(RUNNING_ANIMATIONS,{cancelAll:function(){var animations=this.splice(0);animations.forEach(function(animation){animation.cancel();});return animations;},cancelByCanvas:function(canvas){if(!canvas){return[];}
var cancelled=this.filter(function(animation){return typeof animation.target==='object'&&animation.target.canvas===canvas;});cancelled.forEach(function(animation){animation.cancel();});return cancelled;},cancelByTarget:function(target){var cancelled=this.findAnimationsByTarget(target);cancelled.forEach(function(animation){animation.cancel();});return cancelled;},findAnimationIndex:function(cancelFunc){return this.indexOf(this.findAnimation(cancelFunc));},findAnimation:function(cancelFunc){return this.find(function(animation){return animation.cancel===cancelFunc;});},findAnimationsByTarget:function(target){if(!target){return[];}
return this.filter(function(animation){return animation.target===target;});}});function noop(){return false;}
function defaultEasing(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;}
function animate(options){options||(options={});var cancel=false,context,removeFromRegistry=function(){var index=fabric.runningAnimations.indexOf(context);return index>-1&&fabric.runningAnimations.splice(index,1)[0];};context=extend(clone(options),{cancel:function(){cancel=true;return removeFromRegistry();},currentValue:'startValue'in options?options.startValue:0,completionRate:0,durationRate:0});fabric.runningAnimations.push(context);requestAnimFrame(function(timestamp){var start=timestamp||+new Date(),duration=options.duration||500,finish=start+duration,time,onChange=options.onChange||noop,abort=options.abort||noop,onComplete=options.onComplete||noop,easing=options.easing||defaultEasing,isMany='startValue'in options?options.startValue.length>0:false,startValue='startValue'in options?options.startValue:0,endValue='endValue'in options?options.endValue:100,byValue=options.byValue||(isMany?startValue.map(function(value,i){return endValue[i]-startValue[i];}):endValue-startValue);options.onStart&&options.onStart();(function tick(ticktime){time=ticktime||+new Date();var currentTime=time>finish?duration:(time-start),timePerc=currentTime/duration,current=isMany?startValue.map(function(_value,i){return easing(currentTime,startValue[i],byValue[i],duration);}):easing(currentTime,startValue,byValue,duration),valuePerc=isMany?Math.abs((current[0]-startValue[0])/byValue[0]):Math.abs((current-startValue)/byValue);context.currentValue=isMany?current.slice():current;context.completionRate=valuePerc;context.durationRate=timePerc;if(cancel){return;}
if(abort(current,valuePerc,timePerc)){removeFromRegistry();return;}
if(time>finish){context.currentValue=isMany?endValue.slice():endValue;context.completionRate=1;context.durationRate=1;onChange(isMany?endValue.slice():endValue,1,1);onComplete(endValue,1,1);removeFromRegistry();return;}
else{onChange(current,valuePerc,timePerc);requestAnimFrame(tick);}})(start);});return context.cancel;}
var _requestAnimFrame=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(callback){return fabric.window.setTimeout(callback,1000/60);};var _cancelAnimFrame=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;function requestAnimFrame(){return _requestAnimFrame.apply(fabric.window,arguments);}
function cancelAnimFrame(){return _cancelAnimFrame.apply(fabric.window,arguments);}
fabric.util.animate=animate;fabric.util.requestAnimFrame=requestAnimFrame;fabric.util.cancelAnimFrame=cancelAnimFrame;fabric.runningAnimations=RUNNING_ANIMATIONS;})();(function(){function calculateColor(begin,end,pos){var color='rgba('
+parseInt((begin[0]+pos*(end[0]-begin[0])),10)+','
+parseInt((begin[1]+pos*(end[1]-begin[1])),10)+','
+parseInt((begin[2]+pos*(end[2]-begin[2])),10);color+=','+(begin&&end?parseFloat(begin[3]+pos*(end[3]-begin[3])):1);color+=')';return color;}
function animateColor(fromColor,toColor,duration,options){var startColor=new fabric.Color(fromColor).getSource(),endColor=new fabric.Color(toColor).getSource(),originalOnComplete=options.onComplete,originalOnChange=options.onChange;options=options||{};return fabric.util.animate(fabric.util.object.extend(options,{duration:duration||500,startValue:startColor,endValue:endColor,byValue:endColor,easing:function(currentTime,startValue,byValue,duration){var posValue=options.colorEasing?options.colorEasing(currentTime,duration):1-Math.cos(currentTime/duration*(Math.PI/2));return calculateColor(startValue,byValue,posValue);},onComplete:function(current,valuePerc,timePerc){if(originalOnComplete){return originalOnComplete(calculateColor(endColor,endColor,0),valuePerc,timePerc);}},onChange:function(current,valuePerc,timePerc){if(originalOnChange){if(Array.isArray(current)){return originalOnChange(calculateColor(current,current,0),valuePerc,timePerc);}
originalOnChange(current,valuePerc,timePerc);}}}));}
fabric.util.animateColor=animateColor;})();(function(){function normalize(a,c,p,s){if(a<Math.abs(c)){a=c;s=p/4;}
else{if(c===0&&a===0){s=p/(2*Math.PI)*Math.asin(1);}
else{s=p/(2*Math.PI)*Math.asin(c/a);}}
return{a:a,c:c,p:p,s:s};}
function elastic(opts,t,d){return opts.a*Math.pow(2,10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p);}
function easeOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;}
function easeInOutCubic(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t*t+b;}
return c/2*((t-=2)*t*t+2)+b;}
function easeInQuart(t,b,c,d){return c*(t/=d)*t*t*t+b;}
function easeOutQuart(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;}
function easeInOutQuart(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t*t*t+b;}
return-c/2*((t-=2)*t*t*t-2)+b;}
function easeInQuint(t,b,c,d){return c*(t/=d)*t*t*t*t+b;}
function easeOutQuint(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;}
function easeInOutQuint(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t*t*t*t+b;}
return c/2*((t-=2)*t*t*t*t+2)+b;}
function easeInSine(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;}
function easeOutSine(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;}
function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;}
function easeInExpo(t,b,c,d){return(t===0)?b:c*Math.pow(2,10*(t/d-1))+b;}
function easeOutExpo(t,b,c,d){return(t===d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;}
function easeInOutExpo(t,b,c,d){if(t===0){return b;}
if(t===d){return b+c;}
t/=d/2;if(t<1){return c/2*Math.pow(2,10*(t-1))+b;}
return c/2*(-Math.pow(2,-10*--t)+2)+b;}
function easeInCirc(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;}
function easeOutCirc(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;}
function easeInOutCirc(t,b,c,d){t/=d/2;if(t<1){return-c/2*(Math.sqrt(1-t*t)-1)+b;}
return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;}
function easeInElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b;}
t/=d;if(t===1){return b+c;}
if(!p){p=d*0.3;}
var opts=normalize(a,c,p,s);return-elastic(opts,t,d)+b;}
function easeOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b;}
t/=d;if(t===1){return b+c;}
if(!p){p=d*0.3;}
var opts=normalize(a,c,p,s);return opts.a*Math.pow(2,-10*t)*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)+opts.c+b;}
function easeInOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b;}
t/=d/2;if(t===2){return b+c;}
if(!p){p=d*(0.3*1.5);}
var opts=normalize(a,c,p,s);if(t<1){return-0.5*elastic(opts,t,d)+b;}
return opts.a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)*0.5+opts.c+b;}
function easeInBack(t,b,c,d,s){if(s===undefined){s=1.70158;}
return c*(t/=d)*t*((s+1)*t-s)+b;}
function easeOutBack(t,b,c,d,s){if(s===undefined){s=1.70158;}
return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;}
function easeInOutBack(t,b,c,d,s){if(s===undefined){s=1.70158;}
t/=d/2;if(t<1){return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;}
return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;}
function easeInBounce(t,b,c,d){return c-easeOutBounce(d-t,0,c,d)+b;}
function easeOutBounce(t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}
else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+0.75)+b;}
else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+0.9375)+b;}
else{return c*(7.5625*(t-=(2.625/2.75))*t+0.984375)+b;}}
function easeInOutBounce(t,b,c,d){if(t<d/2){return easeInBounce(t*2,0,c,d)*0.5+b;}
return easeOutBounce(t*2-d,0,c,d)*0.5+c*0.5+b;}
fabric.util.ease={easeInQuad:function(t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(t,b,c,d){t/=(d/2);if(t<1){return c/2*t*t+b;}
return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:easeOutCubic,easeInOutCubic:easeInOutCubic,easeInQuart:easeInQuart,easeOutQuart:easeOutQuart,easeInOutQuart:easeInOutQuart,easeInQuint:easeInQuint,easeOutQuint:easeOutQuint,easeInOutQuint:easeInOutQuint,easeInSine:easeInSine,easeOutSine:easeOutSine,easeInOutSine:easeInOutSine,easeInExpo:easeInExpo,easeOutExpo:easeOutExpo,easeInOutExpo:easeInOutExpo,easeInCirc:easeInCirc,easeOutCirc:easeOutCirc,easeInOutCirc:easeInOutCirc,easeInElastic:easeInElastic,easeOutElastic:easeOutElastic,easeInOutElastic:easeInOutElastic,easeInBack:easeInBack,easeOutBack:easeOutBack,easeInOutBack:easeInOutBack,easeInBounce:easeInBounce,easeOutBounce:easeOutBounce,easeInOutBounce:easeInOutBounce};})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,parseUnit=fabric.util.parseUnit,multiplyTransformMatrices=fabric.util.multiplyTransformMatrices,svgValidTagNames=['path','circle','polygon','polyline','ellipse','rect','line','image','text'],svgViewBoxElements=['symbol','image','marker','pattern','view','svg'],svgInvalidAncestors=['pattern','defs','symbol','metadata','clipPath','mask','desc'],svgValidParents=['symbol','g','a','svg','clipPath','defs'],attributesMap={cx:'left',x:'left',r:'radius',cy:'top',y:'top',display:'visible',visibility:'visible',transform:'transformMatrix','fill-opacity':'fillOpacity','fill-rule':'fillRule','font-family':'fontFamily','font-size':'fontSize','font-style':'fontStyle','font-weight':'fontWeight','letter-spacing':'charSpacing','paint-order':'paintFirst','stroke-dasharray':'strokeDashArray','stroke-dashoffset':'strokeDashOffset','stroke-linecap':'strokeLineCap','stroke-linejoin':'strokeLineJoin','stroke-miterlimit':'strokeMiterLimit','stroke-opacity':'strokeOpacity','stroke-width':'strokeWidth','text-decoration':'textDecoration','text-anchor':'textAnchor',opacity:'opacity','clip-path':'clipPath','clip-rule':'clipRule','vector-effect':'strokeUniform','image-rendering':'imageSmoothing',},colorAttributes={stroke:'strokeOpacity',fill:'fillOpacity'},fSize='font-size',cPath='clip-path';fabric.svgValidTagNamesRegEx=getSvgRegex(svgValidTagNames);fabric.svgViewBoxElementsRegEx=getSvgRegex(svgViewBoxElements);fabric.svgInvalidAncestorsRegEx=getSvgRegex(svgInvalidAncestors);fabric.svgValidParentsRegEx=getSvgRegex(svgValidParents);fabric.cssRules={};fabric.gradientDefs={};fabric.clipPaths={};function normalizeAttr(attr){if(attr in attributesMap){return attributesMap[attr];}
return attr;}
function normalizeValue(attr,value,parentAttributes,fontSize){var isArray=Object.prototype.toString.call(value)==='[object Array]',parsed;if((attr==='fill'||attr==='stroke')&&value==='none'){value='';}
else if(attr==='strokeUniform'){return(value==='non-scaling-stroke');}
else if(attr==='strokeDashArray'){if(value==='none'){value=null;}
else{value=value.replace(/,/g,' ').split(/\s+/).map(parseFloat);}}
else if(attr==='transformMatrix'){if(parentAttributes&&parentAttributes.transformMatrix){value=multiplyTransformMatrices(parentAttributes.transformMatrix,fabric.parseTransformAttribute(value));}
else{value=fabric.parseTransformAttribute(value);}}
else if(attr==='visible'){value=value!=='none'&&value!=='hidden';if(parentAttributes&&parentAttributes.visible===false){value=false;}}
else if(attr==='opacity'){value=parseFloat(value);if(parentAttributes&&typeof parentAttributes.opacity!=='undefined'){value*=parentAttributes.opacity;}}
else if(attr==='textAnchor'){value=value==='start'?'left':value==='end'?'right':'center';}
else if(attr==='charSpacing'){parsed=parseUnit(value,fontSize)/fontSize*1000;}
else if(attr==='paintFirst'){var fillIndex=value.indexOf('fill');var strokeIndex=value.indexOf('stroke');var value='fill';if(fillIndex>-1&&strokeIndex>-1&&strokeIndex<fillIndex){value='stroke';}
else if(fillIndex===-1&&strokeIndex>-1){value='stroke';}}
else if(attr==='href'||attr==='xlink:href'||attr==='font'){return value;}
else if(attr==='imageSmoothing'){return(value==='optimizeQuality');}
else{parsed=isArray?value.map(parseUnit):parseUnit(value,fontSize);}
return(!isArray&&isNaN(parsed)?value:parsed);}
function getSvgRegex(arr){return new RegExp('^('+arr.join('|')+')\\b','i');}
function _setStrokeFillOpacity(attributes){for(var attr in colorAttributes){if(typeof attributes[colorAttributes[attr]]==='undefined'||attributes[attr]===''){continue;}
if(typeof attributes[attr]==='undefined'){if(!fabric.Object.prototype[attr]){continue;}
attributes[attr]=fabric.Object.prototype[attr];}
if(attributes[attr].indexOf('url(')===0){continue;}
var color=new fabric.Color(attributes[attr]);attributes[attr]=color.setAlpha(toFixed(color.getAlpha()*attributes[colorAttributes[attr]],2)).toRgba();}
return attributes;}
function _getMultipleNodes(doc,nodeNames){var nodeName,nodeArray=[],nodeList,i,len;for(i=0,len=nodeNames.length;i<len;i++){nodeName=nodeNames[i];nodeList=doc.getElementsByTagName(nodeName);nodeArray=nodeArray.concat(Array.prototype.slice.call(nodeList));}
return nodeArray;}
fabric.parseTransformAttribute=(function(){function rotateMatrix(matrix,args){var cos=fabric.util.cos(args[0]),sin=fabric.util.sin(args[0]),x=0,y=0;if(args.length===3){x=args[1];y=args[2];}
matrix[0]=cos;matrix[1]=sin;matrix[2]=-sin;matrix[3]=cos;matrix[4]=x-(cos*x-sin*y);matrix[5]=y-(sin*x+cos*y);}
function scaleMatrix(matrix,args){var multiplierX=args[0],multiplierY=(args.length===2)?args[1]:args[0];matrix[0]=multiplierX;matrix[3]=multiplierY;}
function skewMatrix(matrix,args,pos){matrix[pos]=Math.tan(fabric.util.degreesToRadians(args[0]));}
function translateMatrix(matrix,args){matrix[4]=args[0];if(args.length===2){matrix[5]=args[1];}}
var iMatrix=fabric.iMatrix,number=fabric.reNum,commaWsp=fabric.commaWsp,skewX='(?:(skewX)\\s*\\(\\s*('+number+')\\s*\\))',skewY='(?:(skewY)\\s*\\(\\s*('+number+')\\s*\\))',rotate='(?:(rotate)\\s*\\(\\s*('+number+')(?:'+
commaWsp+'('+number+')'+
commaWsp+'('+number+'))?\\s*\\))',scale='(?:(scale)\\s*\\(\\s*('+number+')(?:'+
commaWsp+'('+number+'))?\\s*\\))',translate='(?:(translate)\\s*\\(\\s*('+number+')(?:'+
commaWsp+'('+number+'))?\\s*\\))',matrix='(?:(matrix)\\s*\\(\\s*'+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+'\\s*\\))',transform='(?:'+
matrix+'|'+
translate+'|'+
scale+'|'+
rotate+'|'+
skewX+'|'+
skewY+')',transforms='(?:'+transform+'(?:'+commaWsp+'*'+transform+')*'+')',transformList='^\\s*(?:'+transforms+'?)\\s*$',reTransformList=new RegExp(transformList),reTransform=new RegExp(transform,'g');return function(attributeValue){var matrix=iMatrix.concat(),matrices=[];if(!attributeValue||(attributeValue&&!reTransformList.test(attributeValue))){return matrix;}
attributeValue.replace(reTransform,function(match){var m=new RegExp(transform).exec(match).filter(function(match){return(!!match);}),operation=m[1],args=m.slice(2).map(parseFloat);switch(operation){case'translate':translateMatrix(matrix,args);break;case'rotate':args[0]=fabric.util.degreesToRadians(args[0]);rotateMatrix(matrix,args);break;case'scale':scaleMatrix(matrix,args);break;case'skewX':skewMatrix(matrix,args,2);break;case'skewY':skewMatrix(matrix,args,1);break;case'matrix':matrix=args;break;}
matrices.push(matrix.concat());matrix=iMatrix.concat();});var combinedMatrix=matrices[0];while(matrices.length>1){matrices.shift();combinedMatrix=fabric.util.multiplyTransformMatrices(combinedMatrix,matrices[0]);}
return combinedMatrix;};})();function parseStyleString(style,oStyle){var attr,value;style.replace(/;\s*$/,'').split(';').forEach(function(chunk){var pair=chunk.split(':');attr=pair[0].trim().toLowerCase();value=pair[1].trim();oStyle[attr]=value;});}
function parseStyleObject(style,oStyle){var attr,value;for(var prop in style){if(typeof style[prop]==='undefined'){continue;}
attr=prop.toLowerCase();value=style[prop];oStyle[attr]=value;}}
function getGlobalStylesForElement(element,svgUid){var styles={};for(var rule in fabric.cssRules[svgUid]){if(elementMatchesRule(element,rule.split(' '))){for(var property in fabric.cssRules[svgUid][rule]){styles[property]=fabric.cssRules[svgUid][rule][property];}}}
return styles;}
function elementMatchesRule(element,selectors){var firstMatching,parentMatching=true;firstMatching=selectorMatches(element,selectors.pop());if(firstMatching&&selectors.length){parentMatching=doesSomeParentMatch(element,selectors);}
return firstMatching&&parentMatching&&(selectors.length===0);}
function doesSomeParentMatch(element,selectors){var selector,parentMatching=true;while(element.parentNode&&element.parentNode.nodeType===1&&selectors.length){if(parentMatching){selector=selectors.pop();}
element=element.parentNode;parentMatching=selectorMatches(element,selector);}
return selectors.length===0;}
function selectorMatches(element,selector){var nodeName=element.nodeName,classNames=element.getAttribute('class'),id=element.getAttribute('id'),matcher,i;matcher=new RegExp('^'+nodeName,'i');selector=selector.replace(matcher,'');if(id&&selector.length){matcher=new RegExp('#'+id+'(?![a-zA-Z\\-]+)','i');selector=selector.replace(matcher,'');}
if(classNames&&selector.length){classNames=classNames.split(' ');for(i=classNames.length;i--;){matcher=new RegExp('\\.'+classNames[i]+'(?![a-zA-Z\\-]+)','i');selector=selector.replace(matcher,'');}}
return selector.length===0;}
function elementById(doc,id){var el;doc.getElementById&&(el=doc.getElementById(id));if(el){return el;}
var node,i,len,nodelist=doc.getElementsByTagName('*');for(i=0,len=nodelist.length;i<len;i++){node=nodelist[i];if(id===node.getAttribute('id')){return node;}}}
function parseUseDirectives(doc){var nodelist=_getMultipleNodes(doc,['use','svg:use']),i=0;while(nodelist.length&&i<nodelist.length){var el=nodelist[i],xlinkAttribute=el.getAttribute('xlink:href')||el.getAttribute('href');if(xlinkAttribute===null){return;}
var xlink=xlinkAttribute.substr(1),x=el.getAttribute('x')||0,y=el.getAttribute('y')||0,el2=elementById(doc,xlink).cloneNode(true),currentTrans=(el2.getAttribute('transform')||'')+' translate('+x+', '+y+')',parentNode,oldLength=nodelist.length,attr,j,attrs,len,namespace=fabric.svgNS;applyViewboxTransform(el2);if(/^svg$/i.test(el2.nodeName)){var el3=el2.ownerDocument.createElementNS(namespace,'g');for(j=0,attrs=el2.attributes,len=attrs.length;j<len;j++){attr=attrs.item(j);el3.setAttributeNS(namespace,attr.nodeName,attr.nodeValue);}
while(el2.firstChild){el3.appendChild(el2.firstChild);}
el2=el3;}
for(j=0,attrs=el.attributes,len=attrs.length;j<len;j++){attr=attrs.item(j);if(attr.nodeName==='x'||attr.nodeName==='y'||attr.nodeName==='xlink:href'||attr.nodeName==='href'){continue;}
if(attr.nodeName==='transform'){currentTrans=attr.nodeValue+' '+currentTrans;}
else{el2.setAttribute(attr.nodeName,attr.nodeValue);}}
el2.setAttribute('transform',currentTrans);el2.setAttribute('instantiated_by_use','1');el2.removeAttribute('id');parentNode=el.parentNode;parentNode.replaceChild(el2,el);if(nodelist.length===oldLength){i++;}}}
var reViewBoxAttrValue=new RegExp('^'+'\\s*('+fabric.reNum+'+)\\s*,?'+'\\s*('+fabric.reNum+'+)\\s*,?'+'\\s*('+fabric.reNum+'+)\\s*,?'+'\\s*('+fabric.reNum+'+)\\s*'+'$');function applyViewboxTransform(element){if(!fabric.svgViewBoxElementsRegEx.test(element.nodeName)){return{};}
var viewBoxAttr=element.getAttribute('viewBox'),scaleX=1,scaleY=1,minX=0,minY=0,viewBoxWidth,viewBoxHeight,matrix,el,widthAttr=element.getAttribute('width'),heightAttr=element.getAttribute('height'),x=element.getAttribute('x')||0,y=element.getAttribute('y')||0,preserveAspectRatio=element.getAttribute('preserveAspectRatio')||'',missingViewBox=(!viewBoxAttr||!(viewBoxAttr=viewBoxAttr.match(reViewBoxAttrValue))),missingDimAttr=(!widthAttr||!heightAttr||widthAttr==='100%'||heightAttr==='100%'),toBeParsed=missingViewBox&&missingDimAttr,parsedDim={},translateMatrix='',widthDiff=0,heightDiff=0;parsedDim.width=0;parsedDim.height=0;parsedDim.toBeParsed=toBeParsed;if(missingViewBox){if(((x||y)&&element.parentNode&&element.parentNode.nodeName!=='#document')){translateMatrix=' translate('+parseUnit(x)+' '+parseUnit(y)+') ';matrix=(element.getAttribute('transform')||'')+translateMatrix;element.setAttribute('transform',matrix);element.removeAttribute('x');element.removeAttribute('y');}}
if(toBeParsed){return parsedDim;}
if(missingViewBox){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);return parsedDim;}
minX=-parseFloat(viewBoxAttr[1]);minY=-parseFloat(viewBoxAttr[2]);viewBoxWidth=parseFloat(viewBoxAttr[3]);viewBoxHeight=parseFloat(viewBoxAttr[4]);parsedDim.minX=minX;parsedDim.minY=minY;parsedDim.viewBoxWidth=viewBoxWidth;parsedDim.viewBoxHeight=viewBoxHeight;if(!missingDimAttr){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);scaleX=parsedDim.width/viewBoxWidth;scaleY=parsedDim.height/viewBoxHeight;}
else{parsedDim.width=viewBoxWidth;parsedDim.height=viewBoxHeight;}
preserveAspectRatio=fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);if(preserveAspectRatio.alignX!=='none'){if(preserveAspectRatio.meetOrSlice==='meet'){scaleY=scaleX=(scaleX>scaleY?scaleY:scaleX);}
if(preserveAspectRatio.meetOrSlice==='slice'){scaleY=scaleX=(scaleX>scaleY?scaleX:scaleY);}
widthDiff=parsedDim.width-viewBoxWidth*scaleX;heightDiff=parsedDim.height-viewBoxHeight*scaleX;if(preserveAspectRatio.alignX==='Mid'){widthDiff/=2;}
if(preserveAspectRatio.alignY==='Mid'){heightDiff/=2;}
if(preserveAspectRatio.alignX==='Min'){widthDiff=0;}
if(preserveAspectRatio.alignY==='Min'){heightDiff=0;}}
if(scaleX===1&&scaleY===1&&minX===0&&minY===0&&x===0&&y===0){return parsedDim;}
if((x||y)&&element.parentNode.nodeName!=='#document'){translateMatrix=' translate('+parseUnit(x)+' '+parseUnit(y)+') ';}
matrix=translateMatrix+' matrix('+scaleX+' 0'+' 0 '+
scaleY+' '+
(minX*scaleX+widthDiff)+' '+
(minY*scaleY+heightDiff)+') ';if(element.nodeName==='svg'){el=element.ownerDocument.createElementNS(fabric.svgNS,'g');while(element.firstChild){el.appendChild(element.firstChild);}
element.appendChild(el);}
else{el=element;el.removeAttribute('x');el.removeAttribute('y');matrix=el.getAttribute('transform')+matrix;}
el.setAttribute('transform',matrix);return parsedDim;}
function hasAncestorWithNodeName(element,nodeName){while(element&&(element=element.parentNode)){if(element.nodeName&&nodeName.test(element.nodeName.replace('svg:',''))&&!element.getAttribute('instantiated_by_use')){return true;}}
return false;}
fabric.parseSVGDocument=function(doc,callback,reviver,parsingOptions){if(!doc){return;}
parseUseDirectives(doc);var svgUid=fabric.Object.__uid++,i,len,options=applyViewboxTransform(doc),descendants=fabric.util.toArray(doc.getElementsByTagName('*'));options.crossOrigin=parsingOptions&&parsingOptions.crossOrigin;options.svgUid=svgUid;if(descendants.length===0&&fabric.isLikelyNode){descendants=doc.selectNodes('//*[name(.)!="svg"]');var arr=[];for(i=0,len=descendants.length;i<len;i++){arr[i]=descendants[i];}
descendants=arr;}
var elements=descendants.filter(function(el){applyViewboxTransform(el);return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:',''))&&!hasAncestorWithNodeName(el,fabric.svgInvalidAncestorsRegEx);});if(!elements||(elements&&!elements.length)){callback&&callback([],{});return;}
var clipPaths={};descendants.filter(function(el){return el.nodeName.replace('svg:','')==='clipPath';}).forEach(function(el){var id=el.getAttribute('id');clipPaths[id]=fabric.util.toArray(el.getElementsByTagName('*')).filter(function(el){return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:',''));});});fabric.gradientDefs[svgUid]=fabric.getGradientDefs(doc);fabric.cssRules[svgUid]=fabric.getCSSRules(doc);fabric.clipPaths[svgUid]=clipPaths;fabric.parseElements(elements,function(instances,elements){if(callback){callback(instances,options,elements,descendants);delete fabric.gradientDefs[svgUid];delete fabric.cssRules[svgUid];delete fabric.clipPaths[svgUid];}},clone(options),reviver,parsingOptions);};function recursivelyParseGradientsXlink(doc,gradient){var gradientsAttrs=['gradientTransform','x1','x2','y1','y2','gradientUnits','cx','cy','r','fx','fy'],xlinkAttr='xlink:href',xLink=gradient.getAttribute(xlinkAttr).substr(1),referencedGradient=elementById(doc,xLink);if(referencedGradient&&referencedGradient.getAttribute(xlinkAttr)){recursivelyParseGradientsXlink(doc,referencedGradient);}
gradientsAttrs.forEach(function(attr){if(referencedGradient&&!gradient.hasAttribute(attr)&&referencedGradient.hasAttribute(attr)){gradient.setAttribute(attr,referencedGradient.getAttribute(attr));}});if(!gradient.children.length){var referenceClone=referencedGradient.cloneNode(true);while(referenceClone.firstChild){gradient.appendChild(referenceClone.firstChild);}}
gradient.removeAttribute(xlinkAttr);}
var reFontDeclaration=new RegExp('(normal|italic)?\\s*(normal|small-caps)?\\s*'+'(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*('+
fabric.reNum+'(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|'+fabric.reNum+'))?\\s+(.*)');extend(fabric,{parseFontDeclaration:function(value,oStyle){var match=value.match(reFontDeclaration);if(!match){return;}
var fontStyle=match[1],fontWeight=match[3],fontSize=match[4],lineHeight=match[5],fontFamily=match[6];if(fontStyle){oStyle.fontStyle=fontStyle;}
if(fontWeight){oStyle.fontWeight=isNaN(parseFloat(fontWeight))?fontWeight:parseFloat(fontWeight);}
if(fontSize){oStyle.fontSize=parseUnit(fontSize);}
if(fontFamily){oStyle.fontFamily=fontFamily;}
if(lineHeight){oStyle.lineHeight=lineHeight==='normal'?1:lineHeight;}},getGradientDefs:function(doc){var tagArray=['linearGradient','radialGradient','svg:linearGradient','svg:radialGradient'],elList=_getMultipleNodes(doc,tagArray),el,j=0,gradientDefs={};j=elList.length;while(j--){el=elList[j];if(el.getAttribute('xlink:href')){recursivelyParseGradientsXlink(doc,el);}
gradientDefs[el.getAttribute('id')]=el;}
return gradientDefs;},parseAttributes:function(element,attributes,svgUid){if(!element){return;}
var value,parentAttributes={},fontSize,parentFontSize;if(typeof svgUid==='undefined'){svgUid=element.getAttribute('svgUid');}
if(element.parentNode&&fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)){parentAttributes=fabric.parseAttributes(element.parentNode,attributes,svgUid);}
var ownAttributes=attributes.reduce(function(memo,attr){value=element.getAttribute(attr);if(value){memo[attr]=value;}
return memo;},{});var cssAttrs=extend(getGlobalStylesForElement(element,svgUid),fabric.parseStyleAttribute(element));ownAttributes=extend(ownAttributes,cssAttrs);if(cssAttrs[cPath]){element.setAttribute(cPath,cssAttrs[cPath]);}
fontSize=parentFontSize=parentAttributes.fontSize||fabric.Text.DEFAULT_SVG_FONT_SIZE;if(ownAttributes[fSize]){ownAttributes[fSize]=fontSize=parseUnit(ownAttributes[fSize],parentFontSize);}
var normalizedAttr,normalizedValue,normalizedStyle={};for(var attr in ownAttributes){normalizedAttr=normalizeAttr(attr);normalizedValue=normalizeValue(normalizedAttr,ownAttributes[attr],parentAttributes,fontSize);normalizedStyle[normalizedAttr]=normalizedValue;}
if(normalizedStyle&&normalizedStyle.font){fabric.parseFontDeclaration(normalizedStyle.font,normalizedStyle);}
var mergedAttrs=extend(parentAttributes,normalizedStyle);return fabric.svgValidParentsRegEx.test(element.nodeName)?mergedAttrs:_setStrokeFillOpacity(mergedAttrs);},parseElements:function(elements,callback,options,reviver,parsingOptions){new fabric.ElementsParser(elements,callback,options,reviver,parsingOptions).parse();},parseStyleAttribute:function(element){var oStyle={},style=element.getAttribute('style');if(!style){return oStyle;}
if(typeof style==='string'){parseStyleString(style,oStyle);}
else{parseStyleObject(style,oStyle);}
return oStyle;},parsePointsAttribute:function(points){if(!points){return null;}
points=points.replace(/,/g,' ').trim();points=points.split(/\s+/);var parsedPoints=[],i,len;for(i=0,len=points.length;i<len;i+=2){parsedPoints.push({x:parseFloat(points[i]),y:parseFloat(points[i+1])});}
return parsedPoints;},getCSSRules:function(doc){var styles=doc.getElementsByTagName('style'),i,len,allRules={},rules;for(i=0,len=styles.length;i<len;i++){var styleContents=styles[i].textContent;styleContents=styleContents.replace(/\/\*[\s\S]*?\*\//g,'');if(styleContents.trim()===''){continue;}
rules=styleContents.split('}');rules=rules.filter(function(rule){return rule.trim();});rules.forEach(function(rule){var match=rule.split('{'),ruleObj={},declaration=match[1].trim(),propertyValuePairs=declaration.split(';').filter(function(pair){return pair.trim();});for(i=0,len=propertyValuePairs.length;i<len;i++){var pair=propertyValuePairs[i].split(':'),property=pair[0].trim(),value=pair[1].trim();ruleObj[property]=value;}
rule=match[0].trim();rule.split(',').forEach(function(_rule){_rule=_rule.replace(/^svg/i,'').trim();if(_rule===''){return;}
if(allRules[_rule]){fabric.util.object.extend(allRules[_rule],ruleObj);}
else{allRules[_rule]=fabric.util.object.clone(ruleObj);}});});}
return allRules;},loadSVGFromURL:function(url,callback,reviver,options){url=url.replace(/^\n\s*/,'').trim();new fabric.util.request(url,{method:'get',onComplete:onComplete});function onComplete(r){var xml=r.responseXML;if(!xml||!xml.documentElement){callback&&callback(null);return false;}
fabric.parseSVGDocument(xml.documentElement,function(results,_options,elements,allElements){callback&&callback(results,_options,elements,allElements);},reviver,options);}},loadSVGFromString:function(string,callback,reviver,options){var parser=new fabric.window.DOMParser(),doc=parser.parseFromString(string.trim(),'text/xml');fabric.parseSVGDocument(doc.documentElement,function(results,_options,elements,allElements){callback(results,_options,elements,allElements);},reviver,options);}});})(typeof exports!=='undefined'?exports:this);fabric.ElementsParser=function(elements,callback,options,reviver,parsingOptions,doc){this.elements=elements;this.callback=callback;this.options=options;this.reviver=reviver;this.svgUid=(options&&options.svgUid)||0;this.parsingOptions=parsingOptions;this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g;this.doc=doc;};(function(proto){proto.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects();};proto.createObjects=function(){var _this=this;this.elements.forEach(function(element,i){element.setAttribute('svgUid',_this.svgUid);_this.createObject(element,i);});};proto.findTag=function(el){return fabric[fabric.util.string.capitalize(el.tagName.replace('svg:',''))];};proto.createObject=function(el,index){var klass=this.findTag(el);if(klass&&klass.fromElement){try{klass.fromElement(el,this.createCallback(index,el),this.options);}
catch(err){fabric.log(err);}}
else{this.checkIfDone();}};proto.createCallback=function(index,el){var _this=this;return function(obj){var _options;_this.resolveGradient(obj,el,'fill');_this.resolveGradient(obj,el,'stroke');if(obj instanceof fabric.Image&&obj._originalElement){_options=obj.parsePreserveAspectRatioAttribute(el);}
obj._removeTransformMatrix(_options);_this.resolveClipPath(obj,el);_this.reviver&&_this.reviver(el,obj);_this.instances[index]=obj;_this.checkIfDone();};};proto.extractPropertyDefinition=function(obj,property,storage){var value=obj[property],regex=this.regexUrl;if(!regex.test(value)){return;}
regex.lastIndex=0;var id=regex.exec(value)[1];regex.lastIndex=0;return fabric[storage][this.svgUid][id];};proto.resolveGradient=function(obj,el,property){var gradientDef=this.extractPropertyDefinition(obj,property,'gradientDefs');if(gradientDef){var opacityAttr=el.getAttribute(property+'-opacity');var gradient=fabric.Gradient.fromElement(gradientDef,obj,opacityAttr,this.options);obj.set(property,gradient);}};proto.createClipPathCallback=function(obj,container){return function(_newObj){_newObj._removeTransformMatrix();_newObj.fillRule=_newObj.clipRule;container.push(_newObj);};};proto.resolveClipPath=function(obj,usingElement){var clipPath=this.extractPropertyDefinition(obj,'clipPath','clipPaths'),element,klass,objTransformInv,container,gTransform,options;if(clipPath){container=[];objTransformInv=fabric.util.invertTransform(obj.calcTransformMatrix());var clipPathTag=clipPath[0].parentNode;var clipPathOwner=usingElement;while(clipPathOwner.parentNode&&clipPathOwner.getAttribute('clip-path')!==obj.clipPath){clipPathOwner=clipPathOwner.parentNode;}
clipPathOwner.parentNode.appendChild(clipPathTag);for(var i=0;i<clipPath.length;i++){element=clipPath[i];klass=this.findTag(element);klass.fromElement(element,this.createClipPathCallback(obj,container),this.options);}
if(container.length===1){clipPath=container[0];}
else{clipPath=new fabric.Group(container);}
gTransform=fabric.util.multiplyTransformMatrices(objTransformInv,clipPath.calcTransformMatrix());if(clipPath.clipPath){this.resolveClipPath(clipPath,clipPathOwner);}
var options=fabric.util.qrDecompose(gTransform);clipPath.flipX=false;clipPath.flipY=false;clipPath.set('scaleX',options.scaleX);clipPath.set('scaleY',options.scaleY);clipPath.angle=options.angle;clipPath.skewX=options.skewX;clipPath.skewY=0;clipPath.setPositionByOrigin({x:options.translateX,y:options.translateY},'center','center');obj.clipPath=clipPath;}
else{delete obj.clipPath;}};proto.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(el){return el!=null;});this.callback(this.instances,this.elements);}};})(fabric.ElementsParser.prototype);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Point){fabric.warn('fabric.Point is already defined');return;}
fabric.Point=Point;function Point(x,y){this.x=x;this.y=y;}
Point.prototype={type:'point',constructor:Point,add:function(that){return new Point(this.x+that.x,this.y+that.y);},addEquals:function(that){this.x+=that.x;this.y+=that.y;return this;},scalarAdd:function(scalar){return new Point(this.x+scalar,this.y+scalar);},scalarAddEquals:function(scalar){this.x+=scalar;this.y+=scalar;return this;},subtract:function(that){return new Point(this.x-that.x,this.y-that.y);},subtractEquals:function(that){this.x-=that.x;this.y-=that.y;return this;},scalarSubtract:function(scalar){return new Point(this.x-scalar,this.y-scalar);},scalarSubtractEquals:function(scalar){this.x-=scalar;this.y-=scalar;return this;},multiply:function(scalar){return new Point(this.x*scalar,this.y*scalar);},multiplyEquals:function(scalar){this.x*=scalar;this.y*=scalar;return this;},divide:function(scalar){return new Point(this.x/scalar,this.y/scalar);},divideEquals:function(scalar){this.x/=scalar;this.y/=scalar;return this;},eq:function(that){return(this.x===that.x&&this.y===that.y);},lt:function(that){return(this.x<that.x&&this.y<that.y);},lte:function(that){return(this.x<=that.x&&this.y<=that.y);},gt:function(that){return(this.x>that.x&&this.y>that.y);},gte:function(that){return(this.x>=that.x&&this.y>=that.y);},lerp:function(that,t){if(typeof t==='undefined'){t=0.5;}
t=Math.max(Math.min(1,t),0);return new Point(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t);},distanceFrom:function(that){var dx=this.x-that.x,dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy);},midPointFrom:function(that){return this.lerp(that);},min:function(that){return new Point(Math.min(this.x,that.x),Math.min(this.y,that.y));},max:function(that){return new Point(Math.max(this.x,that.x),Math.max(this.y,that.y));},toString:function(){return this.x+','+this.y;},setXY:function(x,y){this.x=x;this.y=y;return this;},setX:function(x){this.x=x;return this;},setY:function(y){this.y=y;return this;},setFromPoint:function(that){this.x=that.x;this.y=that.y;return this;},swap:function(that){var x=this.x,y=this.y;this.x=that.x;this.y=that.y;that.x=x;that.y=y;},clone:function(){return new Point(this.x,this.y);}};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Intersection){fabric.warn('fabric.Intersection is already defined');return;}
function Intersection(status){this.status=status;this.points=[];}
fabric.Intersection=Intersection;fabric.Intersection.prototype={constructor:Intersection,appendPoint:function(point){this.points.push(point);return this;},appendPoints:function(points){this.points=this.points.concat(points);return this;}};fabric.Intersection.intersectLineLine=function(a1,a2,b1,b2){var result,uaT=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ubT=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),uB=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(uB!==0){var ua=uaT/uB,ub=ubT/uB;if(0<=ua&&ua<=1&&0<=ub&&ub<=1){result=new Intersection('Intersection');result.appendPoint(new fabric.Point(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)));}
else{result=new Intersection();}}
else{if(uaT===0||ubT===0){result=new Intersection('Coincident');}
else{result=new Intersection('Parallel');}}
return result;};fabric.Intersection.intersectLinePolygon=function(a1,a2,points){var result=new Intersection(),length=points.length,b1,b2,inter,i;for(i=0;i<length;i++){b1=points[i];b2=points[(i+1)%length];inter=Intersection.intersectLineLine(a1,a2,b1,b2);result.appendPoints(inter.points);}
if(result.points.length>0){result.status='Intersection';}
return result;};fabric.Intersection.intersectPolygonPolygon=function(points1,points2){var result=new Intersection(),length=points1.length,i;for(i=0;i<length;i++){var a1=points1[i],a2=points1[(i+1)%length],inter=Intersection.intersectLinePolygon(a1,a2,points2);result.appendPoints(inter.points);}
if(result.points.length>0){result.status='Intersection';}
return result;};fabric.Intersection.intersectPolygonRectangle=function(points,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new fabric.Point(max.x,min.y),bottomLeft=new fabric.Point(min.x,max.y),inter1=Intersection.intersectLinePolygon(min,topRight,points),inter2=Intersection.intersectLinePolygon(topRight,max,points),inter3=Intersection.intersectLinePolygon(max,bottomLeft,points),inter4=Intersection.intersectLinePolygon(bottomLeft,min,points),result=new Intersection();result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0){result.status='Intersection';}
return result;};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Color){fabric.warn('fabric.Color is already defined.');return;}
function Color(color){if(!color){this.setSource([0,0,0,1]);}
else{this._tryParsingColor(color);}}
fabric.Color=Color;fabric.Color.prototype={_tryParsingColor:function(color){var source;if(color in Color.colorNameMap){color=Color.colorNameMap[color];}
if(color==='transparent'){source=[255,255,255,0];}
if(!source){source=Color.sourceFromHex(color);}
if(!source){source=Color.sourceFromRgb(color);}
if(!source){source=Color.sourceFromHsl(color);}
if(!source){source=[0,0,0,1];}
if(source){this.setSource(source);}},_rgbToHsl:function(r,g,b){r/=255;g/=255;b/=255;var h,s,l,max=fabric.util.array.max([r,g,b]),min=fabric.util.array.min([r,g,b]);l=(max+min)/2;if(max===min){h=s=0;}
else{var d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
h/=6;}
return[Math.round(h*360),Math.round(s*100),Math.round(l*100)];},getSource:function(){return this._source;},setSource:function(source){this._source=source;},toRgb:function(){var source=this.getSource();return'rgb('+source[0]+','+source[1]+','+source[2]+')';},toRgba:function(){var source=this.getSource();return'rgba('+source[0]+','+source[1]+','+source[2]+','+source[3]+')';},toHsl:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return'hsl('+hsl[0]+','+hsl[1]+'%,'+hsl[2]+'%)';},toHsla:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return'hsla('+hsl[0]+','+hsl[1]+'%,'+hsl[2]+'%,'+source[3]+')';},toHex:function(){var source=this.getSource(),r,g,b;r=source[0].toString(16);r=(r.length===1)?('0'+r):r;g=source[1].toString(16);g=(g.length===1)?('0'+g):g;b=source[2].toString(16);b=(b.length===1)?('0'+b):b;return r.toUpperCase()+g.toUpperCase()+b.toUpperCase();},toHexa:function(){var source=this.getSource(),a;a=Math.round(source[3]*255);a=a.toString(16);a=(a.length===1)?('0'+a):a;return this.toHex()+a.toUpperCase();},getAlpha:function(){return this.getSource()[3];},setAlpha:function(alpha){var source=this.getSource();source[3]=alpha;this.setSource(source);return this;},toGrayscale:function(){var source=this.getSource(),average=parseInt((source[0]*0.3+source[1]*0.59+source[2]*0.11).toFixed(0),10),currentAlpha=source[3];this.setSource([average,average,average,currentAlpha]);return this;},toBlackWhite:function(threshold){var source=this.getSource(),average=(source[0]*0.3+source[1]*0.59+source[2]*0.11).toFixed(0),currentAlpha=source[3];threshold=threshold||127;average=(Number(average)<Number(threshold))?0:255;this.setSource([average,average,average,currentAlpha]);return this;},overlayWith:function(otherColor){if(!(otherColor instanceof Color)){otherColor=new Color(otherColor);}
var result=[],alpha=this.getAlpha(),otherAlpha=0.5,source=this.getSource(),otherSource=otherColor.getSource(),i;for(i=0;i<3;i++){result.push(Math.round((source[i]*(1-otherAlpha))+(otherSource[i]*otherAlpha)));}
result[3]=alpha;this.setSource(result);return this;}};fabric.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i;fabric.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i;fabric.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;fabric.Color.colorNameMap={aliceblue:'#F0F8FF',antiquewhite:'#FAEBD7',aqua:'#00FFFF',aquamarine:'#7FFFD4',azure:'#F0FFFF',beige:'#F5F5DC',bisque:'#FFE4C4',black:'#000000',blanchedalmond:'#FFEBCD',blue:'#0000FF',blueviolet:'#8A2BE2',brown:'#A52A2A',burlywood:'#DEB887',cadetblue:'#5F9EA0',chartreuse:'#7FFF00',chocolate:'#D2691E',coral:'#FF7F50',cornflowerblue:'#6495ED',cornsilk:'#FFF8DC',crimson:'#DC143C',cyan:'#00FFFF',darkblue:'#00008B',darkcyan:'#008B8B',darkgoldenrod:'#B8860B',darkgray:'#A9A9A9',darkgrey:'#A9A9A9',darkgreen:'#006400',darkkhaki:'#BDB76B',darkmagenta:'#8B008B',darkolivegreen:'#556B2F',darkorange:'#FF8C00',darkorchid:'#9932CC',darkred:'#8B0000',darksalmon:'#E9967A',darkseagreen:'#8FBC8F',darkslateblue:'#483D8B',darkslategray:'#2F4F4F',darkslategrey:'#2F4F4F',darkturquoise:'#00CED1',darkviolet:'#9400D3',deeppink:'#FF1493',deepskyblue:'#00BFFF',dimgray:'#696969',dimgrey:'#696969',dodgerblue:'#1E90FF',firebrick:'#B22222',floralwhite:'#FFFAF0',forestgreen:'#228B22',fuchsia:'#FF00FF',gainsboro:'#DCDCDC',ghostwhite:'#F8F8FF',gold:'#FFD700',goldenrod:'#DAA520',gray:'#808080',grey:'#808080',green:'#008000',greenyellow:'#ADFF2F',honeydew:'#F0FFF0',hotpink:'#FF69B4',indianred:'#CD5C5C',indigo:'#4B0082',ivory:'#FFFFF0',khaki:'#F0E68C',lavender:'#E6E6FA',lavenderblush:'#FFF0F5',lawngreen:'#7CFC00',lemonchiffon:'#FFFACD',lightblue:'#ADD8E6',lightcoral:'#F08080',lightcyan:'#E0FFFF',lightgoldenrodyellow:'#FAFAD2',lightgray:'#D3D3D3',lightgrey:'#D3D3D3',lightgreen:'#90EE90',lightpink:'#FFB6C1',lightsalmon:'#FFA07A',lightseagreen:'#20B2AA',lightskyblue:'#87CEFA',lightslategray:'#778899',lightslategrey:'#778899',lightsteelblue:'#B0C4DE',lightyellow:'#FFFFE0',lime:'#00FF00',limegreen:'#32CD32',linen:'#FAF0E6',magenta:'#FF00FF',maroon:'#800000',mediumaquamarine:'#66CDAA',mediumblue:'#0000CD',mediumorchid:'#BA55D3',mediumpurple:'#9370DB',mediumseagreen:'#3CB371',mediumslateblue:'#7B68EE',mediumspringgreen:'#00FA9A',mediumturquoise:'#48D1CC',mediumvioletred:'#C71585',midnightblue:'#191970',mintcream:'#F5FFFA',mistyrose:'#FFE4E1',moccasin:'#FFE4B5',navajowhite:'#FFDEAD',navy:'#000080',oldlace:'#FDF5E6',olive:'#808000',olivedrab:'#6B8E23',orange:'#FFA500',orangered:'#FF4500',orchid:'#DA70D6',palegoldenrod:'#EEE8AA',palegreen:'#98FB98',paleturquoise:'#AFEEEE',palevioletred:'#DB7093',papayawhip:'#FFEFD5',peachpuff:'#FFDAB9',peru:'#CD853F',pink:'#FFC0CB',plum:'#DDA0DD',powderblue:'#B0E0E6',purple:'#800080',rebeccapurple:'#663399',red:'#FF0000',rosybrown:'#BC8F8F',royalblue:'#4169E1',saddlebrown:'#8B4513',salmon:'#FA8072',sandybrown:'#F4A460',seagreen:'#2E8B57',seashell:'#FFF5EE',sienna:'#A0522D',silver:'#C0C0C0',skyblue:'#87CEEB',slateblue:'#6A5ACD',slategray:'#708090',slategrey:'#708090',snow:'#FFFAFA',springgreen:'#00FF7F',steelblue:'#4682B4',tan:'#D2B48C',teal:'#008080',thistle:'#D8BFD8',tomato:'#FF6347',turquoise:'#40E0D0',violet:'#EE82EE',wheat:'#F5DEB3',white:'#FFFFFF',whitesmoke:'#F5F5F5',yellow:'#FFFF00',yellowgreen:'#9ACD32'};function hue2rgb(p,q,t){if(t<0){t+=1;}
if(t>1){t-=1;}
if(t<1/6){return p+(q-p)*6*t;}
if(t<1/2){return q;}
if(t<2/3){return p+(q-p)*(2/3-t)*6;}
return p;}
fabric.Color.fromRgb=function(color){return Color.fromSource(Color.sourceFromRgb(color));};fabric.Color.sourceFromRgb=function(color){var match=color.match(Color.reRGBa);if(match){var r=parseInt(match[1],10)/(/%$/.test(match[1])?100:1)*(/%$/.test(match[1])?255:1),g=parseInt(match[2],10)/(/%$/.test(match[2])?100:1)*(/%$/.test(match[2])?255:1),b=parseInt(match[3],10)/(/%$/.test(match[3])?100:1)*(/%$/.test(match[3])?255:1);return[parseInt(r,10),parseInt(g,10),parseInt(b,10),match[4]?parseFloat(match[4]):1];}};fabric.Color.fromRgba=Color.fromRgb;fabric.Color.fromHsl=function(color){return Color.fromSource(Color.sourceFromHsl(color));};fabric.Color.sourceFromHsl=function(color){var match=color.match(Color.reHSLa);if(!match){return;}
var h=(((parseFloat(match[1])%360)+360)%360)/360,s=parseFloat(match[2])/(/%$/.test(match[2])?100:1),l=parseFloat(match[3])/(/%$/.test(match[3])?100:1),r,g,b;if(s===0){r=g=b=l;}
else{var q=l<=0.5?l*(s+1):l+s-l*s,p=l*2-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3);}
return[Math.round(r*255),Math.round(g*255),Math.round(b*255),match[4]?parseFloat(match[4]):1];};fabric.Color.fromHsla=Color.fromHsl;fabric.Color.fromHex=function(color){return Color.fromSource(Color.sourceFromHex(color));};fabric.Color.sourceFromHex=function(color){if(color.match(Color.reHex)){var value=color.slice(color.indexOf('#')+1),isShortNotation=(value.length===3||value.length===4),isRGBa=(value.length===8||value.length===4),r=isShortNotation?(value.charAt(0)+value.charAt(0)):value.substring(0,2),g=isShortNotation?(value.charAt(1)+value.charAt(1)):value.substring(2,4),b=isShortNotation?(value.charAt(2)+value.charAt(2)):value.substring(4,6),a=isRGBa?(isShortNotation?(value.charAt(3)+value.charAt(3)):value.substring(6,8)):'FF';return[parseInt(r,16),parseInt(g,16),parseInt(b,16),parseFloat((parseInt(a,16)/255).toFixed(2))];}};fabric.Color.fromSource=function(source){var oColor=new Color();oColor.setSource(source);return oColor;};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),scaleMap=['e','se','s','sw','w','nw','n','ne','e'],skewMap=['ns','nesw','ew','nwse'],controls={},LEFT='left',TOP='top',RIGHT='right',BOTTOM='bottom',CENTER='center',opposite={top:BOTTOM,bottom:TOP,left:RIGHT,right:LEFT,center:CENTER,},radiansToDegrees=fabric.util.radiansToDegrees,sign=(Math.sign||function(x){return((x>0)-(x<0))||+x;});function findCornerQuadrant(fabricObject,control){var cornerAngle=fabricObject.angle+radiansToDegrees(Math.atan2(control.y,control.x))+360;return Math.round((cornerAngle%360)/45);}
function fireEvent(eventName,options){var target=options.transform.target,canvas=target.canvas,canvasOptions=fabric.util.object.clone(options);canvasOptions.target=target;canvas&&canvas.fire('object:'+eventName,canvasOptions);target.fire(eventName,options);}
function scaleIsProportional(eventData,fabricObject){var canvas=fabricObject.canvas,uniScaleKey=canvas.uniScaleKey,uniformIsToggled=eventData[uniScaleKey];return(canvas.uniformScaling&&!uniformIsToggled)||(!canvas.uniformScaling&&uniformIsToggled);}
function isTransformCentered(transform){return transform.originX===CENTER&&transform.originY===CENTER;}
function scalingIsForbidden(fabricObject,by,scaleProportionally){var lockX=fabricObject.lockScalingX,lockY=fabricObject.lockScalingY;if(lockX&&lockY){return true;}
if(!by&&(lockX||lockY)&&scaleProportionally){return true;}
if(lockX&&by==='x'){return true;}
if(lockY&&by==='y'){return true;}
return false;}
function scaleCursorStyleHandler(eventData,control,fabricObject){var notAllowed='not-allowed',scaleProportionally=scaleIsProportional(eventData,fabricObject),by='';if(control.x!==0&&control.y===0){by='x';}
else if(control.x===0&&control.y!==0){by='y';}
if(scalingIsForbidden(fabricObject,by,scaleProportionally)){return notAllowed;}
var n=findCornerQuadrant(fabricObject,control);return scaleMap[n]+'-resize';}
function skewCursorStyleHandler(eventData,control,fabricObject){var notAllowed='not-allowed';if(control.x!==0&&fabricObject.lockSkewingY){return notAllowed;}
if(control.y!==0&&fabricObject.lockSkewingX){return notAllowed;}
var n=findCornerQuadrant(fabricObject,control)%4;return skewMap[n]+'-resize';}
function scaleSkewCursorStyleHandler(eventData,control,fabricObject){if(eventData[fabricObject.canvas.altActionKey]){return controls.skewCursorStyleHandler(eventData,control,fabricObject);}
return controls.scaleCursorStyleHandler(eventData,control,fabricObject);}
function scaleOrSkewActionName(eventData,control,fabricObject){var isAlternative=eventData[fabricObject.canvas.altActionKey];if(control.x===0){return isAlternative?'skewX':'scaleY';}
if(control.y===0){return isAlternative?'skewY':'scaleX';}}
function rotationStyleHandler(eventData,control,fabricObject){if(fabricObject.lockRotation){return'not-allowed';}
return control.cursorStyle;}
function commonEventInfo(eventData,transform,x,y){return{e:eventData,transform:transform,pointer:{x:x,y:y,}};}
function wrapWithFixedAnchor(actionHandler){return function(eventData,transform,x,y){var target=transform.target,centerPoint=target.getCenterPoint(),constraint=target.translateToOriginPoint(centerPoint,transform.originX,transform.originY),actionPerformed=actionHandler(eventData,transform,x,y);target.setPositionByOrigin(constraint,transform.originX,transform.originY);return actionPerformed;};}
function wrapWithFireEvent(eventName,actionHandler){return function(eventData,transform,x,y){var actionPerformed=actionHandler(eventData,transform,x,y);if(actionPerformed){fireEvent(eventName,commonEventInfo(eventData,transform,x,y));}
return actionPerformed;};}
function getLocalPoint(transform,originX,originY,x,y){var target=transform.target,control=target.controls[transform.corner],zoom=target.canvas.getZoom(),padding=target.padding/zoom,localPoint=target.toLocalPoint(new fabric.Point(x,y),originX,originY);if(localPoint.x>=padding){localPoint.x-=padding;}
if(localPoint.x<=-padding){localPoint.x+=padding;}
if(localPoint.y>=padding){localPoint.y-=padding;}
if(localPoint.y<=padding){localPoint.y+=padding;}
localPoint.x-=control.offsetX;localPoint.y-=control.offsetY;return localPoint;}
function targetHasOneFlip(target){return target.flipX!==target.flipY;}
function compensateScaleForSkew(target,oppositeSkew,scaleToCompensate,axis,reference){if(target[oppositeSkew]!==0){var newDim=target._getTransformedDimensions()[axis];var newValue=reference/newDim*target[scaleToCompensate];target.set(scaleToCompensate,newValue);}}
function skewObjectX(eventData,transform,x,y){var target=transform.target,dimNoSkew=target._getTransformedDimensions(0,target.skewY),localPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y),totalSkewSize=Math.abs(localPoint.x*2)-dimNoSkew.x,currentSkew=target.skewX,newSkew;if(totalSkewSize<2){newSkew=0;}
else{newSkew=radiansToDegrees(Math.atan2((totalSkewSize/target.scaleX),(dimNoSkew.y/target.scaleY)));if(transform.originX===LEFT&&transform.originY===BOTTOM){newSkew=-newSkew;}
if(transform.originX===RIGHT&&transform.originY===TOP){newSkew=-newSkew;}
if(targetHasOneFlip(target)){newSkew=-newSkew;}}
var hasSkewed=currentSkew!==newSkew;if(hasSkewed){var dimBeforeSkewing=target._getTransformedDimensions().y;target.set('skewX',newSkew);compensateScaleForSkew(target,'skewY','scaleY','y',dimBeforeSkewing);}
return hasSkewed;}
function skewObjectY(eventData,transform,x,y){var target=transform.target,dimNoSkew=target._getTransformedDimensions(target.skewX,0),localPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y),totalSkewSize=Math.abs(localPoint.y*2)-dimNoSkew.y,currentSkew=target.skewY,newSkew;if(totalSkewSize<2){newSkew=0;}
else{newSkew=radiansToDegrees(Math.atan2((totalSkewSize/target.scaleY),(dimNoSkew.x/target.scaleX)));if(transform.originX===LEFT&&transform.originY===BOTTOM){newSkew=-newSkew;}
if(transform.originX===RIGHT&&transform.originY===TOP){newSkew=-newSkew;}
if(targetHasOneFlip(target)){newSkew=-newSkew;}}
var hasSkewed=currentSkew!==newSkew;if(hasSkewed){var dimBeforeSkewing=target._getTransformedDimensions().x;target.set('skewY',newSkew);compensateScaleForSkew(target,'skewX','scaleX','x',dimBeforeSkewing);}
return hasSkewed;}
function skewHandlerX(eventData,transform,x,y){var target=transform.target,currentSkew=target.skewX,originX,originY=transform.originY;if(target.lockSkewingX){return false;}
if(currentSkew===0){var localPointFromCenter=getLocalPoint(transform,CENTER,CENTER,x,y);if(localPointFromCenter.x>0){originX=LEFT;}
else{originX=RIGHT;}}
else{if(currentSkew>0){originX=originY===TOP?LEFT:RIGHT;}
if(currentSkew<0){originX=originY===TOP?RIGHT:LEFT;}
if(targetHasOneFlip(target)){originX=originX===LEFT?RIGHT:LEFT;}}
transform.originX=originX;var finalHandler=wrapWithFireEvent('skewing',wrapWithFixedAnchor(skewObjectX));return finalHandler(eventData,transform,x,y);}
function skewHandlerY(eventData,transform,x,y){var target=transform.target,currentSkew=target.skewY,originY,originX=transform.originX;if(target.lockSkewingY){return false;}
if(currentSkew===0){var localPointFromCenter=getLocalPoint(transform,CENTER,CENTER,x,y);if(localPointFromCenter.y>0){originY=TOP;}
else{originY=BOTTOM;}}
else{if(currentSkew>0){originY=originX===LEFT?TOP:BOTTOM;}
if(currentSkew<0){originY=originX===LEFT?BOTTOM:TOP;}
if(targetHasOneFlip(target)){originY=originY===TOP?BOTTOM:TOP;}}
transform.originY=originY;var finalHandler=wrapWithFireEvent('skewing',wrapWithFixedAnchor(skewObjectY));return finalHandler(eventData,transform,x,y);}
function rotationWithSnapping(eventData,transform,x,y){var t=transform,target=t.target,pivotPoint=target.translateToOriginPoint(target.getCenterPoint(),t.originX,t.originY);if(target.lockRotation){return false;}
var lastAngle=Math.atan2(t.ey-pivotPoint.y,t.ex-pivotPoint.x),curAngle=Math.atan2(y-pivotPoint.y,x-pivotPoint.x),angle=radiansToDegrees(curAngle-lastAngle+t.theta),hasRotated=true;if(target.snapAngle>0){var snapAngle=target.snapAngle,snapThreshold=target.snapThreshold||snapAngle,rightAngleLocked=Math.ceil(angle/snapAngle)*snapAngle,leftAngleLocked=Math.floor(angle/snapAngle)*snapAngle;if(Math.abs(angle-leftAngleLocked)<snapThreshold){angle=leftAngleLocked;}
else if(Math.abs(angle-rightAngleLocked)<snapThreshold){angle=rightAngleLocked;}}
if(angle<0){angle=360+angle;}
angle%=360;hasRotated=target.angle!==angle;target.angle=angle;return hasRotated;}
function scaleObject(eventData,transform,x,y,options){options=options||{};var target=transform.target,lockScalingX=target.lockScalingX,lockScalingY=target.lockScalingY,by=options.by,newPoint,scaleX,scaleY,dim,scaleProportionally=scaleIsProportional(eventData,target),forbidScaling=scalingIsForbidden(target,by,scaleProportionally),signX,signY,gestureScale=transform.gestureScale;if(forbidScaling){return false;}
if(gestureScale){scaleX=transform.scaleX*gestureScale;scaleY=transform.scaleY*gestureScale;}
else{newPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y);signX=by!=='y'?sign(newPoint.x):1;signY=by!=='x'?sign(newPoint.y):1;if(!transform.signX){transform.signX=signX;}
if(!transform.signY){transform.signY=signY;}
if(target.lockScalingFlip&&(transform.signX!==signX||transform.signY!==signY)){return false;}
dim=target._getTransformedDimensions();if(scaleProportionally&&!by){var distance=Math.abs(newPoint.x)+Math.abs(newPoint.y),original=transform.original,originalDistance=Math.abs(dim.x*original.scaleX/target.scaleX)+
Math.abs(dim.y*original.scaleY/target.scaleY),scale=distance/originalDistance;scaleX=original.scaleX*scale;scaleY=original.scaleY*scale;}
else{scaleX=Math.abs(newPoint.x*target.scaleX/dim.x);scaleY=Math.abs(newPoint.y*target.scaleY/dim.y);}
if(isTransformCentered(transform)){scaleX*=2;scaleY*=2;}
if(transform.signX!==signX&&by!=='y'){transform.originX=opposite[transform.originX];scaleX*=-1;transform.signX=signX;}
if(transform.signY!==signY&&by!=='x'){transform.originY=opposite[transform.originY];scaleY*=-1;transform.signY=signY;}}
var oldScaleX=target.scaleX,oldScaleY=target.scaleY;if(!by){!lockScalingX&&target.set('scaleX',scaleX);!lockScalingY&&target.set('scaleY',scaleY);}
else{by==='x'&&target.set('scaleX',scaleX);by==='y'&&target.set('scaleY',scaleY);}
return oldScaleX!==target.scaleX||oldScaleY!==target.scaleY;}
function scaleObjectFromCorner(eventData,transform,x,y){return scaleObject(eventData,transform,x,y);}
function scaleObjectX(eventData,transform,x,y){return scaleObject(eventData,transform,x,y,{by:'x'});}
function scaleObjectY(eventData,transform,x,y){return scaleObject(eventData,transform,x,y,{by:'y'});}
function scalingYOrSkewingX(eventData,transform,x,y){if(eventData[transform.target.canvas.altActionKey]){return controls.skewHandlerX(eventData,transform,x,y);}
return controls.scalingY(eventData,transform,x,y);}
function scalingXOrSkewingY(eventData,transform,x,y){if(eventData[transform.target.canvas.altActionKey]){return controls.skewHandlerY(eventData,transform,x,y);}
return controls.scalingX(eventData,transform,x,y);}
function changeWidth(eventData,transform,x,y){var target=transform.target,localPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y),strokePadding=target.strokeWidth/(target.strokeUniform?target.scaleX:1),multiplier=isTransformCentered(transform)?2:1,oldWidth=target.width,newWidth=Math.abs(localPoint.x*multiplier/target.scaleX)-strokePadding;target.set('width',Math.max(newWidth,0));return oldWidth!==newWidth;}
function dragHandler(eventData,transform,x,y){var target=transform.target,newLeft=x-transform.offsetX,newTop=y-transform.offsetY,moveX=!target.get('lockMovementX')&&target.left!==newLeft,moveY=!target.get('lockMovementY')&&target.top!==newTop;moveX&&target.set('left',newLeft);moveY&&target.set('top',newTop);if(moveX||moveY){fireEvent('moving',commonEventInfo(eventData,transform,x,y));}
return moveX||moveY;}
controls.scaleCursorStyleHandler=scaleCursorStyleHandler;controls.skewCursorStyleHandler=skewCursorStyleHandler;controls.scaleSkewCursorStyleHandler=scaleSkewCursorStyleHandler;controls.rotationWithSnapping=wrapWithFireEvent('rotating',wrapWithFixedAnchor(rotationWithSnapping));controls.scalingEqually=wrapWithFireEvent('scaling',wrapWithFixedAnchor(scaleObjectFromCorner));controls.scalingX=wrapWithFireEvent('scaling',wrapWithFixedAnchor(scaleObjectX));controls.scalingY=wrapWithFireEvent('scaling',wrapWithFixedAnchor(scaleObjectY));controls.scalingYOrSkewingX=scalingYOrSkewingX;controls.scalingXOrSkewingY=scalingXOrSkewingY;controls.changeWidth=wrapWithFireEvent('resizing',wrapWithFixedAnchor(changeWidth));controls.skewHandlerX=skewHandlerX;controls.skewHandlerY=skewHandlerY;controls.dragHandler=dragHandler;controls.scaleOrSkewActionName=scaleOrSkewActionName;controls.rotationStyleHandler=rotationStyleHandler;controls.fireEvent=fireEvent;controls.wrapWithFixedAnchor=wrapWithFixedAnchor;controls.wrapWithFireEvent=wrapWithFireEvent;controls.getLocalPoint=getLocalPoint;fabric.controlsUtils=controls;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),degreesToRadians=fabric.util.degreesToRadians,controls=fabric.controlsUtils;function renderCircleControl(ctx,left,top,styleOverride,fabricObject){styleOverride=styleOverride||{};var xSize=this.sizeX||styleOverride.cornerSize||fabricObject.cornerSize,ySize=this.sizeY||styleOverride.cornerSize||fabricObject.cornerSize,transparentCorners=typeof styleOverride.transparentCorners!=='undefined'?styleOverride.transparentCorners:fabricObject.transparentCorners,methodName=transparentCorners?'stroke':'fill',stroke=!transparentCorners&&(styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor),myLeft=left,myTop=top,size;ctx.save();ctx.fillStyle=styleOverride.cornerColor||fabricObject.cornerColor;ctx.strokeStyle=styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor;if(xSize>ySize){size=xSize;ctx.scale(1.0,ySize/xSize);myTop=top*xSize/ySize;}
else if(ySize>xSize){size=ySize;ctx.scale(xSize/ySize,1.0);myLeft=left*ySize/xSize;}
else{size=xSize;}
ctx.lineWidth=1;ctx.beginPath();ctx.arc(myLeft,myTop,size/2,0,2*Math.PI,false);ctx[methodName]();if(stroke){ctx.stroke();}
ctx.restore();}
function renderSquareControl(ctx,left,top,styleOverride,fabricObject){styleOverride=styleOverride||{};var xSize=this.sizeX||styleOverride.cornerSize||fabricObject.cornerSize,ySize=this.sizeY||styleOverride.cornerSize||fabricObject.cornerSize,transparentCorners=typeof styleOverride.transparentCorners!=='undefined'?styleOverride.transparentCorners:fabricObject.transparentCorners,methodName=transparentCorners?'stroke':'fill',stroke=!transparentCorners&&(styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor),xSizeBy2=xSize/2,ySizeBy2=ySize/2;ctx.save();ctx.fillStyle=styleOverride.cornerColor||fabricObject.cornerColor;ctx.strokeStyle=styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor;ctx.lineWidth=1;ctx.translate(left,top);ctx.rotate(degreesToRadians(fabricObject.angle));ctx[methodName+'Rect'](-xSizeBy2,-ySizeBy2,xSize,ySize);if(stroke){ctx.strokeRect(-xSizeBy2,-ySizeBy2,xSize,ySize);}
ctx.restore();}
controls.renderCircleControl=renderCircleControl;controls.renderSquareControl=renderSquareControl;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});function Control(options){for(var i in options){this[i]=options[i];}}
fabric.Control=Control;fabric.Control.prototype={visible:true,actionName:'scale',angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:'crosshair',withConnection:false,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler;},getMouseDownHandler:function(){return this.mouseDownHandler;},getMouseUpHandler:function(){return this.mouseUpHandler;},cursorStyleHandler:function(eventData,control){return control.cursorStyle;},getActionName:function(eventData,control){return control.actionName;},getVisibility:function(fabricObject,controlKey){var objectVisibility=fabricObject._controlsVisibility;if(objectVisibility&&typeof objectVisibility[controlKey]!=='undefined'){return objectVisibility[controlKey];}
return this.visible;},setVisibility:function(visibility){this.visible=visibility;},positionHandler:function(dim,finalMatrix){var point=fabric.util.transformPoint({x:this.x*dim.x+this.offsetX,y:this.y*dim.y+this.offsetY},finalMatrix);return point;},calcCornerCoords:function(objectAngle,objectCornerSize,centerX,centerY,isTouch){var cosHalfOffset,sinHalfOffset,cosHalfOffsetComp,sinHalfOffsetComp,xSize=(isTouch)?this.touchSizeX:this.sizeX,ySize=(isTouch)?this.touchSizeY:this.sizeY;if(xSize&&ySize&&xSize!==ySize){var controlTriangleAngle=Math.atan2(ySize,xSize);var cornerHypotenuse=Math.sqrt(xSize*xSize+ySize*ySize)/2;var newTheta=controlTriangleAngle-fabric.util.degreesToRadians(objectAngle);var newThetaComp=Math.PI/2-controlTriangleAngle-fabric.util.degreesToRadians(objectAngle);cosHalfOffset=cornerHypotenuse*fabric.util.cos(newTheta);sinHalfOffset=cornerHypotenuse*fabric.util.sin(newTheta);cosHalfOffsetComp=cornerHypotenuse*fabric.util.cos(newThetaComp);sinHalfOffsetComp=cornerHypotenuse*fabric.util.sin(newThetaComp);}
else{var cornerSize=(xSize&&ySize)?xSize:objectCornerSize;cornerHypotenuse=cornerSize*0.7071067812;var newTheta=fabric.util.degreesToRadians(45-objectAngle);cosHalfOffset=cosHalfOffsetComp=cornerHypotenuse*fabric.util.cos(newTheta);sinHalfOffset=sinHalfOffsetComp=cornerHypotenuse*fabric.util.sin(newTheta);}
return{tl:{x:centerX-sinHalfOffsetComp,y:centerY-cosHalfOffsetComp,},tr:{x:centerX+cosHalfOffset,y:centerY-sinHalfOffset,},bl:{x:centerX-cosHalfOffset,y:centerY+sinHalfOffset,},br:{x:centerX+sinHalfOffsetComp,y:centerY+cosHalfOffsetComp,},};},render:function(ctx,left,top,styleOverride,fabricObject){styleOverride=styleOverride||{};switch(styleOverride.cornerStyle||fabricObject.cornerStyle){case'circle':fabric.controlsUtils.renderCircleControl.call(this,ctx,left,top,styleOverride,fabricObject);break;default:fabric.controlsUtils.renderSquareControl.call(this,ctx,left,top,styleOverride,fabricObject);}},};})(typeof exports!=='undefined'?exports:this);(function(){function getColorStop(el,multiplier){var style=el.getAttribute('style'),offset=el.getAttribute('offset')||0,color,colorAlpha,opacity,i;offset=parseFloat(offset)/(/%$/.test(offset)?100:1);offset=offset<0?0:offset>1?1:offset;if(style){var keyValuePairs=style.split(/\s*;\s*/);if(keyValuePairs[keyValuePairs.length-1]===''){keyValuePairs.pop();}
for(i=keyValuePairs.length;i--;){var split=keyValuePairs[i].split(/\s*:\s*/),key=split[0].trim(),value=split[1].trim();if(key==='stop-color'){color=value;}
else if(key==='stop-opacity'){opacity=value;}}}
if(!color){color=el.getAttribute('stop-color')||'rgb(0,0,0)';}
if(!opacity){opacity=el.getAttribute('stop-opacity');}
color=new fabric.Color(color);colorAlpha=color.getAlpha();opacity=isNaN(parseFloat(opacity))?1:parseFloat(opacity);opacity*=colorAlpha*multiplier;return{offset:offset,color:color.toRgb(),opacity:opacity};}
function getLinearCoords(el){return{x1:el.getAttribute('x1')||0,y1:el.getAttribute('y1')||0,x2:el.getAttribute('x2')||'100%',y2:el.getAttribute('y2')||0};}
function getRadialCoords(el){return{x1:el.getAttribute('fx')||el.getAttribute('cx')||'50%',y1:el.getAttribute('fy')||el.getAttribute('cy')||'50%',r1:0,x2:el.getAttribute('cx')||'50%',y2:el.getAttribute('cy')||'50%',r2:el.getAttribute('r')||'50%'};}
var clone=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:'pixels',type:'linear',initialize:function(options){options||(options={});options.coords||(options.coords={});var coords,_this=this;Object.keys(options).forEach(function(option){_this[option]=options[option];});if(this.id){this.id+='_'+fabric.Object.__uid++;}
else{this.id=fabric.Object.__uid++;}
coords={x1:options.coords.x1||0,y1:options.coords.y1||0,x2:options.coords.x2||0,y2:options.coords.y2||0};if(this.type==='radial'){coords.r1=options.coords.r1||0;coords.r2=options.coords.r2||0;}
this.coords=coords;this.colorStops=options.colorStops.slice();},addColorStop:function(colorStops){for(var position in colorStops){var color=new fabric.Color(colorStops[position]);this.colorStops.push({offset:parseFloat(position),color:color.toRgb(),opacity:color.getAlpha()});}
return this;},toObject:function(propertiesToInclude){var object={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};fabric.util.populateWithProperties(this,object,propertiesToInclude);return object;},toSVG:function(object,options){var coords=clone(this.coords,true),i,len,options=options||{},markup,commonAttributes,colorStops=clone(this.colorStops,true),needsSwap=coords.r1>coords.r2,transform=this.gradientTransform?this.gradientTransform.concat():fabric.iMatrix.concat(),offsetX=-this.offsetX,offsetY=-this.offsetY,withViewport=!!options.additionalTransform,gradientUnits=this.gradientUnits==='pixels'?'userSpaceOnUse':'objectBoundingBox';colorStops.sort(function(a,b){return a.offset-b.offset;});if(gradientUnits==='objectBoundingBox'){offsetX/=object.width;offsetY/=object.height;}
else{offsetX+=object.width/2;offsetY+=object.height/2;}
if(object.type==='path'&&this.gradientUnits!=='percentage'){offsetX-=object.pathOffset.x;offsetY-=object.pathOffset.y;}
transform[4]-=offsetX;transform[5]-=offsetY;commonAttributes='id="SVGID_'+this.id+'" gradientUnits="'+gradientUnits+'"';commonAttributes+=' gradientTransform="'+(withViewport?options.additionalTransform+' ':'')+fabric.util.matrixToSVG(transform)+'" ';if(this.type==='linear'){markup=['<linearGradient ',commonAttributes,' x1="',coords.x1,'" y1="',coords.y1,'" x2="',coords.x2,'" y2="',coords.y2,'">\n'];}
else if(this.type==='radial'){markup=['<radialGradient ',commonAttributes,' cx="',needsSwap?coords.x1:coords.x2,'" cy="',needsSwap?coords.y1:coords.y2,'" r="',needsSwap?coords.r1:coords.r2,'" fx="',needsSwap?coords.x2:coords.x1,'" fy="',needsSwap?coords.y2:coords.y1,'">\n'];}
if(this.type==='radial'){if(needsSwap){colorStops=colorStops.concat();colorStops.reverse();for(i=0,len=colorStops.length;i<len;i++){colorStops[i].offset=1-colorStops[i].offset;}}
var minRadius=Math.min(coords.r1,coords.r2);if(minRadius>0){var maxRadius=Math.max(coords.r1,coords.r2),percentageShift=minRadius/maxRadius;for(i=0,len=colorStops.length;i<len;i++){colorStops[i].offset+=percentageShift*(1-colorStops[i].offset);}}}
for(i=0,len=colorStops.length;i<len;i++){var colorStop=colorStops[i];markup.push('<stop ','offset="',(colorStop.offset*100)+'%','" style="stop-color:',colorStop.color,(typeof colorStop.opacity!=='undefined'?';stop-opacity: '+colorStop.opacity:';'),'"/>\n');}
markup.push((this.type==='linear'?'</linearGradient>\n':'</radialGradient>\n'));return markup.join('');},toLive:function(ctx){var gradient,coords=fabric.util.object.clone(this.coords),i,len;if(!this.type){return;}
if(this.type==='linear'){gradient=ctx.createLinearGradient(coords.x1,coords.y1,coords.x2,coords.y2);}
else if(this.type==='radial'){gradient=ctx.createRadialGradient(coords.x1,coords.y1,coords.r1,coords.x2,coords.y2,coords.r2);}
for(i=0,len=this.colorStops.length;i<len;i++){var color=this.colorStops[i].color,opacity=this.colorStops[i].opacity,offset=this.colorStops[i].offset;if(typeof opacity!=='undefined'){color=new fabric.Color(color).setAlpha(opacity).toRgba();}
gradient.addColorStop(offset,color);}
return gradient;}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(el,instance,opacityAttr,svgOptions){var multiplier=parseFloat(opacityAttr)/(/%$/.test(opacityAttr)?100:1);multiplier=multiplier<0?0:multiplier>1?1:multiplier;if(isNaN(multiplier)){multiplier=1;}
var colorStopEls=el.getElementsByTagName('stop'),type,gradientUnits=el.getAttribute('gradientUnits')==='userSpaceOnUse'?'pixels':'percentage',gradientTransform=el.getAttribute('gradientTransform')||'',colorStops=[],coords,i,offsetX=0,offsetY=0,transformMatrix;if(el.nodeName==='linearGradient'||el.nodeName==='LINEARGRADIENT'){type='linear';coords=getLinearCoords(el);}
else{type='radial';coords=getRadialCoords(el);}
for(i=colorStopEls.length;i--;){colorStops.push(getColorStop(colorStopEls[i],multiplier));}
transformMatrix=fabric.parseTransformAttribute(gradientTransform);__convertPercentUnitsToValues(instance,coords,svgOptions,gradientUnits);if(gradientUnits==='pixels'){offsetX=-instance.left;offsetY=-instance.top;}
var gradient=new fabric.Gradient({id:el.getAttribute('id'),type:type,coords:coords,colorStops:colorStops,gradientUnits:gradientUnits,gradientTransform:transformMatrix,offsetX:offsetX,offsetY:offsetY,});return gradient;}});function __convertPercentUnitsToValues(instance,options,svgOptions,gradientUnits){var propValue,finalValue;Object.keys(options).forEach(function(prop){propValue=options[prop];if(propValue==='Infinity'){finalValue=1;}
else if(propValue==='-Infinity'){finalValue=0;}
else{finalValue=parseFloat(options[prop],10);if(typeof propValue==='string'&&/^(\d+\.\d+)%|(\d+)%$/.test(propValue)){finalValue*=0.01;if(gradientUnits==='pixels'){if(prop==='x1'||prop==='x2'||prop==='r2'){finalValue*=svgOptions.viewBoxWidth||svgOptions.width;}
if(prop==='y1'||prop==='y2'){finalValue*=svgOptions.viewBoxHeight||svgOptions.height;}}}}
options[prop]=finalValue;});}})();(function(){'use strict';var toFixed=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:'repeat',offsetX:0,offsetY:0,crossOrigin:'',patternTransform:null,initialize:function(options,callback){options||(options={});this.id=fabric.Object.__uid++;this.setOptions(options);if(!options.source||(options.source&&typeof options.source!=='string')){callback&&callback(this);return;}
else{var _this=this;this.source=fabric.util.createImage();fabric.util.loadImage(options.source,function(img,isError){_this.source=img;callback&&callback(_this,isError);},null,this.crossOrigin);}},toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,source,object;if(typeof this.source.src==='string'){source=this.source.src;}
else if(typeof this.source==='object'&&this.source.toDataURL){source=this.source.toDataURL();}
object={type:'pattern',source:source,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:toFixed(this.offsetX,NUM_FRACTION_DIGITS),offsetY:toFixed(this.offsetY,NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?this.patternTransform.concat():null};fabric.util.populateWithProperties(this,object,propertiesToInclude);return object;},toSVG:function(object){var patternSource=typeof this.source==='function'?this.source():this.source,patternWidth=patternSource.width/object.width,patternHeight=patternSource.height/object.height,patternOffsetX=this.offsetX/object.width,patternOffsetY=this.offsetY/object.height,patternImgSrc='';if(this.repeat==='repeat-x'||this.repeat==='no-repeat'){patternHeight=1;if(patternOffsetY){patternHeight+=Math.abs(patternOffsetY);}}
if(this.repeat==='repeat-y'||this.repeat==='no-repeat'){patternWidth=1;if(patternOffsetX){patternWidth+=Math.abs(patternOffsetX);}}
if(patternSource.src){patternImgSrc=patternSource.src;}
else if(patternSource.toDataURL){patternImgSrc=patternSource.toDataURL();}
return'<pattern id="SVGID_'+this.id+'" x="'+patternOffsetX+'" y="'+patternOffsetY+'" width="'+patternWidth+'" height="'+patternHeight+'">\n'+'<image x="0" y="0"'+' width="'+patternSource.width+'" height="'+patternSource.height+'" xlink:href="'+patternImgSrc+'"></image>\n'+'</pattern>\n';},setOptions:function(options){for(var prop in options){this[prop]=options[prop];}},toLive:function(ctx){var source=this.source;if(!source){return'';}
if(typeof source.src!=='undefined'){if(!source.complete){return'';}
if(source.naturalWidth===0||source.naturalHeight===0){return'';}}
return ctx.createPattern(source,this.repeat);}});})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),toFixed=fabric.util.toFixed;if(fabric.Shadow){fabric.warn('fabric.Shadow is already defined.');return;}
fabric.Shadow=fabric.util.createClass({color:'rgb(0,0,0)',blur:0,offsetX:0,offsetY:0,affectStroke:false,includeDefaultValues:true,nonScaling:false,initialize:function(options){if(typeof options==='string'){options=this._parseShadow(options);}
for(var prop in options){this[prop]=options[prop];}
this.id=fabric.Object.__uid++;},_parseShadow:function(shadow){var shadowStr=shadow.trim(),offsetsAndBlur=fabric.Shadow.reOffsetsAndBlur.exec(shadowStr)||[],color=shadowStr.replace(fabric.Shadow.reOffsetsAndBlur,'')||'rgb(0,0,0)';return{color:color.trim(),offsetX:parseFloat(offsetsAndBlur[1],10)||0,offsetY:parseFloat(offsetsAndBlur[2],10)||0,blur:parseFloat(offsetsAndBlur[3],10)||0};},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join('px ');},toSVG:function(object){var fBoxX=40,fBoxY=40,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,offset=fabric.util.rotateVector({x:this.offsetX,y:this.offsetY},fabric.util.degreesToRadians(-object.angle)),BLUR_BOX=20,color=new fabric.Color(this.color);if(object.width&&object.height){fBoxX=toFixed((Math.abs(offset.x)+this.blur)/object.width,NUM_FRACTION_DIGITS)*100+BLUR_BOX;fBoxY=toFixed((Math.abs(offset.y)+this.blur)/object.height,NUM_FRACTION_DIGITS)*100+BLUR_BOX;}
if(object.flipX){offset.x*=-1;}
if(object.flipY){offset.y*=-1;}
return('<filter id="SVGID_'+this.id+'" y="-'+fBoxY+'%" height="'+(100+2*fBoxY)+'%" '+'x="-'+fBoxX+'%" width="'+(100+2*fBoxX)+'%" '+'>\n'+'\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+
toFixed(this.blur?this.blur/2:0,NUM_FRACTION_DIGITS)+'"></feGaussianBlur>\n'+'\t<feOffset dx="'+toFixed(offset.x,NUM_FRACTION_DIGITS)+'" dy="'+toFixed(offset.y,NUM_FRACTION_DIGITS)+'" result="oBlur" ></feOffset>\n'+'\t<feFlood flood-color="'+color.toRgb()+'" flood-opacity="'+color.getAlpha()+'"/>\n'+'\t<feComposite in2="oBlur" operator="in" />\n'+'\t<feMerge>\n'+'\t\t<feMergeNode></feMergeNode>\n'+'\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n'+'\t</feMerge>\n'+'</filter>\n');},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};}
var obj={},proto=fabric.Shadow.prototype;['color','blur','offsetX','offsetY','affectStroke','nonScaling'].forEach(function(prop){if(this[prop]!==proto[prop]){obj[prop]=this[prop];}},this);return obj;}});fabric.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/;})(typeof exports!=='undefined'?exports:this);(function(){'use strict';if(fabric.StaticCanvas){fabric.warn('fabric.StaticCanvas is already defined.');return;}
var extend=fabric.util.object.extend,getElementOffset=fabric.util.getElementOffset,removeFromArray=fabric.util.removeFromArray,toFixed=fabric.util.toFixed,transformPoint=fabric.util.transformPoint,invertTransform=fabric.util.invertTransform,getNodeCanvas=fabric.util.getNodeCanvas,createCanvasElement=fabric.util.createCanvasElement,CANVAS_INIT_ERROR=new Error('Could not initialize `canvas` element');fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(el,options){options||(options={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(el,options);},backgroundColor:'',backgroundImage:null,overlayColor:'',overlayImage:null,includeDefaultValues:true,stateful:false,renderOnAddRemove:true,controlsAboveOverlay:false,allowTouchScrolling:false,imageSmoothingEnabled:true,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:true,overlayVpt:true,enableRetinaScaling:true,vptCoords:{},skipOffscreen:true,clipPath:undefined,_initStatic:function(el,options){var cb=this.requestRenderAllBound;this._objects=[];this._createLowerCanvas(el);this._initOptions(options);if(!this.interactive){this._initRetinaScaling();}
if(options.overlayImage){this.setOverlayImage(options.overlayImage,cb);}
if(options.backgroundImage){this.setBackgroundImage(options.backgroundImage,cb);}
if(options.backgroundColor){this.setBackgroundColor(options.backgroundColor,cb);}
if(options.overlayColor){this.setOverlayColor(options.overlayColor,cb);}
this.calcOffset();},_isRetinaScaling:function(){return(fabric.devicePixelRatio>1&&this.enableRetinaScaling);},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,fabric.devicePixelRatio):1;},_initRetinaScaling:function(){if(!this._isRetinaScaling()){return;}
var scaleRatio=fabric.devicePixelRatio;this.__initRetinaScaling(scaleRatio,this.lowerCanvasEl,this.contextContainer);if(this.upperCanvasEl){this.__initRetinaScaling(scaleRatio,this.upperCanvasEl,this.contextTop);}},__initRetinaScaling:function(scaleRatio,canvas,context){canvas.setAttribute('width',this.width*scaleRatio);canvas.setAttribute('height',this.height*scaleRatio);context.scale(scaleRatio,scaleRatio);},calcOffset:function(){this._offset=getElementOffset(this.lowerCanvasEl);return this;},setOverlayImage:function(image,callback,options){return this.__setBgOverlayImage('overlayImage',image,callback,options);},setBackgroundImage:function(image,callback,options){return this.__setBgOverlayImage('backgroundImage',image,callback,options);},setOverlayColor:function(overlayColor,callback){return this.__setBgOverlayColor('overlayColor',overlayColor,callback);},setBackgroundColor:function(backgroundColor,callback){return this.__setBgOverlayColor('backgroundColor',backgroundColor,callback);},__setBgOverlayImage:function(property,image,callback,options){if(typeof image==='string'){fabric.util.loadImage(image,function(img,isError){if(img){var instance=new fabric.Image(img,options);this[property]=instance;instance.canvas=this;}
callback&&callback(img,isError);},this,options&&options.crossOrigin);}
else{options&&image.setOptions(options);this[property]=image;image&&(image.canvas=this);callback&&callback(image,false);}
return this;},__setBgOverlayColor:function(property,color,callback){this[property]=color;this._initGradient(color,property);this._initPattern(color,property,callback);return this;},_createCanvasElement:function(){var element=createCanvasElement();if(!element){throw CANVAS_INIT_ERROR;}
if(!element.style){element.style={};}
if(typeof element.getContext==='undefined'){throw CANVAS_INIT_ERROR;}
return element;},_initOptions:function(options){var lowerCanvasEl=this.lowerCanvasEl;this._setOptions(options);this.width=this.width||parseInt(lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return;}
lowerCanvasEl.width=this.width;lowerCanvasEl.height=this.height;lowerCanvasEl.style.width=this.width+'px';lowerCanvasEl.style.height=this.height+'px';this.viewportTransform=this.viewportTransform.slice();},_createLowerCanvas:function(canvasEl){if(canvasEl&&canvasEl.getContext){this.lowerCanvasEl=canvasEl;}
else{this.lowerCanvasEl=fabric.util.getById(canvasEl)||this._createCanvasElement();}
fabric.util.addClass(this.lowerCanvasEl,'lower-canvas');this._originalCanvasStyle=this.lowerCanvasEl.style;if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl);}
this.contextContainer=this.lowerCanvasEl.getContext('2d');},getWidth:function(){return this.width;},getHeight:function(){return this.height;},setWidth:function(value,options){return this.setDimensions({width:value},options);},setHeight:function(value,options){return this.setDimensions({height:value},options);},setDimensions:function(dimensions,options){var cssValue;options=options||{};for(var prop in dimensions){cssValue=dimensions[prop];if(!options.cssOnly){this._setBackstoreDimension(prop,dimensions[prop]);cssValue+='px';this.hasLostContext=true;}
if(!options.backstoreOnly){this._setCssDimension(prop,cssValue);}}
if(this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop);}
this._initRetinaScaling();this.calcOffset();if(!options.cssOnly){this.requestRenderAll();}
return this;},_setBackstoreDimension:function(prop,value){this.lowerCanvasEl[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl[prop]=value;}
if(this.cacheCanvasEl){this.cacheCanvasEl[prop]=value;}
this[prop]=value;return this;},_setCssDimension:function(prop,value){this.lowerCanvasEl.style[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl.style[prop]=value;}
if(this.wrapperEl){this.wrapperEl.style[prop]=value;}
return this;},getZoom:function(){return this.viewportTransform[0];},setViewportTransform:function(vpt){var activeObject=this._activeObject,backgroundObject=this.backgroundImage,overlayObject=this.overlayImage,object,i,len;this.viewportTransform=vpt;for(i=0,len=this._objects.length;i<len;i++){object=this._objects[i];object.group||object.setCoords(true);}
if(activeObject){activeObject.setCoords();}
if(backgroundObject){backgroundObject.setCoords(true);}
if(overlayObject){overlayObject.setCoords(true);}
this.calcViewportBoundaries();this.renderOnAddRemove&&this.requestRenderAll();return this;},zoomToPoint:function(point,value){var before=point,vpt=this.viewportTransform.slice(0);point=transformPoint(point,invertTransform(this.viewportTransform));vpt[0]=value;vpt[3]=value;var after=transformPoint(point,vpt);vpt[4]+=before.x-after.x;vpt[5]+=before.y-after.y;return this.setViewportTransform(vpt);},setZoom:function(value){this.zoomToPoint(new fabric.Point(0,0),value);return this;},absolutePan:function(point){var vpt=this.viewportTransform.slice(0);vpt[4]=-point.x;vpt[5]=-point.y;return this.setViewportTransform(vpt);},relativePan:function(point){return this.absolutePan(new fabric.Point(-point.x-this.viewportTransform[4],-point.y-this.viewportTransform[5]));},getElement:function(){return this.lowerCanvasEl;},_onObjectAdded:function(obj){this.stateful&&obj.setupState();obj._set('canvas',this);obj.setCoords();this.fire('object:added',{target:obj});obj.fire('added');},_onObjectRemoved:function(obj){this.fire('object:removed',{target:obj});obj.fire('removed');delete obj.canvas;},clearContext:function(ctx){ctx.clearRect(0,0,this.width,this.height);return this;},getContext:function(){return this.contextContainer;},clear:function(){this.remove.apply(this,this.getObjects());this.backgroundImage=null;this.overlayImage=null;this.backgroundColor='';this.overlayColor='';if(this._hasITextHandlers){this.off('mouse:up',this._mouseUpITextHandler);this._iTextInstances=null;this._hasITextHandlers=false;}
this.clearContext(this.contextContainer);this.fire('canvas:cleared');this.renderOnAddRemove&&this.requestRenderAll();return this;},renderAll:function(){var canvasToDrawOn=this.contextContainer;this.renderCanvas(canvasToDrawOn,this._objects);return this;},renderAndReset:function(){this.isRendering=0;this.renderAll();},requestRenderAll:function(){if(!this.isRendering){this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound);}
return this;},calcViewportBoundaries:function(){var points={},width=this.width,height=this.height,iVpt=invertTransform(this.viewportTransform);points.tl=transformPoint({x:0,y:0},iVpt);points.br=transformPoint({x:width,y:height},iVpt);points.tr=new fabric.Point(points.br.x,points.tl.y);points.bl=new fabric.Point(points.tl.x,points.br.y);this.vptCoords=points;return points;},cancelRequestedRender:function(){if(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0;}},renderCanvas:function(ctx,objects){var v=this.viewportTransform,path=this.clipPath;this.cancelRequestedRender();this.calcViewportBoundaries();this.clearContext(ctx);fabric.util.setImageSmoothing(ctx,this.imageSmoothingEnabled);this.fire('before:render',{ctx:ctx,});this._renderBackground(ctx);ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);this._renderObjects(ctx,objects);ctx.restore();if(!this.controlsAboveOverlay&&this.interactive){this.drawControls(ctx);}
if(path){path.canvas=this;path.shouldCache();path._transformDone=true;path.renderCache({forClipping:true});this.drawClipPathOnCanvas(ctx);}
this._renderOverlay(ctx);if(this.controlsAboveOverlay&&this.interactive){this.drawControls(ctx);}
this.fire('after:render',{ctx:ctx,});},drawClipPathOnCanvas:function(ctx){var v=this.viewportTransform,path=this.clipPath;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);ctx.globalCompositeOperation='destination-in';path.transform(ctx);ctx.scale(1/path.zoomX,1/path.zoomY);ctx.drawImage(path._cacheCanvas,-path.cacheTranslationX,-path.cacheTranslationY);ctx.restore();},_renderObjects:function(ctx,objects){var i,len;for(i=0,len=objects.length;i<len;++i){objects[i]&&objects[i].render(ctx);}},_renderBackgroundOrOverlay:function(ctx,property){var fill=this[property+'Color'],object=this[property+'Image'],v=this.viewportTransform,needsVpt=this[property+'Vpt'];if(!fill&&!object){return;}
if(fill){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(this.width,0);ctx.lineTo(this.width,this.height);ctx.lineTo(0,this.height);ctx.closePath();ctx.fillStyle=fill.toLive?fill.toLive(ctx,this):fill;if(needsVpt){ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);}
ctx.transform(1,0,0,1,fill.offsetX||0,fill.offsetY||0);var m=fill.gradientTransform||fill.patternTransform;m&&ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]);ctx.fill();ctx.restore();}
if(object){ctx.save();if(needsVpt){ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);}
object.render(ctx);ctx.restore();}},_renderBackground:function(ctx){this._renderBackgroundOrOverlay(ctx,'background');},_renderOverlay:function(ctx){this._renderBackgroundOrOverlay(ctx,'overlay');},getCenter:function(){return{top:this.height/2,left:this.width/2};},centerObjectH:function(object){return this._centerObject(object,new fabric.Point(this.getCenter().left,object.getCenterPoint().y));},centerObjectV:function(object){return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,this.getCenter().top));},centerObject:function(object){var center=this.getCenter();return this._centerObject(object,new fabric.Point(center.left,center.top));},viewportCenterObject:function(object){var vpCenter=this.getVpCenter();return this._centerObject(object,vpCenter);},viewportCenterObjectH:function(object){var vpCenter=this.getVpCenter();this._centerObject(object,new fabric.Point(vpCenter.x,object.getCenterPoint().y));return this;},viewportCenterObjectV:function(object){var vpCenter=this.getVpCenter();return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,vpCenter.y));},getVpCenter:function(){var center=this.getCenter(),iVpt=invertTransform(this.viewportTransform);return transformPoint({x:center.left,y:center.top},iVpt);},_centerObject:function(object,center){object.setPositionByOrigin(center,'center','center');object.setCoords();this.renderOnAddRemove&&this.requestRenderAll();return this;},toDatalessJSON:function(propertiesToInclude){return this.toDatalessObject(propertiesToInclude);},toObject:function(propertiesToInclude){return this._toObjectMethod('toObject',propertiesToInclude);},toDatalessObject:function(propertiesToInclude){return this._toObjectMethod('toDatalessObject',propertiesToInclude);},_toObjectMethod:function(methodName,propertiesToInclude){var clipPath=this.clipPath,data={version:fabric.version,objects:this._toObjects(methodName,propertiesToInclude),};if(clipPath&&!clipPath.excludeFromExport){data.clipPath=this._toObject(this.clipPath,methodName,propertiesToInclude);}
extend(data,this.__serializeBgOverlay(methodName,propertiesToInclude));fabric.util.populateWithProperties(this,data,propertiesToInclude);return data;},_toObjects:function(methodName,propertiesToInclude){return this._objects.filter(function(object){return!object.excludeFromExport;}).map(function(instance){return this._toObject(instance,methodName,propertiesToInclude);},this);},_toObject:function(instance,methodName,propertiesToInclude){var originalValue;if(!this.includeDefaultValues){originalValue=instance.includeDefaultValues;instance.includeDefaultValues=false;}
var object=instance[methodName](propertiesToInclude);if(!this.includeDefaultValues){instance.includeDefaultValues=originalValue;}
return object;},__serializeBgOverlay:function(methodName,propertiesToInclude){var data={},bgImage=this.backgroundImage,overlayImage=this.overlayImage,bgColor=this.backgroundColor,overlayColor=this.overlayColor;if(bgColor&&bgColor.toObject){if(!bgColor.excludeFromExport){data.background=bgColor.toObject(propertiesToInclude);}}
else if(bgColor){data.background=bgColor;}
if(overlayColor&&overlayColor.toObject){if(!overlayColor.excludeFromExport){data.overlay=overlayColor.toObject(propertiesToInclude);}}
else if(overlayColor){data.overlay=overlayColor;}
if(bgImage&&!bgImage.excludeFromExport){data.backgroundImage=this._toObject(bgImage,methodName,propertiesToInclude);}
if(overlayImage&&!overlayImage.excludeFromExport){data.overlayImage=this._toObject(overlayImage,methodName,propertiesToInclude);}
return data;},svgViewportTransformation:true,toSVG:function(options,reviver){options||(options={});options.reviver=reviver;var markup=[];this._setSVGPreamble(markup,options);this._setSVGHeader(markup,options);if(this.clipPath){markup.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n');}
this._setSVGBgOverlayColor(markup,'background');this._setSVGBgOverlayImage(markup,'backgroundImage',reviver);this._setSVGObjects(markup,reviver);if(this.clipPath){markup.push('</g>\n');}
this._setSVGBgOverlayColor(markup,'overlay');this._setSVGBgOverlayImage(markup,'overlayImage',reviver);markup.push('</svg>');return markup.join('');},_setSVGPreamble:function(markup,options){if(options.suppressPreamble){return;}
markup.push('<?xml version="1.0" encoding="',(options.encoding||'UTF-8'),'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n');},_setSVGHeader:function(markup,options){var width=options.width||this.width,height=options.height||this.height,vpt,viewBox='viewBox="0 0 '+this.width+' '+this.height+'" ',NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(options.viewBox){viewBox='viewBox="'+
options.viewBox.x+' '+
options.viewBox.y+' '+
options.viewBox.width+' '+
options.viewBox.height+'" ';}
else{if(this.svgViewportTransformation){vpt=this.viewportTransform;viewBox='viewBox="'+
toFixed(-vpt[4]/vpt[0],NUM_FRACTION_DIGITS)+' '+
toFixed(-vpt[5]/vpt[3],NUM_FRACTION_DIGITS)+' '+
toFixed(this.width/vpt[0],NUM_FRACTION_DIGITS)+' '+
toFixed(this.height/vpt[3],NUM_FRACTION_DIGITS)+'" ';}}
markup.push('<svg ','xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',width,'" ','height="',height,'" ',viewBox,'xml:space="preserve">\n','<desc>Created with Fabric.js ',fabric.version,'</desc>\n','<defs>\n',this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(options),'</defs>\n');},createSVGClipPathMarkup:function(options){var clipPath=this.clipPath;if(clipPath){clipPath.clipPathId='CLIPPATH_'+fabric.Object.__uid++;return'<clipPath id="'+clipPath.clipPathId+'" >\n'+
this.clipPath.toClipPathSVG(options.reviver)+'</clipPath>\n';}
return'';},createSVGRefElementsMarkup:function(){var _this=this,markup=['background','overlay'].map(function(prop){var fill=_this[prop+'Color'];if(fill&&fill.toLive){var shouldTransform=_this[prop+'Vpt'],vpt=_this.viewportTransform,object={width:_this.width/(shouldTransform?vpt[0]:1),height:_this.height/(shouldTransform?vpt[3]:1)};return fill.toSVG(object,{additionalTransform:shouldTransform?fabric.util.matrixToSVG(vpt):''});}});return markup.join('');},createSVGFontFacesMarkup:function(){var markup='',fontList={},obj,fontFamily,style,row,rowIndex,_char,charIndex,i,len,fontPaths=fabric.fontPaths,objects=[];this._objects.forEach(function add(object){objects.push(object);if(object._objects){object._objects.forEach(add);}});for(i=0,len=objects.length;i<len;i++){obj=objects[i];fontFamily=obj.fontFamily;if(obj.type.indexOf('text')===-1||fontList[fontFamily]||!fontPaths[fontFamily]){continue;}
fontList[fontFamily]=true;if(!obj.styles){continue;}
style=obj.styles;for(rowIndex in style){row=style[rowIndex];for(charIndex in row){_char=row[charIndex];fontFamily=_char.fontFamily;if(!fontList[fontFamily]&&fontPaths[fontFamily]){fontList[fontFamily]=true;}}}}
for(var j in fontList){markup+=['\t\t@font-face {\n','\t\t\tfont-family: \'',j,'\';\n','\t\t\tsrc: url(\'',fontPaths[j],'\');\n','\t\t}\n'].join('');}
if(markup){markup=['\t<style type="text/css">','<![CDATA[\n',markup,']]>','</style>\n'].join('');}
return markup;},_setSVGObjects:function(markup,reviver){var instance,i,len,objects=this._objects;for(i=0,len=objects.length;i<len;i++){instance=objects[i];if(instance.excludeFromExport){continue;}
this._setSVGObject(markup,instance,reviver);}},_setSVGObject:function(markup,instance,reviver){markup.push(instance.toSVG(reviver));},_setSVGBgOverlayImage:function(markup,property,reviver){if(this[property]&&!this[property].excludeFromExport&&this[property].toSVG){markup.push(this[property].toSVG(reviver));}},_setSVGBgOverlayColor:function(markup,property){var filler=this[property+'Color'],vpt=this.viewportTransform,finalWidth=this.width,finalHeight=this.height;if(!filler){return;}
if(filler.toLive){var repeat=filler.repeat,iVpt=fabric.util.invertTransform(vpt),shouldInvert=this[property+'Vpt'],additionalTransform=shouldInvert?fabric.util.matrixToSVG(iVpt):'';markup.push('<rect transform="'+additionalTransform+' translate(',finalWidth/2,',',finalHeight/2,')"',' x="',filler.offsetX-finalWidth/2,'" y="',filler.offsetY-finalHeight/2,'" ','width="',(repeat==='repeat-y'||repeat==='no-repeat'?filler.source.width:finalWidth),'" height="',(repeat==='repeat-x'||repeat==='no-repeat'?filler.source.height:finalHeight),'" fill="url(#SVGID_'+filler.id+')"','></rect>\n');}
else{markup.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',filler,'"','></rect>\n');}},sendToBack:function(object){if(!object){return this;}
var activeSelection=this._activeObject,i,obj,objs;if(object===activeSelection&&object.type==='activeSelection'){objs=activeSelection._objects;for(i=objs.length;i--;){obj=objs[i];removeFromArray(this._objects,obj);this._objects.unshift(obj);}}
else{removeFromArray(this._objects,object);this._objects.unshift(object);}
this.renderOnAddRemove&&this.requestRenderAll();return this;},bringToFront:function(object){if(!object){return this;}
var activeSelection=this._activeObject,i,obj,objs;if(object===activeSelection&&object.type==='activeSelection'){objs=activeSelection._objects;for(i=0;i<objs.length;i++){obj=objs[i];removeFromArray(this._objects,obj);this._objects.push(obj);}}
else{removeFromArray(this._objects,object);this._objects.push(object);}
this.renderOnAddRemove&&this.requestRenderAll();return this;},sendBackwards:function(object,intersecting){if(!object){return this;}
var activeSelection=this._activeObject,i,obj,idx,newIdx,objs,objsMoved=0;if(object===activeSelection&&object.type==='activeSelection'){objs=activeSelection._objects;for(i=0;i<objs.length;i++){obj=objs[i];idx=this._objects.indexOf(obj);if(idx>0+objsMoved){newIdx=idx-1;removeFromArray(this._objects,obj);this._objects.splice(newIdx,0,obj);}
objsMoved++;}}
else{idx=this._objects.indexOf(object);if(idx!==0){newIdx=this._findNewLowerIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object);}}
this.renderOnAddRemove&&this.requestRenderAll();return this;},_findNewLowerIndex:function(object,idx,intersecting){var newIdx,i;if(intersecting){newIdx=idx;for(i=idx-1;i>=0;--i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break;}}}
else{newIdx=idx-1;}
return newIdx;},bringForward:function(object,intersecting){if(!object){return this;}
var activeSelection=this._activeObject,i,obj,idx,newIdx,objs,objsMoved=0;if(object===activeSelection&&object.type==='activeSelection'){objs=activeSelection._objects;for(i=objs.length;i--;){obj=objs[i];idx=this._objects.indexOf(obj);if(idx<this._objects.length-1-objsMoved){newIdx=idx+1;removeFromArray(this._objects,obj);this._objects.splice(newIdx,0,obj);}
objsMoved++;}}
else{idx=this._objects.indexOf(object);if(idx!==this._objects.length-1){newIdx=this._findNewUpperIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object);}}
this.renderOnAddRemove&&this.requestRenderAll();return this;},_findNewUpperIndex:function(object,idx,intersecting){var newIdx,i,len;if(intersecting){newIdx=idx;for(i=idx+1,len=this._objects.length;i<len;++i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break;}}}
else{newIdx=idx+1;}
return newIdx;},moveTo:function(object,index){removeFromArray(this._objects,object);this._objects.splice(index,0,object);return this.renderOnAddRemove&&this.requestRenderAll();},dispose:function(){if(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0;}
this.forEachObject(function(object){object.dispose&&object.dispose();});this._objects=[];if(this.backgroundImage&&this.backgroundImage.dispose){this.backgroundImage.dispose();}
this.backgroundImage=null;if(this.overlayImage&&this.overlayImage.dispose){this.overlayImage.dispose();}
this.overlayImage=null;this._iTextInstances=null;this.contextContainer=null;this.lowerCanvasEl.classList.remove('lower-canvas');fabric.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle);delete this._originalCanvasStyle;this.lowerCanvasEl.setAttribute('width',this.width);this.lowerCanvasEl.setAttribute('height',this.height);fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);this.lowerCanvasEl=undefined;return this;},toString:function(){return'#<fabric.Canvas ('+this.complexity()+'): '+'{ objects: '+this._objects.length+' }>';}});extend(fabric.StaticCanvas.prototype,fabric.Observable);extend(fabric.StaticCanvas.prototype,fabric.Collection);extend(fabric.StaticCanvas.prototype,fabric.DataURLExporter);extend(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(methodName){var el=createCanvasElement();if(!el||!el.getContext){return null;}
var ctx=el.getContext('2d');if(!ctx){return null;}
switch(methodName){case'setLineDash':return typeof ctx.setLineDash!=='undefined';default:return null;}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject;if(fabric.isLikelyNode){fabric.StaticCanvas.prototype.createPNGStream=function(){var impl=getNodeCanvas(this.lowerCanvasEl);return impl&&impl.createPNGStream();};fabric.StaticCanvas.prototype.createJPEGStream=function(opts){var impl=getNodeCanvas(this.lowerCanvasEl);return impl&&impl.createJPEGStream(opts);};}})();fabric.BaseBrush=fabric.util.createClass({color:'rgb(0, 0, 0)',width:1,shadow:null,strokeLineCap:'round',strokeLineJoin:'round',strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:false,_setBrushStyles:function(ctx){ctx.strokeStyle=this.color;ctx.lineWidth=this.width;ctx.lineCap=this.strokeLineCap;ctx.miterLimit=this.strokeMiterLimit;ctx.lineJoin=this.strokeLineJoin;ctx.setLineDash(this.strokeDashArray||[]);},_saveAndTransform:function(ctx){var v=this.canvas.viewportTransform;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);},_setShadow:function(){if(!this.shadow){return;}
var canvas=this.canvas,shadow=this.shadow,ctx=canvas.contextTop,zoom=canvas.getZoom();if(canvas&&canvas._isRetinaScaling()){zoom*=fabric.devicePixelRatio;}
ctx.shadowColor=shadow.color;ctx.shadowBlur=shadow.blur*zoom;ctx.shadowOffsetX=shadow.offsetX*zoom;ctx.shadowOffsetY=shadow.offsetY*zoom;},needsFullRender:function(){var color=new fabric.Color(this.color);return color.getAlpha()<1||!!this.shadow;},_resetShadow:function(){var ctx=this.canvas.contextTop;ctx.shadowColor='';ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0;},_isOutSideCanvas:function(pointer){return pointer.x<0||pointer.x>this.canvas.getWidth()||pointer.y<0||pointer.y>this.canvas.getHeight();}});(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{decimate:0.4,drawStraightLine:false,straightLineKey:'shiftKey',initialize:function(canvas){this.canvas=canvas;this._points=[];},needsFullRender:function(){return this.callSuper('needsFullRender')||this._hasStraightLine;},_drawSegment:function(ctx,p1,p2){var midPoint=p1.midPointFrom(p2);ctx.quadraticCurveTo(p1.x,p1.y,midPoint.x,midPoint.y);return midPoint;},onMouseDown:function(pointer,options){if(!this.canvas._isMainEvent(options.e)){return;}
this.drawStraightLine=options.e[this.straightLineKey];this._prepareForDrawing(pointer);this._captureDrawingPath(pointer);this._render();},onMouseMove:function(pointer,options){if(!this.canvas._isMainEvent(options.e)){return;}
this.drawStraightLine=options.e[this.straightLineKey];if(this.limitedToCanvasSize===true&&this._isOutSideCanvas(pointer)){return;}
if(this._captureDrawingPath(pointer)&&this._points.length>1){if(this.needsFullRender()){this.canvas.clearContext(this.canvas.contextTop);this._render();}
else{var points=this._points,length=points.length,ctx=this.canvas.contextTop;this._saveAndTransform(ctx);if(this.oldEnd){ctx.beginPath();ctx.moveTo(this.oldEnd.x,this.oldEnd.y);}
this.oldEnd=this._drawSegment(ctx,points[length-2],points[length-1],true);ctx.stroke();ctx.restore();}}},onMouseUp:function(options){if(!this.canvas._isMainEvent(options.e)){return true;}
this.drawStraightLine=false;this.oldEnd=undefined;this._finalizeAndAddPath();return false;},_prepareForDrawing:function(pointer){var p=new fabric.Point(pointer.x,pointer.y);this._reset();this._addPoint(p);this.canvas.contextTop.moveTo(p.x,p.y);},_addPoint:function(point){if(this._points.length>1&&point.eq(this._points[this._points.length-1])){return false;}
if(this.drawStraightLine&&this._points.length>1){this._hasStraightLine=true;this._points.pop();}
this._points.push(point);return true;},_reset:function(){this._points=[];this._setBrushStyles(this.canvas.contextTop);this._setShadow();this._hasStraightLine=false;},_captureDrawingPath:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y);return this._addPoint(pointerPoint);},_render:function(ctx){var i,len,p1=this._points[0],p2=this._points[1];ctx=ctx||this.canvas.contextTop;this._saveAndTransform(ctx);ctx.beginPath();if(this._points.length===2&&p1.x===p2.x&&p1.y===p2.y){var width=this.width/1000;p1=new fabric.Point(p1.x,p1.y);p2=new fabric.Point(p2.x,p2.y);p1.x-=width;p2.x+=width;}
ctx.moveTo(p1.x,p1.y);for(i=1,len=this._points.length;i<len;i++){this._drawSegment(ctx,p1,p2);p1=this._points[i];p2=this._points[i+1];}
ctx.lineTo(p1.x,p1.y);ctx.stroke();ctx.restore();},convertPointsToSVGPath:function(points){var correction=this.width/1000;return fabric.util.getSmoothPathFromPoints(points,correction);},_isEmptySVGPath:function(pathData){var pathString=fabric.util.joinPath(pathData);return pathString==='M 0 0 Q 0 0 0 0 L 0 0';},createPath:function(pathData){var path=new fabric.Path(pathData,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,});if(this.shadow){this.shadow.affectStroke=true;path.shadow=new fabric.Shadow(this.shadow);}
return path;},decimatePoints:function(points,distance){if(points.length<=2){return points;}
var zoom=this.canvas.getZoom(),adjustedDistance=Math.pow(distance/zoom,2),i,l=points.length-1,lastPoint=points[0],newPoints=[lastPoint],cDistance;for(i=1;i<l-1;i++){cDistance=Math.pow(lastPoint.x-points[i].x,2)+Math.pow(lastPoint.y-points[i].y,2);if(cDistance>=adjustedDistance){lastPoint=points[i];newPoints.push(lastPoint);}}
newPoints.push(points[l]);return newPoints;},_finalizeAndAddPath:function(){var ctx=this.canvas.contextTop;ctx.closePath();if(this.decimate){this._points=this.decimatePoints(this._points,this.decimate);}
var pathData=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(pathData)){this.canvas.requestRenderAll();return;}
var path=this.createPath(pathData);this.canvas.clearContext(this.canvas.contextTop);this.canvas.fire('before:path:created',{path:path});this.canvas.add(path);this.canvas.requestRenderAll();path.setCoords();this._resetShadow();this.canvas.fire('path:created',{path:path});}});})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(canvas){this.canvas=canvas;this.points=[];},drawDot:function(pointer){var point=this.addPoint(pointer),ctx=this.canvas.contextTop;this._saveAndTransform(ctx);this.dot(ctx,point);ctx.restore();},dot:function(ctx,point){ctx.fillStyle=point.fill;ctx.beginPath();ctx.arc(point.x,point.y,point.radius,0,Math.PI*2,false);ctx.closePath();ctx.fill();},onMouseDown:function(pointer){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(pointer);},_render:function(){var ctx=this.canvas.contextTop,i,len,points=this.points;this._saveAndTransform(ctx);for(i=0,len=points.length;i<len;i++){this.dot(ctx,points[i]);}
ctx.restore();},onMouseMove:function(pointer){if(this.limitedToCanvasSize===true&&this._isOutSideCanvas(pointer)){return;}
if(this.needsFullRender()){this.canvas.clearContext(this.canvas.contextTop);this.addPoint(pointer);this._render();}
else{this.drawDot(pointer);}},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove,i,len;this.canvas.renderOnAddRemove=false;var circles=[];for(i=0,len=this.points.length;i<len;i++){var point=this.points[i],circle=new fabric.Circle({radius:point.radius,left:point.x,top:point.y,originX:'center',originY:'center',fill:point.fill});this.shadow&&(circle.shadow=new fabric.Shadow(this.shadow));circles.push(circle);}
var group=new fabric.Group(circles);group.canvas=this.canvas;this.canvas.fire('before:path:created',{path:group});this.canvas.add(group);this.canvas.fire('path:created',{path:group});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=originalRenderOnAddRemove;this.canvas.requestRenderAll();},addPoint:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y),circleRadius=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,circleColor=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();pointerPoint.radius=circleRadius;pointerPoint.fill=circleColor;this.points.push(pointerPoint);return pointerPoint;}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,optimizeOverlapping:true,initialize:function(canvas){this.canvas=canvas;this.sprayChunks=[];},onMouseDown:function(pointer){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(pointer);this.render(this.sprayChunkPoints);},onMouseMove:function(pointer){if(this.limitedToCanvasSize===true&&this._isOutSideCanvas(pointer)){return;}
this.addSprayChunk(pointer);this.render(this.sprayChunkPoints);},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var rects=[];for(var i=0,ilen=this.sprayChunks.length;i<ilen;i++){var sprayChunk=this.sprayChunks[i];for(var j=0,jlen=sprayChunk.length;j<jlen;j++){var rect=new fabric.Rect({width:sprayChunk[j].width,height:sprayChunk[j].width,left:sprayChunk[j].x+1,top:sprayChunk[j].y+1,originX:'center',originY:'center',fill:this.color});rects.push(rect);}}
if(this.optimizeOverlapping){rects=this._getOptimizedRects(rects);}
var group=new fabric.Group(rects);this.shadow&&group.set('shadow',new fabric.Shadow(this.shadow));this.canvas.fire('before:path:created',{path:group});this.canvas.add(group);this.canvas.fire('path:created',{path:group});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=originalRenderOnAddRemove;this.canvas.requestRenderAll();},_getOptimizedRects:function(rects){var uniqueRects={},key,i,len;for(i=0,len=rects.length;i<len;i++){key=rects[i].left+''+rects[i].top;if(!uniqueRects[key]){uniqueRects[key]=rects[i];}}
var uniqueRectsArray=[];for(key in uniqueRects){uniqueRectsArray.push(uniqueRects[key]);}
return uniqueRectsArray;},render:function(sprayChunk){var ctx=this.canvas.contextTop,i,len;ctx.fillStyle=this.color;this._saveAndTransform(ctx);for(i=0,len=sprayChunk.length;i<len;i++){var point=sprayChunk[i];if(typeof point.opacity!=='undefined'){ctx.globalAlpha=point.opacity;}
ctx.fillRect(point.x,point.y,point.width,point.width);}
ctx.restore();},_render:function(){var ctx=this.canvas.contextTop,i,ilen;ctx.fillStyle=this.color;this._saveAndTransform(ctx);for(i=0,ilen=this.sprayChunks.length;i<ilen;i++){this.render(this.sprayChunks[i]);}
ctx.restore();},addSprayChunk:function(pointer){this.sprayChunkPoints=[];var x,y,width,radius=this.width/2,i;for(i=0;i<this.density;i++){x=fabric.util.getRandomInt(pointer.x-radius,pointer.x+radius);y=fabric.util.getRandomInt(pointer.y-radius,pointer.y+radius);if(this.dotWidthVariance){width=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance);}
else{width=this.dotWidth;}
var point=new fabric.Point(x,y);point.width=width;if(this.randomOpacity){point.opacity=fabric.util.getRandomInt(0,100)/100;}
this.sprayChunkPoints.push(point);}
this.sprayChunks.push(this.sprayChunkPoints);}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var dotWidth=20,dotDistance=5,patternCanvas=fabric.util.createCanvasElement(),patternCtx=patternCanvas.getContext('2d');patternCanvas.width=patternCanvas.height=dotWidth+dotDistance;patternCtx.fillStyle=this.color;patternCtx.beginPath();patternCtx.arc(dotWidth/2,dotWidth/2,dotWidth/2,0,Math.PI*2,false);patternCtx.closePath();patternCtx.fill();return patternCanvas;},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace('this.color','"'+this.color+'"');},getPattern:function(ctx){return ctx.createPattern(this.source||this.getPatternSrc(),'repeat');},_setBrushStyles:function(ctx){this.callSuper('_setBrushStyles',ctx);ctx.strokeStyle=this.getPattern(ctx);},createPath:function(pathData){var path=this.callSuper('createPath',pathData),topLeft=path._getLeftTopCoords().scalarAdd(path.strokeWidth/2);path.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-topLeft.x,offsetY:-topLeft.y});return path;}});(function(){var getPointer=fabric.util.getPointer,degreesToRadians=fabric.util.degreesToRadians,isTouchEvent=fabric.util.isTouchEvent;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(el,options){options||(options={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(el,options);this._initInteractive();this._createCacheCanvas();},uniformScaling:true,uniScaleKey:'shiftKey',centeredScaling:false,centeredRotation:false,centeredKey:'altKey',altActionKey:'shiftKey',interactive:true,selection:true,selectionKey:'shiftKey',altSelectionKey:null,selectionColor:'rgba(100, 100, 255, 0.3)',selectionDashArray:[],selectionBorderColor:'rgba(255, 255, 255, 0.3)',selectionLineWidth:1,selectionFullyContained:false,hoverCursor:'move',moveCursor:'move',defaultCursor:'default',freeDrawingCursor:'crosshair',notAllowedCursor:'not-allowed',containerClass:'canvas-container',perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,isDrawingMode:false,preserveObjectStacking:false,snapAngle:0,snapThreshold:null,stopContextMenu:false,fireRightClick:false,fireMiddleClick:false,targets:[],enablePointerEvents:false,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset();},_chooseObjectsToRender:function(){var activeObjects=this.getActiveObjects(),object,objsToRender,activeGroupObjects;if(activeObjects.length>0&&!this.preserveObjectStacking){objsToRender=[];activeGroupObjects=[];for(var i=0,length=this._objects.length;i<length;i++){object=this._objects[i];if(activeObjects.indexOf(object)===-1){objsToRender.push(object);}
else{activeGroupObjects.push(object);}}
if(activeObjects.length>1){this._activeObject._objects=activeGroupObjects;}
objsToRender.push.apply(objsToRender,activeGroupObjects);}
else{objsToRender=this._objects;}
return objsToRender;},renderAll:function(){if(this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode){this.clearContext(this.contextTop);this.contextTopDirty=false;}
if(this.hasLostContext){this.renderTopLayer(this.contextTop);this.hasLostContext=false;}
var canvasToDrawOn=this.contextContainer;this.renderCanvas(canvasToDrawOn,this._chooseObjectsToRender());return this;},renderTopLayer:function(ctx){ctx.save();if(this.isDrawingMode&&this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._render();this.contextTopDirty=true;}
if(this.selection&&this._groupSelector){this._drawSelection(ctx);this.contextTopDirty=true;}
ctx.restore();},renderTop:function(){var ctx=this.contextTop;this.clearContext(ctx);this.renderTopLayer(ctx);this.fire('after:render');return this;},_normalizePointer:function(object,pointer){var m=object.calcTransformMatrix(),invertedM=fabric.util.invertTransform(m),vptPointer=this.restorePointerVpt(pointer);return fabric.util.transformPoint(vptPointer,invertedM);},isTargetTransparent:function(target,x,y){if(target.shouldCache()&&target._cacheCanvas&&target!==this._activeObject){var normalizedPointer=this._normalizePointer(target,{x:x,y:y}),targetRelativeX=Math.max(target.cacheTranslationX+(normalizedPointer.x*target.zoomX),0),targetRelativeY=Math.max(target.cacheTranslationY+(normalizedPointer.y*target.zoomY),0);var isTransparent=fabric.util.isTransparent(target._cacheContext,Math.round(targetRelativeX),Math.round(targetRelativeY),this.targetFindTolerance);return isTransparent;}
var ctx=this.contextCache,originalColor=target.selectionBackgroundColor,v=this.viewportTransform;target.selectionBackgroundColor='';this.clearContext(ctx);ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);target.render(ctx);ctx.restore();target.selectionBackgroundColor=originalColor;var isTransparent=fabric.util.isTransparent(ctx,x,y,this.targetFindTolerance);return isTransparent;},_isSelectionKeyPressed:function(e){var selectionKeyPressed=false;if(Object.prototype.toString.call(this.selectionKey)==='[object Array]'){selectionKeyPressed=!!this.selectionKey.find(function(key){return e[key]===true;});}
else{selectionKeyPressed=e[this.selectionKey];}
return selectionKeyPressed;},_shouldClearSelection:function(e,target){var activeObjects=this.getActiveObjects(),activeObject=this._activeObject;return(!target||(target&&activeObject&&activeObjects.length>1&&activeObjects.indexOf(target)===-1&&activeObject!==target&&!this._isSelectionKeyPressed(e))||(target&&!target.evented)||(target&&!target.selectable&&activeObject&&activeObject!==target));},_shouldCenterTransform:function(target,action,altKey){if(!target){return;}
var centerTransform;if(action==='scale'||action==='scaleX'||action==='scaleY'||action==='resizing'){centerTransform=this.centeredScaling||target.centeredScaling;}
else if(action==='rotate'){centerTransform=this.centeredRotation||target.centeredRotation;}
return centerTransform?!altKey:altKey;},_getOriginFromCorner:function(target,corner){var origin={x:target.originX,y:target.originY};if(corner==='ml'||corner==='tl'||corner==='bl'){origin.x='right';}
else if(corner==='mr'||corner==='tr'||corner==='br'){origin.x='left';}
if(corner==='tl'||corner==='mt'||corner==='tr'){origin.y='bottom';}
else if(corner==='bl'||corner==='mb'||corner==='br'){origin.y='top';}
return origin;},_getActionFromCorner:function(alreadySelected,corner,e,target){if(!corner||!alreadySelected){return'drag';}
var control=target.controls[corner];return control.getActionName(e,control,target);},_setupCurrentTransform:function(e,target,alreadySelected){if(!target){return;}
var pointer=this.getPointer(e),corner=target.__corner,control=target.controls[corner],actionHandler=(alreadySelected&&corner)?control.getActionHandler(e,target,control):fabric.controlsUtils.dragHandler,action=this._getActionFromCorner(alreadySelected,corner,e,target),origin=this._getOriginFromCorner(target,corner),altKey=e[this.centeredKey],transform={target:target,action:action,actionHandler:actionHandler,corner:corner,scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,offsetX:pointer.x-target.left,offsetY:pointer.y-target.top,originX:origin.x,originY:origin.y,ex:pointer.x,ey:pointer.y,lastX:pointer.x,lastY:pointer.y,theta:degreesToRadians(target.angle),width:target.width*target.scaleX,shiftKey:e.shiftKey,altKey:altKey,original:fabric.util.saveObjectTransform(target),};if(this._shouldCenterTransform(target,action,altKey)){transform.originX='center';transform.originY='center';}
transform.original.originX=origin.x;transform.original.originY=origin.y;this._currentTransform=transform;this._beforeTransform(e);},setCursor:function(value){this.upperCanvasEl.style.cursor=value;},_drawSelection:function(ctx){var selector=this._groupSelector,viewportStart=new fabric.Point(selector.ex,selector.ey),start=fabric.util.transformPoint(viewportStart,this.viewportTransform),viewportExtent=new fabric.Point(selector.ex+selector.left,selector.ey+selector.top),extent=fabric.util.transformPoint(viewportExtent,this.viewportTransform),minX=Math.min(start.x,extent.x),minY=Math.min(start.y,extent.y),maxX=Math.max(start.x,extent.x),maxY=Math.max(start.y,extent.y),strokeOffset=this.selectionLineWidth/2;if(this.selectionColor){ctx.fillStyle=this.selectionColor;ctx.fillRect(minX,minY,maxX-minX,maxY-minY);}
if(!this.selectionLineWidth||!this.selectionBorderColor){return;}
ctx.lineWidth=this.selectionLineWidth;ctx.strokeStyle=this.selectionBorderColor;minX+=strokeOffset;minY+=strokeOffset;maxX-=strokeOffset;maxY-=strokeOffset;fabric.Object.prototype._setLineDash.call(this,ctx,this.selectionDashArray);ctx.strokeRect(minX,minY,maxX-minX,maxY-minY);},findTarget:function(e,skipGroup){if(this.skipTargetFind){return;}
var ignoreZoom=true,pointer=this.getPointer(e,ignoreZoom),activeObject=this._activeObject,aObjects=this.getActiveObjects(),activeTarget,activeTargetSubs,isTouch=isTouchEvent(e),shouldLookForActive=(aObjects.length>1&&!skipGroup)||aObjects.length===1;this.targets=[];if(shouldLookForActive&&activeObject._findTargetCorner(pointer,isTouch)){return activeObject;}
if(aObjects.length>1&&!skipGroup&&activeObject===this._searchPossibleTargets([activeObject],pointer)){return activeObject;}
if(aObjects.length===1&&activeObject===this._searchPossibleTargets([activeObject],pointer)){if(!this.preserveObjectStacking){return activeObject;}
else{activeTarget=activeObject;activeTargetSubs=this.targets;this.targets=[];}}
var target=this._searchPossibleTargets(this._objects,pointer);if(e[this.altSelectionKey]&&target&&activeTarget&&target!==activeTarget){target=activeTarget;this.targets=activeTargetSubs;}
return target;},_checkTarget:function(pointer,obj,globalPointer){if(obj&&obj.visible&&obj.evented&&obj.containsPoint(pointer)){if((this.perPixelTargetFind||obj.perPixelTargetFind)&&!obj.isEditing){var isTransparent=this.isTargetTransparent(obj,globalPointer.x,globalPointer.y);if(!isTransparent){return true;}}
else{return true;}}},_searchPossibleTargets:function(objects,pointer){var target,i=objects.length,subTarget;while(i--){var objToCheck=objects[i];var pointerToUse=objToCheck.group?this._normalizePointer(objToCheck.group,pointer):pointer;if(this._checkTarget(pointerToUse,objToCheck,pointer)){target=objects[i];if(target.subTargetCheck&&target instanceof fabric.Group){subTarget=this._searchPossibleTargets(target._objects,pointer);subTarget&&this.targets.push(subTarget);}
break;}}
return target;},restorePointerVpt:function(pointer){return fabric.util.transformPoint(pointer,fabric.util.invertTransform(this.viewportTransform));},getPointer:function(e,ignoreZoom){if(this._absolutePointer&&!ignoreZoom){return this._absolutePointer;}
if(this._pointer&&ignoreZoom){return this._pointer;}
var pointer=getPointer(e),upperCanvasEl=this.upperCanvasEl,bounds=upperCanvasEl.getBoundingClientRect(),boundsWidth=bounds.width||0,boundsHeight=bounds.height||0,cssScale;if(!boundsWidth||!boundsHeight){if('top'in bounds&&'bottom'in bounds){boundsHeight=Math.abs(bounds.top-bounds.bottom);}
if('right'in bounds&&'left'in bounds){boundsWidth=Math.abs(bounds.right-bounds.left);}}
this.calcOffset();pointer.x=pointer.x-this._offset.left;pointer.y=pointer.y-this._offset.top;if(!ignoreZoom){pointer=this.restorePointerVpt(pointer);}
var retinaScaling=this.getRetinaScaling();if(retinaScaling!==1){pointer.x/=retinaScaling;pointer.y/=retinaScaling;}
if(boundsWidth===0||boundsHeight===0){cssScale={width:1,height:1};}
else{cssScale={width:upperCanvasEl.width/boundsWidth,height:upperCanvasEl.height/boundsHeight};}
return{x:pointer.x*cssScale.width,y:pointer.y*cssScale.height};},_createUpperCanvas:function(){var lowerCanvasClass=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,''),lowerCanvasEl=this.lowerCanvasEl,upperCanvasEl=this.upperCanvasEl;if(upperCanvasEl){upperCanvasEl.className='';}
else{upperCanvasEl=this._createCanvasElement();this.upperCanvasEl=upperCanvasEl;}
fabric.util.addClass(upperCanvasEl,'upper-canvas '+lowerCanvasClass);this.wrapperEl.appendChild(upperCanvasEl);this._copyCanvasStyle(lowerCanvasEl,upperCanvasEl);this._applyCanvasStyle(upperCanvasEl);this.contextTop=upperCanvasEl.getContext('2d');},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute('width',this.width);this.cacheCanvasEl.setAttribute('height',this.height);this.contextCache=this.cacheCanvasEl.getContext('2d');},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,'div',{'class':this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.width+'px',height:this.height+'px',position:'relative'});fabric.util.makeElementUnselectable(this.wrapperEl);},_applyCanvasStyle:function(element){var width=this.width||element.width,height=this.height||element.height;fabric.util.setStyle(element,{position:'absolute',width:width+'px',height:height+'px',left:0,top:0,'touch-action':this.allowTouchScrolling?'manipulation':'none','-ms-touch-action':this.allowTouchScrolling?'manipulation':'none'});element.width=width;element.height=height;fabric.util.makeElementUnselectable(element);},_copyCanvasStyle:function(fromEl,toEl){toEl.style.cssText=fromEl.style.cssText;},getSelectionContext:function(){return this.contextTop;},getSelectionElement:function(){return this.upperCanvasEl;},getActiveObject:function(){return this._activeObject;},getActiveObjects:function(){var active=this._activeObject;if(active){if(active.type==='activeSelection'&&active._objects){return active._objects.slice(0);}
else{return[active];}}
return[];},_onObjectRemoved:function(obj){if(obj===this._activeObject){this.fire('before:selection:cleared',{target:obj});this._discardActiveObject();this.fire('selection:cleared',{target:obj});obj.fire('deselected');}
if(obj===this._hoveredTarget){this._hoveredTarget=null;this._hoveredTargets=[];}
this.callSuper('_onObjectRemoved',obj);},_fireSelectionEvents:function(oldObjects,e){var somethingChanged=false,objects=this.getActiveObjects(),added=[],removed=[];oldObjects.forEach(function(oldObject){if(objects.indexOf(oldObject)===-1){somethingChanged=true;oldObject.fire('deselected',{e:e,target:oldObject});removed.push(oldObject);}});objects.forEach(function(object){if(oldObjects.indexOf(object)===-1){somethingChanged=true;object.fire('selected',{e:e,target:object});added.push(object);}});if(oldObjects.length>0&&objects.length>0){somethingChanged&&this.fire('selection:updated',{e:e,selected:added,deselected:removed,});}
else if(objects.length>0){this.fire('selection:created',{e:e,selected:added,});}
else if(oldObjects.length>0){this.fire('selection:cleared',{e:e,deselected:removed,});}},setActiveObject:function(object,e){var currentActives=this.getActiveObjects();this._setActiveObject(object,e);this._fireSelectionEvents(currentActives,e);return this;},_setActiveObject:function(object,e){if(this._activeObject===object){return false;}
if(!this._discardActiveObject(e,object)){return false;}
if(object.onSelect({e:e})){return false;}
this._activeObject=object;return true;},_discardActiveObject:function(e,object){var obj=this._activeObject;if(obj){if(obj.onDeselect({e:e,object:object})){return false;}
this._activeObject=null;}
return true;},discardActiveObject:function(e){var currentActives=this.getActiveObjects(),activeObject=this.getActiveObject();if(currentActives.length){this.fire('before:selection:cleared',{target:activeObject,e:e});}
this._discardActiveObject(e);this._fireSelectionEvents(currentActives,e);return this;},dispose:function(){var wrapper=this.wrapperEl;this.removeListeners();wrapper.removeChild(this.upperCanvasEl);wrapper.removeChild(this.lowerCanvasEl);this.contextCache=null;this.contextTop=null;['upperCanvasEl','cacheCanvasEl'].forEach((function(element){fabric.util.cleanUpJsdomNode(this[element]);this[element]=undefined;}).bind(this));if(wrapper.parentNode){wrapper.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl);}
delete this.wrapperEl;fabric.StaticCanvas.prototype.dispose.call(this);return this;},clear:function(){this.discardActiveObject();this.clearContext(this.contextTop);return this.callSuper('clear');},drawControls:function(ctx){var activeObject=this._activeObject;if(activeObject){activeObject._renderControls(ctx);}},_toObject:function(instance,methodName,propertiesToInclude){var originalProperties=this._realizeGroupTransformOnObject(instance),object=this.callSuper('_toObject',instance,methodName,propertiesToInclude);this._unwindGroupTransformOnObject(instance,originalProperties);return object;},_realizeGroupTransformOnObject:function(instance){if(instance.group&&instance.group.type==='activeSelection'&&this._activeObject===instance.group){var layoutProps=['angle','flipX','flipY','left','scaleX','scaleY','skewX','skewY','top'];var originalValues={};layoutProps.forEach(function(prop){originalValues[prop]=instance[prop];});fabric.util.addTransformToObject(instance,this._activeObject.calcOwnMatrix());return originalValues;}
else{return null;}},_unwindGroupTransformOnObject:function(instance,originalValues){if(originalValues){instance.set(originalValues);}},_setSVGObject:function(markup,instance,reviver){var originalProperties=this._realizeGroupTransformOnObject(instance);this.callSuper('_setSVGObject',markup,instance,reviver);this._unwindGroupTransformOnObject(instance,originalProperties);},setViewportTransform:function(vpt){if(this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing){this._activeObject.clearContextTop();}
fabric.StaticCanvas.prototype.setViewportTransform.call(this,vpt);}});for(var prop in fabric.StaticCanvas){if(prop!=='prototype'){fabric.Canvas[prop]=fabric.StaticCanvas[prop];}}})();(function(){var addListener=fabric.util.addListener,removeListener=fabric.util.removeListener,RIGHT_CLICK=3,MIDDLE_CLICK=2,LEFT_CLICK=1,addEventOptions={passive:false};function checkClick(e,value){return e.button&&(e.button===value-1);}
fabric.util.object.extend(fabric.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners();this._bindEvents();this.addOrRemove(addListener,'add');},_getEventPrefix:function(){return this.enablePointerEvents?'pointer':'mouse';},addOrRemove:function(functor,eventjsFunctor){var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();functor(fabric.window,'resize',this._onResize);functor(canvasElement,eventTypePrefix+'down',this._onMouseDown);functor(canvasElement,eventTypePrefix+'move',this._onMouseMove,addEventOptions);functor(canvasElement,eventTypePrefix+'out',this._onMouseOut);functor(canvasElement,eventTypePrefix+'enter',this._onMouseEnter);functor(canvasElement,'wheel',this._onMouseWheel);functor(canvasElement,'contextmenu',this._onContextMenu);functor(canvasElement,'dblclick',this._onDoubleClick);functor(canvasElement,'dragover',this._onDragOver);functor(canvasElement,'dragenter',this._onDragEnter);functor(canvasElement,'dragleave',this._onDragLeave);functor(canvasElement,'drop',this._onDrop);if(!this.enablePointerEvents){functor(canvasElement,'touchstart',this._onTouchStart,addEventOptions);}
if(typeof eventjs!=='undefined'&&eventjsFunctor in eventjs){eventjs[eventjsFunctor](canvasElement,'gesture',this._onGesture);eventjs[eventjsFunctor](canvasElement,'drag',this._onDrag);eventjs[eventjsFunctor](canvasElement,'orientation',this._onOrientationChange);eventjs[eventjsFunctor](canvasElement,'shake',this._onShake);eventjs[eventjsFunctor](canvasElement,'longpress',this._onLongPress);}},removeListeners:function(){this.addOrRemove(removeListener,'remove');var eventTypePrefix=this._getEventPrefix();removeListener(fabric.document,eventTypePrefix+'up',this._onMouseUp);removeListener(fabric.document,'touchend',this._onTouchEnd,addEventOptions);removeListener(fabric.document,eventTypePrefix+'move',this._onMouseMove,addEventOptions);removeListener(fabric.document,'touchmove',this._onMouseMove,addEventOptions);},_bindEvents:function(){if(this.eventsBound){return;}
this._onMouseDown=this._onMouseDown.bind(this);this._onTouchStart=this._onTouchStart.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onTouchEnd=this._onTouchEnd.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this);this._onMouseOut=this._onMouseOut.bind(this);this._onMouseEnter=this._onMouseEnter.bind(this);this._onContextMenu=this._onContextMenu.bind(this);this._onDoubleClick=this._onDoubleClick.bind(this);this._onDragOver=this._onDragOver.bind(this);this._onDragEnter=this._simpleEventHandler.bind(this,'dragenter');this._onDragLeave=this._simpleEventHandler.bind(this,'dragleave');this._onDrop=this._onDrop.bind(this);this.eventsBound=true;},_onGesture:function(e,self){this.__onTransformGesture&&this.__onTransformGesture(e,self);},_onDrag:function(e,self){this.__onDrag&&this.__onDrag(e,self);},_onMouseWheel:function(e){this.__onMouseWheel(e);},_onMouseOut:function(e){var target=this._hoveredTarget;this.fire('mouse:out',{target:target,e:e});this._hoveredTarget=null;target&&target.fire('mouseout',{e:e});var _this=this;this._hoveredTargets.forEach(function(_target){_this.fire('mouse:out',{target:target,e:e});_target&&target.fire('mouseout',{e:e});});this._hoveredTargets=[];if(this._iTextInstances){this._iTextInstances.forEach(function(obj){if(obj.isEditing){obj.hiddenTextarea.focus();}});}},_onMouseEnter:function(e){if(!this._currentTransform&&!this.findTarget(e)){this.fire('mouse:over',{target:null,e:e});this._hoveredTarget=null;this._hoveredTargets=[];}},_onOrientationChange:function(e,self){this.__onOrientationChange&&this.__onOrientationChange(e,self);},_onShake:function(e,self){this.__onShake&&this.__onShake(e,self);},_onLongPress:function(e,self){this.__onLongPress&&this.__onLongPress(e,self);},_onDragOver:function(e){e.preventDefault();var target=this._simpleEventHandler('dragover',e);this._fireEnterLeaveEvents(target,e);},_onDrop:function(e){this._simpleEventHandler('drop:before',e);return this._simpleEventHandler('drop',e);},_onContextMenu:function(e){if(this.stopContextMenu){e.stopPropagation();e.preventDefault();}
return false;},_onDoubleClick:function(e){this._cacheTransformEventData(e);this._handleEvent(e,'dblclick');this._resetTransformEventData(e);},getPointerId:function(evt){var changedTouches=evt.changedTouches;if(changedTouches){return changedTouches[0]&&changedTouches[0].identifier;}
if(this.enablePointerEvents){return evt.pointerId;}
return-1;},_isMainEvent:function(evt){if(evt.isPrimary===true){return true;}
if(evt.isPrimary===false){return false;}
if(evt.type==='touchend'&&evt.touches.length===0){return true;}
if(evt.changedTouches){return evt.changedTouches[0].identifier===this.mainTouchId;}
return true;},_onTouchStart:function(e){e.preventDefault();if(this.mainTouchId===null){this.mainTouchId=this.getPointerId(e);}
this.__onMouseDown(e);this._resetTransformEventData();var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();addListener(fabric.document,'touchend',this._onTouchEnd,addEventOptions);addListener(fabric.document,'touchmove',this._onMouseMove,addEventOptions);removeListener(canvasElement,eventTypePrefix+'down',this._onMouseDown);},_onMouseDown:function(e){this.__onMouseDown(e);this._resetTransformEventData();var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();removeListener(canvasElement,eventTypePrefix+'move',this._onMouseMove,addEventOptions);addListener(fabric.document,eventTypePrefix+'up',this._onMouseUp);addListener(fabric.document,eventTypePrefix+'move',this._onMouseMove,addEventOptions);},_onTouchEnd:function(e){if(e.touches.length>0){return;}
this.__onMouseUp(e);this._resetTransformEventData();this.mainTouchId=null;var eventTypePrefix=this._getEventPrefix();removeListener(fabric.document,'touchend',this._onTouchEnd,addEventOptions);removeListener(fabric.document,'touchmove',this._onMouseMove,addEventOptions);var _this=this;if(this._willAddMouseDown){clearTimeout(this._willAddMouseDown);}
this._willAddMouseDown=setTimeout(function(){addListener(_this.upperCanvasEl,eventTypePrefix+'down',_this._onMouseDown);_this._willAddMouseDown=0;},400);},_onMouseUp:function(e){this.__onMouseUp(e);this._resetTransformEventData();var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();if(this._isMainEvent(e)){removeListener(fabric.document,eventTypePrefix+'up',this._onMouseUp);removeListener(fabric.document,eventTypePrefix+'move',this._onMouseMove,addEventOptions);addListener(canvasElement,eventTypePrefix+'move',this._onMouseMove,addEventOptions);}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault();this.__onMouseMove(e);},_onResize:function(){this.calcOffset();},_shouldRender:function(target){var activeObject=this._activeObject;if(!!activeObject!==!!target||(activeObject&&target&&(activeObject!==target))){return true;}
else if(activeObject&&activeObject.isEditing){return false;}
return false;},__onMouseUp:function(e){var target,transform=this._currentTransform,groupSelector=this._groupSelector,shouldRender=false,isClick=(!groupSelector||(groupSelector.left===0&&groupSelector.top===0));this._cacheTransformEventData(e);target=this._target;this._handleEvent(e,'up:before');if(checkClick(e,RIGHT_CLICK)){if(this.fireRightClick){this._handleEvent(e,'up',RIGHT_CLICK,isClick);}
return;}
if(checkClick(e,MIDDLE_CLICK)){if(this.fireMiddleClick){this._handleEvent(e,'up',MIDDLE_CLICK,isClick);}
this._resetTransformEventData();return;}
if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(e);return;}
if(!this._isMainEvent(e)){return;}
if(transform){this._finalizeCurrentTransform(e);shouldRender=transform.actionPerformed;}
if(!isClick){var targetWasActive=target===this._activeObject;this._maybeGroupObjects(e);if(!shouldRender){shouldRender=(this._shouldRender(target)||(!targetWasActive&&target===this._activeObject));}}
var corner,pointer;if(target){corner=target._findTargetCorner(this.getPointer(e,true),fabric.util.isTouchEvent(e));if(target.selectable&&target!==this._activeObject&&target.activeOn==='up'){this.setActiveObject(target,e);shouldRender=true;}
else{var control=target.controls[corner],mouseUpHandler=control&&control.getMouseUpHandler(e,target,control);if(mouseUpHandler){pointer=this.getPointer(e);mouseUpHandler(e,transform,pointer.x,pointer.y);}}
target.isMoving=false;}
if(transform&&(transform.target!==target||transform.corner!==corner)){var originalControl=transform.target&&transform.target.controls[transform.corner],originalMouseUpHandler=originalControl&&originalControl.getMouseUpHandler(e,target,control);pointer=pointer||this.getPointer(e);originalMouseUpHandler&&originalMouseUpHandler(e,transform,pointer.x,pointer.y);}
this._setCursorFromEvent(e,target);this._handleEvent(e,'up',LEFT_CLICK,isClick);this._groupSelector=null;this._currentTransform=null;target&&(target.__corner=0);if(shouldRender){this.requestRenderAll();}
else if(!isClick){this.renderTop();}},_simpleEventHandler:function(eventType,e){var target=this.findTarget(e),targets=this.targets,options={e:e,target:target,subTargets:targets,};this.fire(eventType,options);target&&target.fire(eventType,options);if(!targets){return target;}
for(var i=0;i<targets.length;i++){targets[i].fire(eventType,options);}
return target;},_handleEvent:function(e,eventType,button,isClick){var target=this._target,targets=this.targets||[],options={e:e,target:target,subTargets:targets,button:button||LEFT_CLICK,isClick:isClick||false,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};if(eventType==='up'){options.currentTarget=this.findTarget(e);options.currentSubTargets=this.targets;}
this.fire('mouse:'+eventType,options);target&&target.fire('mouse'+eventType,options);for(var i=0;i<targets.length;i++){targets[i].fire('mouse'+eventType,options);}},_finalizeCurrentTransform:function(e){var transform=this._currentTransform,target=transform.target,options={e:e,target:target,transform:transform,action:transform.action,};if(target._scaling){target._scaling=false;}
target.setCoords();if(transform.actionPerformed||(this.stateful&&target.hasStateChanged())){this._fire('modified',options);}},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=true;if(this.getActiveObject()){this.discardActiveObject(e).requestRenderAll();}
var pointer=this.getPointer(e);this.freeDrawingBrush.onMouseDown(pointer,{e:e,pointer:pointer});this._handleEvent(e,'down');},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var pointer=this.getPointer(e);this.freeDrawingBrush.onMouseMove(pointer,{e:e,pointer:pointer});}
this.setCursor(this.freeDrawingCursor);this._handleEvent(e,'move');},_onMouseUpInDrawingMode:function(e){var pointer=this.getPointer(e);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:e,pointer:pointer});this._handleEvent(e,'up');},__onMouseDown:function(e){this._cacheTransformEventData(e);this._handleEvent(e,'down:before');var target=this._target;if(checkClick(e,RIGHT_CLICK)){if(this.fireRightClick){this._handleEvent(e,'down',RIGHT_CLICK);}
return;}
if(checkClick(e,MIDDLE_CLICK)){if(this.fireMiddleClick){this._handleEvent(e,'down',MIDDLE_CLICK);}
return;}
if(this.isDrawingMode){this._onMouseDownInDrawingMode(e);return;}
if(!this._isMainEvent(e)){return;}
if(this._currentTransform){return;}
var pointer=this._pointer;this._previousPointer=pointer;var shouldRender=this._shouldRender(target),shouldGroup=this._shouldGroup(e,target);if(this._shouldClearSelection(e,target)){this.discardActiveObject(e);}
else if(shouldGroup){this._handleGrouping(e,target);target=this._activeObject;}
if(this.selection&&(!target||(!target.selectable&&!target.isEditing&&target!==this._activeObject))){this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0};}
if(target){var alreadySelected=target===this._activeObject;if(target.selectable&&target.activeOn==='down'){this.setActiveObject(target,e);}
var corner=target._findTargetCorner(this.getPointer(e,true),fabric.util.isTouchEvent(e));target.__corner=corner;if(target===this._activeObject&&(corner||!shouldGroup)){this._setupCurrentTransform(e,target,alreadySelected);var control=target.controls[corner],pointer=this.getPointer(e),mouseDownHandler=control&&control.getMouseDownHandler(e,target,control);if(mouseDownHandler){mouseDownHandler(e,this._currentTransform,pointer.x,pointer.y);}}}
this._handleEvent(e,'down');(shouldRender||shouldGroup)&&this.requestRenderAll();},_resetTransformEventData:function(){this._target=null;this._pointer=null;this._absolutePointer=null;},_cacheTransformEventData:function(e){this._resetTransformEventData();this._pointer=this.getPointer(e,true);this._absolutePointer=this.restorePointerVpt(this._pointer);this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null;},_beforeTransform:function(e){var t=this._currentTransform;this.stateful&&t.target.saveState();this.fire('before:transform',{e:e,transform:t,});},__onMouseMove:function(e){this._handleEvent(e,'move:before');this._cacheTransformEventData(e);var target,pointer;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(e);return;}
if(!this._isMainEvent(e)){return;}
var groupSelector=this._groupSelector;if(groupSelector){pointer=this._absolutePointer;groupSelector.left=pointer.x-groupSelector.ex;groupSelector.top=pointer.y-groupSelector.ey;this.renderTop();}
else if(!this._currentTransform){target=this.findTarget(e)||null;this._setCursorFromEvent(e,target);this._fireOverOutEvents(target,e);}
else{this._transformObject(e);}
this._handleEvent(e,'move');this._resetTransformEventData();},_fireOverOutEvents:function(target,e){var _hoveredTarget=this._hoveredTarget,_hoveredTargets=this._hoveredTargets,targets=this.targets,length=Math.max(_hoveredTargets.length,targets.length);this.fireSyntheticInOutEvents(target,e,{oldTarget:_hoveredTarget,evtOut:'mouseout',canvasEvtOut:'mouse:out',evtIn:'mouseover',canvasEvtIn:'mouse:over',});for(var i=0;i<length;i++){this.fireSyntheticInOutEvents(targets[i],e,{oldTarget:_hoveredTargets[i],evtOut:'mouseout',evtIn:'mouseover',});}
this._hoveredTarget=target;this._hoveredTargets=this.targets.concat();},_fireEnterLeaveEvents:function(target,e){var _draggedoverTarget=this._draggedoverTarget,_hoveredTargets=this._hoveredTargets,targets=this.targets,length=Math.max(_hoveredTargets.length,targets.length);this.fireSyntheticInOutEvents(target,e,{oldTarget:_draggedoverTarget,evtOut:'dragleave',evtIn:'dragenter',});for(var i=0;i<length;i++){this.fireSyntheticInOutEvents(targets[i],e,{oldTarget:_hoveredTargets[i],evtOut:'dragleave',evtIn:'dragenter',});}
this._draggedoverTarget=target;},fireSyntheticInOutEvents:function(target,e,config){var inOpt,outOpt,oldTarget=config.oldTarget,outFires,inFires,targetChanged=oldTarget!==target,canvasEvtIn=config.canvasEvtIn,canvasEvtOut=config.canvasEvtOut;if(targetChanged){inOpt={e:e,target:target,previousTarget:oldTarget};outOpt={e:e,target:oldTarget,nextTarget:target};}
inFires=target&&targetChanged;outFires=oldTarget&&targetChanged;if(outFires){canvasEvtOut&&this.fire(canvasEvtOut,outOpt);oldTarget.fire(config.evtOut,outOpt);}
if(inFires){canvasEvtIn&&this.fire(canvasEvtIn,inOpt);target.fire(config.evtIn,inOpt);}},__onMouseWheel:function(e){this._cacheTransformEventData(e);this._handleEvent(e,'wheel');this._resetTransformEventData();},_transformObject:function(e){var pointer=this.getPointer(e),transform=this._currentTransform;transform.reset=false;transform.shiftKey=e.shiftKey;transform.altKey=e[this.centeredKey];this._performTransformAction(e,transform,pointer);transform.actionPerformed&&this.requestRenderAll();},_performTransformAction:function(e,transform,pointer){var x=pointer.x,y=pointer.y,action=transform.action,actionPerformed=false,actionHandler=transform.actionHandler;if(actionHandler){actionPerformed=actionHandler(e,transform,x,y);}
if(action==='drag'&&actionPerformed){transform.target.isMoving=true;this.setCursor(transform.target.moveCursor||this.moveCursor);}
transform.actionPerformed=transform.actionPerformed||actionPerformed;},_fire:fabric.controlsUtils.fireEvent,_setCursorFromEvent:function(e,target){if(!target){this.setCursor(this.defaultCursor);return false;}
var hoverCursor=target.hoverCursor||this.hoverCursor,activeSelection=this._activeObject&&this._activeObject.type==='activeSelection'?this._activeObject:null,corner=(!activeSelection||!activeSelection.contains(target))&&target._findTargetCorner(this.getPointer(e,true));if(!corner){if(target.subTargetCheck){this.targets.concat().reverse().map(function(_target){hoverCursor=_target.hoverCursor||hoverCursor;});}
this.setCursor(hoverCursor);}
else{this.setCursor(this.getCornerCursor(corner,target,e));}},getCornerCursor:function(corner,target,e){var control=target.controls[corner];return control.cursorStyleHandler(e,control,target);}});})();(function(){var min=Math.min,max=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,target){var activeObject=this._activeObject;return activeObject&&this._isSelectionKeyPressed(e)&&target&&target.selectable&&this.selection&&(activeObject!==target||activeObject.type==='activeSelection')&&!target.onSelect({e:e});},_handleGrouping:function(e,target){var activeObject=this._activeObject;if(activeObject.__corner){return;}
if(target===activeObject){target=this.findTarget(e,true);if(!target||!target.selectable){return;}}
if(activeObject&&activeObject.type==='activeSelection'){this._updateActiveSelection(target,e);}
else{this._createActiveSelection(target,e);}},_updateActiveSelection:function(target,e){var activeSelection=this._activeObject,currentActiveObjects=activeSelection._objects.slice(0);if(activeSelection.contains(target)){activeSelection.removeWithUpdate(target);this._hoveredTarget=target;this._hoveredTargets=this.targets.concat();if(activeSelection.size()===1){this._setActiveObject(activeSelection.item(0),e);}}
else{activeSelection.addWithUpdate(target);this._hoveredTarget=activeSelection;this._hoveredTargets=this.targets.concat();}
this._fireSelectionEvents(currentActiveObjects,e);},_createActiveSelection:function(target,e){var currentActives=this.getActiveObjects(),group=this._createGroup(target);this._hoveredTarget=group;this._setActiveObject(group,e);this._fireSelectionEvents(currentActives,e);},_createGroup:function(target){var objects=this._objects,isActiveLower=objects.indexOf(this._activeObject)<objects.indexOf(target),groupObjects=isActiveLower?[this._activeObject,target]:[target,this._activeObject];this._activeObject.isEditing&&this._activeObject.exitEditing();return new fabric.ActiveSelection(groupObjects,{canvas:this});},_groupSelectedObjects:function(e){var group=this._collectObjects(e),aGroup;if(group.length===1){this.setActiveObject(group[0],e);}
else if(group.length>1){aGroup=new fabric.ActiveSelection(group.reverse(),{canvas:this});this.setActiveObject(aGroup,e);}},_collectObjects:function(e){var group=[],currentObject,x1=this._groupSelector.ex,y1=this._groupSelector.ey,x2=x1+this._groupSelector.left,y2=y1+this._groupSelector.top,selectionX1Y1=new fabric.Point(min(x1,x2),min(y1,y2)),selectionX2Y2=new fabric.Point(max(x1,x2),max(y1,y2)),allowIntersect=!this.selectionFullyContained,isClick=x1===x2&&y1===y2;for(var i=this._objects.length;i--;){currentObject=this._objects[i];if(!currentObject||!currentObject.selectable||!currentObject.visible){continue;}
if((allowIntersect&&currentObject.intersectsWithRect(selectionX1Y1,selectionX2Y2,true))||currentObject.isContainedWithinRect(selectionX1Y1,selectionX2Y2,true)||(allowIntersect&&currentObject.containsPoint(selectionX1Y1,null,true))||(allowIntersect&&currentObject.containsPoint(selectionX2Y2,null,true))){group.push(currentObject);if(isClick){break;}}}
if(group.length>1){group=group.filter(function(object){return!object.onSelect({e:e});});}
return group;},_maybeGroupObjects:function(e){if(this.selection&&this._groupSelector){this._groupSelectedObjects(e);}
this.setCursor(this.defaultCursor);this._groupSelector=null;}});})();(function(){fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(options){options||(options={});var format=options.format||'png',quality=options.quality||1,multiplier=(options.multiplier||1)*(options.enableRetinaScaling?this.getRetinaScaling():1),canvasEl=this.toCanvasElement(multiplier,options);return fabric.util.toDataURL(canvasEl,format,quality);},toCanvasElement:function(multiplier,cropping){multiplier=multiplier||1;cropping=cropping||{};var scaledWidth=(cropping.width||this.width)*multiplier,scaledHeight=(cropping.height||this.height)*multiplier,zoom=this.getZoom(),originalWidth=this.width,originalHeight=this.height,newZoom=zoom*multiplier,vp=this.viewportTransform,translateX=(vp[4]-(cropping.left||0))*multiplier,translateY=(vp[5]-(cropping.top||0))*multiplier,originalInteractive=this.interactive,newVp=[newZoom,0,0,newZoom,translateX,translateY],originalRetina=this.enableRetinaScaling,canvasEl=fabric.util.createCanvasElement(),originalContextTop=this.contextTop;canvasEl.width=scaledWidth;canvasEl.height=scaledHeight;this.contextTop=null;this.enableRetinaScaling=false;this.interactive=false;this.viewportTransform=newVp;this.width=scaledWidth;this.height=scaledHeight;this.calcViewportBoundaries();this.renderCanvas(canvasEl.getContext('2d'),this._objects);this.viewportTransform=vp;this.width=originalWidth;this.height=originalHeight;this.calcViewportBoundaries();this.interactive=originalInteractive;this.enableRetinaScaling=originalRetina;this.contextTop=originalContextTop;return canvasEl;},});})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromJSON:function(json,callback,reviver){if(!json){return;}
var serialized=(typeof json==='string')?JSON.parse(json):fabric.util.object.clone(json);var _this=this,clipPath=serialized.clipPath,renderOnAddRemove=this.renderOnAddRemove;this.renderOnAddRemove=false;delete serialized.clipPath;this._enlivenObjects(serialized.objects,function(enlivenedObjects){_this.clear();_this._setBgOverlay(serialized,function(){if(clipPath){_this._enlivenObjects([clipPath],function(enlivenedCanvasClip){_this.clipPath=enlivenedCanvasClip[0];_this.__setupCanvas.call(_this,serialized,enlivenedObjects,renderOnAddRemove,callback);});}
else{_this.__setupCanvas.call(_this,serialized,enlivenedObjects,renderOnAddRemove,callback);}});},reviver);return this;},__setupCanvas:function(serialized,enlivenedObjects,renderOnAddRemove,callback){var _this=this;enlivenedObjects.forEach(function(obj,index){_this.insertAt(obj,index);});this.renderOnAddRemove=renderOnAddRemove;delete serialized.objects;delete serialized.backgroundImage;delete serialized.overlayImage;delete serialized.background;delete serialized.overlay;this._setOptions(serialized);this.renderAll();callback&&callback();},_setBgOverlay:function(serialized,callback){var loaded={backgroundColor:false,overlayColor:false,backgroundImage:false,overlayImage:false};if(!serialized.backgroundImage&&!serialized.overlayImage&&!serialized.background&&!serialized.overlay){callback&&callback();return;}
var cbIfLoaded=function(){if(loaded.backgroundImage&&loaded.overlayImage&&loaded.backgroundColor&&loaded.overlayColor){callback&&callback();}};this.__setBgOverlay('backgroundImage',serialized.backgroundImage,loaded,cbIfLoaded);this.__setBgOverlay('overlayImage',serialized.overlayImage,loaded,cbIfLoaded);this.__setBgOverlay('backgroundColor',serialized.background,loaded,cbIfLoaded);this.__setBgOverlay('overlayColor',serialized.overlay,loaded,cbIfLoaded);},__setBgOverlay:function(property,value,loaded,callback){var _this=this;if(!value){loaded[property]=true;callback&&callback();return;}
if(property==='backgroundImage'||property==='overlayImage'){fabric.util.enlivenObjects([value],function(enlivedObject){_this[property]=enlivedObject[0];loaded[property]=true;callback&&callback();});}
else{this['set'+fabric.util.string.capitalize(property,true)](value,function(){loaded[property]=true;callback&&callback();});}},_enlivenObjects:function(objects,callback,reviver){if(!objects||objects.length===0){callback&&callback([]);return;}
fabric.util.enlivenObjects(objects,function(enlivenedObjects){callback&&callback(enlivenedObjects);},null,reviver);},_toDataURL:function(format,callback){this.clone(function(clone){callback(clone.toDataURL(format));});},_toDataURLWithMultiplier:function(format,multiplier,callback){this.clone(function(clone){callback(clone.toDataURLWithMultiplier(format,multiplier));});},clone:function(callback,properties){var data=JSON.stringify(this.toJSON(properties));this.cloneWithoutData(function(clone){clone.loadFromJSON(data,function(){callback&&callback(clone);});});},cloneWithoutData:function(callback){var el=fabric.util.createCanvasElement();el.width=this.width;el.height=this.height;var clone=new fabric.Canvas(el);if(this.backgroundImage){clone.setBackgroundImage(this.backgroundImage.src,function(){clone.renderAll();callback&&callback(clone);});clone.backgroundImageOpacity=this.backgroundImageOpacity;clone.backgroundImageStretch=this.backgroundImageStretch;}
else{callback&&callback(clone);}}});(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,capitalize=fabric.util.string.capitalize,degreesToRadians=fabric.util.degreesToRadians,objectCaching=!fabric.isLikelyNode,ALIASING_LIMIT=2;if(fabric.Object){return;}
fabric.Object=fabric.util.createClass(fabric.CommonMethods,{type:'object',originX:'left',originY:'top',top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:true,hoverCursor:null,moveCursor:null,padding:0,borderColor:'rgb(178,204,255)',borderDashArray:null,cornerColor:'rgb(178,204,255)',cornerStrokeColor:null,cornerStyle:'rect',cornerDashArray:null,centeredScaling:false,centeredRotation:true,fill:'rgb(0,0,0)',fillRule:'nonzero',globalCompositeOperation:'source-over',backgroundColor:'',selectionBackgroundColor:'',stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:'butt',strokeLineJoin:'miter',strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,minScaleLimit:0,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,perPixelTargetFind:false,includeDefaultValues:true,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:false,excludeFromExport:false,objectCaching:objectCaching,statefullCache:false,noScaleCache:true,strokeUniform:false,dirty:true,__corner:0,paintFirst:'fill',activeOn:'down',stateProperties:('top left width height scaleX scaleY flipX flipY originX originY transformMatrix '+'stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit '+'angle opacity fill globalCompositeOperation shadow visible backgroundColor '+'skewX skewY fillRule paintFirst clipPath strokeUniform').split(' '),cacheProperties:('fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform'+' strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath').split(' '),colorProperties:('fill stroke backgroundColor').split(' '),clipPath:undefined,inverted:false,absolutePositioned:false,initialize:function(options){if(options){this.setOptions(options);}},_createCacheCanvas:function(){this._cacheProperties={};this._cacheCanvas=fabric.util.createCanvasElement();this._cacheContext=this._cacheCanvas.getContext('2d');this._updateCacheCanvas();this.dirty=true;},_limitCacheSize:function(dims){var perfLimitSizeTotal=fabric.perfLimitSizeTotal,width=dims.width,height=dims.height,max=fabric.maxCacheSideLimit,min=fabric.minCacheSideLimit;if(width<=max&&height<=max&&width*height<=perfLimitSizeTotal){if(width<min){dims.width=min;}
if(height<min){dims.height=min;}
return dims;}
var ar=width/height,limitedDims=fabric.util.limitDimsByArea(ar,perfLimitSizeTotal),capValue=fabric.util.capValue,x=capValue(min,limitedDims.x,max),y=capValue(min,limitedDims.y,max);if(width>x){dims.zoomX/=width/x;dims.width=x;dims.capped=true;}
if(height>y){dims.zoomY/=height/y;dims.height=y;dims.capped=true;}
return dims;},_getCacheCanvasDimensions:function(){var objectScale=this.getTotalObjectScaling(),dim=this._getTransformedDimensions(0,0),neededX=dim.x*objectScale.scaleX/this.scaleX,neededY=dim.y*objectScale.scaleY/this.scaleY;return{width:neededX+ALIASING_LIMIT,height:neededY+ALIASING_LIMIT,zoomX:objectScale.scaleX,zoomY:objectScale.scaleY,x:neededX,y:neededY};},_updateCacheCanvas:function(){var targetCanvas=this.canvas;if(this.noScaleCache&&targetCanvas&&targetCanvas._currentTransform){var target=targetCanvas._currentTransform.target,action=targetCanvas._currentTransform.action;if(this===target&&action.slice&&action.slice(0,5)==='scale'){return false;}}
var canvas=this._cacheCanvas,dims=this._limitCacheSize(this._getCacheCanvasDimensions()),minCacheSize=fabric.minCacheSideLimit,width=dims.width,height=dims.height,drawingWidth,drawingHeight,zoomX=dims.zoomX,zoomY=dims.zoomY,dimensionsChanged=width!==this.cacheWidth||height!==this.cacheHeight,zoomChanged=this.zoomX!==zoomX||this.zoomY!==zoomY,shouldRedraw=dimensionsChanged||zoomChanged,additionalWidth=0,additionalHeight=0,shouldResizeCanvas=false;if(dimensionsChanged){var canvasWidth=this._cacheCanvas.width,canvasHeight=this._cacheCanvas.height,sizeGrowing=width>canvasWidth||height>canvasHeight,sizeShrinking=(width<canvasWidth*0.9||height<canvasHeight*0.9)&&canvasWidth>minCacheSize&&canvasHeight>minCacheSize;shouldResizeCanvas=sizeGrowing||sizeShrinking;if(sizeGrowing&&!dims.capped&&(width>minCacheSize||height>minCacheSize)){additionalWidth=width*0.1;additionalHeight=height*0.1;}}
if(this instanceof fabric.Text&&this.path){shouldRedraw=true;shouldResizeCanvas=true;additionalWidth+=this.getHeightOfLine(0)*this.zoomX;additionalHeight+=this.getHeightOfLine(0)*this.zoomY;}
if(shouldRedraw){if(shouldResizeCanvas){canvas.width=Math.ceil(width+additionalWidth);canvas.height=Math.ceil(height+additionalHeight);}
else{this._cacheContext.setTransform(1,0,0,1,0,0);this._cacheContext.clearRect(0,0,canvas.width,canvas.height);}
drawingWidth=dims.x/2;drawingHeight=dims.y/2;this.cacheTranslationX=Math.round(canvas.width/2-drawingWidth)+drawingWidth;this.cacheTranslationY=Math.round(canvas.height/2-drawingHeight)+drawingHeight;this.cacheWidth=width;this.cacheHeight=height;this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY);this._cacheContext.scale(zoomX,zoomY);this.zoomX=zoomX;this.zoomY=zoomY;return true;}
return false;},setOptions:function(options){this._setOptions(options);this._initGradient(options.fill,'fill');this._initGradient(options.stroke,'stroke');this._initPattern(options.fill,'fill');this._initPattern(options.stroke,'stroke');},transform:function(ctx){var needFullTransform=(this.group&&!this.group._transformDone)||(this.group&&this.canvas&&ctx===this.canvas.contextTop);var m=this.calcTransformMatrix(!needFullTransform);ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]);},toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,object={type:this.type,version:fabric.version,originX:this.originX,originY:this.originY,left:toFixed(this.left,NUM_FRACTION_DIGITS),top:toFixed(this.top,NUM_FRACTION_DIGITS),width:toFixed(this.width,NUM_FRACTION_DIGITS),height:toFixed(this.height,NUM_FRACTION_DIGITS),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:toFixed(this.strokeWidth,NUM_FRACTION_DIGITS),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:toFixed(this.strokeMiterLimit,NUM_FRACTION_DIGITS),scaleX:toFixed(this.scaleX,NUM_FRACTION_DIGITS),scaleY:toFixed(this.scaleY,NUM_FRACTION_DIGITS),angle:toFixed(this.angle,NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:toFixed(this.opacity,NUM_FRACTION_DIGITS),shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:toFixed(this.skewX,NUM_FRACTION_DIGITS),skewY:toFixed(this.skewY,NUM_FRACTION_DIGITS),};if(this.clipPath&&!this.clipPath.excludeFromExport){object.clipPath=this.clipPath.toObject(propertiesToInclude);object.clipPath.inverted=this.clipPath.inverted;object.clipPath.absolutePositioned=this.clipPath.absolutePositioned;}
fabric.util.populateWithProperties(this,object,propertiesToInclude);if(!this.includeDefaultValues){object=this._removeDefaultValues(object);}
return object;},toDatalessObject:function(propertiesToInclude){return this.toObject(propertiesToInclude);},_removeDefaultValues:function(object){var prototype=fabric.util.getKlass(object.type).prototype,stateProperties=prototype.stateProperties;stateProperties.forEach(function(prop){if(prop==='left'||prop==='top'){return;}
if(object[prop]===prototype[prop]){delete object[prop];}
var isArray=Object.prototype.toString.call(object[prop])==='[object Array]'&&Object.prototype.toString.call(prototype[prop])==='[object Array]';if(isArray&&object[prop].length===0&&prototype[prop].length===0){delete object[prop];}});return object;},toString:function(){return'#<fabric.'+capitalize(this.type)+'>';},getObjectScaling:function(){if(!this.group){return{scaleX:this.scaleX,scaleY:this.scaleY,};}
var options=fabric.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(options.scaleX),scaleY:Math.abs(options.scaleY)};},getTotalObjectScaling:function(){var scale=this.getObjectScaling(),scaleX=scale.scaleX,scaleY=scale.scaleY;if(this.canvas){var zoom=this.canvas.getZoom();var retina=this.canvas.getRetinaScaling();scaleX*=zoom*retina;scaleY*=zoom*retina;}
return{scaleX:scaleX,scaleY:scaleY};},getObjectOpacity:function(){var opacity=this.opacity;if(this.group){opacity*=this.group.getObjectOpacity();}
return opacity;},_set:function(key,value){var shouldConstrainValue=(key==='scaleX'||key==='scaleY'),isChanged=this[key]!==value,groupNeedsUpdate=false;if(shouldConstrainValue){value=this._constrainScale(value);}
if(key==='scaleX'&&value<0){this.flipX=!this.flipX;value*=-1;}
else if(key==='scaleY'&&value<0){this.flipY=!this.flipY;value*=-1;}
else if(key==='shadow'&&value&&!(value instanceof fabric.Shadow)){value=new fabric.Shadow(value);}
else if(key==='dirty'&&this.group){this.group.set('dirty',value);}
this[key]=value;if(isChanged){groupNeedsUpdate=this.group&&this.group.isOnACache();if(this.cacheProperties.indexOf(key)>-1){this.dirty=true;groupNeedsUpdate&&this.group.set('dirty',true);}
else if(groupNeedsUpdate&&this.stateProperties.indexOf(key)>-1){this.group.set('dirty',true);}}
return this;},setOnGroup:function(){},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform;}
return fabric.iMatrix.concat();},isNotVisible:function(){return this.opacity===0||(!this.width&&!this.height&&this.strokeWidth===0)||!this.visible;},render:function(ctx){if(this.isNotVisible()){return;}
if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return;}
ctx.save();this._setupCompositeOperation(ctx);this.drawSelectionBackground(ctx);this.transform(ctx);this._setOpacity(ctx);this._setShadow(ctx,this);if(this.shouldCache()){this.renderCache();this.drawCacheOnCanvas(ctx);}
else{this._removeCacheCanvas();this.dirty=false;this.drawObject(ctx);if(this.objectCaching&&this.statefullCache){this.saveState({propertySet:'cacheProperties'});}}
ctx.restore();},renderCache:function(options){options=options||{};if(!this._cacheCanvas){this._createCacheCanvas();}
if(this.isCacheDirty()){this.statefullCache&&this.saveState({propertySet:'cacheProperties'});this.drawObject(this._cacheContext,options.forClipping);this.dirty=false;}},_removeCacheCanvas:function(){this._cacheCanvas=null;this.cacheWidth=0;this.cacheHeight=0;},hasStroke:function(){return this.stroke&&this.stroke!=='transparent'&&this.strokeWidth!==0;},hasFill:function(){return this.fill&&this.fill!=='transparent';},needsItsOwnCache:function(){if(this.paintFirst==='stroke'&&this.hasFill()&&this.hasStroke()&&typeof this.shadow==='object'){return true;}
if(this.clipPath){return true;}
return false;},shouldCache:function(){this.ownCaching=this.needsItsOwnCache()||(this.objectCaching&&(!this.group||!this.group.isOnACache()));return this.ownCaching;},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0);},drawClipPathOnCache:function(ctx,clipPath){ctx.save();if(clipPath.inverted){ctx.globalCompositeOperation='destination-out';}
else{ctx.globalCompositeOperation='destination-in';}
if(clipPath.absolutePositioned){var m=fabric.util.invertTransform(this.calcTransformMatrix());ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]);}
clipPath.transform(ctx);ctx.scale(1/clipPath.zoomX,1/clipPath.zoomY);ctx.drawImage(clipPath._cacheCanvas,-clipPath.cacheTranslationX,-clipPath.cacheTranslationY);ctx.restore();},drawObject:function(ctx,forClipping){var originalFill=this.fill,originalStroke=this.stroke;if(forClipping){this.fill='black';this.stroke='';this._setClippingProperties(ctx);}
else{this._renderBackground(ctx);}
this._render(ctx);this._drawClipPath(ctx,this.clipPath);this.fill=originalFill;this.stroke=originalStroke;},_drawClipPath:function(ctx,clipPath){if(!clipPath){return;}
clipPath.canvas=this.canvas;clipPath.shouldCache();clipPath._transformDone=true;clipPath.renderCache({forClipping:true});this.drawClipPathOnCache(ctx,clipPath);},drawCacheOnCanvas:function(ctx){ctx.scale(1/this.zoomX,1/this.zoomY);ctx.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY);},isCacheDirty:function(skipCanvas){if(this.isNotVisible()){return false;}
if(this._cacheCanvas&&!skipCanvas&&this._updateCacheCanvas()){return true;}
else{if(this.dirty||(this.clipPath&&this.clipPath.absolutePositioned)||(this.statefullCache&&this.hasStateChanged('cacheProperties'))){if(this._cacheCanvas&&!skipCanvas){var width=this.cacheWidth/this.zoomX;var height=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-width/2,-height/2,width,height);}
return true;}}
return false;},_renderBackground:function(ctx){if(!this.backgroundColor){return;}
var dim=this._getNonTransformedDimensions();ctx.fillStyle=this.backgroundColor;ctx.fillRect(-dim.x/2,-dim.y/2,dim.x,dim.y);this._removeShadow(ctx);},_setOpacity:function(ctx){if(this.group&&!this.group._transformDone){ctx.globalAlpha=this.getObjectOpacity();}
else{ctx.globalAlpha*=this.opacity;}},_setStrokeStyles:function(ctx,decl){var stroke=decl.stroke;if(stroke){ctx.lineWidth=decl.strokeWidth;ctx.lineCap=decl.strokeLineCap;ctx.lineDashOffset=decl.strokeDashOffset;ctx.lineJoin=decl.strokeLineJoin;ctx.miterLimit=decl.strokeMiterLimit;if(stroke.toLive){if(stroke.gradientUnits==='percentage'||stroke.gradientTransform||stroke.patternTransform){this._applyPatternForTransformedGradient(ctx,stroke);}
else{ctx.strokeStyle=stroke.toLive(ctx,this);this._applyPatternGradientTransform(ctx,stroke);}}
else{ctx.strokeStyle=decl.stroke;}}},_setFillStyles:function(ctx,decl){var fill=decl.fill;if(fill){if(fill.toLive){ctx.fillStyle=fill.toLive(ctx,this);this._applyPatternGradientTransform(ctx,decl.fill);}
else{ctx.fillStyle=fill;}}},_setClippingProperties:function(ctx){ctx.globalAlpha=1;ctx.strokeStyle='transparent';ctx.fillStyle='#000000';},_setLineDash:function(ctx,dashArray){if(!dashArray||dashArray.length===0){return;}
if(1&dashArray.length){dashArray.push.apply(dashArray,dashArray);}
ctx.setLineDash(dashArray);},_renderControls:function(ctx,styleOverride){var vpt=this.getViewportTransform(),matrix=this.calcTransformMatrix(),options,drawBorders,drawControls;styleOverride=styleOverride||{};drawBorders=typeof styleOverride.hasBorders!=='undefined'?styleOverride.hasBorders:this.hasBorders;drawControls=typeof styleOverride.hasControls!=='undefined'?styleOverride.hasControls:this.hasControls;matrix=fabric.util.multiplyTransformMatrices(vpt,matrix);options=fabric.util.qrDecompose(matrix);ctx.save();ctx.translate(options.translateX,options.translateY);ctx.lineWidth=1*this.borderScaleFactor;if(!this.group){ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;}
if(this.flipX){options.angle-=180;}
ctx.rotate(degreesToRadians(this.group?options.angle:this.angle));if(styleOverride.forActiveSelection||this.group){drawBorders&&this.drawBordersInGroup(ctx,options,styleOverride);}
else{drawBorders&&this.drawBorders(ctx,styleOverride);}
drawControls&&this.drawControls(ctx,styleOverride);ctx.restore();},_setShadow:function(ctx){if(!this.shadow){return;}
var shadow=this.shadow,canvas=this.canvas,scaling,multX=(canvas&&canvas.viewportTransform[0])||1,multY=(canvas&&canvas.viewportTransform[3])||1;if(shadow.nonScaling){scaling={scaleX:1,scaleY:1};}
else{scaling=this.getObjectScaling();}
if(canvas&&canvas._isRetinaScaling()){multX*=fabric.devicePixelRatio;multY*=fabric.devicePixelRatio;}
ctx.shadowColor=shadow.color;ctx.shadowBlur=shadow.blur*fabric.browserShadowBlurConstant*(multX+multY)*(scaling.scaleX+scaling.scaleY)/4;ctx.shadowOffsetX=shadow.offsetX*multX*scaling.scaleX;ctx.shadowOffsetY=shadow.offsetY*multY*scaling.scaleY;},_removeShadow:function(ctx){if(!this.shadow){return;}
ctx.shadowColor='';ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0;},_applyPatternGradientTransform:function(ctx,filler){if(!filler||!filler.toLive){return{offsetX:0,offsetY:0};}
var t=filler.gradientTransform||filler.patternTransform;var offsetX=-this.width/2+filler.offsetX||0,offsetY=-this.height/2+filler.offsetY||0;if(filler.gradientUnits==='percentage'){ctx.transform(this.width,0,0,this.height,offsetX,offsetY);}
else{ctx.transform(1,0,0,1,offsetX,offsetY);}
if(t){ctx.transform(t[0],t[1],t[2],t[3],t[4],t[5]);}
return{offsetX:offsetX,offsetY:offsetY};},_renderPaintInOrder:function(ctx){if(this.paintFirst==='stroke'){this._renderStroke(ctx);this._renderFill(ctx);}
else{this._renderFill(ctx);this._renderStroke(ctx);}},_render:function(){},_renderFill:function(ctx){if(!this.fill){return;}
ctx.save();this._setFillStyles(ctx,this);if(this.fillRule==='evenodd'){ctx.fill('evenodd');}
else{ctx.fill();}
ctx.restore();},_renderStroke:function(ctx){if(!this.stroke||this.strokeWidth===0){return;}
if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(ctx);}
ctx.save();if(this.strokeUniform&&this.group){var scaling=this.getObjectScaling();ctx.scale(1/scaling.scaleX,1/scaling.scaleY);}
else if(this.strokeUniform){ctx.scale(1/this.scaleX,1/this.scaleY);}
this._setLineDash(ctx,this.strokeDashArray);this._setStrokeStyles(ctx,this);ctx.stroke();ctx.restore();},_applyPatternForTransformedGradient:function(ctx,filler){var dims=this._limitCacheSize(this._getCacheCanvasDimensions()),pCanvas=fabric.util.createCanvasElement(),pCtx,retinaScaling=this.canvas.getRetinaScaling(),width=dims.x/this.scaleX/retinaScaling,height=dims.y/this.scaleY/retinaScaling;pCanvas.width=width;pCanvas.height=height;pCtx=pCanvas.getContext('2d');pCtx.beginPath();pCtx.moveTo(0,0);pCtx.lineTo(width,0);pCtx.lineTo(width,height);pCtx.lineTo(0,height);pCtx.closePath();pCtx.translate(width/2,height/2);pCtx.scale(dims.zoomX/this.scaleX/retinaScaling,dims.zoomY/this.scaleY/retinaScaling);this._applyPatternGradientTransform(pCtx,filler);pCtx.fillStyle=filler.toLive(ctx);pCtx.fill();ctx.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2);ctx.scale(retinaScaling*this.scaleX/dims.zoomX,retinaScaling*this.scaleY/dims.zoomY);ctx.strokeStyle=pCtx.createPattern(pCanvas,'no-repeat');},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2};},_assignTransformMatrixProps:function(){if(this.transformMatrix){var options=fabric.util.qrDecompose(this.transformMatrix);this.flipX=false;this.flipY=false;this.set('scaleX',options.scaleX);this.set('scaleY',options.scaleY);this.angle=options.angle;this.skewX=options.skewX;this.skewY=0;}},_removeTransformMatrix:function(preserveAspectRatioOptions){var center=this._findCenterFromElement();if(this.transformMatrix){this._assignTransformMatrixProps();center=fabric.util.transformPoint(center,this.transformMatrix);}
this.transformMatrix=null;if(preserveAspectRatioOptions){this.scaleX*=preserveAspectRatioOptions.scaleX;this.scaleY*=preserveAspectRatioOptions.scaleY;this.cropX=preserveAspectRatioOptions.cropX;this.cropY=preserveAspectRatioOptions.cropY;center.x+=preserveAspectRatioOptions.offsetLeft;center.y+=preserveAspectRatioOptions.offsetTop;this.width=preserveAspectRatioOptions.width;this.height=preserveAspectRatioOptions.height;}
this.setPositionByOrigin(center,'center','center');},clone:function(callback,propertiesToInclude){var objectForm=this.toObject(propertiesToInclude);if(this.constructor.fromObject){this.constructor.fromObject(objectForm,callback);}
else{fabric.Object._fromObject('Object',objectForm,callback);}},cloneAsImage:function(callback,options){var canvasEl=this.toCanvasElement(options);if(callback){callback(new fabric.Image(canvasEl));}
return this;},toCanvasElement:function(options){options||(options={});var utils=fabric.util,origParams=utils.saveObjectTransform(this),originalGroup=this.group,originalShadow=this.shadow,abs=Math.abs,multiplier=(options.multiplier||1)*(options.enableRetinaScaling?fabric.devicePixelRatio:1);delete this.group;if(options.withoutTransform){utils.resetObjectTransform(this);}
if(options.withoutShadow){this.shadow=null;}
var el=fabric.util.createCanvasElement(),boundingRect=this.getBoundingRect(true,true),shadow=this.shadow,scaling,shadowOffset={x:0,y:0},shadowBlur,width,height;if(shadow){shadowBlur=shadow.blur;if(shadow.nonScaling){scaling={scaleX:1,scaleY:1};}
else{scaling=this.getObjectScaling();}
shadowOffset.x=2*Math.round(abs(shadow.offsetX)+shadowBlur)*(abs(scaling.scaleX));shadowOffset.y=2*Math.round(abs(shadow.offsetY)+shadowBlur)*(abs(scaling.scaleY));}
width=boundingRect.width+shadowOffset.x;height=boundingRect.height+shadowOffset.y;el.width=Math.ceil(width);el.height=Math.ceil(height);var canvas=new fabric.StaticCanvas(el,{enableRetinaScaling:false,renderOnAddRemove:false,skipOffscreen:false,});if(options.format==='jpeg'){canvas.backgroundColor='#fff';}
this.setPositionByOrigin(new fabric.Point(canvas.width/2,canvas.height/2),'center','center');var originalCanvas=this.canvas;canvas.add(this);var canvasEl=canvas.toCanvasElement(multiplier||1,options);this.shadow=originalShadow;this.set('canvas',originalCanvas);if(originalGroup){this.group=originalGroup;}
this.set(origParams).setCoords();canvas._objects=[];canvas.dispose();canvas=null;return canvasEl;},toDataURL:function(options){options||(options={});return fabric.util.toDataURL(this.toCanvasElement(options),options.format||'png',options.quality||1);},isType:function(type){return this.type===type;},complexity:function(){return 1;},toJSON:function(propertiesToInclude){return this.toObject(propertiesToInclude);},rotate:function(angle){var shouldCenterOrigin=(this.originX!=='center'||this.originY!=='center')&&this.centeredRotation;if(shouldCenterOrigin){this._setOriginToCenter();}
this.set('angle',angle);if(shouldCenterOrigin){this._resetOrigin();}
return this;},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this;},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this;},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this;},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this;},center:function(){this.canvas&&this.canvas.centerObject(this);return this;},viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this;},getLocalPointer:function(e,pointer){pointer=pointer||this.canvas.getPointer(e);var pClicked=new fabric.Point(pointer.x,pointer.y),objectLeftTop=this._getLeftTopCoords();if(this.angle){pClicked=fabric.util.rotatePoint(pClicked,objectLeftTop,degreesToRadians(-this.angle));}
return{x:pClicked.x-objectLeftTop.x,y:pClicked.y-objectLeftTop.y};},_setupCompositeOperation:function(ctx){if(this.globalCompositeOperation){ctx.globalCompositeOperation=this.globalCompositeOperation;}},dispose:function(){if(fabric.runningAnimations){fabric.runningAnimations.cancelByTarget(this);}}});fabric.util.createAccessors&&fabric.util.createAccessors(fabric.Object);extend(fabric.Object.prototype,fabric.Observable);fabric.Object.NUM_FRACTION_DIGITS=2;fabric.Object.ENLIVEN_PROPS=['clipPath'];fabric.Object._fromObject=function(className,object,callback,extraParam){var klass=fabric[className];object=clone(object,true);fabric.util.enlivenPatterns([object.fill,object.stroke],function(patterns){if(typeof patterns[0]!=='undefined'){object.fill=patterns[0];}
if(typeof patterns[1]!=='undefined'){object.stroke=patterns[1];}
fabric.util.enlivenObjectEnlivables(object,object,function(){var instance=extraParam?new klass(object[extraParam],object):new klass(object);callback&&callback(instance);});});};fabric.Object.__uid=0;})(typeof exports!=='undefined'?exports:this);(function(){var degreesToRadians=fabric.util.degreesToRadians,originXOffset={left:-0.5,center:0,right:0.5},originYOffset={top:-0.5,center:0,bottom:0.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(point,fromOriginX,fromOriginY,toOriginX,toOriginY){var x=point.x,y=point.y,offsetX,offsetY,dim;if(typeof fromOriginX==='string'){fromOriginX=originXOffset[fromOriginX];}
else{fromOriginX-=0.5;}
if(typeof toOriginX==='string'){toOriginX=originXOffset[toOriginX];}
else{toOriginX-=0.5;}
offsetX=toOriginX-fromOriginX;if(typeof fromOriginY==='string'){fromOriginY=originYOffset[fromOriginY];}
else{fromOriginY-=0.5;}
if(typeof toOriginY==='string'){toOriginY=originYOffset[toOriginY];}
else{toOriginY-=0.5;}
offsetY=toOriginY-fromOriginY;if(offsetX||offsetY){dim=this._getTransformedDimensions();x=point.x+offsetX*dim.x;y=point.y+offsetY*dim.y;}
return new fabric.Point(x,y);},translateToCenterPoint:function(point,originX,originY){var p=this.translateToGivenOrigin(point,originX,originY,'center','center');if(this.angle){return fabric.util.rotatePoint(p,point,degreesToRadians(this.angle));}
return p;},translateToOriginPoint:function(center,originX,originY){var p=this.translateToGivenOrigin(center,'center','center',originX,originY);if(this.angle){return fabric.util.rotatePoint(p,center,degreesToRadians(this.angle));}
return p;},getCenterPoint:function(){var leftTop=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(leftTop,this.originX,this.originY);},getPointByOrigin:function(originX,originY){var center=this.getCenterPoint();return this.translateToOriginPoint(center,originX,originY);},toLocalPoint:function(point,originX,originY){var center=this.getCenterPoint(),p,p2;if(typeof originX!=='undefined'&&typeof originY!=='undefined'){p=this.translateToGivenOrigin(center,'center','center',originX,originY);}
else{p=new fabric.Point(this.left,this.top);}
p2=new fabric.Point(point.x,point.y);if(this.angle){p2=fabric.util.rotatePoint(p2,center,-degreesToRadians(this.angle));}
return p2.subtractEquals(p);},setPositionByOrigin:function(pos,originX,originY){var center=this.translateToCenterPoint(pos,originX,originY),position=this.translateToOriginPoint(center,this.originX,this.originY);this.set('left',position.x);this.set('top',position.y);},adjustPosition:function(to){var angle=degreesToRadians(this.angle),hypotFull=this.getScaledWidth(),xFull=fabric.util.cos(angle)*hypotFull,yFull=fabric.util.sin(angle)*hypotFull,offsetFrom,offsetTo;if(typeof this.originX==='string'){offsetFrom=originXOffset[this.originX];}
else{offsetFrom=this.originX-0.5;}
if(typeof to==='string'){offsetTo=originXOffset[to];}
else{offsetTo=to-0.5;}
this.left+=xFull*(offsetTo-offsetFrom);this.top+=yFull*(offsetTo-offsetFrom);this.setCoords();this.originX=to;},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var center=this.getCenterPoint();this.originX='center';this.originY='center';this.left=center.x;this.top=center.y;},_resetOrigin:function(){var originPoint=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=originPoint.x;this.top=originPoint.y;this._originalOriginX=null;this._originalOriginY=null;},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),'left','top');},});})();(function(){function arrayFromCoords(coords){return[new fabric.Point(coords.tl.x,coords.tl.y),new fabric.Point(coords.tr.x,coords.tr.y),new fabric.Point(coords.br.x,coords.br.y),new fabric.Point(coords.bl.x,coords.bl.y)];}
var util=fabric.util,degreesToRadians=util.degreesToRadians,multiplyMatrices=util.multiplyTransformMatrices,transformPoint=util.transformPoint;util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(absolute,calculate){if(calculate){return(absolute?this.calcACoords():this.calcLineCoords());}
if(!this.aCoords||!this.lineCoords){this.setCoords(true);}
return(absolute?this.aCoords:this.lineCoords);},getCoords:function(absolute,calculate){return arrayFromCoords(this._getCoords(absolute,calculate));},intersectsWithRect:function(pointTL,pointBR,absolute,calculate){var coords=this.getCoords(absolute,calculate),intersection=fabric.Intersection.intersectPolygonRectangle(coords,pointTL,pointBR);return intersection.status==='Intersection';},intersectsWithObject:function(other,absolute,calculate){var intersection=fabric.Intersection.intersectPolygonPolygon(this.getCoords(absolute,calculate),other.getCoords(absolute,calculate));return intersection.status==='Intersection'||other.isContainedWithinObject(this,absolute,calculate)||this.isContainedWithinObject(other,absolute,calculate);},isContainedWithinObject:function(other,absolute,calculate){var points=this.getCoords(absolute,calculate),otherCoords=absolute?other.aCoords:other.lineCoords,i=0,lines=other._getImageLines(otherCoords);for(;i<4;i++){if(!other.containsPoint(points[i],lines)){return false;}}
return true;},isContainedWithinRect:function(pointTL,pointBR,absolute,calculate){var boundingRect=this.getBoundingRect(absolute,calculate);return(boundingRect.left>=pointTL.x&&boundingRect.left+boundingRect.width<=pointBR.x&&boundingRect.top>=pointTL.y&&boundingRect.top+boundingRect.height<=pointBR.y);},containsPoint:function(point,lines,absolute,calculate){var coords=this._getCoords(absolute,calculate),lines=lines||this._getImageLines(coords),xPoints=this._findCrossPoints(point,lines);return(xPoints!==0&&xPoints%2===1);},isOnScreen:function(calculate){if(!this.canvas){return false;}
var pointTL=this.canvas.vptCoords.tl,pointBR=this.canvas.vptCoords.br;var points=this.getCoords(true,calculate);if(points.some(function(point){return point.x<=pointBR.x&&point.x>=pointTL.x&&point.y<=pointBR.y&&point.y>=pointTL.y;})){return true;}
if(this.intersectsWithRect(pointTL,pointBR,true,calculate)){return true;}
return this._containsCenterOfCanvas(pointTL,pointBR,calculate);},_containsCenterOfCanvas:function(pointTL,pointBR,calculate){var centerPoint={x:(pointTL.x+pointBR.x)/2,y:(pointTL.y+pointBR.y)/2};if(this.containsPoint(centerPoint,null,true,calculate)){return true;}
return false;},isPartiallyOnScreen:function(calculate){if(!this.canvas){return false;}
var pointTL=this.canvas.vptCoords.tl,pointBR=this.canvas.vptCoords.br;if(this.intersectsWithRect(pointTL,pointBR,true,calculate)){return true;}
var allPointsAreOutside=this.getCoords(true,calculate).every(function(point){return(point.x>=pointBR.x||point.x<=pointTL.x)&&(point.y>=pointBR.y||point.y<=pointTL.y);});return allPointsAreOutside&&this._containsCenterOfCanvas(pointTL,pointBR,calculate);},_getImageLines:function(oCoords){var lines={topline:{o:oCoords.tl,d:oCoords.tr},rightline:{o:oCoords.tr,d:oCoords.br},bottomline:{o:oCoords.br,d:oCoords.bl},leftline:{o:oCoords.bl,d:oCoords.tl}};return lines;},_findCrossPoints:function(point,lines){var b1,b2,a1,a2,xi,xcount=0,iLine;for(var lineKey in lines){iLine=lines[lineKey];if((iLine.o.y<point.y)&&(iLine.d.y<point.y)){continue;}
if((iLine.o.y>=point.y)&&(iLine.d.y>=point.y)){continue;}
if((iLine.o.x===iLine.d.x)&&(iLine.o.x>=point.x)){xi=iLine.o.x;}
else{b1=0;b2=(iLine.d.y-iLine.o.y)/(iLine.d.x-iLine.o.x);a1=point.y-b1*point.x;a2=iLine.o.y-b2*iLine.o.x;xi=-(a1-a2)/(b1-b2);}
if(xi>=point.x){xcount+=1;}
if(xcount===2){break;}}
return xcount;},getBoundingRect:function(absolute,calculate){var coords=this.getCoords(absolute,calculate);return util.makeBoundingBoxFromPoints(coords);},getScaledWidth:function(){return this._getTransformedDimensions().x;},getScaledHeight:function(){return this._getTransformedDimensions().y;},_constrainScale:function(value){if(Math.abs(value)<this.minScaleLimit){if(value<0){return-this.minScaleLimit;}
else{return this.minScaleLimit;}}
else if(value===0){return 0.0001;}
return value;},scale:function(value){this._set('scaleX',value);this._set('scaleY',value);return this.setCoords();},scaleToWidth:function(value,absolute){var boundingRectFactor=this.getBoundingRect(absolute).width/this.getScaledWidth();return this.scale(value/this.width/boundingRectFactor);},scaleToHeight:function(value,absolute){var boundingRectFactor=this.getBoundingRect(absolute).height/this.getScaledHeight();return this.scale(value/this.height/boundingRectFactor);},calcLineCoords:function(){var vpt=this.getViewportTransform(),padding=this.padding,angle=degreesToRadians(this.angle),cos=util.cos(angle),sin=util.sin(angle),cosP=cos*padding,sinP=sin*padding,cosPSinP=cosP+sinP,cosPMinusSinP=cosP-sinP,aCoords=this.calcACoords();var lineCoords={tl:transformPoint(aCoords.tl,vpt),tr:transformPoint(aCoords.tr,vpt),bl:transformPoint(aCoords.bl,vpt),br:transformPoint(aCoords.br,vpt),};if(padding){lineCoords.tl.x-=cosPMinusSinP;lineCoords.tl.y-=cosPSinP;lineCoords.tr.x+=cosPSinP;lineCoords.tr.y-=cosPMinusSinP;lineCoords.bl.x-=cosPSinP;lineCoords.bl.y+=cosPMinusSinP;lineCoords.br.x+=cosPMinusSinP;lineCoords.br.y+=cosPSinP;}
return lineCoords;},calcOCoords:function(){var rotateMatrix=this._calcRotateMatrix(),translateMatrix=this._calcTranslateMatrix(),vpt=this.getViewportTransform(),startMatrix=multiplyMatrices(vpt,translateMatrix),finalMatrix=multiplyMatrices(startMatrix,rotateMatrix),finalMatrix=multiplyMatrices(finalMatrix,[1/vpt[0],0,0,1/vpt[3],0,0]),dim=this._calculateCurrentDimensions(),coords={};this.forEachControl(function(control,key,fabricObject){coords[key]=control.positionHandler(dim,finalMatrix,fabricObject);});return coords;},calcACoords:function(){var rotateMatrix=this._calcRotateMatrix(),translateMatrix=this._calcTranslateMatrix(),finalMatrix=multiplyMatrices(translateMatrix,rotateMatrix),dim=this._getTransformedDimensions(),w=dim.x/2,h=dim.y/2;return{tl:transformPoint({x:-w,y:-h},finalMatrix),tr:transformPoint({x:w,y:-h},finalMatrix),bl:transformPoint({x:-w,y:h},finalMatrix),br:transformPoint({x:w,y:h},finalMatrix)};},setCoords:function(skipCorners){this.aCoords=this.calcACoords();this.lineCoords=this.group?this.aCoords:this.calcLineCoords();if(skipCorners){return this;}
this.oCoords=this.calcOCoords();this._setCornerCoords&&this._setCornerCoords();return this;},_calcRotateMatrix:function(){return util.calcRotateMatrix(this);},_calcTranslateMatrix:function(){var center=this.getCenterPoint();return[1,0,0,1,center.x,center.y];},transformMatrixKey:function(skipGroup){var sep='_',prefix='';if(!skipGroup&&this.group){prefix=this.group.transformMatrixKey(skipGroup)+sep;};return prefix+this.top+sep+this.left+sep+this.scaleX+sep+this.scaleY+
sep+this.skewX+sep+this.skewY+sep+this.angle+sep+this.originX+sep+this.originY+
sep+this.width+sep+this.height+sep+this.strokeWidth+this.flipX+this.flipY;},calcTransformMatrix:function(skipGroup){var matrix=this.calcOwnMatrix();if(skipGroup||!this.group){return matrix;}
var key=this.transformMatrixKey(skipGroup),cache=this.matrixCache||(this.matrixCache={});if(cache.key===key){return cache.value;}
if(this.group){matrix=multiplyMatrices(this.group.calcTransformMatrix(false),matrix);}
cache.key=key;cache.value=matrix;return matrix;},calcOwnMatrix:function(){var key=this.transformMatrixKey(true),cache=this.ownMatrixCache||(this.ownMatrixCache={});if(cache.key===key){return cache.value;}
var tMatrix=this._calcTranslateMatrix(),options={angle:this.angle,translateX:tMatrix[4],translateY:tMatrix[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY,};cache.key=key;cache.value=util.composeMatrix(options);return cache.value;},_getNonTransformedDimensions:function(){var strokeWidth=this.strokeWidth,w=this.width+strokeWidth,h=this.height+strokeWidth;return{x:w,y:h};},_getTransformedDimensions:function(skewX,skewY){if(typeof skewX==='undefined'){skewX=this.skewX;}
if(typeof skewY==='undefined'){skewY=this.skewY;}
var dimensions,dimX,dimY,noSkew=skewX===0&&skewY===0;if(this.strokeUniform){dimX=this.width;dimY=this.height;}
else{dimensions=this._getNonTransformedDimensions();dimX=dimensions.x;dimY=dimensions.y;}
if(noSkew){return this._finalizeDimensions(dimX*this.scaleX,dimY*this.scaleY);}
var bbox=util.sizeAfterTransform(dimX,dimY,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:skewX,skewY:skewY,});return this._finalizeDimensions(bbox.x,bbox.y);},_finalizeDimensions:function(width,height){return this.strokeUniform?{x:width+this.strokeWidth,y:height+this.strokeWidth}:{x:width,y:height};},_calculateCurrentDimensions:function(){var vpt=this.getViewportTransform(),dim=this._getTransformedDimensions(),p=transformPoint(dim,vpt,true);return p.scalarAdd(2*this.padding);},});})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this);}
else if(this.canvas){this.canvas.sendToBack(this);}
return this;},bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this);}
else if(this.canvas){this.canvas.bringToFront(this);}
return this;},sendBackwards:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,intersecting);}
else if(this.canvas){this.canvas.sendBackwards(this,intersecting);}
return this;},bringForward:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,intersecting);}
else if(this.canvas){this.canvas.bringForward(this,intersecting);}
return this;},moveTo:function(index){if(this.group&&this.group.type!=='activeSelection'){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,index);}
else if(this.canvas){this.canvas.moveTo(this,index);}
return this;}});(function(){function getSvgColorString(prop,value){if(!value){return prop+': none; ';}
else if(value.toLive){return prop+': url(#SVGID_'+value.id+'); ';}
else{var color=new fabric.Color(value),str=prop+': '+color.toRgb()+'; ',opacity=color.getAlpha();if(opacity!==1){str+=prop+'-opacity: '+opacity.toString()+'; ';}
return str;}}
var toFixed=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(skipShadow){var fillRule=this.fillRule?this.fillRule:'nonzero',strokeWidth=this.strokeWidth?this.strokeWidth:'0',strokeDashArray=this.strokeDashArray?this.strokeDashArray.join(' '):'none',strokeDashOffset=this.strokeDashOffset?this.strokeDashOffset:'0',strokeLineCap=this.strokeLineCap?this.strokeLineCap:'butt',strokeLineJoin=this.strokeLineJoin?this.strokeLineJoin:'miter',strokeMiterLimit=this.strokeMiterLimit?this.strokeMiterLimit:'4',opacity=typeof this.opacity!=='undefined'?this.opacity:'1',visibility=this.visible?'':' visibility: hidden;',filter=skipShadow?'':this.getSvgFilter(),fill=getSvgColorString('fill',this.fill),stroke=getSvgColorString('stroke',this.stroke);return[stroke,'stroke-width: ',strokeWidth,'; ','stroke-dasharray: ',strokeDashArray,'; ','stroke-linecap: ',strokeLineCap,'; ','stroke-dashoffset: ',strokeDashOffset,'; ','stroke-linejoin: ',strokeLineJoin,'; ','stroke-miterlimit: ',strokeMiterLimit,'; ',fill,'fill-rule: ',fillRule,'; ','opacity: ',opacity,';',filter,visibility].join('');},getSvgSpanStyles:function(style,useWhiteSpace){var term='; ';var fontFamily=style.fontFamily?'font-family: '+(((style.fontFamily.indexOf('\'')===-1&&style.fontFamily.indexOf('"')===-1)?'\''+style.fontFamily+'\'':style.fontFamily))+term:'';var strokeWidth=style.strokeWidth?'stroke-width: '+style.strokeWidth+term:'',fontFamily=fontFamily,fontSize=style.fontSize?'font-size: '+style.fontSize+'px'+term:'',fontStyle=style.fontStyle?'font-style: '+style.fontStyle+term:'',fontWeight=style.fontWeight?'font-weight: '+style.fontWeight+term:'',fill=style.fill?getSvgColorString('fill',style.fill):'',stroke=style.stroke?getSvgColorString('stroke',style.stroke):'',textDecoration=this.getSvgTextDecoration(style),deltaY=style.deltaY?'baseline-shift: '+(-style.deltaY)+'; ':'';if(textDecoration){textDecoration='text-decoration: '+textDecoration+term;}
return[stroke,strokeWidth,fontFamily,fontSize,fontStyle,fontWeight,textDecoration,fill,deltaY,useWhiteSpace?'white-space: pre; ':''].join('');},getSvgTextDecoration:function(style){return['overline','underline','line-through'].filter(function(decoration){return style[decoration.replace('-','')];}).join(' ');},getSvgFilter:function(){return this.shadow?'filter: url(#SVGID_'+this.shadow.id+');':'';},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':'',this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':'',].join('');},getSvgTransform:function(full,additionalTransform){var transform=full?this.calcTransformMatrix():this.calcOwnMatrix(),svgTransform='transform="'+fabric.util.matrixToSVG(transform);return svgTransform+
(additionalTransform||'')+'" ';},_setSVGBg:function(textBgRects){if(this.backgroundColor){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;textBgRects.push('\t\t<rect ',this._getFillAttributes(this.backgroundColor),' x="',toFixed(-this.width/2,NUM_FRACTION_DIGITS),'" y="',toFixed(-this.height/2,NUM_FRACTION_DIGITS),'" width="',toFixed(this.width,NUM_FRACTION_DIGITS),'" height="',toFixed(this.height,NUM_FRACTION_DIGITS),'"></rect>\n');}},toSVG:function(reviver){return this._createBaseSVGMarkup(this._toSVG(reviver),{reviver:reviver});},toClipPathSVG:function(reviver){return'\t'+this._createBaseClipPathSVGMarkup(this._toSVG(reviver),{reviver:reviver});},_createBaseClipPathSVGMarkup:function(objectMarkup,options){options=options||{};var reviver=options.reviver,additionalTransform=options.additionalTransform||'',commonPieces=[this.getSvgTransform(true,additionalTransform),this.getSvgCommons(),].join(''),index=objectMarkup.indexOf('COMMON_PARTS');objectMarkup[index]=commonPieces;return reviver?reviver(objectMarkup.join('')):objectMarkup.join('');},_createBaseSVGMarkup:function(objectMarkup,options){options=options||{};var noStyle=options.noStyle,reviver=options.reviver,styleInfo=noStyle?'':'style="'+this.getSvgStyles()+'" ',shadowInfo=options.withShadow?'style="'+this.getSvgFilter()+'" ':'',clipPath=this.clipPath,vectorEffect=this.strokeUniform?'vector-effect="non-scaling-stroke" ':'',absoluteClipPath=clipPath&&clipPath.absolutePositioned,stroke=this.stroke,fill=this.fill,shadow=this.shadow,commonPieces,markup=[],clipPathMarkup,index=objectMarkup.indexOf('COMMON_PARTS'),additionalTransform=options.additionalTransform;if(clipPath){clipPath.clipPathId='CLIPPATH_'+fabric.Object.__uid++;clipPathMarkup='<clipPath id="'+clipPath.clipPathId+'" >\n'+
clipPath.toClipPathSVG(reviver)+'</clipPath>\n';}
if(absoluteClipPath){markup.push('<g ',shadowInfo,this.getSvgCommons(),' >\n');}
markup.push('<g ',this.getSvgTransform(false),!absoluteClipPath?shadowInfo+this.getSvgCommons():'',' >\n');commonPieces=[styleInfo,vectorEffect,noStyle?'':this.addPaintOrder(),' ',additionalTransform?'transform="'+additionalTransform+'" ':'',].join('');objectMarkup[index]=commonPieces;if(fill&&fill.toLive){markup.push(fill.toSVG(this));}
if(stroke&&stroke.toLive){markup.push(stroke.toSVG(this));}
if(shadow){markup.push(shadow.toSVG(this));}
if(clipPath){markup.push(clipPathMarkup);}
markup.push(objectMarkup.join(''));markup.push('</g>\n');absoluteClipPath&&markup.push('</g>\n');return reviver?reviver(markup.join('')):markup.join('');},addPaintOrder:function(){return this.paintFirst!=='fill'?' paint-order="'+this.paintFirst+'" ':'';}});})();(function(){var extend=fabric.util.object.extend,originalSet='stateProperties';function saveProps(origin,destination,props){var tmpObj={},deep=true;props.forEach(function(prop){tmpObj[prop]=origin[prop];});extend(origin[destination],tmpObj,deep);}
function _isEqual(origValue,currentValue,firstPass){if(origValue===currentValue){return true;}
else if(Array.isArray(origValue)){if(!Array.isArray(currentValue)||origValue.length!==currentValue.length){return false;}
for(var i=0,len=origValue.length;i<len;i++){if(!_isEqual(origValue[i],currentValue[i])){return false;}}
return true;}
else if(origValue&&typeof origValue==='object'){var keys=Object.keys(origValue),key;if(!currentValue||typeof currentValue!=='object'||(!firstPass&&keys.length!==Object.keys(currentValue).length)){return false;}
for(var i=0,len=keys.length;i<len;i++){key=keys[i];if(key==='canvas'||key==='group'){continue;}
if(!_isEqual(origValue[key],currentValue[key])){return false;}}
return true;}}
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(propertySet){propertySet=propertySet||originalSet;var dashedPropertySet='_'+propertySet;if(Object.keys(this[dashedPropertySet]).length<this[propertySet].length){return true;}
return!_isEqual(this[dashedPropertySet],this,true);},saveState:function(options){var propertySet=options&&options.propertySet||originalSet,destination='_'+propertySet;if(!this[destination]){return this.setupState(options);}
saveProps(this,destination,this[propertySet]);if(options&&options.stateProperties){saveProps(this,destination,options.stateProperties);}
return this;},setupState:function(options){options=options||{};var propertySet=options.propertySet||originalSet;options.propertySet=propertySet;this['_'+propertySet]={};this.saveState(options);return this;}});})();(function(){var degreesToRadians=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(pointer,forTouch){if(!this.hasControls||this.group||(!this.canvas||this.canvas._activeObject!==this)){return false;}
var ex=pointer.x,ey=pointer.y,xPoints,lines,keys=Object.keys(this.oCoords),j=keys.length-1,i;this.__corner=0;for(;j>=0;j--){i=keys[j];if(!this.isControlVisible(i)){continue;}
lines=this._getImageLines(forTouch?this.oCoords[i].touchCorner:this.oCoords[i].corner);xPoints=this._findCrossPoints({x:ex,y:ey},lines);if(xPoints!==0&&xPoints%2===1){this.__corner=i;return i;}}
return false;},forEachControl:function(fn){for(var i in this.controls){fn(this.controls[i],i,this);};},_setCornerCoords:function(){var coords=this.oCoords;for(var control in coords){var controlObject=this.controls[control];coords[control].corner=controlObject.calcCornerCoords(this.angle,this.cornerSize,coords[control].x,coords[control].y,false);coords[control].touchCorner=controlObject.calcCornerCoords(this.angle,this.touchCornerSize,coords[control].x,coords[control].y,true);}},drawSelectionBackground:function(ctx){if(!this.selectionBackgroundColor||(this.canvas&&!this.canvas.interactive)||(this.canvas&&this.canvas._activeObject!==this)){return this;}
ctx.save();var center=this.getCenterPoint(),wh=this._calculateCurrentDimensions(),vpt=this.canvas.viewportTransform;ctx.translate(center.x,center.y);ctx.scale(1/vpt[0],1/vpt[3]);ctx.rotate(degreesToRadians(this.angle));ctx.fillStyle=this.selectionBackgroundColor;ctx.fillRect(-wh.x/2,-wh.y/2,wh.x,wh.y);ctx.restore();return this;},drawBorders:function(ctx,styleOverride){styleOverride=styleOverride||{};var wh=this._calculateCurrentDimensions(),strokeWidth=this.borderScaleFactor,width=wh.x+strokeWidth,height=wh.y+strokeWidth,hasControls=typeof styleOverride.hasControls!=='undefined'?styleOverride.hasControls:this.hasControls,shouldStroke=false;ctx.save();ctx.strokeStyle=styleOverride.borderColor||this.borderColor;this._setLineDash(ctx,styleOverride.borderDashArray||this.borderDashArray);ctx.strokeRect(-width/2,-height/2,width,height);if(hasControls){ctx.beginPath();this.forEachControl(function(control,key,fabricObject){if(control.withConnection&&control.getVisibility(fabricObject,key)){shouldStroke=true;ctx.moveTo(control.x*width,control.y*height);ctx.lineTo(control.x*width+control.offsetX,control.y*height+control.offsetY);}});if(shouldStroke){ctx.stroke();}}
ctx.restore();return this;},drawBordersInGroup:function(ctx,options,styleOverride){styleOverride=styleOverride||{};var bbox=fabric.util.sizeAfterTransform(this.width,this.height,options),strokeWidth=this.strokeWidth,strokeUniform=this.strokeUniform,borderScaleFactor=this.borderScaleFactor,width=bbox.x+strokeWidth*(strokeUniform?this.canvas.getZoom():options.scaleX)+borderScaleFactor,height=bbox.y+strokeWidth*(strokeUniform?this.canvas.getZoom():options.scaleY)+borderScaleFactor;ctx.save();this._setLineDash(ctx,styleOverride.borderDashArray||this.borderDashArray);ctx.strokeStyle=styleOverride.borderColor||this.borderColor;ctx.strokeRect(-width/2,-height/2,width,height);ctx.restore();return this;},drawControls:function(ctx,styleOverride){styleOverride=styleOverride||{};ctx.save();var retinaScaling=this.canvas.getRetinaScaling(),matrix,p;ctx.setTransform(retinaScaling,0,0,retinaScaling,0,0);ctx.strokeStyle=ctx.fillStyle=styleOverride.cornerColor||this.cornerColor;if(!this.transparentCorners){ctx.strokeStyle=styleOverride.cornerStrokeColor||this.cornerStrokeColor;}
this._setLineDash(ctx,styleOverride.cornerDashArray||this.cornerDashArray);this.setCoords();if(this.group){matrix=this.group.calcTransformMatrix();}
this.forEachControl(function(control,key,fabricObject){p=fabricObject.oCoords[key];if(control.getVisibility(fabricObject,key)){if(matrix){p=fabric.util.transformPoint(p,matrix);}
control.render(ctx,p.x,p.y,styleOverride,fabricObject);}});ctx.restore();return this;},isControlVisible:function(controlKey){return this.controls[controlKey]&&this.controls[controlKey].getVisibility(this,controlKey);},setControlVisible:function(controlKey,visible){if(!this._controlsVisibility){this._controlsVisibility={};}
this._controlsVisibility[controlKey]=visible;return this;},setControlsVisibility:function(options){options||(options={});for(var p in options){this.setControlVisible(p,options[p]);}
return this;},onDeselect:function(){},onSelect:function(){}});})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({target:this,startValue:object.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(value){object.set('left',value);_this.requestRenderAll();onChange();},onComplete:function(){object.setCoords();onComplete();}});},fxCenterObjectV:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({target:this,startValue:object.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(value){object.set('top',value);_this.requestRenderAll();onChange();},onComplete:function(){object.setCoords();onComplete();}});},fxRemove:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({target:this,startValue:object.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(value){object.set('opacity',value);_this.requestRenderAll();onChange();},onComplete:function(){_this.remove(object);onComplete();}});}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==='object'){var propsToAnimate=[],prop,skipCallbacks,out=[];for(prop in arguments[0]){propsToAnimate.push(prop);}
for(var i=0,len=propsToAnimate.length;i<len;i++){prop=propsToAnimate[i];skipCallbacks=i!==len-1;out.push(this._animate(prop,arguments[0][prop],arguments[1],skipCallbacks));}
return out;}
else{return this._animate.apply(this,arguments);}},_animate:function(property,to,options,skipCallbacks){var _this=this,propPair;to=to.toString();if(!options){options={};}
else{options=fabric.util.object.clone(options);}
if(~property.indexOf('.')){propPair=property.split('.');}
var propIsColor=_this.colorProperties.indexOf(property)>-1||(propPair&&_this.colorProperties.indexOf(propPair[1])>-1);var currentValue=propPair?this.get(propPair[0])[propPair[1]]:this.get(property);if(!('from'in options)){options.from=currentValue;}
if(!propIsColor){if(~to.indexOf('=')){to=currentValue+parseFloat(to.replace('=',''));}
else{to=parseFloat(to);}}
var _options={target:this,startValue:options.from,endValue:to,byValue:options.by,easing:options.easing,duration:options.duration,abort:options.abort&&function(value,valueProgress,timeProgress){return options.abort.call(_this,value,valueProgress,timeProgress);},onChange:function(value,valueProgress,timeProgress){if(propPair){_this[propPair[0]][propPair[1]]=value;}
else{_this.set(property,value);}
if(skipCallbacks){return;}
options.onChange&&options.onChange(value,valueProgress,timeProgress);},onComplete:function(value,valueProgress,timeProgress){if(skipCallbacks){return;}
_this.setCoords();options.onComplete&&options.onComplete(value,valueProgress,timeProgress);}};if(propIsColor){return fabric.util.animateColor(_options.startValue,_options.endValue,_options.duration,_options);}
else{return fabric.util.animate(_options);}}});(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,coordProps={x1:1,x2:1,y1:1,y2:1};if(fabric.Line){fabric.warn('fabric.Line is already defined');return;}
fabric.Line=fabric.util.createClass(fabric.Object,{type:'line',x1:0,y1:0,x2:0,y2:0,cacheProperties:fabric.Object.prototype.cacheProperties.concat('x1','x2','y1','y2'),initialize:function(points,options){if(!points){points=[0,0,0,0];}
this.callSuper('initialize',options);this.set('x1',points[0]);this.set('y1',points[1]);this.set('x2',points[2]);this.set('y2',points[3]);this._setWidthHeight(options);},_setWidthHeight:function(options){options||(options={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left='left'in options?options.left:this._getLeftToOriginX();this.top='top'in options?options.top:this._getTopToOriginY();},_set:function(key,value){this.callSuper('_set',key,value);if(typeof coordProps[key]!=='undefined'){this._setWidthHeight();}
return this;},_getLeftToOriginX:makeEdgeToOriginGetter({origin:'originX',axis1:'x1',axis2:'x2',dimension:'width'},{nearest:'left',center:'center',farthest:'right'}),_getTopToOriginY:makeEdgeToOriginGetter({origin:'originY',axis1:'y1',axis2:'y2',dimension:'height'},{nearest:'top',center:'center',farthest:'bottom'}),_render:function(ctx){ctx.beginPath();var p=this.calcLinePoints();ctx.moveTo(p.x1,p.y1);ctx.lineTo(p.x2,p.y2);ctx.lineWidth=this.strokeWidth;var origStrokeStyle=ctx.strokeStyle;ctx.strokeStyle=this.stroke||ctx.fillStyle;this.stroke&&this._renderStroke(ctx);ctx.strokeStyle=origStrokeStyle;},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2,};},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),this.calcLinePoints());},_getNonTransformedDimensions:function(){var dim=this.callSuper('_getNonTransformedDimensions');if(this.strokeLineCap==='butt'){if(this.width===0){dim.y-=this.strokeWidth;}
if(this.height===0){dim.x-=this.strokeWidth;}}
return dim;},calcLinePoints:function(){var xMult=this.x1<=this.x2?-1:1,yMult=this.y1<=this.y2?-1:1,x1=(xMult*this.width*0.5),y1=(yMult*this.height*0.5),x2=(xMult*this.width*-0.5),y2=(yMult*this.height*-0.5);return{x1:x1,x2:x2,y1:y1,y2:y2};},_toSVG:function(){var p=this.calcLinePoints();return['<line ','COMMON_PARTS','x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,'" />\n'];},});fabric.Line.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));fabric.Line.fromElement=function(element,callback,options){options=options||{};var parsedAttributes=fabric.parseAttributes(element,fabric.Line.ATTRIBUTE_NAMES),points=[parsedAttributes.x1||0,parsedAttributes.y1||0,parsedAttributes.x2||0,parsedAttributes.y2||0];callback(new fabric.Line(points,extend(parsedAttributes,options)));};fabric.Line.fromObject=function(object,callback){function _callback(instance){delete instance.points;callback&&callback(instance);};var options=clone(object,true);options.points=[object.x1,object.y1,object.x2,object.y2];fabric.Object._fromObject('Line',options,_callback,'points');};function makeEdgeToOriginGetter(propertyNames,originValues){var origin=propertyNames.origin,axis1=propertyNames.axis1,axis2=propertyNames.axis2,dimension=propertyNames.dimension,nearest=originValues.nearest,center=originValues.center,farthest=originValues.farthest;return function(){switch(this.get(origin)){case nearest:return Math.min(this.get(axis1),this.get(axis2));case center:return Math.min(this.get(axis1),this.get(axis2))+(0.5*this.get(dimension));case farthest:return Math.max(this.get(axis1),this.get(axis2));}};}})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),degreesToRadians=fabric.util.degreesToRadians;if(fabric.Circle){fabric.warn('fabric.Circle is already defined.');return;}
fabric.Circle=fabric.util.createClass(fabric.Object,{type:'circle',radius:0,startAngle:0,endAngle:360,cacheProperties:fabric.Object.prototype.cacheProperties.concat('radius','startAngle','endAngle'),_set:function(key,value){this.callSuper('_set',key,value);if(key==='radius'){this.setRadius(value);}
return this;},toObject:function(propertiesToInclude){return this.callSuper('toObject',['radius','startAngle','endAngle'].concat(propertiesToInclude));},_toSVG:function(){var svgString,x=0,y=0,angle=(this.endAngle-this.startAngle)%360;if(angle===0){svgString=['<circle ','COMMON_PARTS','cx="'+x+'" cy="'+y+'" ','r="',this.radius,'" />\n'];}
else{var start=degreesToRadians(this.startAngle),end=degreesToRadians(this.endAngle),radius=this.radius,startX=fabric.util.cos(start)*radius,startY=fabric.util.sin(start)*radius,endX=fabric.util.cos(end)*radius,endY=fabric.util.sin(end)*radius,largeFlag=angle>180?'1':'0';svgString=['<path d="M '+startX+' '+startY,' A '+radius+' '+radius,' 0 ',+largeFlag+' 1',' '+endX+' '+endY,'" ','COMMON_PARTS',' />\n'];}
return svgString;},_render:function(ctx){ctx.beginPath();ctx.arc(0,0,this.radius,degreesToRadians(this.startAngle),degreesToRadians(this.endAngle),false);this._renderPaintInOrder(ctx);},getRadiusX:function(){return this.get('radius')*this.get('scaleX');},getRadiusY:function(){return this.get('radius')*this.get('scaleY');},setRadius:function(value){this.radius=value;return this.set('width',value*2).set('height',value*2);},});fabric.Circle.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));fabric.Circle.fromElement=function(element,callback){var parsedAttributes=fabric.parseAttributes(element,fabric.Circle.ATTRIBUTE_NAMES);if(!isValidRadius(parsedAttributes)){throw new Error('value of `r` attribute is required and can not be negative');}
parsedAttributes.left=(parsedAttributes.left||0)-parsedAttributes.radius;parsedAttributes.top=(parsedAttributes.top||0)-parsedAttributes.radius;callback(new fabric.Circle(parsedAttributes));};function isValidRadius(attributes){return(('radius'in attributes)&&(attributes.radius>=0));}
fabric.Circle.fromObject=function(object,callback){fabric.Object._fromObject('Circle',object,callback);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Triangle){fabric.warn('fabric.Triangle is already defined');return;}
fabric.Triangle=fabric.util.createClass(fabric.Object,{type:'triangle',width:100,height:100,_render:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath();ctx.moveTo(-widthBy2,heightBy2);ctx.lineTo(0,-heightBy2);ctx.lineTo(widthBy2,heightBy2);ctx.closePath();this._renderPaintInOrder(ctx);},_toSVG:function(){var widthBy2=this.width/2,heightBy2=this.height/2,points=[-widthBy2+' '+heightBy2,'0 '+-heightBy2,widthBy2+' '+heightBy2].join(',');return['<polygon ','COMMON_PARTS','points="',points,'" />'];},});fabric.Triangle.fromObject=function(object,callback){return fabric.Object._fromObject('Triangle',object,callback);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),piBy2=Math.PI*2;if(fabric.Ellipse){fabric.warn('fabric.Ellipse is already defined.');return;}
fabric.Ellipse=fabric.util.createClass(fabric.Object,{type:'ellipse',rx:0,ry:0,cacheProperties:fabric.Object.prototype.cacheProperties.concat('rx','ry'),initialize:function(options){this.callSuper('initialize',options);this.set('rx',options&&options.rx||0);this.set('ry',options&&options.ry||0);},_set:function(key,value){this.callSuper('_set',key,value);switch(key){case'rx':this.rx=value;this.set('width',value*2);break;case'ry':this.ry=value;this.set('height',value*2);break;}
return this;},getRx:function(){return this.get('rx')*this.get('scaleX');},getRy:function(){return this.get('ry')*this.get('scaleY');},toObject:function(propertiesToInclude){return this.callSuper('toObject',['rx','ry'].concat(propertiesToInclude));},_toSVG:function(){return['<ellipse ','COMMON_PARTS','cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n'];},_render:function(ctx){ctx.beginPath();ctx.save();ctx.transform(1,0,0,this.ry/this.rx,0,0);ctx.arc(0,0,this.rx,0,piBy2,false);ctx.restore();this._renderPaintInOrder(ctx);},});fabric.Ellipse.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));fabric.Ellipse.fromElement=function(element,callback){var parsedAttributes=fabric.parseAttributes(element,fabric.Ellipse.ATTRIBUTE_NAMES);parsedAttributes.left=(parsedAttributes.left||0)-parsedAttributes.rx;parsedAttributes.top=(parsedAttributes.top||0)-parsedAttributes.ry;callback(new fabric.Ellipse(parsedAttributes));};fabric.Ellipse.fromObject=function(object,callback){fabric.Object._fromObject('Ellipse',object,callback);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;if(fabric.Rect){fabric.warn('fabric.Rect is already defined');return;}
fabric.Rect=fabric.util.createClass(fabric.Object,{stateProperties:fabric.Object.prototype.stateProperties.concat('rx','ry'),type:'rect',rx:0,ry:0,cacheProperties:fabric.Object.prototype.cacheProperties.concat('rx','ry'),initialize:function(options){this.callSuper('initialize',options);this._initRxRy();},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx;}
else if(this.ry&&!this.rx){this.rx=this.ry;}},_render:function(ctx){var rx=this.rx?Math.min(this.rx,this.width/2):0,ry=this.ry?Math.min(this.ry,this.height/2):0,w=this.width,h=this.height,x=-this.width/2,y=-this.height/2,isRounded=rx!==0||ry!==0,k=1-0.5522847498;ctx.beginPath();ctx.moveTo(x+rx,y);ctx.lineTo(x+w-rx,y);isRounded&&ctx.bezierCurveTo(x+w-k*rx,y,x+w,y+k*ry,x+w,y+ry);ctx.lineTo(x+w,y+h-ry);isRounded&&ctx.bezierCurveTo(x+w,y+h-k*ry,x+w-k*rx,y+h,x+w-rx,y+h);ctx.lineTo(x+rx,y+h);isRounded&&ctx.bezierCurveTo(x+k*rx,y+h,x,y+h-k*ry,x,y+h-ry);ctx.lineTo(x,y+ry);isRounded&&ctx.bezierCurveTo(x,y+k*ry,x+k*rx,y,x+rx,y);ctx.closePath();this._renderPaintInOrder(ctx);},toObject:function(propertiesToInclude){return this.callSuper('toObject',['rx','ry'].concat(propertiesToInclude));},_toSVG:function(){var x=-this.width/2,y=-this.height/2;return['<rect ','COMMON_PARTS','x="',x,'" y="',y,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n'];},});fabric.Rect.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));fabric.Rect.fromElement=function(element,callback,options){if(!element){return callback(null);}
options=options||{};var parsedAttributes=fabric.parseAttributes(element,fabric.Rect.ATTRIBUTE_NAMES);parsedAttributes.left=parsedAttributes.left||0;parsedAttributes.top=parsedAttributes.top||0;parsedAttributes.height=parsedAttributes.height||0;parsedAttributes.width=parsedAttributes.width||0;var rect=new fabric.Rect(extend((options?fabric.util.object.clone(options):{}),parsedAttributes));rect.visible=rect.visible&&rect.width>0&&rect.height>0;callback(rect);};fabric.Rect.fromObject=function(object,callback){return fabric.Object._fromObject('Rect',object,callback);};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,toFixed=fabric.util.toFixed,projectStrokeOnPoints=fabric.util.projectStrokeOnPoints;if(fabric.Polyline){fabric.warn('fabric.Polyline is already defined');return;}
fabric.Polyline=fabric.util.createClass(fabric.Object,{type:'polyline',points:null,exactBoundingBox:false,cacheProperties:fabric.Object.prototype.cacheProperties.concat('points'),initialize:function(points,options){options=options||{};this.points=points||[];this.callSuper('initialize',options);this._setPositionDimensions(options);},_projectStrokeOnPoints:function(){return projectStrokeOnPoints(this.points,this,true);},_setPositionDimensions:function(options){var calcDim=this._calcDimensions(options),correctLeftTop,correctSize=this.exactBoundingBox?this.strokeWidth:0;this.width=calcDim.width-correctSize;this.height=calcDim.height-correctSize;if(!options.fromSVG){correctLeftTop=this.translateToGivenOrigin({x:calcDim.left-this.strokeWidth/2+correctSize/2,y:calcDim.top-this.strokeWidth/2+correctSize/2},'left','top',this.originX,this.originY);}
if(typeof options.left==='undefined'){this.left=options.fromSVG?calcDim.left:correctLeftTop.x;}
if(typeof options.top==='undefined'){this.top=options.fromSVG?calcDim.top:correctLeftTop.y;}
this.pathOffset={x:calcDim.left+this.width/2+correctSize/2,y:calcDim.top+this.height/2+correctSize/2};},_calcDimensions:function(){var points=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,minX=min(points,'x')||0,minY=min(points,'y')||0,maxX=max(points,'x')||0,maxY=max(points,'y')||0,width=(maxX-minX),height=(maxY-minY);return{left:minX,top:minY,width:width,height:height,};},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),{points:this.points.concat()});},_toSVG:function(){var points=[],diffX=this.pathOffset.x,diffY=this.pathOffset.y,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;for(var i=0,len=this.points.length;i<len;i++){points.push(toFixed(this.points[i].x-diffX,NUM_FRACTION_DIGITS),',',toFixed(this.points[i].y-diffY,NUM_FRACTION_DIGITS),' ');}
return['<'+this.type+' ','COMMON_PARTS','points="',points.join(''),'" />\n'];},commonRender:function(ctx){var point,len=this.points.length,x=this.pathOffset.x,y=this.pathOffset.y;if(!len||isNaN(this.points[len-1].y)){return false;}
ctx.beginPath();ctx.moveTo(this.points[0].x-x,this.points[0].y-y);for(var i=0;i<len;i++){point=this.points[i];ctx.lineTo(point.x-x,point.y-y);}
return true;},_render:function(ctx){if(!this.commonRender(ctx)){return;}
this._renderPaintInOrder(ctx);},complexity:function(){return this.get('points').length;}});fabric.Polyline.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();fabric.Polyline.fromElementGenerator=function(_class){return function(element,callback,options){if(!element){return callback(null);}
options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute('points')),parsedAttributes=fabric.parseAttributes(element,fabric[_class].ATTRIBUTE_NAMES);parsedAttributes.fromSVG=true;callback(new fabric[_class](points,extend(parsedAttributes,options)));};};fabric.Polyline.fromElement=fabric.Polyline.fromElementGenerator('Polyline');fabric.Polyline.fromObject=function(object,callback){return fabric.Object._fromObject('Polyline',object,callback,'points');};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),projectStrokeOnPoints=fabric.util.projectStrokeOnPoints;if(fabric.Polygon){fabric.warn('fabric.Polygon is already defined');return;}
fabric.Polygon=fabric.util.createClass(fabric.Polyline,{type:'polygon',_projectStrokeOnPoints:function(){return projectStrokeOnPoints(this.points,this);},_render:function(ctx){if(!this.commonRender(ctx)){return;}
ctx.closePath();this._renderPaintInOrder(ctx);},});fabric.Polygon.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();fabric.Polygon.fromElement=fabric.Polyline.fromElementGenerator('Polygon');fabric.Polygon.fromObject=function(object,callback){fabric.Object._fromObject('Polygon',object,callback,'points');};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max,extend=fabric.util.object.extend,clone=fabric.util.object.clone,_toString=Object.prototype.toString,toFixed=fabric.util.toFixed;if(fabric.Path){fabric.warn('fabric.Path is already defined');return;}
fabric.Path=fabric.util.createClass(fabric.Object,{type:'path',path:null,cacheProperties:fabric.Object.prototype.cacheProperties.concat('path','fillRule'),stateProperties:fabric.Object.prototype.stateProperties.concat('path'),initialize:function(path,options){options=clone(options||{});delete options.path;this.callSuper('initialize',options);this._setPath(path||[],options);},_setPath:function(path,options){var fromArray=_toString.call(path)==='[object Array]';this.path=fabric.util.makePathSimpler(fromArray?path:fabric.util.parsePath(path));fabric.Polyline.prototype._setPositionDimensions.call(this,options||{});},_renderPathCommands:function(ctx){var current,subpathStartX=0,subpathStartY=0,x=0,y=0,controlX=0,controlY=0,l=-this.pathOffset.x,t=-this.pathOffset.y;ctx.beginPath();for(var i=0,len=this.path.length;i<len;++i){current=this.path[i];switch(current[0]){case'L':x=current[1];y=current[2];ctx.lineTo(x+l,y+t);break;case'M':x=current[1];y=current[2];subpathStartX=x;subpathStartY=y;ctx.moveTo(x+l,y+t);break;case'C':x=current[5];y=current[6];controlX=current[3];controlY=current[4];ctx.bezierCurveTo(current[1]+l,current[2]+t,controlX+l,controlY+t,x+l,y+t);break;case'Q':ctx.quadraticCurveTo(current[1]+l,current[2]+t,current[3]+l,current[4]+t);x=current[3];y=current[4];controlX=current[1];controlY=current[2];break;case'z':case'Z':x=subpathStartX;y=subpathStartY;ctx.closePath();break;}}},_render:function(ctx){this._renderPathCommands(ctx);this._renderPaintInOrder(ctx);},toString:function(){return'#<fabric.Path ('+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+' }>';},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),{path:this.path.map(function(item){return item.slice();}),});},toDatalessObject:function(propertiesToInclude){var o=this.toObject(['sourcePath'].concat(propertiesToInclude));if(o.sourcePath){delete o.path;}
return o;},_toSVG:function(){var path=fabric.util.joinPath(this.path);return['<path ','COMMON_PARTS','d="',path,'" stroke-linecap="round" ','/>\n'];},_getOffsetTransform:function(){var digits=fabric.Object.NUM_FRACTION_DIGITS;return' translate('+toFixed(-this.pathOffset.x,digits)+', '+
toFixed(-this.pathOffset.y,digits)+')';},toClipPathSVG:function(reviver){var additionalTransform=this._getOffsetTransform();return'\t'+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:reviver,additionalTransform:additionalTransform});},toSVG:function(reviver){var additionalTransform=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:reviver,additionalTransform:additionalTransform});},complexity:function(){return this.path.length;},_calcDimensions:function(){var aX=[],aY=[],current,subpathStartX=0,subpathStartY=0,x=0,y=0,bounds;for(var i=0,len=this.path.length;i<len;++i){current=this.path[i];switch(current[0]){case'L':x=current[1];y=current[2];bounds=[];break;case'M':x=current[1];y=current[2];subpathStartX=x;subpathStartY=y;bounds=[];break;case'C':bounds=fabric.util.getBoundsOfCurve(x,y,current[1],current[2],current[3],current[4],current[5],current[6]);x=current[5];y=current[6];break;case'Q':bounds=fabric.util.getBoundsOfCurve(x,y,current[1],current[2],current[1],current[2],current[3],current[4]);x=current[3];y=current[4];break;case'z':case'Z':x=subpathStartX;y=subpathStartY;break;}
bounds.forEach(function(point){aX.push(point.x);aY.push(point.y);});aX.push(x);aY.push(y);}
var minX=min(aX)||0,minY=min(aY)||0,maxX=max(aX)||0,maxY=max(aY)||0,deltaX=maxX-minX,deltaY=maxY-minY;return{left:minX,top:minY,width:deltaX,height:deltaY};}});fabric.Path.fromObject=function(object,callback){if(typeof object.sourcePath==='string'){var pathUrl=object.sourcePath;fabric.loadSVGFromURL(pathUrl,function(elements){var path=elements[0];path.setOptions(object);callback&&callback(path);});}
else{fabric.Object._fromObject('Path',object,callback,'path');}};fabric.Path.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(['d']);fabric.Path.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Path.ATTRIBUTE_NAMES);parsedAttributes.fromSVG=true;callback(new fabric.Path(parsedAttributes.d,extend(parsedAttributes,options)));};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max;if(fabric.Group){return;}
fabric.Group=fabric.util.createClass(fabric.Object,fabric.Collection,{type:'group',strokeWidth:0,subTargetCheck:false,cacheProperties:[],useSetOnGroup:false,initialize:function(objects,options,isAlreadyGrouped){options=options||{};this._objects=[];isAlreadyGrouped&&this.callSuper('initialize',options);this._objects=objects||[];for(var i=this._objects.length;i--;){this._objects[i].group=this;}
if(!isAlreadyGrouped){var center=options&&options.centerPoint;if(options.originX!==undefined){this.originX=options.originX;}
if(options.originY!==undefined){this.originY=options.originY;}
center||this._calcBounds();this._updateObjectsCoords(center);delete options.centerPoint;this.callSuper('initialize',options);}
else{this._updateObjectsACoords();}
this.setCoords();},_updateObjectsACoords:function(){var skipControls=true;for(var i=this._objects.length;i--;){this._objects[i].setCoords(skipControls);}},_updateObjectsCoords:function(center){var center=center||this.getCenterPoint();for(var i=this._objects.length;i--;){this._updateObjectCoords(this._objects[i],center);}},_updateObjectCoords:function(object,center){var objectLeft=object.left,objectTop=object.top,skipControls=true;object.set({left:objectLeft-center.x,top:objectTop-center.y});object.group=this;object.setCoords(skipControls);},toString:function(){return'#<fabric.Group: ('+this.complexity()+')>';},addWithUpdate:function(object){var nested=!!this.group;this._restoreObjectsState();fabric.util.resetObjectTransform(this);if(object){if(nested){fabric.util.removeTransformFromObject(object,this.group.calcTransformMatrix());}
this._objects.push(object);object.group=this;object._set('canvas',this.canvas);}
this._calcBounds();this._updateObjectsCoords();this.dirty=true;if(nested){this.group.addWithUpdate();}
else{this.setCoords();}
return this;},removeWithUpdate:function(object){this._restoreObjectsState();fabric.util.resetObjectTransform(this);this.remove(object);this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=true;return this;},_onObjectAdded:function(object){this.dirty=true;object.group=this;object._set('canvas',this.canvas);},_onObjectRemoved:function(object){this.dirty=true;delete object.group;},_set:function(key,value){var i=this._objects.length;if(this.useSetOnGroup){while(i--){this._objects[i].setOnGroup(key,value);}}
if(key==='canvas'){while(i--){this._objects[i]._set(key,value);}}
fabric.Object.prototype._set.call(this,key,value);},toObject:function(propertiesToInclude){var _includeDefaultValues=this.includeDefaultValues;var objsToObject=this._objects.filter(function(obj){return!obj.excludeFromExport;}).map(function(obj){var originalDefaults=obj.includeDefaultValues;obj.includeDefaultValues=_includeDefaultValues;var _obj=obj.toObject(propertiesToInclude);obj.includeDefaultValues=originalDefaults;return _obj;});var obj=fabric.Object.prototype.toObject.call(this,propertiesToInclude);obj.objects=objsToObject;return obj;},toDatalessObject:function(propertiesToInclude){var objsToObject,sourcePath=this.sourcePath;if(sourcePath){objsToObject=sourcePath;}
else{var _includeDefaultValues=this.includeDefaultValues;objsToObject=this._objects.map(function(obj){var originalDefaults=obj.includeDefaultValues;obj.includeDefaultValues=_includeDefaultValues;var _obj=obj.toDatalessObject(propertiesToInclude);obj.includeDefaultValues=originalDefaults;return _obj;});}
var obj=fabric.Object.prototype.toDatalessObject.call(this,propertiesToInclude);obj.objects=objsToObject;return obj;},render:function(ctx){this._transformDone=true;this.callSuper('render',ctx);this._transformDone=false;},shouldCache:function(){var ownCache=fabric.Object.prototype.shouldCache.call(this);if(ownCache){for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i].willDrawShadow()){this.ownCaching=false;return false;}}}
return ownCache;},willDrawShadow:function(){if(fabric.Object.prototype.willDrawShadow.call(this)){return true;}
for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i].willDrawShadow()){return true;}}
return false;},isOnACache:function(){return this.ownCaching||(this.group&&this.group.isOnACache());},drawObject:function(ctx){for(var i=0,len=this._objects.length;i<len;i++){this._objects[i].render(ctx);}
this._drawClipPath(ctx,this.clipPath);},isCacheDirty:function(skipCanvas){if(this.callSuper('isCacheDirty',skipCanvas)){return true;}
if(!this.statefullCache){return false;}
for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i].isCacheDirty(true)){if(this._cacheCanvas){var x=this.cacheWidth/this.zoomX,y=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-x/2,-y/2,x,y);}
return true;}}
return false;},_restoreObjectsState:function(){var groupMatrix=this.calcOwnMatrix();this._objects.forEach(function(object){fabric.util.addTransformToObject(object,groupMatrix);delete object.group;object.setCoords();});return this;},destroy:function(){this._objects.forEach(function(object){object.set('dirty',true);});return this._restoreObjectsState();},dispose:function(){this.callSuper('dispose');this.forEachObject(function(object){object.dispose&&object.dispose();});this._objects=[];},toActiveSelection:function(){if(!this.canvas){return;}
var objects=this._objects,canvas=this.canvas;this._objects=[];var options=this.toObject();delete options.objects;var activeSelection=new fabric.ActiveSelection([]);activeSelection.set(options);activeSelection.type='activeSelection';canvas.remove(this);objects.forEach(function(object){object.group=activeSelection;object.dirty=true;canvas.add(object);});activeSelection.canvas=canvas;activeSelection._objects=objects;canvas._activeObject=activeSelection;activeSelection.setCoords();return activeSelection;},ungroupOnCanvas:function(){return this._restoreObjectsState();},setObjectsCoords:function(){var skipControls=true;this.forEachObject(function(object){object.setCoords(skipControls);});return this;},_calcBounds:function(onlyWidthHeight){var aX=[],aY=[],o,prop,coords,props=['tr','br','bl','tl'],i=0,iLen=this._objects.length,j,jLen=props.length;for(;i<iLen;++i){o=this._objects[i];coords=o.calcACoords();for(j=0;j<jLen;j++){prop=props[j];aX.push(coords[prop].x);aY.push(coords[prop].y);}
o.aCoords=coords;}
this._getBounds(aX,aY,onlyWidthHeight);},_getBounds:function(aX,aY,onlyWidthHeight){var minXY=new fabric.Point(min(aX),min(aY)),maxXY=new fabric.Point(max(aX),max(aY)),top=minXY.y||0,left=minXY.x||0,width=(maxXY.x-minXY.x)||0,height=(maxXY.y-minXY.y)||0;this.width=width;this.height=height;if(!onlyWidthHeight){this.setPositionByOrigin({x:left,y:top},'left','top');}},_toSVG:function(reviver){var svgString=['<g ','COMMON_PARTS',' >\n'];for(var i=0,len=this._objects.length;i<len;i++){svgString.push('\t\t',this._objects[i].toSVG(reviver));}
svgString.push('</g>\n');return svgString;},getSvgStyles:function(){var opacity=typeof this.opacity!=='undefined'&&this.opacity!==1?'opacity: '+this.opacity+';':'',visibility=this.visible?'':' visibility: hidden;';return[opacity,this.getSvgFilter(),visibility].join('');},toClipPathSVG:function(reviver){var svgString=[];for(var i=0,len=this._objects.length;i<len;i++){svgString.push('\t',this._objects[i].toClipPathSVG(reviver));}
return this._createBaseClipPathSVGMarkup(svgString,{reviver:reviver});},});fabric.Group.fromObject=function(object,callback){var objects=object.objects,options=fabric.util.object.clone(object,true);delete options.objects;if(typeof objects==='string'){fabric.loadSVGFromURL(objects,function(elements){var group=fabric.util.groupSVGElements(elements,object,objects);group.set(options);callback&&callback(group);});return;}
fabric.util.enlivenObjects(objects,function(enlivenedObjects){var options=fabric.util.object.clone(object,true);delete options.objects;fabric.util.enlivenObjectEnlivables(object,options,function(){callback&&callback(new fabric.Group(enlivenedObjects,options,true));});});};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.ActiveSelection){return;}
fabric.ActiveSelection=fabric.util.createClass(fabric.Group,{type:'activeSelection',initialize:function(objects,options){options=options||{};this._objects=objects||[];for(var i=this._objects.length;i--;){this._objects[i].group=this;}
if(options.originX){this.originX=options.originX;}
if(options.originY){this.originY=options.originY;}
this._calcBounds();this._updateObjectsCoords();fabric.Object.prototype.initialize.call(this,options);this.setCoords();},toGroup:function(){var objects=this._objects.concat();this._objects=[];var options=fabric.Object.prototype.toObject.call(this);var newGroup=new fabric.Group([]);delete options.type;newGroup.set(options);objects.forEach(function(object){object.canvas.remove(object);object.group=newGroup;});newGroup._objects=objects;if(!this.canvas){return newGroup;}
var canvas=this.canvas;canvas.add(newGroup);canvas._activeObject=newGroup;newGroup.setCoords();return newGroup;},onDeselect:function(){this.destroy();return false;},toString:function(){return'#<fabric.ActiveSelection: ('+this.complexity()+')>';},shouldCache:function(){return false;},isOnACache:function(){return false;},_renderControls:function(ctx,styleOverride,childrenOverride){ctx.save();ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;this.callSuper('_renderControls',ctx,styleOverride);childrenOverride=childrenOverride||{};if(typeof childrenOverride.hasControls==='undefined'){childrenOverride.hasControls=false;}
childrenOverride.forActiveSelection=true;for(var i=0,len=this._objects.length;i<len;i++){this._objects[i]._renderControls(ctx,childrenOverride);}
ctx.restore();},});fabric.ActiveSelection.fromObject=function(object,callback){fabric.util.enlivenObjects(object.objects,function(enlivenedObjects){delete object.objects;callback&&callback(new fabric.ActiveSelection(enlivenedObjects,object,true));});};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var extend=fabric.util.object.extend;if(!global.fabric){global.fabric={};}
if(global.fabric.Image){fabric.warn('fabric.Image is already defined.');return;}
fabric.Image=fabric.util.createClass(fabric.Object,{type:'image',strokeWidth:0,srcFromAttribute:false,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:0.5,stateProperties:fabric.Object.prototype.stateProperties.concat('cropX','cropY'),cacheProperties:fabric.Object.prototype.cacheProperties.concat('cropX','cropY'),cacheKey:'',cropX:0,cropY:0,imageSmoothing:true,initialize:function(element,options){options||(options={});this.filters=[];this.cacheKey='texture'+fabric.Object.__uid++;this.callSuper('initialize',options);this._initElement(element,options);},getElement:function(){return this._element||{};},setElement:function(element,options){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+'_filtered');this._element=element;this._originalElement=element;this._initConfig(options);if(this.filters.length!==0){this.applyFilters();}
if(this.resizeFilter){this.applyResizeFilters();}
return this;},removeTexture:function(key){var backend=fabric.filterBackend;if(backend&&backend.evictCachesForKey){backend.evictCachesForKey(key);}},dispose:function(){this.callSuper('dispose');this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+'_filtered');this._cacheContext=undefined;['_originalElement','_element','_filteredEl','_cacheCanvas'].forEach((function(element){fabric.util.cleanUpJsdomNode(this[element]);this[element]=undefined;}).bind(this));},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null);},getOriginalSize:function(){var element=this.getElement();return{width:element.naturalWidth||element.width,height:element.naturalHeight||element.height};},_stroke:function(ctx){if(!this.stroke||this.strokeWidth===0){return;}
var w=this.width/2,h=this.height/2;ctx.beginPath();ctx.moveTo(-w,-h);ctx.lineTo(w,-h);ctx.lineTo(w,h);ctx.lineTo(-w,h);ctx.lineTo(-w,-h);ctx.closePath();},toObject:function(propertiesToInclude){var filters=[];this.filters.forEach(function(filterObj){if(filterObj){filters.push(filterObj.toObject());}});var object=extend(this.callSuper('toObject',['cropX','cropY'].concat(propertiesToInclude)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:filters,});if(this.resizeFilter){object.resizeFilter=this.resizeFilter.toObject();}
return object;},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height;},_toSVG:function(){var svgString=[],imageMarkup=[],strokeSvg,element=this._element,x=-this.width/2,y=-this.height/2,clipPath='',imageRendering='';if(!element){return[];}
if(this.hasCrop()){var clipPathId=fabric.Object.__uid++;svgString.push('<clipPath id="imageCrop_'+clipPathId+'">\n','\t<rect x="'+x+'" y="'+y+'" width="'+this.width+'" height="'+this.height+'" />\n','</clipPath>\n');clipPath=' clip-path="url(#imageCrop_'+clipPathId+')" ';}
if(!this.imageSmoothing){imageRendering='" image-rendering="optimizeSpeed';}
imageMarkup.push('\t<image ','COMMON_PARTS','xlink:href="',this.getSvgSrc(true),'" x="',x-this.cropX,'" y="',y-this.cropY,'" width="',element.width||element.naturalWidth,'" height="',element.height||element.height,imageRendering,'"',clipPath,'></image>\n');if(this.stroke||this.strokeDashArray){var origFill=this.fill;this.fill=null;strokeSvg=['\t<rect ','x="',x,'" y="',y,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'];this.fill=origFill;}
if(this.paintFirst!=='fill'){svgString=svgString.concat(strokeSvg,imageMarkup);}
else{svgString=svgString.concat(imageMarkup,strokeSvg);}
return svgString;},getSrc:function(filtered){var element=filtered?this._element:this._originalElement;if(element){if(element.toDataURL){return element.toDataURL();}
if(this.srcFromAttribute){return element.getAttribute('src');}
else{return element.src;}}
else{return this.src||'';}},setSrc:function(src,callback,options){fabric.util.loadImage(src,function(img,isError){this.setElement(img,options);this._setWidthHeight();callback&&callback(this,isError);},this,options&&options.crossOrigin);return this;},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>';},applyResizeFilters:function(){var filter=this.resizeFilter,minimumScale=this.minimumScaleTrigger,objectScale=this.getTotalObjectScaling(),scaleX=objectScale.scaleX,scaleY=objectScale.scaleY,elementToFilter=this._filteredEl||this._originalElement;if(this.group){this.set('dirty',true);}
if(!filter||(scaleX>minimumScale&&scaleY>minimumScale)){this._element=elementToFilter;this._filterScalingX=1;this._filterScalingY=1;this._lastScaleX=scaleX;this._lastScaleY=scaleY;return;}
if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend();}
var canvasEl=fabric.util.createCanvasElement(),cacheKey=this._filteredEl?(this.cacheKey+'_filtered'):this.cacheKey,sourceWidth=elementToFilter.width,sourceHeight=elementToFilter.height;canvasEl.width=sourceWidth;canvasEl.height=sourceHeight;this._element=canvasEl;this._lastScaleX=filter.scaleX=scaleX;this._lastScaleY=filter.scaleY=scaleY;fabric.filterBackend.applyFilters([filter],elementToFilter,sourceWidth,sourceHeight,this._element,cacheKey);this._filterScalingX=canvasEl.width/this._originalElement.width;this._filterScalingY=canvasEl.height/this._originalElement.height;},applyFilters:function(filters){filters=filters||this.filters||[];filters=filters.filter(function(filter){return filter&&!filter.isNeutralState();});this.set('dirty',true);this.removeTexture(this.cacheKey+'_filtered');if(filters.length===0){this._element=this._originalElement;this._filteredEl=null;this._filterScalingX=1;this._filterScalingY=1;return this;}
var imgElement=this._originalElement,sourceWidth=imgElement.naturalWidth||imgElement.width,sourceHeight=imgElement.naturalHeight||imgElement.height;if(this._element===this._originalElement){var canvasEl=fabric.util.createCanvasElement();canvasEl.width=sourceWidth;canvasEl.height=sourceHeight;this._element=canvasEl;this._filteredEl=canvasEl;}
else{this._element=this._filteredEl;this._filteredEl.getContext('2d').clearRect(0,0,sourceWidth,sourceHeight);this._lastScaleX=1;this._lastScaleY=1;}
if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend();}
fabric.filterBackend.applyFilters(filters,this._originalElement,sourceWidth,sourceHeight,this._element,this.cacheKey);if(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height){this._filterScalingX=this._element.width/this._originalElement.width;this._filterScalingY=this._element.height/this._originalElement.height;}
return this;},_render:function(ctx){fabric.util.setImageSmoothing(ctx,this.imageSmoothing);if(this.isMoving!==true&&this.resizeFilter&&this._needsResize()){this.applyResizeFilters();}
this._stroke(ctx);this._renderPaintInOrder(ctx);},drawCacheOnCanvas:function(ctx){fabric.util.setImageSmoothing(ctx,this.imageSmoothing);fabric.Object.prototype.drawCacheOnCanvas.call(this,ctx);},shouldCache:function(){return this.needsItsOwnCache();},_renderFill:function(ctx){var elementToDraw=this._element;if(!elementToDraw){return;}
var scaleX=this._filterScalingX,scaleY=this._filterScalingY,w=this.width,h=this.height,min=Math.min,max=Math.max,cropX=max(this.cropX,0),cropY=max(this.cropY,0),elWidth=elementToDraw.naturalWidth||elementToDraw.width,elHeight=elementToDraw.naturalHeight||elementToDraw.height,sX=cropX*scaleX,sY=cropY*scaleY,sW=min(w*scaleX,elWidth-sX),sH=min(h*scaleY,elHeight-sY),x=-w/2,y=-h/2,maxDestW=min(w,elWidth/scaleX-cropX),maxDestH=min(h,elHeight/scaleY-cropY);elementToDraw&&ctx.drawImage(elementToDraw,sX,sY,sW,sH,x,y,maxDestW,maxDestH);},_needsResize:function(){var scale=this.getTotalObjectScaling();return(scale.scaleX!==this._lastScaleX||scale.scaleY!==this._lastScaleY);},_resetWidthHeight:function(){this.set(this.getOriginalSize());},_initElement:function(element,options){this.setElement(fabric.util.getById(element),options);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS);},_initConfig:function(options){options||(options={});this.setOptions(options);this._setWidthHeight(options);},_initFilters:function(filters,callback){if(filters&&filters.length){fabric.util.enlivenObjects(filters,function(enlivenedObjects){callback&&callback(enlivenedObjects);},'fabric.Image.filters');}
else{callback&&callback();}},_setWidthHeight:function(options){options||(options={});var el=this.getElement();this.width=options.width||el.naturalWidth||el.width||0;this.height=options.height||el.naturalHeight||el.height||0;},parsePreserveAspectRatioAttribute:function(){var pAR=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||''),rWidth=this._element.width,rHeight=this._element.height,scaleX=1,scaleY=1,offsetLeft=0,offsetTop=0,cropX=0,cropY=0,offset,pWidth=this.width,pHeight=this.height,parsedAttributes={width:pWidth,height:pHeight};if(pAR&&(pAR.alignX!=='none'||pAR.alignY!=='none')){if(pAR.meetOrSlice==='meet'){scaleX=scaleY=fabric.util.findScaleToFit(this._element,parsedAttributes);offset=(pWidth-rWidth*scaleX)/2;if(pAR.alignX==='Min'){offsetLeft=-offset;}
if(pAR.alignX==='Max'){offsetLeft=offset;}
offset=(pHeight-rHeight*scaleY)/2;if(pAR.alignY==='Min'){offsetTop=-offset;}
if(pAR.alignY==='Max'){offsetTop=offset;}}
if(pAR.meetOrSlice==='slice'){scaleX=scaleY=fabric.util.findScaleToCover(this._element,parsedAttributes);offset=rWidth-pWidth/scaleX;if(pAR.alignX==='Mid'){cropX=offset/2;}
if(pAR.alignX==='Max'){cropX=offset;}
offset=rHeight-pHeight/scaleY;if(pAR.alignY==='Mid'){cropY=offset/2;}
if(pAR.alignY==='Max'){cropY=offset;}
rWidth=pWidth/scaleX;rHeight=pHeight/scaleY;}}
else{scaleX=pWidth/rWidth;scaleY=pHeight/rHeight;}
return{width:rWidth,height:rHeight,scaleX:scaleX,scaleY:scaleY,offsetLeft:offsetLeft,offsetTop:offsetTop,cropX:cropX,cropY:cropY};}});fabric.Image.CSS_CANVAS='canvas-img';fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(_object,callback){var object=fabric.util.object.clone(_object);fabric.util.loadImage(object.src,function(img,isError){if(isError){callback&&callback(null,true);return;}
fabric.Image.prototype._initFilters.call(object,object.filters,function(filters){object.filters=filters||[];fabric.Image.prototype._initFilters.call(object,[object.resizeFilter],function(resizeFilters){object.resizeFilter=resizeFilters[0];fabric.util.enlivenObjectEnlivables(object,object,function(){var image=new fabric.Image(img,object);callback(image,false);});});});},null,object.crossOrigin);};fabric.Image.fromURL=function(url,callback,imgOptions){fabric.util.loadImage(url,function(img,isError){callback&&callback(new fabric.Image(img,imgOptions),isError);},null,imgOptions&&imgOptions.crossOrigin);};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x y width height preserveAspectRatio xlink:href crossOrigin image-rendering'.split(' '));fabric.Image.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(parsedAttributes['xlink:href'],callback,extend((options?fabric.util.object.clone(options):{}),parsedAttributes));};})(typeof exports!=='undefined'?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var angle=this.angle%360;if(angle>0){return Math.round((angle-1)/90)*90;}
return Math.round(angle/90)*90;},straighten:function(){return this.rotate(this._getAngleValueForStraighten());},fxStraighten:function(callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;return fabric.util.animate({target:this,startValue:this.get('angle'),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(value){_this.rotate(value);onChange();},onComplete:function(){_this.setCoords();onComplete();},});}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(object){object.straighten();this.requestRenderAll();return this;},fxStraightenObject:function(object){return object.fxStraighten({onChange:this.requestRenderAllBound});}});(function(){'use strict';function testPrecision(gl,precision){var fragmentSource='precision '+precision+' float;\nvoid main(){}';var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragmentSource);gl.compileShader(fragmentShader);if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){return false;}
return true;}
fabric.isWebglSupported=function(tileSize){if(fabric.isLikelyNode){return false;}
tileSize=tileSize||fabric.WebglFilterBackend.prototype.tileSize;var canvas=document.createElement('canvas');var gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');var isSupported=false;if(gl){fabric.maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);isSupported=fabric.maxTextureSize>=tileSize;var precisions=['highp','mediump','lowp'];for(var i=0;i<3;i++){if(testPrecision(gl,precisions[i])){fabric.webGlPrecision=precisions[i];break;};}}
this.isSupported=isSupported;return isSupported;};fabric.WebglFilterBackend=WebglFilterBackend;function WebglFilterBackend(options){if(options&&options.tileSize){this.tileSize=options.tileSize;}
this.setupGLContext(this.tileSize,this.tileSize);this.captureGPUInfo();};WebglFilterBackend.prototype={tileSize:2048,resources:{},setupGLContext:function(width,height){this.dispose();this.createWebGLCanvas(width,height);this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]);this.chooseFastestCopyGLTo2DMethod(width,height);},chooseFastestCopyGLTo2DMethod:function(width,height){var canMeasurePerf=typeof window.performance!=='undefined',canUseImageData;try{new ImageData(1,1);canUseImageData=true;}
catch(e){canUseImageData=false;}
var canUseArrayBuffer=typeof ArrayBuffer!=='undefined';var canUseUint8Clamped=typeof Uint8ClampedArray!=='undefined';if(!(canMeasurePerf&&canUseImageData&&canUseArrayBuffer&&canUseUint8Clamped)){return;}
var targetCanvas=fabric.util.createCanvasElement();var imageBuffer=new ArrayBuffer(width*height*4);if(fabric.forceGLPutImageData){this.imageBuffer=imageBuffer;this.copyGLTo2D=copyGLTo2DPutImageData;return;}
var testContext={imageBuffer:imageBuffer,destinationWidth:width,destinationHeight:height,targetCanvas:targetCanvas};var startTime,drawImageTime,putImageDataTime;targetCanvas.width=width;targetCanvas.height=height;startTime=window.performance.now();copyGLTo2DDrawImage.call(testContext,this.gl,testContext);drawImageTime=window.performance.now()-startTime;startTime=window.performance.now();copyGLTo2DPutImageData.call(testContext,this.gl,testContext);putImageDataTime=window.performance.now()-startTime;if(drawImageTime>putImageDataTime){this.imageBuffer=imageBuffer;this.copyGLTo2D=copyGLTo2DPutImageData;}
else{this.copyGLTo2D=copyGLTo2DDrawImage;}},createWebGLCanvas:function(width,height){var canvas=fabric.util.createCanvasElement();canvas.width=width;canvas.height=height;var glOptions={alpha:true,premultipliedAlpha:false,depth:false,stencil:false,antialias:false},gl=canvas.getContext('webgl',glOptions);if(!gl){gl=canvas.getContext('experimental-webgl',glOptions);}
if(!gl){return;}
gl.clearColor(0,0,0,0);this.canvas=canvas;this.gl=gl;},applyFilters:function(filters,source,width,height,targetCanvas,cacheKey){var gl=this.gl;var cachedTexture;if(cacheKey){cachedTexture=this.getCachedTexture(cacheKey,source);}
var pipelineState={originalWidth:source.width||source.originalWidth,originalHeight:source.height||source.originalHeight,sourceWidth:width,sourceHeight:height,destinationWidth:width,destinationHeight:height,context:gl,sourceTexture:this.createTexture(gl,width,height,!cachedTexture&&source),targetTexture:this.createTexture(gl,width,height),originalTexture:cachedTexture||this.createTexture(gl,width,height,!cachedTexture&&source),passes:filters.length,webgl:true,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:targetCanvas};var tempFbo=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,tempFbo);filters.forEach(function(filter){filter&&filter.applyTo(pipelineState);});resizeCanvasIfNeeded(pipelineState);this.copyGLTo2D(gl,pipelineState);gl.bindTexture(gl.TEXTURE_2D,null);gl.deleteTexture(pipelineState.sourceTexture);gl.deleteTexture(pipelineState.targetTexture);gl.deleteFramebuffer(tempFbo);targetCanvas.getContext('2d').setTransform(1,0,0,1,0,0);return pipelineState;},dispose:function(){if(this.canvas){this.canvas=null;this.gl=null;}
this.clearWebGLCaches();},clearWebGLCaches:function(){this.programCache={};this.textureCache={};},createTexture:function(gl,width,height,textureImageSource){var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(textureImageSource){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,textureImageSource);}
else{gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);}
return texture;},getCachedTexture:function(uniqueId,textureImageSource){if(this.textureCache[uniqueId]){return this.textureCache[uniqueId];}
else{var texture=this.createTexture(this.gl,textureImageSource.width,textureImageSource.height,textureImageSource);this.textureCache[uniqueId]=texture;return texture;}},evictCachesForKey:function(cacheKey){if(this.textureCache[cacheKey]){this.gl.deleteTexture(this.textureCache[cacheKey]);delete this.textureCache[cacheKey];}},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo){return this.gpuInfo;}
var gl=this.gl,gpuInfo={renderer:'',vendor:''};if(!gl){return gpuInfo;}
var ext=gl.getExtension('WEBGL_debug_renderer_info');if(ext){var renderer=gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);var vendor=gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);if(renderer){gpuInfo.renderer=renderer.toLowerCase();}
if(vendor){gpuInfo.vendor=vendor.toLowerCase();}}
this.gpuInfo=gpuInfo;return gpuInfo;},};})();function resizeCanvasIfNeeded(pipelineState){var targetCanvas=pipelineState.targetCanvas,width=targetCanvas.width,height=targetCanvas.height,dWidth=pipelineState.destinationWidth,dHeight=pipelineState.destinationHeight;if(width!==dWidth||height!==dHeight){targetCanvas.width=dWidth;targetCanvas.height=dHeight;}}
function copyGLTo2DDrawImage(gl,pipelineState){var glCanvas=gl.canvas,targetCanvas=pipelineState.targetCanvas,ctx=targetCanvas.getContext('2d');ctx.translate(0,targetCanvas.height);ctx.scale(1,-1);var sourceY=glCanvas.height-targetCanvas.height;ctx.drawImage(glCanvas,0,sourceY,targetCanvas.width,targetCanvas.height,0,0,targetCanvas.width,targetCanvas.height);}
function copyGLTo2DPutImageData(gl,pipelineState){var targetCanvas=pipelineState.targetCanvas,ctx=targetCanvas.getContext('2d'),dWidth=pipelineState.destinationWidth,dHeight=pipelineState.destinationHeight,numBytes=dWidth*dHeight*4;var u8=new Uint8Array(this.imageBuffer,0,numBytes);var u8Clamped=new Uint8ClampedArray(this.imageBuffer,0,numBytes);gl.readPixels(0,0,dWidth,dHeight,gl.RGBA,gl.UNSIGNED_BYTE,u8);var imgData=new ImageData(u8Clamped,dWidth,dHeight);ctx.putImageData(imgData,0,0);}
(function(){'use strict';var noop=function(){};fabric.Canvas2dFilterBackend=Canvas2dFilterBackend;function Canvas2dFilterBackend(){};Canvas2dFilterBackend.prototype={evictCachesForKey:noop,dispose:noop,clearWebGLCaches:noop,resources:{},applyFilters:function(filters,sourceElement,sourceWidth,sourceHeight,targetCanvas){var ctx=targetCanvas.getContext('2d');ctx.drawImage(sourceElement,0,0,sourceWidth,sourceHeight);var imageData=ctx.getImageData(0,0,sourceWidth,sourceHeight);var originalImageData=ctx.getImageData(0,0,sourceWidth,sourceHeight);var pipelineState={sourceWidth:sourceWidth,sourceHeight:sourceHeight,imageData:imageData,originalEl:sourceElement,originalImageData:originalImageData,canvasEl:targetCanvas,ctx:ctx,filterBackend:this,};filters.forEach(function(filter){filter.applyTo(pipelineState);});if(pipelineState.imageData.width!==sourceWidth||pipelineState.imageData.height!==sourceHeight){targetCanvas.width=pipelineState.imageData.width;targetCanvas.height=pipelineState.imageData.height;}
ctx.putImageData(pipelineState.imageData,0,0);return pipelineState;},};})();fabric.Image=fabric.Image||{};fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:'BaseFilter',vertexSource:'attribute vec2 aPosition;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vTexCoord = aPosition;\n'+'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n'+'}',fragmentSource:'precision highp float;\n'+'varying vec2 vTexCoord;\n'+'uniform sampler2D uTexture;\n'+'void main() {\n'+'gl_FragColor = texture2D(uTexture, vTexCoord);\n'+'}',initialize:function(options){if(options){this.setOptions(options);}},setOptions:function(options){for(var prop in options){this[prop]=options[prop];}},createProgram:function(gl,fragmentSource,vertexSource){fragmentSource=fragmentSource||this.fragmentSource;vertexSource=vertexSource||this.vertexSource;if(fabric.webGlPrecision!=='highp'){fragmentSource=fragmentSource.replace(/precision highp float/g,'precision '+fabric.webGlPrecision+' float');}
var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,vertexSource);gl.compileShader(vertexShader);if(!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)){throw new Error('Vertex shader compile error for '+this.type+': '+
gl.getShaderInfoLog(vertexShader));}
var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragmentSource);gl.compileShader(fragmentShader);if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){throw new Error('Fragment shader compile error for '+this.type+': '+
gl.getShaderInfoLog(fragmentShader));}
var program=gl.createProgram();gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){throw new Error('Shader link error for "${this.type}" '+
gl.getProgramInfoLog(program));}
var attributeLocations=this.getAttributeLocations(gl,program);var uniformLocations=this.getUniformLocations(gl,program)||{};uniformLocations.uStepW=gl.getUniformLocation(program,'uStepW');uniformLocations.uStepH=gl.getUniformLocation(program,'uStepH');return{program:program,attributeLocations:attributeLocations,uniformLocations:uniformLocations};},getAttributeLocations:function(gl,program){return{aPosition:gl.getAttribLocation(program,'aPosition'),};},getUniformLocations:function(){return{};},sendAttributeData:function(gl,attributeLocations,aPositionData){var attributeLocation=attributeLocations.aPosition;var buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.enableVertexAttribArray(attributeLocation);gl.vertexAttribPointer(attributeLocation,2,gl.FLOAT,false,0,0);gl.bufferData(gl.ARRAY_BUFFER,aPositionData,gl.STATIC_DRAW);},_setupFrameBuffer:function(options){var gl=options.context,width,height;if(options.passes>1){width=options.destinationWidth;height=options.destinationHeight;if(options.sourceWidth!==width||options.sourceHeight!==height){gl.deleteTexture(options.targetTexture);options.targetTexture=options.filterBackend.createTexture(gl,width,height);}
gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,options.targetTexture,0);}
else{gl.bindFramebuffer(gl.FRAMEBUFFER,null);gl.finish();}},_swapTextures:function(options){options.passes--;options.pass++;var temp=options.targetTexture;options.targetTexture=options.sourceTexture;options.sourceTexture=temp;},isNeutralState:function(){var main=this.mainParameter,_class=fabric.Image.filters[this.type].prototype;if(main){if(Array.isArray(_class[main])){for(var i=_class[main].length;i--;){if(this[main][i]!==_class[main][i]){return false;}}
return true;}
else{return _class[main]===this[main];}}
else{return false;}},applyTo:function(options){if(options.webgl){this._setupFrameBuffer(options);this.applyToWebGL(options);this._swapTextures(options);}
else{this.applyTo2d(options);}},retrieveShader:function(options){if(!options.programCache.hasOwnProperty(this.type)){options.programCache[this.type]=this.createProgram(options.context);}
return options.programCache[this.type];},applyToWebGL:function(options){var gl=options.context;var shader=this.retrieveShader(options);if(options.pass===0&&options.originalTexture){gl.bindTexture(gl.TEXTURE_2D,options.originalTexture);}
else{gl.bindTexture(gl.TEXTURE_2D,options.sourceTexture);}
gl.useProgram(shader.program);this.sendAttributeData(gl,shader.attributeLocations,options.aPosition);gl.uniform1f(shader.uniformLocations.uStepW,1/options.sourceWidth);gl.uniform1f(shader.uniformLocations.uStepH,1/options.sourceHeight);this.sendUniformData(gl,shader.uniformLocations);gl.viewport(0,0,options.destinationWidth,options.destinationHeight);gl.drawArrays(gl.TRIANGLE_STRIP,0,4);},bindAdditionalTexture:function(gl,texture,textureUnit){gl.activeTexture(textureUnit);gl.bindTexture(gl.TEXTURE_2D,texture);gl.activeTexture(gl.TEXTURE0);},unbindAdditionalTexture:function(gl,textureUnit){gl.activeTexture(textureUnit);gl.bindTexture(gl.TEXTURE_2D,null);gl.activeTexture(gl.TEXTURE0);},getMainParameter:function(){return this[this.mainParameter];},setMainParameter:function(value){this[this.mainParameter]=value;},sendUniformData:function(){},createHelpLayer:function(options){if(!options.helpLayer){var helpLayer=document.createElement('canvas');helpLayer.width=options.sourceWidth;helpLayer.height=options.sourceHeight;options.helpLayer=helpLayer;}},toObject:function(){var object={type:this.type},mainP=this.mainParameter;if(mainP){object[mainP]=this[mainP];}
return object;},toJSON:function(){return this.toObject();}});fabric.Image.filters.BaseFilter.fromObject=function(object,callback){var filter=new fabric.Image.filters[object.type](object);callback&&callback(filter);return filter;};(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.ColorMatrix=createClass(filters.BaseFilter,{type:'ColorMatrix',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'varying vec2 vTexCoord;\n'+'uniform mat4 uColorMatrix;\n'+'uniform vec4 uConstants;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'color *= uColorMatrix;\n'+'color += uConstants;\n'+'gl_FragColor = color;\n'+'}',matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:'matrix',colorsOnly:true,initialize:function(options){this.callSuper('initialize',options);this.matrix=this.matrix.slice(0);},applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,iLen=data.length,m=this.matrix,r,g,b,a,i,colorsOnly=this.colorsOnly;for(i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(colorsOnly){data[i]=r*m[0]+g*m[1]+b*m[2]+m[4]*255;data[i+1]=r*m[5]+g*m[6]+b*m[7]+m[9]*255;data[i+2]=r*m[10]+g*m[11]+b*m[12]+m[14]*255;}
else{a=data[i+3];data[i]=r*m[0]+g*m[1]+b*m[2]+a*m[3]+m[4]*255;data[i+1]=r*m[5]+g*m[6]+b*m[7]+a*m[8]+m[9]*255;data[i+2]=r*m[10]+g*m[11]+b*m[12]+a*m[13]+m[14]*255;data[i+3]=r*m[15]+g*m[16]+b*m[17]+a*m[18]+m[19]*255;}}},getUniformLocations:function(gl,program){return{uColorMatrix:gl.getUniformLocation(program,'uColorMatrix'),uConstants:gl.getUniformLocation(program,'uConstants'),};},sendUniformData:function(gl,uniformLocations){var m=this.matrix,matrix=[m[0],m[1],m[2],m[3],m[5],m[6],m[7],m[8],m[10],m[11],m[12],m[13],m[15],m[16],m[17],m[18]],constants=[m[4],m[9],m[14],m[19]];gl.uniformMatrix4fv(uniformLocations.uColorMatrix,false,matrix);gl.uniform4fv(uniformLocations.uConstants,constants);},});fabric.Image.filters.ColorMatrix.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Brightness=createClass(filters.BaseFilter,{type:'Brightness',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uBrightness;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'color.rgb += uBrightness;\n'+'gl_FragColor = color;\n'+'}',brightness:0,mainParameter:'brightness',applyTo2d:function(options){if(this.brightness===0){return;}
var imageData=options.imageData,data=imageData.data,i,len=data.length,brightness=Math.round(this.brightness*255);for(i=0;i<len;i+=4){data[i]=data[i]+brightness;data[i+1]=data[i+1]+brightness;data[i+2]=data[i+2]+brightness;}},getUniformLocations:function(gl,program){return{uBrightness:gl.getUniformLocation(program,'uBrightness'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uBrightness,this.brightness);},});fabric.Image.filters.Brightness.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Convolute=createClass(filters.BaseFilter,{type:'Convolute',opaque:false,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[9];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 0);\n'+'for (float h = 0.0; h < 3.0; h+=1.0) {\n'+'for (float w = 0.0; w < 3.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n'+'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n'+'}\n'+'}\n'+'gl_FragColor = color;\n'+'}',Convolute_3_0:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[9];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 1);\n'+'for (float h = 0.0; h < 3.0; h+=1.0) {\n'+'for (float w = 0.0; w < 3.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n'+'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n'+'}\n'+'}\n'+'float alpha = texture2D(uTexture, vTexCoord).a;\n'+'gl_FragColor = color;\n'+'gl_FragColor.a = alpha;\n'+'}',Convolute_5_1:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[25];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 0);\n'+'for (float h = 0.0; h < 5.0; h+=1.0) {\n'+'for (float w = 0.0; w < 5.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n'+'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n'+'}\n'+'}\n'+'gl_FragColor = color;\n'+'}',Convolute_5_0:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[25];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 1);\n'+'for (float h = 0.0; h < 5.0; h+=1.0) {\n'+'for (float w = 0.0; w < 5.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n'+'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n'+'}\n'+'}\n'+'float alpha = texture2D(uTexture, vTexCoord).a;\n'+'gl_FragColor = color;\n'+'gl_FragColor.a = alpha;\n'+'}',Convolute_7_1:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[49];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 0);\n'+'for (float h = 0.0; h < 7.0; h+=1.0) {\n'+'for (float w = 0.0; w < 7.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n'+'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n'+'}\n'+'}\n'+'gl_FragColor = color;\n'+'}',Convolute_7_0:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[49];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 1);\n'+'for (float h = 0.0; h < 7.0; h+=1.0) {\n'+'for (float w = 0.0; w < 7.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n'+'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n'+'}\n'+'}\n'+'float alpha = texture2D(uTexture, vTexCoord).a;\n'+'gl_FragColor = color;\n'+'gl_FragColor.a = alpha;\n'+'}',Convolute_9_1:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[81];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 0);\n'+'for (float h = 0.0; h < 9.0; h+=1.0) {\n'+'for (float w = 0.0; w < 9.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n'+'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n'+'}\n'+'}\n'+'gl_FragColor = color;\n'+'}',Convolute_9_0:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[81];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 1);\n'+'for (float h = 0.0; h < 9.0; h+=1.0) {\n'+'for (float w = 0.0; w < 9.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n'+'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n'+'}\n'+'}\n'+'float alpha = texture2D(uTexture, vTexCoord).a;\n'+'gl_FragColor = color;\n'+'gl_FragColor.a = alpha;\n'+'}',},retrieveShader:function(options){var size=Math.sqrt(this.matrix.length);var cacheKey=this.type+'_'+size+'_'+(this.opaque?1:0);var shaderSource=this.fragmentSource[cacheKey];if(!options.programCache.hasOwnProperty(cacheKey)){options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}
return options.programCache[cacheKey];},applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,weights=this.matrix,side=Math.round(Math.sqrt(weights.length)),halfSide=Math.floor(side/2),sw=imageData.width,sh=imageData.height,output=options.ctx.createImageData(sw,sh),dst=output.data,alphaFac=this.opaque?1:0,r,g,b,a,dstOff,scx,scy,srcOff,wt,x,y,cx,cy;for(y=0;y<sh;y++){for(x=0;x<sw;x++){dstOff=(y*sw+x)*4;r=0;g=0;b=0;a=0;for(cy=0;cy<side;cy++){for(cx=0;cx<side;cx++){scy=y+cy-halfSide;scx=x+cx-halfSide;if(scy<0||scy>=sh||scx<0||scx>=sw){continue;}
srcOff=(scy*sw+scx)*4;wt=weights[cy*side+cx];r+=data[srcOff]*wt;g+=data[srcOff+1]*wt;b+=data[srcOff+2]*wt;if(!alphaFac){a+=data[srcOff+3]*wt;}}}
dst[dstOff]=r;dst[dstOff+1]=g;dst[dstOff+2]=b;if(!alphaFac){dst[dstOff+3]=a;}
else{dst[dstOff+3]=data[dstOff+3];}}}
options.imageData=output;},getUniformLocations:function(gl,program){return{uMatrix:gl.getUniformLocation(program,'uMatrix'),uOpaque:gl.getUniformLocation(program,'uOpaque'),uHalfSize:gl.getUniformLocation(program,'uHalfSize'),uSize:gl.getUniformLocation(program,'uSize'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1fv(uniformLocations.uMatrix,this.matrix);},toObject:function(){return extend(this.callSuper('toObject'),{opaque:this.opaque,matrix:this.matrix});}});fabric.Image.filters.Convolute.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Grayscale=createClass(filters.BaseFilter,{type:'Grayscale',fragmentSource:{average:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'float average = (color.r + color.b + color.g) / 3.0;\n'+'gl_FragColor = vec4(average, average, average, color.a);\n'+'}',lightness:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform int uMode;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 col = texture2D(uTexture, vTexCoord);\n'+'float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n'+'gl_FragColor = vec4(average, average, average, col.a);\n'+'}',luminosity:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform int uMode;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 col = texture2D(uTexture, vTexCoord);\n'+'float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n'+'gl_FragColor = vec4(average, average, average, col.a);\n'+'}',},mode:'average',mainParameter:'mode',applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,i,len=data.length,value,mode=this.mode;for(i=0;i<len;i+=4){if(mode==='average'){value=(data[i]+data[i+1]+data[i+2])/3;}
else if(mode==='lightness'){value=(Math.min(data[i],data[i+1],data[i+2])+
Math.max(data[i],data[i+1],data[i+2]))/2;}
else if(mode==='luminosity'){value=0.21*data[i]+0.72*data[i+1]+0.07*data[i+2];}
data[i]=value;data[i+1]=value;data[i+2]=value;}},retrieveShader:function(options){var cacheKey=this.type+'_'+this.mode;if(!options.programCache.hasOwnProperty(cacheKey)){var shaderSource=this.fragmentSource[this.mode];options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}
return options.programCache[cacheKey];},getUniformLocations:function(gl,program){return{uMode:gl.getUniformLocation(program,'uMode'),};},sendUniformData:function(gl,uniformLocations){var mode=1;gl.uniform1i(uniformLocations.uMode,mode);},isNeutralState:function(){return false;},});fabric.Image.filters.Grayscale.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Invert=createClass(filters.BaseFilter,{type:'Invert',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform int uInvert;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'if (uInvert == 1) {\n'+'gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n'+'} else {\n'+'gl_FragColor = color;\n'+'}\n'+'}',invert:true,mainParameter:'invert',applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,i,len=data.length;for(i=0;i<len;i+=4){data[i]=255-data[i];data[i+1]=255-data[i+1];data[i+2]=255-data[i+2];}},isNeutralState:function(){return!this.invert;},getUniformLocations:function(gl,program){return{uInvert:gl.getUniformLocation(program,'uInvert'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1i(uniformLocations.uInvert,this.invert);},});fabric.Image.filters.Invert.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Noise=createClass(filters.BaseFilter,{type:'Noise',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uStepH;\n'+'uniform float uNoise;\n'+'uniform float uSeed;\n'+'varying vec2 vTexCoord;\n'+'float rand(vec2 co, float seed, float vScale) {\n'+'return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n'+'}\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n'+'gl_FragColor = color;\n'+'}',mainParameter:'noise',noise:0,applyTo2d:function(options){if(this.noise===0){return;}
var imageData=options.imageData,data=imageData.data,i,len=data.length,noise=this.noise,rand;for(i=0,len=data.length;i<len;i+=4){rand=(0.5-Math.random())*noise;data[i]+=rand;data[i+1]+=rand;data[i+2]+=rand;}},getUniformLocations:function(gl,program){return{uNoise:gl.getUniformLocation(program,'uNoise'),uSeed:gl.getUniformLocation(program,'uSeed'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uNoise,this.noise/255);gl.uniform1f(uniformLocations.uSeed,Math.random());},toObject:function(){return extend(this.callSuper('toObject'),{noise:this.noise});}});fabric.Image.filters.Noise.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Pixelate=createClass(filters.BaseFilter,{type:'Pixelate',blocksize:4,mainParameter:'blocksize',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uBlocksize;\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'float blockW = uBlocksize * uStepW;\n'+'float blockH = uBlocksize * uStepW;\n'+'int posX = int(vTexCoord.x / blockW);\n'+'int posY = int(vTexCoord.y / blockH);\n'+'float fposX = float(posX);\n'+'float fposY = float(posY);\n'+'vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n'+'vec4 color = texture2D(uTexture, squareCoords);\n'+'gl_FragColor = color;\n'+'}',applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,iLen=imageData.height,jLen=imageData.width,index,i,j,r,g,b,a,_i,_j,_iLen,_jLen;for(i=0;i<iLen;i+=this.blocksize){for(j=0;j<jLen;j+=this.blocksize){index=(i*4)*jLen+(j*4);r=data[index];g=data[index+1];b=data[index+2];a=data[index+3];_iLen=Math.min(i+this.blocksize,iLen);_jLen=Math.min(j+this.blocksize,jLen);for(_i=i;_i<_iLen;_i++){for(_j=j;_j<_jLen;_j++){index=(_i*4)*jLen+(_j*4);data[index]=r;data[index+1]=g;data[index+2]=b;data[index+3]=a;}}}}},isNeutralState:function(){return this.blocksize===1;},getUniformLocations:function(gl,program){return{uBlocksize:gl.getUniformLocation(program,'uBlocksize'),uStepW:gl.getUniformLocation(program,'uStepW'),uStepH:gl.getUniformLocation(program,'uStepH'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uBlocksize,this.blocksize);},});fabric.Image.filters.Pixelate.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.RemoveColor=createClass(filters.BaseFilter,{type:'RemoveColor',color:'#FFFFFF',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec4 uLow;\n'+'uniform vec4 uHigh;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'gl_FragColor = texture2D(uTexture, vTexCoord);\n'+'if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n'+'gl_FragColor.a = 0.0;\n'+'}\n'+'}',distance:0.02,useAlpha:false,applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,i,distance=this.distance*255,r,g,b,source=new fabric.Color(this.color).getSource(),lowC=[source[0]-distance,source[1]-distance,source[2]-distance,],highC=[source[0]+distance,source[1]+distance,source[2]+distance,];for(i=0;i<data.length;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(r>lowC[0]&&g>lowC[1]&&b>lowC[2]&&r<highC[0]&&g<highC[1]&&b<highC[2]){data[i+3]=0;}}},getUniformLocations:function(gl,program){return{uLow:gl.getUniformLocation(program,'uLow'),uHigh:gl.getUniformLocation(program,'uHigh'),};},sendUniformData:function(gl,uniformLocations){var source=new fabric.Color(this.color).getSource(),distance=parseFloat(this.distance),lowC=[0+source[0]/255-distance,0+source[1]/255-distance,0+source[2]/255-distance,1],highC=[source[0]/255+distance,source[1]/255+distance,source[2]/255+distance,1];gl.uniform4fv(uniformLocations.uLow,lowC);gl.uniform4fv(uniformLocations.uHigh,highC);},toObject:function(){return extend(this.callSuper('toObject'),{color:this.color,distance:this.distance});}});fabric.Image.filters.RemoveColor.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;var matrices={Brownie:[0.59970,0.34553,-0.27082,0,0.186,-0.03770,0.86095,0.15059,0,-0.1449,0.24113,-0.07441,0.44972,0,-0.02965,0,0,0,1,0],Vintage:[0.62793,0.32021,-0.03965,0,0.03784,0.02578,0.64411,0.03259,0,0.02926,0.04660,-0.08512,0.52416,0,0.02023,0,0,0,1,0],Kodachrome:[1.12855,-0.39673,-0.03992,0,0.24991,-0.16404,1.08352,-0.05498,0,0.09698,-0.16786,-0.56034,1.60148,0,0.13972,0,0,0,1,0],Technicolor:[1.91252,-0.85453,-0.09155,0,0.04624,-0.30878,1.76589,-0.10601,0,-0.27589,-0.23110,-0.75018,1.84759,0,0.12137,0,0,0,1,0],Polaroid:[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0],Sepia:[0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0,]};for(var key in matrices){filters[key]=createClass(filters.ColorMatrix,{type:key,matrix:matrices[key],mainParameter:false,colorsOnly:true,});fabric.Image.filters[key].fromObject=fabric.Image.filters.BaseFilter.fromObject;}})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.BlendColor=createClass(filters.BaseFilter,{type:'BlendColor',color:'#F95C63',mode:'multiply',alpha:1,fragmentSource:{multiply:'gl_FragColor.rgb *= uColor.rgb;\n',screen:'gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n',add:'gl_FragColor.rgb += uColor.rgb;\n',diff:'gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n',subtract:'gl_FragColor.rgb -= uColor.rgb;\n',lighten:'gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n',darken:'gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n',exclusion:'gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n',overlay:'if (uColor.r < 0.5) {\n'+'gl_FragColor.r *= 2.0 * uColor.r;\n'+'} else {\n'+'gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n'+'}\n'+'if (uColor.g < 0.5) {\n'+'gl_FragColor.g *= 2.0 * uColor.g;\n'+'} else {\n'+'gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n'+'}\n'+'if (uColor.b < 0.5) {\n'+'gl_FragColor.b *= 2.0 * uColor.b;\n'+'} else {\n'+'gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n'+'}\n',tint:'gl_FragColor.rgb *= (1.0 - uColor.a);\n'+'gl_FragColor.rgb += uColor.rgb;\n',},buildSource:function(mode){return'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec4 uColor;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'gl_FragColor = color;\n'+'if (color.a > 0.0) {\n'+
this.fragmentSource[mode]+'}\n'+'}';},retrieveShader:function(options){var cacheKey=this.type+'_'+this.mode,shaderSource;if(!options.programCache.hasOwnProperty(cacheKey)){shaderSource=this.buildSource(this.mode);options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}
return options.programCache[cacheKey];},applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,iLen=data.length,tr,tg,tb,r,g,b,source,alpha1=1-this.alpha;source=new fabric.Color(this.color).getSource();tr=source[0]*this.alpha;tg=source[1]*this.alpha;tb=source[2]*this.alpha;for(var i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];switch(this.mode){case'multiply':data[i]=r*tr/255;data[i+1]=g*tg/255;data[i+2]=b*tb/255;break;case'screen':data[i]=255-(255-r)*(255-tr)/255;data[i+1]=255-(255-g)*(255-tg)/255;data[i+2]=255-(255-b)*(255-tb)/255;break;case'add':data[i]=r+tr;data[i+1]=g+tg;data[i+2]=b+tb;break;case'diff':case'difference':data[i]=Math.abs(r-tr);data[i+1]=Math.abs(g-tg);data[i+2]=Math.abs(b-tb);break;case'subtract':data[i]=r-tr;data[i+1]=g-tg;data[i+2]=b-tb;break;case'darken':data[i]=Math.min(r,tr);data[i+1]=Math.min(g,tg);data[i+2]=Math.min(b,tb);break;case'lighten':data[i]=Math.max(r,tr);data[i+1]=Math.max(g,tg);data[i+2]=Math.max(b,tb);break;case'overlay':data[i]=tr<128?(2*r*tr/255):(255-2*(255-r)*(255-tr)/255);data[i+1]=tg<128?(2*g*tg/255):(255-2*(255-g)*(255-tg)/255);data[i+2]=tb<128?(2*b*tb/255):(255-2*(255-b)*(255-tb)/255);break;case'exclusion':data[i]=tr+r-((2*tr*r)/255);data[i+1]=tg+g-((2*tg*g)/255);data[i+2]=tb+b-((2*tb*b)/255);break;case'tint':data[i]=tr+r*alpha1;data[i+1]=tg+g*alpha1;data[i+2]=tb+b*alpha1;}}},getUniformLocations:function(gl,program){return{uColor:gl.getUniformLocation(program,'uColor'),};},sendUniformData:function(gl,uniformLocations){var source=new fabric.Color(this.color).getSource();source[0]=this.alpha*source[0]/255;source[1]=this.alpha*source[1]/255;source[2]=this.alpha*source[2]/255;source[3]=this.alpha;gl.uniform4fv(uniformLocations.uColor,source);},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha};}});fabric.Image.filters.BlendColor.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.BlendImage=createClass(filters.BaseFilter,{type:'BlendImage',image:null,mode:'multiply',alpha:1,vertexSource:'attribute vec2 aPosition;\n'+'varying vec2 vTexCoord;\n'+'varying vec2 vTexCoord2;\n'+'uniform mat3 uTransformMatrix;\n'+'void main() {\n'+'vTexCoord = aPosition;\n'+'vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n'+'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n'+'}',fragmentSource:{multiply:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform sampler2D uImage;\n'+'uniform vec4 uColor;\n'+'varying vec2 vTexCoord;\n'+'varying vec2 vTexCoord2;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'vec4 color2 = texture2D(uImage, vTexCoord2);\n'+'color.rgba *= color2.rgba;\n'+'gl_FragColor = color;\n'+'}',mask:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform sampler2D uImage;\n'+'uniform vec4 uColor;\n'+'varying vec2 vTexCoord;\n'+'varying vec2 vTexCoord2;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'vec4 color2 = texture2D(uImage, vTexCoord2);\n'+'color.a = color2.a;\n'+'gl_FragColor = color;\n'+'}',},retrieveShader:function(options){var cacheKey=this.type+'_'+this.mode;var shaderSource=this.fragmentSource[this.mode];if(!options.programCache.hasOwnProperty(cacheKey)){options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}
return options.programCache[cacheKey];},applyToWebGL:function(options){var gl=options.context,texture=this.createTexture(options.filterBackend,this.image);this.bindAdditionalTexture(gl,texture,gl.TEXTURE1);this.callSuper('applyToWebGL',options);this.unbindAdditionalTexture(gl,gl.TEXTURE1);},createTexture:function(backend,image){return backend.getCachedTexture(image.cacheKey,image._element);},calculateMatrix:function(){var image=this.image,width=image._element.width,height=image._element.height;return[1/image.scaleX,0,0,0,1/image.scaleY,0,-image.left/width,-image.top/height,1];},applyTo2d:function(options){var imageData=options.imageData,resources=options.filterBackend.resources,data=imageData.data,iLen=data.length,width=imageData.width,height=imageData.height,tr,tg,tb,ta,r,g,b,a,canvas1,context,image=this.image,blendData;if(!resources.blendImage){resources.blendImage=fabric.util.createCanvasElement();}
canvas1=resources.blendImage;context=canvas1.getContext('2d');if(canvas1.width!==width||canvas1.height!==height){canvas1.width=width;canvas1.height=height;}
else{context.clearRect(0,0,width,height);}
context.setTransform(image.scaleX,0,0,image.scaleY,image.left,image.top);context.drawImage(image._element,0,0,width,height);blendData=context.getImageData(0,0,width,height).data;for(var i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];a=data[i+3];tr=blendData[i];tg=blendData[i+1];tb=blendData[i+2];ta=blendData[i+3];switch(this.mode){case'multiply':data[i]=r*tr/255;data[i+1]=g*tg/255;data[i+2]=b*tb/255;data[i+3]=a*ta/255;break;case'mask':data[i+3]=ta;break;}}},getUniformLocations:function(gl,program){return{uTransformMatrix:gl.getUniformLocation(program,'uTransformMatrix'),uImage:gl.getUniformLocation(program,'uImage'),};},sendUniformData:function(gl,uniformLocations){var matrix=this.calculateMatrix();gl.uniform1i(uniformLocations.uImage,1);gl.uniformMatrix3fv(uniformLocations.uTransformMatrix,false,matrix);},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha};}});fabric.Image.filters.BlendImage.fromObject=function(object,callback){fabric.Image.fromObject(object.image,function(image){var options=fabric.util.object.clone(object);options.image=image;callback(new fabric.Image.filters.BlendImage(options));});};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),pow=Math.pow,floor=Math.floor,sqrt=Math.sqrt,abs=Math.abs,round=Math.round,sin=Math.sin,ceil=Math.ceil,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Resize=createClass(filters.BaseFilter,{type:'Resize',resizeType:'hermite',scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(gl,program){return{uDelta:gl.getUniformLocation(program,'uDelta'),uTaps:gl.getUniformLocation(program,'uTaps'),};},sendUniformData:function(gl,uniformLocations){gl.uniform2fv(uniformLocations.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]);gl.uniform1fv(uniformLocations.uTaps,this.taps);},retrieveShader:function(options){var filterWindow=this.getFilterWindow(),cacheKey=this.type+'_'+filterWindow;if(!options.programCache.hasOwnProperty(cacheKey)){var fragmentShader=this.generateShader(filterWindow);options.programCache[cacheKey]=this.createProgram(options.context,fragmentShader);}
return options.programCache[cacheKey];},getFilterWindow:function(){var scale=this.tempScale;return Math.ceil(this.lanczosLobes/scale);},getTaps:function(){var lobeFunction=this.lanczosCreate(this.lanczosLobes),scale=this.tempScale,filterWindow=this.getFilterWindow(),taps=new Array(filterWindow);for(var i=1;i<=filterWindow;i++){taps[i-1]=lobeFunction(i*scale);}
return taps;},generateShader:function(filterWindow){var offsets=new Array(filterWindow),fragmentShader=this.fragmentSourceTOP,filterWindow;for(var i=1;i<=filterWindow;i++){offsets[i-1]=i+'.0 * uDelta';}
fragmentShader+='uniform float uTaps['+filterWindow+'];\n';fragmentShader+='void main() {\n';fragmentShader+='  vec4 color = texture2D(uTexture, vTexCoord);\n';fragmentShader+='  float sum = 1.0;\n';offsets.forEach(function(offset,i){fragmentShader+='  color += texture2D(uTexture, vTexCoord + '+offset+') * uTaps['+i+'];\n';fragmentShader+='  color += texture2D(uTexture, vTexCoord - '+offset+') * uTaps['+i+'];\n';fragmentShader+='  sum += 2.0 * uTaps['+i+'];\n';});fragmentShader+='  gl_FragColor = color / sum;\n';fragmentShader+='}';return fragmentShader;},fragmentSourceTOP:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec2 uDelta;\n'+'varying vec2 vTexCoord;\n',applyTo:function(options){if(options.webgl){options.passes++;this.width=options.sourceWidth;this.horizontal=true;this.dW=Math.round(this.width*this.scaleX);this.dH=options.sourceHeight;this.tempScale=this.dW/this.width;this.taps=this.getTaps();options.destinationWidth=this.dW;this._setupFrameBuffer(options);this.applyToWebGL(options);this._swapTextures(options);options.sourceWidth=options.destinationWidth;this.height=options.sourceHeight;this.horizontal=false;this.dH=Math.round(this.height*this.scaleY);this.tempScale=this.dH/this.height;this.taps=this.getTaps();options.destinationHeight=this.dH;this._setupFrameBuffer(options);this.applyToWebGL(options);this._swapTextures(options);options.sourceHeight=options.destinationHeight;}
else{this.applyTo2d(options);}},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1;},lanczosCreate:function(lobes){return function(x){if(x>=lobes||x<=-lobes){return 0.0;}
if(x<1.19209290E-07&&x>-1.19209290E-07){return 1.0;}
x*=Math.PI;var xx=x/lobes;return(sin(x)/x)*sin(xx)/xx;};},applyTo2d:function(options){var imageData=options.imageData,scaleX=this.scaleX,scaleY=this.scaleY;this.rcpScaleX=1/scaleX;this.rcpScaleY=1/scaleY;var oW=imageData.width,oH=imageData.height,dW=round(oW*scaleX),dH=round(oH*scaleY),newData;if(this.resizeType==='sliceHack'){newData=this.sliceByTwo(options,oW,oH,dW,dH);}
else if(this.resizeType==='hermite'){newData=this.hermiteFastResize(options,oW,oH,dW,dH);}
else if(this.resizeType==='bilinear'){newData=this.bilinearFiltering(options,oW,oH,dW,dH);}
else if(this.resizeType==='lanczos'){newData=this.lanczosResize(options,oW,oH,dW,dH);}
options.imageData=newData;},sliceByTwo:function(options,oW,oH,dW,dH){var imageData=options.imageData,mult=0.5,doneW=false,doneH=false,stepW=oW*mult,stepH=oH*mult,resources=fabric.filterBackend.resources,tmpCanvas,ctx,sX=0,sY=0,dX=oW,dY=0;if(!resources.sliceByTwo){resources.sliceByTwo=document.createElement('canvas');}
tmpCanvas=resources.sliceByTwo;if(tmpCanvas.width<oW*1.5||tmpCanvas.height<oH){tmpCanvas.width=oW*1.5;tmpCanvas.height=oH;}
ctx=tmpCanvas.getContext('2d');ctx.clearRect(0,0,oW*1.5,oH);ctx.putImageData(imageData,0,0);dW=floor(dW);dH=floor(dH);while(!doneW||!doneH){oW=stepW;oH=stepH;if(dW<floor(stepW*mult)){stepW=floor(stepW*mult);}
else{stepW=dW;doneW=true;}
if(dH<floor(stepH*mult)){stepH=floor(stepH*mult);}
else{stepH=dH;doneH=true;}
ctx.drawImage(tmpCanvas,sX,sY,oW,oH,dX,dY,stepW,stepH);sX=dX;sY=dY;dY+=stepH;}
return ctx.getImageData(sX,sY,dW,dH);},lanczosResize:function(options,oW,oH,dW,dH){function process(u){var v,i,weight,idx,a,red,green,blue,alpha,fX,fY;center.x=(u+0.5)*ratioX;icenter.x=floor(center.x);for(v=0;v<dH;v++){center.y=(v+0.5)*ratioY;icenter.y=floor(center.y);a=0;red=0;green=0;blue=0;alpha=0;for(i=icenter.x-range2X;i<=icenter.x+range2X;i++){if(i<0||i>=oW){continue;}
fX=floor(1000*abs(i-center.x));if(!cacheLanc[fX]){cacheLanc[fX]={};}
for(var j=icenter.y-range2Y;j<=icenter.y+range2Y;j++){if(j<0||j>=oH){continue;}
fY=floor(1000*abs(j-center.y));if(!cacheLanc[fX][fY]){cacheLanc[fX][fY]=lanczos(sqrt(pow(fX*rcpRatioX,2)+pow(fY*rcpRatioY,2))/1000);}
weight=cacheLanc[fX][fY];if(weight>0){idx=(j*oW+i)*4;a+=weight;red+=weight*srcData[idx];green+=weight*srcData[idx+1];blue+=weight*srcData[idx+2];alpha+=weight*srcData[idx+3];}}}
idx=(v*dW+u)*4;destData[idx]=red/a;destData[idx+1]=green/a;destData[idx+2]=blue/a;destData[idx+3]=alpha/a;}
if(++u<dW){return process(u);}
else{return destImg;}}
var srcData=options.imageData.data,destImg=options.ctx.createImageData(dW,dH),destData=destImg.data,lanczos=this.lanczosCreate(this.lanczosLobes),ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,rcpRatioX=2/this.rcpScaleX,rcpRatioY=2/this.rcpScaleY,range2X=ceil(ratioX*this.lanczosLobes/2),range2Y=ceil(ratioY*this.lanczosLobes/2),cacheLanc={},center={},icenter={};return process(0);},bilinearFiltering:function(options,oW,oH,dW,dH){var a,b,c,d,x,y,i,j,xDiff,yDiff,chnl,color,offset=0,origPix,ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,w4=4*(oW-1),img=options.imageData,pixels=img.data,destImage=options.ctx.createImageData(dW,dH),destPixels=destImage.data;for(i=0;i<dH;i++){for(j=0;j<dW;j++){x=floor(ratioX*j);y=floor(ratioY*i);xDiff=ratioX*j-x;yDiff=ratioY*i-y;origPix=4*(y*oW+x);for(chnl=0;chnl<4;chnl++){a=pixels[origPix+chnl];b=pixels[origPix+4+chnl];c=pixels[origPix+w4+chnl];d=pixels[origPix+w4+4+chnl];color=a*(1-xDiff)*(1-yDiff)+b*xDiff*(1-yDiff)+
c*yDiff*(1-xDiff)+d*xDiff*yDiff;destPixels[offset++]=color;}}}
return destImage;},hermiteFastResize:function(options,oW,oH,dW,dH){var ratioW=this.rcpScaleX,ratioH=this.rcpScaleY,ratioWHalf=ceil(ratioW/2),ratioHHalf=ceil(ratioH/2),img=options.imageData,data=img.data,img2=options.ctx.createImageData(dW,dH),data2=img2.data;for(var j=0;j<dH;j++){for(var i=0;i<dW;i++){var x2=(i+j*dW)*4,weight=0,weights=0,weightsAlpha=0,gxR=0,gxG=0,gxB=0,gxA=0,centerY=(j+0.5)*ratioH;for(var yy=floor(j*ratioH);yy<(j+1)*ratioH;yy++){var dy=abs(centerY-(yy+0.5))/ratioHHalf,centerX=(i+0.5)*ratioW,w0=dy*dy;for(var xx=floor(i*ratioW);xx<(i+1)*ratioW;xx++){var dx=abs(centerX-(xx+0.5))/ratioWHalf,w=sqrt(w0+dx*dx);if(w>1&&w<-1){continue;}
weight=2*w*w*w-3*w*w+1;if(weight>0){dx=4*(xx+yy*oW);gxA+=weight*data[dx+3];weightsAlpha+=weight;if(data[dx+3]<255){weight=weight*data[dx+3]/250;}
gxR+=weight*data[dx];gxG+=weight*data[dx+1];gxB+=weight*data[dx+2];weights+=weight;}}}
data2[x2]=gxR/weights;data2[x2+1]=gxG/weights;data2[x2+2]=gxB/weights;data2[x2+3]=gxA/weightsAlpha;}}
return img2;},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes};}});fabric.Image.filters.Resize.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Contrast=createClass(filters.BaseFilter,{type:'Contrast',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uContrast;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n'+'color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n'+'gl_FragColor = color;\n'+'}',contrast:0,mainParameter:'contrast',applyTo2d:function(options){if(this.contrast===0){return;}
var imageData=options.imageData,i,len,data=imageData.data,len=data.length,contrast=Math.floor(this.contrast*255),contrastF=259*(contrast+255)/(255*(259-contrast));for(i=0;i<len;i+=4){data[i]=contrastF*(data[i]-128)+128;data[i+1]=contrastF*(data[i+1]-128)+128;data[i+2]=contrastF*(data[i+2]-128)+128;}},getUniformLocations:function(gl,program){return{uContrast:gl.getUniformLocation(program,'uContrast'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uContrast,this.contrast);},});fabric.Image.filters.Contrast.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Saturation=createClass(filters.BaseFilter,{type:'Saturation',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uSaturation;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'float rgMax = max(color.r, color.g);\n'+'float rgbMax = max(rgMax, color.b);\n'+'color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n'+'color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n'+'color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n'+'gl_FragColor = color;\n'+'}',saturation:0,mainParameter:'saturation',applyTo2d:function(options){if(this.saturation===0){return;}
var imageData=options.imageData,data=imageData.data,len=data.length,adjust=-this.saturation,i,max;for(i=0;i<len;i+=4){max=Math.max(data[i],data[i+1],data[i+2]);data[i]+=max!==data[i]?(max-data[i])*adjust:0;data[i+1]+=max!==data[i+1]?(max-data[i+1])*adjust:0;data[i+2]+=max!==data[i+2]?(max-data[i+2])*adjust:0;}},getUniformLocations:function(gl,program){return{uSaturation:gl.getUniformLocation(program,'uSaturation'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uSaturation,-this.saturation);},});fabric.Image.filters.Saturation.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Vibrance=createClass(filters.BaseFilter,{type:'Vibrance',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uVibrance;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'float max = max(color.r, max(color.g, color.b));\n'+'float avg = (color.r + color.g + color.b) / 3.0;\n'+'float amt = (abs(max - avg) * 2.0) * uVibrance;\n'+'color.r += max != color.r ? (max - color.r) * amt : 0.00;\n'+'color.g += max != color.g ? (max - color.g) * amt : 0.00;\n'+'color.b += max != color.b ? (max - color.b) * amt : 0.00;\n'+'gl_FragColor = color;\n'+'}',vibrance:0,mainParameter:'vibrance',applyTo2d:function(options){if(this.vibrance===0){return;}
var imageData=options.imageData,data=imageData.data,len=data.length,adjust=-this.vibrance,i,max,avg,amt;for(i=0;i<len;i+=4){max=Math.max(data[i],data[i+1],data[i+2]);avg=(data[i]+data[i+1]+data[i+2])/3;amt=((Math.abs(max-avg)*2/255)*adjust);data[i]+=max!==data[i]?(max-data[i])*amt:0;data[i+1]+=max!==data[i+1]?(max-data[i+1])*amt:0;data[i+2]+=max!==data[i+2]?(max-data[i+2])*amt:0;}},getUniformLocations:function(gl,program){return{uVibrance:gl.getUniformLocation(program,'uVibrance'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uVibrance,-this.vibrance);},});fabric.Image.filters.Vibrance.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Blur=createClass(filters.BaseFilter,{type:'Blur',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec2 uDelta;\n'+'varying vec2 vTexCoord;\n'+'const float nSamples = 15.0;\n'+'vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n'+'float random(vec3 scale) {\n'+'return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n'+'}\n'+'void main() {\n'+'vec4 color = vec4(0.0);\n'+'float total = 0.0;\n'+'float offset = random(v3offset);\n'+'for (float t = -nSamples; t <= nSamples; t++) {\n'+'float percent = (t + offset - 0.5) / nSamples;\n'+'float weight = 1.0 - abs(percent);\n'+'color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\n'+'total += weight;\n'+'}\n'+'gl_FragColor = color / total;\n'+'}',blur:0,mainParameter:'blur',applyTo:function(options){if(options.webgl){this.aspectRatio=options.sourceWidth/options.sourceHeight;options.passes++;this._setupFrameBuffer(options);this.horizontal=true;this.applyToWebGL(options);this._swapTextures(options);this._setupFrameBuffer(options);this.horizontal=false;this.applyToWebGL(options);this._swapTextures(options);}
else{this.applyTo2d(options);}},applyTo2d:function(options){options.imageData=this.simpleBlur(options);},simpleBlur:function(options){var resources=options.filterBackend.resources,canvas1,canvas2,width=options.imageData.width,height=options.imageData.height;if(!resources.blurLayer1){resources.blurLayer1=fabric.util.createCanvasElement();resources.blurLayer2=fabric.util.createCanvasElement();}
canvas1=resources.blurLayer1;canvas2=resources.blurLayer2;if(canvas1.width!==width||canvas1.height!==height){canvas2.width=canvas1.width=width;canvas2.height=canvas1.height=height;}
var ctx1=canvas1.getContext('2d'),ctx2=canvas2.getContext('2d'),nSamples=15,random,percent,j,i,blur=this.blur*0.06*0.5;ctx1.putImageData(options.imageData,0,0);ctx2.clearRect(0,0,width,height);for(i=-nSamples;i<=nSamples;i++){random=(Math.random()-0.5)/4;percent=i/nSamples;j=blur*percent*width+random;ctx2.globalAlpha=1-Math.abs(percent);ctx2.drawImage(canvas1,j,random);ctx1.drawImage(canvas2,0,0);ctx2.globalAlpha=1;ctx2.clearRect(0,0,canvas2.width,canvas2.height);}
for(i=-nSamples;i<=nSamples;i++){random=(Math.random()-0.5)/4;percent=i/nSamples;j=blur*percent*height+random;ctx2.globalAlpha=1-Math.abs(percent);ctx2.drawImage(canvas1,random,j);ctx1.drawImage(canvas2,0,0);ctx2.globalAlpha=1;ctx2.clearRect(0,0,canvas2.width,canvas2.height);}
options.ctx.drawImage(canvas1,0,0);var newImageData=options.ctx.getImageData(0,0,canvas1.width,canvas1.height);ctx1.globalAlpha=1;ctx1.clearRect(0,0,canvas1.width,canvas1.height);return newImageData;},getUniformLocations:function(gl,program){return{delta:gl.getUniformLocation(program,'uDelta'),};},sendUniformData:function(gl,uniformLocations){var delta=this.chooseRightDelta();gl.uniform2fv(uniformLocations.delta,delta);},chooseRightDelta:function(){var blurScale=1,delta=[0,0],blur;if(this.horizontal){if(this.aspectRatio>1){blurScale=1/this.aspectRatio;}}
else{if(this.aspectRatio<1){blurScale=this.aspectRatio;}}
blur=blurScale*this.blur*0.12;if(this.horizontal){delta[0]=blur;}
else{delta[1]=blur;}
return delta;},});filters.Blur.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Gamma=createClass(filters.BaseFilter,{type:'Gamma',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec3 uGamma;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'vec3 correction = (1.0 / uGamma);\n'+'color.r = pow(color.r, correction.r);\n'+'color.g = pow(color.g, correction.g);\n'+'color.b = pow(color.b, correction.b);\n'+'gl_FragColor = color;\n'+'gl_FragColor.rgb *= color.a;\n'+'}',gamma:[1,1,1],mainParameter:'gamma',initialize:function(options){this.gamma=[1,1,1];filters.BaseFilter.prototype.initialize.call(this,options);},applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,gamma=this.gamma,len=data.length,rInv=1/gamma[0],gInv=1/gamma[1],bInv=1/gamma[2],i;if(!this.rVals){this.rVals=new Uint8Array(256);this.gVals=new Uint8Array(256);this.bVals=new Uint8Array(256);}
for(i=0,len=256;i<len;i++){this.rVals[i]=Math.pow(i/255,rInv)*255;this.gVals[i]=Math.pow(i/255,gInv)*255;this.bVals[i]=Math.pow(i/255,bInv)*255;}
for(i=0,len=data.length;i<len;i+=4){data[i]=this.rVals[data[i]];data[i+1]=this.gVals[data[i+1]];data[i+2]=this.bVals[data[i+2]];}},getUniformLocations:function(gl,program){return{uGamma:gl.getUniformLocation(program,'uGamma'),};},sendUniformData:function(gl,uniformLocations){gl.uniform3fv(uniformLocations.uGamma,this.gamma);},});fabric.Image.filters.Gamma.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Composed=createClass(filters.BaseFilter,{type:'Composed',subFilters:[],initialize:function(options){this.callSuper('initialize',options);this.subFilters=this.subFilters.slice(0);},applyTo:function(options){options.passes+=this.subFilters.length-1;this.subFilters.forEach(function(filter){filter.applyTo(options);});},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{subFilters:this.subFilters.map(function(filter){return filter.toObject();}),});},isNeutralState:function(){return!this.subFilters.some(function(filter){return!filter.isNeutralState();});}});fabric.Image.filters.Composed.fromObject=function(object,callback){var filters=object.subFilters||[],subFilters=filters.map(function(filter){return new fabric.Image.filters[filter.type](filter);}),instance=new fabric.Image.filters.Composed({subFilters:subFilters});callback&&callback(instance);return instance;};})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.HueRotation=createClass(filters.ColorMatrix,{type:'HueRotation',rotation:0,mainParameter:'rotation',calculateMatrix:function(){var rad=this.rotation*Math.PI,cos=fabric.util.cos(rad),sin=fabric.util.sin(rad),aThird=1/3,aThirdSqtSin=Math.sqrt(aThird)*sin,OneMinusCos=1-cos;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this.matrix[0]=cos+OneMinusCos/3;this.matrix[1]=aThird*OneMinusCos-aThirdSqtSin;this.matrix[2]=aThird*OneMinusCos+aThirdSqtSin;this.matrix[5]=aThird*OneMinusCos+aThirdSqtSin;this.matrix[6]=cos+aThird*OneMinusCos;this.matrix[7]=aThird*OneMinusCos-aThirdSqtSin;this.matrix[10]=aThird*OneMinusCos-aThirdSqtSin;this.matrix[11]=aThird*OneMinusCos+aThirdSqtSin;this.matrix[12]=cos+aThird*OneMinusCos;},isNeutralState:function(options){this.calculateMatrix();return filters.BaseFilter.prototype.isNeutralState.call(this,options);},applyTo:function(options){this.calculateMatrix();filters.BaseFilter.prototype.applyTo.call(this,options);},});fabric.Image.filters.HueRotation.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(typeof exports!=='undefined'?exports:this);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),clone=fabric.util.object.clone;if(fabric.Text){fabric.warn('fabric.Text is already defined');return;}
var additionalProps=('fontFamily fontWeight fontSize text underline overline linethrough'+' textAlign fontStyle lineHeight textBackgroundColor charSpacing styles'+' direction path pathStartOffset pathSide pathAlign').split(' ');fabric.Text=fabric.util.createClass(fabric.Object,{_dimensionAffectingProps:['fontSize','fontWeight','fontFamily','fontStyle','lineHeight','text','charSpacing','textAlign','styles','path','pathStartOffset','pathSide','pathAlign'],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:'text',fontSize:40,fontWeight:'normal',fontFamily:'Times New Roman',underline:false,overline:false,linethrough:false,textAlign:'left',fontStyle:'normal',lineHeight:1.16,superscript:{size:0.60,baseline:-0.35},subscript:{size:0.60,baseline:0.11},textBackgroundColor:'',stateProperties:fabric.Object.prototype.stateProperties.concat(additionalProps),cacheProperties:fabric.Object.prototype.cacheProperties.concat(additionalProps),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:'left',pathAlign:'baseline',_fontSizeFraction:0.222,offsets:{underline:0.10,linethrough:-0.315,overline:-0.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:'ltr',_styleProperties:['stroke','strokeWidth','fill','fontFamily','fontSize','fontWeight','fontStyle','underline','overline','linethrough','deltaY','textBackgroundColor',],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(text,options){this.styles=options?(options.styles||{}):{};this.text=text;this.__skipDimension=true;this.callSuper('initialize',options);if(this.path){this.setPathInfo();}
this.__skipDimension=false;this.initDimensions();this.setCoords();this.setupState({propertySet:'_dimensionAffectingProps'});},setPathInfo:function(){var path=this.path;if(path){path.segmentsInfo=fabric.util.getPathSegmentsInfo(path.path);}},getMeasuringContext:function(){if(!fabric._measuringContext){fabric._measuringContext=this.canvas&&this.canvas.contextCache||fabric.util.createCanvasElement().getContext('2d');}
return fabric._measuringContext;},_splitText:function(){var newLines=this._splitTextIntoLines(this.text);this.textLines=newLines.lines;this._textLines=newLines.graphemeLines;this._unwrappedTextLines=newLines._unwrappedLines;this._text=newLines.graphemeText;return newLines;},initDimensions:function(){if(this.__skipDimension){return;}
this._splitText();this._clearCache();if(this.path){this.width=this.path.width;this.height=this.path.height;}
else{this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH;this.height=this.calcTextHeight();}
if(this.textAlign.indexOf('justify')!==-1){this.enlargeSpaces();}
this.saveState({propertySet:'_dimensionAffectingProps'});},enlargeSpaces:function(){var diffSpace,currentLineWidth,numberOfSpaces,accumulatedSpace,line,charBound,spaces;for(var i=0,len=this._textLines.length;i<len;i++){if(this.textAlign!=='justify'&&(i===len-1||this.isEndOfWrapping(i))){continue;}
accumulatedSpace=0;line=this._textLines[i];currentLineWidth=this.getLineWidth(i);if(currentLineWidth<this.width&&(spaces=this.textLines[i].match(this._reSpacesAndTabs))){numberOfSpaces=spaces.length;diffSpace=(this.width-currentLineWidth)/numberOfSpaces;for(var j=0,jlen=line.length;j<=jlen;j++){charBound=this.__charBounds[i][j];if(this._reSpaceAndTab.test(line[j])){charBound.width+=diffSpace;charBound.kernedWidth+=diffSpace;charBound.left+=accumulatedSpace;accumulatedSpace+=diffSpace;}
else{charBound.left+=accumulatedSpace;}}}}},isEndOfWrapping:function(lineIndex){return lineIndex===this._textLines.length-1;},missingNewlineOffset:function(){return 1;},toString:function(){return'#<fabric.Text ('+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>';},_getCacheCanvasDimensions:function(){var dims=this.callSuper('_getCacheCanvasDimensions');var fontSize=this.fontSize;dims.width+=fontSize*dims.zoomX;dims.height+=fontSize*dims.zoomY;return dims;},_render:function(ctx){var path=this.path;path&&!path.isNotVisible()&&path._render(ctx);this._setTextStyles(ctx);this._renderTextLinesBackground(ctx);this._renderTextDecoration(ctx,'underline');this._renderText(ctx);this._renderTextDecoration(ctx,'overline');this._renderTextDecoration(ctx,'linethrough');},_renderText:function(ctx){if(this.paintFirst==='stroke'){this._renderTextStroke(ctx);this._renderTextFill(ctx);}
else{this._renderTextFill(ctx);this._renderTextStroke(ctx);}},_setTextStyles:function(ctx,charStyle,forMeasuring){ctx.textBaseline='alphabetical';if(this.path){switch(this.pathAlign){case'center':ctx.textBaseline='middle';break;case'ascender':ctx.textBaseline='top';break;case'descender':ctx.textBaseline='bottom';break;}}
ctx.font=this._getFontDeclaration(charStyle,forMeasuring);},calcTextWidth:function(){var maxWidth=this.getLineWidth(0);for(var i=1,len=this._textLines.length;i<len;i++){var currentLineWidth=this.getLineWidth(i);if(currentLineWidth>maxWidth){maxWidth=currentLineWidth;}}
return maxWidth;},_renderTextLine:function(method,ctx,line,left,top,lineIndex){this._renderChars(method,ctx,line,left,top,lineIndex);},_renderTextLinesBackground:function(ctx){if(!this.textBackgroundColor&&!this.styleHas('textBackgroundColor')){return;}
var heightOfLine,lineLeftOffset,originalFill=ctx.fillStyle,line,lastColor,leftOffset=this._getLeftOffset(),lineTopOffset=this._getTopOffset(),boxStart=0,boxWidth=0,charBox,currentColor,path=this.path,drawStart;for(var i=0,len=this._textLines.length;i<len;i++){heightOfLine=this.getHeightOfLine(i);if(!this.textBackgroundColor&&!this.styleHas('textBackgroundColor',i)){lineTopOffset+=heightOfLine;continue;}
line=this._textLines[i];lineLeftOffset=this._getLineLeftOffset(i);boxWidth=0;boxStart=0;lastColor=this.getValueOfPropertyAt(i,0,'textBackgroundColor');for(var j=0,jlen=line.length;j<jlen;j++){charBox=this.__charBounds[i][j];currentColor=this.getValueOfPropertyAt(i,j,'textBackgroundColor');if(path){ctx.save();ctx.translate(charBox.renderLeft,charBox.renderTop);ctx.rotate(charBox.angle);ctx.fillStyle=currentColor;currentColor&&ctx.fillRect(-charBox.width/2,-heightOfLine/this.lineHeight*(1-this._fontSizeFraction),charBox.width,heightOfLine/this.lineHeight);ctx.restore();}
else if(currentColor!==lastColor){drawStart=leftOffset+lineLeftOffset+boxStart;if(this.direction==='rtl'){drawStart=this.width-drawStart-boxWidth;}
ctx.fillStyle=lastColor;lastColor&&ctx.fillRect(drawStart,lineTopOffset,boxWidth,heightOfLine/this.lineHeight);boxStart=charBox.left;boxWidth=charBox.width;lastColor=currentColor;}
else{boxWidth+=charBox.kernedWidth;}}
if(currentColor&&!path){drawStart=leftOffset+lineLeftOffset+boxStart;if(this.direction==='rtl'){drawStart=this.width-drawStart-boxWidth;}
ctx.fillStyle=currentColor;ctx.fillRect(drawStart,lineTopOffset,boxWidth,heightOfLine/this.lineHeight);}
lineTopOffset+=heightOfLine;}
ctx.fillStyle=originalFill;this._removeShadow(ctx);},getFontCache:function(decl){var fontFamily=decl.fontFamily.toLowerCase();if(!fabric.charWidthsCache[fontFamily]){fabric.charWidthsCache[fontFamily]={};}
var cache=fabric.charWidthsCache[fontFamily],cacheProp=decl.fontStyle.toLowerCase()+'_'+(decl.fontWeight+'').toLowerCase();if(!cache[cacheProp]){cache[cacheProp]={};}
return cache[cacheProp];},_measureChar:function(_char,charStyle,previousChar,prevCharStyle){var fontCache=this.getFontCache(charStyle),fontDeclaration=this._getFontDeclaration(charStyle),previousFontDeclaration=this._getFontDeclaration(prevCharStyle),couple=previousChar+_char,stylesAreEqual=fontDeclaration===previousFontDeclaration,width,coupleWidth,previousWidth,fontMultiplier=charStyle.fontSize/this.CACHE_FONT_SIZE,kernedWidth;if(previousChar&&fontCache[previousChar]!==undefined){previousWidth=fontCache[previousChar];}
if(fontCache[_char]!==undefined){kernedWidth=width=fontCache[_char];}
if(stylesAreEqual&&fontCache[couple]!==undefined){coupleWidth=fontCache[couple];kernedWidth=coupleWidth-previousWidth;}
if(width===undefined||previousWidth===undefined||coupleWidth===undefined){var ctx=this.getMeasuringContext();this._setTextStyles(ctx,charStyle,true);}
if(width===undefined){kernedWidth=width=ctx.measureText(_char).width;fontCache[_char]=width;}
if(previousWidth===undefined&&stylesAreEqual&&previousChar){previousWidth=ctx.measureText(previousChar).width;fontCache[previousChar]=previousWidth;}
if(stylesAreEqual&&coupleWidth===undefined){coupleWidth=ctx.measureText(couple).width;fontCache[couple]=coupleWidth;kernedWidth=coupleWidth-previousWidth;}
return{width:width*fontMultiplier,kernedWidth:kernedWidth*fontMultiplier};},getHeightOfChar:function(line,_char){return this.getValueOfPropertyAt(line,_char,'fontSize');},measureLine:function(lineIndex){var lineInfo=this._measureLine(lineIndex);if(this.charSpacing!==0){lineInfo.width-=this._getWidthOfCharSpacing();}
if(lineInfo.width<0){lineInfo.width=0;}
return lineInfo;},_measureLine:function(lineIndex){var width=0,i,grapheme,line=this._textLines[lineIndex],prevGrapheme,graphemeInfo,numOfSpaces=0,lineBounds=new Array(line.length),positionInPath=0,startingPoint,totalPathLength,path=this.path,reverse=this.pathSide==='right';this.__charBounds[lineIndex]=lineBounds;for(i=0;i<line.length;i++){grapheme=line[i];graphemeInfo=this._getGraphemeBox(grapheme,lineIndex,i,prevGrapheme);lineBounds[i]=graphemeInfo;width+=graphemeInfo.kernedWidth;prevGrapheme=grapheme;}
lineBounds[i]={left:graphemeInfo?graphemeInfo.left+graphemeInfo.width:0,width:0,kernedWidth:0,height:this.fontSize};if(path){totalPathLength=path.segmentsInfo[path.segmentsInfo.length-1].length;startingPoint=fabric.util.getPointOnPath(path.path,0,path.segmentsInfo);startingPoint.x+=path.pathOffset.x;startingPoint.y+=path.pathOffset.y;switch(this.textAlign){case'left':positionInPath=reverse?(totalPathLength-width):0;break;case'center':positionInPath=(totalPathLength-width)/2;break;case'right':positionInPath=reverse?0:(totalPathLength-width);break;}
positionInPath+=this.pathStartOffset*(reverse?-1:1);for(i=reverse?line.length-1:0;reverse?i>=0:i<line.length;reverse?i--:i++){graphemeInfo=lineBounds[i];if(positionInPath>totalPathLength){positionInPath%=totalPathLength;}
else if(positionInPath<0){positionInPath+=totalPathLength;}
this._setGraphemeOnPath(positionInPath,graphemeInfo,startingPoint);positionInPath+=graphemeInfo.kernedWidth;}}
return{width:width,numOfSpaces:numOfSpaces};},_setGraphemeOnPath:function(positionInPath,graphemeInfo,startingPoint){var centerPosition=positionInPath+graphemeInfo.kernedWidth/2,path=this.path;var info=fabric.util.getPointOnPath(path.path,centerPosition,path.segmentsInfo);graphemeInfo.renderLeft=info.x-startingPoint.x;graphemeInfo.renderTop=info.y-startingPoint.y;graphemeInfo.angle=info.angle+(this.pathSide==='right'?Math.PI:0);},_getGraphemeBox:function(grapheme,lineIndex,charIndex,prevGrapheme,skipLeft){var style=this.getCompleteStyleDeclaration(lineIndex,charIndex),prevStyle=prevGrapheme?this.getCompleteStyleDeclaration(lineIndex,charIndex-1):{},info=this._measureChar(grapheme,style,prevGrapheme,prevStyle),kernedWidth=info.kernedWidth,width=info.width,charSpacing;if(this.charSpacing!==0){charSpacing=this._getWidthOfCharSpacing();width+=charSpacing;kernedWidth+=charSpacing;}
var box={width:width,left:0,height:style.fontSize,kernedWidth:kernedWidth,deltaY:style.deltaY,};if(charIndex>0&&!skipLeft){var previousBox=this.__charBounds[lineIndex][charIndex-1];box.left=previousBox.left+previousBox.width+info.kernedWidth-info.width;}
return box;},getHeightOfLine:function(lineIndex){if(this.__lineHeights[lineIndex]){return this.__lineHeights[lineIndex];}
var line=this._textLines[lineIndex],maxHeight=this.getHeightOfChar(lineIndex,0);for(var i=1,len=line.length;i<len;i++){maxHeight=Math.max(this.getHeightOfChar(lineIndex,i),maxHeight);}
return this.__lineHeights[lineIndex]=maxHeight*this.lineHeight*this._fontSizeMult;},calcTextHeight:function(){var lineHeight,height=0;for(var i=0,len=this._textLines.length;i<len;i++){lineHeight=this.getHeightOfLine(i);height+=(i===len-1?lineHeight/this.lineHeight:lineHeight);}
return height;},_getLeftOffset:function(){return this.direction==='ltr'?-this.width/2:this.width/2;},_getTopOffset:function(){return-this.height/2;},_renderTextCommon:function(ctx,method){ctx.save();var lineHeights=0,left=this._getLeftOffset(),top=this._getTopOffset();for(var i=0,len=this._textLines.length;i<len;i++){var heightOfLine=this.getHeightOfLine(i),maxHeight=heightOfLine/this.lineHeight,leftOffset=this._getLineLeftOffset(i);this._renderTextLine(method,ctx,this._textLines[i],left+leftOffset,top+lineHeights+maxHeight,i);lineHeights+=heightOfLine;}
ctx.restore();},_renderTextFill:function(ctx){if(!this.fill&&!this.styleHas('fill')){return;}
this._renderTextCommon(ctx,'fillText');},_renderTextStroke:function(ctx){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()){return;}
if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(ctx);}
ctx.save();this._setLineDash(ctx,this.strokeDashArray);ctx.beginPath();this._renderTextCommon(ctx,'strokeText');ctx.closePath();ctx.restore();},_renderChars:function(method,ctx,line,left,top,lineIndex){var lineHeight=this.getHeightOfLine(lineIndex),isJustify=this.textAlign.indexOf('justify')!==-1,actualStyle,nextStyle,charsToRender='',charBox,boxWidth=0,timeToRender,path=this.path,shortCut=!isJustify&&this.charSpacing===0&&this.isEmptyStyles(lineIndex)&&!path,isLtr=this.direction==='ltr',sign=this.direction==='ltr'?1:-1,drawingLeft,currentDirection=ctx.canvas.getAttribute('dir');ctx.save();if(currentDirection!==this.direction){ctx.canvas.setAttribute('dir',isLtr?'ltr':'rtl');ctx.direction=isLtr?'ltr':'rtl';ctx.textAlign=isLtr?'left':'right';}
top-=lineHeight*this._fontSizeFraction/this.lineHeight;if(shortCut){this._renderChar(method,ctx,lineIndex,0,line.join(''),left,top,lineHeight);ctx.restore();return;}
for(var i=0,len=line.length-1;i<=len;i++){timeToRender=i===len||this.charSpacing||path;charsToRender+=line[i];charBox=this.__charBounds[lineIndex][i];if(boxWidth===0){left+=sign*(charBox.kernedWidth-charBox.width);boxWidth+=charBox.width;}
else{boxWidth+=charBox.kernedWidth;}
if(isJustify&&!timeToRender){if(this._reSpaceAndTab.test(line[i])){timeToRender=true;}}
if(!timeToRender){actualStyle=actualStyle||this.getCompleteStyleDeclaration(lineIndex,i);nextStyle=this.getCompleteStyleDeclaration(lineIndex,i+1);timeToRender=this._hasStyleChanged(actualStyle,nextStyle);}
if(timeToRender){if(path){ctx.save();ctx.translate(charBox.renderLeft,charBox.renderTop);ctx.rotate(charBox.angle);this._renderChar(method,ctx,lineIndex,i,charsToRender,-boxWidth/2,0,lineHeight);ctx.restore();}
else{drawingLeft=left;this._renderChar(method,ctx,lineIndex,i,charsToRender,drawingLeft,top,lineHeight);}
charsToRender='';actualStyle=nextStyle;left+=sign*boxWidth;boxWidth=0;}}
ctx.restore();},_applyPatternGradientTransformText:function(filler){var pCanvas=fabric.util.createCanvasElement(),pCtx,width=this.width+this.strokeWidth,height=this.height+this.strokeWidth;pCanvas.width=width;pCanvas.height=height;pCtx=pCanvas.getContext('2d');pCtx.beginPath();pCtx.moveTo(0,0);pCtx.lineTo(width,0);pCtx.lineTo(width,height);pCtx.lineTo(0,height);pCtx.closePath();pCtx.translate(width/2,height/2);pCtx.fillStyle=filler.toLive(pCtx);this._applyPatternGradientTransform(pCtx,filler);pCtx.fill();return pCtx.createPattern(pCanvas,'no-repeat');},handleFiller:function(ctx,property,filler){var offsetX,offsetY;if(filler.toLive){if(filler.gradientUnits==='percentage'||filler.gradientTransform||filler.patternTransform){offsetX=-this.width/2;offsetY=-this.height/2;ctx.translate(offsetX,offsetY);ctx[property]=this._applyPatternGradientTransformText(filler);return{offsetX:offsetX,offsetY:offsetY};}
else{ctx[property]=filler.toLive(ctx,this);return this._applyPatternGradientTransform(ctx,filler);}}
else{ctx[property]=filler;}
return{offsetX:0,offsetY:0};},_setStrokeStyles:function(ctx,decl){ctx.lineWidth=decl.strokeWidth;ctx.lineCap=this.strokeLineCap;ctx.lineDashOffset=this.strokeDashOffset;ctx.lineJoin=this.strokeLineJoin;ctx.miterLimit=this.strokeMiterLimit;return this.handleFiller(ctx,'strokeStyle',decl.stroke);},_setFillStyles:function(ctx,decl){return this.handleFiller(ctx,'fillStyle',decl.fill);},_renderChar:function(method,ctx,lineIndex,charIndex,_char,left,top){var decl=this._getStyleDeclaration(lineIndex,charIndex),fullDecl=this.getCompleteStyleDeclaration(lineIndex,charIndex),shouldFill=method==='fillText'&&fullDecl.fill,shouldStroke=method==='strokeText'&&fullDecl.stroke&&fullDecl.strokeWidth,fillOffsets,strokeOffsets;if(!shouldStroke&&!shouldFill){return;}
ctx.save();shouldFill&&(fillOffsets=this._setFillStyles(ctx,fullDecl));shouldStroke&&(strokeOffsets=this._setStrokeStyles(ctx,fullDecl));ctx.font=this._getFontDeclaration(fullDecl);if(decl&&decl.textBackgroundColor){this._removeShadow(ctx);}
if(decl&&decl.deltaY){top+=decl.deltaY;}
shouldFill&&ctx.fillText(_char,left-fillOffsets.offsetX,top-fillOffsets.offsetY);shouldStroke&&ctx.strokeText(_char,left-strokeOffsets.offsetX,top-strokeOffsets.offsetY);ctx.restore();},setSuperscript:function(start,end){return this._setScript(start,end,this.superscript);},setSubscript:function(start,end){return this._setScript(start,end,this.subscript);},_setScript:function(start,end,schema){var loc=this.get2DCursorLocation(start,true),fontSize=this.getValueOfPropertyAt(loc.lineIndex,loc.charIndex,'fontSize'),dy=this.getValueOfPropertyAt(loc.lineIndex,loc.charIndex,'deltaY'),style={fontSize:fontSize*schema.size,deltaY:dy+fontSize*schema.baseline};this.setSelectionStyles(style,start,end);return this;},_hasStyleChanged:function(prevStyle,thisStyle){return prevStyle.fill!==thisStyle.fill||prevStyle.stroke!==thisStyle.stroke||prevStyle.strokeWidth!==thisStyle.strokeWidth||prevStyle.fontSize!==thisStyle.fontSize||prevStyle.fontFamily!==thisStyle.fontFamily||prevStyle.fontWeight!==thisStyle.fontWeight||prevStyle.fontStyle!==thisStyle.fontStyle||prevStyle.deltaY!==thisStyle.deltaY;},_hasStyleChangedForSvg:function(prevStyle,thisStyle){return this._hasStyleChanged(prevStyle,thisStyle)||prevStyle.overline!==thisStyle.overline||prevStyle.underline!==thisStyle.underline||prevStyle.linethrough!==thisStyle.linethrough;},_getLineLeftOffset:function(lineIndex){var lineWidth=this.getLineWidth(lineIndex),lineDiff=this.width-lineWidth,textAlign=this.textAlign,direction=this.direction,isEndOfWrapping,leftOffset=0,isEndOfWrapping=this.isEndOfWrapping(lineIndex);if(textAlign==='justify'||(textAlign==='justify-center'&&!isEndOfWrapping)||(textAlign==='justify-right'&&!isEndOfWrapping)||(textAlign==='justify-left'&&!isEndOfWrapping)){return 0;}
if(textAlign==='center'){leftOffset=lineDiff/2;}
if(textAlign==='right'){leftOffset=lineDiff;}
if(textAlign==='justify-center'){leftOffset=lineDiff/2;}
if(textAlign==='justify-right'){leftOffset=lineDiff;}
if(direction==='rtl'){leftOffset-=lineDiff;}
return leftOffset;},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__charBounds=[];},_shouldClearDimensionCache:function(){var shouldClear=this._forceClearCache;shouldClear||(shouldClear=this.hasStateChanged('_dimensionAffectingProps'));if(shouldClear){this.dirty=true;this._forceClearCache=false;}
return shouldClear;},getLineWidth:function(lineIndex){if(this.__lineWidths[lineIndex]!==undefined){return this.__lineWidths[lineIndex];}
var lineInfo=this.measureLine(lineIndex);var width=lineInfo.width;this.__lineWidths[lineIndex]=width;return width;},_getWidthOfCharSpacing:function(){if(this.charSpacing!==0){return this.fontSize*this.charSpacing/1000;}
return 0;},getValueOfPropertyAt:function(lineIndex,charIndex,property){var charStyle=this._getStyleDeclaration(lineIndex,charIndex);if(charStyle&&typeof charStyle[property]!=='undefined'){return charStyle[property];}
return this[property];},_renderTextDecoration:function(ctx,type){if(!this[type]&&!this.styleHas(type)){return;}
var heightOfLine,size,_size,lineLeftOffset,dy,_dy,line,lastDecoration,leftOffset=this._getLeftOffset(),topOffset=this._getTopOffset(),top,boxStart,boxWidth,charBox,currentDecoration,maxHeight,currentFill,lastFill,path=this.path,charSpacing=this._getWidthOfCharSpacing(),offsetY=this.offsets[type];for(var i=0,len=this._textLines.length;i<len;i++){heightOfLine=this.getHeightOfLine(i);if(!this[type]&&!this.styleHas(type,i)){topOffset+=heightOfLine;continue;}
line=this._textLines[i];maxHeight=heightOfLine/this.lineHeight;lineLeftOffset=this._getLineLeftOffset(i);boxStart=0;boxWidth=0;lastDecoration=this.getValueOfPropertyAt(i,0,type);lastFill=this.getValueOfPropertyAt(i,0,'fill');top=topOffset+maxHeight*(1-this._fontSizeFraction);size=this.getHeightOfChar(i,0);dy=this.getValueOfPropertyAt(i,0,'deltaY');for(var j=0,jlen=line.length;j<jlen;j++){charBox=this.__charBounds[i][j];currentDecoration=this.getValueOfPropertyAt(i,j,type);currentFill=this.getValueOfPropertyAt(i,j,'fill');_size=this.getHeightOfChar(i,j);_dy=this.getValueOfPropertyAt(i,j,'deltaY');if(path&&currentDecoration&&currentFill){ctx.save();ctx.fillStyle=lastFill;ctx.translate(charBox.renderLeft,charBox.renderTop);ctx.rotate(charBox.angle);ctx.fillRect(-charBox.kernedWidth/2,offsetY*_size+_dy,charBox.kernedWidth,this.fontSize/15);ctx.restore();}
else if((currentDecoration!==lastDecoration||currentFill!==lastFill||_size!==size||_dy!==dy)&&boxWidth>0){var drawStart=leftOffset+lineLeftOffset+boxStart;if(this.direction==='rtl'){drawStart=this.width-drawStart-boxWidth;}
if(lastDecoration&&lastFill){ctx.fillStyle=lastFill;ctx.fillRect(drawStart,top+offsetY*size+dy,boxWidth,this.fontSize/15);}
boxStart=charBox.left;boxWidth=charBox.width;lastDecoration=currentDecoration;lastFill=currentFill;size=_size;dy=_dy;}
else{boxWidth+=charBox.kernedWidth;}}
var drawStart=leftOffset+lineLeftOffset+boxStart;if(this.direction==='rtl'){drawStart=this.width-drawStart-boxWidth;}
ctx.fillStyle=currentFill;currentDecoration&&currentFill&&ctx.fillRect(drawStart,top+offsetY*size+dy,boxWidth-charSpacing,this.fontSize/15);topOffset+=heightOfLine;}
this._removeShadow(ctx);},_getFontDeclaration:function(styleObject,forMeasuring){var style=styleObject||this,family=this.fontFamily,fontIsGeneric=fabric.Text.genericFonts.indexOf(family.toLowerCase())>-1;var fontFamily=family===undefined||family.indexOf('\'')>-1||family.indexOf(',')>-1||family.indexOf('"')>-1||fontIsGeneric?style.fontFamily:'"'+style.fontFamily+'"';return[(fabric.isLikelyNode?style.fontWeight:style.fontStyle),(fabric.isLikelyNode?style.fontStyle:style.fontWeight),forMeasuring?this.CACHE_FONT_SIZE+'px':style.fontSize+'px',fontFamily].join(' ');},render:function(ctx){if(!this.visible){return;}
if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return;}
if(this._shouldClearDimensionCache()){this.initDimensions();}
this.callSuper('render',ctx);},_splitTextIntoLines:function(text){var lines=text.split(this._reNewline),newLines=new Array(lines.length),newLine=['\n'],newText=[];for(var i=0;i<lines.length;i++){newLines[i]=fabric.util.string.graphemeSplit(lines[i]);newText=newText.concat(newLines[i],newLine);}
newText.pop();return{_unwrappedLines:newLines,lines:lines,graphemeText:newText,graphemeLines:newLines};},toObject:function(propertiesToInclude){var allProperties=additionalProps.concat(propertiesToInclude);var obj=this.callSuper('toObject',allProperties);obj.styles=clone(this.styles,true);if(obj.path){obj.path=this.path.toObject();}
return obj;},set:function(key,value){this.callSuper('set',key,value);var needsDims=false;var isAddingPath=false;if(typeof key==='object'){for(var _key in key){if(_key==='path'){this.setPathInfo();}
needsDims=needsDims||this._dimensionAffectingProps.indexOf(_key)!==-1;isAddingPath=isAddingPath||_key==='path';}}
else{needsDims=this._dimensionAffectingProps.indexOf(key)!==-1;isAddingPath=key==='path';}
if(isAddingPath){this.setPathInfo();}
if(needsDims){this.initDimensions();this.setCoords();}
return this;},complexity:function(){return 1;}});fabric.Text.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor'.split(' '));fabric.Text.DEFAULT_SVG_FONT_SIZE=16;fabric.Text.fromElement=function(element,callback,options){if(!element){return callback(null);}
var parsedAttributes=fabric.parseAttributes(element,fabric.Text.ATTRIBUTE_NAMES),parsedAnchor=parsedAttributes.textAnchor||'left';options=fabric.util.object.extend((options?clone(options):{}),parsedAttributes);options.top=options.top||0;options.left=options.left||0;if(parsedAttributes.textDecoration){var textDecoration=parsedAttributes.textDecoration;if(textDecoration.indexOf('underline')!==-1){options.underline=true;}
if(textDecoration.indexOf('overline')!==-1){options.overline=true;}
if(textDecoration.indexOf('line-through')!==-1){options.linethrough=true;}
delete options.textDecoration;}
if('dx'in parsedAttributes){options.left+=parsedAttributes.dx;}
if('dy'in parsedAttributes){options.top+=parsedAttributes.dy;}
if(!('fontSize'in options)){options.fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE;}
var textContent='';if(!('textContent'in element)){if('firstChild'in element&&element.firstChild!==null){if('data'in element.firstChild&&element.firstChild.data!==null){textContent=element.firstChild.data;}}}
else{textContent=element.textContent;}
textContent=textContent.replace(/^\s+|\s+$|\n+/g,'').replace(/\s+/g,' ');var originalStrokeWidth=options.strokeWidth;options.strokeWidth=0;var text=new fabric.Text(textContent,options),textHeightScaleFactor=text.getScaledHeight()/text.height,lineHeightDiff=(text.height+text.strokeWidth)*text.lineHeight-text.height,scaledDiff=lineHeightDiff*textHeightScaleFactor,textHeight=text.getScaledHeight()+scaledDiff,offX=0;if(parsedAnchor==='center'){offX=text.getScaledWidth()/2;}
if(parsedAnchor==='right'){offX=text.getScaledWidth();}
text.set({left:text.left-offX,top:text.top-(textHeight-text.fontSize*(0.07+text._fontSizeFraction))/text.lineHeight,strokeWidth:typeof originalStrokeWidth!=='undefined'?originalStrokeWidth:1,});callback(text);};fabric.Text.fromObject=function(object,callback){var objectCopy=clone(object),path=object.path;delete objectCopy.path;return fabric.Object._fromObject('Text',objectCopy,function(textInstance){if(path){fabric.Object._fromObject('Path',path,function(pathInstance){textInstance.set('path',pathInstance);callback(textInstance);},'path');}
else{callback(textInstance);}},'text');};fabric.Text.genericFonts=['sans-serif','serif','cursive','fantasy','monospace'];fabric.util.createAccessors&&fabric.util.createAccessors(fabric.Text);})(typeof exports!=='undefined'?exports:this);(function(){fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(lineIndex){if(!this.styles){return true;}
if(typeof lineIndex!=='undefined'&&!this.styles[lineIndex]){return true;}
var obj=typeof lineIndex==='undefined'?this.styles:{line:this.styles[lineIndex]};for(var p1 in obj){for(var p2 in obj[p1]){for(var p3 in obj[p1][p2]){return false;}}}
return true;},styleHas:function(property,lineIndex){if(!this.styles||!property||property===''){return false;}
if(typeof lineIndex!=='undefined'&&!this.styles[lineIndex]){return false;}
var obj=typeof lineIndex==='undefined'?this.styles:{0:this.styles[lineIndex]};for(var p1 in obj){for(var p2 in obj[p1]){if(typeof obj[p1][p2][property]!=='undefined'){return true;}}}
return false;},cleanStyle:function(property){if(!this.styles||!property||property===''){return false;}
var obj=this.styles,stylesCount=0,letterCount,stylePropertyValue,allStyleObjectPropertiesMatch=true,graphemeCount=0,styleObject;for(var p1 in obj){letterCount=0;for(var p2 in obj[p1]){var styleObject=obj[p1][p2],stylePropertyHasBeenSet=styleObject.hasOwnProperty(property);stylesCount++;if(stylePropertyHasBeenSet){if(!stylePropertyValue){stylePropertyValue=styleObject[property];}
else if(styleObject[property]!==stylePropertyValue){allStyleObjectPropertiesMatch=false;}
if(styleObject[property]===this[property]){delete styleObject[property];}}
else{allStyleObjectPropertiesMatch=false;}
if(Object.keys(styleObject).length!==0){letterCount++;}
else{delete obj[p1][p2];}}
if(letterCount===0){delete obj[p1];}}
for(var i=0;i<this._textLines.length;i++){graphemeCount+=this._textLines[i].length;}
if(allStyleObjectPropertiesMatch&&stylesCount===graphemeCount){this[property]=stylePropertyValue;this.removeStyle(property);}},removeStyle:function(property){if(!this.styles||!property||property===''){return;}
var obj=this.styles,line,lineNum,charNum;for(lineNum in obj){line=obj[lineNum];for(charNum in line){delete line[charNum][property];if(Object.keys(line[charNum]).length===0){delete line[charNum];}}
if(Object.keys(line).length===0){delete obj[lineNum];}}},_extendStyles:function(index,styles){var loc=this.get2DCursorLocation(index);if(!this._getLineStyle(loc.lineIndex)){this._setLineStyle(loc.lineIndex);}
if(!this._getStyleDeclaration(loc.lineIndex,loc.charIndex)){this._setStyleDeclaration(loc.lineIndex,loc.charIndex,{});}
fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex,loc.charIndex),styles);},get2DCursorLocation:function(selectionStart,skipWrapping){if(typeof selectionStart==='undefined'){selectionStart=this.selectionStart;}
var lines=skipWrapping?this._unwrappedTextLines:this._textLines,len=lines.length;for(var i=0;i<len;i++){if(selectionStart<=lines[i].length){return{lineIndex:i,charIndex:selectionStart};}
selectionStart-=lines[i].length+this.missingNewlineOffset(i);}
return{lineIndex:i-1,charIndex:lines[i-1].length<selectionStart?lines[i-1].length:selectionStart};},getSelectionStyles:function(startIndex,endIndex,complete){if(typeof startIndex==='undefined'){startIndex=this.selectionStart||0;}
if(typeof endIndex==='undefined'){endIndex=this.selectionEnd||startIndex;}
var styles=[];for(var i=startIndex;i<endIndex;i++){styles.push(this.getStyleAtPosition(i,complete));}
return styles;},getStyleAtPosition:function(position,complete){var loc=this.get2DCursorLocation(position),style=complete?this.getCompleteStyleDeclaration(loc.lineIndex,loc.charIndex):this._getStyleDeclaration(loc.lineIndex,loc.charIndex);return style||{};},setSelectionStyles:function(styles,startIndex,endIndex){if(typeof startIndex==='undefined'){startIndex=this.selectionStart||0;}
if(typeof endIndex==='undefined'){endIndex=this.selectionEnd||startIndex;}
for(var i=startIndex;i<endIndex;i++){this._extendStyles(i,styles);}
this._forceClearCache=true;return this;},_getStyleDeclaration:function(lineIndex,charIndex){var lineStyle=this.styles&&this.styles[lineIndex];if(!lineStyle){return null;}
return lineStyle[charIndex];},getCompleteStyleDeclaration:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex)||{},styleObject={},prop;for(var i=0;i<this._styleProperties.length;i++){prop=this._styleProperties[i];styleObject[prop]=typeof style[prop]==='undefined'?this[prop]:style[prop];}
return styleObject;},_setStyleDeclaration:function(lineIndex,charIndex,style){this.styles[lineIndex][charIndex]=style;},_deleteStyleDeclaration:function(lineIndex,charIndex){delete this.styles[lineIndex][charIndex];},_getLineStyle:function(lineIndex){return!!this.styles[lineIndex];},_setLineStyle:function(lineIndex){this.styles[lineIndex]={};},_deleteLineStyle:function(lineIndex){delete this.styles[lineIndex];}});})();(function(){function parseDecoration(object){if(object.textDecoration){object.textDecoration.indexOf('underline')>-1&&(object.underline=true);object.textDecoration.indexOf('line-through')>-1&&(object.linethrough=true);object.textDecoration.indexOf('overline')>-1&&(object.overline=true);delete object.textDecoration;}}
fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:'i-text',selectionStart:0,selectionEnd:0,selectionColor:'rgba(17,119,255,0.3)',isEditing:false,editable:true,editingBorderColor:'rgba(102,153,255,0.25)',cursorWidth:2,cursorColor:'',cursorDelay:1000,cursorDuration:600,caching:true,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:false,__widthOfSpace:[],inCompositionMode:false,initialize:function(text,options){this.callSuper('initialize',text,options);this.initBehavior();},setSelectionStart:function(index){index=Math.max(index,0);this._updateAndFire('selectionStart',index);},setSelectionEnd:function(index){index=Math.min(index,this.text.length);this._updateAndFire('selectionEnd',index);},_updateAndFire:function(property,index){if(this[property]!==index){this._fireSelectionChanged();this[property]=index;}
this._updateTextarea();},_fireSelectionChanged:function(){this.fire('selection:changed');this.canvas&&this.canvas.fire('text:selection:changed',{target:this});},initDimensions:function(){this.isEditing&&this.initDelayedCursor();this.clearContextTop();this.callSuper('initDimensions');},render:function(ctx){this.clearContextTop();this.callSuper('render',ctx);this.cursorOffsetCache={};this.renderCursorOrSelection();},_render:function(ctx){this.callSuper('_render',ctx);},clearContextTop:function(skipRestore){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return;}
var ctx=this.canvas.contextTop,v=this.canvas.viewportTransform;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);this.transform(ctx);this._clearTextArea(ctx);skipRestore||ctx.restore();},renderCursorOrSelection:function(){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return;}
var boundaries=this._getCursorBoundaries(),ctx=this.canvas.contextTop;this.clearContextTop(true);if(this.selectionStart===this.selectionEnd){this.renderCursor(boundaries,ctx);}
else{this.renderSelection(boundaries,ctx);}
ctx.restore();},_clearTextArea:function(ctx){var width=this.width+4,height=this.height+4;ctx.clearRect(-width/2,-height/2,width,height);},_getCursorBoundaries:function(position){if(typeof position==='undefined'){position=this.selectionStart;}
var left=this._getLeftOffset(),top=this._getTopOffset(),offsets=this._getCursorBoundariesOffsets(position);return{left:left,top:top,leftOffset:offsets.left,topOffset:offsets.top};},_getCursorBoundariesOffsets:function(position){if(this.cursorOffsetCache&&'top'in this.cursorOffsetCache){return this.cursorOffsetCache;}
var lineLeftOffset,lineIndex,charIndex,topOffset=0,leftOffset=0,boundaries,cursorPosition=this.get2DCursorLocation(position);charIndex=cursorPosition.charIndex;lineIndex=cursorPosition.lineIndex;for(var i=0;i<lineIndex;i++){topOffset+=this.getHeightOfLine(i);}
lineLeftOffset=this._getLineLeftOffset(lineIndex);var bound=this.__charBounds[lineIndex][charIndex];bound&&(leftOffset=bound.left);if(this.charSpacing!==0&&charIndex===this._textLines[lineIndex].length){leftOffset-=this._getWidthOfCharSpacing();}
boundaries={top:topOffset,left:lineLeftOffset+(leftOffset>0?leftOffset:0),};if(this.direction==='rtl'){boundaries.left*=-1;}
this.cursorOffsetCache=boundaries;return this.cursorOffsetCache;},renderCursor:function(boundaries,ctx){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex>0?cursorLocation.charIndex-1:0,charHeight=this.getValueOfPropertyAt(lineIndex,charIndex,'fontSize'),multiplier=this.scaleX*this.canvas.getZoom(),cursorWidth=this.cursorWidth/multiplier,topOffset=boundaries.topOffset,dy=this.getValueOfPropertyAt(lineIndex,charIndex,'deltaY');topOffset+=(1-this._fontSizeFraction)*this.getHeightOfLine(lineIndex)/this.lineHeight
-charHeight*(1-this._fontSizeFraction);if(this.inCompositionMode){this.renderSelection(boundaries,ctx);}
ctx.fillStyle=this.cursorColor||this.getValueOfPropertyAt(lineIndex,charIndex,'fill');ctx.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;ctx.fillRect(boundaries.left+boundaries.leftOffset-cursorWidth/2,topOffset+boundaries.top+dy,cursorWidth,charHeight);},renderSelection:function(boundaries,ctx){var selectionStart=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,isJustify=this.textAlign.indexOf('justify')!==-1,start=this.get2DCursorLocation(selectionStart),end=this.get2DCursorLocation(selectionEnd),startLine=start.lineIndex,endLine=end.lineIndex,startChar=start.charIndex<0?0:start.charIndex,endChar=end.charIndex<0?0:end.charIndex;for(var i=startLine;i<=endLine;i++){var lineOffset=this._getLineLeftOffset(i)||0,lineHeight=this.getHeightOfLine(i),realLineHeight=0,boxStart=0,boxEnd=0;if(i===startLine){boxStart=this.__charBounds[startLine][startChar].left;}
if(i>=startLine&&i<endLine){boxEnd=isJustify&&!this.isEndOfWrapping(i)?this.width:this.getLineWidth(i)||5;}
else if(i===endLine){if(endChar===0){boxEnd=this.__charBounds[endLine][endChar].left;}
else{var charSpacing=this._getWidthOfCharSpacing();boxEnd=this.__charBounds[endLine][endChar-1].left
+this.__charBounds[endLine][endChar-1].width-charSpacing;}}
realLineHeight=lineHeight;if(this.lineHeight<1||(i===endLine&&this.lineHeight>1)){lineHeight/=this.lineHeight;}
var drawStart=boundaries.left+lineOffset+boxStart,drawWidth=boxEnd-boxStart,drawHeight=lineHeight,extraTop=0;if(this.inCompositionMode){ctx.fillStyle=this.compositionColor||'black';drawHeight=1;extraTop=lineHeight;}
else{ctx.fillStyle=this.selectionColor;}
if(this.direction==='rtl'){drawStart=this.width-drawStart-drawWidth;}
ctx.fillRect(drawStart,boundaries.top+boundaries.topOffset+extraTop,drawWidth,drawHeight);boundaries.topOffset+=realLineHeight;}},getCurrentCharFontSize:function(){var cp=this._getCurrentCharIndex();return this.getValueOfPropertyAt(cp.l,cp.c,'fontSize');},getCurrentCharColor:function(){var cp=this._getCurrentCharIndex();return this.getValueOfPropertyAt(cp.l,cp.c,'fill');},_getCurrentCharIndex:function(){var cursorPosition=this.get2DCursorLocation(this.selectionStart,true),charIndex=cursorPosition.charIndex>0?cursorPosition.charIndex-1:0;return{l:cursorPosition.lineIndex,c:charIndex};}});fabric.IText.fromObject=function(object,callback){parseDecoration(object);if(object.styles){for(var i in object.styles){for(var j in object.styles[i]){parseDecoration(object.styles[i][j]);}}}
fabric.Object._fromObject('IText',object,callback,'text');};})();(function(){var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.mouseMoveHandler=this.mouseMoveHandler.bind(this);},onDeselect:function(){this.isEditing&&this.exitEditing();this.selected=false;},initAddedHandler:function(){var _this=this;this.on('added',function(){var canvas=_this.canvas;if(canvas){if(!canvas._hasITextHandlers){canvas._hasITextHandlers=true;_this._initCanvasHandlers(canvas);}
canvas._iTextInstances=canvas._iTextInstances||[];canvas._iTextInstances.push(_this);}});},initRemovedHandler:function(){var _this=this;this.on('removed',function(){var canvas=_this.canvas;if(canvas){canvas._iTextInstances=canvas._iTextInstances||[];fabric.util.removeFromArray(canvas._iTextInstances,_this);if(canvas._iTextInstances.length===0){canvas._hasITextHandlers=false;_this._removeCanvasHandlers(canvas);}}});},_initCanvasHandlers:function(canvas){canvas._mouseUpITextHandler=function(){if(canvas._iTextInstances){canvas._iTextInstances.forEach(function(obj){obj.__isMousedown=false;});}};canvas.on('mouse:up',canvas._mouseUpITextHandler);},_removeCanvasHandlers:function(canvas){canvas.off('mouse:up',canvas._mouseUpITextHandler);},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,'_onTickComplete');},_animateCursor:function(obj,targetOpacity,duration,completeMethod){var tickState;tickState={isAborted:false,abort:function(){this.isAborted=true;},};obj.animate('_currentCursorOpacity',targetOpacity,{duration:duration,onComplete:function(){if(!tickState.isAborted){obj[completeMethod]();}},onChange:function(){if(obj.canvas&&obj.selectionStart===obj.selectionEnd){obj.renderCursorOrSelection();}},abort:function(){return tickState.isAborted;}});return tickState;},_onTickComplete:function(){var _this=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1);}
this._cursorTimeout1=setTimeout(function(){_this._currentTickCompleteState=_this._animateCursor(_this,0,this.cursorDuration/2,'_tick');},100);},initDelayedCursor:function(restart){var _this=this,delay=restart?0:this.cursorDelay;this.abortCursorAnimation();this._currentCursorOpacity=1;this._cursorTimeout2=setTimeout(function(){_this._tick();},delay);},abortCursorAnimation:function(){var shouldClear=this._currentTickState||this._currentTickCompleteState,canvas=this.canvas;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;if(shouldClear&&canvas){canvas.clearContext(canvas.contextTop||canvas.contextContainer);}},selectAll:function(){this.selectionStart=0;this.selectionEnd=this._text.length;this._fireSelectionChanged();this._updateTextarea();return this;},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join('');},findWordBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;if(this._reSpace.test(this._text[index])){while(this._reSpace.test(this._text[index])){offset++;index--;}}
while(/\S/.test(this._text[index])&&index>-1){offset++;index--;}
return startFrom-offset;},findWordBoundaryRight:function(startFrom){var offset=0,index=startFrom;if(this._reSpace.test(this._text[index])){while(this._reSpace.test(this._text[index])){offset++;index++;}}
while(/\S/.test(this._text[index])&&index<this._text.length){offset++;index++;}
return startFrom+offset;},findLineBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;while(!/\n/.test(this._text[index])&&index>-1){offset++;index--;}
return startFrom-offset;},findLineBoundaryRight:function(startFrom){var offset=0,index=startFrom;while(!/\n/.test(this._text[index])&&index<this._text.length){offset++;index++;}
return startFrom+offset;},searchWordBoundary:function(selectionStart,direction){var text=this._text,index=this._reSpace.test(text[selectionStart])?selectionStart-1:selectionStart,_char=text[index],reNonWord=fabric.reNonWord;while(!reNonWord.test(_char)&&index>0&&index<text.length){index+=direction;_char=text[index];}
if(reNonWord.test(_char)){index+=direction===1?0:1;}
return index;},selectWord:function(selectionStart){selectionStart=selectionStart||this.selectionStart;var newSelectionStart=this.searchWordBoundary(selectionStart,-1),newSelectionEnd=this.searchWordBoundary(selectionStart,1);this.selectionStart=newSelectionStart;this.selectionEnd=newSelectionEnd;this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection();},selectLine:function(selectionStart){selectionStart=selectionStart||this.selectionStart;var newSelectionStart=this.findLineBoundaryLeft(selectionStart),newSelectionEnd=this.findLineBoundaryRight(selectionStart);this.selectionStart=newSelectionStart;this.selectionEnd=newSelectionEnd;this._fireSelectionChanged();this._updateTextarea();return this;},enterEditing:function(e){if(this.isEditing||!this.editable){return;}
if(this.canvas){this.canvas.calcOffset();this.exitEditingOnOthers(this.canvas);}
this.isEditing=true;this.initHiddenTextarea(e);this.hiddenTextarea.focus();this.hiddenTextarea.value=this.text;this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._textBeforeEdit=this.text;this._tick();this.fire('editing:entered');this._fireSelectionChanged();if(!this.canvas){return this;}
this.canvas.fire('text:editing:entered',{target:this});this.initMouseMoveHandler();this.canvas.requestRenderAll();return this;},exitEditingOnOthers:function(canvas){if(canvas._iTextInstances){canvas._iTextInstances.forEach(function(obj){obj.selected=false;if(obj.isEditing){obj.exitEditing();}});}},initMouseMoveHandler:function(){this.canvas.on('mouse:move',this.mouseMoveHandler);},mouseMoveHandler:function(options){if(!this.__isMousedown||!this.isEditing){return;}
var newSelectionStart=this.getSelectionStartFromPointer(options.e),currentStart=this.selectionStart,currentEnd=this.selectionEnd;if((newSelectionStart!==this.__selectionStartOnMouseDown||currentStart===currentEnd)&&(currentStart===newSelectionStart||currentEnd===newSelectionStart)){return;}
if(newSelectionStart>this.__selectionStartOnMouseDown){this.selectionStart=this.__selectionStartOnMouseDown;this.selectionEnd=newSelectionStart;}
else{this.selectionStart=newSelectionStart;this.selectionEnd=this.__selectionStartOnMouseDown;}
if(this.selectionStart!==currentStart||this.selectionEnd!==currentEnd){this.restartCursorIfNeeded();this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection();}},_setEditingProps:function(){this.hoverCursor='text';if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor='text';}
this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true;},fromStringToGraphemeSelection:function(start,end,text){var smallerTextStart=text.slice(0,start),graphemeStart=fabric.util.string.graphemeSplit(smallerTextStart).length;if(start===end){return{selectionStart:graphemeStart,selectionEnd:graphemeStart};}
var smallerTextEnd=text.slice(start,end),graphemeEnd=fabric.util.string.graphemeSplit(smallerTextEnd).length;return{selectionStart:graphemeStart,selectionEnd:graphemeStart+graphemeEnd};},fromGraphemeToStringSelection:function(start,end,_text){var smallerTextStart=_text.slice(0,start),graphemeStart=smallerTextStart.join('').length;if(start===end){return{selectionStart:graphemeStart,selectionEnd:graphemeStart};}
var smallerTextEnd=_text.slice(start,end),graphemeEnd=smallerTextEnd.join('').length;return{selectionStart:graphemeStart,selectionEnd:graphemeStart+graphemeEnd};},_updateTextarea:function(){this.cursorOffsetCache={};if(!this.hiddenTextarea){return;}
if(!this.inCompositionMode){var newSelection=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=newSelection.selectionStart;this.hiddenTextarea.selectionEnd=newSelection.selectionEnd;}
this.updateTextareaPosition();},updateFromTextArea:function(){if(!this.hiddenTextarea){return;}
this.cursorOffsetCache={};this.text=this.hiddenTextarea.value;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}
var newSelection=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=newSelection.selectionEnd;if(!this.inCompositionMode){this.selectionStart=newSelection.selectionStart;}
this.updateTextareaPosition();},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var style=this._calcTextareaPosition();this.hiddenTextarea.style.left=style.left;this.hiddenTextarea.style.top=style.top;}},_calcTextareaPosition:function(){if(!this.canvas){return{x:1,y:1};}
var desiredPosition=this.inCompositionMode?this.compositionStart:this.selectionStart,boundaries=this._getCursorBoundaries(desiredPosition),cursorLocation=this.get2DCursorLocation(desiredPosition),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,charHeight=this.getValueOfPropertyAt(lineIndex,charIndex,'fontSize')*this.lineHeight,leftOffset=boundaries.leftOffset,m=this.calcTransformMatrix(),p={x:boundaries.left+leftOffset,y:boundaries.top+boundaries.topOffset+charHeight},retinaScaling=this.canvas.getRetinaScaling(),upperCanvas=this.canvas.upperCanvasEl,upperCanvasWidth=upperCanvas.width/retinaScaling,upperCanvasHeight=upperCanvas.height/retinaScaling,maxWidth=upperCanvasWidth-charHeight,maxHeight=upperCanvasHeight-charHeight,scaleX=upperCanvas.clientWidth/upperCanvasWidth,scaleY=upperCanvas.clientHeight/upperCanvasHeight;p=fabric.util.transformPoint(p,m);p=fabric.util.transformPoint(p,this.canvas.viewportTransform);p.x*=scaleX;p.y*=scaleY;if(p.x<0){p.x=0;}
if(p.x>maxWidth){p.x=maxWidth;}
if(p.y<0){p.y=0;}
if(p.y>maxHeight){p.y=maxHeight;}
p.x+=this.canvas._offset.left;p.y+=this.canvas._offset.top;return{left:p.x+'px',top:p.y+'px',fontSize:charHeight+'px',charHeight:charHeight};},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor};},_restoreEditingProps:function(){if(!this._savedProps){return;}
this.hoverCursor=this._savedProps.hoverCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.selectable=this._savedProps.selectable;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor;}},exitEditing:function(){var isTextChanged=(this._textBeforeEdit!==this.text);var hiddenTextarea=this.hiddenTextarea;this.selected=false;this.isEditing=false;this.selectionEnd=this.selectionStart;if(hiddenTextarea){hiddenTextarea.blur&&hiddenTextarea.blur();hiddenTextarea.parentNode&&hiddenTextarea.parentNode.removeChild(hiddenTextarea);}
this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}
this.fire('editing:exited');isTextChanged&&this.fire('modified');if(this.canvas){this.canvas.off('mouse:move',this.mouseMoveHandler);this.canvas.fire('text:editing:exited',{target:this});isTextChanged&&this.canvas.fire('object:modified',{target:this});}
return this;},_removeExtraneousStyles:function(){for(var prop in this.styles){if(!this._textLines[prop]){delete this.styles[prop];}}},removeStyleFromTo:function(start,end){var cursorStart=this.get2DCursorLocation(start,true),cursorEnd=this.get2DCursorLocation(end,true),lineStart=cursorStart.lineIndex,charStart=cursorStart.charIndex,lineEnd=cursorEnd.lineIndex,charEnd=cursorEnd.charIndex,i,styleObj;if(lineStart!==lineEnd){if(this.styles[lineStart]){for(i=charStart;i<this._unwrappedTextLines[lineStart].length;i++){delete this.styles[lineStart][i];}}
if(this.styles[lineEnd]){for(i=charEnd;i<this._unwrappedTextLines[lineEnd].length;i++){styleObj=this.styles[lineEnd][i];if(styleObj){this.styles[lineStart]||(this.styles[lineStart]={});this.styles[lineStart][charStart+i-charEnd]=styleObj;}}}
for(i=lineStart+1;i<=lineEnd;i++){delete this.styles[i];}
this.shiftLineStyles(lineEnd,lineStart-lineEnd);}
else{if(this.styles[lineStart]){styleObj=this.styles[lineStart];var diff=charEnd-charStart,numericChar,_char;for(i=charStart;i<charEnd;i++){delete styleObj[i];}
for(_char in this.styles[lineStart]){numericChar=parseInt(_char,10);if(numericChar>=charEnd){styleObj[numericChar-diff]=styleObj[_char];delete styleObj[_char];}}}}},shiftLineStyles:function(lineIndex,offset){var clonedStyles=clone(this.styles);for(var line in this.styles){var numericLine=parseInt(line,10);if(numericLine>lineIndex){this.styles[numericLine+offset]=clonedStyles[numericLine];if(!clonedStyles[numericLine-offset]){delete this.styles[numericLine];}}}},restartCursorIfNeeded:function(){if(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted){this.initDelayedCursor();}},insertNewlineStyleObject:function(lineIndex,charIndex,qty,copiedStyle){var currentCharStyle,newLineStyles={},somethingAdded=false,isEndOfLine=this._unwrappedTextLines[lineIndex].length===charIndex;qty||(qty=1);this.shiftLineStyles(lineIndex,qty);if(this.styles[lineIndex]){currentCharStyle=this.styles[lineIndex][charIndex===0?charIndex:charIndex-1];}
for(var index in this.styles[lineIndex]){var numIndex=parseInt(index,10);if(numIndex>=charIndex){somethingAdded=true;newLineStyles[numIndex-charIndex]=this.styles[lineIndex][index];if(!(isEndOfLine&&charIndex===0)){delete this.styles[lineIndex][index];}}}
var styleCarriedOver=false;if(somethingAdded&&!isEndOfLine){this.styles[lineIndex+qty]=newLineStyles;styleCarriedOver=true;}
if(styleCarriedOver){qty--;}
while(qty>0){if(copiedStyle&&copiedStyle[qty-1]){this.styles[lineIndex+qty]={0:clone(copiedStyle[qty-1])};}
else if(currentCharStyle){this.styles[lineIndex+qty]={0:clone(currentCharStyle)};}
else{delete this.styles[lineIndex+qty];}
qty--;}
this._forceClearCache=true;},insertCharStyleObject:function(lineIndex,charIndex,quantity,copiedStyle){if(!this.styles){this.styles={};}
var currentLineStyles=this.styles[lineIndex],currentLineStylesCloned=currentLineStyles?clone(currentLineStyles):{};quantity||(quantity=1);for(var index in currentLineStylesCloned){var numericIndex=parseInt(index,10);if(numericIndex>=charIndex){currentLineStyles[numericIndex+quantity]=currentLineStylesCloned[numericIndex];if(!currentLineStylesCloned[numericIndex-quantity]){delete currentLineStyles[numericIndex];}}}
this._forceClearCache=true;if(copiedStyle){while(quantity--){if(!Object.keys(copiedStyle[quantity]).length){continue;}
if(!this.styles[lineIndex]){this.styles[lineIndex]={};}
this.styles[lineIndex][charIndex+quantity]=clone(copiedStyle[quantity]);}
return;}
if(!currentLineStyles){return;}
var newStyle=currentLineStyles[charIndex?charIndex-1:1];while(newStyle&&quantity--){this.styles[lineIndex][charIndex+quantity]=clone(newStyle);}},insertNewStyleBlock:function(insertedText,start,copiedStyle){var cursorLoc=this.get2DCursorLocation(start,true),addedLines=[0],linesLength=0;for(var i=0;i<insertedText.length;i++){if(insertedText[i]==='\n'){linesLength++;addedLines[linesLength]=0;}
else{addedLines[linesLength]++;}}
if(addedLines[0]>0){this.insertCharStyleObject(cursorLoc.lineIndex,cursorLoc.charIndex,addedLines[0],copiedStyle);copiedStyle=copiedStyle&&copiedStyle.slice(addedLines[0]+1);}
linesLength&&this.insertNewlineStyleObject(cursorLoc.lineIndex,cursorLoc.charIndex+addedLines[0],linesLength);for(var i=1;i<linesLength;i++){if(addedLines[i]>0){this.insertCharStyleObject(cursorLoc.lineIndex+i,0,addedLines[i],copiedStyle);}
else if(copiedStyle){if(this.styles[cursorLoc.lineIndex+i]&&copiedStyle[0]){this.styles[cursorLoc.lineIndex+i][0]=copiedStyle[0];}}
copiedStyle=copiedStyle&&copiedStyle.slice(addedLines[i]+1);}
if(addedLines[i]>0){this.insertCharStyleObject(cursorLoc.lineIndex+i,0,addedLines[i],copiedStyle);}},setSelectionStartEndWithShift:function(start,end,newSelection){if(newSelection<=start){if(end===start){this._selectionDirection='left';}
else if(this._selectionDirection==='right'){this._selectionDirection='left';this.selectionEnd=start;}
this.selectionStart=newSelection;}
else if(newSelection>start&&newSelection<end){if(this._selectionDirection==='right'){this.selectionEnd=newSelection;}
else{this.selectionStart=newSelection;}}
else{if(end===start){this._selectionDirection='right';}
else if(this._selectionDirection==='left'){this._selectionDirection='right';this.selectionStart=end;}
this.selectionEnd=newSelection;}},setSelectionInBoundaries:function(){var length=this.text.length;if(this.selectionStart>length){this.selectionStart=length;}
else if(this.selectionStart<0){this.selectionStart=0;}
if(this.selectionEnd>length){this.selectionEnd=length;}
else if(this.selectionEnd<0){this.selectionEnd=0;}}});})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date();this.__lastLastClickTime=+new Date();this.__lastPointer={};this.on('mousedown',this.onMouseDown);},onMouseDown:function(options){if(!this.canvas){return;}
this.__newClickTime=+new Date();var newPointer=options.pointer;if(this.isTripleClick(newPointer)){this.fire('tripleclick',options);this._stopEvent(options.e);}
this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=newPointer;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected;},isTripleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===newPointer.x&&this.__lastPointer.y===newPointer.y;},_stopEvent:function(e){e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();},initCursorSelectionHandlers:function(){this.initMousedownHandler();this.initMouseupHandler();this.initClicks();},doubleClickHandler:function(options){if(!this.isEditing){return;}
this.selectWord(this.getSelectionStartFromPointer(options.e));},tripleClickHandler:function(options){if(!this.isEditing){return;}
this.selectLine(this.getSelectionStartFromPointer(options.e));},initClicks:function(){this.on('mousedblclick',this.doubleClickHandler);this.on('tripleclick',this.tripleClickHandler);},_mouseDownHandler:function(options){if(!this.canvas||!this.editable||(options.e.button&&options.e.button!==1)){return;}
this.__isMousedown=true;if(this.selected){this.inCompositionMode=false;this.setCursorByClick(options.e);}
if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;if(this.selectionStart===this.selectionEnd){this.abortCursorAnimation();}
this.renderCursorOrSelection();}},_mouseDownHandlerBefore:function(options){if(!this.canvas||!this.editable||(options.e.button&&options.e.button!==1)){return;}
this.selected=this===this.canvas._activeObject;},initMousedownHandler:function(){this.on('mousedown',this._mouseDownHandler);this.on('mousedown:before',this._mouseDownHandlerBefore);},initMouseupHandler:function(){this.on('mouseup',this.mouseUpHandler);},mouseUpHandler:function(options){this.__isMousedown=false;if(!this.editable||this.group||(options.transform&&options.transform.actionPerformed)||(options.e.button&&options.e.button!==1)){return;}
if(this.canvas){var currentActive=this.canvas._activeObject;if(currentActive&&currentActive!==this){return;}}
if(this.__lastSelected&&!this.__corner){this.selected=false;this.__lastSelected=false;this.enterEditing(options.e);if(this.selectionStart===this.selectionEnd){this.initDelayedCursor(true);}
else{this.renderCursorOrSelection();}}
else{this.selected=true;}},setCursorByClick:function(e){var newSelection=this.getSelectionStartFromPointer(e),start=this.selectionStart,end=this.selectionEnd;if(e.shiftKey){this.setSelectionStartEndWithShift(start,end,newSelection);}
else{this.selectionStart=newSelection;this.selectionEnd=newSelection;}
if(this.isEditing){this._fireSelectionChanged();this._updateTextarea();}},getSelectionStartFromPointer:function(e){var mouseOffset=this.getLocalPointer(e),prevWidth=0,width=0,height=0,charIndex=0,lineIndex=0,lineLeftOffset,line;for(var i=0,len=this._textLines.length;i<len;i++){if(height<=mouseOffset.y){height+=this.getHeightOfLine(i)*this.scaleY;lineIndex=i;if(i>0){charIndex+=this._textLines[i-1].length+this.missingNewlineOffset(i-1);}}
else{break;}}
lineLeftOffset=this._getLineLeftOffset(lineIndex);width=lineLeftOffset*this.scaleX;line=this._textLines[lineIndex];if(this.direction==='rtl'){mouseOffset.x=this.width*this.scaleX-mouseOffset.x+width;}
for(var j=0,jlen=line.length;j<jlen;j++){prevWidth=width;width+=this.__charBounds[lineIndex][j].kernedWidth*this.scaleX;if(width<=mouseOffset.x){charIndex++;}
else{break;}}
return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex,jlen);},_getNewSelectionStartFromOffset:function(mouseOffset,prevWidth,width,index,jlen){var distanceBtwLastCharAndCursor=mouseOffset.x-prevWidth,distanceBtwNextCharAndCursor=width-mouseOffset.x,offset=distanceBtwNextCharAndCursor>distanceBtwLastCharAndCursor||distanceBtwNextCharAndCursor<0?0:1,newSelectionStart=index+offset;if(this.flipX){newSelectionStart=jlen-newSelectionStart;}
if(newSelectionStart>this._text.length){newSelectionStart=this._text.length;}
return newSelectionStart;}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement('textarea');this.hiddenTextarea.setAttribute('autocapitalize','off');this.hiddenTextarea.setAttribute('autocorrect','off');this.hiddenTextarea.setAttribute('autocomplete','off');this.hiddenTextarea.setAttribute('spellcheck','false');this.hiddenTextarea.setAttribute('data-fabric-hiddentextarea','');this.hiddenTextarea.setAttribute('wrap','off');var style=this._calcTextareaPosition();this.hiddenTextarea.style.cssText='position: absolute; top: '+style.top+'; left: '+style.left+'; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;'+' paddingｰtop: '+style.fontSize+';';if(this.hiddenTextareaContainer){this.hiddenTextareaContainer.appendChild(this.hiddenTextarea);}
else{fabric.document.body.appendChild(this.hiddenTextarea);}
fabric.util.addListener(this.hiddenTextarea,'keydown',this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,'keyup',this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,'input',this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,'copy',this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,'cut',this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,'paste',this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,'compositionstart',this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,'compositionupdate',this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,'compositionend',this.onCompositionEnd.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,'click',this.onClick.bind(this));this._clickHandlerInitialized=true;}},keysMap:{9:'exitEditing',27:'exitEditing',33:'moveCursorUp',34:'moveCursorDown',35:'moveCursorRight',36:'moveCursorLeft',37:'moveCursorLeft',38:'moveCursorUp',39:'moveCursorRight',40:'moveCursorDown',},keysMapRtl:{9:'exitEditing',27:'exitEditing',33:'moveCursorUp',34:'moveCursorDown',35:'moveCursorLeft',36:'moveCursorRight',37:'moveCursorRight',38:'moveCursorUp',39:'moveCursorLeft',40:'moveCursorDown',},ctrlKeysMapUp:{67:'copy',88:'cut'},ctrlKeysMapDown:{65:'selectAll'},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus();},onKeyDown:function(e){if(!this.isEditing){return;}
var keyMap=this.direction==='rtl'?this.keysMapRtl:this.keysMap;if(e.keyCode in keyMap){this[keyMap[e.keyCode]](e);}
else if((e.keyCode in this.ctrlKeysMapDown)&&(e.ctrlKey||e.metaKey)){this[this.ctrlKeysMapDown[e.keyCode]](e);}
else{return;}
e.stopImmediatePropagation();e.preventDefault();if(e.keyCode>=33&&e.keyCode<=40){this.inCompositionMode=false;this.clearContextTop();this.renderCursorOrSelection();}
else{this.canvas&&this.canvas.requestRenderAll();}},onKeyUp:function(e){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=false;return;}
if((e.keyCode in this.ctrlKeysMapUp)&&(e.ctrlKey||e.metaKey)){this[this.ctrlKeysMapUp[e.keyCode]](e);}
else{return;}
e.stopImmediatePropagation();e.preventDefault();this.canvas&&this.canvas.requestRenderAll();},onInput:function(e){var fromPaste=this.fromPaste;this.fromPaste=false;e&&e.stopPropagation();if(!this.isEditing){return;}
var nextText=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,charCount=this._text.length,nextCharCount=nextText.length,removedText,insertedText,charDiff=nextCharCount-charCount,selectionStart=this.selectionStart,selectionEnd=this.selectionEnd,selection=selectionStart!==selectionEnd,copiedStyle,removeFrom,removeTo;if(this.hiddenTextarea.value===''){this.styles={};this.updateFromTextArea();this.fire('changed');if(this.canvas){this.canvas.fire('text:changed',{target:this});this.canvas.requestRenderAll();}
return;}
var textareaSelection=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);var backDelete=selectionStart>textareaSelection.selectionStart;if(selection){removedText=this._text.slice(selectionStart,selectionEnd);charDiff+=selectionEnd-selectionStart;}
else if(nextCharCount<charCount){if(backDelete){removedText=this._text.slice(selectionEnd+charDiff,selectionEnd);}
else{removedText=this._text.slice(selectionStart,selectionStart-charDiff);}}
insertedText=nextText.slice(textareaSelection.selectionEnd-charDiff,textareaSelection.selectionEnd);if(removedText&&removedText.length){if(insertedText.length){copiedStyle=this.getSelectionStyles(selectionStart,selectionStart+1,false);copiedStyle=insertedText.map(function(){return copiedStyle[0];});}
if(selection){removeFrom=selectionStart;removeTo=selectionEnd;}
else if(backDelete){removeFrom=selectionEnd-removedText.length;removeTo=selectionEnd;}
else{removeFrom=selectionEnd;removeTo=selectionEnd+removedText.length;}
this.removeStyleFromTo(removeFrom,removeTo);}
if(insertedText.length){if(fromPaste&&insertedText.join('')===fabric.copiedText&&!fabric.disableStyleCopyPaste){copiedStyle=fabric.copiedTextStyle;}
this.insertNewStyleBlock(insertedText,selectionStart,copiedStyle);}
this.updateFromTextArea();this.fire('changed');if(this.canvas){this.canvas.fire('text:changed',{target:this});this.canvas.requestRenderAll();}},onCompositionStart:function(){this.inCompositionMode=true;},onCompositionEnd:function(){this.inCompositionMode=false;},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart;this.compositionEnd=e.target.selectionEnd;this.updateTextareaPosition();},copy:function(){if(this.selectionStart===this.selectionEnd){return;}
fabric.copiedText=this.getSelectedText();if(!fabric.disableStyleCopyPaste){fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,true);}
else{fabric.copiedTextStyle=null;}
this._copyDone=true;},paste:function(){this.fromPaste=true;},_getClipboardData:function(e){return(e&&e.clipboardData)||fabric.window.clipboardData;},_getWidthBeforeCursor:function(lineIndex,charIndex){var widthBeforeCursor=this._getLineLeftOffset(lineIndex),bound;if(charIndex>0){bound=this.__charBounds[lineIndex][charIndex-1];widthBeforeCursor+=bound.left+bound.width;}
return widthBeforeCursor;},getDownCursorOffset:function(e,isRight){var selectionProp=this._getSelectionForOffset(e,isRight),cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex;if(lineIndex===this._textLines.length-1||e.metaKey||e.keyCode===34){return this._text.length-selectionProp;}
var charIndex=cursorLocation.charIndex,widthBeforeCursor=this._getWidthBeforeCursor(lineIndex,charIndex),indexOnOtherLine=this._getIndexOnLine(lineIndex+1,widthBeforeCursor),textAfterCursor=this._textLines[lineIndex].slice(charIndex);return textAfterCursor.length+indexOnOtherLine+1+this.missingNewlineOffset(lineIndex);},_getSelectionForOffset:function(e,isRight){if(e.shiftKey&&this.selectionStart!==this.selectionEnd&&isRight){return this.selectionEnd;}
else{return this.selectionStart;}},getUpCursorOffset:function(e,isRight){var selectionProp=this._getSelectionForOffset(e,isRight),cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex;if(lineIndex===0||e.metaKey||e.keyCode===33){return-selectionProp;}
var charIndex=cursorLocation.charIndex,widthBeforeCursor=this._getWidthBeforeCursor(lineIndex,charIndex),indexOnOtherLine=this._getIndexOnLine(lineIndex-1,widthBeforeCursor),textBeforeCursor=this._textLines[lineIndex].slice(0,charIndex),missingNewlineOffset=this.missingNewlineOffset(lineIndex-1);return-this._textLines[lineIndex-1].length
+indexOnOtherLine-textBeforeCursor.length+(1-missingNewlineOffset);},_getIndexOnLine:function(lineIndex,width){var line=this._textLines[lineIndex],lineLeftOffset=this._getLineLeftOffset(lineIndex),widthOfCharsOnLine=lineLeftOffset,indexOnLine=0,charWidth,foundMatch;for(var j=0,jlen=line.length;j<jlen;j++){charWidth=this.__charBounds[lineIndex][j].width;widthOfCharsOnLine+=charWidth;if(widthOfCharsOnLine>width){foundMatch=true;var leftEdge=widthOfCharsOnLine-charWidth,rightEdge=widthOfCharsOnLine,offsetFromLeftEdge=Math.abs(leftEdge-width),offsetFromRightEdge=Math.abs(rightEdge-width);indexOnLine=offsetFromRightEdge<offsetFromLeftEdge?j:(j-1);break;}}
if(!foundMatch){indexOnLine=line.length-1;}
return indexOnLine;},moveCursorDown:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return;}
this._moveCursorUpOrDown('Down',e);},moveCursorUp:function(e){if(this.selectionStart===0&&this.selectionEnd===0){return;}
this._moveCursorUpOrDown('Up',e);},_moveCursorUpOrDown:function(direction,e){var action='get'+direction+'CursorOffset',offset=this[action](e,this._selectionDirection==='right');if(e.shiftKey){this.moveCursorWithShift(offset);}
else{this.moveCursorWithoutShift(offset);}
if(offset!==0){this.setSelectionInBoundaries();this.abortCursorAnimation();this._currentCursorOpacity=1;this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea();}},moveCursorWithShift:function(offset){var newSelection=this._selectionDirection==='left'?this.selectionStart+offset:this.selectionEnd+offset;this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,newSelection);return offset!==0;},moveCursorWithoutShift:function(offset){if(offset<0){this.selectionStart+=offset;this.selectionEnd=this.selectionStart;}
else{this.selectionEnd+=offset;this.selectionStart=this.selectionEnd;}
return offset!==0;},moveCursorLeft:function(e){if(this.selectionStart===0&&this.selectionEnd===0){return;}
this._moveCursorLeftOrRight('Left',e);},_move:function(e,prop,direction){var newValue;if(e.altKey){newValue=this['findWordBoundary'+direction](this[prop]);}
else if(e.metaKey||e.keyCode===35||e.keyCode===36){newValue=this['findLineBoundary'+direction](this[prop]);}
else{this[prop]+=direction==='Left'?-1:1;return true;}
if(typeof newValue!==undefined&&this[prop]!==newValue){this[prop]=newValue;return true;}},_moveLeft:function(e,prop){return this._move(e,prop,'Left');},_moveRight:function(e,prop){return this._move(e,prop,'Right');},moveCursorLeftWithoutShift:function(e){var change=true;this._selectionDirection='left';if(this.selectionEnd===this.selectionStart&&this.selectionStart!==0){change=this._moveLeft(e,'selectionStart');}
this.selectionEnd=this.selectionStart;return change;},moveCursorLeftWithShift:function(e){if(this._selectionDirection==='right'&&this.selectionStart!==this.selectionEnd){return this._moveLeft(e,'selectionEnd');}
else if(this.selectionStart!==0){this._selectionDirection='left';return this._moveLeft(e,'selectionStart');}},moveCursorRight:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return;}
this._moveCursorLeftOrRight('Right',e);},_moveCursorLeftOrRight:function(direction,e){var actionName='moveCursor'+direction+'With';this._currentCursorOpacity=1;if(e.shiftKey){actionName+='Shift';}
else{actionName+='outShift';}
if(this[actionName](e)){this.abortCursorAnimation();this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea();}},moveCursorRightWithShift:function(e){if(this._selectionDirection==='left'&&this.selectionStart!==this.selectionEnd){return this._moveRight(e,'selectionStart');}
else if(this.selectionEnd!==this._text.length){this._selectionDirection='right';return this._moveRight(e,'selectionEnd');}},moveCursorRightWithoutShift:function(e){var changed=true;this._selectionDirection='right';if(this.selectionStart===this.selectionEnd){changed=this._moveRight(e,'selectionStart');this.selectionEnd=this.selectionStart;}
else{this.selectionStart=this.selectionEnd;}
return changed;},removeChars:function(start,end){if(typeof end==='undefined'){end=start+1;}
this.removeStyleFromTo(start,end);this._text.splice(start,end-start);this.text=this._text.join('');this.set('dirty',true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}
this._removeExtraneousStyles();},insertChars:function(text,style,start,end){if(typeof end==='undefined'){end=start;}
if(end>start){this.removeStyleFromTo(start,end);}
var graphemes=fabric.util.string.graphemeSplit(text);this.insertNewStyleBlock(graphemes,start,style);this._text=[].concat(this._text.slice(0,start),graphemes,this._text.slice(end));this.text=this._text.join('');this.set('dirty',true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}
this._removeExtraneousStyles();},});(function(){var toFixed=fabric.util.toFixed,multipleSpacesRegex=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{_toSVG:function(){var offsets=this._getSVGLeftTopOffsets(),textAndBg=this._getSVGTextAndBg(offsets.textTop,offsets.textLeft);return this._wrapSVGTextAndBg(textAndBg);},toSVG:function(reviver){return this._createBaseSVGMarkup(this._toSVG(),{reviver:reviver,noStyle:true,withShadow:true});},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)};},_wrapSVGTextAndBg:function(textAndBg){var noShadow=true,textDecoration=this.getSvgTextDecoration(this);return[textAndBg.textBgRects.join(''),'\t\t<text xml:space="preserve" ',(this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,'\'')+'" ':''),(this.fontSize?'font-size="'+this.fontSize+'" ':''),(this.fontStyle?'font-style="'+this.fontStyle+'" ':''),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':''),(textDecoration?'text-decoration="'+textDecoration+'" ':''),'style="',this.getSvgStyles(noShadow),'"',this.addPaintOrder(),' >',textAndBg.textSpans.join(''),'</text>\n'];},_getSVGTextAndBg:function(textTopOffset,textLeftOffset){var textSpans=[],textBgRects=[],height=textTopOffset,lineOffset;this._setSVGBg(textBgRects);for(var i=0,len=this._textLines.length;i<len;i++){lineOffset=this._getLineLeftOffset(i);if(this.textBackgroundColor||this.styleHas('textBackgroundColor',i)){this._setSVGTextLineBg(textBgRects,i,textLeftOffset+lineOffset,height);}
this._setSVGTextLineText(textSpans,i,textLeftOffset+lineOffset,height);height+=this.getHeightOfLine(i);}
return{textSpans:textSpans,textBgRects:textBgRects};},_createTextCharSpan:function(_char,styleDecl,left,top){var shouldUseWhitespace=_char!==_char.trim()||_char.match(multipleSpacesRegex),styleProps=this.getSvgSpanStyles(styleDecl,shouldUseWhitespace),fillStyles=styleProps?'style="'+styleProps+'"':'',dy=styleDecl.deltaY,dySpan='',NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(dy){dySpan=' dy="'+toFixed(dy,NUM_FRACTION_DIGITS)+'" ';}
return['<tspan x="',toFixed(left,NUM_FRACTION_DIGITS),'" y="',toFixed(top,NUM_FRACTION_DIGITS),'" ',dySpan,fillStyles,'>',fabric.util.string.escapeXml(_char),'</tspan>'].join('');},_setSVGTextLineText:function(textSpans,lineIndex,textLeftOffset,textTopOffset){var lineHeight=this.getHeightOfLine(lineIndex),isJustify=this.textAlign.indexOf('justify')!==-1,actualStyle,nextStyle,charsToRender='',charBox,style,boxWidth=0,line=this._textLines[lineIndex],timeToRender;textTopOffset+=lineHeight*(1-this._fontSizeFraction)/this.lineHeight;for(var i=0,len=line.length-1;i<=len;i++){timeToRender=i===len||this.charSpacing;charsToRender+=line[i];charBox=this.__charBounds[lineIndex][i];if(boxWidth===0){textLeftOffset+=charBox.kernedWidth-charBox.width;boxWidth+=charBox.width;}
else{boxWidth+=charBox.kernedWidth;}
if(isJustify&&!timeToRender){if(this._reSpaceAndTab.test(line[i])){timeToRender=true;}}
if(!timeToRender){actualStyle=actualStyle||this.getCompleteStyleDeclaration(lineIndex,i);nextStyle=this.getCompleteStyleDeclaration(lineIndex,i+1);timeToRender=this._hasStyleChangedForSvg(actualStyle,nextStyle);}
if(timeToRender){style=this._getStyleDeclaration(lineIndex,i)||{};textSpans.push(this._createTextCharSpan(charsToRender,style,textLeftOffset,textTopOffset));charsToRender='';actualStyle=nextStyle;textLeftOffset+=boxWidth;boxWidth=0;}}},_pushTextBgRect:function(textBgRects,color,left,top,width,height){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;textBgRects.push('\t\t<rect ',this._getFillAttributes(color),' x="',toFixed(left,NUM_FRACTION_DIGITS),'" y="',toFixed(top,NUM_FRACTION_DIGITS),'" width="',toFixed(width,NUM_FRACTION_DIGITS),'" height="',toFixed(height,NUM_FRACTION_DIGITS),'"></rect>\n');},_setSVGTextLineBg:function(textBgRects,i,leftOffset,textTopOffset){var line=this._textLines[i],heightOfLine=this.getHeightOfLine(i)/this.lineHeight,boxWidth=0,boxStart=0,charBox,currentColor,lastColor=this.getValueOfPropertyAt(i,0,'textBackgroundColor');for(var j=0,jlen=line.length;j<jlen;j++){charBox=this.__charBounds[i][j];currentColor=this.getValueOfPropertyAt(i,j,'textBackgroundColor');if(currentColor!==lastColor){lastColor&&this._pushTextBgRect(textBgRects,lastColor,leftOffset+boxStart,textTopOffset,boxWidth,heightOfLine);boxStart=charBox.left;boxWidth=charBox.width;lastColor=currentColor;}
else{boxWidth+=charBox.kernedWidth;}}
currentColor&&this._pushTextBgRect(textBgRects,currentColor,leftOffset+boxStart,textTopOffset,boxWidth,heightOfLine);},_getFillAttributes:function(value){var fillColor=(value&&typeof value==='string')?new fabric.Color(value):'';if(!fillColor||!fillColor.getSource()||fillColor.getAlpha()===1){return'fill="'+value+'"';}
return'opacity="'+fillColor.getAlpha()+'" fill="'+fillColor.setAlpha(1).toRgb()+'"';},_getSVGLineTopOffset:function(lineIndex){var lineTopOffset=0,lastHeight=0;for(var j=0;j<lineIndex;j++){lineTopOffset+=this.getHeightOfLine(j);}
lastHeight=this.getHeightOfLine(j);return{lineTop:lineTopOffset,offset:(this._fontSizeMult-this._fontSizeFraction)*lastHeight/(this.lineHeight*this._fontSizeMult)};},getSvgStyles:function(skipShadow){var svgStyle=fabric.Object.prototype.getSvgStyles.call(this,skipShadow);return svgStyle+' white-space: pre;';},});})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={});fabric.Textbox=fabric.util.createClass(fabric.IText,fabric.Observable,{type:'textbox',minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:true,noScaleCache:false,_dimensionAffectingProps:fabric.Text.prototype._dimensionAffectingProps.concat('width'),_wordJoiners:/[ \t\r]/,splitByGrapheme:false,initDimensions:function(){if(this.__skipDimension){return;}
this.isEditing&&this.initDelayedCursor();this.clearContextTop();this._clearCache();this.dynamicMinWidth=0;this._styleMap=this._generateStyleMap(this._splitText());if(this.dynamicMinWidth>this.width){this._set('width',this.dynamicMinWidth);}
if(this.textAlign.indexOf('justify')!==-1){this.enlargeSpaces();}
this.height=this.calcTextHeight();this.saveState({propertySet:'_dimensionAffectingProps'});},_generateStyleMap:function(textInfo){var realLineCount=0,realLineCharCount=0,charCount=0,map={};for(var i=0;i<textInfo.graphemeLines.length;i++){if(textInfo.graphemeText[charCount]==='\n'&&i>0){realLineCharCount=0;charCount++;realLineCount++;}
else if(!this.splitByGrapheme&&this._reSpaceAndTab.test(textInfo.graphemeText[charCount])&&i>0){realLineCharCount++;charCount++;}
map[i]={line:realLineCount,offset:realLineCharCount};charCount+=textInfo.graphemeLines[i].length;realLineCharCount+=textInfo.graphemeLines[i].length;}
return map;},styleHas:function(property,lineIndex){if(this._styleMap&&!this.isWrapping){var map=this._styleMap[lineIndex];if(map){lineIndex=map.line;}}
return fabric.Text.prototype.styleHas.call(this,property,lineIndex);},isEmptyStyles:function(lineIndex){if(!this.styles){return true;}
var offset=0,nextLineIndex=lineIndex+1,nextOffset,obj,shouldLimit=false,map=this._styleMap[lineIndex],mapNextLine=this._styleMap[lineIndex+1];if(map){lineIndex=map.line;offset=map.offset;}
if(mapNextLine){nextLineIndex=mapNextLine.line;shouldLimit=nextLineIndex===lineIndex;nextOffset=mapNextLine.offset;}
obj=typeof lineIndex==='undefined'?this.styles:{line:this.styles[lineIndex]};for(var p1 in obj){for(var p2 in obj[p1]){if(p2>=offset&&(!shouldLimit||p2<nextOffset)){for(var p3 in obj[p1][p2]){return false;}}}}
return true;},_getStyleDeclaration:function(lineIndex,charIndex){if(this._styleMap&&!this.isWrapping){var map=this._styleMap[lineIndex];if(!map){return null;}
lineIndex=map.line;charIndex=map.offset+charIndex;}
return this.callSuper('_getStyleDeclaration',lineIndex,charIndex);},_setStyleDeclaration:function(lineIndex,charIndex,style){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;this.styles[lineIndex][charIndex]=style;},_deleteStyleDeclaration:function(lineIndex,charIndex){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;delete this.styles[lineIndex][charIndex];},_getLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];return!!this.styles[map.line];},_setLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];this.styles[map.line]={};},_wrapText:function(lines,desiredWidth){var wrapped=[],i;this.isWrapping=true;for(i=0;i<lines.length;i++){wrapped=wrapped.concat(this._wrapLine(lines[i],i,desiredWidth));}
this.isWrapping=false;return wrapped;},_measureWord:function(word,lineIndex,charOffset){var width=0,prevGrapheme,skipLeft=true;charOffset=charOffset||0;for(var i=0,len=word.length;i<len;i++){var box=this._getGraphemeBox(word[i],lineIndex,i+charOffset,prevGrapheme,skipLeft);width+=box.kernedWidth;prevGrapheme=word[i];}
return width;},_wrapLine:function(_line,lineIndex,desiredWidth,reservedSpace){var lineWidth=0,splitByGrapheme=this.splitByGrapheme,graphemeLines=[],line=[],words=splitByGrapheme?fabric.util.string.graphemeSplit(_line):_line.split(this._wordJoiners),word='',offset=0,infix=splitByGrapheme?'':' ',wordWidth=0,infixWidth=0,largestWordWidth=0,lineJustStarted=true,additionalSpace=this._getWidthOfCharSpacing(),reservedSpace=reservedSpace||0;if(words.length===0){words.push([]);}
desiredWidth-=reservedSpace;for(var i=0;i<words.length;i++){word=splitByGrapheme?words[i]:fabric.util.string.graphemeSplit(words[i]);wordWidth=this._measureWord(word,lineIndex,offset);offset+=word.length;lineWidth+=infixWidth+wordWidth-additionalSpace;if(lineWidth>desiredWidth&&!lineJustStarted){graphemeLines.push(line);line=[];lineWidth=wordWidth;lineJustStarted=true;}
else{lineWidth+=additionalSpace;}
if(!lineJustStarted&&!splitByGrapheme){line.push(infix);}
line=line.concat(word);infixWidth=splitByGrapheme?0:this._measureWord([infix],lineIndex,offset);offset++;lineJustStarted=false;if(wordWidth>largestWordWidth){largestWordWidth=wordWidth;}}
i&&graphemeLines.push(line);if(largestWordWidth+reservedSpace>this.dynamicMinWidth){this.dynamicMinWidth=largestWordWidth-additionalSpace+reservedSpace;}
return graphemeLines;},isEndOfWrapping:function(lineIndex){if(!this._styleMap[lineIndex+1]){return true;}
if(this._styleMap[lineIndex+1].line!==this._styleMap[lineIndex].line){return true;}
return false;},missingNewlineOffset:function(lineIndex){if(this.splitByGrapheme){return this.isEndOfWrapping(lineIndex)?1:0;}
return 1;},_splitTextIntoLines:function(text){var newText=fabric.Text.prototype._splitTextIntoLines.call(this,text),graphemeLines=this._wrapText(newText.lines,this.width),lines=new Array(graphemeLines.length);for(var i=0;i<graphemeLines.length;i++){lines[i]=graphemeLines[i].join('');}
newText.lines=lines;newText.graphemeLines=graphemeLines;return newText;},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth);},_removeExtraneousStyles:function(){var linesToKeep={};for(var prop in this._styleMap){if(this._textLines[prop]){linesToKeep[this._styleMap[prop].line]=1;}}
for(var prop in this.styles){if(!linesToKeep[prop]){delete this.styles[prop];}}},toObject:function(propertiesToInclude){return this.callSuper('toObject',['minWidth','splitByGrapheme'].concat(propertiesToInclude));}});fabric.Textbox.fromObject=function(object,callback){return fabric.Object._fromObject('Textbox',object,callback,'text');};})(typeof exports!=='undefined'?exports:this);(function(){var controlsUtils=fabric.controlsUtils,scaleSkewStyleHandler=controlsUtils.scaleSkewCursorStyleHandler,scaleStyleHandler=controlsUtils.scaleCursorStyleHandler,scalingEqually=controlsUtils.scalingEqually,scalingYOrSkewingX=controlsUtils.scalingYOrSkewingX,scalingXOrSkewingY=controlsUtils.scalingXOrSkewingY,scaleOrSkewActionName=controlsUtils.scaleOrSkewActionName,objectControls=fabric.Object.prototype.controls;objectControls.ml=new fabric.Control({x:-0.5,y:0,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingXOrSkewingY,getActionName:scaleOrSkewActionName,});objectControls.mr=new fabric.Control({x:0.5,y:0,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingXOrSkewingY,getActionName:scaleOrSkewActionName,});objectControls.mb=new fabric.Control({x:0,y:0.5,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingYOrSkewingX,getActionName:scaleOrSkewActionName,});objectControls.mt=new fabric.Control({x:0,y:-0.5,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingYOrSkewingX,getActionName:scaleOrSkewActionName,});objectControls.tl=new fabric.Control({x:-0.5,y:-0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.tr=new fabric.Control({x:0.5,y:-0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.bl=new fabric.Control({x:-0.5,y:0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.br=new fabric.Control({x:0.5,y:0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.mtr=new fabric.Control({x:0,y:-0.5,actionHandler:controlsUtils.rotationWithSnapping,cursorStyleHandler:controlsUtils.rotationStyleHandler,offsetY:-40,withConnection:true,actionName:'rotate',});if(fabric.Textbox){var textBoxControls=fabric.Textbox.prototype.controls={};textBoxControls.mtr=objectControls.mtr;textBoxControls.tr=objectControls.tr;textBoxControls.br=objectControls.br;textBoxControls.tl=objectControls.tl;textBoxControls.bl=objectControls.bl;textBoxControls.mt=objectControls.mt;textBoxControls.mb=objectControls.mb;textBoxControls.mr=new fabric.Control({x:0.5,y:0,actionHandler:controlsUtils.changeWidth,cursorStyleHandler:scaleSkewStyleHandler,actionName:'resizing',});textBoxControls.ml=new fabric.Control({x:-0.5,y:0,actionHandler:controlsUtils.changeWidth,cursorStyleHandler:scaleSkewStyleHandler,actionName:'resizing',});}})();(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==='object'&&typeof module==='object')
module.exports=factory();else if(typeof define==='function'&&define.amd)
define([],factory);else if(typeof exports==='object')
exports["colorPicker"]=factory();else
root["tui"]=root["tui"]||{},root["tui"]["colorPicker"]=factory();})(window,function(){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports;}
var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter});}};__webpack_require__.r=function(exports){if(typeof Symbol!=='undefined'&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:'Module'});}
Object.defineProperty(exports,'__esModule',{value:true});};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if((mode&4)&&typeof value==='object'&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,'default',{enumerable:true,value:value});if(mode&2&&typeof value!='string')for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key];}.bind(null,key));return ns;};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default'];}:function getModuleExports(){return module;};__webpack_require__.d(getter,'a',getter);return getter;};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property);};__webpack_require__.p="dist";return __webpack_require__(__webpack_require__.s=33);})
([(function(module,exports,__webpack_require__){"use strict";function extend(target,objects){var hasOwnProp=Object.prototype.hasOwnProperty;var source,prop,i,len;for(i=1,len=arguments.length;i<len;i+=1){source=arguments[i];for(prop in source){if(hasOwnProp.call(source,prop)){target[prop]=source[prop];}}}
return target;}
module.exports=extend;}),(function(module,exports,__webpack_require__){"use strict";function isArray(obj){return obj instanceof Array;}
module.exports=isArray;}),(function(module,exports,__webpack_require__){"use strict";var isArray=__webpack_require__(1);var forEachArray=__webpack_require__(6);var forEachOwnProperties=__webpack_require__(7);function forEach(obj,iteratee,context){if(isArray(obj)){forEachArray(obj,iteratee,context);}else{forEachOwnProperties(obj,iteratee,context);}}
module.exports=forEach;}),(function(module,exports,__webpack_require__){"use strict";function isUndefined(obj){return obj===undefined;}
module.exports=isUndefined;}),(function(module,exports,__webpack_require__){"use strict";var browser=__webpack_require__(22);var forEach=__webpack_require__(2);var forEachArray=__webpack_require__(6);var forEachOwnProperties=__webpack_require__(7);var sendHostname=__webpack_require__(37);var currentId=0;var utils={getLength:function(obj){var length=0;forEachOwnProperties(obj,function(){length+=1;});return length;},map:function(obj,iteratee,context){var result=[];forEach(obj,function(){result.push(iteratee.apply(context||null,arguments));});return result;},filter:function(arr,iteratee,context){var result=[];forEachArray(arr,function(elem){if(iteratee.apply(context||null,arguments)){result.push(elem);}});return result;},generateId:function(){currentId+=1;return currentId;},isOldBrowser:function(){return browser.msie&&browser.version<9;}(),sendHostName:function(){sendHostname('color-picker','UA-129987462-1');}};module.exports=utils;}),(function(module,exports,__webpack_require__){"use strict";var isArray=__webpack_require__(1);function inArray(searchElement,array,startIndex){var i;var length;startIndex=startIndex||0;if(!isArray(array)){return-1;}
if(Array.prototype.indexOf){return Array.prototype.indexOf.call(array,searchElement,startIndex);}
length=array.length;for(i=startIndex;startIndex>=0&&i<length;i+=1){if(array[i]===searchElement){return i;}}
return-1;}
module.exports=inArray;}),(function(module,exports,__webpack_require__){"use strict";function forEachArray(arr,iteratee,context){var index=0;var len=arr.length;context=context||null;for(;index<len;index+=1){if(iteratee.call(context,arr[index],index,arr)===false){break;}}}
module.exports=forEachArray;}),(function(module,exports,__webpack_require__){"use strict";function forEachOwnProperties(obj,iteratee,context){var key;context=context||null;for(key in obj){if(obj.hasOwnProperty(key)){if(iteratee.call(context,obj[key],key,obj)===false){break;}}}}
module.exports=forEachOwnProperties;}),(function(module,exports,__webpack_require__){"use strict";var addClass=__webpack_require__(39);var isFunction=__webpack_require__(13);var isNumber=__webpack_require__(41);var isUndefined=__webpack_require__(3);var domUtil=__webpack_require__(9);var Collection=__webpack_require__(19);var util=__webpack_require__(4);function View(options,container){var id=util.generateId();options=options||{};if(isUndefined(container)){container=domUtil.appendHTMLElement('div');}
addClass(container,'tui-view-'+id);this.id=id;this.container=container;this.childs=new Collection(function(view){return view.id;});this.parent=null;}
View.prototype.addChild=function(view,fn){if(fn){fn.call(view,this);}
view.parent=this;this.childs.add(view);};View.prototype.removeChild=function(id,fn){var view=isNumber(id)?this.childs.items[id]:id;if(fn){fn.call(view,this);}
this.childs.remove(view.id);};View.prototype.render=function(){this.childs.each(function(childView){childView.render();});};View.prototype.recursive=function(fn,skipThis){if(!isFunction(fn)){return;}
if(!skipThis){fn(this);}
this.childs.each(function(childView){childView.recursive(fn);});};View.prototype.resize=function(){var args=Array.prototype.slice.call(arguments);var parent=this.parent;while(parent){if(isFunction(parent._onResize)){parent._onResize.apply(parent,args);}
parent=parent.parent;}};View.prototype._beforeDestroy=function(){};View.prototype._destroy=function(){this._beforeDestroy();this.container.innerHTML='';this.id=this.parent=this.childs=this.container=null;};View.prototype.destroy=function(isChildView){if(this.childs){this.childs.each(function(childView){childView.destroy(true);childView._destroy();});this.childs.clear();}
if(isChildView){return;}
this._destroy();};View.prototype.getViewBound=function(){var bound=this.container.getBoundingClientRect();return{x:bound.left,y:bound.top,width:bound.right-bound.left,height:bound.bottom-bound.top};};module.exports=View;}),(function(module,exports,__webpack_require__){"use strict";var domUtil={appendHTMLElement:function(tagName,container,className){var el=document.createElement(tagName);el.className=className||'';if(container){container.appendChild(el);}else{document.body.appendChild(el);}
return el;}};module.exports=domUtil;}),(function(module,exports,__webpack_require__){"use strict";var extend=__webpack_require__(0);var isExisty=__webpack_require__(20);var isString=__webpack_require__(11);var isObject=__webpack_require__(21);var isArray=__webpack_require__(1);var isFunction=__webpack_require__(13);var forEach=__webpack_require__(2);var R_EVENTNAME_SPLIT=/\s+/g;function CustomEvents(){this.events=null;this.contexts=null;}
CustomEvents.mixin=function(func){extend(func.prototype,CustomEvents.prototype);};CustomEvents.prototype._getHandlerItem=function(handler,context){var item={handler:handler};if(context){item.context=context;}
return item;};CustomEvents.prototype._safeEvent=function(eventName){var events=this.events;var byName;if(!events){events=this.events={};}
if(eventName){byName=events[eventName];if(!byName){byName=[];events[eventName]=byName;}
events=byName;}
return events;};CustomEvents.prototype._safeContext=function(){var context=this.contexts;if(!context){context=this.contexts=[];}
return context;};CustomEvents.prototype._indexOfContext=function(ctx){var context=this._safeContext();var index=0;while(context[index]){if(ctx===context[index][0]){return index;}
index+=1;}
return-1;};CustomEvents.prototype._memorizeContext=function(ctx){var context,index;if(!isExisty(ctx)){return;}
context=this._safeContext();index=this._indexOfContext(ctx);if(index>-1){context[index][1]+=1;}else{context.push([ctx,1]);}};CustomEvents.prototype._forgetContext=function(ctx){var context,contextIndex;if(!isExisty(ctx)){return;}
context=this._safeContext();contextIndex=this._indexOfContext(ctx);if(contextIndex>-1){context[contextIndex][1]-=1;if(context[contextIndex][1]<=0){context.splice(contextIndex,1);}}};CustomEvents.prototype._bindEvent=function(eventName,handler,context){var events=this._safeEvent(eventName);this._memorizeContext(context);events.push(this._getHandlerItem(handler,context));};CustomEvents.prototype.on=function(eventName,handler,context){var self=this;if(isString(eventName)){eventName=eventName.split(R_EVENTNAME_SPLIT);forEach(eventName,function(name){self._bindEvent(name,handler,context);});}else if(isObject(eventName)){context=handler;forEach(eventName,function(func,name){self.on(name,func,context);});}};CustomEvents.prototype.once=function(eventName,handler,context){var self=this;if(isObject(eventName)){context=handler;forEach(eventName,function(func,name){self.once(name,func,context);});return;}
function onceHandler(){handler.apply(context,arguments);self.off(eventName,onceHandler,context);}
this.on(eventName,onceHandler,context);};CustomEvents.prototype._spliceMatches=function(arr,predicate){var i=0;var len;if(!isArray(arr)){return;}
for(len=arr.length;i<len;i+=1){if(predicate(arr[i])===true){arr.splice(i,1);len-=1;i-=1;}}};CustomEvents.prototype._matchHandler=function(handler){var self=this;return function(item){var needRemove=handler===item.handler;if(needRemove){self._forgetContext(item.context);}
return needRemove;};};CustomEvents.prototype._matchContext=function(context){var self=this;return function(item){var needRemove=context===item.context;if(needRemove){self._forgetContext(item.context);}
return needRemove;};};CustomEvents.prototype._matchHandlerAndContext=function(handler,context){var self=this;return function(item){var matchHandler=(handler===item.handler);var matchContext=(context===item.context);var needRemove=(matchHandler&&matchContext);if(needRemove){self._forgetContext(item.context);}
return needRemove;};};CustomEvents.prototype._offByEventName=function(eventName,handler){var self=this;var andByHandler=isFunction(handler);var matchHandler=self._matchHandler(handler);eventName=eventName.split(R_EVENTNAME_SPLIT);forEach(eventName,function(name){var handlerItems=self._safeEvent(name);if(andByHandler){self._spliceMatches(handlerItems,matchHandler);}else{forEach(handlerItems,function(item){self._forgetContext(item.context);});self.events[name]=[];}});};CustomEvents.prototype._offByHandler=function(handler){var self=this;var matchHandler=this._matchHandler(handler);forEach(this._safeEvent(),function(handlerItems){self._spliceMatches(handlerItems,matchHandler);});};CustomEvents.prototype._offByObject=function(obj,handler){var self=this;var matchFunc;if(this._indexOfContext(obj)<0){forEach(obj,function(func,name){self.off(name,func);});}else if(isString(handler)){matchFunc=this._matchContext(obj);self._spliceMatches(this._safeEvent(handler),matchFunc);}else if(isFunction(handler)){matchFunc=this._matchHandlerAndContext(handler,obj);forEach(this._safeEvent(),function(handlerItems){self._spliceMatches(handlerItems,matchFunc);});}else{matchFunc=this._matchContext(obj);forEach(this._safeEvent(),function(handlerItems){self._spliceMatches(handlerItems,matchFunc);});}};CustomEvents.prototype.off=function(eventName,handler){if(isString(eventName)){this._offByEventName(eventName,handler);}else if(!arguments.length){this.events={};this.contexts=[];}else if(isFunction(eventName)){this._offByHandler(eventName);}else if(isObject(eventName)){this._offByObject(eventName,handler);}};CustomEvents.prototype.fire=function(eventName){this.invoke.apply(this,arguments);};CustomEvents.prototype.invoke=function(eventName){var events,args,index,item;if(!this.hasListener(eventName)){return true;}
events=this._safeEvent(eventName);args=Array.prototype.slice.call(arguments,1);index=0;while(events[index]){item=events[index];if(item.handler.apply(item.context,args)===false){return false;}
index+=1;}
return true;};CustomEvents.prototype.hasListener=function(eventName){return this.getListenerLength(eventName)>0;};CustomEvents.prototype.getListenerLength=function(eventName){var events=this._safeEvent(eventName);return events.length;};module.exports=CustomEvents;}),(function(module,exports,__webpack_require__){"use strict";function isString(obj){return typeof obj==='string'||obj instanceof String;}
module.exports=isString;}),(function(module,exports,__webpack_require__){"use strict";var hexRX=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;var colorUtil={leadingZero:function(number,length){var zero='';var i=0;if((number+'').length>length){return number+'';}
for(;i<length-1;i+=1){zero+='0';}
return(zero+number).slice(length*-1);},isValidRGB:function(str){return hexRX.test(str);},hexToRGB:function(hexStr){var r,g,b;if(!colorUtil.isValidRGB(hexStr)){return false;}
hexStr=hexStr.substring(1);r=parseInt(hexStr.substr(0,2),16);g=parseInt(hexStr.substr(2,2),16);b=parseInt(hexStr.substr(4,2),16);return[r,g,b];},rgbToHEX:function(r,g,b){var hexStr='#'+colorUtil.leadingZero(r.toString(16),2)+colorUtil.leadingZero(g.toString(16),2)+colorUtil.leadingZero(b.toString(16),2);if(colorUtil.isValidRGB(hexStr)){return hexStr;}
return false;},rgbToHSV:function(r,g,b){var max,min,h,s,v,d;r/=255;g/=255;b/=255;max=Math.max(r,g,b);min=Math.min(r,g,b);v=max;d=max-min;s=max===0?0:d/max;if(max===min){h=0;}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
h/=6;}
return[Math.round(h*360),Math.round(s*100),Math.round(v*100)];},hsvToRGB:function(h,s,v){var r,g,b;var i;var f,p,q,t;h=Math.max(0,Math.min(360,h));s=Math.max(0,Math.min(100,s));v=Math.max(0,Math.min(100,v));s/=100;v/=100;if(s===0){r=g=b=v;return[Math.round(r*255),Math.round(g*255),Math.round(b*255)];}
h/=60;i=Math.floor(h);f=h-i;p=v*(1-s);q=v*(1-s*f);t=v*(1-s*(1-f));switch(i){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;default:r=v;g=p;b=q;break;}
return[Math.round(r*255),Math.round(g*255),Math.round(b*255)];}};module.exports=colorUtil;}),(function(module,exports,__webpack_require__){"use strict";function isFunction(obj){return obj instanceof Function;}
module.exports=isFunction;}),(function(module,exports,__webpack_require__){"use strict";var isString=__webpack_require__(11);var forEach=__webpack_require__(2);var safeEvent=__webpack_require__(26);function on(element,types,handler,context){if(isString(types)){forEach(types.split(/\s+/g),function(type){bindEvent(element,type,handler,context);});return;}
forEach(types,function(func,type){bindEvent(element,type,func,handler);});}
function bindEvent(element,type,handler,context){function eventHandler(e){handler.call(context||element,e||window.event);}
if('addEventListener'in element){element.addEventListener(type,eventHandler);}else if('attachEvent'in element){element.attachEvent('on'+type,eventHandler);}
memorizeHandler(element,type,handler,eventHandler);}
function memorizeHandler(element,type,handler,wrappedHandler){var events=safeEvent(element,type);var existInEvents=false;forEach(events,function(obj){if(obj.handler===handler){existInEvents=true;return false;}
return true;});if(!existInEvents){events.push({handler:handler,wrappedHandler:wrappedHandler});}}
module.exports=on;}),(function(module,exports,__webpack_require__){"use strict";function preventDefault(e){if(e.preventDefault){e.preventDefault();return;}
e.returnValue=false;}
module.exports=preventDefault;}),(function(module,exports,__webpack_require__){"use strict";function convertToKebabCase(key){return key.replace(/([A-Z])/g,function(match){return'-'+match.toLowerCase();});}
module.exports=convertToKebabCase;}),(function(module,exports,__webpack_require__){"use strict";var isString=__webpack_require__(11);var forEach=__webpack_require__(2);var safeEvent=__webpack_require__(26);function off(element,types,handler){if(isString(types)){forEach(types.split(/\s+/g),function(type){unbindEvent(element,type,handler);});return;}
forEach(types,function(func,type){unbindEvent(element,type,func);});}
function unbindEvent(element,type,handler){var events=safeEvent(element,type);var index;if(!handler){forEach(events,function(item){removeHandler(element,type,item.wrappedHandler);});events.splice(0,events.length);}else{forEach(events,function(item,idx){if(handler===item.handler){removeHandler(element,type,item.wrappedHandler);index=idx;return false;}
return true;});events.splice(index,1);}}
function removeHandler(element,type,handler){if('removeEventListener'in element){element.removeEventListener(type,handler);}else if('detachEvent'in element){element.detachEvent('on'+type,handler);}}
module.exports=off;}),(function(module,exports,__webpack_require__){"use strict";var createObject=__webpack_require__(50);function inherit(subType,superType){var prototype=createObject(superType.prototype);prototype.constructor=subType;subType.prototype=prototype;}
module.exports=inherit;}),(function(module,exports,__webpack_require__){"use strict";var forEachArray=__webpack_require__(6);var forEachOwnProperties=__webpack_require__(7);var extend=__webpack_require__(0);var isArray=__webpack_require__(1);var isExisty=__webpack_require__(20);var isFunction=__webpack_require__(13);var isObject=__webpack_require__(21);var util=__webpack_require__(4);var slice=Array.prototype.slice;function Collection(getItemIDFn){this.items={};this.length=0;if(isFunction(getItemIDFn)){this.getItemID=getItemIDFn;}}
Collection.and=function(filters){var cnt;filters=slice.call(arguments);cnt=filters.length;return function(item){var i=0;for(;i<cnt;i+=1){if(!filters[i].call(null,item)){return false;}}
return true;};};Collection.or=function(filters){var cnt;filters=slice.call(arguments);cnt=filters.length;return function(item){var i=1;var result=filters[0].call(null,item);for(;i<cnt;i+=1){result=result||filters[i].call(null,item);}
return result;};};Collection.merge=function(firstCollection){var newItems={};var merged=new Collection(firstCollection.getItemID);forEachArray(arguments,function(col){extend(newItems,col.items);});merged.items=newItems;merged.length=util.getLength(merged.items);return merged;};Collection.prototype.getItemID=function(item){return item._id+'';};Collection.prototype.add=function(item){var id,ownItems;if(arguments.length>1){forEachArray(slice.call(arguments),function(o){this.add(o);},this);return;}
id=this.getItemID(item);ownItems=this.items;if(!ownItems[id]){this.length+=1;}
ownItems[id]=item;};Collection.prototype.remove=function(id){var removed=[];var ownItems,itemToRemove;if(!this.length){return removed;}
if(arguments.length>1){removed=util.map(slice.call(arguments),function(id){return this.remove(id);},this);return removed;}
ownItems=this.items;if(isObject(id)){id=this.getItemID(id);}
if(!ownItems[id]){return removed;}
this.length-=1;itemToRemove=ownItems[id];delete ownItems[id];return itemToRemove;};Collection.prototype.clear=function(){this.items={};this.length=0;};Collection.prototype.has=function(id){var isFilter,has;if(!this.length){return false;}
isFilter=isFunction(id);has=false;if(isFilter){this.each(function(item){if(id(item)===true){has=true;return false;}
return true;});}else{id=isObject(id)?this.getItemID(id):id;has=isExisty(this.items[id]);}
return has;};Collection.prototype.doWhenHas=function(id,fn,context){var item=this.items[id];if(!isExisty(item)){return;}
fn.call(context||this,item);};Collection.prototype.find=function(filter){var result=new Collection();if(this.hasOwnProperty('getItemID')){result.getItemID=this.getItemID;}
this.each(function(item){if(filter(item)===true){result.add(item);}});return result;};Collection.prototype.groupBy=function(key,groupFunc){var result={};var keyIsFunc=isFunction(key);var getItemIDFn=this.getItemID;var collection,baseValue;if(isArray(key)){forEachArray(key,function(k){result[k+'']=new Collection(getItemIDFn);});if(!groupFunc){return result;}
key=groupFunc;keyIsFunc=true;}
this.each(function(item){if(keyIsFunc){baseValue=key(item);}else{baseValue=item[key];if(isFunction(baseValue)){baseValue=baseValue.apply(item);}}
collection=result[baseValue];if(!collection){collection=result[baseValue]=new Collection(getItemIDFn);}
collection.add(item);});return result;};Collection.prototype.single=function(){var result;this.each(function(item){result=item;return false;},this);return result;};Collection.prototype.sort=function(compareFunction){var arr=[];this.each(function(item){arr.push(item);});if(isFunction(compareFunction)){arr=arr.sort(compareFunction);}
return arr;};Collection.prototype.each=function(iteratee,context){forEachOwnProperties(this.items,iteratee,context||this);};Collection.prototype.toArray=function(){if(!this.length){return[];}
return util.map(this.items,function(item){return item;});};module.exports=Collection;}),(function(module,exports,__webpack_require__){"use strict";var isUndefined=__webpack_require__(3);var isNull=__webpack_require__(36);function isExisty(param){return!isUndefined(param)&&!isNull(param);}
module.exports=isExisty;}),(function(module,exports,__webpack_require__){"use strict";function isObject(obj){return obj===Object(obj);}
module.exports=isObject;}),(function(module,exports,__webpack_require__){"use strict";var browser={chrome:false,firefox:false,safari:false,msie:false,edge:false,others:false,version:0};if(typeof window!=='undefined'&&window.navigator){detectBrowser();}
function detectBrowser(){var nav=window.navigator;var appName=nav.appName.replace(/\s/g,'_');var userAgent=nav.userAgent;var rIE=/MSIE\s([0-9]+[.0-9]*)/;var rIE11=/Trident.*rv:11\./;var rEdge=/Edge\/(\d+)\./;var versionRegex={firefox:/Firefox\/(\d+)\./,chrome:/Chrome\/(\d+)\./,safari:/Version\/([\d.]+).*Safari\/(\d+)/};var key,tmp;var detector={Microsoft_Internet_Explorer:function(){var detectedVersion=userAgent.match(rIE);if(detectedVersion){browser.msie=true;browser.version=parseFloat(detectedVersion[1]);}else{browser.others=true;}},Netscape:function(){var detected=false;if(rIE11.exec(userAgent)){browser.msie=true;browser.version=11;detected=true;}else if(rEdge.exec(userAgent)){browser.edge=true;browser.version=userAgent.match(rEdge)[1];detected=true;}else{for(key in versionRegex){if(versionRegex.hasOwnProperty(key)){tmp=userAgent.match(versionRegex[key]);if(tmp&&tmp.length>1){browser[key]=detected=true;browser.version=parseFloat(tmp[1]||0);break;}}}}
if(!detected){browser.others=true;}}};var fn=detector[appName];if(fn){detector[appName]();}}
module.exports=browser;}),(function(module,exports,__webpack_require__){"use strict";var isUndefined=__webpack_require__(3);function getClass(element){if(!element||!element.className){return'';}
if(isUndefined(element.className.baseVal)){return element.className;}
return element.className.baseVal;}
module.exports=getClass;}),(function(module,exports,__webpack_require__){"use strict";(function(global){var CustomEvents=__webpack_require__(10);var disableTextSelection=__webpack_require__(42);var enableTextSelection=__webpack_require__(44);var getMouseButton=__webpack_require__(47);var getTarget=__webpack_require__(28);var off=__webpack_require__(17);var on=__webpack_require__(14);var preventDefault=__webpack_require__(15);var extend=__webpack_require__(0);function Drag(options,container){on(container,'mousedown',this._onMouseDown,this);this.options=extend({distance:10},options);this.container=container;this._isMoved=false;this._distance=0;this._dragStartFired=false;this._dragStartEventData=null;}
Drag.prototype.destroy=function(){off(this.container,'mousedown',this._onMouseDown);this.options=this.container=this._isMoved=this._distance=this._dragStartFired=this._dragStartEventData=null;};Drag.prototype._toggleDragEvent=function(toBind){var container=this.container;if(toBind){disableTextSelection(container);on(window,'dragstart',preventDefault);on(global.document,{mousemove:this._onMouseMove,mouseup:this._onMouseUp},this);}else{enableTextSelection(container);off(window,'dragstart',preventDefault);off(global.document,{mousemove:this._onMouseMove,mouseup:this._onMouseUp});}};Drag.prototype._getEventData=function(mouseEvent){return{target:getTarget(mouseEvent),originEvent:mouseEvent};};Drag.prototype._onMouseDown=function(mouseDownEvent){if(getMouseButton(mouseDownEvent)!==0){return;}
this._distance=0;this._dragStartFired=false;this._dragStartEventData=this._getEventData(mouseDownEvent);this._toggleDragEvent(true);};Drag.prototype._onMouseMove=function(mouseMoveEvent){var distance=this.options.distance;preventDefault(mouseMoveEvent);this._isMoved=true;if(this._distance<distance){this._distance+=1;return;}
if(!this._dragStartFired){this._dragStartFired=true;if(!this.invoke('dragStart',this._dragStartEventData)){this._toggleDragEvent(false);return;}}
this.fire('drag',this._getEventData(mouseMoveEvent));};Drag.prototype._onMouseUp=function(mouseUpEvent){this._toggleDragEvent(false);if(this._isMoved){this._isMoved=false;this.fire('dragEnd',this._getEventData(mouseUpEvent));return;}
this.fire('click',this._getEventData(mouseUpEvent));};CustomEvents.mixin(Drag);module.exports=Drag;}.call(this,__webpack_require__(25)))}),(function(module,exports){var g;g=(function(){return this;})();try{g=g||new Function("return this")();}catch(e){if(typeof window==="object")g=window;}
module.exports=g;}),(function(module,exports,__webpack_require__){"use strict";var EVENT_KEY='_feEventKey';function safeEvent(element,type){var events=element[EVENT_KEY];var handlers;if(!events){events=element[EVENT_KEY]={};}
handlers=events[type];if(!handlers){handlers=events[type]=[];}
return handlers;}
module.exports=safeEvent;}),(function(module,exports,__webpack_require__){"use strict";function testCSSProp(props){var style=document.documentElement.style;var i,len;for(i=0,len=props.length;i<len;i+=1){if(props[i]in style){return props[i];}}
return false;}
module.exports=testCSSProp;}),(function(module,exports,__webpack_require__){"use strict";function getTarget(e){return e.target||e.srcElement;}
module.exports=getTarget;}),(function(module,exports,__webpack_require__){"use strict";var CustomEvents=__webpack_require__(10);var getTarget=__webpack_require__(28);var off=__webpack_require__(17);var on=__webpack_require__(14);var hasClass=__webpack_require__(30);var extend=__webpack_require__(0);var inherit=__webpack_require__(18);var domUtil=__webpack_require__(9);var colorUtil=__webpack_require__(12);var View=__webpack_require__(8);var tmpl=__webpack_require__(51);function Palette(options,container){this.options=extend({cssPrefix:'tui-colorpicker-',preset:['#181818','#282828','#383838','#585858','#B8B8B8','#D8D8D8','#E8E8E8','#F8F8F8','#AB4642','#DC9656','#F7CA88','#A1B56C','#86C1B9','#7CAFC2','#BA8BAF','#A16946'],detailTxt:'Detail'},options);container=domUtil.appendHTMLElement('div',container,this.options.cssPrefix+'palette-container');View.call(this,options,container);}
inherit(Palette,View);Palette.prototype._onClick=function(clickEvent){var options=this.options;var target=getTarget(clickEvent);var eventData={};if(hasClass(target,options.cssPrefix+'palette-button')){eventData.color=target.value;this.fire('_selectColor',eventData);return;}
if(hasClass(target,options.cssPrefix+'palette-toggle-slider')){this.fire('_toggleSlider');}};Palette.prototype._onChange=function(changeEvent){var options=this.options;var target=getTarget(changeEvent);var eventData={};if(hasClass(target,options.cssPrefix+'palette-hex')){eventData.color=target.value;this.fire('_selectColor',eventData);}};Palette.prototype._beforeDestroy=function(){this._toggleEvent(false);};Palette.prototype._toggleEvent=function(toBind){var options=this.options;var container=this.container;var handleEvent=toBind?on:off;var hexTextBox;handleEvent(container,'click',this._onClick,this);hexTextBox=container.querySelector('.'+options.cssPrefix+'palette-hex',container);if(hexTextBox){handleEvent(hexTextBox,'change',this._onChange,this);}};Palette.prototype.render=function(color){var options=this.options;var html='';this._toggleEvent(false);html=tmpl({cssPrefix:options.cssPrefix,preset:options.preset,detailTxt:options.detailTxt,color:color,isValidRGB:colorUtil.isValidRGB,getItemClass:function(itemColor){return!itemColor?' '+options.cssPrefix+'color-transparent':'';},isSelected:function(itemColor){return itemColor===color?' '+options.cssPrefix+'selected':'';}});this.container.innerHTML=html;this._toggleEvent(true);};CustomEvents.mixin(Palette);module.exports=Palette;}),(function(module,exports,__webpack_require__){"use strict";var inArray=__webpack_require__(5);var getClass=__webpack_require__(23);function hasClass(element,cssClass){var origin;if(element.classList){return element.classList.contains(cssClass);}
origin=getClass(element).split(/\s+/);return inArray(cssClass,origin)>-1;}
module.exports=hasClass;}),(function(module,exports,__webpack_require__){"use strict";var CustomEvents=__webpack_require__(10);var getMousePosition=__webpack_require__(53);var closest=__webpack_require__(54);var hasClass=__webpack_require__(30);var extend=__webpack_require__(0);var inherit=__webpack_require__(18);var domUtil=__webpack_require__(9);var svgvml=__webpack_require__(32);var colorUtil=__webpack_require__(12);var View=__webpack_require__(8);var Drag=__webpack_require__(24);var tmpl=__webpack_require__(57);var DEFAULT_COLORSLIDER_POS_LIMIT_MIN=-7;var DEFAULT_COLORSLIDER_POS_LIMIT_MAX=112;var DEFAULT_HUEBAR_POS_LIMIT_MIN=-3;var DEFAULT_HUEBAR_POS_LIMIT_MAX=115;var HUE_WHEEL_MAX=359.99;function Slider(options,container){container=domUtil.appendHTMLElement('div',container,options.cssPrefix+'slider-container');container.style.display='none';View.call(this,options,container);this.options=extend({color:'#f8f8f8',cssPrefix:'tui-colorpicker-'},options);this._dragDataCache={};this.sliderHandleElement=null;this.huebarHandleElement=null;this.baseColorElement=null;this.drag=new Drag({distance:0},container);this.colorSliderPosLimitRange=[DEFAULT_COLORSLIDER_POS_LIMIT_MIN,DEFAULT_COLORSLIDER_POS_LIMIT_MAX];this.huebarPosLimitRange=[DEFAULT_HUEBAR_POS_LIMIT_MIN,DEFAULT_HUEBAR_POS_LIMIT_MAX];this.drag.on({dragStart:this._onDragStart,drag:this._onDrag,dragEnd:this._onDragEnd,click:this._onClick},this);}
inherit(Slider,View);Slider.prototype._beforeDestroy=function(){this.drag.off();this.drag=this.options=this._dragDataCache=this.sliderHandleElement=this.huebarHandleElement=this.baseColorElement=null;};Slider.prototype.toggle=function(onOff){this.container.style.display=!!onOff?'block':'none';};Slider.prototype.isVisible=function(){return this.container.style.display==='block';};Slider.prototype.render=function(colorStr){var container=this.container;var options=this.options;var html=tmpl.layout;var rgb,hsv;if(!colorUtil.isValidRGB(colorStr)){return;}
html=html.replace(/{{slider}}/,tmpl.slider);html=html.replace(/{{huebar}}/,tmpl.huebar);html=html.replace(/{{cssPrefix}}/g,options.cssPrefix);html=html.replace(/{{id}}/g,options.id);this.container.innerHTML=html;this.sliderSvgElement=container.querySelector('.'+options.cssPrefix+'svg-slider');this.huebarSvgElement=container.querySelector('.'+options.cssPrefix+'svg-huebar');this.sliderHandleElement=container.querySelector('.'+options.cssPrefix+'slider-handle');this.huebarHandleElement=container.querySelector('.'+options.cssPrefix+'huebar-handle');this.baseColorElement=container.querySelector('.'+options.cssPrefix+'slider-basecolor');rgb=colorUtil.hexToRGB(colorStr);hsv=colorUtil.rgbToHSV.apply(null,rgb);this.moveHue(hsv[0],true);this.moveSaturationAndValue(hsv[1],hsv[2],true);};Slider.prototype._setColorSliderPosMax=function(){var sliderRects=this.sliderSvgElement.getClientRects()[0];if(sliderRects){this.colorSliderPosLimitRange[1]=sliderRects.height-10;}};Slider.prototype._moveColorSliderHandle=function(newLeft,newTop,silent){var handle=this.sliderHandleElement;var handleColor;newTop=Math.max(this.colorSliderPosLimitRange[0],newTop);newTop=Math.min(this.colorSliderPosLimitRange[1],newTop);newLeft=Math.max(this.colorSliderPosLimitRange[0],newLeft);newLeft=Math.min(this.colorSliderPosLimitRange[1],newLeft);svgvml.setTranslateXY(handle,newLeft,newTop);handleColor=newTop>50?'white':'black';svgvml.setStrokeColor(handle,handleColor);if(!silent){this.fire('_selectColor',{color:colorUtil.rgbToHEX.apply(null,this.getRGB())});}};Slider.prototype.moveSaturationAndValue=function(saturation,value,silent){var absMin,maxValue,newLeft,newTop;saturation=saturation||0;value=value||0;absMin=Math.abs(this.colorSliderPosLimitRange[0]);maxValue=this.colorSliderPosLimitRange[1];newLeft=saturation*maxValue/100-absMin;newTop=maxValue-value*maxValue/100-absMin;this._moveColorSliderHandle(newLeft,newTop,silent);};Slider.prototype._moveColorSliderByPosition=function(x,y){var offset=this.colorSliderPosLimitRange[0];this._moveColorSliderHandle(x+offset,y+offset);};Slider.prototype.getSaturationAndValue=function(){var absMin=Math.abs(this.colorSliderPosLimitRange[0]);var maxValue=absMin+this.colorSliderPosLimitRange[1];var position=svgvml.getTranslateXY(this.sliderHandleElement);var saturation,value;saturation=(position[1]+absMin)/maxValue*100;value=100-(position[0]+absMin)/maxValue*100;return[saturation,value];};Slider.prototype._setHueBarPosMax=function(){var huebarRects=this.huebarSvgElement.getClientRects()[0];if(huebarRects){this.huebarPosLimitRange[1]=huebarRects.height-7;}};Slider.prototype._moveHueHandle=function(newTop,silent){var hueHandleElement=this.huebarHandleElement;var baseColorElement=this.baseColorElement;var newGradientColor,hexStr;newTop=Math.max(this.huebarPosLimitRange[0],newTop);newTop=Math.min(this.huebarPosLimitRange[1],newTop);svgvml.setTranslateY(hueHandleElement,newTop);newGradientColor=colorUtil.hsvToRGB(this.getHue(),100,100);hexStr=colorUtil.rgbToHEX.apply(null,newGradientColor);svgvml.setGradientColorStop(baseColorElement,hexStr);if(!silent){this.fire('_selectColor',{color:colorUtil.rgbToHEX.apply(null,this.getRGB())});}};Slider.prototype.moveHue=function(degree,silent){var newTop=0;var absMin,maxValue;absMin=Math.abs(this.huebarPosLimitRange[0]);maxValue=absMin+this.huebarPosLimitRange[1];degree=degree||0;newTop=maxValue*degree/HUE_WHEEL_MAX-absMin;this._moveHueHandle(newTop,silent);};Slider.prototype._moveHueByPosition=function(y){var offset=this.huebarPosLimitRange[0];this._moveHueHandle(y+offset);};Slider.prototype.getHue=function(){var handle=this.huebarHandleElement;var position=svgvml.getTranslateXY(handle);var absMin,maxValue;absMin=Math.abs(this.huebarPosLimitRange[0]);maxValue=absMin+this.huebarPosLimitRange[1];return(position[0]+absMin)*HUE_WHEEL_MAX/maxValue;};Slider.prototype.getHSV=function(){var sv=this.getSaturationAndValue();var h=this.getHue();return[h].concat(sv);};Slider.prototype.getRGB=function(){return colorUtil.hsvToRGB.apply(null,this.getHSV());};Slider.prototype._prepareColorSliderForMouseEvent=function(event){var options=this.options;var sliderPart=closest(event.target,'.'+options.cssPrefix+'slider-part');var cache;cache=this._dragDataCache={isColorSlider:hasClass(sliderPart,options.cssPrefix+'slider-left'),parentElement:sliderPart};return cache;};Slider.prototype._onClick=function(clickEvent){var cache=this._prepareColorSliderForMouseEvent(clickEvent);var mousePos=getMousePosition(clickEvent.originEvent,cache.parentElement);if(cache.isColorSlider){this._moveColorSliderByPosition(mousePos[0],mousePos[1]);}else{this._moveHueByPosition(mousePos[1]);}
this._dragDataCache=null;};Slider.prototype._onDragStart=function(dragStartEvent){this._setColorSliderPosMax();this._setHueBarPosMax();this._prepareColorSliderForMouseEvent(dragStartEvent);};Slider.prototype._onDrag=function(dragEvent){var cache=this._dragDataCache;var mousePos=getMousePosition(dragEvent.originEvent,cache.parentElement);if(cache.isColorSlider){this._moveColorSliderByPosition(mousePos[0],mousePos[1]);}else{this._moveHueByPosition(mousePos[1]);}};Slider.prototype._onDragEnd=function(){this._dragDataCache=null;};CustomEvents.mixin(Slider);module.exports=Slider;}),(function(module,exports,__webpack_require__){"use strict";var isOldBrowser=__webpack_require__(4).isOldBrowser;var PARSE_TRANSLATE_NUM_REGEX=/[\.\-0-9]+/g;var SVG_HUE_HANDLE_RIGHT_POS=-6;var svgvml={getTranslateXY:function(obj){var temp;if(isOldBrowser){temp=obj.style;return[parseFloat(temp.top),parseFloat(temp.left)];}
temp=obj.getAttribute('transform');if(!temp){return[0,0];}
temp=temp.match(PARSE_TRANSLATE_NUM_REGEX);return[parseFloat(temp[1]),parseFloat(temp[0])];},setTranslateXY:function(obj,x,y){if(isOldBrowser){obj.style.left=x+'px';obj.style.top=y+'px';}else{obj.setAttribute('transform','translate('+x+','+y+')');}},setTranslateY:function(obj,y){if(isOldBrowser){obj.style.top=y+'px';}else{obj.setAttribute('transform','translate('+SVG_HUE_HANDLE_RIGHT_POS+','+y+')');}},setStrokeColor:function(obj,colorStr){if(isOldBrowser){obj.strokecolor=colorStr;}else{obj.setAttribute('stroke',colorStr);}},setGradientColorStop:function(obj,colorStr){if(isOldBrowser){obj.color=colorStr;}else{obj.setAttribute('stop-color',colorStr);}}};module.exports=svgvml;}),(function(module,exports,__webpack_require__){__webpack_require__(34);module.exports=__webpack_require__(35);}),(function(module,exports,__webpack_require__){}),(function(module,exports,__webpack_require__){"use strict";var Collection=__webpack_require__(19);var View=__webpack_require__(8);var Drag=__webpack_require__(24);var create=__webpack_require__(48);var Palette=__webpack_require__(29);var Slider=__webpack_require__(31);var colorUtil=__webpack_require__(12);var svgvml=__webpack_require__(32);var colorPicker={Collection:Collection,View:View,Drag:Drag,create:create,Palette:Palette,Slider:Slider,colorutil:colorUtil,svgvml:svgvml};module.exports=colorPicker;}),(function(module,exports,__webpack_require__){"use strict";function isNull(obj){return obj===null;}
module.exports=isNull;}),(function(module,exports,__webpack_require__){"use strict";var isUndefined=__webpack_require__(3);var imagePing=__webpack_require__(38);var ms7days=7*24*60*60*1000;function isExpired(date){var now=new Date().getTime();return now-date>ms7days;}
function sendHostname(appName,trackingId){var url='https://www.google-analytics.com/collect';var hostname=location.hostname;var hitType='event';var eventCategory='use';var applicationKeyForStorage='TOAST UI '+appName+' for '+hostname+': Statistics';var date=window.localStorage.getItem(applicationKeyForStorage);if(!isUndefined(window.tui)&&window.tui.usageStatistics===false){return;}
if(date&&!isExpired(date)){return;}
window.localStorage.setItem(applicationKeyForStorage,new Date().getTime());setTimeout(function(){if(document.readyState==='interactive'||document.readyState==='complete'){imagePing(url,{v:1,t:hitType,tid:trackingId,cid:hostname,dp:hostname,dh:appName,el:appName,ec:eventCategory});}},1000);}
module.exports=sendHostname;}),(function(module,exports,__webpack_require__){"use strict";var forEachOwnProperties=__webpack_require__(7);function imagePing(url,trackingInfo){var trackingElement=document.createElement('img');var queryString='';forEachOwnProperties(trackingInfo,function(value,key){queryString+='&'+key+'='+value;});queryString=queryString.substring(1);trackingElement.src=url+'?'+queryString;trackingElement.style.display='none';document.body.appendChild(trackingElement);document.body.removeChild(trackingElement);return trackingElement;}
module.exports=imagePing;}),(function(module,exports,__webpack_require__){"use strict";var forEach=__webpack_require__(2);var inArray=__webpack_require__(5);var getClass=__webpack_require__(23);var setClassName=__webpack_require__(40);function addClass(element){var cssClass=Array.prototype.slice.call(arguments,1);var classList=element.classList;var newClass=[];var origin;if(classList){forEach(cssClass,function(name){element.classList.add(name);});return;}
origin=getClass(element);if(origin){cssClass=[].concat(origin.split(/\s+/),cssClass);}
forEach(cssClass,function(cls){if(inArray(cls,newClass)<0){newClass.push(cls);}});setClassName(element,newClass);}
module.exports=addClass;}),(function(module,exports,__webpack_require__){"use strict";var isArray=__webpack_require__(1);var isUndefined=__webpack_require__(3);function setClassName(element,cssClass){cssClass=isArray(cssClass)?cssClass.join(' '):cssClass;cssClass=cssClass.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'');if(isUndefined(element.className.baseVal)){element.className=cssClass;return;}
element.className.baseVal=cssClass;}
module.exports=setClassName;}),(function(module,exports,__webpack_require__){"use strict";function isNumber(obj){return typeof obj==='number'||obj instanceof Number;}
module.exports=isNumber;}),(function(module,exports,__webpack_require__){"use strict";var on=__webpack_require__(14);var preventDefault=__webpack_require__(15);var setData=__webpack_require__(43);var testCSSProp=__webpack_require__(27);var SUPPORT_SELECTSTART='onselectstart'in document;var KEY_PREVIOUS_USER_SELECT='prevUserSelect';var userSelectProperty=testCSSProp(['userSelect','WebkitUserSelect','OUserSelect','MozUserSelect','msUserSelect']);function disableTextSelection(el){if(!el){el=document;}
if(SUPPORT_SELECTSTART){on(el,'selectstart',preventDefault);}else{el=(el===document)?document.documentElement:el;setData(el,KEY_PREVIOUS_USER_SELECT,el.style[userSelectProperty]);el.style[userSelectProperty]='none';}}
module.exports=disableTextSelection;}),(function(module,exports,__webpack_require__){"use strict";var convertToKebabCase=__webpack_require__(16);function setData(element,key,value){if(element.dataset){element.dataset[key]=value;return;}
element.setAttribute('data-'+convertToKebabCase(key),value);}
module.exports=setData;}),(function(module,exports,__webpack_require__){"use strict";var off=__webpack_require__(17);var preventDefault=__webpack_require__(15);var getData=__webpack_require__(45);var removeData=__webpack_require__(46);var testCSSProp=__webpack_require__(27);var SUPPORT_SELECTSTART='onselectstart'in document;var KEY_PREVIOUS_USER_SELECT='prevUserSelect';var userSelectProperty=testCSSProp(['userSelect','WebkitUserSelect','OUserSelect','MozUserSelect','msUserSelect']);function enableTextSelection(el){if(!el){el=document;}
if(SUPPORT_SELECTSTART){off(el,'selectstart',preventDefault);}else{el=(el===document)?document.documentElement:el;el.style[userSelectProperty]=getData(el,KEY_PREVIOUS_USER_SELECT)||'auto';removeData(el,KEY_PREVIOUS_USER_SELECT);}}
module.exports=enableTextSelection;}),(function(module,exports,__webpack_require__){"use strict";var convertToKebabCase=__webpack_require__(16);function getData(element,key){if(element.dataset){return element.dataset[key];}
return element.getAttribute('data-'+convertToKebabCase(key));}
module.exports=getData;}),(function(module,exports,__webpack_require__){"use strict";var convertToKebabCase=__webpack_require__(16);function removeData(element,key){if(element.dataset){delete element.dataset[key];return;}
element.removeAttribute('data-'+convertToKebabCase(key));}
module.exports=removeData;}),(function(module,exports,__webpack_require__){"use strict";var browser=__webpack_require__(22);var inArray=__webpack_require__(5);var primaryButton=['0','1','3','5','7'];var secondaryButton=['2','6'];var wheelButton=['4'];function getMouseButton(mouseEvent){if(browser.msie&&browser.version<=8){return getMouseButtonIE8AndEarlier(mouseEvent);}
return mouseEvent.button;}
function getMouseButtonIE8AndEarlier(mouseEvent){var button=String(mouseEvent.button);if(inArray(button,primaryButton)>-1){return 0;}
if(inArray(button,secondaryButton)>-1){return 2;}
if(inArray(button,wheelButton)>-1){return 1;}
return null;}
module.exports=getMouseButton;}),(function(module,exports,__webpack_require__){"use strict";var CustomEvents=__webpack_require__(10);var extend=__webpack_require__(0);var util=__webpack_require__(4);var colorUtil=__webpack_require__(12);var Layout=__webpack_require__(49);var Palette=__webpack_require__(29);var Slider=__webpack_require__(31);var currentId=0;function generateId(){currentId+=1;return currentId;}
function ColorPicker(options){var layout;if(!(this instanceof ColorPicker)){return new ColorPicker(options);}
options=this.options=extend({container:null,color:'#f8f8f8',preset:['#181818','#282828','#383838','#585858','#b8b8b8','#d8d8d8','#e8e8e8','#f8f8f8','#ab4642','#dc9656','#f7ca88','#a1b56c','#86c1b9','#7cafc2','#ba8baf','#a16946'],cssPrefix:'tui-colorpicker-',detailTxt:'Detail',id:generateId(),usageStatistics:true},options);if(!options.container){throw new Error('ColorPicker(): need container option.');}
layout=this.layout=new Layout(options,options.container);this.palette=new Palette(options,layout.container);this.palette.on({_selectColor:this._onSelectColorInPalette,_toggleSlider:this._onToggleSlider},this);this.slider=new Slider(options,layout.container);this.slider.on('_selectColor',this._onSelectColorInSlider,this);layout.addChild(this.palette);layout.addChild(this.slider);this.render(options.color);if(options.usageStatistics){util.sendHostName();}}
ColorPicker.prototype._onSelectColorInPalette=function(selectColorEventData){var color=selectColorEventData.color;var opt=this.options;if(!colorUtil.isValidRGB(color)&&color!==''){this.render();return;}
this.fire('selectColor',{color:color,origin:'palette'});if(opt.color===color){return;}
opt.color=color;this.render(color);};ColorPicker.prototype._onToggleSlider=function(){this.slider.toggle(!this.slider.isVisible());};ColorPicker.prototype._onSelectColorInSlider=function(selectColorEventData){var color=selectColorEventData.color;var opt=this.options;this.fire('selectColor',{color:color,origin:'slider'});if(opt.color===color){return;}
opt.color=color;this.palette.render(color);};ColorPicker.prototype.setColor=function(hexStr){if(!colorUtil.isValidRGB(hexStr)){throw new Error('ColorPicker#setColor(): need valid hex string color value');}
this.options.color=hexStr;this.render(hexStr);};ColorPicker.prototype.getColor=function(){return this.options.color;};ColorPicker.prototype.toggle=function(isShow){this.layout.container.style.display=!!isShow?'block':'none';};ColorPicker.prototype.render=function(color){this.layout.render(color||this.options.color);};ColorPicker.prototype.destroy=function(){this.layout.destroy();this.options.container.innerHTML='';this.layout=this.slider=this.palette=this.options=null;};CustomEvents.mixin(ColorPicker);module.exports=ColorPicker;}),(function(module,exports,__webpack_require__){"use strict";var extend=__webpack_require__(0);var inherit=__webpack_require__(18);var domUtil=__webpack_require__(9);var View=__webpack_require__(8);function Layout(options,container){this.options=extend({cssPrefix:'tui-colorpicker-'},options);container=domUtil.appendHTMLElement('div',container,this.options.cssPrefix+'container');View.call(this,options,container);this.render();}
inherit(Layout,View);Layout.prototype.render=function(color){this.recursive(function(view){view.render(color);},true);};module.exports=Layout;}),(function(module,exports,__webpack_require__){"use strict";function createObject(obj){function F(){}
F.prototype=obj;return new F();}
module.exports=createObject;}),(function(module,exports,__webpack_require__){"use strict";var template=__webpack_require__(52);module.exports=function(context){var item=['<li><input class="{{cssPrefix}}palette-button{{isSelected @this}}{{getItemClass @this}}" type="button"','{{if isValidRGB @this}}',' style="background-color:{{@this}};color:{{@this}}"','{{/if}}',' title="{{@this}}" value="{{@this}}" /></li>'].join('');var layout=['<ul class="{{cssPrefix}}clearfix">','{{each preset}}',item,'{{/each}}','</ul>','<div class="{{cssPrefix}}clearfix" style="overflow:hidden">','<input type="button" class="{{cssPrefix}}palette-toggle-slider" value="{{detailTxt}}" />','<input type="text" class="{{cssPrefix}}palette-hex" value="{{color}}" maxlength="7" />','<span class="{{cssPrefix}}palette-preview" style="background-color:{{color}};color:{{color}}">{{color}}</span>','</div>'].join('\n');return template(layout,context);};}),(function(module,exports,__webpack_require__){"use strict";var inArray=__webpack_require__(5);var forEach=__webpack_require__(2);var isArray=__webpack_require__(1);var isString=__webpack_require__(11);var extend=__webpack_require__(0);var EXPRESSION_REGEXP=/{{\s?|\s?}}/g;var BRACKET_NOTATION_REGEXP=/^[a-zA-Z0-9_@]+\[[a-zA-Z0-9_@"']+\]$/;var BRACKET_REGEXP=/\[\s?|\s?\]/;var DOT_NOTATION_REGEXP=/^[a-zA-Z_]+\.[a-zA-Z_]+$/;var DOT_REGEXP=/\./;var STRING_NOTATION_REGEXP=/^["']\w+["']$/;var STRING_REGEXP=/"|'/g;var NUMBER_REGEXP=/^-?\d+\.?\d*$/;var EXPRESSION_INTERVAL=2;var BLOCK_HELPERS={'if':handleIf,'each':handleEach,'with':handleWith};var isValidSplit='a'.split(/a/).length===3;var splitByRegExp=(function(){if(isValidSplit){return function(text,regexp){return text.split(regexp);};}
return function(text,regexp){var result=[];var prevIndex=0;var match,index;if(!regexp.global){regexp=new RegExp(regexp,'g');}
match=regexp.exec(text);while(match!==null){index=match.index;result.push(text.slice(prevIndex,index));prevIndex=index+match[0].length;match=regexp.exec(text);}
result.push(text.slice(prevIndex));return result;};})();function getValueFromContext(exp,context){var splitedExps;var value=context[exp];if(exp==='true'){value=true;}else if(exp==='false'){value=false;}else if(STRING_NOTATION_REGEXP.test(exp)){value=exp.replace(STRING_REGEXP,'');}else if(BRACKET_NOTATION_REGEXP.test(exp)){splitedExps=exp.split(BRACKET_REGEXP);value=getValueFromContext(splitedExps[0],context)[getValueFromContext(splitedExps[1],context)];}else if(DOT_NOTATION_REGEXP.test(exp)){splitedExps=exp.split(DOT_REGEXP);value=getValueFromContext(splitedExps[0],context)[splitedExps[1]];}else if(NUMBER_REGEXP.test(exp)){value=parseFloat(exp);}
return value;}
function extractElseif(ifExps,sourcesInsideBlock){var exps=[ifExps];var sourcesInsideIf=[];var otherIfCount=0;var start=0;forEach(sourcesInsideBlock,function(source,index){if(source.indexOf('if')===0){otherIfCount+=1;}else if(source==='/if'){otherIfCount-=1;}else if(!otherIfCount&&(source.indexOf('elseif')===0||source==='else')){exps.push(source==='else'?['true']:source.split(' ').slice(1));sourcesInsideIf.push(sourcesInsideBlock.slice(start,index));start=index+1;}});sourcesInsideIf.push(sourcesInsideBlock.slice(start));return{exps:exps,sourcesInsideIf:sourcesInsideIf};}
function handleIf(exps,sourcesInsideBlock,context){var analyzed=extractElseif(exps,sourcesInsideBlock);var result=false;var compiledSource='';forEach(analyzed.exps,function(exp,index){result=handleExpression(exp,context);if(result){compiledSource=compile(analyzed.sourcesInsideIf[index],context);}
return!result;});return compiledSource;}
function handleEach(exps,sourcesInsideBlock,context){var collection=handleExpression(exps,context);var additionalKey=isArray(collection)?'@index':'@key';var additionalContext={};var result='';forEach(collection,function(item,key){additionalContext[additionalKey]=key;additionalContext['@this']=item;extend(context,additionalContext);result+=compile(sourcesInsideBlock.slice(),context);});return result;}
function handleWith(exps,sourcesInsideBlock,context){var asIndex=inArray('as',exps);var alias=exps[asIndex+1];var result=handleExpression(exps.slice(0,asIndex),context);var additionalContext={};additionalContext[alias]=result;return compile(sourcesInsideBlock,extend(context,additionalContext))||'';}
function extractSourcesInsideBlock(sources,start,end){var sourcesInsideBlock=sources.splice(start+1,end-start);sourcesInsideBlock.pop();return sourcesInsideBlock;}
function handleBlockHelper(helperKeyword,sourcesToEnd,context){var executeBlockHelper=BLOCK_HELPERS[helperKeyword];var helperCount=1;var startBlockIndex=0;var endBlockIndex;var index=startBlockIndex+EXPRESSION_INTERVAL;var expression=sourcesToEnd[index];while(helperCount&&isString(expression)){if(expression.indexOf(helperKeyword)===0){helperCount+=1;}else if(expression.indexOf('/'+helperKeyword)===0){helperCount-=1;endBlockIndex=index;}
index+=EXPRESSION_INTERVAL;expression=sourcesToEnd[index];}
if(helperCount){throw Error(helperKeyword+' needs {{/'+helperKeyword+'}} expression.');}
sourcesToEnd[startBlockIndex]=executeBlockHelper(sourcesToEnd[startBlockIndex].split(' ').slice(1),extractSourcesInsideBlock(sourcesToEnd,startBlockIndex,endBlockIndex),context);return sourcesToEnd;}
function handleExpression(exps,context){var result=getValueFromContext(exps[0],context);if(result instanceof Function){return executeFunction(result,exps.slice(1),context);}
return result;}
function executeFunction(helper,argExps,context){var args=[];forEach(argExps,function(exp){args.push(getValueFromContext(exp,context));});return helper.apply(null,args);}
function compile(sources,context){var index=1;var expression=sources[index];var exps,firstExp,result;while(isString(expression)){exps=expression.split(' ');firstExp=exps[0];if(BLOCK_HELPERS[firstExp]){result=handleBlockHelper(firstExp,sources.splice(index,sources.length-index),context);sources=sources.concat(result);}else{sources[index]=handleExpression(exps,context);}
index+=EXPRESSION_INTERVAL;expression=sources[index];}
return sources.join('');}
function template(text,context){return compile(splitByRegExp(text,EXPRESSION_REGEXP),context);}
module.exports=template;}),(function(module,exports,__webpack_require__){"use strict";var isArray=__webpack_require__(1);function getMousePosition(position,relativeElement){var positionArray=isArray(position);var clientX=positionArray?position[0]:position.clientX;var clientY=positionArray?position[1]:position.clientY;var rect;if(!relativeElement){return[clientX,clientY];}
rect=relativeElement.getBoundingClientRect();return[clientX-rect.left-relativeElement.clientLeft,clientY-rect.top-relativeElement.clientTop];}
module.exports=getMousePosition;}),(function(module,exports,__webpack_require__){"use strict";var matches=__webpack_require__(55);function closest(element,selector){var parent=element.parentNode;if(matches(element,selector)){return element;}
while(parent&&parent!==document){if(matches(parent,selector)){return parent;}
parent=parent.parentNode;}
return null;}
module.exports=closest;}),(function(module,exports,__webpack_require__){"use strict";var inArray=__webpack_require__(5);var toArray=__webpack_require__(56);var elProto=Element.prototype;var matchSelector=elProto.matches||elProto.webkitMatchesSelector||elProto.mozMatchesSelector||elProto.msMatchesSelector||function(selector){var doc=this.document||this.ownerDocument;return inArray(this,toArray(doc.querySelectorAll(selector)))>-1;};function matches(element,selector){return matchSelector.call(element,selector);}
module.exports=matches;}),(function(module,exports,__webpack_require__){"use strict";var forEachArray=__webpack_require__(6);function toArray(arrayLike){var arr;try{arr=Array.prototype.slice.call(arrayLike);}catch(e){arr=[];forEachArray(arrayLike,function(value){arr.push(value);});}
return arr;}
module.exports=toArray;}),(function(module,exports,__webpack_require__){"use strict";(function(global){var isOldBrowser=__webpack_require__(4).isOldBrowser;var layout=['<div class="{{cssPrefix}}slider-left {{cssPrefix}}slider-part">{{slider}}</div>','<div class="{{cssPrefix}}slider-right {{cssPrefix}}slider-part">{{huebar}}</div>'].join('\n');var SVGSlider=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-slider">','<defs>','<linearGradient id="{{cssPrefix}}svg-fill-color-{{id}}" x1="0%" y1="0%" x2="100%" y2="0%">','<stop offset="0%" stop-color="rgb(255,255,255)" />','<stop class="{{cssPrefix}}slider-basecolor" offset="100%" stop-color="rgb(255,0,0)" />','</linearGradient>','<linearGradient id="{{cssPrefix}}svn-fill-black-{{id}}" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:0" />','<stop offset="100%" style="stop-color:rgb(0,0,0);stop-opacity:1" />','</linearGradient>','</defs>','<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svg-fill-color-{{id}})"></rect>','<rect width="100%" height="100%" fill="url(#{{cssPrefix}}svn-fill-black-{{id}})"></rect>','<path transform="translate(0,0)" class="{{cssPrefix}}slider-handle" d="M0 7.5 L15 7.5 M7.5 15 L7.5 0 M2 7 a5.5 5.5 0 1 1 0 1 Z" stroke="black" stroke-width="0.75" fill="none" />','</svg>'].join('\n');var VMLSlider=['<div class="{{cssPrefix}}vml-slider">','<v:rect strokecolor="none" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill class="{{cssPrefix}}vml {{cssPrefix}}slider-basecolor" type="gradient" method="none" color="#ff0000" color2="#fff" angle="90" />','</v:rect>','<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-slider-bg">','<v:fill type="gradient" method="none" color="black" color2="white" o:opacity2="0%" class="{{cssPrefix}}vml" />','</v:rect>','<v:shape class="{{cssPrefix}}vml {{cssPrefix}}slider-handle" coordsize="1 1" style="width:1px;height:1px;"'+'path="m 0,7 l 14,7 m 7,14 l 7,0 ar 12,12 2,2 z" filled="false" stroked="true" />','</div>'].join('\n');var SVGHuebar=['<svg class="{{cssPrefix}}svg {{cssPrefix}}svg-huebar">','<defs>','<linearGradient id="g-{{id}}" x1="0%" y1="0%" x2="0%" y2="100%">','<stop offset="0%" stop-color="rgb(255,0,0)" />','<stop offset="16.666%" stop-color="rgb(255,255,0)" />','<stop offset="33.333%" stop-color="rgb(0,255,0)" />','<stop offset="50%" stop-color="rgb(0,255,255)" />','<stop offset="66.666%" stop-color="rgb(0,0,255)" />','<stop offset="83.333%" stop-color="rgb(255,0,255)" />','<stop offset="100%" stop-color="rgb(255,0,0)" />','</linearGradient>','</defs>','<rect width="18px" height="100%" fill="url(#g-{{id}})"></rect>','<path transform="translate(-6,-3)" class="{{cssPrefix}}huebar-handle" d="M0 0 L4 4 L0 8 L0 0 Z" fill="black" stroke="none" />','</svg>'].join('\n');var VMLHuebar=['<div class="{{cssPrefix}}vml-huebar">','<v:rect strokecolor="#ccc" class="{{cssPrefix}}vml {{cssPrefix}}vml-huebar-bg">','<v:fill type="gradient" method="none" colors="'+'0% rgb(255,0,0), 16.666% rgb(255,255,0), 33.333% rgb(0,255,0), 50% rgb(0,255,255), 66.666% rgb(0,0,255), 83.333% rgb(255,0,255), 100% rgb(255,0,0)'+'" angle="180" class="{{cssPrefix}}vml" />','</v:rect>','<v:shape class="{{cssPrefix}}vml {{cssPrefix}}huebar-handle" coordsize="1 1" style="width:1px;height:1px;position:absolute;z-index:1;right:22px;top:-3px;"'+'path="m 0,0 l 4,4 l 0,8 l 0,0 z" filled="true" fillcolor="black" stroked="false" />','</div>'].join('\n');if(isOldBrowser){global.document.namespaces.add('v','urn:schemas-microsoft-com:vml');}
module.exports={layout:layout,slider:isOldBrowser?VMLSlider:SVGSlider,huebar:isOldBrowser?VMLHuebar:SVGHuebar};}.call(this,__webpack_require__(25)))})]);});!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.util=e():(t.tui=t.tui||{},t.tui.util=e())}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="dist",e(0)}([function(t,e,n){"use strict";var r={},o=n(1),i=o.extend;i(r,o),i(r,n(3)),i(r,n(2)),i(r,n(4)),i(r,n(5)),i(r,n(6)),i(r,n(7)),i(r,n(8)),i(r,n(9)),r.browser=n(10),r.popup=n(11),r.formatDate=n(12),r.defineClass=n(13),r.defineModule=n(14),r.defineNamespace=n(15),r.CustomEvents=n(16),r.Enum=n(17),r.ExMap=n(18),r.HashMap=n(20),r.Map=n(19),t.exports=r},function(t,e,n){"use strict";function r(t,e){var n,r,o,i,u=Object.prototype.hasOwnProperty;for(o=1,i=arguments.length;o<i;o+=1){n=arguments[o];for(r in n)u.call(n,r)&&(t[r]=n[r])}return t}function o(t){return t.__fe_id||(l+=1,t.__fe_id=l),t.__fe_id}function i(t){return f.isExisty(p(t,"__fe_id"))}function u(){l=0}function s(t){var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e);return n}function a(t){var e=arguments.length,n=1;if(e<1)return!0;for(;n<e;n+=1)if(!c(t,arguments[n]))return!1;return!0}function c(t,e){var n,r=[],o=[];if(isNaN(t)&&isNaN(e)&&f.isNumber(t)&&f.isNumber(e))return!0;if(t===e)return!0;if(f.isFunction(t)&&f.isFunction(e)||t instanceof Date&&e instanceof Date||t instanceof RegExp&&e instanceof RegExp||t instanceof String&&e instanceof String||t instanceof Number&&e instanceof Number)return t.toString()===e.toString();if(!(t instanceof Object&&e instanceof Object))return!1;if(t.isPrototypeOf(e)||e.isPrototypeOf(t)||t.constructor!==e.constructor||t.prototype!==e.prototype)return!1;if(h.inArray(t,r)>-1||h.inArray(e,o)>-1)return!1;for(n in e){if(e.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(typeof e[n]!=typeof t[n])return!1}for(n in t){if(e.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;if(typeof e[n]!=typeof t[n])return!1;if("object"==typeof t[n]||"function"==typeof t[n]){if(r.push(t),o.push(e),!c(t[n],e[n]))return!1;r.pop(),o.pop()}else if(t[n]!==e[n])return!1}return!0}function p(t,e){for(var n=arguments,r=n[0],o=1,i=n.length;o<i;o+=1){if(f.isUndefined(r)||f.isNull(r))return;r=r[n[o]]}return r}var f=n(2),h=n(3),l=0;t.exports={extend:r,stamp:o,hasStamp:i,resetLastId:u,keys:Object.prototype.keys||s,compareJSON:a,pick:p}},function(t,e){"use strict";function n(t){return!r(t)&&!o(t)}function r(t){return void 0===t}function o(t){return null===t}function i(t){return n(t)&&t!==!1}function u(t){return!i(t)}function s(t){var e=n(t)&&("[object Arguments]"===S.call(t)||!!t.callee);return e}function a(t){return t instanceof Array}function c(t){return t===Object(t)}function p(t){return t instanceof Function}function f(t){return"number"==typeof t||t instanceof Number}function h(t){return"string"==typeof t||t instanceof String}function l(t){return"boolean"==typeof t||t instanceof Boolean}function y(t){return"[object Array]"===S.call(t)}function d(t){return"[object Function]"===S.call(t)}function m(t){return"[object Number]"===S.call(t)}function v(t){return"[object String]"===S.call(t)}function g(t){return"[object Boolean]"===S.call(t)}function _(t){return"object"==typeof HTMLElement?t&&(t instanceof HTMLElement||!!t.nodeType):!(!t||!t.nodeType)}function x(t){return"object"==typeof HTMLElement?t&&t instanceof HTMLElement:!(!t||!t.nodeType||1!==t.nodeType)}function b(t){return!(n(t)&&!w(t))||(a(t)||s(t)?0===t.length:!(c(t)&&!p(t))||!E(t))}function w(t){return h(t)&&""===t}function E(t){var e;for(e in t)if(t.hasOwnProperty(e))return!0;return!1}function O(t){return!b(t)}function N(t){return t instanceof Date}function A(t){return"[object Date]"===S.call(t)}var S=Object.prototype.toString;t.exports={isExisty:n,isUndefined:r,isNull:o,isTruthy:i,isFalsy:u,isArguments:s,isArray:a,isArraySafe:y,isObject:c,isFunction:p,isFunctionSafe:d,isNumber:f,isNumberSafe:m,isDate:N,isDateSafe:A,isString:h,isStringSafe:v,isBoolean:l,isBooleanSafe:g,isHTMLNode:_,isHTMLTag:x,isEmpty:b,isNotEmpty:O}},function(t,e,n){"use strict";var r,o=n(4),i=n(2),u=Array.prototype.slice,s=function(t,e,n){var r,o=[];for(i.isUndefined(e)&&(e=t||0,t=0),n=n||1,r=n<0?-1:1,e*=r;t*r<e;t+=n)o.push(t);return o},a=function(){var t=u.call(arguments),e=[];return o.forEach(t,function(t){o.forEach(t,function(t,n){e[n]||(e[n]=[]),e[n].push(t)})}),e},c=function(t,e,n){var r,o;if(n=n||0,!i.isArray(e))return-1;if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t,n);for(o=e.length,r=n;n>=0&&r<o;r+=1)if(e[r]===t)return r;return-1};r={inArray:c,range:s,zip:a},t.exports=r},function(t,e,n){"use strict";function r(t,e,n){var r=0,o=t.length;for(n=n||null;r<o&&e.call(n,t[r],r,t)!==!1;r+=1);}function o(t,e,n){var r;n=n||null;for(r in t)if(t.hasOwnProperty(r)&&e.call(n,t[r],r,t)===!1)break}function i(t,e,n){f.isArray(t)?r(t,e,n):o(t,e,n)}function u(t,e,n){var r=[];return n=n||null,i(t,function(){r.push(e.apply(n,arguments))}),r}function s(t,e,n){var r,o,i,u=0;for(n=n||null,f.isArray(t)?(o=t.length,i=t[u]):(r=h.keys(t),o=r.length,i=t[r[u+=1]]),u+=1;u<o;u+=1)i=e.call(n,i,t[r?r[u]:u]);return i}function a(t){var e;try{e=Array.prototype.slice.call(t)}catch(n){e=[],r(t,function(t){e.push(t)})}return e}function c(t,e,n){var r,o;if(n=n||null,!f.isObject(t)||!f.isFunction(e))throw new Error("wrong parameter");return f.isArray(t)?(r=[],o=function(t,e){t.push(e[0])}):(r={},o=function(t,e){t[e[1]]=e[0]}),i(t,function(){e.apply(n,arguments)&&o(r,arguments)},n),r}function p(t,e){var n=u(t,function(t){return t[e]});return n}var f=n(2),h=n(1);t.exports={forEachOwnProperties:o,forEachArray:r,forEach:i,toArray:a,map:u,reduce:s,filter:c,pluck:p}},function(t,e){"use strict";function n(t,e){var n,r=Array.prototype.slice;return t.bind?t.bind.apply(t,r.call(arguments,1)):(n=r.call(arguments,2),function(){return t.apply(e,n.length?n.concat(r.call(arguments)):arguments)})}t.exports={bind:n}},function(t,e){"use strict";function n(t){function e(){}return e.prototype=t,new e}function r(t,e){var r=n(e.prototype);r.constructor=t,t.prototype=r}t.exports={createObject:n,inherit:r}},function(t,e,n){"use strict";function r(t){var e={"&quot;":'"',"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&nbsp;":" "};return t.replace(/&amp;|&lt;|&gt;|&quot;|&#39;|&nbsp;/g,function(t){return e[t]?e[t]:t})}function o(t){var e={'"':"quot","&":"amp","<":"lt",">":"gt","'":"#39"};return t.replace(/[<>&"']/g,function(t){return e[t]?"&"+e[t]+";":t})}function i(t){return/[<>&"']/.test(t)}function u(t,e){for(var n,r,o=0,i=t.length,u={};o<i;o+=1)r=t.charAt(o),u[r]=1;for(o=0,i=e.length;o<i;o+=1)r=e.charAt(o),u[r]&&(u[r]+=1);return u=s.filter(u,function(t){return t>1}),u=a.keys(u).sort(),n=u.join("")}var s=n(4),a=n(1);t.exports={decodeHTMLEntity:r,encodeHTMLEntity:o,hasEncodableString:i,getDuplicatedChar:u}},function(t,e){"use strict";function n(t,e){function n(){o=u.call(arguments),window.clearTimeout(r),r=window.setTimeout(function(){t.apply(null,o)},e)}var r,o;return e=e||0,n}function r(){return Number(new Date)}function o(t,e){function n(){return c=u.call(arguments),p?(f(c),void(p=!1)):(a=i.timestamp(),o=o||a,s(c),void(a-o>=e&&f(c)))}function r(){p=!0,o=null}var o,s,a,c,p=!0,f=function(e){t.apply(null,e),o=null};return e=e||0,s=i.debounce(f,e),n.reset=r,n}var i={},u=Array.prototype.slice;i.timestamp=r,i.debounce=n,i.throttle=o,t.exports=i},function(t,e,n){"use strict";function r(t){var e=(new Date).getTime();return e-t>c}function o(t,e){var n="https://www.google-analytics.com/collect",o=location.hostname,u="event",s="use",c="TOAST UI "+t+" for "+o+": Statistics",p=window.localStorage.getItem(c);(a.isUndefined(window.tui)||window.tui.usageStatistics!==!1)&&(p&&!r(p)||(window.localStorage.setItem(c,(new Date).getTime()),setTimeout(function(){"interactive"!==document.readyState&&"complete"!==document.readyState||i(n,{v:1,t:u,tid:e,cid:o,dp:o,dh:t,el:t,ec:s})},1e3)))}function i(t,e){var n=s.map(u.keys(e),function(t,n){var r=0===n?"":"&";return r+t+"="+e[t]}).join(""),r=document.createElement("img");return r.src=t+"?"+n,r.style.display="none",document.body.appendChild(r),document.body.removeChild(r),r}var u=n(1),s=n(4),a=n(2),c=6048e5;t.exports={imagePing:i,sendHostname:o}},function(t,e){"use strict";function n(){var t,e,n=window.navigator,o=n.appName.replace(/\s/g,"_"),i=n.userAgent,u=/MSIE\s([0-9]+[.0-9]*)/,s=/Trident.*rv:11\./,a=/Edge\/(\d+)\./,c={firefox:/Firefox\/(\d+)\./,chrome:/Chrome\/(\d+)\./,safari:/Version\/([\d.]+).*Safari\/(\d+)/},p={Microsoft_Internet_Explorer:function(){var t=i.match(u);t?(r.msie=!0,r.version=parseFloat(t[1])):r.others=!0},Netscape:function(){var n=!1;if(s.exec(i))r.msie=!0,r.version=11,n=!0;else if(a.exec(i))r.edge=!0,r.version=i.match(a)[1],n=!0;else for(t in c)if(c.hasOwnProperty(t)&&(e=i.match(c[t]),e&&e.length>1)){r[t]=n=!0,r.version=parseFloat(e[1]||0);break}n||(r.others=!0)}},f=p[o];f&&p[o]()}var r={chrome:!1,firefox:!1,safari:!1,msie:!1,edge:!1,others:!1,version:0};window&&window.navigator&&n(),t.exports=r},function(t,e,n){"use strict";function r(){this.openedPopup={},this.closeWithParentPopup={},this.postBridgeUrl=""}var o=n(4),i=n(2),u=n(5),s=n(10),a=n(1),c=0;r.prototype.getPopupList=function(t){var e;return e=i.isExisty(t)?this.openedPopup[t]:this.openedPopup},r.prototype.openPopup=function(t,e){var n,r,o;if(e=a.extend({popupName:"popup_"+c+"_"+Number(new Date),popupOptionStr:"",useReload:!0,closeWithParent:!0,method:"get",param:{}},e||{}),e.method=e.method.toUpperCase(),this.postBridgeUrl=e.postBridgeUrl||this.postBridgeUrl,o="POST"===e.method&&e.param&&s.msie&&11===s.version,!i.isExisty(t))throw new Error("Popup#open() need popup url.");c+=1,e.param&&("GET"===e.method?t=t+(/\?/.test(t)?"&":"?")+this._parameterize(e.param):"POST"===e.method&&(o||(r=this.createForm(t,e.param,e.method,e.popupName),t="about:blank"))),n=this.openedPopup[e.popupName],i.isExisty(n)?n.closed?this.openedPopup[e.popupName]=n=this._open(o,e.param,t,e.popupName,e.popupOptionStr):(e.useReload&&n.location.replace(t),n.focus()):this.openedPopup[e.popupName]=n=this._open(o,e.param,t,e.popupName,e.popupOptionStr),this.closeWithParentPopup[e.popupName]=e.closeWithParent,(!n||n.closed||i.isUndefined(n.closed))&&alert("please enable popup windows for this website"),e.param&&"POST"===e.method&&!o&&(n&&r.submit(),r.parentNode&&r.parentNode.removeChild(r)),window.onunload=u.bind(this.closeAllPopup,this)},r.prototype.close=function(t,e){var n=e||window;t=!!i.isExisty(t)&&t,t&&(window.onunload=null),n.closed||(n.opener=window.location.href,n.close())},r.prototype.closeAllPopup=function(t){var e=i.isExisty(t);o.forEachOwnProperties(this.openedPopup,function(t,n){(e&&this.closeWithParentPopup[n]||!e)&&this.close(!1,t)},this)},r.prototype.focus=function(t){this.getPopupList(t).focus()},r.prototype.parseQuery=function(){var t,e,n={};return t=window.location.search.substr(1),o.forEachArray(t.split("&"),function(t){e=t.split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),n},r.prototype.createForm=function(t,e,n,r,i){var u,s=document.createElement("form");return i=i||document.body,s.method=n||"POST",s.action=t||"",s.target=r||"",s.style.display="none",o.forEachOwnProperties(e,function(t,e){u=document.createElement("input"),u.name=e,u.type="hidden",u.value=t,s.appendChild(u)}),i.appendChild(s),s},r.prototype._parameterize=function(t){var e=[];return o.forEachOwnProperties(t,function(t,n){e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))}),e.join("&")},r.prototype._open=function(t,e,n,r,o){var i;return t?(i=window.open(this.postBridgeUrl,r,o),setTimeout(function(){i.redirect(n,e)},100)):i=window.open(n,r,o),i},t.exports=new r},function(t,e,n){"use strict";function r(t,e,n){var r,o,i,u;return t=Number(t),e=Number(e),n=Number(n),r=t>-1&&t<100||t>1969&&t<2070,o=e>0&&e<13,!(!r||!o)&&(u=c[e],2===e&&t%4===0&&(t%100===0&&t%400!==0||(u=29)),i=n>0&&n<=u)}function o(t,e,n){var o,a,c,f=u.pick(n,"meridiemSet","AM")||"AM",h=u.pick(n,"meridiemSet","PM")||"PM";return a=i.isDate(e)?{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),hour:e.getHours(),minute:e.getMinutes()}:{year:e.year,month:e.month,date:e.date,hour:e.hour,minute:e.minute},!!r(a.year,a.month,a.date)&&(a.meridiem="",/([^\\]|^)[aA]\b/.test(t)&&(o=a.hour>11?h:f,a.hour>12&&(a.hour%=12),0===a.hour&&(a.hour=12),a.meridiem=o),c=t.replace(s,function(t){return t.indexOf("\\")>-1?t.replace(/\\/,""):p[t](a)||""}))}var i=n(2),u=n(1),s=/[\\]*YYYY|[\\]*YY|[\\]*MMMM|[\\]*MMM|[\\]*MM|[\\]*M|[\\]*DD|[\\]*D|[\\]*HH|[\\]*H|[\\]*A/gi,a=["Invalid month","January","February","March","April","May","June","July","August","September","October","November","December"],c=[0,31,28,31,30,31,30,31,31,30,31,30,31],p={M:function(t){return Number(t.month)},MM:function(t){var e=t.month;return Number(e)<10?"0"+e:e},MMM:function(t){return a[Number(t.month)].substr(0,3)},MMMM:function(t){return a[Number(t.month)]},D:function(t){return Number(t.date)},d:function(t){return p.D(t)},DD:function(t){var e=t.date;return Number(e)<10?"0"+e:e},dd:function(t){return p.DD(t)},YY:function(t){return Number(t.year)%100},yy:function(t){return p.YY(t)},YYYY:function(t){var e="20",n=t.year;return n>69&&n<100&&(e="19"),Number(n)<100?e+String(n):n},yyyy:function(t){return p.YYYY(t)},A:function(t){return t.meridiem},a:function(t){return t.meridiem},hh:function(t){var e=t.hour;return Number(e)<10?"0"+e:e},HH:function(t){return p.hh(t)},h:function(t){return String(Number(t.hour))},H:function(t){return p.h(t)},m:function(t){return String(Number(t.minute))},mm:function(t){var e=t.minute;return Number(e)<10?"0"+e:e}};t.exports=o},function(t,e,n){"use strict";function r(t,e){var n;return e||(e=t,t=null),n=e.init||function(){},t&&o(n,t),e.hasOwnProperty("static")&&(i(n,e["static"]),delete e["static"]),i(n.prototype,e),n}var o=n(6).inherit,i=n(1).extend;t.exports=r},function(t,e,n){"use strict";function r(t,e){var n=e||{};return i.isFunction(n[u])&&n[u](),o(t,n)}var o=n(15),i=n(2),u="initialize";t.exports=r},function(t,e,n){"use strict";function r(t,e,n){var r,u,s,a;return r=t.split("."),r.unshift(window),u=o.reduce(r,function(t,e){return t[e]=t[e]||{},t[e]}),n?(a=r.pop(),s=i.pick.apply(null,r),u=s[a]=e):i.extend(u,e),u}var o=n(4),i=n(1);t.exports=r},function(t,e,n){"use strict";function r(){this.events=null,this.contexts=null}var o=n(4),i=n(2),u=n(1),s=/\s+/g;r.mixin=function(t){u.extend(t.prototype,r.prototype)},r.prototype._getHandlerItem=function(t,e){var n={handler:t};return e&&(n.context=e),n},r.prototype._safeEvent=function(t){var e,n=this.events;return n||(n=this.events={}),t&&(e=n[t],e||(e=[],n[t]=e),n=e),n},r.prototype._safeContext=function(){var t=this.contexts;return t||(t=this.contexts=[]),t},r.prototype._indexOfContext=function(t){for(var e=this._safeContext(),n=0;e[n];){if(t===e[n][0])return n;n+=1}return-1},r.prototype._memorizeContext=function(t){var e,n;i.isExisty(t)&&(e=this._safeContext(),n=this._indexOfContext(t),n>-1?e[n][1]+=1:e.push([t,1]))},r.prototype._forgetContext=function(t){var e,n;i.isExisty(t)&&(e=this._safeContext(),n=this._indexOfContext(t),n>-1&&(e[n][1]-=1,e[n][1]<=0&&e.splice(n,1)))},r.prototype._bindEvent=function(t,e,n){var r=this._safeEvent(t);this._memorizeContext(n),r.push(this._getHandlerItem(e,n))},r.prototype.on=function(t,e,n){var r=this;i.isString(t)?(t=t.split(s),o.forEach(t,function(t){r._bindEvent(t,e,n)})):i.isObject(t)&&(n=e,o.forEach(t,function(t,e){r.on(e,t,n)}))},r.prototype.once=function(t,e,n){function r(){e.apply(n,arguments),u.off(t,r,n)}var u=this;return i.isObject(t)?(n=e,void o.forEach(t,function(t,e){u.once(e,t,n)})):void this.on(t,r,n)},r.prototype._spliceMatches=function(t,e){var n,r=0;if(i.isArray(t))for(n=t.length;r<n;r+=1)e(t[r])===!0&&(t.splice(r,1),n-=1,r-=1)},r.prototype._matchHandler=function(t){var e=this;return function(n){var r=t===n.handler;return r&&e._forgetContext(n.context),r}},r.prototype._matchContext=function(t){var e=this;return function(n){var r=t===n.context;return r&&e._forgetContext(n.context),r}},r.prototype._matchHandlerAndContext=function(t,e){var n=this;return function(r){var o=t===r.handler,i=e===r.context,u=o&&i;return u&&n._forgetContext(r.context),u}},r.prototype._offByEventName=function(t,e){var n=this,r=o.forEachArray,u=i.isFunction(e),a=n._matchHandler(e);t=t.split(s),r(t,function(t){var e=n._safeEvent(t);u?n._spliceMatches(e,a):(r(e,function(t){n._forgetContext(t.context)}),n.events[t]=[])})},r.prototype._offByHandler=function(t){var e=this,n=this._matchHandler(t);o.forEach(this._safeEvent(),function(t){e._spliceMatches(t,n)})},r.prototype._offByObject=function(t,e){var n,r=this;this._indexOfContext(t)<0?o.forEach(t,function(t,e){r.off(e,t)}):i.isString(e)?(n=this._matchContext(t),r._spliceMatches(this._safeEvent(e),n)):i.isFunction(e)?(n=this._matchHandlerAndContext(e,t),o.forEach(this._safeEvent(),function(t){r._spliceMatches(t,n)})):(n=this._matchContext(t),o.forEach(this._safeEvent(),function(t){r._spliceMatches(t,n)}))},r.prototype.off=function(t,e){i.isString(t)?this._offByEventName(t,e):arguments.length?i.isFunction(t)?this._offByHandler(t):i.isObject(t)&&this._offByObject(t,e):(this.events={},this.contexts=[])},r.prototype.fire=function(t){this.invoke.apply(this,arguments)},r.prototype.invoke=function(t){var e,n,r,o;if(!this.hasListener(t))return!0;for(e=this._safeEvent(t),n=Array.prototype.slice.call(arguments,1),r=0;e[r];){if(o=e[r],o.handler.apply(o.context,n)===!1)return!1;r+=1}return!0},r.prototype.hasListener=function(t){return this.getListenerLength(t)>0},r.prototype.getListenerLength=function(t){var e=this._safeEvent(t);return e.length},t.exports=r},function(t,e,n){"use strict";function r(t){t&&this.set.apply(this,arguments)}var o=n(4),i=n(2),u=function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}(),s=0;r.prototype.set=function(t){var e=this;i.isArray(t)||(t=o.toArray(arguments)),o.forEach(t,function(t){e._addItem(t)})},r.prototype.getName=function(t){var e,n=this;return o.forEach(this,function(r,o){if(n._isEnumItem(o)&&t===r)return e=o,!1}),e},r.prototype._addItem=function(t){var e;this.hasOwnProperty(t)||(e=this._makeEnumValue(),u?Object.defineProperty(this,t,{enumerable:!0,configurable:!1,writable:!1,value:e}):this[t]=e)},r.prototype._makeEnumValue=function(){var t;return t=s,s+=1,t},r.prototype._isEnumItem=function(t){return i.isNumber(this[t])},t.exports=r},function(t,e,n){"use strict";function r(t){this._map=new i(t),this.size=this._map.size}var o=n(4),i=n(19),u=["get","has","forEach","keys","values","entries"],s=["delete","clear"];o.forEachArray(u,function(t){r.prototype[t]=function(){return this._map[t].apply(this._map,arguments)}}),o.forEachArray(s,function(t){r.prototype[t]=function(){var e=this._map[t].apply(this._map,arguments);return this.size=this._map.size,e}}),r.prototype.set=function(){return this._map.set.apply(this._map,arguments),this.size=this._map.size,this},r.prototype.setObject=function(t){o.forEachOwnProperties(t,function(t,e){this.set(e,t)},this)},r.prototype.deleteByKeys=function(t){o.forEachArray(t,function(t){this["delete"](t)},this)},r.prototype.merge=function(t){t.forEach(function(t,e){this.set(e,t)},this)},r.prototype.filter=function(t){var e=new r;return this.forEach(function(n,r){t(n,r)&&e.set(r,n)}),e},t.exports=r},function(t,e,n){"use strict";function r(t,e){this._keys=t,this._valueGetter=e,this._length=this._keys.length,this._index=-1,this._done=!1}function o(t){this._valuesForString={},this._valuesForIndex={},this._keys=[],t&&this._setInitData(t),this.size=0}var i=n(4),u=n(2),s=n(3),a=n(10),c=n(5),p={},f={};r.prototype.next=function(){var t={};do this._index+=1;while(u.isUndefined(this._keys[this._index])&&this._index<this._length);return this._index>=this._length?t.done=!0:(t.done=!1,t.value=this._valueGetter(this._keys[this._index],this._index)),t},o.prototype._setInitData=function(t){if(!u.isArray(t))throw new Error("Only Array is supported.");i.forEachArray(t,function(t){this.set(t[0],t[1])},this)},o.prototype._isNaN=function(t){return"number"==typeof t&&t!==t},o.prototype._getKeyIndex=function(t){var e,n=-1;return u.isString(t)?(e=this._valuesForString[t],e&&(n=e.keyIndex)):n=s.inArray(t,this._keys),n},o.prototype._getOriginKey=function(t){var e=t;return t===p?e=void 0:t===f&&(e=NaN),e},o.prototype._getUniqueKey=function(t){var e=t;return u.isUndefined(t)?e=p:this._isNaN(t)&&(e=f),e},o.prototype._getValueObject=function(t,e){return u.isString(t)?this._valuesForString[t]:(u.isUndefined(e)&&(e=this._getKeyIndex(t)),e>=0?this._valuesForIndex[e]:void 0)},o.prototype._getOriginValue=function(t,e){return this._getValueObject(t,e).origin},o.prototype._getKeyValuePair=function(t,e){return[this._getOriginKey(t),this._getOriginValue(t,e)]},o.prototype._createValueObject=function(t,e){return{keyIndex:e,origin:t}},o.prototype.set=function(t,e){var n,r=this._getUniqueKey(t),o=this._getKeyIndex(r);return o<0&&(o=this._keys.push(r)-1,this.size+=1),n=this._createValueObject(e,o),u.isString(t)?this._valuesForString[t]=n:this._valuesForIndex[o]=n,this},o.prototype.get=function(t){var e=this._getUniqueKey(t),n=this._getValueObject(e);return n&&n.origin},o.prototype.keys=function(){return new r(this._keys,c.bind(this._getOriginKey,this))},o.prototype.values=function(){return new r(this._keys,c.bind(this._getOriginValue,this))},o.prototype.entries=function(){return new r(this._keys,c.bind(this._getKeyValuePair,this))},o.prototype.has=function(t){return!!this._getValueObject(t)},o.prototype["delete"]=function(t){var e;u.isString(t)?this._valuesForString[t]&&(e=this._valuesForString[t].keyIndex,delete this._valuesForString[t]):(e=this._getKeyIndex(t),e>=0&&delete this._valuesForIndex[e]),e>=0&&(delete this._keys[e],this.size-=1)},o.prototype.forEach=function(t,e){e=e||this,i.forEachArray(this._keys,function(n){u.isUndefined(n)||t.call(e,this._getValueObject(n).origin,n,this)},this)},o.prototype.clear=function(){o.call(this)},function(){window.Map&&(a.firefox&&a.version>=37||a.chrome&&a.version>=42)&&(o=window.Map)}(),t.exports=o},function(t,e,n){"use strict";function r(t){this.length=0,t&&this.setObject(t)}var o=n(4),i=n(2),u="Ã¥";r.prototype.set=function(t,e){2===arguments.length?this.setKeyValue(t,e):this.setObject(t)},r.prototype.setKeyValue=function(t,e){this.has(t)||(this.length+=1),this[this.encodeKey(t)]=e},r.prototype.setObject=function(t){var e=this;o.forEachOwnProperties(t,function(t,n){e.setKeyValue(n,t)})},r.prototype.merge=function(t){var e=this;t.each(function(t,n){e.setKeyValue(n,t)})},r.prototype.encodeKey=function(t){return u+t},r.prototype.decodeKey=function(t){var e=t.split(u);return e[e.length-1]},r.prototype.get=function(t){return this[this.encodeKey(t)]},r.prototype.has=function(t){return this.hasOwnProperty(this.encodeKey(t))},r.prototype.remove=function(t){return arguments.length>1&&(t=o.toArray(arguments)),i.isArray(t)?this.removeByKeyArray(t):this.removeByKey(t)},r.prototype.removeByKey=function(t){var e=this.has(t)?this.get(t):null;return null!==e&&(delete this[this.encodeKey(t)],this.length-=1),e},r.prototype.removeByKeyArray=function(t){var e=[],n=this;return o.forEach(t,function(t){e.push(n.removeByKey(t))}),e},r.prototype.removeAll=function(){var t=this;this.each(function(e,n){t.remove(n)})},r.prototype.each=function(t){var e,n=this;o.forEachOwnProperties(this,function(r,o){if(o.charAt(0)===u&&(e=t(r,n.decodeKey(o))),e===!1)return e})},r.prototype.keys=function(){var t=[],e=this;return this.each(function(n,r){t.push(e.decodeKey(r))}),t},r.prototype.find=function(t){var e=[];return this.each(function(n,r){t(n,r)&&e.push(n)}),e},r.prototype.toArray=function(){var t=[];return this.each(function(e){t.push(e)}),t},t.exports=r}])});(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==='object'&&typeof module==='object')
module.exports=factory(require("tui-color-picker"));else if(typeof define==='function'&&define.amd)
define(["tui-color-picker"],factory);else if(typeof exports==='object')
exports["tui"]=factory(require("tui-color-picker"));else
root["tui"]=root["tui"]||{},root["tui"]["ImageEditor"]=factory(root["tui"]["colorPicker"]);})(self,function(__WEBPACK_EXTERNAL_MODULE__4858__){return(function(){var __webpack_modules__=({2777:(function(__unused_webpack_module,exports,__webpack_require__){var fabric=fabric||{version:'4.6.0'};if(true){exports.fabric=fabric;}
else{}
if(typeof document!=='undefined'&&typeof window!=='undefined'){if(document instanceof(typeof HTMLDocument!=='undefined'?HTMLDocument:Document)){fabric.document=document;}
else{fabric.document=document.implementation.createHTMLDocument('');}
fabric.window=window;}
else{var jsdom=__webpack_require__(4960);var virtualWindow=new jsdom.JSDOM(decodeURIComponent('%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E'),{features:{FetchExternalResources:['img']},resources:'usable'}).window;fabric.document=virtualWindow.document;fabric.jsdomImplForWrapper=__webpack_require__(6759).implForWrapper;fabric.nodeCanvas=__webpack_require__(6272).Canvas;fabric.window=virtualWindow;DOMParser=fabric.window.DOMParser;}
fabric.isTouchSupported='ontouchstart'in fabric.window||'ontouchstart'in fabric.document||(fabric.window&&fabric.window.navigator&&fabric.window.navigator.maxTouchPoints>0);fabric.isLikelyNode=typeof Buffer!=='undefined'&&typeof window==='undefined';fabric.SHARED_ATTRIBUTES=['display','transform','fill','fill-opacity','fill-rule','opacity','stroke','stroke-dasharray','stroke-linecap','stroke-dashoffset','stroke-linejoin','stroke-miterlimit','stroke-opacity','stroke-width','id','paint-order','vector-effect','instantiated_by_use','clip-path',];fabric.DPI=96;fabric.reNum='(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)';fabric.commaWsp='(?:\\s+,?\\s*|,\\s*)';fabric.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig;fabric.reNonWord=/[ \n\.,;!\?\-]/;fabric.fontPaths={};fabric.iMatrix=[1,0,0,1,0,0];fabric.svgNS='http://www.w3.org/2000/svg';fabric.perfLimitSizeTotal=2097152;fabric.maxCacheSideLimit=4096;fabric.minCacheSideLimit=256;fabric.charWidthsCache={};fabric.textureSize=2048;fabric.disableStyleCopyPaste=false;fabric.enableGLFiltering=true;fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;fabric.browserShadowBlurConstant=1;fabric.arcToSegmentsCache={};fabric.boundsOfCurveCache={};fabric.cachesBoundsOfCurve=true;fabric.forceGLPutImageData=false;fabric.initFilterBackend=function(){if(fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)){console.log('max texture size: '+fabric.maxTextureSize);return(new fabric.WebglFilterBackend({tileSize:fabric.textureSize}));}
else if(fabric.Canvas2dFilterBackend){return(new fabric.Canvas2dFilterBackend());}};if(typeof document!=='undefined'&&typeof window!=='undefined'){window.fabric=fabric;}
(function(){function _removeEventListener(eventName,handler){if(!this.__eventListeners[eventName]){return;}
var eventListener=this.__eventListeners[eventName];if(handler){eventListener[eventListener.indexOf(handler)]=false;}
else{fabric.util.array.fill(eventListener,false);}}
function on(eventName,handler){if(!this.__eventListeners){this.__eventListeners={};}
if(arguments.length===1){for(var prop in eventName){this.on(prop,eventName[prop]);}}
else{if(!this.__eventListeners[eventName]){this.__eventListeners[eventName]=[];}
this.__eventListeners[eventName].push(handler);}
return this;}
function _once(eventName,handler){var _handler=function(){handler.apply(this,arguments);this.off(eventName,_handler);}.bind(this);this.on(eventName,_handler);}
function once(eventName,handler){if(arguments.length===1){for(var prop in eventName){_once.call(this,prop,eventName[prop]);}}
else{_once.call(this,eventName,handler);}
return this;}
function off(eventName,handler){if(!this.__eventListeners){return this;}
if(arguments.length===0){for(eventName in this.__eventListeners){_removeEventListener.call(this,eventName);}}
else if(arguments.length===1&&typeof arguments[0]==='object'){for(var prop in eventName){_removeEventListener.call(this,prop,eventName[prop]);}}
else{_removeEventListener.call(this,eventName,handler);}
return this;}
function fire(eventName,options){if(!this.__eventListeners){return this;}
var listenersForEvent=this.__eventListeners[eventName];if(!listenersForEvent){return this;}
for(var i=0,len=listenersForEvent.length;i<len;i++){listenersForEvent[i]&&listenersForEvent[i].call(this,options||{});}
this.__eventListeners[eventName]=listenersForEvent.filter(function(value){return value!==false;});return this;}
fabric.Observable={fire:fire,on:on,once:once,off:off,};})();fabric.Collection={_objects:[],add:function(){this._objects.push.apply(this._objects,arguments);if(this._onObjectAdded){for(var i=0,length=arguments.length;i<length;i++){this._onObjectAdded(arguments[i]);}}
this.renderOnAddRemove&&this.requestRenderAll();return this;},insertAt:function(object,index,nonSplicing){var objects=this._objects;if(nonSplicing){objects[index]=object;}
else{objects.splice(index,0,object);}
this._onObjectAdded&&this._onObjectAdded(object);this.renderOnAddRemove&&this.requestRenderAll();return this;},remove:function(){var objects=this._objects,index,somethingRemoved=false;for(var i=0,length=arguments.length;i<length;i++){index=objects.indexOf(arguments[i]);if(index!==-1){somethingRemoved=true;objects.splice(index,1);this._onObjectRemoved&&this._onObjectRemoved(arguments[i]);}}
this.renderOnAddRemove&&somethingRemoved&&this.requestRenderAll();return this;},forEachObject:function(callback,context){var objects=this.getObjects();for(var i=0,len=objects.length;i<len;i++){callback.call(context,objects[i],i,objects);}
return this;},getObjects:function(type){if(typeof type==='undefined'){return this._objects.concat();}
return this._objects.filter(function(o){return o.type===type;});},item:function(index){return this._objects[index];},isEmpty:function(){return this._objects.length===0;},size:function(){return this._objects.length;},contains:function(object,deep){if(this._objects.indexOf(object)>-1){return true;}
else if(deep){return this._objects.some(function(obj){return typeof obj.contains==='function'&&obj.contains(object,true);});}
return false;},complexity:function(){return this._objects.reduce(function(memo,current){memo+=current.complexity?current.complexity():0;return memo;},0);}};fabric.CommonMethods={_setOptions:function(options){for(var prop in options){this.set(prop,options[prop]);}},_initGradient:function(filler,property){if(filler&&filler.colorStops&&!(filler instanceof fabric.Gradient)){this.set(property,new fabric.Gradient(filler));}},_initPattern:function(filler,property,callback){if(filler&&filler.source&&!(filler instanceof fabric.Pattern)){this.set(property,new fabric.Pattern(filler,callback));}
else{callback&&callback();}},_setObject:function(obj){for(var prop in obj){this._set(prop,obj[prop]);}},set:function(key,value){if(typeof key==='object'){this._setObject(key);}
else{this._set(key,value);}
return this;},_set:function(key,value){this[key]=value;},toggle:function(property){var value=this.get(property);if(typeof value==='boolean'){this.set(property,!value);}
return this;},get:function(property){return this[property];}};(function(global){var sqrt=Math.sqrt,atan2=Math.atan2,pow=Math.pow,PiBy180=Math.PI/180,PiBy2=Math.PI/2;fabric.util={cos:function(angle){if(angle===0){return 1;}
if(angle<0){angle=-angle;}
var angleSlice=angle/PiBy2;switch(angleSlice){case 1:case 3:return 0;case 2:return-1;}
return Math.cos(angle);},sin:function(angle){if(angle===0){return 0;}
var angleSlice=angle/PiBy2,sign=1;if(angle<0){sign=-1;}
switch(angleSlice){case 1:return sign;case 2:return 0;case 3:return-sign;}
return Math.sin(angle);},removeFromArray:function(array,value){var idx=array.indexOf(value);if(idx!==-1){array.splice(idx,1);}
return array;},getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min;},degreesToRadians:function(degrees){return degrees*PiBy180;},radiansToDegrees:function(radians){return radians/PiBy180;},rotatePoint:function(point,origin,radians){var newPoint=new fabric.Point(point.x-origin.x,point.y-origin.y),v=fabric.util.rotateVector(newPoint,radians);return new fabric.Point(v.x,v.y).addEquals(origin);},rotateVector:function(vector,radians){var sin=fabric.util.sin(radians),cos=fabric.util.cos(radians),rx=vector.x*cos-vector.y*sin,ry=vector.x*sin+vector.y*cos;return{x:rx,y:ry};},transformPoint:function(p,t,ignoreOffset){if(ignoreOffset){return new fabric.Point(t[0]*p.x+t[2]*p.y,t[1]*p.x+t[3]*p.y);}
return new fabric.Point(t[0]*p.x+t[2]*p.y+t[4],t[1]*p.x+t[3]*p.y+t[5]);},makeBoundingBoxFromPoints:function(points,transform){if(transform){for(var i=0;i<points.length;i++){points[i]=fabric.util.transformPoint(points[i],transform);}}
var xPoints=[points[0].x,points[1].x,points[2].x,points[3].x],minX=fabric.util.array.min(xPoints),maxX=fabric.util.array.max(xPoints),width=maxX-minX,yPoints=[points[0].y,points[1].y,points[2].y,points[3].y],minY=fabric.util.array.min(yPoints),maxY=fabric.util.array.max(yPoints),height=maxY-minY;return{left:minX,top:minY,width:width,height:height};},invertTransform:function(t){var a=1/(t[0]*t[3]-t[1]*t[2]),r=[a*t[3],-a*t[1],-a*t[2],a*t[0]],o=fabric.util.transformPoint({x:t[4],y:t[5]},r,true);r[4]=-o.x;r[5]=-o.y;return r;},toFixed:function(number,fractionDigits){return parseFloat(Number(number).toFixed(fractionDigits));},parseUnit:function(value,fontSize){var unit=/\D{0,2}$/.exec(value),number=parseFloat(value);if(!fontSize){fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE;}
switch(unit[0]){case'mm':return number*fabric.DPI/25.4;case'cm':return number*fabric.DPI/2.54;case'in':return number*fabric.DPI;case'pt':return number*fabric.DPI/72;case'pc':return number*fabric.DPI/72*12;case'em':return number*fontSize;default:return number;}},falseFunction:function(){return false;},getKlass:function(type,namespace){type=fabric.util.string.camelize(type.charAt(0).toUpperCase()+type.slice(1));return fabric.util.resolveNamespace(namespace)[type];},getSvgAttributes:function(type){var attributes=['instantiated_by_use','style','id','class'];switch(type){case'linearGradient':attributes=attributes.concat(['x1','y1','x2','y2','gradientUnits','gradientTransform']);break;case'radialGradient':attributes=attributes.concat(['gradientUnits','gradientTransform','cx','cy','r','fx','fy','fr']);break;case'stop':attributes=attributes.concat(['offset','stop-color','stop-opacity']);break;}
return attributes;},resolveNamespace:function(namespace){if(!namespace){return fabric;}
var parts=namespace.split('.'),len=parts.length,i,obj=global||fabric.window;for(i=0;i<len;++i){obj=obj[parts[i]];}
return obj;},loadImage:function(url,callback,context,crossOrigin){if(!url){callback&&callback.call(context,url);return;}
var img=fabric.util.createImage();var onLoadCallback=function(){callback&&callback.call(context,img,false);img=img.onload=img.onerror=null;};img.onload=onLoadCallback;img.onerror=function(){fabric.log('Error loading '+img.src);callback&&callback.call(context,null,true);img=img.onload=img.onerror=null;};if(url.indexOf('data')!==0&&crossOrigin!==undefined&&crossOrigin!==null){img.crossOrigin=crossOrigin;}
if(url.substring(0,14)==='data:image/svg'){img.onload=null;fabric.util.loadImageInDom(img,onLoadCallback);}
img.src=url;},loadImageInDom:function(img,onLoadCallback){var div=fabric.document.createElement('div');div.style.width=div.style.height='1px';div.style.left=div.style.top='-100%';div.style.position='absolute';div.appendChild(img);fabric.document.querySelector('body').appendChild(div);img.onload=function(){onLoadCallback();div.parentNode.removeChild(div);div=null;};},enlivenObjects:function(objects,callback,namespace,reviver){objects=objects||[];var enlivenedObjects=[],numLoadedObjects=0,numTotalObjects=objects.length;function onLoaded(){if(++numLoadedObjects===numTotalObjects){callback&&callback(enlivenedObjects.filter(function(obj){return obj;}));}}
if(!numTotalObjects){callback&&callback(enlivenedObjects);return;}
objects.forEach(function(o,index){if(!o||!o.type){onLoaded();return;}
var klass=fabric.util.getKlass(o.type,namespace);klass.fromObject(o,function(obj,error){error||(enlivenedObjects[index]=obj);reviver&&reviver(o,obj,error);onLoaded();});});},enlivenPatterns:function(patterns,callback){patterns=patterns||[];function onLoaded(){if(++numLoadedPatterns===numPatterns){callback&&callback(enlivenedPatterns);}}
var enlivenedPatterns=[],numLoadedPatterns=0,numPatterns=patterns.length;if(!numPatterns){callback&&callback(enlivenedPatterns);return;}
patterns.forEach(function(p,index){if(p&&p.source){new fabric.Pattern(p,function(pattern){enlivenedPatterns[index]=pattern;onLoaded();});}
else{enlivenedPatterns[index]=p;onLoaded();}});},groupSVGElements:function(elements,options,path){var object;if(elements&&elements.length===1){return elements[0];}
if(options){if(options.width&&options.height){options.centerPoint={x:options.width/2,y:options.height/2};}
else{delete options.width;delete options.height;}}
object=new fabric.Group(elements,options);if(typeof path!=='undefined'){object.sourcePath=path;}
return object;},populateWithProperties:function(source,destination,properties){if(properties&&Object.prototype.toString.call(properties)==='[object Array]'){for(var i=0,len=properties.length;i<len;i++){if(properties[i]in source){destination[properties[i]]=source[properties[i]];}}}},drawDashedLine:function(ctx,x,y,x2,y2,da){var dx=x2-x,dy=y2-y,len=sqrt(dx*dx+dy*dy),rot=atan2(dy,dx),dc=da.length,di=0,draw=true;ctx.save();ctx.translate(x,y);ctx.moveTo(0,0);ctx.rotate(rot);x=0;while(len>x){x+=da[di++%dc];if(x>len){x=len;}
ctx[draw?'lineTo':'moveTo'](x,0);draw=!draw;}
ctx.restore();},createCanvasElement:function(){return fabric.document.createElement('canvas');},copyCanvasElement:function(canvas){var newCanvas=fabric.util.createCanvasElement();newCanvas.width=canvas.width;newCanvas.height=canvas.height;newCanvas.getContext('2d').drawImage(canvas,0,0);return newCanvas;},toDataURL:function(canvasEl,format,quality){return canvasEl.toDataURL('image/'+format,quality);},createImage:function(){return fabric.document.createElement('img');},multiplyTransformMatrices:function(a,b,is2x2){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],is2x2?0:a[0]*b[4]+a[2]*b[5]+a[4],is2x2?0:a[1]*b[4]+a[3]*b[5]+a[5]];},qrDecompose:function(a){var angle=atan2(a[1],a[0]),denom=pow(a[0],2)+pow(a[1],2),scaleX=sqrt(denom),scaleY=(a[0]*a[3]-a[2]*a[1])/scaleX,skewX=atan2(a[0]*a[2]+a[1]*a[3],denom);return{angle:angle/PiBy180,scaleX:scaleX,scaleY:scaleY,skewX:skewX/PiBy180,skewY:0,translateX:a[4],translateY:a[5]};},calcRotateMatrix:function(options){if(!options.angle){return fabric.iMatrix.concat();}
var theta=fabric.util.degreesToRadians(options.angle),cos=fabric.util.cos(theta),sin=fabric.util.sin(theta);return[cos,sin,-sin,cos,0,0];},calcDimensionsMatrix:function(options){var scaleX=typeof options.scaleX==='undefined'?1:options.scaleX,scaleY=typeof options.scaleY==='undefined'?1:options.scaleY,scaleMatrix=[options.flipX?-scaleX:scaleX,0,0,options.flipY?-scaleY:scaleY,0,0],multiply=fabric.util.multiplyTransformMatrices,degreesToRadians=fabric.util.degreesToRadians;if(options.skewX){scaleMatrix=multiply(scaleMatrix,[1,0,Math.tan(degreesToRadians(options.skewX)),1],true);}
if(options.skewY){scaleMatrix=multiply(scaleMatrix,[1,Math.tan(degreesToRadians(options.skewY)),0,1],true);}
return scaleMatrix;},composeMatrix:function(options){var matrix=[1,0,0,1,options.translateX||0,options.translateY||0],multiply=fabric.util.multiplyTransformMatrices;if(options.angle){matrix=multiply(matrix,fabric.util.calcRotateMatrix(options));}
if(options.scaleX!==1||options.scaleY!==1||options.skewX||options.skewY||options.flipX||options.flipY){matrix=multiply(matrix,fabric.util.calcDimensionsMatrix(options));}
return matrix;},resetObjectTransform:function(target){target.scaleX=1;target.scaleY=1;target.skewX=0;target.skewY=0;target.flipX=false;target.flipY=false;target.rotate(0);},saveObjectTransform:function(target){return{scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,angle:target.angle,left:target.left,flipX:target.flipX,flipY:target.flipY,top:target.top};},isTransparent:function(ctx,x,y,tolerance){if(tolerance>0){if(x>tolerance){x-=tolerance;}
else{x=0;}
if(y>tolerance){y-=tolerance;}
else{y=0;}}
var _isTransparent=true,i,temp,imageData=ctx.getImageData(x,y,(tolerance*2)||1,(tolerance*2)||1),l=imageData.data.length;for(i=3;i<l;i+=4){temp=imageData.data[i];_isTransparent=temp<=0;if(_isTransparent===false){break;}}
imageData=null;return _isTransparent;},parsePreserveAspectRatioAttribute:function(attribute){var meetOrSlice='meet',alignX='Mid',alignY='Mid',aspectRatioAttrs=attribute.split(' '),align;if(aspectRatioAttrs&&aspectRatioAttrs.length){meetOrSlice=aspectRatioAttrs.pop();if(meetOrSlice!=='meet'&&meetOrSlice!=='slice'){align=meetOrSlice;meetOrSlice='meet';}
else if(aspectRatioAttrs.length){align=aspectRatioAttrs.pop();}}
alignX=align!=='none'?align.slice(1,4):'none';alignY=align!=='none'?align.slice(5,8):'none';return{meetOrSlice:meetOrSlice,alignX:alignX,alignY:alignY};},clearFabricFontCache:function(fontFamily){fontFamily=(fontFamily||'').toLowerCase();if(!fontFamily){fabric.charWidthsCache={};}
else if(fabric.charWidthsCache[fontFamily]){delete fabric.charWidthsCache[fontFamily];}},limitDimsByArea:function(ar,maximumArea){var roughWidth=Math.sqrt(maximumArea*ar),perfLimitSizeY=Math.floor(maximumArea/roughWidth);return{x:Math.floor(roughWidth),y:perfLimitSizeY};},capValue:function(min,value,max){return Math.max(min,Math.min(value,max));},findScaleToFit:function(source,destination){return Math.min(destination.width/source.width,destination.height/source.height);},findScaleToCover:function(source,destination){return Math.max(destination.width/source.width,destination.height/source.height);},matrixToSVG:function(transform){return'matrix('+transform.map(function(value){return fabric.util.toFixed(value,fabric.Object.NUM_FRACTION_DIGITS);}).join(' ')+')';},removeTransformFromObject:function(object,transform){var inverted=fabric.util.invertTransform(transform),finalTransform=fabric.util.multiplyTransformMatrices(inverted,object.calcOwnMatrix());fabric.util.applyTransformToObject(object,finalTransform);},addTransformToObject:function(object,transform){fabric.util.applyTransformToObject(object,fabric.util.multiplyTransformMatrices(transform,object.calcOwnMatrix()));},applyTransformToObject:function(object,transform){var options=fabric.util.qrDecompose(transform),center=new fabric.Point(options.translateX,options.translateY);object.flipX=false;object.flipY=false;object.set('scaleX',options.scaleX);object.set('scaleY',options.scaleY);object.skewX=options.skewX;object.skewY=options.skewY;object.angle=options.angle;object.setPositionByOrigin(center,'center','center');},sizeAfterTransform:function(width,height,options){var dimX=width/2,dimY=height/2,points=[{x:-dimX,y:-dimY},{x:dimX,y:-dimY},{x:-dimX,y:dimY},{x:dimX,y:dimY}],transformMatrix=fabric.util.calcDimensionsMatrix(options),bbox=fabric.util.makeBoundingBoxFromPoints(points,transformMatrix);return{x:bbox.width,y:bbox.height,};}};})(true?exports:0);(function(){var _join=Array.prototype.join,commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},repeatedCommands={m:'l',M:'L'};function segmentToBezier(th2,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY){var costh2=fabric.util.cos(th2),sinth2=fabric.util.sin(th2),costh3=fabric.util.cos(th3),sinth3=fabric.util.sin(th3),toX=cosTh*rx*costh3-sinTh*ry*sinth3+cx1,toY=sinTh*rx*costh3+cosTh*ry*sinth3+cy1,cp1X=fromX+mT*(-cosTh*rx*sinth2-sinTh*ry*costh2),cp1Y=fromY+mT*(-sinTh*rx*sinth2+cosTh*ry*costh2),cp2X=toX+mT*(cosTh*rx*sinth3+sinTh*ry*costh3),cp2Y=toY+mT*(sinTh*rx*sinth3-cosTh*ry*costh3);return['C',cp1X,cp1Y,cp2X,cp2Y,toX,toY];}
function arcToSegments(toX,toY,rx,ry,large,sweep,rotateX){var PI=Math.PI,th=rotateX*PI/180,sinTh=fabric.util.sin(th),cosTh=fabric.util.cos(th),fromX=0,fromY=0;rx=Math.abs(rx);ry=Math.abs(ry);var px=-cosTh*toX*0.5-sinTh*toY*0.5,py=-cosTh*toY*0.5+sinTh*toX*0.5,rx2=rx*rx,ry2=ry*ry,py2=py*py,px2=px*px,pl=rx2*ry2-rx2*py2-ry2*px2,root=0;if(pl<0){var s=Math.sqrt(1-pl/(rx2*ry2));rx*=s;ry*=s;}
else{root=(large===sweep?-1.0:1.0)*Math.sqrt(pl/(rx2*py2+ry2*px2));}
var cx=root*rx*py/ry,cy=-root*ry*px/rx,cx1=cosTh*cx-sinTh*cy+toX*0.5,cy1=sinTh*cx+cosTh*cy+toY*0.5,mTheta=calcVectorAngle(1,0,(px-cx)/rx,(py-cy)/ry),dtheta=calcVectorAngle((px-cx)/rx,(py-cy)/ry,(-px-cx)/rx,(-py-cy)/ry);if(sweep===0&&dtheta>0){dtheta-=2*PI;}
else if(sweep===1&&dtheta<0){dtheta+=2*PI;}
var segments=Math.ceil(Math.abs(dtheta/PI*2)),result=[],mDelta=dtheta/segments,mT=8/3*Math.sin(mDelta/4)*Math.sin(mDelta/4)/Math.sin(mDelta/2),th3=mTheta+mDelta;for(var i=0;i<segments;i++){result[i]=segmentToBezier(mTheta,th3,cosTh,sinTh,rx,ry,cx1,cy1,mT,fromX,fromY);fromX=result[i][5];fromY=result[i][6];mTheta=th3;th3+=mDelta;}
return result;}
function calcVectorAngle(ux,uy,vx,vy){var ta=Math.atan2(uy,ux),tb=Math.atan2(vy,vx);if(tb>=ta){return tb-ta;}
else{return 2*Math.PI-(ta-tb);}}
function getBoundsOfCurve(x0,y0,x1,y1,x2,y2,x3,y3){var argsString;if(fabric.cachesBoundsOfCurve){argsString=_join.call(arguments);if(fabric.boundsOfCurveCache[argsString]){return fabric.boundsOfCurveCache[argsString];}}
var sqrt=Math.sqrt,min=Math.min,max=Math.max,abs=Math.abs,tvalues=[],bounds=[[],[]],a,b,c,t,t1,t2,b2ac,sqrtb2ac;b=6*x0-12*x1+6*x2;a=-3*x0+9*x1-9*x2+3*x3;c=3*x1-3*x0;for(var i=0;i<2;++i){if(i>0){b=6*y0-12*y1+6*y2;a=-3*y0+9*y1-9*y2+3*y3;c=3*y1-3*y0;}
if(abs(a)<1e-12){if(abs(b)<1e-12){continue;}
t=-c/b;if(0<t&&t<1){tvalues.push(t);}
continue;}
b2ac=b*b-4*c*a;if(b2ac<0){continue;}
sqrtb2ac=sqrt(b2ac);t1=(-b+sqrtb2ac)/(2*a);if(0<t1&&t1<1){tvalues.push(t1);}
t2=(-b-sqrtb2ac)/(2*a);if(0<t2&&t2<1){tvalues.push(t2);}}
var x,y,j=tvalues.length,jlen=j,mt;while(j--){t=tvalues[j];mt=1-t;x=(mt*mt*mt*x0)+(3*mt*mt*t*x1)+(3*mt*t*t*x2)+(t*t*t*x3);bounds[0][j]=x;y=(mt*mt*mt*y0)+(3*mt*mt*t*y1)+(3*mt*t*t*y2)+(t*t*t*y3);bounds[1][j]=y;}
bounds[0][jlen]=x0;bounds[1][jlen]=y0;bounds[0][jlen+1]=x3;bounds[1][jlen+1]=y3;var result=[{x:min.apply(null,bounds[0]),y:min.apply(null,bounds[1])},{x:max.apply(null,bounds[0]),y:max.apply(null,bounds[1])}];if(fabric.cachesBoundsOfCurve){fabric.boundsOfCurveCache[argsString]=result;}
return result;}
function fromArcToBeziers(fx,fy,coords){var rx=coords[1],ry=coords[2],rot=coords[3],large=coords[4],sweep=coords[5],tx=coords[6],ty=coords[7],segsNorm=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot);for(var i=0,len=segsNorm.length;i<len;i++){segsNorm[i][1]+=fx;segsNorm[i][2]+=fy;segsNorm[i][3]+=fx;segsNorm[i][4]+=fy;segsNorm[i][5]+=fx;segsNorm[i][6]+=fy;}
return segsNorm;};function makePathSimpler(path){var x=0,y=0,len=path.length,x1=0,y1=0,current,i,converted,destinationPath=[],previous,controlX,controlY;for(i=0;i<len;++i){converted=false;current=path[i].slice(0);switch(current[0]){case'l':current[0]='L';current[1]+=x;current[2]+=y;case'L':x=current[1];y=current[2];break;case'h':current[1]+=x;case'H':current[0]='L';current[2]=y;x=current[1];break;case'v':current[1]+=y;case'V':current[0]='L';y=current[1];current[1]=x;current[2]=y;break;case'm':current[0]='M';current[1]+=x;current[2]+=y;case'M':x=current[1];y=current[2];x1=current[1];y1=current[2];break;case'c':current[0]='C';current[1]+=x;current[2]+=y;current[3]+=x;current[4]+=y;current[5]+=x;current[6]+=y;case'C':controlX=current[3];controlY=current[4];x=current[5];y=current[6];break;case's':current[0]='S';current[1]+=x;current[2]+=y;current[3]+=x;current[4]+=y;case'S':if(previous==='C'){controlX=2*x-controlX;controlY=2*y-controlY;}
else{controlX=x;controlY=y;}
x=current[3];y=current[4];current[0]='C';current[5]=current[3];current[6]=current[4];current[3]=current[1];current[4]=current[2];current[1]=controlX;current[2]=controlY;controlX=current[3];controlY=current[4];break;case'q':current[0]='Q';current[1]+=x;current[2]+=y;current[3]+=x;current[4]+=y;case'Q':controlX=current[1];controlY=current[2];x=current[3];y=current[4];break;case't':current[0]='T';current[1]+=x;current[2]+=y;case'T':if(previous==='Q'){controlX=2*x-controlX;controlY=2*y-controlY;}
else{controlX=x;controlY=y;}
current[0]='Q';x=current[1];y=current[2];current[1]=controlX;current[2]=controlY;current[3]=x;current[4]=y;break;case'a':current[0]='A';current[6]+=x;current[7]+=y;case'A':converted=true;destinationPath=destinationPath.concat(fromArcToBeziers(x,y,current));x=current[6];y=current[7];break;case'z':case'Z':x=x1;y=y1;break;default:}
if(!converted){destinationPath.push(current);}
previous=current[0];}
return destinationPath;};function calcLineLength(x1,y1,x2,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1));}
function CB1(t){return t*t*t;}
function CB2(t){return 3*t*t*(1-t);}
function CB3(t){return 3*t*(1-t)*(1-t);}
function CB4(t){return(1-t)*(1-t)*(1-t);}
function getPointOnCubicBezierIterator(p1x,p1y,p2x,p2y,p3x,p3y,p4x,p4y){return function(pct){var c1=CB1(pct),c2=CB2(pct),c3=CB3(pct),c4=CB4(pct);return{x:p4x*c1+p3x*c2+p2x*c3+p1x*c4,y:p4y*c1+p3y*c2+p2y*c3+p1y*c4};};}
function getTangentCubicIterator(p1x,p1y,p2x,p2y,p3x,p3y,p4x,p4y){return function(pct){var invT=1-pct,tangentX=(3*invT*invT*(p2x-p1x))+(6*invT*pct*(p3x-p2x))+
(3*pct*pct*(p4x-p3x)),tangentY=(3*invT*invT*(p2y-p1y))+(6*invT*pct*(p3y-p2y))+
(3*pct*pct*(p4y-p3y));return Math.atan2(tangentY,tangentX);};}
function QB1(t){return t*t;}
function QB2(t){return 2*t*(1-t);}
function QB3(t){return(1-t)*(1-t);}
function getPointOnQuadraticBezierIterator(p1x,p1y,p2x,p2y,p3x,p3y){return function(pct){var c1=QB1(pct),c2=QB2(pct),c3=QB3(pct);return{x:p3x*c1+p2x*c2+p1x*c3,y:p3y*c1+p2y*c2+p1y*c3};};}
function getTangentQuadraticIterator(p1x,p1y,p2x,p2y,p3x,p3y){return function(pct){var invT=1-pct,tangentX=(2*invT*(p2x-p1x))+(2*pct*(p3x-p2x)),tangentY=(2*invT*(p2y-p1y))+(2*pct*(p3y-p2y));return Math.atan2(tangentY,tangentX);};}
function pathIterator(iterator,x1,y1){var tempP={x:x1,y:y1},p,tmpLen=0,perc;for(perc=1;perc<=100;perc+=1){p=iterator(perc/100);tmpLen+=calcLineLength(tempP.x,tempP.y,p.x,p.y);tempP=p;}
return tmpLen;}
function findPercentageForDistance(segInfo,distance){var perc=0,tmpLen=0,iterator=segInfo.iterator,tempP={x:segInfo.x,y:segInfo.y},p,nextLen,nextStep=0.01,angleFinder=segInfo.angleFinder,lastPerc;while(tmpLen<distance&&perc<=1&&nextStep>0.0001){p=iterator(perc);lastPerc=perc;nextLen=calcLineLength(tempP.x,tempP.y,p.x,p.y);if((nextLen+tmpLen)>distance){nextStep/=2;perc-=nextStep;}
else{tempP=p;perc+=nextStep;tmpLen+=nextLen;}}
p.angle=angleFinder(lastPerc);return p;}
function getPathSegmentsInfo(path){var totalLength=0,len=path.length,current,x1=0,y1=0,x2=0,y2=0,info=[],iterator,tempInfo,angleFinder;for(var i=0;i<len;i++){current=path[i];tempInfo={x:x1,y:y1,command:current[0],};switch(current[0]){case'M':tempInfo.length=0;x2=x1=current[1];y2=y1=current[2];break;case'L':tempInfo.length=calcLineLength(x1,y1,current[1],current[2]);x1=current[1];y1=current[2];break;case'C':iterator=getPointOnCubicBezierIterator(x1,y1,current[1],current[2],current[3],current[4],current[5],current[6]);angleFinder=getTangentCubicIterator(x1,y1,current[1],current[2],current[3],current[4],current[5],current[6]);tempInfo.iterator=iterator;tempInfo.angleFinder=angleFinder;tempInfo.length=pathIterator(iterator,x1,y1);x1=current[5];y1=current[6];break;case'Q':iterator=getPointOnQuadraticBezierIterator(x1,y1,current[1],current[2],current[3],current[4]);angleFinder=getTangentQuadraticIterator(x1,y1,current[1],current[2],current[3],current[4]);tempInfo.iterator=iterator;tempInfo.angleFinder=angleFinder;tempInfo.length=pathIterator(iterator,x1,y1);x1=current[3];y1=current[4];break;case'Z':case'z':tempInfo.destX=x2;tempInfo.destY=y2;tempInfo.length=calcLineLength(x1,y1,x2,y2);x1=x2;y1=y2;break;}
totalLength+=tempInfo.length;info.push(tempInfo);}
info.push({length:totalLength,x:x1,y:y1});return info;}
function getPointOnPath(path,distance,infos){if(!infos){infos=getPathSegmentsInfo(path);}
var i=0;while((distance-infos[i].length>0)&&i<(infos.length-2)){distance-=infos[i].length;i++;}
var segInfo=infos[i],segPercent=distance/segInfo.length,command=segInfo.command,segment=path[i],info;switch(command){case'M':return{x:segInfo.x,y:segInfo.y,angle:0};case'Z':case'z':info=new fabric.Point(segInfo.x,segInfo.y).lerp(new fabric.Point(segInfo.destX,segInfo.destY),segPercent);info.angle=Math.atan2(segInfo.destY-segInfo.y,segInfo.destX-segInfo.x);return info;case'L':info=new fabric.Point(segInfo.x,segInfo.y).lerp(new fabric.Point(segment[1],segment[2]),segPercent);info.angle=Math.atan2(segment[2]-segInfo.y,segment[1]-segInfo.x);return info;case'C':return findPercentageForDistance(segInfo,distance);case'Q':return findPercentageForDistance(segInfo,distance);}}
function parsePath(pathString){var result=[],coords=[],currentPath,parsed,re=fabric.rePathCommand,rNumber='[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*',rNumberCommaWsp='('+rNumber+')'+fabric.commaWsp,rFlagCommaWsp='([01])'+fabric.commaWsp+'?',rArcSeq=rNumberCommaWsp+'?'+rNumberCommaWsp+'?'+rNumberCommaWsp+rFlagCommaWsp+rFlagCommaWsp+
rNumberCommaWsp+'?('+rNumber+')',regArcArgumentSequence=new RegExp(rArcSeq,'g'),match,coordsStr,path;if(!pathString||!pathString.match){return result;}
path=pathString.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var i=0,coordsParsed,len=path.length;i<len;i++){currentPath=path[i];coordsStr=currentPath.slice(1).trim();coords.length=0;var command=currentPath.charAt(0);coordsParsed=[command];if(command.toLowerCase()==='a'){for(var args;(args=regArcArgumentSequence.exec(coordsStr));){for(var j=1;j<args.length;j++){coords.push(args[j]);}}}
else{while((match=re.exec(coordsStr))){coords.push(match[0]);}}
for(var j=0,jlen=coords.length;j<jlen;j++){parsed=parseFloat(coords[j]);if(!isNaN(parsed)){coordsParsed.push(parsed);}}
var commandLength=commandLengths[command.toLowerCase()],repeatedCommand=repeatedCommands[command]||command;if(coordsParsed.length-1>commandLength){for(var k=1,klen=coordsParsed.length;k<klen;k+=commandLength){result.push([command].concat(coordsParsed.slice(k,k+commandLength)));command=repeatedCommand;}}
else{result.push(coordsParsed);}}
return result;};function getSmoothPathFromPoints(points,correction){var path=[],i,p1=new fabric.Point(points[0].x,points[0].y),p2=new fabric.Point(points[1].x,points[1].y),len=points.length,multSignX=1,multSignY=0,manyPoints=len>2;correction=correction||0;if(manyPoints){multSignX=points[2].x<p2.x?-1:points[2].x===p2.x?0:1;multSignY=points[2].y<p2.y?-1:points[2].y===p2.y?0:1;}
path.push(['M',p1.x-multSignX*correction,p1.y-multSignY*correction]);for(i=1;i<len;i++){if(!p1.eq(p2)){var midPoint=p1.midPointFrom(p2);path.push(['Q',p1.x,p1.y,midPoint.x,midPoint.y]);}
p1=points[i];if((i+1)<points.length){p2=points[i+1];}}
if(manyPoints){multSignX=p1.x>points[i-2].x?1:p1.x===points[i-2].x?0:-1;multSignY=p1.y>points[i-2].y?1:p1.y===points[i-2].y?0:-1;}
path.push(['L',p1.x+multSignX*correction,p1.y+multSignY*correction]);return path;}
function transformPath(path,transform,pathOffset){if(pathOffset){transform=fabric.util.multiplyTransformMatrices(transform,[1,0,0,1,-pathOffset.x,-pathOffset.y]);}
return path.map(function(pathSegment){var newSegment=pathSegment.slice(0),point={};for(var i=1;i<pathSegment.length-1;i+=2){point.x=pathSegment[i];point.y=pathSegment[i+1];point=fabric.util.transformPoint(point,transform);newSegment[i]=point.x;newSegment[i+1]=point.y;}
return newSegment;});}
function getBoundsOfArc(fx,fy,rx,ry,rot,large,sweep,tx,ty){var fromX=0,fromY=0,bound,bounds=[],segs=arcToSegments(tx-fx,ty-fy,rx,ry,large,sweep,rot);for(var i=0,len=segs.length;i<len;i++){bound=getBoundsOfCurve(fromX,fromY,segs[i][1],segs[i][2],segs[i][3],segs[i][4],segs[i][5],segs[i][6]);bounds.push({x:bound[0].x+fx,y:bound[0].y+fy});bounds.push({x:bound[1].x+fx,y:bound[1].y+fy});fromX=segs[i][5];fromY=segs[i][6];}
return bounds;};function drawArc(ctx,fx,fy,coords){coords=coords.slice(0).unshift('X');var beziers=fromArcToBeziers(fx,fy,coords);beziers.forEach(function(bezier){ctx.bezierCurveTo.apply(ctx,bezier.slice(1));});};fabric.util.joinPath=function(pathData){return pathData.map(function(segment){return segment.join(' ');}).join(' ');};fabric.util.parsePath=parsePath;fabric.util.makePathSimpler=makePathSimpler;fabric.util.getSmoothPathFromPoints=getSmoothPathFromPoints;fabric.util.getPathSegmentsInfo=getPathSegmentsInfo;fabric.util.getBoundsOfCurve=getBoundsOfCurve;fabric.util.getPointOnPath=getPointOnPath;fabric.util.transformPath=transformPath;fabric.util.fromArcToBeizers=fromArcToBeziers;fabric.util.getBoundsOfArc=getBoundsOfArc;fabric.util.drawArc=drawArc;})();(function(){var slice=Array.prototype.slice;function invoke(array,method){var args=slice.call(arguments,2),result=[];for(var i=0,len=array.length;i<len;i++){result[i]=args.length?array[i][method].apply(array[i],args):array[i][method].call(array[i]);}
return result;}
function max(array,byProperty){return find(array,byProperty,function(value1,value2){return value1>=value2;});}
function min(array,byProperty){return find(array,byProperty,function(value1,value2){return value1<value2;});}
function fill(array,value){var k=array.length;while(k--){array[k]=value;}
return array;}
function find(array,byProperty,condition){if(!array||array.length===0){return;}
var i=array.length-1,result=byProperty?array[i][byProperty]:array[i];if(byProperty){while(i--){if(condition(array[i][byProperty],result)){result=array[i][byProperty];}}}
else{while(i--){if(condition(array[i],result)){result=array[i];}}}
return result;}
fabric.util.array={fill:fill,invoke:invoke,min:min,max:max};})();(function(){function extend(destination,source,deep){if(deep){if(!fabric.isLikelyNode&&source instanceof Element){destination=source;}
else if(source instanceof Array){destination=[];for(var i=0,len=source.length;i<len;i++){destination[i]=extend({},source[i],deep);}}
else if(source&&typeof source==='object'){for(var property in source){if(property==='canvas'||property==='group'){destination[property]=null;}
else if(source.hasOwnProperty(property)){destination[property]=extend({},source[property],deep);}}}
else{destination=source;}}
else{for(var property in source){destination[property]=source[property];}}
return destination;}
function clone(object,deep){return extend({},object,deep);}
fabric.util.object={extend:extend,clone:clone};fabric.util.object.extend(fabric.util,fabric.Observable);})();(function(){function camelize(string){return string.replace(/-+(.)?/g,function(match,character){return character?character.toUpperCase():'';});}
function capitalize(string,firstLetterOnly){return string.charAt(0).toUpperCase()+
(firstLetterOnly?string.slice(1):string.slice(1).toLowerCase());}
function escapeXml(string){return string.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&apos;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function graphemeSplit(textstring){var i=0,chr,graphemes=[];for(i=0,chr;i<textstring.length;i++){if((chr=getWholeChar(textstring,i))===false){continue;}
graphemes.push(chr);}
return graphemes;}
function getWholeChar(str,i){var code=str.charCodeAt(i);if(isNaN(code)){return'';}
if(code<0xD800||code>0xDFFF){return str.charAt(i);}
if(0xD800<=code&&code<=0xDBFF){if(str.length<=(i+1)){throw'High surrogate without following low surrogate';}
var next=str.charCodeAt(i+1);if(0xDC00>next||next>0xDFFF){throw'High surrogate without following low surrogate';}
return str.charAt(i)+str.charAt(i+1);}
if(i===0){throw'Low surrogate without preceding high surrogate';}
var prev=str.charCodeAt(i-1);if(0xD800>prev||prev>0xDBFF){throw'Low surrogate without preceding high surrogate';}
return false;}
fabric.util.string={camelize:camelize,capitalize:capitalize,escapeXml:escapeXml,graphemeSplit:graphemeSplit};})();(function(){var slice=Array.prototype.slice,emptyFunction=function(){},IS_DONTENUM_BUGGY=(function(){for(var p in{toString:1}){if(p==='toString'){return false;}}
return true;})(),addMethods=function(klass,source,parent){for(var property in source){if(property in klass.prototype&&typeof klass.prototype[property]==='function'&&(source[property]+'').indexOf('callSuper')>-1){klass.prototype[property]=(function(property){return function(){var superclass=this.constructor.superclass;this.constructor.superclass=parent;var returnValue=source[property].apply(this,arguments);this.constructor.superclass=superclass;if(property!=='initialize'){return returnValue;}};})(property);}
else{klass.prototype[property]=source[property];}
if(IS_DONTENUM_BUGGY){if(source.toString!==Object.prototype.toString){klass.prototype.toString=source.toString;}
if(source.valueOf!==Object.prototype.valueOf){klass.prototype.valueOf=source.valueOf;}}}};function Subclass(){}
function callSuper(methodName){var parentMethod=null,_this=this;while(_this.constructor.superclass){var superClassMethod=_this.constructor.superclass.prototype[methodName];if(_this[methodName]!==superClassMethod){parentMethod=superClassMethod;break;}
_this=_this.constructor.superclass.prototype;}
if(!parentMethod){return console.log('tried to callSuper '+methodName+', method not found in prototype chain',this);}
return(arguments.length>1)?parentMethod.apply(this,slice.call(arguments,1)):parentMethod.call(this);}
function createClass(){var parent=null,properties=slice.call(arguments,0);if(typeof properties[0]==='function'){parent=properties.shift();}
function klass(){this.initialize.apply(this,arguments);}
klass.superclass=parent;klass.subclasses=[];if(parent){Subclass.prototype=parent.prototype;klass.prototype=new Subclass();parent.subclasses.push(klass);}
for(var i=0,length=properties.length;i<length;i++){addMethods(klass,properties[i],parent);}
if(!klass.prototype.initialize){klass.prototype.initialize=emptyFunction;}
klass.prototype.constructor=klass;klass.prototype.callSuper=callSuper;return klass;}
fabric.util.createClass=createClass;})();(function(){var couldUseAttachEvent=!!fabric.document.createElement('div').attachEvent,touchEvents=['touchstart','touchmove','touchend'];fabric.util.addListener=function(element,eventName,handler,options){element&&element.addEventListener(eventName,handler,couldUseAttachEvent?false:options);};fabric.util.removeListener=function(element,eventName,handler,options){element&&element.removeEventListener(eventName,handler,couldUseAttachEvent?false:options);};function getTouchInfo(event){var touchProp=event.changedTouches;if(touchProp&&touchProp[0]){return touchProp[0];}
return event;}
fabric.util.getPointer=function(event){var element=event.target,scroll=fabric.util.getScrollLeftTop(element),_evt=getTouchInfo(event);return{x:_evt.clientX+scroll.left,y:_evt.clientY+scroll.top};};fabric.util.isTouchEvent=function(event){return touchEvents.indexOf(event.type)>-1||event.pointerType==='touch';};})();(function(){function setStyle(element,styles){var elementStyle=element.style;if(!elementStyle){return element;}
if(typeof styles==='string'){element.style.cssText+=';'+styles;return styles.indexOf('opacity')>-1?setOpacity(element,styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;}
for(var property in styles){if(property==='opacity'){setOpacity(element,styles[property]);}
else{var normalizedProperty=(property==='float'||property==='cssFloat')?(typeof elementStyle.styleFloat==='undefined'?'cssFloat':'styleFloat'):property;elementStyle[normalizedProperty]=styles[property];}}
return element;}
var parseEl=fabric.document.createElement('div'),supportsOpacity=typeof parseEl.style.opacity==='string',supportsFilters=typeof parseEl.style.filter==='string',reOpacity=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,setOpacity=function(element){return element;};if(supportsOpacity){setOpacity=function(element,value){element.style.opacity=value;return element;};}
else if(supportsFilters){setOpacity=function(element,value){var es=element.style;if(element.currentStyle&&!element.currentStyle.hasLayout){es.zoom=1;}
if(reOpacity.test(es.filter)){value=value>=0.9999?'':('alpha(opacity='+(value*100)+')');es.filter=es.filter.replace(reOpacity,value);}
else{es.filter+=' alpha(opacity='+(value*100)+')';}
return element;};}
fabric.util.setStyle=setStyle;})();(function(){var _slice=Array.prototype.slice;function getById(id){return typeof id==='string'?fabric.document.getElementById(id):id;}
var sliceCanConvertNodelists,toArray=function(arrayLike){return _slice.call(arrayLike,0);};try{sliceCanConvertNodelists=toArray(fabric.document.childNodes)instanceof Array;}
catch(err){}
if(!sliceCanConvertNodelists){toArray=function(arrayLike){var arr=new Array(arrayLike.length),i=arrayLike.length;while(i--){arr[i]=arrayLike[i];}
return arr;};}
function makeElement(tagName,attributes){var el=fabric.document.createElement(tagName);for(var prop in attributes){if(prop==='class'){el.className=attributes[prop];}
else if(prop==='for'){el.htmlFor=attributes[prop];}
else{el.setAttribute(prop,attributes[prop]);}}
return el;}
function addClass(element,className){if(element&&(' '+element.className+' ').indexOf(' '+className+' ')===-1){element.className+=(element.className?' ':'')+className;}}
function wrapElement(element,wrapper,attributes){if(typeof wrapper==='string'){wrapper=makeElement(wrapper,attributes);}
if(element.parentNode){element.parentNode.replaceChild(wrapper,element);}
wrapper.appendChild(element);return wrapper;}
function getScrollLeftTop(element){var left=0,top=0,docElement=fabric.document.documentElement,body=fabric.document.body||{scrollLeft:0,scrollTop:0};while(element&&(element.parentNode||element.host)){element=element.parentNode||element.host;if(element===fabric.document){left=body.scrollLeft||docElement.scrollLeft||0;top=body.scrollTop||docElement.scrollTop||0;}
else{left+=element.scrollLeft||0;top+=element.scrollTop||0;}
if(element.nodeType===1&&element.style.position==='fixed'){break;}}
return{left:left,top:top};}
function getElementOffset(element){var docElem,doc=element&&element.ownerDocument,box={left:0,top:0},offset={left:0,top:0},scrollLeftTop,offsetAttributes={borderLeftWidth:'left',borderTopWidth:'top',paddingLeft:'left',paddingTop:'top'};if(!doc){return offset;}
for(var attr in offsetAttributes){offset[offsetAttributes[attr]]+=parseInt(getElementStyle(element,attr),10)||0;}
docElem=doc.documentElement;if(typeof element.getBoundingClientRect!=='undefined'){box=element.getBoundingClientRect();}
scrollLeftTop=getScrollLeftTop(element);return{left:box.left+scrollLeftTop.left-(docElem.clientLeft||0)+offset.left,top:box.top+scrollLeftTop.top-(docElem.clientTop||0)+offset.top};}
var getElementStyle;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){getElementStyle=function(element,attr){var style=fabric.document.defaultView.getComputedStyle(element,null);return style?style[attr]:undefined;};}
else{getElementStyle=function(element,attr){var value=element.style[attr];if(!value&&element.currentStyle){value=element.currentStyle[attr];}
return value;};}
(function(){var style=fabric.document.documentElement.style,selectProp='userSelect'in style?'userSelect':'MozUserSelect'in style?'MozUserSelect':'WebkitUserSelect'in style?'WebkitUserSelect':'KhtmlUserSelect'in style?'KhtmlUserSelect':'';function makeElementUnselectable(element){if(typeof element.onselectstart!=='undefined'){element.onselectstart=fabric.util.falseFunction;}
if(selectProp){element.style[selectProp]='none';}
else if(typeof element.unselectable==='string'){element.unselectable='on';}
return element;}
function makeElementSelectable(element){if(typeof element.onselectstart!=='undefined'){element.onselectstart=null;}
if(selectProp){element.style[selectProp]='';}
else if(typeof element.unselectable==='string'){element.unselectable='';}
return element;}
fabric.util.makeElementUnselectable=makeElementUnselectable;fabric.util.makeElementSelectable=makeElementSelectable;})();function getNodeCanvas(element){var impl=fabric.jsdomImplForWrapper(element);return impl._canvas||impl._image;};function cleanUpJsdomNode(element){if(!fabric.isLikelyNode){return;}
var impl=fabric.jsdomImplForWrapper(element);if(impl){impl._image=null;impl._canvas=null;impl._currentSrc=null;impl._attributes=null;impl._classList=null;}}
function setImageSmoothing(ctx,value){ctx.imageSmoothingEnabled=ctx.imageSmoothingEnabled||ctx.webkitImageSmoothingEnabled||ctx.mozImageSmoothingEnabled||ctx.msImageSmoothingEnabled||ctx.oImageSmoothingEnabled;ctx.imageSmoothingEnabled=value;}
fabric.util.setImageSmoothing=setImageSmoothing;fabric.util.getById=getById;fabric.util.toArray=toArray;fabric.util.addClass=addClass;fabric.util.makeElement=makeElement;fabric.util.wrapElement=wrapElement;fabric.util.getScrollLeftTop=getScrollLeftTop;fabric.util.getElementOffset=getElementOffset;fabric.util.getNodeCanvas=getNodeCanvas;fabric.util.cleanUpJsdomNode=cleanUpJsdomNode;})();(function(){function addParamToUrl(url,param){return url+(/\?/.test(url)?'&':'?')+param;}
function emptyFn(){}
function request(url,options){options||(options={});var method=options.method?options.method.toUpperCase():'GET',onComplete=options.onComplete||function(){},xhr=new fabric.window.XMLHttpRequest(),body=options.body||options.parameters;xhr.onreadystatechange=function(){if(xhr.readyState===4){onComplete(xhr);xhr.onreadystatechange=emptyFn;}};if(method==='GET'){body=null;if(typeof options.parameters==='string'){url=addParamToUrl(url,options.parameters);}}
xhr.open(method,url,true);if(method==='POST'||method==='PUT'){xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');}
xhr.send(body);return xhr;}
fabric.util.request=request;})();fabric.log=console.log;fabric.warn=console.warn;(function(){function noop(){return false;}
function defaultEasing(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;}
function animate(options){var cancel=false;requestAnimFrame(function(timestamp){options||(options={});var start=timestamp||+new Date(),duration=options.duration||500,finish=start+duration,time,onChange=options.onChange||noop,abort=options.abort||noop,onComplete=options.onComplete||noop,easing=options.easing||defaultEasing,startValue='startValue'in options?options.startValue:0,endValue='endValue'in options?options.endValue:100,byValue=options.byValue||endValue-startValue;options.onStart&&options.onStart();(function tick(ticktime){time=ticktime||+new Date();var currentTime=time>finish?duration:(time-start),timePerc=currentTime/duration,current=easing(currentTime,startValue,byValue,duration),valuePerc=Math.abs((current-startValue)/byValue);if(cancel){return;}
if(abort(current,valuePerc,timePerc)){onComplete(endValue,1,1);return;}
if(time>finish){onChange(endValue,1,1);onComplete(endValue,1,1);return;}
else{onChange(current,valuePerc,timePerc);requestAnimFrame(tick);}})(start);});return function(){cancel=true;};}
var _requestAnimFrame=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(callback){return fabric.window.setTimeout(callback,1000/60);};var _cancelAnimFrame=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;function requestAnimFrame(){return _requestAnimFrame.apply(fabric.window,arguments);}
function cancelAnimFrame(){return _cancelAnimFrame.apply(fabric.window,arguments);}
fabric.util.animate=animate;fabric.util.requestAnimFrame=requestAnimFrame;fabric.util.cancelAnimFrame=cancelAnimFrame;})();(function(){function calculateColor(begin,end,pos){var color='rgba('
+parseInt((begin[0]+pos*(end[0]-begin[0])),10)+','
+parseInt((begin[1]+pos*(end[1]-begin[1])),10)+','
+parseInt((begin[2]+pos*(end[2]-begin[2])),10);color+=','+(begin&&end?parseFloat(begin[3]+pos*(end[3]-begin[3])):1);color+=')';return color;}
function animateColor(fromColor,toColor,duration,options){var startColor=new fabric.Color(fromColor).getSource(),endColor=new fabric.Color(toColor).getSource(),originalOnComplete=options.onComplete,originalOnChange=options.onChange;options=options||{};return fabric.util.animate(fabric.util.object.extend(options,{duration:duration||500,startValue:startColor,endValue:endColor,byValue:endColor,easing:function(currentTime,startValue,byValue,duration){var posValue=options.colorEasing?options.colorEasing(currentTime,duration):1-Math.cos(currentTime/duration*(Math.PI/2));return calculateColor(startValue,byValue,posValue);},onComplete:function(current,valuePerc,timePerc){if(originalOnComplete){return originalOnComplete(calculateColor(endColor,endColor,0),valuePerc,timePerc);}},onChange:function(current,valuePerc,timePerc){if(originalOnChange){if(Array.isArray(current)){return originalOnChange(calculateColor(current,current,0),valuePerc,timePerc);}
originalOnChange(current,valuePerc,timePerc);}}}));}
fabric.util.animateColor=animateColor;})();(function(){function normalize(a,c,p,s){if(a<Math.abs(c)){a=c;s=p/4;}
else{if(c===0&&a===0){s=p/(2*Math.PI)*Math.asin(1);}
else{s=p/(2*Math.PI)*Math.asin(c/a);}}
return{a:a,c:c,p:p,s:s};}
function elastic(opts,t,d){return opts.a*Math.pow(2,10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p);}
function easeOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;}
function easeInOutCubic(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t*t+b;}
return c/2*((t-=2)*t*t+2)+b;}
function easeInQuart(t,b,c,d){return c*(t/=d)*t*t*t+b;}
function easeOutQuart(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;}
function easeInOutQuart(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t*t*t+b;}
return-c/2*((t-=2)*t*t*t-2)+b;}
function easeInQuint(t,b,c,d){return c*(t/=d)*t*t*t*t+b;}
function easeOutQuint(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;}
function easeInOutQuint(t,b,c,d){t/=d/2;if(t<1){return c/2*t*t*t*t*t+b;}
return c/2*((t-=2)*t*t*t*t+2)+b;}
function easeInSine(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;}
function easeOutSine(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;}
function easeInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;}
function easeInExpo(t,b,c,d){return(t===0)?b:c*Math.pow(2,10*(t/d-1))+b;}
function easeOutExpo(t,b,c,d){return(t===d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;}
function easeInOutExpo(t,b,c,d){if(t===0){return b;}
if(t===d){return b+c;}
t/=d/2;if(t<1){return c/2*Math.pow(2,10*(t-1))+b;}
return c/2*(-Math.pow(2,-10*--t)+2)+b;}
function easeInCirc(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;}
function easeOutCirc(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;}
function easeInOutCirc(t,b,c,d){t/=d/2;if(t<1){return-c/2*(Math.sqrt(1-t*t)-1)+b;}
return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;}
function easeInElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b;}
t/=d;if(t===1){return b+c;}
if(!p){p=d*0.3;}
var opts=normalize(a,c,p,s);return-elastic(opts,t,d)+b;}
function easeOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b;}
t/=d;if(t===1){return b+c;}
if(!p){p=d*0.3;}
var opts=normalize(a,c,p,s);return opts.a*Math.pow(2,-10*t)*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)+opts.c+b;}
function easeInOutElastic(t,b,c,d){var s=1.70158,p=0,a=c;if(t===0){return b;}
t/=d/2;if(t===2){return b+c;}
if(!p){p=d*(0.3*1.5);}
var opts=normalize(a,c,p,s);if(t<1){return-0.5*elastic(opts,t,d)+b;}
return opts.a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-opts.s)*(2*Math.PI)/opts.p)*0.5+opts.c+b;}
function easeInBack(t,b,c,d,s){if(s===undefined){s=1.70158;}
return c*(t/=d)*t*((s+1)*t-s)+b;}
function easeOutBack(t,b,c,d,s){if(s===undefined){s=1.70158;}
return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;}
function easeInOutBack(t,b,c,d,s){if(s===undefined){s=1.70158;}
t/=d/2;if(t<1){return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;}
return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;}
function easeInBounce(t,b,c,d){return c-easeOutBounce(d-t,0,c,d)+b;}
function easeOutBounce(t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}
else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+0.75)+b;}
else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+0.9375)+b;}
else{return c*(7.5625*(t-=(2.625/2.75))*t+0.984375)+b;}}
function easeInOutBounce(t,b,c,d){if(t<d/2){return easeInBounce(t*2,0,c,d)*0.5+b;}
return easeOutBounce(t*2-d,0,c,d)*0.5+c*0.5+b;}
fabric.util.ease={easeInQuad:function(t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(t,b,c,d){t/=(d/2);if(t<1){return c/2*t*t+b;}
return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:easeOutCubic,easeInOutCubic:easeInOutCubic,easeInQuart:easeInQuart,easeOutQuart:easeOutQuart,easeInOutQuart:easeInOutQuart,easeInQuint:easeInQuint,easeOutQuint:easeOutQuint,easeInOutQuint:easeInOutQuint,easeInSine:easeInSine,easeOutSine:easeOutSine,easeInOutSine:easeInOutSine,easeInExpo:easeInExpo,easeOutExpo:easeOutExpo,easeInOutExpo:easeInOutExpo,easeInCirc:easeInCirc,easeOutCirc:easeOutCirc,easeInOutCirc:easeInOutCirc,easeInElastic:easeInElastic,easeOutElastic:easeOutElastic,easeInOutElastic:easeInOutElastic,easeInBack:easeInBack,easeOutBack:easeOutBack,easeInOutBack:easeInOutBack,easeInBounce:easeInBounce,easeOutBounce:easeOutBounce,easeInOutBounce:easeInOutBounce};})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,parseUnit=fabric.util.parseUnit,multiplyTransformMatrices=fabric.util.multiplyTransformMatrices,svgValidTagNames=['path','circle','polygon','polyline','ellipse','rect','line','image','text'],svgViewBoxElements=['symbol','image','marker','pattern','view','svg'],svgInvalidAncestors=['pattern','defs','symbol','metadata','clipPath','mask','desc'],svgValidParents=['symbol','g','a','svg','clipPath','defs'],attributesMap={cx:'left',x:'left',r:'radius',cy:'top',y:'top',display:'visible',visibility:'visible',transform:'transformMatrix','fill-opacity':'fillOpacity','fill-rule':'fillRule','font-family':'fontFamily','font-size':'fontSize','font-style':'fontStyle','font-weight':'fontWeight','letter-spacing':'charSpacing','paint-order':'paintFirst','stroke-dasharray':'strokeDashArray','stroke-dashoffset':'strokeDashOffset','stroke-linecap':'strokeLineCap','stroke-linejoin':'strokeLineJoin','stroke-miterlimit':'strokeMiterLimit','stroke-opacity':'strokeOpacity','stroke-width':'strokeWidth','text-decoration':'textDecoration','text-anchor':'textAnchor',opacity:'opacity','clip-path':'clipPath','clip-rule':'clipRule','vector-effect':'strokeUniform','image-rendering':'imageSmoothing',},colorAttributes={stroke:'strokeOpacity',fill:'fillOpacity'},fSize='font-size',cPath='clip-path';fabric.svgValidTagNamesRegEx=getSvgRegex(svgValidTagNames);fabric.svgViewBoxElementsRegEx=getSvgRegex(svgViewBoxElements);fabric.svgInvalidAncestorsRegEx=getSvgRegex(svgInvalidAncestors);fabric.svgValidParentsRegEx=getSvgRegex(svgValidParents);fabric.cssRules={};fabric.gradientDefs={};fabric.clipPaths={};function normalizeAttr(attr){if(attr in attributesMap){return attributesMap[attr];}
return attr;}
function normalizeValue(attr,value,parentAttributes,fontSize){var isArray=Object.prototype.toString.call(value)==='[object Array]',parsed;if((attr==='fill'||attr==='stroke')&&value==='none'){value='';}
else if(attr==='strokeUniform'){return(value==='non-scaling-stroke');}
else if(attr==='strokeDashArray'){if(value==='none'){value=null;}
else{value=value.replace(/,/g,' ').split(/\s+/).map(parseFloat);}}
else if(attr==='transformMatrix'){if(parentAttributes&&parentAttributes.transformMatrix){value=multiplyTransformMatrices(parentAttributes.transformMatrix,fabric.parseTransformAttribute(value));}
else{value=fabric.parseTransformAttribute(value);}}
else if(attr==='visible'){value=value!=='none'&&value!=='hidden';if(parentAttributes&&parentAttributes.visible===false){value=false;}}
else if(attr==='opacity'){value=parseFloat(value);if(parentAttributes&&typeof parentAttributes.opacity!=='undefined'){value*=parentAttributes.opacity;}}
else if(attr==='textAnchor'){value=value==='start'?'left':value==='end'?'right':'center';}
else if(attr==='charSpacing'){parsed=parseUnit(value,fontSize)/fontSize*1000;}
else if(attr==='paintFirst'){var fillIndex=value.indexOf('fill');var strokeIndex=value.indexOf('stroke');var value='fill';if(fillIndex>-1&&strokeIndex>-1&&strokeIndex<fillIndex){value='stroke';}
else if(fillIndex===-1&&strokeIndex>-1){value='stroke';}}
else if(attr==='href'||attr==='xlink:href'||attr==='font'){return value;}
else if(attr==='imageSmoothing'){return(value==='optimizeQuality');}
else{parsed=isArray?value.map(parseUnit):parseUnit(value,fontSize);}
return(!isArray&&isNaN(parsed)?value:parsed);}
function getSvgRegex(arr){return new RegExp('^('+arr.join('|')+')\\b','i');}
function _setStrokeFillOpacity(attributes){for(var attr in colorAttributes){if(typeof attributes[colorAttributes[attr]]==='undefined'||attributes[attr]===''){continue;}
if(typeof attributes[attr]==='undefined'){if(!fabric.Object.prototype[attr]){continue;}
attributes[attr]=fabric.Object.prototype[attr];}
if(attributes[attr].indexOf('url(')===0){continue;}
var color=new fabric.Color(attributes[attr]);attributes[attr]=color.setAlpha(toFixed(color.getAlpha()*attributes[colorAttributes[attr]],2)).toRgba();}
return attributes;}
function _getMultipleNodes(doc,nodeNames){var nodeName,nodeArray=[],nodeList,i,len;for(i=0,len=nodeNames.length;i<len;i++){nodeName=nodeNames[i];nodeList=doc.getElementsByTagName(nodeName);nodeArray=nodeArray.concat(Array.prototype.slice.call(nodeList));}
return nodeArray;}
fabric.parseTransformAttribute=(function(){function rotateMatrix(matrix,args){var cos=fabric.util.cos(args[0]),sin=fabric.util.sin(args[0]),x=0,y=0;if(args.length===3){x=args[1];y=args[2];}
matrix[0]=cos;matrix[1]=sin;matrix[2]=-sin;matrix[3]=cos;matrix[4]=x-(cos*x-sin*y);matrix[5]=y-(sin*x+cos*y);}
function scaleMatrix(matrix,args){var multiplierX=args[0],multiplierY=(args.length===2)?args[1]:args[0];matrix[0]=multiplierX;matrix[3]=multiplierY;}
function skewMatrix(matrix,args,pos){matrix[pos]=Math.tan(fabric.util.degreesToRadians(args[0]));}
function translateMatrix(matrix,args){matrix[4]=args[0];if(args.length===2){matrix[5]=args[1];}}
var iMatrix=fabric.iMatrix,number=fabric.reNum,commaWsp=fabric.commaWsp,skewX='(?:(skewX)\\s*\\(\\s*('+number+')\\s*\\))',skewY='(?:(skewY)\\s*\\(\\s*('+number+')\\s*\\))',rotate='(?:(rotate)\\s*\\(\\s*('+number+')(?:'+
commaWsp+'('+number+')'+
commaWsp+'('+number+'))?\\s*\\))',scale='(?:(scale)\\s*\\(\\s*('+number+')(?:'+
commaWsp+'('+number+'))?\\s*\\))',translate='(?:(translate)\\s*\\(\\s*('+number+')(?:'+
commaWsp+'('+number+'))?\\s*\\))',matrix='(?:(matrix)\\s*\\(\\s*'+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+commaWsp+'('+number+')'+'\\s*\\))',transform='(?:'+
matrix+'|'+
translate+'|'+
scale+'|'+
rotate+'|'+
skewX+'|'+
skewY+')',transforms='(?:'+transform+'(?:'+commaWsp+'*'+transform+')*'+')',transformList='^\\s*(?:'+transforms+'?)\\s*$',reTransformList=new RegExp(transformList),reTransform=new RegExp(transform,'g');return function(attributeValue){var matrix=iMatrix.concat(),matrices=[];if(!attributeValue||(attributeValue&&!reTransformList.test(attributeValue))){return matrix;}
attributeValue.replace(reTransform,function(match){var m=new RegExp(transform).exec(match).filter(function(match){return(!!match);}),operation=m[1],args=m.slice(2).map(parseFloat);switch(operation){case'translate':translateMatrix(matrix,args);break;case'rotate':args[0]=fabric.util.degreesToRadians(args[0]);rotateMatrix(matrix,args);break;case'scale':scaleMatrix(matrix,args);break;case'skewX':skewMatrix(matrix,args,2);break;case'skewY':skewMatrix(matrix,args,1);break;case'matrix':matrix=args;break;}
matrices.push(matrix.concat());matrix=iMatrix.concat();});var combinedMatrix=matrices[0];while(matrices.length>1){matrices.shift();combinedMatrix=fabric.util.multiplyTransformMatrices(combinedMatrix,matrices[0]);}
return combinedMatrix;};})();function parseStyleString(style,oStyle){var attr,value;style.replace(/;\s*$/,'').split(';').forEach(function(chunk){var pair=chunk.split(':');attr=pair[0].trim().toLowerCase();value=pair[1].trim();oStyle[attr]=value;});}
function parseStyleObject(style,oStyle){var attr,value;for(var prop in style){if(typeof style[prop]==='undefined'){continue;}
attr=prop.toLowerCase();value=style[prop];oStyle[attr]=value;}}
function getGlobalStylesForElement(element,svgUid){var styles={};for(var rule in fabric.cssRules[svgUid]){if(elementMatchesRule(element,rule.split(' '))){for(var property in fabric.cssRules[svgUid][rule]){styles[property]=fabric.cssRules[svgUid][rule][property];}}}
return styles;}
function elementMatchesRule(element,selectors){var firstMatching,parentMatching=true;firstMatching=selectorMatches(element,selectors.pop());if(firstMatching&&selectors.length){parentMatching=doesSomeParentMatch(element,selectors);}
return firstMatching&&parentMatching&&(selectors.length===0);}
function doesSomeParentMatch(element,selectors){var selector,parentMatching=true;while(element.parentNode&&element.parentNode.nodeType===1&&selectors.length){if(parentMatching){selector=selectors.pop();}
element=element.parentNode;parentMatching=selectorMatches(element,selector);}
return selectors.length===0;}
function selectorMatches(element,selector){var nodeName=element.nodeName,classNames=element.getAttribute('class'),id=element.getAttribute('id'),matcher,i;matcher=new RegExp('^'+nodeName,'i');selector=selector.replace(matcher,'');if(id&&selector.length){matcher=new RegExp('#'+id+'(?![a-zA-Z\\-]+)','i');selector=selector.replace(matcher,'');}
if(classNames&&selector.length){classNames=classNames.split(' ');for(i=classNames.length;i--;){matcher=new RegExp('\\.'+classNames[i]+'(?![a-zA-Z\\-]+)','i');selector=selector.replace(matcher,'');}}
return selector.length===0;}
function elementById(doc,id){var el;doc.getElementById&&(el=doc.getElementById(id));if(el){return el;}
var node,i,len,nodelist=doc.getElementsByTagName('*');for(i=0,len=nodelist.length;i<len;i++){node=nodelist[i];if(id===node.getAttribute('id')){return node;}}}
function parseUseDirectives(doc){var nodelist=_getMultipleNodes(doc,['use','svg:use']),i=0;while(nodelist.length&&i<nodelist.length){var el=nodelist[i],xlinkAttribute=el.getAttribute('xlink:href')||el.getAttribute('href');if(xlinkAttribute===null){return;}
var xlink=xlinkAttribute.substr(1),x=el.getAttribute('x')||0,y=el.getAttribute('y')||0,el2=elementById(doc,xlink).cloneNode(true),currentTrans=(el2.getAttribute('transform')||'')+' translate('+x+', '+y+')',parentNode,oldLength=nodelist.length,attr,j,attrs,len,namespace=fabric.svgNS;applyViewboxTransform(el2);if(/^svg$/i.test(el2.nodeName)){var el3=el2.ownerDocument.createElementNS(namespace,'g');for(j=0,attrs=el2.attributes,len=attrs.length;j<len;j++){attr=attrs.item(j);el3.setAttributeNS(namespace,attr.nodeName,attr.nodeValue);}
while(el2.firstChild){el3.appendChild(el2.firstChild);}
el2=el3;}
for(j=0,attrs=el.attributes,len=attrs.length;j<len;j++){attr=attrs.item(j);if(attr.nodeName==='x'||attr.nodeName==='y'||attr.nodeName==='xlink:href'||attr.nodeName==='href'){continue;}
if(attr.nodeName==='transform'){currentTrans=attr.nodeValue+' '+currentTrans;}
else{el2.setAttribute(attr.nodeName,attr.nodeValue);}}
el2.setAttribute('transform',currentTrans);el2.setAttribute('instantiated_by_use','1');el2.removeAttribute('id');parentNode=el.parentNode;parentNode.replaceChild(el2,el);if(nodelist.length===oldLength){i++;}}}
var reViewBoxAttrValue=new RegExp('^'+'\\s*('+fabric.reNum+'+)\\s*,?'+'\\s*('+fabric.reNum+'+)\\s*,?'+'\\s*('+fabric.reNum+'+)\\s*,?'+'\\s*('+fabric.reNum+'+)\\s*'+'$');function applyViewboxTransform(element){if(!fabric.svgViewBoxElementsRegEx.test(element.nodeName)){return{};}
var viewBoxAttr=element.getAttribute('viewBox'),scaleX=1,scaleY=1,minX=0,minY=0,viewBoxWidth,viewBoxHeight,matrix,el,widthAttr=element.getAttribute('width'),heightAttr=element.getAttribute('height'),x=element.getAttribute('x')||0,y=element.getAttribute('y')||0,preserveAspectRatio=element.getAttribute('preserveAspectRatio')||'',missingViewBox=(!viewBoxAttr||!(viewBoxAttr=viewBoxAttr.match(reViewBoxAttrValue))),missingDimAttr=(!widthAttr||!heightAttr||widthAttr==='100%'||heightAttr==='100%'),toBeParsed=missingViewBox&&missingDimAttr,parsedDim={},translateMatrix='',widthDiff=0,heightDiff=0;parsedDim.width=0;parsedDim.height=0;parsedDim.toBeParsed=toBeParsed;if(missingViewBox){if(((x||y)&&element.parentNode&&element.parentNode.nodeName!=='#document')){translateMatrix=' translate('+parseUnit(x)+' '+parseUnit(y)+') ';matrix=(element.getAttribute('transform')||'')+translateMatrix;element.setAttribute('transform',matrix);element.removeAttribute('x');element.removeAttribute('y');}}
if(toBeParsed){return parsedDim;}
if(missingViewBox){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);return parsedDim;}
minX=-parseFloat(viewBoxAttr[1]);minY=-parseFloat(viewBoxAttr[2]);viewBoxWidth=parseFloat(viewBoxAttr[3]);viewBoxHeight=parseFloat(viewBoxAttr[4]);parsedDim.minX=minX;parsedDim.minY=minY;parsedDim.viewBoxWidth=viewBoxWidth;parsedDim.viewBoxHeight=viewBoxHeight;if(!missingDimAttr){parsedDim.width=parseUnit(widthAttr);parsedDim.height=parseUnit(heightAttr);scaleX=parsedDim.width/viewBoxWidth;scaleY=parsedDim.height/viewBoxHeight;}
else{parsedDim.width=viewBoxWidth;parsedDim.height=viewBoxHeight;}
preserveAspectRatio=fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);if(preserveAspectRatio.alignX!=='none'){if(preserveAspectRatio.meetOrSlice==='meet'){scaleY=scaleX=(scaleX>scaleY?scaleY:scaleX);}
if(preserveAspectRatio.meetOrSlice==='slice'){scaleY=scaleX=(scaleX>scaleY?scaleX:scaleY);}
widthDiff=parsedDim.width-viewBoxWidth*scaleX;heightDiff=parsedDim.height-viewBoxHeight*scaleX;if(preserveAspectRatio.alignX==='Mid'){widthDiff/=2;}
if(preserveAspectRatio.alignY==='Mid'){heightDiff/=2;}
if(preserveAspectRatio.alignX==='Min'){widthDiff=0;}
if(preserveAspectRatio.alignY==='Min'){heightDiff=0;}}
if(scaleX===1&&scaleY===1&&minX===0&&minY===0&&x===0&&y===0){return parsedDim;}
if((x||y)&&element.parentNode.nodeName!=='#document'){translateMatrix=' translate('+parseUnit(x)+' '+parseUnit(y)+') ';}
matrix=translateMatrix+' matrix('+scaleX+' 0'+' 0 '+
scaleY+' '+
(minX*scaleX+widthDiff)+' '+
(minY*scaleY+heightDiff)+') ';if(element.nodeName==='svg'){el=element.ownerDocument.createElementNS(fabric.svgNS,'g');while(element.firstChild){el.appendChild(element.firstChild);}
element.appendChild(el);}
else{el=element;el.removeAttribute('x');el.removeAttribute('y');matrix=el.getAttribute('transform')+matrix;}
el.setAttribute('transform',matrix);return parsedDim;}
function hasAncestorWithNodeName(element,nodeName){while(element&&(element=element.parentNode)){if(element.nodeName&&nodeName.test(element.nodeName.replace('svg:',''))&&!element.getAttribute('instantiated_by_use')){return true;}}
return false;}
fabric.parseSVGDocument=function(doc,callback,reviver,parsingOptions){if(!doc){return;}
parseUseDirectives(doc);var svgUid=fabric.Object.__uid++,i,len,options=applyViewboxTransform(doc),descendants=fabric.util.toArray(doc.getElementsByTagName('*'));options.crossOrigin=parsingOptions&&parsingOptions.crossOrigin;options.svgUid=svgUid;if(descendants.length===0&&fabric.isLikelyNode){descendants=doc.selectNodes('//*[name(.)!="svg"]');var arr=[];for(i=0,len=descendants.length;i<len;i++){arr[i]=descendants[i];}
descendants=arr;}
var elements=descendants.filter(function(el){applyViewboxTransform(el);return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:',''))&&!hasAncestorWithNodeName(el,fabric.svgInvalidAncestorsRegEx);});if(!elements||(elements&&!elements.length)){callback&&callback([],{});return;}
var clipPaths={};descendants.filter(function(el){return el.nodeName.replace('svg:','')==='clipPath';}).forEach(function(el){var id=el.getAttribute('id');clipPaths[id]=fabric.util.toArray(el.getElementsByTagName('*')).filter(function(el){return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:',''));});});fabric.gradientDefs[svgUid]=fabric.getGradientDefs(doc);fabric.cssRules[svgUid]=fabric.getCSSRules(doc);fabric.clipPaths[svgUid]=clipPaths;fabric.parseElements(elements,function(instances,elements){if(callback){callback(instances,options,elements,descendants);delete fabric.gradientDefs[svgUid];delete fabric.cssRules[svgUid];delete fabric.clipPaths[svgUid];}},clone(options),reviver,parsingOptions);};function recursivelyParseGradientsXlink(doc,gradient){var gradientsAttrs=['gradientTransform','x1','x2','y1','y2','gradientUnits','cx','cy','r','fx','fy'],xlinkAttr='xlink:href',xLink=gradient.getAttribute(xlinkAttr).substr(1),referencedGradient=elementById(doc,xLink);if(referencedGradient&&referencedGradient.getAttribute(xlinkAttr)){recursivelyParseGradientsXlink(doc,referencedGradient);}
gradientsAttrs.forEach(function(attr){if(referencedGradient&&!gradient.hasAttribute(attr)&&referencedGradient.hasAttribute(attr)){gradient.setAttribute(attr,referencedGradient.getAttribute(attr));}});if(!gradient.children.length){var referenceClone=referencedGradient.cloneNode(true);while(referenceClone.firstChild){gradient.appendChild(referenceClone.firstChild);}}
gradient.removeAttribute(xlinkAttr);}
var reFontDeclaration=new RegExp('(normal|italic)?\\s*(normal|small-caps)?\\s*'+'(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*('+
fabric.reNum+'(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|'+fabric.reNum+'))?\\s+(.*)');extend(fabric,{parseFontDeclaration:function(value,oStyle){var match=value.match(reFontDeclaration);if(!match){return;}
var fontStyle=match[1],fontWeight=match[3],fontSize=match[4],lineHeight=match[5],fontFamily=match[6];if(fontStyle){oStyle.fontStyle=fontStyle;}
if(fontWeight){oStyle.fontWeight=isNaN(parseFloat(fontWeight))?fontWeight:parseFloat(fontWeight);}
if(fontSize){oStyle.fontSize=parseUnit(fontSize);}
if(fontFamily){oStyle.fontFamily=fontFamily;}
if(lineHeight){oStyle.lineHeight=lineHeight==='normal'?1:lineHeight;}},getGradientDefs:function(doc){var tagArray=['linearGradient','radialGradient','svg:linearGradient','svg:radialGradient'],elList=_getMultipleNodes(doc,tagArray),el,j=0,gradientDefs={};j=elList.length;while(j--){el=elList[j];if(el.getAttribute('xlink:href')){recursivelyParseGradientsXlink(doc,el);}
gradientDefs[el.getAttribute('id')]=el;}
return gradientDefs;},parseAttributes:function(element,attributes,svgUid){if(!element){return;}
var value,parentAttributes={},fontSize,parentFontSize;if(typeof svgUid==='undefined'){svgUid=element.getAttribute('svgUid');}
if(element.parentNode&&fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)){parentAttributes=fabric.parseAttributes(element.parentNode,attributes,svgUid);}
var ownAttributes=attributes.reduce(function(memo,attr){value=element.getAttribute(attr);if(value){memo[attr]=value;}
return memo;},{});var cssAttrs=extend(getGlobalStylesForElement(element,svgUid),fabric.parseStyleAttribute(element));ownAttributes=extend(ownAttributes,cssAttrs);if(cssAttrs[cPath]){element.setAttribute(cPath,cssAttrs[cPath]);}
fontSize=parentFontSize=parentAttributes.fontSize||fabric.Text.DEFAULT_SVG_FONT_SIZE;if(ownAttributes[fSize]){ownAttributes[fSize]=fontSize=parseUnit(ownAttributes[fSize],parentFontSize);}
var normalizedAttr,normalizedValue,normalizedStyle={};for(var attr in ownAttributes){normalizedAttr=normalizeAttr(attr);normalizedValue=normalizeValue(normalizedAttr,ownAttributes[attr],parentAttributes,fontSize);normalizedStyle[normalizedAttr]=normalizedValue;}
if(normalizedStyle&&normalizedStyle.font){fabric.parseFontDeclaration(normalizedStyle.font,normalizedStyle);}
var mergedAttrs=extend(parentAttributes,normalizedStyle);return fabric.svgValidParentsRegEx.test(element.nodeName)?mergedAttrs:_setStrokeFillOpacity(mergedAttrs);},parseElements:function(elements,callback,options,reviver,parsingOptions){new fabric.ElementsParser(elements,callback,options,reviver,parsingOptions).parse();},parseStyleAttribute:function(element){var oStyle={},style=element.getAttribute('style');if(!style){return oStyle;}
if(typeof style==='string'){parseStyleString(style,oStyle);}
else{parseStyleObject(style,oStyle);}
return oStyle;},parsePointsAttribute:function(points){if(!points){return null;}
points=points.replace(/,/g,' ').trim();points=points.split(/\s+/);var parsedPoints=[],i,len;for(i=0,len=points.length;i<len;i+=2){parsedPoints.push({x:parseFloat(points[i]),y:parseFloat(points[i+1])});}
return parsedPoints;},getCSSRules:function(doc){var styles=doc.getElementsByTagName('style'),i,len,allRules={},rules;for(i=0,len=styles.length;i<len;i++){var styleContents=styles[i].textContent;styleContents=styleContents.replace(/\/\*[\s\S]*?\*\//g,'');if(styleContents.trim()===''){continue;}
rules=styleContents.match(/[^{]*\{[\s\S]*?\}/g);rules=rules.map(function(rule){return rule.trim();});rules.forEach(function(rule){var match=rule.match(/([\s\S]*?)\s*\{([^}]*)\}/),ruleObj={},declaration=match[2].trim(),propertyValuePairs=declaration.replace(/;$/,'').split(/\s*;\s*/);for(i=0,len=propertyValuePairs.length;i<len;i++){var pair=propertyValuePairs[i].split(/\s*:\s*/),property=pair[0],value=pair[1];ruleObj[property]=value;}
rule=match[1];rule.split(',').forEach(function(_rule){_rule=_rule.replace(/^svg/i,'').trim();if(_rule===''){return;}
if(allRules[_rule]){fabric.util.object.extend(allRules[_rule],ruleObj);}
else{allRules[_rule]=fabric.util.object.clone(ruleObj);}});});}
return allRules;},loadSVGFromURL:function(url,callback,reviver,options){url=url.replace(/^\n\s*/,'').trim();new fabric.util.request(url,{method:'get',onComplete:onComplete});function onComplete(r){var xml=r.responseXML;if(!xml||!xml.documentElement){callback&&callback(null);return false;}
fabric.parseSVGDocument(xml.documentElement,function(results,_options,elements,allElements){callback&&callback(results,_options,elements,allElements);},reviver,options);}},loadSVGFromString:function(string,callback,reviver,options){var parser=new fabric.window.DOMParser(),doc=parser.parseFromString(string.trim(),'text/xml');fabric.parseSVGDocument(doc.documentElement,function(results,_options,elements,allElements){callback(results,_options,elements,allElements);},reviver,options);}});})(true?exports:0);fabric.ElementsParser=function(elements,callback,options,reviver,parsingOptions,doc){this.elements=elements;this.callback=callback;this.options=options;this.reviver=reviver;this.svgUid=(options&&options.svgUid)||0;this.parsingOptions=parsingOptions;this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g;this.doc=doc;};(function(proto){proto.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects();};proto.createObjects=function(){var _this=this;this.elements.forEach(function(element,i){element.setAttribute('svgUid',_this.svgUid);_this.createObject(element,i);});};proto.findTag=function(el){return fabric[fabric.util.string.capitalize(el.tagName.replace('svg:',''))];};proto.createObject=function(el,index){var klass=this.findTag(el);if(klass&&klass.fromElement){try{klass.fromElement(el,this.createCallback(index,el),this.options);}
catch(err){fabric.log(err);}}
else{this.checkIfDone();}};proto.createCallback=function(index,el){var _this=this;return function(obj){var _options;_this.resolveGradient(obj,el,'fill');_this.resolveGradient(obj,el,'stroke');if(obj instanceof fabric.Image&&obj._originalElement){_options=obj.parsePreserveAspectRatioAttribute(el);}
obj._removeTransformMatrix(_options);_this.resolveClipPath(obj,el);_this.reviver&&_this.reviver(el,obj);_this.instances[index]=obj;_this.checkIfDone();};};proto.extractPropertyDefinition=function(obj,property,storage){var value=obj[property],regex=this.regexUrl;if(!regex.test(value)){return;}
regex.lastIndex=0;var id=regex.exec(value)[1];regex.lastIndex=0;return fabric[storage][this.svgUid][id];};proto.resolveGradient=function(obj,el,property){var gradientDef=this.extractPropertyDefinition(obj,property,'gradientDefs');if(gradientDef){var opacityAttr=el.getAttribute(property+'-opacity');var gradient=fabric.Gradient.fromElement(gradientDef,obj,opacityAttr,this.options);obj.set(property,gradient);}};proto.createClipPathCallback=function(obj,container){return function(_newObj){_newObj._removeTransformMatrix();_newObj.fillRule=_newObj.clipRule;container.push(_newObj);};};proto.resolveClipPath=function(obj,usingElement){var clipPath=this.extractPropertyDefinition(obj,'clipPath','clipPaths'),element,klass,objTransformInv,container,gTransform,options;if(clipPath){container=[];objTransformInv=fabric.util.invertTransform(obj.calcTransformMatrix());var clipPathTag=clipPath[0].parentNode;var clipPathOwner=usingElement;while(clipPathOwner.parentNode&&clipPathOwner.getAttribute('clip-path')!==obj.clipPath){clipPathOwner=clipPathOwner.parentNode;}
clipPathOwner.parentNode.appendChild(clipPathTag);for(var i=0;i<clipPath.length;i++){element=clipPath[i];klass=this.findTag(element);klass.fromElement(element,this.createClipPathCallback(obj,container),this.options);}
if(container.length===1){clipPath=container[0];}
else{clipPath=new fabric.Group(container);}
gTransform=fabric.util.multiplyTransformMatrices(objTransformInv,clipPath.calcTransformMatrix());if(clipPath.clipPath){this.resolveClipPath(clipPath,clipPathOwner);}
var options=fabric.util.qrDecompose(gTransform);clipPath.flipX=false;clipPath.flipY=false;clipPath.set('scaleX',options.scaleX);clipPath.set('scaleY',options.scaleY);clipPath.angle=options.angle;clipPath.skewX=options.skewX;clipPath.skewY=0;clipPath.setPositionByOrigin({x:options.translateX,y:options.translateY},'center','center');obj.clipPath=clipPath;}
else{delete obj.clipPath;}};proto.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(el){return el!=null;});this.callback(this.instances,this.elements);}};})(fabric.ElementsParser.prototype);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Point){fabric.warn('fabric.Point is already defined');return;}
fabric.Point=Point;function Point(x,y){this.x=x;this.y=y;}
Point.prototype={type:'point',constructor:Point,add:function(that){return new Point(this.x+that.x,this.y+that.y);},addEquals:function(that){this.x+=that.x;this.y+=that.y;return this;},scalarAdd:function(scalar){return new Point(this.x+scalar,this.y+scalar);},scalarAddEquals:function(scalar){this.x+=scalar;this.y+=scalar;return this;},subtract:function(that){return new Point(this.x-that.x,this.y-that.y);},subtractEquals:function(that){this.x-=that.x;this.y-=that.y;return this;},scalarSubtract:function(scalar){return new Point(this.x-scalar,this.y-scalar);},scalarSubtractEquals:function(scalar){this.x-=scalar;this.y-=scalar;return this;},multiply:function(scalar){return new Point(this.x*scalar,this.y*scalar);},multiplyEquals:function(scalar){this.x*=scalar;this.y*=scalar;return this;},divide:function(scalar){return new Point(this.x/scalar,this.y/scalar);},divideEquals:function(scalar){this.x/=scalar;this.y/=scalar;return this;},eq:function(that){return(this.x===that.x&&this.y===that.y);},lt:function(that){return(this.x<that.x&&this.y<that.y);},lte:function(that){return(this.x<=that.x&&this.y<=that.y);},gt:function(that){return(this.x>that.x&&this.y>that.y);},gte:function(that){return(this.x>=that.x&&this.y>=that.y);},lerp:function(that,t){if(typeof t==='undefined'){t=0.5;}
t=Math.max(Math.min(1,t),0);return new Point(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t);},distanceFrom:function(that){var dx=this.x-that.x,dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy);},midPointFrom:function(that){return this.lerp(that);},min:function(that){return new Point(Math.min(this.x,that.x),Math.min(this.y,that.y));},max:function(that){return new Point(Math.max(this.x,that.x),Math.max(this.y,that.y));},toString:function(){return this.x+','+this.y;},setXY:function(x,y){this.x=x;this.y=y;return this;},setX:function(x){this.x=x;return this;},setY:function(y){this.y=y;return this;},setFromPoint:function(that){this.x=that.x;this.y=that.y;return this;},swap:function(that){var x=this.x,y=this.y;this.x=that.x;this.y=that.y;that.x=x;that.y=y;},clone:function(){return new Point(this.x,this.y);}};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Intersection){fabric.warn('fabric.Intersection is already defined');return;}
function Intersection(status){this.status=status;this.points=[];}
fabric.Intersection=Intersection;fabric.Intersection.prototype={constructor:Intersection,appendPoint:function(point){this.points.push(point);return this;},appendPoints:function(points){this.points=this.points.concat(points);return this;}};fabric.Intersection.intersectLineLine=function(a1,a2,b1,b2){var result,uaT=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ubT=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),uB=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(uB!==0){var ua=uaT/uB,ub=ubT/uB;if(0<=ua&&ua<=1&&0<=ub&&ub<=1){result=new Intersection('Intersection');result.appendPoint(new fabric.Point(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y)));}
else{result=new Intersection();}}
else{if(uaT===0||ubT===0){result=new Intersection('Coincident');}
else{result=new Intersection('Parallel');}}
return result;};fabric.Intersection.intersectLinePolygon=function(a1,a2,points){var result=new Intersection(),length=points.length,b1,b2,inter,i;for(i=0;i<length;i++){b1=points[i];b2=points[(i+1)%length];inter=Intersection.intersectLineLine(a1,a2,b1,b2);result.appendPoints(inter.points);}
if(result.points.length>0){result.status='Intersection';}
return result;};fabric.Intersection.intersectPolygonPolygon=function(points1,points2){var result=new Intersection(),length=points1.length,i;for(i=0;i<length;i++){var a1=points1[i],a2=points1[(i+1)%length],inter=Intersection.intersectLinePolygon(a1,a2,points2);result.appendPoints(inter.points);}
if(result.points.length>0){result.status='Intersection';}
return result;};fabric.Intersection.intersectPolygonRectangle=function(points,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new fabric.Point(max.x,min.y),bottomLeft=new fabric.Point(min.x,max.y),inter1=Intersection.intersectLinePolygon(min,topRight,points),inter2=Intersection.intersectLinePolygon(topRight,max,points),inter3=Intersection.intersectLinePolygon(max,bottomLeft,points),inter4=Intersection.intersectLinePolygon(bottomLeft,min,points),result=new Intersection();result.appendPoints(inter1.points);result.appendPoints(inter2.points);result.appendPoints(inter3.points);result.appendPoints(inter4.points);if(result.points.length>0){result.status='Intersection';}
return result;};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Color){fabric.warn('fabric.Color is already defined.');return;}
function Color(color){if(!color){this.setSource([0,0,0,1]);}
else{this._tryParsingColor(color);}}
fabric.Color=Color;fabric.Color.prototype={_tryParsingColor:function(color){var source;if(color in Color.colorNameMap){color=Color.colorNameMap[color];}
if(color==='transparent'){source=[255,255,255,0];}
if(!source){source=Color.sourceFromHex(color);}
if(!source){source=Color.sourceFromRgb(color);}
if(!source){source=Color.sourceFromHsl(color);}
if(!source){source=[0,0,0,1];}
if(source){this.setSource(source);}},_rgbToHsl:function(r,g,b){r/=255;g/=255;b/=255;var h,s,l,max=fabric.util.array.max([r,g,b]),min=fabric.util.array.min([r,g,b]);l=(max+min)/2;if(max===min){h=s=0;}
else{var d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
h/=6;}
return[Math.round(h*360),Math.round(s*100),Math.round(l*100)];},getSource:function(){return this._source;},setSource:function(source){this._source=source;},toRgb:function(){var source=this.getSource();return'rgb('+source[0]+','+source[1]+','+source[2]+')';},toRgba:function(){var source=this.getSource();return'rgba('+source[0]+','+source[1]+','+source[2]+','+source[3]+')';},toHsl:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return'hsl('+hsl[0]+','+hsl[1]+'%,'+hsl[2]+'%)';},toHsla:function(){var source=this.getSource(),hsl=this._rgbToHsl(source[0],source[1],source[2]);return'hsla('+hsl[0]+','+hsl[1]+'%,'+hsl[2]+'%,'+source[3]+')';},toHex:function(){var source=this.getSource(),r,g,b;r=source[0].toString(16);r=(r.length===1)?('0'+r):r;g=source[1].toString(16);g=(g.length===1)?('0'+g):g;b=source[2].toString(16);b=(b.length===1)?('0'+b):b;return r.toUpperCase()+g.toUpperCase()+b.toUpperCase();},toHexa:function(){var source=this.getSource(),a;a=Math.round(source[3]*255);a=a.toString(16);a=(a.length===1)?('0'+a):a;return this.toHex()+a.toUpperCase();},getAlpha:function(){return this.getSource()[3];},setAlpha:function(alpha){var source=this.getSource();source[3]=alpha;this.setSource(source);return this;},toGrayscale:function(){var source=this.getSource(),average=parseInt((source[0]*0.3+source[1]*0.59+source[2]*0.11).toFixed(0),10),currentAlpha=source[3];this.setSource([average,average,average,currentAlpha]);return this;},toBlackWhite:function(threshold){var source=this.getSource(),average=(source[0]*0.3+source[1]*0.59+source[2]*0.11).toFixed(0),currentAlpha=source[3];threshold=threshold||127;average=(Number(average)<Number(threshold))?0:255;this.setSource([average,average,average,currentAlpha]);return this;},overlayWith:function(otherColor){if(!(otherColor instanceof Color)){otherColor=new Color(otherColor);}
var result=[],alpha=this.getAlpha(),otherAlpha=0.5,source=this.getSource(),otherSource=otherColor.getSource(),i;for(i=0;i<3;i++){result.push(Math.round((source[i]*(1-otherAlpha))+(otherSource[i]*otherAlpha)));}
result[3]=alpha;this.setSource(result);return this;}};fabric.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i;fabric.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i;fabric.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;fabric.Color.colorNameMap={aliceblue:'#F0F8FF',antiquewhite:'#FAEBD7',aqua:'#00FFFF',aquamarine:'#7FFFD4',azure:'#F0FFFF',beige:'#F5F5DC',bisque:'#FFE4C4',black:'#000000',blanchedalmond:'#FFEBCD',blue:'#0000FF',blueviolet:'#8A2BE2',brown:'#A52A2A',burlywood:'#DEB887',cadetblue:'#5F9EA0',chartreuse:'#7FFF00',chocolate:'#D2691E',coral:'#FF7F50',cornflowerblue:'#6495ED',cornsilk:'#FFF8DC',crimson:'#DC143C',cyan:'#00FFFF',darkblue:'#00008B',darkcyan:'#008B8B',darkgoldenrod:'#B8860B',darkgray:'#A9A9A9',darkgrey:'#A9A9A9',darkgreen:'#006400',darkkhaki:'#BDB76B',darkmagenta:'#8B008B',darkolivegreen:'#556B2F',darkorange:'#FF8C00',darkorchid:'#9932CC',darkred:'#8B0000',darksalmon:'#E9967A',darkseagreen:'#8FBC8F',darkslateblue:'#483D8B',darkslategray:'#2F4F4F',darkslategrey:'#2F4F4F',darkturquoise:'#00CED1',darkviolet:'#9400D3',deeppink:'#FF1493',deepskyblue:'#00BFFF',dimgray:'#696969',dimgrey:'#696969',dodgerblue:'#1E90FF',firebrick:'#B22222',floralwhite:'#FFFAF0',forestgreen:'#228B22',fuchsia:'#FF00FF',gainsboro:'#DCDCDC',ghostwhite:'#F8F8FF',gold:'#FFD700',goldenrod:'#DAA520',gray:'#808080',grey:'#808080',green:'#008000',greenyellow:'#ADFF2F',honeydew:'#F0FFF0',hotpink:'#FF69B4',indianred:'#CD5C5C',indigo:'#4B0082',ivory:'#FFFFF0',khaki:'#F0E68C',lavender:'#E6E6FA',lavenderblush:'#FFF0F5',lawngreen:'#7CFC00',lemonchiffon:'#FFFACD',lightblue:'#ADD8E6',lightcoral:'#F08080',lightcyan:'#E0FFFF',lightgoldenrodyellow:'#FAFAD2',lightgray:'#D3D3D3',lightgrey:'#D3D3D3',lightgreen:'#90EE90',lightpink:'#FFB6C1',lightsalmon:'#FFA07A',lightseagreen:'#20B2AA',lightskyblue:'#87CEFA',lightslategray:'#778899',lightslategrey:'#778899',lightsteelblue:'#B0C4DE',lightyellow:'#FFFFE0',lime:'#00FF00',limegreen:'#32CD32',linen:'#FAF0E6',magenta:'#FF00FF',maroon:'#800000',mediumaquamarine:'#66CDAA',mediumblue:'#0000CD',mediumorchid:'#BA55D3',mediumpurple:'#9370DB',mediumseagreen:'#3CB371',mediumslateblue:'#7B68EE',mediumspringgreen:'#00FA9A',mediumturquoise:'#48D1CC',mediumvioletred:'#C71585',midnightblue:'#191970',mintcream:'#F5FFFA',mistyrose:'#FFE4E1',moccasin:'#FFE4B5',navajowhite:'#FFDEAD',navy:'#000080',oldlace:'#FDF5E6',olive:'#808000',olivedrab:'#6B8E23',orange:'#FFA500',orangered:'#FF4500',orchid:'#DA70D6',palegoldenrod:'#EEE8AA',palegreen:'#98FB98',paleturquoise:'#AFEEEE',palevioletred:'#DB7093',papayawhip:'#FFEFD5',peachpuff:'#FFDAB9',peru:'#CD853F',pink:'#FFC0CB',plum:'#DDA0DD',powderblue:'#B0E0E6',purple:'#800080',rebeccapurple:'#663399',red:'#FF0000',rosybrown:'#BC8F8F',royalblue:'#4169E1',saddlebrown:'#8B4513',salmon:'#FA8072',sandybrown:'#F4A460',seagreen:'#2E8B57',seashell:'#FFF5EE',sienna:'#A0522D',silver:'#C0C0C0',skyblue:'#87CEEB',slateblue:'#6A5ACD',slategray:'#708090',slategrey:'#708090',snow:'#FFFAFA',springgreen:'#00FF7F',steelblue:'#4682B4',tan:'#D2B48C',teal:'#008080',thistle:'#D8BFD8',tomato:'#FF6347',turquoise:'#40E0D0',violet:'#EE82EE',wheat:'#F5DEB3',white:'#FFFFFF',whitesmoke:'#F5F5F5',yellow:'#FFFF00',yellowgreen:'#9ACD32'};function hue2rgb(p,q,t){if(t<0){t+=1;}
if(t>1){t-=1;}
if(t<1/6){return p+(q-p)*6*t;}
if(t<1/2){return q;}
if(t<2/3){return p+(q-p)*(2/3-t)*6;}
return p;}
fabric.Color.fromRgb=function(color){return Color.fromSource(Color.sourceFromRgb(color));};fabric.Color.sourceFromRgb=function(color){var match=color.match(Color.reRGBa);if(match){var r=parseInt(match[1],10)/(/%$/.test(match[1])?100:1)*(/%$/.test(match[1])?255:1),g=parseInt(match[2],10)/(/%$/.test(match[2])?100:1)*(/%$/.test(match[2])?255:1),b=parseInt(match[3],10)/(/%$/.test(match[3])?100:1)*(/%$/.test(match[3])?255:1);return[parseInt(r,10),parseInt(g,10),parseInt(b,10),match[4]?parseFloat(match[4]):1];}};fabric.Color.fromRgba=Color.fromRgb;fabric.Color.fromHsl=function(color){return Color.fromSource(Color.sourceFromHsl(color));};fabric.Color.sourceFromHsl=function(color){var match=color.match(Color.reHSLa);if(!match){return;}
var h=(((parseFloat(match[1])%360)+360)%360)/360,s=parseFloat(match[2])/(/%$/.test(match[2])?100:1),l=parseFloat(match[3])/(/%$/.test(match[3])?100:1),r,g,b;if(s===0){r=g=b=l;}
else{var q=l<=0.5?l*(s+1):l+s-l*s,p=l*2-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3);}
return[Math.round(r*255),Math.round(g*255),Math.round(b*255),match[4]?parseFloat(match[4]):1];};fabric.Color.fromHsla=Color.fromHsl;fabric.Color.fromHex=function(color){return Color.fromSource(Color.sourceFromHex(color));};fabric.Color.sourceFromHex=function(color){if(color.match(Color.reHex)){var value=color.slice(color.indexOf('#')+1),isShortNotation=(value.length===3||value.length===4),isRGBa=(value.length===8||value.length===4),r=isShortNotation?(value.charAt(0)+value.charAt(0)):value.substring(0,2),g=isShortNotation?(value.charAt(1)+value.charAt(1)):value.substring(2,4),b=isShortNotation?(value.charAt(2)+value.charAt(2)):value.substring(4,6),a=isRGBa?(isShortNotation?(value.charAt(3)+value.charAt(3)):value.substring(6,8)):'FF';return[parseInt(r,16),parseInt(g,16),parseInt(b,16),parseFloat((parseInt(a,16)/255).toFixed(2))];}};fabric.Color.fromSource=function(source){var oColor=new Color();oColor.setSource(source);return oColor;};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),scaleMap=['e','se','s','sw','w','nw','n','ne','e'],skewMap=['ns','nesw','ew','nwse'],controls={},LEFT='left',TOP='top',RIGHT='right',BOTTOM='bottom',CENTER='center',opposite={top:BOTTOM,bottom:TOP,left:RIGHT,right:LEFT,center:CENTER,},radiansToDegrees=fabric.util.radiansToDegrees,sign=(Math.sign||function(x){return((x>0)-(x<0))||+x;});function findCornerQuadrant(fabricObject,control){var cornerAngle=fabricObject.angle+radiansToDegrees(Math.atan2(control.y,control.x))+360;return Math.round((cornerAngle%360)/45);}
function fireEvent(eventName,options){var target=options.transform.target,canvas=target.canvas,canvasOptions=fabric.util.object.clone(options);canvasOptions.target=target;canvas&&canvas.fire('object:'+eventName,canvasOptions);target.fire(eventName,options);}
function scaleIsProportional(eventData,fabricObject){var canvas=fabricObject.canvas,uniScaleKey=canvas.uniScaleKey,uniformIsToggled=eventData[uniScaleKey];return(canvas.uniformScaling&&!uniformIsToggled)||(!canvas.uniformScaling&&uniformIsToggled);}
function isTransformCentered(transform){return transform.originX===CENTER&&transform.originY===CENTER;}
function scalingIsForbidden(fabricObject,by,scaleProportionally){var lockX=fabricObject.lockScalingX,lockY=fabricObject.lockScalingY;if(lockX&&lockY){return true;}
if(!by&&(lockX||lockY)&&scaleProportionally){return true;}
if(lockX&&by==='x'){return true;}
if(lockY&&by==='y'){return true;}
return false;}
function scaleCursorStyleHandler(eventData,control,fabricObject){var notAllowed='not-allowed',scaleProportionally=scaleIsProportional(eventData,fabricObject),by='';if(control.x!==0&&control.y===0){by='x';}
else if(control.x===0&&control.y!==0){by='y';}
if(scalingIsForbidden(fabricObject,by,scaleProportionally)){return notAllowed;}
var n=findCornerQuadrant(fabricObject,control);return scaleMap[n]+'-resize';}
function skewCursorStyleHandler(eventData,control,fabricObject){var notAllowed='not-allowed';if(control.x!==0&&fabricObject.lockSkewingY){return notAllowed;}
if(control.y!==0&&fabricObject.lockSkewingX){return notAllowed;}
var n=findCornerQuadrant(fabricObject,control)%4;return skewMap[n]+'-resize';}
function scaleSkewCursorStyleHandler(eventData,control,fabricObject){if(eventData[fabricObject.canvas.altActionKey]){return controls.skewCursorStyleHandler(eventData,control,fabricObject);}
return controls.scaleCursorStyleHandler(eventData,control,fabricObject);}
function scaleOrSkewActionName(eventData,control,fabricObject){var isAlternative=eventData[fabricObject.canvas.altActionKey];if(control.x===0){return isAlternative?'skewX':'scaleY';}
if(control.y===0){return isAlternative?'skewY':'scaleX';}}
function rotationStyleHandler(eventData,control,fabricObject){if(fabricObject.lockRotation){return'not-allowed';}
return control.cursorStyle;}
function commonEventInfo(eventData,transform,x,y){return{e:eventData,transform:transform,pointer:{x:x,y:y,}};}
function wrapWithFixedAnchor(actionHandler){return function(eventData,transform,x,y){var target=transform.target,centerPoint=target.getCenterPoint(),constraint=target.translateToOriginPoint(centerPoint,transform.originX,transform.originY),actionPerformed=actionHandler(eventData,transform,x,y);target.setPositionByOrigin(constraint,transform.originX,transform.originY);return actionPerformed;};}
function wrapWithFireEvent(eventName,actionHandler){return function(eventData,transform,x,y){var actionPerformed=actionHandler(eventData,transform,x,y);if(actionPerformed){fireEvent(eventName,commonEventInfo(eventData,transform,x,y));}
return actionPerformed;};}
function getLocalPoint(transform,originX,originY,x,y){var target=transform.target,control=target.controls[transform.corner],zoom=target.canvas.getZoom(),padding=target.padding/zoom,localPoint=target.toLocalPoint(new fabric.Point(x,y),originX,originY);if(localPoint.x>=padding){localPoint.x-=padding;}
if(localPoint.x<=-padding){localPoint.x+=padding;}
if(localPoint.y>=padding){localPoint.y-=padding;}
if(localPoint.y<=padding){localPoint.y+=padding;}
localPoint.x-=control.offsetX;localPoint.y-=control.offsetY;return localPoint;}
function targetHasOneFlip(target){return target.flipX!==target.flipY;}
function compensateScaleForSkew(target,oppositeSkew,scaleToCompensate,axis,reference){if(target[oppositeSkew]!==0){var newDim=target._getTransformedDimensions()[axis];var newValue=reference/newDim*target[scaleToCompensate];target.set(scaleToCompensate,newValue);}}
function skewObjectX(eventData,transform,x,y){var target=transform.target,dimNoSkew=target._getTransformedDimensions(0,target.skewY),localPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y),totalSkewSize=Math.abs(localPoint.x*2)-dimNoSkew.x,currentSkew=target.skewX,newSkew;if(totalSkewSize<2){newSkew=0;}
else{newSkew=radiansToDegrees(Math.atan2((totalSkewSize/target.scaleX),(dimNoSkew.y/target.scaleY)));if(transform.originX===LEFT&&transform.originY===BOTTOM){newSkew=-newSkew;}
if(transform.originX===RIGHT&&transform.originY===TOP){newSkew=-newSkew;}
if(targetHasOneFlip(target)){newSkew=-newSkew;}}
var hasSkewed=currentSkew!==newSkew;if(hasSkewed){var dimBeforeSkewing=target._getTransformedDimensions().y;target.set('skewX',newSkew);compensateScaleForSkew(target,'skewY','scaleY','y',dimBeforeSkewing);}
return hasSkewed;}
function skewObjectY(eventData,transform,x,y){var target=transform.target,dimNoSkew=target._getTransformedDimensions(target.skewX,0),localPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y),totalSkewSize=Math.abs(localPoint.y*2)-dimNoSkew.y,currentSkew=target.skewY,newSkew;if(totalSkewSize<2){newSkew=0;}
else{newSkew=radiansToDegrees(Math.atan2((totalSkewSize/target.scaleY),(dimNoSkew.x/target.scaleX)));if(transform.originX===LEFT&&transform.originY===BOTTOM){newSkew=-newSkew;}
if(transform.originX===RIGHT&&transform.originY===TOP){newSkew=-newSkew;}
if(targetHasOneFlip(target)){newSkew=-newSkew;}}
var hasSkewed=currentSkew!==newSkew;if(hasSkewed){var dimBeforeSkewing=target._getTransformedDimensions().x;target.set('skewY',newSkew);compensateScaleForSkew(target,'skewX','scaleX','x',dimBeforeSkewing);}
return hasSkewed;}
function skewHandlerX(eventData,transform,x,y){var target=transform.target,currentSkew=target.skewX,originX,originY=transform.originY;if(target.lockSkewingX){return false;}
if(currentSkew===0){var localPointFromCenter=getLocalPoint(transform,CENTER,CENTER,x,y);if(localPointFromCenter.x>0){originX=LEFT;}
else{originX=RIGHT;}}
else{if(currentSkew>0){originX=originY===TOP?LEFT:RIGHT;}
if(currentSkew<0){originX=originY===TOP?RIGHT:LEFT;}
if(targetHasOneFlip(target)){originX=originX===LEFT?RIGHT:LEFT;}}
transform.originX=originX;var finalHandler=wrapWithFireEvent('skewing',wrapWithFixedAnchor(skewObjectX));return finalHandler(eventData,transform,x,y);}
function skewHandlerY(eventData,transform,x,y){var target=transform.target,currentSkew=target.skewY,originY,originX=transform.originX;if(target.lockSkewingY){return false;}
if(currentSkew===0){var localPointFromCenter=getLocalPoint(transform,CENTER,CENTER,x,y);if(localPointFromCenter.y>0){originY=TOP;}
else{originY=BOTTOM;}}
else{if(currentSkew>0){originY=originX===LEFT?TOP:BOTTOM;}
if(currentSkew<0){originY=originX===LEFT?BOTTOM:TOP;}
if(targetHasOneFlip(target)){originY=originY===TOP?BOTTOM:TOP;}}
transform.originY=originY;var finalHandler=wrapWithFireEvent('skewing',wrapWithFixedAnchor(skewObjectY));return finalHandler(eventData,transform,x,y);}
function rotationWithSnapping(eventData,transform,x,y){var t=transform,target=t.target,pivotPoint=target.translateToOriginPoint(target.getCenterPoint(),t.originX,t.originY);if(target.lockRotation){return false;}
var lastAngle=Math.atan2(t.ey-pivotPoint.y,t.ex-pivotPoint.x),curAngle=Math.atan2(y-pivotPoint.y,x-pivotPoint.x),angle=radiansToDegrees(curAngle-lastAngle+t.theta),hasRotated=true;if(target.snapAngle>0){var snapAngle=target.snapAngle,snapThreshold=target.snapThreshold||snapAngle,rightAngleLocked=Math.ceil(angle/snapAngle)*snapAngle,leftAngleLocked=Math.floor(angle/snapAngle)*snapAngle;if(Math.abs(angle-leftAngleLocked)<snapThreshold){angle=leftAngleLocked;}
else if(Math.abs(angle-rightAngleLocked)<snapThreshold){angle=rightAngleLocked;}}
if(angle<0){angle=360+angle;}
angle%=360;hasRotated=target.angle!==angle;target.angle=angle;return hasRotated;}
function scaleObject(eventData,transform,x,y,options){options=options||{};var target=transform.target,lockScalingX=target.lockScalingX,lockScalingY=target.lockScalingY,by=options.by,newPoint,scaleX,scaleY,dim,scaleProportionally=scaleIsProportional(eventData,target),forbidScaling=scalingIsForbidden(target,by,scaleProportionally),signX,signY,gestureScale=transform.gestureScale;if(forbidScaling){return false;}
if(gestureScale){scaleX=transform.scaleX*gestureScale;scaleY=transform.scaleY*gestureScale;}
else{newPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y);signX=by!=='y'?sign(newPoint.x):1;signY=by!=='x'?sign(newPoint.y):1;if(!transform.signX){transform.signX=signX;}
if(!transform.signY){transform.signY=signY;}
if(target.lockScalingFlip&&(transform.signX!==signX||transform.signY!==signY)){return false;}
dim=target._getTransformedDimensions();if(scaleProportionally&&!by){var distance=Math.abs(newPoint.x)+Math.abs(newPoint.y),original=transform.original,originalDistance=Math.abs(dim.x*original.scaleX/target.scaleX)+
Math.abs(dim.y*original.scaleY/target.scaleY),scale=distance/originalDistance;scaleX=original.scaleX*scale;scaleY=original.scaleY*scale;}
else{scaleX=Math.abs(newPoint.x*target.scaleX/dim.x);scaleY=Math.abs(newPoint.y*target.scaleY/dim.y);}
if(isTransformCentered(transform)){scaleX*=2;scaleY*=2;}
if(transform.signX!==signX&&by!=='y'){transform.originX=opposite[transform.originX];scaleX*=-1;transform.signX=signX;}
if(transform.signY!==signY&&by!=='x'){transform.originY=opposite[transform.originY];scaleY*=-1;transform.signY=signY;}}
var oldScaleX=target.scaleX,oldScaleY=target.scaleY;if(!by){!lockScalingX&&target.set('scaleX',scaleX);!lockScalingY&&target.set('scaleY',scaleY);}
else{by==='x'&&target.set('scaleX',scaleX);by==='y'&&target.set('scaleY',scaleY);}
return oldScaleX!==target.scaleX||oldScaleY!==target.scaleY;}
function scaleObjectFromCorner(eventData,transform,x,y){return scaleObject(eventData,transform,x,y);}
function scaleObjectX(eventData,transform,x,y){return scaleObject(eventData,transform,x,y,{by:'x'});}
function scaleObjectY(eventData,transform,x,y){return scaleObject(eventData,transform,x,y,{by:'y'});}
function scalingYOrSkewingX(eventData,transform,x,y){if(eventData[transform.target.canvas.altActionKey]){return controls.skewHandlerX(eventData,transform,x,y);}
return controls.scalingY(eventData,transform,x,y);}
function scalingXOrSkewingY(eventData,transform,x,y){if(eventData[transform.target.canvas.altActionKey]){return controls.skewHandlerY(eventData,transform,x,y);}
return controls.scalingX(eventData,transform,x,y);}
function changeWidth(eventData,transform,x,y){var target=transform.target,localPoint=getLocalPoint(transform,transform.originX,transform.originY,x,y),strokePadding=target.strokeWidth/(target.strokeUniform?target.scaleX:1),multiplier=isTransformCentered(transform)?2:1,oldWidth=target.width,newWidth=Math.abs(localPoint.x*multiplier/target.scaleX)-strokePadding;target.set('width',Math.max(newWidth,0));return oldWidth!==newWidth;}
function dragHandler(eventData,transform,x,y){var target=transform.target,newLeft=x-transform.offsetX,newTop=y-transform.offsetY,moveX=!target.get('lockMovementX')&&target.left!==newLeft,moveY=!target.get('lockMovementY')&&target.top!==newTop;moveX&&target.set('left',newLeft);moveY&&target.set('top',newTop);if(moveX||moveY){fireEvent('moving',commonEventInfo(eventData,transform,x,y));}
return moveX||moveY;}
controls.scaleCursorStyleHandler=scaleCursorStyleHandler;controls.skewCursorStyleHandler=skewCursorStyleHandler;controls.scaleSkewCursorStyleHandler=scaleSkewCursorStyleHandler;controls.rotationWithSnapping=wrapWithFireEvent('rotating',wrapWithFixedAnchor(rotationWithSnapping));controls.scalingEqually=wrapWithFireEvent('scaling',wrapWithFixedAnchor(scaleObjectFromCorner));controls.scalingX=wrapWithFireEvent('scaling',wrapWithFixedAnchor(scaleObjectX));controls.scalingY=wrapWithFireEvent('scaling',wrapWithFixedAnchor(scaleObjectY));controls.scalingYOrSkewingX=scalingYOrSkewingX;controls.scalingXOrSkewingY=scalingXOrSkewingY;controls.changeWidth=wrapWithFireEvent('resizing',wrapWithFixedAnchor(changeWidth));controls.skewHandlerX=skewHandlerX;controls.skewHandlerY=skewHandlerY;controls.dragHandler=dragHandler;controls.scaleOrSkewActionName=scaleOrSkewActionName;controls.rotationStyleHandler=rotationStyleHandler;controls.fireEvent=fireEvent;controls.wrapWithFixedAnchor=wrapWithFixedAnchor;controls.wrapWithFireEvent=wrapWithFireEvent;controls.getLocalPoint=getLocalPoint;fabric.controlsUtils=controls;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),degreesToRadians=fabric.util.degreesToRadians,controls=fabric.controlsUtils;function renderCircleControl(ctx,left,top,styleOverride,fabricObject){styleOverride=styleOverride||{};var xSize=this.sizeX||styleOverride.cornerSize||fabricObject.cornerSize,ySize=this.sizeY||styleOverride.cornerSize||fabricObject.cornerSize,transparentCorners=typeof styleOverride.transparentCorners!=='undefined'?styleOverride.transparentCorners:fabricObject.transparentCorners,methodName=transparentCorners?'stroke':'fill',stroke=!transparentCorners&&(styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor),myLeft=left,myTop=top,size;ctx.save();ctx.fillStyle=styleOverride.cornerColor||fabricObject.cornerColor;ctx.strokeStyle=styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor;if(xSize>ySize){size=xSize;ctx.scale(1.0,ySize/xSize);myTop=top*xSize/ySize;}
else if(ySize>xSize){size=ySize;ctx.scale(xSize/ySize,1.0);myLeft=left*ySize/xSize;}
else{size=xSize;}
ctx.lineWidth=1;ctx.beginPath();ctx.arc(myLeft,myTop,size/2,0,2*Math.PI,false);ctx[methodName]();if(stroke){ctx.stroke();}
ctx.restore();}
function renderSquareControl(ctx,left,top,styleOverride,fabricObject){styleOverride=styleOverride||{};var xSize=this.sizeX||styleOverride.cornerSize||fabricObject.cornerSize,ySize=this.sizeY||styleOverride.cornerSize||fabricObject.cornerSize,transparentCorners=typeof styleOverride.transparentCorners!=='undefined'?styleOverride.transparentCorners:fabricObject.transparentCorners,methodName=transparentCorners?'stroke':'fill',stroke=!transparentCorners&&(styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor),xSizeBy2=xSize/2,ySizeBy2=ySize/2;ctx.save();ctx.fillStyle=styleOverride.cornerColor||fabricObject.cornerColor;ctx.strokeStyle=styleOverride.cornerStrokeColor||fabricObject.cornerStrokeColor;ctx.lineWidth=1;ctx.translate(left,top);ctx.rotate(degreesToRadians(fabricObject.angle));ctx[methodName+'Rect'](-xSizeBy2,-ySizeBy2,xSize,ySize);if(stroke){ctx.strokeRect(-xSizeBy2,-ySizeBy2,xSize,ySize);}
ctx.restore();}
controls.renderCircleControl=renderCircleControl;controls.renderSquareControl=renderSquareControl;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});function Control(options){for(var i in options){this[i]=options[i];}}
fabric.Control=Control;fabric.Control.prototype={visible:true,actionName:'scale',angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:'crosshair',withConnection:false,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler;},getMouseDownHandler:function(){return this.mouseDownHandler;},getMouseUpHandler:function(){return this.mouseUpHandler;},cursorStyleHandler:function(eventData,control){return control.cursorStyle;},getActionName:function(eventData,control){return control.actionName;},getVisibility:function(fabricObject,controlKey){var objectVisibility=fabricObject._controlsVisibility;if(objectVisibility&&typeof objectVisibility[controlKey]!=='undefined'){return objectVisibility[controlKey];}
return this.visible;},setVisibility:function(visibility){this.visible=visibility;},positionHandler:function(dim,finalMatrix){var point=fabric.util.transformPoint({x:this.x*dim.x+this.offsetX,y:this.y*dim.y+this.offsetY},finalMatrix);return point;},calcCornerCoords:function(objectAngle,objectCornerSize,centerX,centerY,isTouch){var cosHalfOffset,sinHalfOffset,cosHalfOffsetComp,sinHalfOffsetComp,xSize=(isTouch)?this.touchSizeX:this.sizeX,ySize=(isTouch)?this.touchSizeY:this.sizeY;if(xSize&&ySize&&xSize!==ySize){var controlTriangleAngle=Math.atan2(ySize,xSize);var cornerHypotenuse=Math.sqrt(xSize*xSize+ySize*ySize)/2;var newTheta=controlTriangleAngle-fabric.util.degreesToRadians(objectAngle);var newThetaComp=Math.PI/2-controlTriangleAngle-fabric.util.degreesToRadians(objectAngle);cosHalfOffset=cornerHypotenuse*fabric.util.cos(newTheta);sinHalfOffset=cornerHypotenuse*fabric.util.sin(newTheta);cosHalfOffsetComp=cornerHypotenuse*fabric.util.cos(newThetaComp);sinHalfOffsetComp=cornerHypotenuse*fabric.util.sin(newThetaComp);}
else{var cornerSize=(xSize&&ySize)?xSize:objectCornerSize;cornerHypotenuse=cornerSize*0.7071067812;var newTheta=fabric.util.degreesToRadians(45-objectAngle);cosHalfOffset=cosHalfOffsetComp=cornerHypotenuse*fabric.util.cos(newTheta);sinHalfOffset=sinHalfOffsetComp=cornerHypotenuse*fabric.util.sin(newTheta);}
return{tl:{x:centerX-sinHalfOffsetComp,y:centerY-cosHalfOffsetComp,},tr:{x:centerX+cosHalfOffset,y:centerY-sinHalfOffset,},bl:{x:centerX-cosHalfOffset,y:centerY+sinHalfOffset,},br:{x:centerX+sinHalfOffsetComp,y:centerY+cosHalfOffsetComp,},};},render:function(ctx,left,top,styleOverride,fabricObject){styleOverride=styleOverride||{};switch(styleOverride.cornerStyle||fabricObject.cornerStyle){case'circle':fabric.controlsUtils.renderCircleControl.call(this,ctx,left,top,styleOverride,fabricObject);break;default:fabric.controlsUtils.renderSquareControl.call(this,ctx,left,top,styleOverride,fabricObject);}},};})(true?exports:0);(function(){function getColorStop(el,multiplier){var style=el.getAttribute('style'),offset=el.getAttribute('offset')||0,color,colorAlpha,opacity,i;offset=parseFloat(offset)/(/%$/.test(offset)?100:1);offset=offset<0?0:offset>1?1:offset;if(style){var keyValuePairs=style.split(/\s*;\s*/);if(keyValuePairs[keyValuePairs.length-1]===''){keyValuePairs.pop();}
for(i=keyValuePairs.length;i--;){var split=keyValuePairs[i].split(/\s*:\s*/),key=split[0].trim(),value=split[1].trim();if(key==='stop-color'){color=value;}
else if(key==='stop-opacity'){opacity=value;}}}
if(!color){color=el.getAttribute('stop-color')||'rgb(0,0,0)';}
if(!opacity){opacity=el.getAttribute('stop-opacity');}
color=new fabric.Color(color);colorAlpha=color.getAlpha();opacity=isNaN(parseFloat(opacity))?1:parseFloat(opacity);opacity*=colorAlpha*multiplier;return{offset:offset,color:color.toRgb(),opacity:opacity};}
function getLinearCoords(el){return{x1:el.getAttribute('x1')||0,y1:el.getAttribute('y1')||0,x2:el.getAttribute('x2')||'100%',y2:el.getAttribute('y2')||0};}
function getRadialCoords(el){return{x1:el.getAttribute('fx')||el.getAttribute('cx')||'50%',y1:el.getAttribute('fy')||el.getAttribute('cy')||'50%',r1:0,x2:el.getAttribute('cx')||'50%',y2:el.getAttribute('cy')||'50%',r2:el.getAttribute('r')||'50%'};}
var clone=fabric.util.object.clone;fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:'pixels',type:'linear',initialize:function(options){options||(options={});options.coords||(options.coords={});var coords,_this=this;Object.keys(options).forEach(function(option){_this[option]=options[option];});if(this.id){this.id+='_'+fabric.Object.__uid++;}
else{this.id=fabric.Object.__uid++;}
coords={x1:options.coords.x1||0,y1:options.coords.y1||0,x2:options.coords.x2||0,y2:options.coords.y2||0};if(this.type==='radial'){coords.r1=options.coords.r1||0;coords.r2=options.coords.r2||0;}
this.coords=coords;this.colorStops=options.colorStops.slice();},addColorStop:function(colorStops){for(var position in colorStops){var color=new fabric.Color(colorStops[position]);this.colorStops.push({offset:parseFloat(position),color:color.toRgb(),opacity:color.getAlpha()});}
return this;},toObject:function(propertiesToInclude){var object={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};fabric.util.populateWithProperties(this,object,propertiesToInclude);return object;},toSVG:function(object,options){var coords=clone(this.coords,true),i,len,options=options||{},markup,commonAttributes,colorStops=clone(this.colorStops,true),needsSwap=coords.r1>coords.r2,transform=this.gradientTransform?this.gradientTransform.concat():fabric.iMatrix.concat(),offsetX=-this.offsetX,offsetY=-this.offsetY,withViewport=!!options.additionalTransform,gradientUnits=this.gradientUnits==='pixels'?'userSpaceOnUse':'objectBoundingBox';colorStops.sort(function(a,b){return a.offset-b.offset;});if(gradientUnits==='objectBoundingBox'){offsetX/=object.width;offsetY/=object.height;}
else{offsetX+=object.width/2;offsetY+=object.height/2;}
if(object.type==='path'&&this.gradientUnits!=='percentage'){offsetX-=object.pathOffset.x;offsetY-=object.pathOffset.y;}
transform[4]-=offsetX;transform[5]-=offsetY;commonAttributes='id="SVGID_'+this.id+'" gradientUnits="'+gradientUnits+'"';commonAttributes+=' gradientTransform="'+(withViewport?options.additionalTransform+' ':'')+fabric.util.matrixToSVG(transform)+'" ';if(this.type==='linear'){markup=['<linearGradient ',commonAttributes,' x1="',coords.x1,'" y1="',coords.y1,'" x2="',coords.x2,'" y2="',coords.y2,'">\n'];}
else if(this.type==='radial'){markup=['<radialGradient ',commonAttributes,' cx="',needsSwap?coords.x1:coords.x2,'" cy="',needsSwap?coords.y1:coords.y2,'" r="',needsSwap?coords.r1:coords.r2,'" fx="',needsSwap?coords.x2:coords.x1,'" fy="',needsSwap?coords.y2:coords.y1,'">\n'];}
if(this.type==='radial'){if(needsSwap){colorStops=colorStops.concat();colorStops.reverse();for(i=0,len=colorStops.length;i<len;i++){colorStops[i].offset=1-colorStops[i].offset;}}
var minRadius=Math.min(coords.r1,coords.r2);if(minRadius>0){var maxRadius=Math.max(coords.r1,coords.r2),percentageShift=minRadius/maxRadius;for(i=0,len=colorStops.length;i<len;i++){colorStops[i].offset+=percentageShift*(1-colorStops[i].offset);}}}
for(i=0,len=colorStops.length;i<len;i++){var colorStop=colorStops[i];markup.push('<stop ','offset="',(colorStop.offset*100)+'%','" style="stop-color:',colorStop.color,(typeof colorStop.opacity!=='undefined'?';stop-opacity: '+colorStop.opacity:';'),'"/>\n');}
markup.push((this.type==='linear'?'</linearGradient>\n':'</radialGradient>\n'));return markup.join('');},toLive:function(ctx){var gradient,coords=fabric.util.object.clone(this.coords),i,len;if(!this.type){return;}
if(this.type==='linear'){gradient=ctx.createLinearGradient(coords.x1,coords.y1,coords.x2,coords.y2);}
else if(this.type==='radial'){gradient=ctx.createRadialGradient(coords.x1,coords.y1,coords.r1,coords.x2,coords.y2,coords.r2);}
for(i=0,len=this.colorStops.length;i<len;i++){var color=this.colorStops[i].color,opacity=this.colorStops[i].opacity,offset=this.colorStops[i].offset;if(typeof opacity!=='undefined'){color=new fabric.Color(color).setAlpha(opacity).toRgba();}
gradient.addColorStop(offset,color);}
return gradient;}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(el,instance,opacityAttr,svgOptions){var multiplier=parseFloat(opacityAttr)/(/%$/.test(opacityAttr)?100:1);multiplier=multiplier<0?0:multiplier>1?1:multiplier;if(isNaN(multiplier)){multiplier=1;}
var colorStopEls=el.getElementsByTagName('stop'),type,gradientUnits=el.getAttribute('gradientUnits')==='userSpaceOnUse'?'pixels':'percentage',gradientTransform=el.getAttribute('gradientTransform')||'',colorStops=[],coords,i,offsetX=0,offsetY=0,transformMatrix;if(el.nodeName==='linearGradient'||el.nodeName==='LINEARGRADIENT'){type='linear';coords=getLinearCoords(el);}
else{type='radial';coords=getRadialCoords(el);}
for(i=colorStopEls.length;i--;){colorStops.push(getColorStop(colorStopEls[i],multiplier));}
transformMatrix=fabric.parseTransformAttribute(gradientTransform);__convertPercentUnitsToValues(instance,coords,svgOptions,gradientUnits);if(gradientUnits==='pixels'){offsetX=-instance.left;offsetY=-instance.top;}
var gradient=new fabric.Gradient({id:el.getAttribute('id'),type:type,coords:coords,colorStops:colorStops,gradientUnits:gradientUnits,gradientTransform:transformMatrix,offsetX:offsetX,offsetY:offsetY,});return gradient;}});function __convertPercentUnitsToValues(instance,options,svgOptions,gradientUnits){var propValue,finalValue;Object.keys(options).forEach(function(prop){propValue=options[prop];if(propValue==='Infinity'){finalValue=1;}
else if(propValue==='-Infinity'){finalValue=0;}
else{finalValue=parseFloat(options[prop],10);if(typeof propValue==='string'&&/^(\d+\.\d+)%|(\d+)%$/.test(propValue)){finalValue*=0.01;if(gradientUnits==='pixels'){if(prop==='x1'||prop==='x2'||prop==='r2'){finalValue*=svgOptions.viewBoxWidth||svgOptions.width;}
if(prop==='y1'||prop==='y2'){finalValue*=svgOptions.viewBoxHeight||svgOptions.height;}}}}
options[prop]=finalValue;});}})();(function(){'use strict';var toFixed=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:'repeat',offsetX:0,offsetY:0,crossOrigin:'',patternTransform:null,initialize:function(options,callback){options||(options={});this.id=fabric.Object.__uid++;this.setOptions(options);if(!options.source||(options.source&&typeof options.source!=='string')){callback&&callback(this);return;}
else{var _this=this;this.source=fabric.util.createImage();fabric.util.loadImage(options.source,function(img,isError){_this.source=img;callback&&callback(_this,isError);},null,this.crossOrigin);}},toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,source,object;if(typeof this.source.src==='string'){source=this.source.src;}
else if(typeof this.source==='object'&&this.source.toDataURL){source=this.source.toDataURL();}
object={type:'pattern',source:source,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:toFixed(this.offsetX,NUM_FRACTION_DIGITS),offsetY:toFixed(this.offsetY,NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?this.patternTransform.concat():null};fabric.util.populateWithProperties(this,object,propertiesToInclude);return object;},toSVG:function(object){var patternSource=typeof this.source==='function'?this.source():this.source,patternWidth=patternSource.width/object.width,patternHeight=patternSource.height/object.height,patternOffsetX=this.offsetX/object.width,patternOffsetY=this.offsetY/object.height,patternImgSrc='';if(this.repeat==='repeat-x'||this.repeat==='no-repeat'){patternHeight=1;if(patternOffsetY){patternHeight+=Math.abs(patternOffsetY);}}
if(this.repeat==='repeat-y'||this.repeat==='no-repeat'){patternWidth=1;if(patternOffsetX){patternWidth+=Math.abs(patternOffsetX);}}
if(patternSource.src){patternImgSrc=patternSource.src;}
else if(patternSource.toDataURL){patternImgSrc=patternSource.toDataURL();}
return'<pattern id="SVGID_'+this.id+'" x="'+patternOffsetX+'" y="'+patternOffsetY+'" width="'+patternWidth+'" height="'+patternHeight+'">\n'+'<image x="0" y="0"'+' width="'+patternSource.width+'" height="'+patternSource.height+'" xlink:href="'+patternImgSrc+'"></image>\n'+'</pattern>\n';},setOptions:function(options){for(var prop in options){this[prop]=options[prop];}},toLive:function(ctx){var source=this.source;if(!source){return'';}
if(typeof source.src!=='undefined'){if(!source.complete){return'';}
if(source.naturalWidth===0||source.naturalHeight===0){return'';}}
return ctx.createPattern(source,this.repeat);}});})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),toFixed=fabric.util.toFixed;if(fabric.Shadow){fabric.warn('fabric.Shadow is already defined.');return;}
fabric.Shadow=fabric.util.createClass({color:'rgb(0,0,0)',blur:0,offsetX:0,offsetY:0,affectStroke:false,includeDefaultValues:true,nonScaling:false,initialize:function(options){if(typeof options==='string'){options=this._parseShadow(options);}
for(var prop in options){this[prop]=options[prop];}
this.id=fabric.Object.__uid++;},_parseShadow:function(shadow){var shadowStr=shadow.trim(),offsetsAndBlur=fabric.Shadow.reOffsetsAndBlur.exec(shadowStr)||[],color=shadowStr.replace(fabric.Shadow.reOffsetsAndBlur,'')||'rgb(0,0,0)';return{color:color.trim(),offsetX:parseFloat(offsetsAndBlur[1],10)||0,offsetY:parseFloat(offsetsAndBlur[2],10)||0,blur:parseFloat(offsetsAndBlur[3],10)||0};},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join('px ');},toSVG:function(object){var fBoxX=40,fBoxY=40,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,offset=fabric.util.rotateVector({x:this.offsetX,y:this.offsetY},fabric.util.degreesToRadians(-object.angle)),BLUR_BOX=20,color=new fabric.Color(this.color);if(object.width&&object.height){fBoxX=toFixed((Math.abs(offset.x)+this.blur)/object.width,NUM_FRACTION_DIGITS)*100+BLUR_BOX;fBoxY=toFixed((Math.abs(offset.y)+this.blur)/object.height,NUM_FRACTION_DIGITS)*100+BLUR_BOX;}
if(object.flipX){offset.x*=-1;}
if(object.flipY){offset.y*=-1;}
return('<filter id="SVGID_'+this.id+'" y="-'+fBoxY+'%" height="'+(100+2*fBoxY)+'%" '+'x="-'+fBoxX+'%" width="'+(100+2*fBoxX)+'%" '+'>\n'+'\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+
toFixed(this.blur?this.blur/2:0,NUM_FRACTION_DIGITS)+'"></feGaussianBlur>\n'+'\t<feOffset dx="'+toFixed(offset.x,NUM_FRACTION_DIGITS)+'" dy="'+toFixed(offset.y,NUM_FRACTION_DIGITS)+'" result="oBlur" ></feOffset>\n'+'\t<feFlood flood-color="'+color.toRgb()+'" flood-opacity="'+color.getAlpha()+'"/>\n'+'\t<feComposite in2="oBlur" operator="in" />\n'+'\t<feMerge>\n'+'\t\t<feMergeNode></feMergeNode>\n'+'\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n'+'\t</feMerge>\n'+'</filter>\n');},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};}
var obj={},proto=fabric.Shadow.prototype;['color','blur','offsetX','offsetY','affectStroke','nonScaling'].forEach(function(prop){if(this[prop]!==proto[prop]){obj[prop]=this[prop];}},this);return obj;}});fabric.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/;})(true?exports:0);(function(){'use strict';if(fabric.StaticCanvas){fabric.warn('fabric.StaticCanvas is already defined.');return;}
var extend=fabric.util.object.extend,getElementOffset=fabric.util.getElementOffset,removeFromArray=fabric.util.removeFromArray,toFixed=fabric.util.toFixed,transformPoint=fabric.util.transformPoint,invertTransform=fabric.util.invertTransform,getNodeCanvas=fabric.util.getNodeCanvas,createCanvasElement=fabric.util.createCanvasElement,CANVAS_INIT_ERROR=new Error('Could not initialize `canvas` element');fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(el,options){options||(options={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(el,options);},backgroundColor:'',backgroundImage:null,overlayColor:'',overlayImage:null,includeDefaultValues:true,stateful:false,renderOnAddRemove:true,controlsAboveOverlay:false,allowTouchScrolling:false,imageSmoothingEnabled:true,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:true,overlayVpt:true,enableRetinaScaling:true,vptCoords:{},skipOffscreen:true,clipPath:undefined,_initStatic:function(el,options){var cb=this.requestRenderAllBound;this._objects=[];this._createLowerCanvas(el);this._initOptions(options);if(!this.interactive){this._initRetinaScaling();}
if(options.overlayImage){this.setOverlayImage(options.overlayImage,cb);}
if(options.backgroundImage){this.setBackgroundImage(options.backgroundImage,cb);}
if(options.backgroundColor){this.setBackgroundColor(options.backgroundColor,cb);}
if(options.overlayColor){this.setOverlayColor(options.overlayColor,cb);}
this.calcOffset();},_isRetinaScaling:function(){return(fabric.devicePixelRatio!==1&&this.enableRetinaScaling);},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1;},_initRetinaScaling:function(){if(!this._isRetinaScaling()){return;}
var scaleRatio=fabric.devicePixelRatio;this.__initRetinaScaling(scaleRatio,this.lowerCanvasEl,this.contextContainer);if(this.upperCanvasEl){this.__initRetinaScaling(scaleRatio,this.upperCanvasEl,this.contextTop);}},__initRetinaScaling:function(scaleRatio,canvas,context){canvas.setAttribute('width',this.width*scaleRatio);canvas.setAttribute('height',this.height*scaleRatio);context.scale(scaleRatio,scaleRatio);},calcOffset:function(){this._offset=getElementOffset(this.lowerCanvasEl);return this;},setOverlayImage:function(image,callback,options){return this.__setBgOverlayImage('overlayImage',image,callback,options);},setBackgroundImage:function(image,callback,options){return this.__setBgOverlayImage('backgroundImage',image,callback,options);},setOverlayColor:function(overlayColor,callback){return this.__setBgOverlayColor('overlayColor',overlayColor,callback);},setBackgroundColor:function(backgroundColor,callback){return this.__setBgOverlayColor('backgroundColor',backgroundColor,callback);},__setBgOverlayImage:function(property,image,callback,options){if(typeof image==='string'){fabric.util.loadImage(image,function(img,isError){if(img){var instance=new fabric.Image(img,options);this[property]=instance;instance.canvas=this;}
callback&&callback(img,isError);},this,options&&options.crossOrigin);}
else{options&&image.setOptions(options);this[property]=image;image&&(image.canvas=this);callback&&callback(image,false);}
return this;},__setBgOverlayColor:function(property,color,callback){this[property]=color;this._initGradient(color,property);this._initPattern(color,property,callback);return this;},_createCanvasElement:function(){var element=createCanvasElement();if(!element){throw CANVAS_INIT_ERROR;}
if(!element.style){element.style={};}
if(typeof element.getContext==='undefined'){throw CANVAS_INIT_ERROR;}
return element;},_initOptions:function(options){var lowerCanvasEl=this.lowerCanvasEl;this._setOptions(options);this.width=this.width||parseInt(lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return;}
lowerCanvasEl.width=this.width;lowerCanvasEl.height=this.height;lowerCanvasEl.style.width=this.width+'px';lowerCanvasEl.style.height=this.height+'px';this.viewportTransform=this.viewportTransform.slice();},_createLowerCanvas:function(canvasEl){if(canvasEl&&canvasEl.getContext){this.lowerCanvasEl=canvasEl;}
else{this.lowerCanvasEl=fabric.util.getById(canvasEl)||this._createCanvasElement();}
fabric.util.addClass(this.lowerCanvasEl,'lower-canvas');this._originalCanvasStyle=this.lowerCanvasEl.style;if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl);}
this.contextContainer=this.lowerCanvasEl.getContext('2d');},getWidth:function(){return this.width;},getHeight:function(){return this.height;},setWidth:function(value,options){return this.setDimensions({width:value},options);},setHeight:function(value,options){return this.setDimensions({height:value},options);},setDimensions:function(dimensions,options){var cssValue;options=options||{};for(var prop in dimensions){cssValue=dimensions[prop];if(!options.cssOnly){this._setBackstoreDimension(prop,dimensions[prop]);cssValue+='px';this.hasLostContext=true;}
if(!options.backstoreOnly){this._setCssDimension(prop,cssValue);}}
if(this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles();}
this._initRetinaScaling();this.calcOffset();if(!options.cssOnly){this.requestRenderAll();}
return this;},_setBackstoreDimension:function(prop,value){this.lowerCanvasEl[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl[prop]=value;}
if(this.cacheCanvasEl){this.cacheCanvasEl[prop]=value;}
this[prop]=value;return this;},_setCssDimension:function(prop,value){this.lowerCanvasEl.style[prop]=value;if(this.upperCanvasEl){this.upperCanvasEl.style[prop]=value;}
if(this.wrapperEl){this.wrapperEl.style[prop]=value;}
return this;},getZoom:function(){return this.viewportTransform[0];},setViewportTransform:function(vpt){var activeObject=this._activeObject,backgroundObject=this.backgroundImage,overlayObject=this.overlayImage,object,i,len;this.viewportTransform=vpt;for(i=0,len=this._objects.length;i<len;i++){object=this._objects[i];object.group||object.setCoords(true);}
if(activeObject){activeObject.setCoords();}
if(backgroundObject){backgroundObject.setCoords(true);}
if(overlayObject){overlayObject.setCoords(true);}
this.calcViewportBoundaries();this.renderOnAddRemove&&this.requestRenderAll();return this;},zoomToPoint:function(point,value){var before=point,vpt=this.viewportTransform.slice(0);point=transformPoint(point,invertTransform(this.viewportTransform));vpt[0]=value;vpt[3]=value;var after=transformPoint(point,vpt);vpt[4]+=before.x-after.x;vpt[5]+=before.y-after.y;return this.setViewportTransform(vpt);},setZoom:function(value){this.zoomToPoint(new fabric.Point(0,0),value);return this;},absolutePan:function(point){var vpt=this.viewportTransform.slice(0);vpt[4]=-point.x;vpt[5]=-point.y;return this.setViewportTransform(vpt);},relativePan:function(point){return this.absolutePan(new fabric.Point(-point.x-this.viewportTransform[4],-point.y-this.viewportTransform[5]));},getElement:function(){return this.lowerCanvasEl;},_onObjectAdded:function(obj){this.stateful&&obj.setupState();obj._set('canvas',this);obj.setCoords();this.fire('object:added',{target:obj});obj.fire('added');},_onObjectRemoved:function(obj){this.fire('object:removed',{target:obj});obj.fire('removed');delete obj.canvas;},clearContext:function(ctx){ctx.clearRect(0,0,this.width,this.height);return this;},getContext:function(){return this.contextContainer;},clear:function(){this.remove.apply(this,this.getObjects());this.backgroundImage=null;this.overlayImage=null;this.backgroundColor='';this.overlayColor='';if(this._hasITextHandlers){this.off('mouse:up',this._mouseUpITextHandler);this._iTextInstances=null;this._hasITextHandlers=false;}
this.clearContext(this.contextContainer);this.fire('canvas:cleared');this.renderOnAddRemove&&this.requestRenderAll();return this;},renderAll:function(){var canvasToDrawOn=this.contextContainer;this.renderCanvas(canvasToDrawOn,this._objects);return this;},renderAndReset:function(){this.isRendering=0;this.renderAll();},requestRenderAll:function(){if(!this.isRendering){this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound);}
return this;},calcViewportBoundaries:function(){var points={},width=this.width,height=this.height,iVpt=invertTransform(this.viewportTransform);points.tl=transformPoint({x:0,y:0},iVpt);points.br=transformPoint({x:width,y:height},iVpt);points.tr=new fabric.Point(points.br.x,points.tl.y);points.bl=new fabric.Point(points.tl.x,points.br.y);this.vptCoords=points;return points;},cancelRequestedRender:function(){if(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0;}},renderCanvas:function(ctx,objects){var v=this.viewportTransform,path=this.clipPath;this.cancelRequestedRender();this.calcViewportBoundaries();this.clearContext(ctx);fabric.util.setImageSmoothing(ctx,this.imageSmoothingEnabled);this.fire('before:render',{ctx:ctx,});this._renderBackground(ctx);ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);this._renderObjects(ctx,objects);ctx.restore();if(!this.controlsAboveOverlay&&this.interactive){this.drawControls(ctx);}
if(path){path.canvas=this;path.shouldCache();path._transformDone=true;path.renderCache({forClipping:true});this.drawClipPathOnCanvas(ctx);}
this._renderOverlay(ctx);if(this.controlsAboveOverlay&&this.interactive){this.drawControls(ctx);}
this.fire('after:render',{ctx:ctx,});},drawClipPathOnCanvas:function(ctx){var v=this.viewportTransform,path=this.clipPath;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);ctx.globalCompositeOperation='destination-in';path.transform(ctx);ctx.scale(1/path.zoomX,1/path.zoomY);ctx.drawImage(path._cacheCanvas,-path.cacheTranslationX,-path.cacheTranslationY);ctx.restore();},_renderObjects:function(ctx,objects){var i,len;for(i=0,len=objects.length;i<len;++i){objects[i]&&objects[i].render(ctx);}},_renderBackgroundOrOverlay:function(ctx,property){var fill=this[property+'Color'],object=this[property+'Image'],v=this.viewportTransform,needsVpt=this[property+'Vpt'];if(!fill&&!object){return;}
if(fill){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(this.width,0);ctx.lineTo(this.width,this.height);ctx.lineTo(0,this.height);ctx.closePath();ctx.fillStyle=fill.toLive?fill.toLive(ctx,this):fill;if(needsVpt){ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);}
ctx.transform(1,0,0,1,fill.offsetX||0,fill.offsetY||0);var m=fill.gradientTransform||fill.patternTransform;m&&ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]);ctx.fill();ctx.restore();}
if(object){ctx.save();if(needsVpt){ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);}
object.render(ctx);ctx.restore();}},_renderBackground:function(ctx){this._renderBackgroundOrOverlay(ctx,'background');},_renderOverlay:function(ctx){this._renderBackgroundOrOverlay(ctx,'overlay');},getCenter:function(){return{top:this.height/2,left:this.width/2};},centerObjectH:function(object){return this._centerObject(object,new fabric.Point(this.getCenter().left,object.getCenterPoint().y));},centerObjectV:function(object){return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,this.getCenter().top));},centerObject:function(object){var center=this.getCenter();return this._centerObject(object,new fabric.Point(center.left,center.top));},viewportCenterObject:function(object){var vpCenter=this.getVpCenter();return this._centerObject(object,vpCenter);},viewportCenterObjectH:function(object){var vpCenter=this.getVpCenter();this._centerObject(object,new fabric.Point(vpCenter.x,object.getCenterPoint().y));return this;},viewportCenterObjectV:function(object){var vpCenter=this.getVpCenter();return this._centerObject(object,new fabric.Point(object.getCenterPoint().x,vpCenter.y));},getVpCenter:function(){var center=this.getCenter(),iVpt=invertTransform(this.viewportTransform);return transformPoint({x:center.left,y:center.top},iVpt);},_centerObject:function(object,center){object.setPositionByOrigin(center,'center','center');object.setCoords();this.renderOnAddRemove&&this.requestRenderAll();return this;},toDatalessJSON:function(propertiesToInclude){return this.toDatalessObject(propertiesToInclude);},toObject:function(propertiesToInclude){return this._toObjectMethod('toObject',propertiesToInclude);},toDatalessObject:function(propertiesToInclude){return this._toObjectMethod('toDatalessObject',propertiesToInclude);},_toObjectMethod:function(methodName,propertiesToInclude){var clipPath=this.clipPath,data={version:fabric.version,objects:this._toObjects(methodName,propertiesToInclude),};if(clipPath&&!clipPath.excludeFromExport){data.clipPath=this._toObject(this.clipPath,methodName,propertiesToInclude);}
extend(data,this.__serializeBgOverlay(methodName,propertiesToInclude));fabric.util.populateWithProperties(this,data,propertiesToInclude);return data;},_toObjects:function(methodName,propertiesToInclude){return this._objects.filter(function(object){return!object.excludeFromExport;}).map(function(instance){return this._toObject(instance,methodName,propertiesToInclude);},this);},_toObject:function(instance,methodName,propertiesToInclude){var originalValue;if(!this.includeDefaultValues){originalValue=instance.includeDefaultValues;instance.includeDefaultValues=false;}
var object=instance[methodName](propertiesToInclude);if(!this.includeDefaultValues){instance.includeDefaultValues=originalValue;}
return object;},__serializeBgOverlay:function(methodName,propertiesToInclude){var data={},bgImage=this.backgroundImage,overlayImage=this.overlayImage,bgColor=this.backgroundColor,overlayColor=this.overlayColor;if(bgColor&&bgColor.toObject){if(!bgColor.excludeFromExport){data.background=bgColor.toObject(propertiesToInclude);}}
else if(bgColor){data.background=bgColor;}
if(overlayColor&&overlayColor.toObject){if(!overlayColor.excludeFromExport){data.overlay=overlayColor.toObject(propertiesToInclude);}}
else if(overlayColor){data.overlay=overlayColor;}
if(bgImage&&!bgImage.excludeFromExport){data.backgroundImage=this._toObject(bgImage,methodName,propertiesToInclude);}
if(overlayImage&&!overlayImage.excludeFromExport){data.overlayImage=this._toObject(overlayImage,methodName,propertiesToInclude);}
return data;},svgViewportTransformation:true,toSVG:function(options,reviver){options||(options={});options.reviver=reviver;var markup=[];this._setSVGPreamble(markup,options);this._setSVGHeader(markup,options);if(this.clipPath){markup.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n');}
this._setSVGBgOverlayColor(markup,'background');this._setSVGBgOverlayImage(markup,'backgroundImage',reviver);this._setSVGObjects(markup,reviver);if(this.clipPath){markup.push('</g>\n');}
this._setSVGBgOverlayColor(markup,'overlay');this._setSVGBgOverlayImage(markup,'overlayImage',reviver);markup.push('</svg>');return markup.join('');},_setSVGPreamble:function(markup,options){if(options.suppressPreamble){return;}
markup.push('<?xml version="1.0" encoding="',(options.encoding||'UTF-8'),'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n');},_setSVGHeader:function(markup,options){var width=options.width||this.width,height=options.height||this.height,vpt,viewBox='viewBox="0 0 '+this.width+' '+this.height+'" ',NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(options.viewBox){viewBox='viewBox="'+
options.viewBox.x+' '+
options.viewBox.y+' '+
options.viewBox.width+' '+
options.viewBox.height+'" ';}
else{if(this.svgViewportTransformation){vpt=this.viewportTransform;viewBox='viewBox="'+
toFixed(-vpt[4]/vpt[0],NUM_FRACTION_DIGITS)+' '+
toFixed(-vpt[5]/vpt[3],NUM_FRACTION_DIGITS)+' '+
toFixed(this.width/vpt[0],NUM_FRACTION_DIGITS)+' '+
toFixed(this.height/vpt[3],NUM_FRACTION_DIGITS)+'" ';}}
markup.push('<svg ','xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',width,'" ','height="',height,'" ',viewBox,'xml:space="preserve">\n','<desc>Created with Fabric.js ',fabric.version,'</desc>\n','<defs>\n',this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(options),'</defs>\n');},createSVGClipPathMarkup:function(options){var clipPath=this.clipPath;if(clipPath){clipPath.clipPathId='CLIPPATH_'+fabric.Object.__uid++;return'<clipPath id="'+clipPath.clipPathId+'" >\n'+
this.clipPath.toClipPathSVG(options.reviver)+'</clipPath>\n';}
return'';},createSVGRefElementsMarkup:function(){var _this=this,markup=['background','overlay'].map(function(prop){var fill=_this[prop+'Color'];if(fill&&fill.toLive){var shouldTransform=_this[prop+'Vpt'],vpt=_this.viewportTransform,object={width:_this.width/(shouldTransform?vpt[0]:1),height:_this.height/(shouldTransform?vpt[3]:1)};return fill.toSVG(object,{additionalTransform:shouldTransform?fabric.util.matrixToSVG(vpt):''});}});return markup.join('');},createSVGFontFacesMarkup:function(){var markup='',fontList={},obj,fontFamily,style,row,rowIndex,_char,charIndex,i,len,fontPaths=fabric.fontPaths,objects=[];this._objects.forEach(function add(object){objects.push(object);if(object._objects){object._objects.forEach(add);}});for(i=0,len=objects.length;i<len;i++){obj=objects[i];fontFamily=obj.fontFamily;if(obj.type.indexOf('text')===-1||fontList[fontFamily]||!fontPaths[fontFamily]){continue;}
fontList[fontFamily]=true;if(!obj.styles){continue;}
style=obj.styles;for(rowIndex in style){row=style[rowIndex];for(charIndex in row){_char=row[charIndex];fontFamily=_char.fontFamily;if(!fontList[fontFamily]&&fontPaths[fontFamily]){fontList[fontFamily]=true;}}}}
for(var j in fontList){markup+=['\t\t@font-face {\n','\t\t\tfont-family: \'',j,'\';\n','\t\t\tsrc: url(\'',fontPaths[j],'\');\n','\t\t}\n'].join('');}
if(markup){markup=['\t<style type="text/css">','<![CDATA[\n',markup,']]>','</style>\n'].join('');}
return markup;},_setSVGObjects:function(markup,reviver){var instance,i,len,objects=this._objects;for(i=0,len=objects.length;i<len;i++){instance=objects[i];if(instance.excludeFromExport){continue;}
this._setSVGObject(markup,instance,reviver);}},_setSVGObject:function(markup,instance,reviver){markup.push(instance.toSVG(reviver));},_setSVGBgOverlayImage:function(markup,property,reviver){if(this[property]&&!this[property].excludeFromExport&&this[property].toSVG){markup.push(this[property].toSVG(reviver));}},_setSVGBgOverlayColor:function(markup,property){var filler=this[property+'Color'],vpt=this.viewportTransform,finalWidth=this.width,finalHeight=this.height;if(!filler){return;}
if(filler.toLive){var repeat=filler.repeat,iVpt=fabric.util.invertTransform(vpt),shouldInvert=this[property+'Vpt'],additionalTransform=shouldInvert?fabric.util.matrixToSVG(iVpt):'';markup.push('<rect transform="'+additionalTransform+' translate(',finalWidth/2,',',finalHeight/2,')"',' x="',filler.offsetX-finalWidth/2,'" y="',filler.offsetY-finalHeight/2,'" ','width="',(repeat==='repeat-y'||repeat==='no-repeat'?filler.source.width:finalWidth),'" height="',(repeat==='repeat-x'||repeat==='no-repeat'?filler.source.height:finalHeight),'" fill="url(#SVGID_'+filler.id+')"','></rect>\n');}
else{markup.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',filler,'"','></rect>\n');}},sendToBack:function(object){if(!object){return this;}
var activeSelection=this._activeObject,i,obj,objs;if(object===activeSelection&&object.type==='activeSelection'){objs=activeSelection._objects;for(i=objs.length;i--;){obj=objs[i];removeFromArray(this._objects,obj);this._objects.unshift(obj);}}
else{removeFromArray(this._objects,object);this._objects.unshift(object);}
this.renderOnAddRemove&&this.requestRenderAll();return this;},bringToFront:function(object){if(!object){return this;}
var activeSelection=this._activeObject,i,obj,objs;if(object===activeSelection&&object.type==='activeSelection'){objs=activeSelection._objects;for(i=0;i<objs.length;i++){obj=objs[i];removeFromArray(this._objects,obj);this._objects.push(obj);}}
else{removeFromArray(this._objects,object);this._objects.push(object);}
this.renderOnAddRemove&&this.requestRenderAll();return this;},sendBackwards:function(object,intersecting){if(!object){return this;}
var activeSelection=this._activeObject,i,obj,idx,newIdx,objs,objsMoved=0;if(object===activeSelection&&object.type==='activeSelection'){objs=activeSelection._objects;for(i=0;i<objs.length;i++){obj=objs[i];idx=this._objects.indexOf(obj);if(idx>0+objsMoved){newIdx=idx-1;removeFromArray(this._objects,obj);this._objects.splice(newIdx,0,obj);}
objsMoved++;}}
else{idx=this._objects.indexOf(object);if(idx!==0){newIdx=this._findNewLowerIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object);}}
this.renderOnAddRemove&&this.requestRenderAll();return this;},_findNewLowerIndex:function(object,idx,intersecting){var newIdx,i;if(intersecting){newIdx=idx;for(i=idx-1;i>=0;--i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break;}}}
else{newIdx=idx-1;}
return newIdx;},bringForward:function(object,intersecting){if(!object){return this;}
var activeSelection=this._activeObject,i,obj,idx,newIdx,objs,objsMoved=0;if(object===activeSelection&&object.type==='activeSelection'){objs=activeSelection._objects;for(i=objs.length;i--;){obj=objs[i];idx=this._objects.indexOf(obj);if(idx<this._objects.length-1-objsMoved){newIdx=idx+1;removeFromArray(this._objects,obj);this._objects.splice(newIdx,0,obj);}
objsMoved++;}}
else{idx=this._objects.indexOf(object);if(idx!==this._objects.length-1){newIdx=this._findNewUpperIndex(object,idx,intersecting);removeFromArray(this._objects,object);this._objects.splice(newIdx,0,object);}}
this.renderOnAddRemove&&this.requestRenderAll();return this;},_findNewUpperIndex:function(object,idx,intersecting){var newIdx,i,len;if(intersecting){newIdx=idx;for(i=idx+1,len=this._objects.length;i<len;++i){var isIntersecting=object.intersectsWithObject(this._objects[i])||object.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(object);if(isIntersecting){newIdx=i;break;}}}
else{newIdx=idx+1;}
return newIdx;},moveTo:function(object,index){removeFromArray(this._objects,object);this._objects.splice(index,0,object);return this.renderOnAddRemove&&this.requestRenderAll();},dispose:function(){if(this.isRendering){fabric.util.cancelAnimFrame(this.isRendering);this.isRendering=0;}
this.forEachObject(function(object){object.dispose&&object.dispose();});this._objects=[];if(this.backgroundImage&&this.backgroundImage.dispose){this.backgroundImage.dispose();}
this.backgroundImage=null;if(this.overlayImage&&this.overlayImage.dispose){this.overlayImage.dispose();}
this.overlayImage=null;this._iTextInstances=null;this.contextContainer=null;this.lowerCanvasEl.classList.remove('lower-canvas');this.lowerCanvasEl.style=this._originalCanvasStyle;delete this._originalCanvasStyle;this.lowerCanvasEl.setAttribute('width',this.width);this.lowerCanvasEl.setAttribute('height',this.height);fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);this.lowerCanvasEl=undefined;return this;},toString:function(){return'#<fabric.Canvas ('+this.complexity()+'): '+'{ objects: '+this._objects.length+' }>';}});extend(fabric.StaticCanvas.prototype,fabric.Observable);extend(fabric.StaticCanvas.prototype,fabric.Collection);extend(fabric.StaticCanvas.prototype,fabric.DataURLExporter);extend(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(methodName){var el=createCanvasElement();if(!el||!el.getContext){return null;}
var ctx=el.getContext('2d');if(!ctx){return null;}
switch(methodName){case'setLineDash':return typeof ctx.setLineDash!=='undefined';default:return null;}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject;if(fabric.isLikelyNode){fabric.StaticCanvas.prototype.createPNGStream=function(){var impl=getNodeCanvas(this.lowerCanvasEl);return impl&&impl.createPNGStream();};fabric.StaticCanvas.prototype.createJPEGStream=function(opts){var impl=getNodeCanvas(this.lowerCanvasEl);return impl&&impl.createJPEGStream(opts);};}})();fabric.BaseBrush=fabric.util.createClass({color:'rgb(0, 0, 0)',width:1,shadow:null,strokeLineCap:'round',strokeLineJoin:'round',strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:false,_setBrushStyles:function(){var ctx=this.canvas.contextTop;ctx.strokeStyle=this.color;ctx.lineWidth=this.width;ctx.lineCap=this.strokeLineCap;ctx.miterLimit=this.strokeMiterLimit;ctx.lineJoin=this.strokeLineJoin;ctx.setLineDash(this.strokeDashArray||[]);},_saveAndTransform:function(ctx){var v=this.canvas.viewportTransform;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);},_setShadow:function(){if(!this.shadow){return;}
var canvas=this.canvas,shadow=this.shadow,ctx=canvas.contextTop,zoom=canvas.getZoom();if(canvas&&canvas._isRetinaScaling()){zoom*=fabric.devicePixelRatio;}
ctx.shadowColor=shadow.color;ctx.shadowBlur=shadow.blur*zoom;ctx.shadowOffsetX=shadow.offsetX*zoom;ctx.shadowOffsetY=shadow.offsetY*zoom;},needsFullRender:function(){var color=new fabric.Color(this.color);return color.getAlpha()<1||!!this.shadow;},_resetShadow:function(){var ctx=this.canvas.contextTop;ctx.shadowColor='';ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0;},_isOutSideCanvas:function(pointer){return pointer.x<0||pointer.x>this.canvas.getWidth()||pointer.y<0||pointer.y>this.canvas.getHeight();}});(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{decimate:0.4,initialize:function(canvas){this.canvas=canvas;this._points=[];},_drawSegment:function(ctx,p1,p2){var midPoint=p1.midPointFrom(p2);ctx.quadraticCurveTo(p1.x,p1.y,midPoint.x,midPoint.y);return midPoint;},onMouseDown:function(pointer,options){if(!this.canvas._isMainEvent(options.e)){return;}
this._prepareForDrawing(pointer);this._captureDrawingPath(pointer);this._render();},onMouseMove:function(pointer,options){if(!this.canvas._isMainEvent(options.e)){return;}
if(this.limitedToCanvasSize===true&&this._isOutSideCanvas(pointer)){return;}
if(this._captureDrawingPath(pointer)&&this._points.length>1){if(this.needsFullRender()){this.canvas.clearContext(this.canvas.contextTop);this._render();}
else{var points=this._points,length=points.length,ctx=this.canvas.contextTop;this._saveAndTransform(ctx);if(this.oldEnd){ctx.beginPath();ctx.moveTo(this.oldEnd.x,this.oldEnd.y);}
this.oldEnd=this._drawSegment(ctx,points[length-2],points[length-1],true);ctx.stroke();ctx.restore();}}},onMouseUp:function(options){if(!this.canvas._isMainEvent(options.e)){return true;}
this.oldEnd=undefined;this._finalizeAndAddPath();return false;},_prepareForDrawing:function(pointer){var p=new fabric.Point(pointer.x,pointer.y);this._reset();this._addPoint(p);this.canvas.contextTop.moveTo(p.x,p.y);},_addPoint:function(point){if(this._points.length>1&&point.eq(this._points[this._points.length-1])){return false;}
this._points.push(point);return true;},_reset:function(){this._points=[];this._setBrushStyles();this._setShadow();},_captureDrawingPath:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y);return this._addPoint(pointerPoint);},_render:function(){var ctx=this.canvas.contextTop,i,len,p1=this._points[0],p2=this._points[1];this._saveAndTransform(ctx);ctx.beginPath();if(this._points.length===2&&p1.x===p2.x&&p1.y===p2.y){var width=this.width/1000;p1=new fabric.Point(p1.x,p1.y);p2=new fabric.Point(p2.x,p2.y);p1.x-=width;p2.x+=width;}
ctx.moveTo(p1.x,p1.y);for(i=1,len=this._points.length;i<len;i++){this._drawSegment(ctx,p1,p2);p1=this._points[i];p2=this._points[i+1];}
ctx.lineTo(p1.x,p1.y);ctx.stroke();ctx.restore();},convertPointsToSVGPath:function(points){var correction=this.width/1000;return fabric.util.getSmoothPathFromPoints(points,correction);},_isEmptySVGPath:function(pathData){var pathString=fabric.util.joinPath(pathData);return pathString==='M 0 0 Q 0 0 0 0 L 0 0';},createPath:function(pathData){var path=new fabric.Path(pathData,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,});if(this.shadow){this.shadow.affectStroke=true;path.shadow=new fabric.Shadow(this.shadow);}
return path;},decimatePoints:function(points,distance){if(points.length<=2){return points;}
var zoom=this.canvas.getZoom(),adjustedDistance=Math.pow(distance/zoom,2),i,l=points.length-1,lastPoint=points[0],newPoints=[lastPoint],cDistance;for(i=1;i<l-1;i++){cDistance=Math.pow(lastPoint.x-points[i].x,2)+Math.pow(lastPoint.y-points[i].y,2);if(cDistance>=adjustedDistance){lastPoint=points[i];newPoints.push(lastPoint);}}
newPoints.push(points[l]);return newPoints;},_finalizeAndAddPath:function(){var ctx=this.canvas.contextTop;ctx.closePath();if(this.decimate){this._points=this.decimatePoints(this._points,this.decimate);}
var pathData=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(pathData)){this.canvas.requestRenderAll();return;}
var path=this.createPath(pathData);this.canvas.clearContext(this.canvas.contextTop);this.canvas.fire('before:path:created',{path:path});this.canvas.add(path);this.canvas.requestRenderAll();path.setCoords();this._resetShadow();this.canvas.fire('path:created',{path:path});}});})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(canvas){this.canvas=canvas;this.points=[];},drawDot:function(pointer){var point=this.addPoint(pointer),ctx=this.canvas.contextTop;this._saveAndTransform(ctx);this.dot(ctx,point);ctx.restore();},dot:function(ctx,point){ctx.fillStyle=point.fill;ctx.beginPath();ctx.arc(point.x,point.y,point.radius,0,Math.PI*2,false);ctx.closePath();ctx.fill();},onMouseDown:function(pointer){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(pointer);},_render:function(){var ctx=this.canvas.contextTop,i,len,points=this.points;this._saveAndTransform(ctx);for(i=0,len=points.length;i<len;i++){this.dot(ctx,points[i]);}
ctx.restore();},onMouseMove:function(pointer){if(this.limitedToCanvasSize===true&&this._isOutSideCanvas(pointer)){return;}
if(this.needsFullRender()){this.canvas.clearContext(this.canvas.contextTop);this.addPoint(pointer);this._render();}
else{this.drawDot(pointer);}},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove,i,len;this.canvas.renderOnAddRemove=false;var circles=[];for(i=0,len=this.points.length;i<len;i++){var point=this.points[i],circle=new fabric.Circle({radius:point.radius,left:point.x,top:point.y,originX:'center',originY:'center',fill:point.fill});this.shadow&&(circle.shadow=new fabric.Shadow(this.shadow));circles.push(circle);}
var group=new fabric.Group(circles);group.canvas=this.canvas;this.canvas.fire('before:path:created',{path:group});this.canvas.add(group);this.canvas.fire('path:created',{path:group});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=originalRenderOnAddRemove;this.canvas.requestRenderAll();},addPoint:function(pointer){var pointerPoint=new fabric.Point(pointer.x,pointer.y),circleRadius=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,circleColor=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();pointerPoint.radius=circleRadius;pointerPoint.fill=circleColor;this.points.push(pointerPoint);return pointerPoint;}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,optimizeOverlapping:true,initialize:function(canvas){this.canvas=canvas;this.sprayChunks=[];},onMouseDown:function(pointer){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(pointer);this.render(this.sprayChunkPoints);},onMouseMove:function(pointer){if(this.limitedToCanvasSize===true&&this._isOutSideCanvas(pointer)){return;}
this.addSprayChunk(pointer);this.render(this.sprayChunkPoints);},onMouseUp:function(){var originalRenderOnAddRemove=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var rects=[];for(var i=0,ilen=this.sprayChunks.length;i<ilen;i++){var sprayChunk=this.sprayChunks[i];for(var j=0,jlen=sprayChunk.length;j<jlen;j++){var rect=new fabric.Rect({width:sprayChunk[j].width,height:sprayChunk[j].width,left:sprayChunk[j].x+1,top:sprayChunk[j].y+1,originX:'center',originY:'center',fill:this.color});rects.push(rect);}}
if(this.optimizeOverlapping){rects=this._getOptimizedRects(rects);}
var group=new fabric.Group(rects);this.shadow&&group.set('shadow',new fabric.Shadow(this.shadow));this.canvas.fire('before:path:created',{path:group});this.canvas.add(group);this.canvas.fire('path:created',{path:group});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=originalRenderOnAddRemove;this.canvas.requestRenderAll();},_getOptimizedRects:function(rects){var uniqueRects={},key,i,len;for(i=0,len=rects.length;i<len;i++){key=rects[i].left+''+rects[i].top;if(!uniqueRects[key]){uniqueRects[key]=rects[i];}}
var uniqueRectsArray=[];for(key in uniqueRects){uniqueRectsArray.push(uniqueRects[key]);}
return uniqueRectsArray;},render:function(sprayChunk){var ctx=this.canvas.contextTop,i,len;ctx.fillStyle=this.color;this._saveAndTransform(ctx);for(i=0,len=sprayChunk.length;i<len;i++){var point=sprayChunk[i];if(typeof point.opacity!=='undefined'){ctx.globalAlpha=point.opacity;}
ctx.fillRect(point.x,point.y,point.width,point.width);}
ctx.restore();},_render:function(){var ctx=this.canvas.contextTop,i,ilen;ctx.fillStyle=this.color;this._saveAndTransform(ctx);for(i=0,ilen=this.sprayChunks.length;i<ilen;i++){this.render(this.sprayChunks[i]);}
ctx.restore();},addSprayChunk:function(pointer){this.sprayChunkPoints=[];var x,y,width,radius=this.width/2,i;for(i=0;i<this.density;i++){x=fabric.util.getRandomInt(pointer.x-radius,pointer.x+radius);y=fabric.util.getRandomInt(pointer.y-radius,pointer.y+radius);if(this.dotWidthVariance){width=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance);}
else{width=this.dotWidth;}
var point=new fabric.Point(x,y);point.width=width;if(this.randomOpacity){point.opacity=fabric.util.getRandomInt(0,100)/100;}
this.sprayChunkPoints.push(point);}
this.sprayChunks.push(this.sprayChunkPoints);}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var dotWidth=20,dotDistance=5,patternCanvas=fabric.util.createCanvasElement(),patternCtx=patternCanvas.getContext('2d');patternCanvas.width=patternCanvas.height=dotWidth+dotDistance;patternCtx.fillStyle=this.color;patternCtx.beginPath();patternCtx.arc(dotWidth/2,dotWidth/2,dotWidth/2,0,Math.PI*2,false);patternCtx.closePath();patternCtx.fill();return patternCanvas;},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace('this.color','"'+this.color+'"');},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),'repeat');},_setBrushStyles:function(){this.callSuper('_setBrushStyles');this.canvas.contextTop.strokeStyle=this.getPattern();},createPath:function(pathData){var path=this.callSuper('createPath',pathData),topLeft=path._getLeftTopCoords().scalarAdd(path.strokeWidth/2);path.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-topLeft.x,offsetY:-topLeft.y});return path;}});(function(){var getPointer=fabric.util.getPointer,degreesToRadians=fabric.util.degreesToRadians,isTouchEvent=fabric.util.isTouchEvent;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(el,options){options||(options={});this.renderAndResetBound=this.renderAndReset.bind(this);this.requestRenderAllBound=this.requestRenderAll.bind(this);this._initStatic(el,options);this._initInteractive();this._createCacheCanvas();},uniformScaling:true,uniScaleKey:'shiftKey',centeredScaling:false,centeredRotation:false,centeredKey:'altKey',altActionKey:'shiftKey',interactive:true,selection:true,selectionKey:'shiftKey',altSelectionKey:null,selectionColor:'rgba(100, 100, 255, 0.3)',selectionDashArray:[],selectionBorderColor:'rgba(255, 255, 255, 0.3)',selectionLineWidth:1,selectionFullyContained:false,hoverCursor:'move',moveCursor:'move',defaultCursor:'default',freeDrawingCursor:'crosshair',rotationCursor:'crosshair',notAllowedCursor:'not-allowed',containerClass:'canvas-container',perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,isDrawingMode:false,preserveObjectStacking:false,snapAngle:0,snapThreshold:null,stopContextMenu:false,fireRightClick:false,fireMiddleClick:false,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset();},_chooseObjectsToRender:function(){var activeObjects=this.getActiveObjects(),object,objsToRender,activeGroupObjects;if(activeObjects.length>0&&!this.preserveObjectStacking){objsToRender=[];activeGroupObjects=[];for(var i=0,length=this._objects.length;i<length;i++){object=this._objects[i];if(activeObjects.indexOf(object)===-1){objsToRender.push(object);}
else{activeGroupObjects.push(object);}}
if(activeObjects.length>1){this._activeObject._objects=activeGroupObjects;}
objsToRender.push.apply(objsToRender,activeGroupObjects);}
else{objsToRender=this._objects;}
return objsToRender;},renderAll:function(){if(this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode){this.clearContext(this.contextTop);this.contextTopDirty=false;}
if(this.hasLostContext){this.renderTopLayer(this.contextTop);}
var canvasToDrawOn=this.contextContainer;this.renderCanvas(canvasToDrawOn,this._chooseObjectsToRender());return this;},renderTopLayer:function(ctx){ctx.save();if(this.isDrawingMode&&this._isCurrentlyDrawing){this.freeDrawingBrush&&this.freeDrawingBrush._render();this.contextTopDirty=true;}
if(this.selection&&this._groupSelector){this._drawSelection(ctx);this.contextTopDirty=true;}
ctx.restore();},renderTop:function(){var ctx=this.contextTop;this.clearContext(ctx);this.renderTopLayer(ctx);this.fire('after:render');return this;},_normalizePointer:function(object,pointer){var m=object.calcTransformMatrix(),invertedM=fabric.util.invertTransform(m),vptPointer=this.restorePointerVpt(pointer);return fabric.util.transformPoint(vptPointer,invertedM);},isTargetTransparent:function(target,x,y){if(target.shouldCache()&&target._cacheCanvas&&target!==this._activeObject){var normalizedPointer=this._normalizePointer(target,{x:x,y:y}),targetRelativeX=Math.max(target.cacheTranslationX+(normalizedPointer.x*target.zoomX),0),targetRelativeY=Math.max(target.cacheTranslationY+(normalizedPointer.y*target.zoomY),0);var isTransparent=fabric.util.isTransparent(target._cacheContext,Math.round(targetRelativeX),Math.round(targetRelativeY),this.targetFindTolerance);return isTransparent;}
var ctx=this.contextCache,originalColor=target.selectionBackgroundColor,v=this.viewportTransform;target.selectionBackgroundColor='';this.clearContext(ctx);ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);target.render(ctx);ctx.restore();target.selectionBackgroundColor=originalColor;var isTransparent=fabric.util.isTransparent(ctx,x,y,this.targetFindTolerance);return isTransparent;},_isSelectionKeyPressed:function(e){var selectionKeyPressed=false;if(Object.prototype.toString.call(this.selectionKey)==='[object Array]'){selectionKeyPressed=!!this.selectionKey.find(function(key){return e[key]===true;});}
else{selectionKeyPressed=e[this.selectionKey];}
return selectionKeyPressed;},_shouldClearSelection:function(e,target){var activeObjects=this.getActiveObjects(),activeObject=this._activeObject;return(!target||(target&&activeObject&&activeObjects.length>1&&activeObjects.indexOf(target)===-1&&activeObject!==target&&!this._isSelectionKeyPressed(e))||(target&&!target.evented)||(target&&!target.selectable&&activeObject&&activeObject!==target));},_shouldCenterTransform:function(target,action,altKey){if(!target){return;}
var centerTransform;if(action==='scale'||action==='scaleX'||action==='scaleY'||action==='resizing'){centerTransform=this.centeredScaling||target.centeredScaling;}
else if(action==='rotate'){centerTransform=this.centeredRotation||target.centeredRotation;}
return centerTransform?!altKey:altKey;},_getOriginFromCorner:function(target,corner){var origin={x:target.originX,y:target.originY};if(corner==='ml'||corner==='tl'||corner==='bl'){origin.x='right';}
else if(corner==='mr'||corner==='tr'||corner==='br'){origin.x='left';}
if(corner==='tl'||corner==='mt'||corner==='tr'){origin.y='bottom';}
else if(corner==='bl'||corner==='mb'||corner==='br'){origin.y='top';}
return origin;},_getActionFromCorner:function(alreadySelected,corner,e,target){if(!corner||!alreadySelected){return'drag';}
var control=target.controls[corner];return control.getActionName(e,control,target);},_setupCurrentTransform:function(e,target,alreadySelected){if(!target){return;}
var pointer=this.getPointer(e),corner=target.__corner,control=target.controls[corner],actionHandler=(alreadySelected&&corner)?control.getActionHandler(e,target,control):fabric.controlsUtils.dragHandler,action=this._getActionFromCorner(alreadySelected,corner,e,target),origin=this._getOriginFromCorner(target,corner),altKey=e[this.centeredKey],transform={target:target,action:action,actionHandler:actionHandler,corner:corner,scaleX:target.scaleX,scaleY:target.scaleY,skewX:target.skewX,skewY:target.skewY,offsetX:pointer.x-target.left,offsetY:pointer.y-target.top,originX:origin.x,originY:origin.y,ex:pointer.x,ey:pointer.y,lastX:pointer.x,lastY:pointer.y,theta:degreesToRadians(target.angle),width:target.width*target.scaleX,shiftKey:e.shiftKey,altKey:altKey,original:fabric.util.saveObjectTransform(target),};if(this._shouldCenterTransform(target,action,altKey)){transform.originX='center';transform.originY='center';}
transform.original.originX=origin.x;transform.original.originY=origin.y;this._currentTransform=transform;this._beforeTransform(e);},setCursor:function(value){this.upperCanvasEl.style.cursor=value;},_drawSelection:function(ctx){var selector=this._groupSelector,viewportStart=new fabric.Point(selector.ex,selector.ey),start=fabric.util.transformPoint(viewportStart,this.viewportTransform),viewportExtent=new fabric.Point(selector.ex+selector.left,selector.ey+selector.top),extent=fabric.util.transformPoint(viewportExtent,this.viewportTransform),minX=Math.min(start.x,extent.x),minY=Math.min(start.y,extent.y),maxX=Math.max(start.x,extent.x),maxY=Math.max(start.y,extent.y),strokeOffset=this.selectionLineWidth/2;if(this.selectionColor){ctx.fillStyle=this.selectionColor;ctx.fillRect(minX,minY,maxX-minX,maxY-minY);}
if(!this.selectionLineWidth||!this.selectionBorderColor){return;}
ctx.lineWidth=this.selectionLineWidth;ctx.strokeStyle=this.selectionBorderColor;minX+=strokeOffset;minY+=strokeOffset;maxX-=strokeOffset;maxY-=strokeOffset;fabric.Object.prototype._setLineDash.call(this,ctx,this.selectionDashArray);ctx.strokeRect(minX,minY,maxX-minX,maxY-minY);},findTarget:function(e,skipGroup){if(this.skipTargetFind){return;}
var ignoreZoom=true,pointer=this.getPointer(e,ignoreZoom),activeObject=this._activeObject,aObjects=this.getActiveObjects(),activeTarget,activeTargetSubs,isTouch=isTouchEvent(e),shouldLookForActive=(aObjects.length>1&&!skipGroup)||aObjects.length===1;this.targets=[];if(shouldLookForActive&&activeObject._findTargetCorner(pointer,isTouch)){return activeObject;}
if(aObjects.length>1&&!skipGroup&&activeObject===this._searchPossibleTargets([activeObject],pointer)){return activeObject;}
if(aObjects.length===1&&activeObject===this._searchPossibleTargets([activeObject],pointer)){if(!this.preserveObjectStacking){return activeObject;}
else{activeTarget=activeObject;activeTargetSubs=this.targets;this.targets=[];}}
var target=this._searchPossibleTargets(this._objects,pointer);if(e[this.altSelectionKey]&&target&&activeTarget&&target!==activeTarget){target=activeTarget;this.targets=activeTargetSubs;}
return target;},_checkTarget:function(pointer,obj,globalPointer){if(obj&&obj.visible&&obj.evented&&obj.containsPoint(pointer)){if((this.perPixelTargetFind||obj.perPixelTargetFind)&&!obj.isEditing){var isTransparent=this.isTargetTransparent(obj,globalPointer.x,globalPointer.y);if(!isTransparent){return true;}}
else{return true;}}},_searchPossibleTargets:function(objects,pointer){var target,i=objects.length,subTarget;while(i--){var objToCheck=objects[i];var pointerToUse=objToCheck.group?this._normalizePointer(objToCheck.group,pointer):pointer;if(this._checkTarget(pointerToUse,objToCheck,pointer)){target=objects[i];if(target.subTargetCheck&&target instanceof fabric.Group){subTarget=this._searchPossibleTargets(target._objects,pointer);subTarget&&this.targets.push(subTarget);}
break;}}
return target;},restorePointerVpt:function(pointer){return fabric.util.transformPoint(pointer,fabric.util.invertTransform(this.viewportTransform));},getPointer:function(e,ignoreZoom){if(this._absolutePointer&&!ignoreZoom){return this._absolutePointer;}
if(this._pointer&&ignoreZoom){return this._pointer;}
var pointer=getPointer(e),upperCanvasEl=this.upperCanvasEl,bounds=upperCanvasEl.getBoundingClientRect(),boundsWidth=bounds.width||0,boundsHeight=bounds.height||0,cssScale;if(!boundsWidth||!boundsHeight){if('top'in bounds&&'bottom'in bounds){boundsHeight=Math.abs(bounds.top-bounds.bottom);}
if('right'in bounds&&'left'in bounds){boundsWidth=Math.abs(bounds.right-bounds.left);}}
this.calcOffset();pointer.x=pointer.x-this._offset.left;pointer.y=pointer.y-this._offset.top;if(!ignoreZoom){pointer=this.restorePointerVpt(pointer);}
var retinaScaling=this.getRetinaScaling();if(retinaScaling!==1){pointer.x/=retinaScaling;pointer.y/=retinaScaling;}
if(boundsWidth===0||boundsHeight===0){cssScale={width:1,height:1};}
else{cssScale={width:upperCanvasEl.width/boundsWidth,height:upperCanvasEl.height/boundsHeight};}
return{x:pointer.x*cssScale.width,y:pointer.y*cssScale.height};},_createUpperCanvas:function(){var lowerCanvasClass=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,''),lowerCanvasEl=this.lowerCanvasEl,upperCanvasEl=this.upperCanvasEl;if(upperCanvasEl){upperCanvasEl.className='';}
else{upperCanvasEl=this._createCanvasElement();this.upperCanvasEl=upperCanvasEl;}
fabric.util.addClass(upperCanvasEl,'upper-canvas '+lowerCanvasClass);this.wrapperEl.appendChild(upperCanvasEl);this._copyCanvasStyle(lowerCanvasEl,upperCanvasEl);this._applyCanvasStyle(upperCanvasEl);this.contextTop=upperCanvasEl.getContext('2d');},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute('width',this.width);this.cacheCanvasEl.setAttribute('height',this.height);this.contextCache=this.cacheCanvasEl.getContext('2d');},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,'div',{'class':this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.width+'px',height:this.height+'px',position:'relative'});fabric.util.makeElementUnselectable(this.wrapperEl);},_applyCanvasStyle:function(element){var width=this.width||element.width,height=this.height||element.height;fabric.util.setStyle(element,{position:'absolute',width:width+'px',height:height+'px',left:0,top:0,'touch-action':this.allowTouchScrolling?'manipulation':'none','-ms-touch-action':this.allowTouchScrolling?'manipulation':'none'});element.width=width;element.height=height;fabric.util.makeElementUnselectable(element);},_copyCanvasStyle:function(fromEl,toEl){toEl.style.cssText=fromEl.style.cssText;},getSelectionContext:function(){return this.contextTop;},getSelectionElement:function(){return this.upperCanvasEl;},getActiveObject:function(){return this._activeObject;},getActiveObjects:function(){var active=this._activeObject;if(active){if(active.type==='activeSelection'&&active._objects){return active._objects.slice(0);}
else{return[active];}}
return[];},_onObjectRemoved:function(obj){if(obj===this._activeObject){this.fire('before:selection:cleared',{target:obj});this._discardActiveObject();this.fire('selection:cleared',{target:obj});obj.fire('deselected');}
if(obj===this._hoveredTarget){this._hoveredTarget=null;this._hoveredTargets=[];}
this.callSuper('_onObjectRemoved',obj);},_fireSelectionEvents:function(oldObjects,e){var somethingChanged=false,objects=this.getActiveObjects(),added=[],removed=[];oldObjects.forEach(function(oldObject){if(objects.indexOf(oldObject)===-1){somethingChanged=true;oldObject.fire('deselected',{e:e,target:oldObject});removed.push(oldObject);}});objects.forEach(function(object){if(oldObjects.indexOf(object)===-1){somethingChanged=true;object.fire('selected',{e:e,target:object});added.push(object);}});if(oldObjects.length>0&&objects.length>0){somethingChanged&&this.fire('selection:updated',{e:e,selected:added,deselected:removed,updated:added[0]||removed[0],target:this._activeObject,});}
else if(objects.length>0){this.fire('selection:created',{e:e,selected:added,target:this._activeObject,});}
else if(oldObjects.length>0){this.fire('selection:cleared',{e:e,deselected:removed,});}},setActiveObject:function(object,e){var currentActives=this.getActiveObjects();this._setActiveObject(object,e);this._fireSelectionEvents(currentActives,e);return this;},_setActiveObject:function(object,e){if(this._activeObject===object){return false;}
if(!this._discardActiveObject(e,object)){return false;}
if(object.onSelect({e:e})){return false;}
this._activeObject=object;return true;},_discardActiveObject:function(e,object){var obj=this._activeObject;if(obj){if(obj.onDeselect({e:e,object:object})){return false;}
this._activeObject=null;}
return true;},discardActiveObject:function(e){var currentActives=this.getActiveObjects(),activeObject=this.getActiveObject();if(currentActives.length){this.fire('before:selection:cleared',{target:activeObject,e:e});}
this._discardActiveObject(e);this._fireSelectionEvents(currentActives,e);return this;},dispose:function(){var wrapper=this.wrapperEl;this.removeListeners();wrapper.removeChild(this.upperCanvasEl);wrapper.removeChild(this.lowerCanvasEl);this.contextCache=null;this.contextTop=null;['upperCanvasEl','cacheCanvasEl'].forEach((function(element){fabric.util.cleanUpJsdomNode(this[element]);this[element]=undefined;}).bind(this));if(wrapper.parentNode){wrapper.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl);}
delete this.wrapperEl;fabric.StaticCanvas.prototype.dispose.call(this);return this;},clear:function(){this.discardActiveObject();this.clearContext(this.contextTop);return this.callSuper('clear');},drawControls:function(ctx){var activeObject=this._activeObject;if(activeObject){activeObject._renderControls(ctx);}},_toObject:function(instance,methodName,propertiesToInclude){var originalProperties=this._realizeGroupTransformOnObject(instance),object=this.callSuper('_toObject',instance,methodName,propertiesToInclude);this._unwindGroupTransformOnObject(instance,originalProperties);return object;},_realizeGroupTransformOnObject:function(instance){if(instance.group&&instance.group.type==='activeSelection'&&this._activeObject===instance.group){var layoutProps=['angle','flipX','flipY','left','scaleX','scaleY','skewX','skewY','top'];var originalValues={};layoutProps.forEach(function(prop){originalValues[prop]=instance[prop];});fabric.util.addTransformToObject(instance,this._activeObject.calcOwnMatrix());return originalValues;}
else{return null;}},_unwindGroupTransformOnObject:function(instance,originalValues){if(originalValues){instance.set(originalValues);}},_setSVGObject:function(markup,instance,reviver){var originalProperties=this._realizeGroupTransformOnObject(instance);this.callSuper('_setSVGObject',markup,instance,reviver);this._unwindGroupTransformOnObject(instance,originalProperties);},setViewportTransform:function(vpt){if(this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing){this._activeObject.clearContextTop();}
fabric.StaticCanvas.prototype.setViewportTransform.call(this,vpt);}});for(var prop in fabric.StaticCanvas){if(prop!=='prototype'){fabric.Canvas[prop]=fabric.StaticCanvas[prop];}}})();(function(){var addListener=fabric.util.addListener,removeListener=fabric.util.removeListener,RIGHT_CLICK=3,MIDDLE_CLICK=2,LEFT_CLICK=1,addEventOptions={passive:false};function checkClick(e,value){return e.button&&(e.button===value-1);}
fabric.util.object.extend(fabric.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners();this._bindEvents();this.addOrRemove(addListener,'add');},_getEventPrefix:function(){return this.enablePointerEvents?'pointer':'mouse';},addOrRemove:function(functor,eventjsFunctor){var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();functor(fabric.window,'resize',this._onResize);functor(canvasElement,eventTypePrefix+'down',this._onMouseDown);functor(canvasElement,eventTypePrefix+'move',this._onMouseMove,addEventOptions);functor(canvasElement,eventTypePrefix+'out',this._onMouseOut);functor(canvasElement,eventTypePrefix+'enter',this._onMouseEnter);functor(canvasElement,'wheel',this._onMouseWheel);functor(canvasElement,'contextmenu',this._onContextMenu);functor(canvasElement,'dblclick',this._onDoubleClick);functor(canvasElement,'dragover',this._onDragOver);functor(canvasElement,'dragenter',this._onDragEnter);functor(canvasElement,'dragleave',this._onDragLeave);functor(canvasElement,'drop',this._onDrop);if(!this.enablePointerEvents){functor(canvasElement,'touchstart',this._onTouchStart,addEventOptions);}
if(typeof eventjs!=='undefined'&&eventjsFunctor in eventjs){eventjs[eventjsFunctor](canvasElement,'gesture',this._onGesture);eventjs[eventjsFunctor](canvasElement,'drag',this._onDrag);eventjs[eventjsFunctor](canvasElement,'orientation',this._onOrientationChange);eventjs[eventjsFunctor](canvasElement,'shake',this._onShake);eventjs[eventjsFunctor](canvasElement,'longpress',this._onLongPress);}},removeListeners:function(){this.addOrRemove(removeListener,'remove');var eventTypePrefix=this._getEventPrefix();removeListener(fabric.document,eventTypePrefix+'up',this._onMouseUp);removeListener(fabric.document,'touchend',this._onTouchEnd,addEventOptions);removeListener(fabric.document,eventTypePrefix+'move',this._onMouseMove,addEventOptions);removeListener(fabric.document,'touchmove',this._onMouseMove,addEventOptions);},_bindEvents:function(){if(this.eventsBound){return;}
this._onMouseDown=this._onMouseDown.bind(this);this._onTouchStart=this._onTouchStart.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onTouchEnd=this._onTouchEnd.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this);this._onMouseOut=this._onMouseOut.bind(this);this._onMouseEnter=this._onMouseEnter.bind(this);this._onContextMenu=this._onContextMenu.bind(this);this._onDoubleClick=this._onDoubleClick.bind(this);this._onDragOver=this._onDragOver.bind(this);this._onDragEnter=this._simpleEventHandler.bind(this,'dragenter');this._onDragLeave=this._simpleEventHandler.bind(this,'dragleave');this._onDrop=this._simpleEventHandler.bind(this,'drop');this.eventsBound=true;},_onGesture:function(e,self){this.__onTransformGesture&&this.__onTransformGesture(e,self);},_onDrag:function(e,self){this.__onDrag&&this.__onDrag(e,self);},_onMouseWheel:function(e){this.__onMouseWheel(e);},_onMouseOut:function(e){var target=this._hoveredTarget;this.fire('mouse:out',{target:target,e:e});this._hoveredTarget=null;target&&target.fire('mouseout',{e:e});var _this=this;this._hoveredTargets.forEach(function(_target){_this.fire('mouse:out',{target:target,e:e});_target&&target.fire('mouseout',{e:e});});this._hoveredTargets=[];if(this._iTextInstances){this._iTextInstances.forEach(function(obj){if(obj.isEditing){obj.hiddenTextarea.focus();}});}},_onMouseEnter:function(e){if(!this._currentTransform&&!this.findTarget(e)){this.fire('mouse:over',{target:null,e:e});this._hoveredTarget=null;this._hoveredTargets=[];}},_onOrientationChange:function(e,self){this.__onOrientationChange&&this.__onOrientationChange(e,self);},_onShake:function(e,self){this.__onShake&&this.__onShake(e,self);},_onLongPress:function(e,self){this.__onLongPress&&this.__onLongPress(e,self);},_onDragOver:function(e){e.preventDefault();var target=this._simpleEventHandler('dragover',e);this._fireEnterLeaveEvents(target,e);},_onContextMenu:function(e){if(this.stopContextMenu){e.stopPropagation();e.preventDefault();}
return false;},_onDoubleClick:function(e){this._cacheTransformEventData(e);this._handleEvent(e,'dblclick');this._resetTransformEventData(e);},getPointerId:function(evt){var changedTouches=evt.changedTouches;if(changedTouches){return changedTouches[0]&&changedTouches[0].identifier;}
if(this.enablePointerEvents){return evt.pointerId;}
return-1;},_isMainEvent:function(evt){if(evt.isPrimary===true){return true;}
if(evt.isPrimary===false){return false;}
if(evt.type==='touchend'&&evt.touches.length===0){return true;}
if(evt.changedTouches){return evt.changedTouches[0].identifier===this.mainTouchId;}
return true;},_onTouchStart:function(e){e.preventDefault();if(this.mainTouchId===null){this.mainTouchId=this.getPointerId(e);}
this.__onMouseDown(e);this._resetTransformEventData();var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();addListener(fabric.document,'touchend',this._onTouchEnd,addEventOptions);addListener(fabric.document,'touchmove',this._onMouseMove,addEventOptions);removeListener(canvasElement,eventTypePrefix+'down',this._onMouseDown);},_onMouseDown:function(e){this.__onMouseDown(e);this._resetTransformEventData();var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();removeListener(canvasElement,eventTypePrefix+'move',this._onMouseMove,addEventOptions);addListener(fabric.document,eventTypePrefix+'up',this._onMouseUp);addListener(fabric.document,eventTypePrefix+'move',this._onMouseMove,addEventOptions);},_onTouchEnd:function(e){if(e.touches.length>0){return;}
this.__onMouseUp(e);this._resetTransformEventData();this.mainTouchId=null;var eventTypePrefix=this._getEventPrefix();removeListener(fabric.document,'touchend',this._onTouchEnd,addEventOptions);removeListener(fabric.document,'touchmove',this._onMouseMove,addEventOptions);var _this=this;if(this._willAddMouseDown){clearTimeout(this._willAddMouseDown);}
this._willAddMouseDown=setTimeout(function(){addListener(_this.upperCanvasEl,eventTypePrefix+'down',_this._onMouseDown);_this._willAddMouseDown=0;},400);},_onMouseUp:function(e){this.__onMouseUp(e);this._resetTransformEventData();var canvasElement=this.upperCanvasEl,eventTypePrefix=this._getEventPrefix();if(this._isMainEvent(e)){removeListener(fabric.document,eventTypePrefix+'up',this._onMouseUp);removeListener(fabric.document,eventTypePrefix+'move',this._onMouseMove,addEventOptions);addListener(canvasElement,eventTypePrefix+'move',this._onMouseMove,addEventOptions);}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault();this.__onMouseMove(e);},_onResize:function(){this.calcOffset();},_shouldRender:function(target){var activeObject=this._activeObject;if(!!activeObject!==!!target||(activeObject&&target&&(activeObject!==target))){return true;}
else if(activeObject&&activeObject.isEditing){return false;}
return false;},__onMouseUp:function(e){var target,transform=this._currentTransform,groupSelector=this._groupSelector,shouldRender=false,isClick=(!groupSelector||(groupSelector.left===0&&groupSelector.top===0));this._cacheTransformEventData(e);target=this._target;this._handleEvent(e,'up:before');if(checkClick(e,RIGHT_CLICK)){if(this.fireRightClick){this._handleEvent(e,'up',RIGHT_CLICK,isClick);}
return;}
if(checkClick(e,MIDDLE_CLICK)){if(this.fireMiddleClick){this._handleEvent(e,'up',MIDDLE_CLICK,isClick);}
this._resetTransformEventData();return;}
if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(e);return;}
if(!this._isMainEvent(e)){return;}
if(transform){this._finalizeCurrentTransform(e);shouldRender=transform.actionPerformed;}
if(!isClick){var targetWasActive=target===this._activeObject;this._maybeGroupObjects(e);if(!shouldRender){shouldRender=(this._shouldRender(target)||(!targetWasActive&&target===this._activeObject));}}
if(target){if(target.selectable&&target!==this._activeObject&&target.activeOn==='up'){this.setActiveObject(target,e);shouldRender=true;}
else{var corner=target._findTargetCorner(this.getPointer(e,true),fabric.util.isTouchEvent(e));var control=target.controls[corner],mouseUpHandler=control&&control.getMouseUpHandler(e,target,control);if(mouseUpHandler){var pointer=this.getPointer(e);mouseUpHandler(e,transform,pointer.x,pointer.y);}}
target.isMoving=false;}
this._setCursorFromEvent(e,target);this._handleEvent(e,'up',LEFT_CLICK,isClick);this._groupSelector=null;this._currentTransform=null;target&&(target.__corner=0);if(shouldRender){this.requestRenderAll();}
else if(!isClick){this.renderTop();}},_simpleEventHandler:function(eventType,e){var target=this.findTarget(e),targets=this.targets,options={e:e,target:target,subTargets:targets,};this.fire(eventType,options);target&&target.fire(eventType,options);if(!targets){return target;}
for(var i=0;i<targets.length;i++){targets[i].fire(eventType,options);}
return target;},_handleEvent:function(e,eventType,button,isClick){var target=this._target,targets=this.targets||[],options={e:e,target:target,subTargets:targets,button:button||LEFT_CLICK,isClick:isClick||false,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};if(eventType==='up'){options.currentTarget=this.findTarget(e);options.currentSubTargets=this.targets;}
this.fire('mouse:'+eventType,options);target&&target.fire('mouse'+eventType,options);for(var i=0;i<targets.length;i++){targets[i].fire('mouse'+eventType,options);}},_finalizeCurrentTransform:function(e){var transform=this._currentTransform,target=transform.target,eventName,options={e:e,target:target,transform:transform,action:transform.action,};if(target._scaling){target._scaling=false;}
target.setCoords();if(transform.actionPerformed||(this.stateful&&target.hasStateChanged())){if(transform.actionPerformed){eventName=this._addEventOptions(options,transform);this._fire(eventName,options);}
this._fire('modified',options);}},_addEventOptions:function(options,transform){var eventName,by;switch(transform.action){case'scaleX':eventName='scaled';by='x';break;case'scaleY':eventName='scaled';by='y';break;case'skewX':eventName='skewed';by='x';break;case'skewY':eventName='skewed';by='y';break;case'scale':eventName='scaled';by='equally';break;case'rotate':eventName='rotated';break;case'drag':eventName='moved';break;}
options.by=by;return eventName;},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=true;if(this.getActiveObject()){this.discardActiveObject(e).requestRenderAll();}
var pointer=this.getPointer(e);this.freeDrawingBrush.onMouseDown(pointer,{e:e,pointer:pointer});this._handleEvent(e,'down');},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var pointer=this.getPointer(e);this.freeDrawingBrush.onMouseMove(pointer,{e:e,pointer:pointer});}
this.setCursor(this.freeDrawingCursor);this._handleEvent(e,'move');},_onMouseUpInDrawingMode:function(e){var pointer=this.getPointer(e);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:e,pointer:pointer});this._handleEvent(e,'up');},__onMouseDown:function(e){this._cacheTransformEventData(e);this._handleEvent(e,'down:before');var target=this._target;if(checkClick(e,RIGHT_CLICK)){if(this.fireRightClick){this._handleEvent(e,'down',RIGHT_CLICK);}
return;}
if(checkClick(e,MIDDLE_CLICK)){if(this.fireMiddleClick){this._handleEvent(e,'down',MIDDLE_CLICK);}
return;}
if(this.isDrawingMode){this._onMouseDownInDrawingMode(e);return;}
if(!this._isMainEvent(e)){return;}
if(this._currentTransform){return;}
var pointer=this._pointer;this._previousPointer=pointer;var shouldRender=this._shouldRender(target),shouldGroup=this._shouldGroup(e,target);if(this._shouldClearSelection(e,target)){this.discardActiveObject(e);}
else if(shouldGroup){this._handleGrouping(e,target);target=this._activeObject;}
if(this.selection&&(!target||(!target.selectable&&!target.isEditing&&target!==this._activeObject))){this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0};}
if(target){var alreadySelected=target===this._activeObject;if(target.selectable&&target.activeOn==='down'){this.setActiveObject(target,e);}
var corner=target._findTargetCorner(this.getPointer(e,true),fabric.util.isTouchEvent(e));target.__corner=corner;if(target===this._activeObject&&(corner||!shouldGroup)){this._setupCurrentTransform(e,target,alreadySelected);var control=target.controls[corner],pointer=this.getPointer(e),mouseDownHandler=control&&control.getMouseDownHandler(e,target,control);if(mouseDownHandler){mouseDownHandler(e,this._currentTransform,pointer.x,pointer.y);}}}
this._handleEvent(e,'down');(shouldRender||shouldGroup)&&this.requestRenderAll();},_resetTransformEventData:function(){this._target=null;this._pointer=null;this._absolutePointer=null;},_cacheTransformEventData:function(e){this._resetTransformEventData();this._pointer=this.getPointer(e,true);this._absolutePointer=this.restorePointerVpt(this._pointer);this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null;},_beforeTransform:function(e){var t=this._currentTransform;this.stateful&&t.target.saveState();this.fire('before:transform',{e:e,transform:t,});},__onMouseMove:function(e){this._handleEvent(e,'move:before');this._cacheTransformEventData(e);var target,pointer;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(e);return;}
if(!this._isMainEvent(e)){return;}
var groupSelector=this._groupSelector;if(groupSelector){pointer=this._absolutePointer;groupSelector.left=pointer.x-groupSelector.ex;groupSelector.top=pointer.y-groupSelector.ey;this.renderTop();}
else if(!this._currentTransform){target=this.findTarget(e)||null;this._setCursorFromEvent(e,target);this._fireOverOutEvents(target,e);}
else{this._transformObject(e);}
this._handleEvent(e,'move');this._resetTransformEventData();},_fireOverOutEvents:function(target,e){var _hoveredTarget=this._hoveredTarget,_hoveredTargets=this._hoveredTargets,targets=this.targets,length=Math.max(_hoveredTargets.length,targets.length);this.fireSyntheticInOutEvents(target,e,{oldTarget:_hoveredTarget,evtOut:'mouseout',canvasEvtOut:'mouse:out',evtIn:'mouseover',canvasEvtIn:'mouse:over',});for(var i=0;i<length;i++){this.fireSyntheticInOutEvents(targets[i],e,{oldTarget:_hoveredTargets[i],evtOut:'mouseout',evtIn:'mouseover',});}
this._hoveredTarget=target;this._hoveredTargets=this.targets.concat();},_fireEnterLeaveEvents:function(target,e){var _draggedoverTarget=this._draggedoverTarget,_hoveredTargets=this._hoveredTargets,targets=this.targets,length=Math.max(_hoveredTargets.length,targets.length);this.fireSyntheticInOutEvents(target,e,{oldTarget:_draggedoverTarget,evtOut:'dragleave',evtIn:'dragenter',});for(var i=0;i<length;i++){this.fireSyntheticInOutEvents(targets[i],e,{oldTarget:_hoveredTargets[i],evtOut:'dragleave',evtIn:'dragenter',});}
this._draggedoverTarget=target;},fireSyntheticInOutEvents:function(target,e,config){var inOpt,outOpt,oldTarget=config.oldTarget,outFires,inFires,targetChanged=oldTarget!==target,canvasEvtIn=config.canvasEvtIn,canvasEvtOut=config.canvasEvtOut;if(targetChanged){inOpt={e:e,target:target,previousTarget:oldTarget};outOpt={e:e,target:oldTarget,nextTarget:target};}
inFires=target&&targetChanged;outFires=oldTarget&&targetChanged;if(outFires){canvasEvtOut&&this.fire(canvasEvtOut,outOpt);oldTarget.fire(config.evtOut,outOpt);}
if(inFires){canvasEvtIn&&this.fire(canvasEvtIn,inOpt);target.fire(config.evtIn,inOpt);}},__onMouseWheel:function(e){this._cacheTransformEventData(e);this._handleEvent(e,'wheel');this._resetTransformEventData();},_transformObject:function(e){var pointer=this.getPointer(e),transform=this._currentTransform;transform.reset=false;transform.shiftKey=e.shiftKey;transform.altKey=e[this.centeredKey];this._performTransformAction(e,transform,pointer);transform.actionPerformed&&this.requestRenderAll();},_performTransformAction:function(e,transform,pointer){var x=pointer.x,y=pointer.y,action=transform.action,actionPerformed=false,actionHandler=transform.actionHandler;if(actionHandler){actionPerformed=actionHandler(e,transform,x,y);}
if(action==='drag'&&actionPerformed){transform.target.isMoving=true;this.setCursor(transform.target.moveCursor||this.moveCursor);}
transform.actionPerformed=transform.actionPerformed||actionPerformed;},_fire:fabric.controlsUtils.fireEvent,_setCursorFromEvent:function(e,target){if(!target){this.setCursor(this.defaultCursor);return false;}
var hoverCursor=target.hoverCursor||this.hoverCursor,activeSelection=this._activeObject&&this._activeObject.type==='activeSelection'?this._activeObject:null,corner=(!activeSelection||!activeSelection.contains(target))&&target._findTargetCorner(this.getPointer(e,true));if(!corner){if(target.subTargetCheck){this.targets.concat().reverse().map(function(_target){hoverCursor=_target.hoverCursor||hoverCursor;});}
this.setCursor(hoverCursor);}
else{this.setCursor(this.getCornerCursor(corner,target,e));}},getCornerCursor:function(corner,target,e){var control=target.controls[corner];return control.cursorStyleHandler(e,control,target);}});})();(function(){var min=Math.min,max=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,target){var activeObject=this._activeObject;return activeObject&&this._isSelectionKeyPressed(e)&&target&&target.selectable&&this.selection&&(activeObject!==target||activeObject.type==='activeSelection')&&!target.onSelect({e:e});},_handleGrouping:function(e,target){var activeObject=this._activeObject;if(activeObject.__corner){return;}
if(target===activeObject){target=this.findTarget(e,true);if(!target||!target.selectable){return;}}
if(activeObject&&activeObject.type==='activeSelection'){this._updateActiveSelection(target,e);}
else{this._createActiveSelection(target,e);}},_updateActiveSelection:function(target,e){var activeSelection=this._activeObject,currentActiveObjects=activeSelection._objects.slice(0);if(activeSelection.contains(target)){activeSelection.removeWithUpdate(target);this._hoveredTarget=target;this._hoveredTargets=this.targets.concat();if(activeSelection.size()===1){this._setActiveObject(activeSelection.item(0),e);}}
else{activeSelection.addWithUpdate(target);this._hoveredTarget=activeSelection;this._hoveredTargets=this.targets.concat();}
this._fireSelectionEvents(currentActiveObjects,e);},_createActiveSelection:function(target,e){var currentActives=this.getActiveObjects(),group=this._createGroup(target);this._hoveredTarget=group;this._setActiveObject(group,e);this._fireSelectionEvents(currentActives,e);},_createGroup:function(target){var objects=this._objects,isActiveLower=objects.indexOf(this._activeObject)<objects.indexOf(target),groupObjects=isActiveLower?[this._activeObject,target]:[target,this._activeObject];this._activeObject.isEditing&&this._activeObject.exitEditing();return new fabric.ActiveSelection(groupObjects,{canvas:this});},_groupSelectedObjects:function(e){var group=this._collectObjects(e),aGroup;if(group.length===1){this.setActiveObject(group[0],e);}
else if(group.length>1){aGroup=new fabric.ActiveSelection(group.reverse(),{canvas:this});this.setActiveObject(aGroup,e);}},_collectObjects:function(e){var group=[],currentObject,x1=this._groupSelector.ex,y1=this._groupSelector.ey,x2=x1+this._groupSelector.left,y2=y1+this._groupSelector.top,selectionX1Y1=new fabric.Point(min(x1,x2),min(y1,y2)),selectionX2Y2=new fabric.Point(max(x1,x2),max(y1,y2)),allowIntersect=!this.selectionFullyContained,isClick=x1===x2&&y1===y2;for(var i=this._objects.length;i--;){currentObject=this._objects[i];if(!currentObject||!currentObject.selectable||!currentObject.visible){continue;}
if((allowIntersect&&currentObject.intersectsWithRect(selectionX1Y1,selectionX2Y2,true))||currentObject.isContainedWithinRect(selectionX1Y1,selectionX2Y2,true)||(allowIntersect&&currentObject.containsPoint(selectionX1Y1,null,true))||(allowIntersect&&currentObject.containsPoint(selectionX2Y2,null,true))){group.push(currentObject);if(isClick){break;}}}
if(group.length>1){group=group.filter(function(object){return!object.onSelect({e:e});});}
return group;},_maybeGroupObjects:function(e){if(this.selection&&this._groupSelector){this._groupSelectedObjects(e);}
this.setCursor(this.defaultCursor);this._groupSelector=null;}});})();(function(){fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(options){options||(options={});var format=options.format||'png',quality=options.quality||1,multiplier=(options.multiplier||1)*(options.enableRetinaScaling?this.getRetinaScaling():1),canvasEl=this.toCanvasElement(multiplier,options);return fabric.util.toDataURL(canvasEl,format,quality);},toCanvasElement:function(multiplier,cropping){multiplier=multiplier||1;cropping=cropping||{};var scaledWidth=(cropping.width||this.width)*multiplier,scaledHeight=(cropping.height||this.height)*multiplier,zoom=this.getZoom(),originalWidth=this.width,originalHeight=this.height,newZoom=zoom*multiplier,vp=this.viewportTransform,translateX=(vp[4]-(cropping.left||0))*multiplier,translateY=(vp[5]-(cropping.top||0))*multiplier,originalInteractive=this.interactive,newVp=[newZoom,0,0,newZoom,translateX,translateY],originalRetina=this.enableRetinaScaling,canvasEl=fabric.util.createCanvasElement(),originalContextTop=this.contextTop;canvasEl.width=scaledWidth;canvasEl.height=scaledHeight;this.contextTop=null;this.enableRetinaScaling=false;this.interactive=false;this.viewportTransform=newVp;this.width=scaledWidth;this.height=scaledHeight;this.calcViewportBoundaries();this.renderCanvas(canvasEl.getContext('2d'),this._objects);this.viewportTransform=vp;this.width=originalWidth;this.height=originalHeight;this.calcViewportBoundaries();this.interactive=originalInteractive;this.enableRetinaScaling=originalRetina;this.contextTop=originalContextTop;return canvasEl;},});})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromJSON:function(json,callback,reviver){if(!json){return;}
var serialized=(typeof json==='string')?JSON.parse(json):fabric.util.object.clone(json);var _this=this,clipPath=serialized.clipPath,renderOnAddRemove=this.renderOnAddRemove;this.renderOnAddRemove=false;delete serialized.clipPath;this._enlivenObjects(serialized.objects,function(enlivenedObjects){_this.clear();_this._setBgOverlay(serialized,function(){if(clipPath){_this._enlivenObjects([clipPath],function(enlivenedCanvasClip){_this.clipPath=enlivenedCanvasClip[0];_this.__setupCanvas.call(_this,serialized,enlivenedObjects,renderOnAddRemove,callback);});}
else{_this.__setupCanvas.call(_this,serialized,enlivenedObjects,renderOnAddRemove,callback);}});},reviver);return this;},__setupCanvas:function(serialized,enlivenedObjects,renderOnAddRemove,callback){var _this=this;enlivenedObjects.forEach(function(obj,index){_this.insertAt(obj,index);});this.renderOnAddRemove=renderOnAddRemove;delete serialized.objects;delete serialized.backgroundImage;delete serialized.overlayImage;delete serialized.background;delete serialized.overlay;this._setOptions(serialized);this.renderAll();callback&&callback();},_setBgOverlay:function(serialized,callback){var loaded={backgroundColor:false,overlayColor:false,backgroundImage:false,overlayImage:false};if(!serialized.backgroundImage&&!serialized.overlayImage&&!serialized.background&&!serialized.overlay){callback&&callback();return;}
var cbIfLoaded=function(){if(loaded.backgroundImage&&loaded.overlayImage&&loaded.backgroundColor&&loaded.overlayColor){callback&&callback();}};this.__setBgOverlay('backgroundImage',serialized.backgroundImage,loaded,cbIfLoaded);this.__setBgOverlay('overlayImage',serialized.overlayImage,loaded,cbIfLoaded);this.__setBgOverlay('backgroundColor',serialized.background,loaded,cbIfLoaded);this.__setBgOverlay('overlayColor',serialized.overlay,loaded,cbIfLoaded);},__setBgOverlay:function(property,value,loaded,callback){var _this=this;if(!value){loaded[property]=true;callback&&callback();return;}
if(property==='backgroundImage'||property==='overlayImage'){fabric.util.enlivenObjects([value],function(enlivedObject){_this[property]=enlivedObject[0];loaded[property]=true;callback&&callback();});}
else{this['set'+fabric.util.string.capitalize(property,true)](value,function(){loaded[property]=true;callback&&callback();});}},_enlivenObjects:function(objects,callback,reviver){if(!objects||objects.length===0){callback&&callback([]);return;}
fabric.util.enlivenObjects(objects,function(enlivenedObjects){callback&&callback(enlivenedObjects);},null,reviver);},_toDataURL:function(format,callback){this.clone(function(clone){callback(clone.toDataURL(format));});},_toDataURLWithMultiplier:function(format,multiplier,callback){this.clone(function(clone){callback(clone.toDataURLWithMultiplier(format,multiplier));});},clone:function(callback,properties){var data=JSON.stringify(this.toJSON(properties));this.cloneWithoutData(function(clone){clone.loadFromJSON(data,function(){callback&&callback(clone);});});},cloneWithoutData:function(callback){var el=fabric.util.createCanvasElement();el.width=this.width;el.height=this.height;var clone=new fabric.Canvas(el);if(this.backgroundImage){clone.setBackgroundImage(this.backgroundImage.src,function(){clone.renderAll();callback&&callback(clone);});clone.backgroundImageOpacity=this.backgroundImageOpacity;clone.backgroundImageStretch=this.backgroundImageStretch;}
else{callback&&callback(clone);}}});(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,toFixed=fabric.util.toFixed,capitalize=fabric.util.string.capitalize,degreesToRadians=fabric.util.degreesToRadians,objectCaching=!fabric.isLikelyNode,ALIASING_LIMIT=2;if(fabric.Object){return;}
fabric.Object=fabric.util.createClass(fabric.CommonMethods,{type:'object',originX:'left',originY:'top',top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:true,hoverCursor:null,moveCursor:null,padding:0,borderColor:'rgb(178,204,255)',borderDashArray:null,cornerColor:'rgb(178,204,255)',cornerStrokeColor:null,cornerStyle:'rect',cornerDashArray:null,centeredScaling:false,centeredRotation:true,fill:'rgb(0,0,0)',fillRule:'nonzero',globalCompositeOperation:'source-over',backgroundColor:'',selectionBackgroundColor:'',stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:'butt',strokeLineJoin:'miter',strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,minScaleLimit:0,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,perPixelTargetFind:false,includeDefaultValues:true,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockSkewingX:false,lockSkewingY:false,lockScalingFlip:false,excludeFromExport:false,objectCaching:objectCaching,statefullCache:false,noScaleCache:true,strokeUniform:false,dirty:true,__corner:0,paintFirst:'fill',activeOn:'down',stateProperties:('top left width height scaleX scaleY flipX flipY originX originY transformMatrix '+'stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit '+'angle opacity fill globalCompositeOperation shadow visible backgroundColor '+'skewX skewY fillRule paintFirst clipPath strokeUniform').split(' '),cacheProperties:('fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform'+' strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath').split(' '),colorProperties:('fill stroke backgroundColor').split(' '),clipPath:undefined,inverted:false,absolutePositioned:false,initialize:function(options){if(options){this.setOptions(options);}},_createCacheCanvas:function(){this._cacheProperties={};this._cacheCanvas=fabric.util.createCanvasElement();this._cacheContext=this._cacheCanvas.getContext('2d');this._updateCacheCanvas();this.dirty=true;},_limitCacheSize:function(dims){var perfLimitSizeTotal=fabric.perfLimitSizeTotal,width=dims.width,height=dims.height,max=fabric.maxCacheSideLimit,min=fabric.minCacheSideLimit;if(width<=max&&height<=max&&width*height<=perfLimitSizeTotal){if(width<min){dims.width=min;}
if(height<min){dims.height=min;}
return dims;}
var ar=width/height,limitedDims=fabric.util.limitDimsByArea(ar,perfLimitSizeTotal),capValue=fabric.util.capValue,x=capValue(min,limitedDims.x,max),y=capValue(min,limitedDims.y,max);if(width>x){dims.zoomX/=width/x;dims.width=x;dims.capped=true;}
if(height>y){dims.zoomY/=height/y;dims.height=y;dims.capped=true;}
return dims;},_getCacheCanvasDimensions:function(){var objectScale=this.getTotalObjectScaling(),dim=this._getTransformedDimensions(0,0),neededX=dim.x*objectScale.scaleX/this.scaleX,neededY=dim.y*objectScale.scaleY/this.scaleY;return{width:neededX+ALIASING_LIMIT,height:neededY+ALIASING_LIMIT,zoomX:objectScale.scaleX,zoomY:objectScale.scaleY,x:neededX,y:neededY};},_updateCacheCanvas:function(){var targetCanvas=this.canvas;if(this.noScaleCache&&targetCanvas&&targetCanvas._currentTransform){var target=targetCanvas._currentTransform.target,action=targetCanvas._currentTransform.action;if(this===target&&action.slice&&action.slice(0,5)==='scale'){return false;}}
var canvas=this._cacheCanvas,dims=this._limitCacheSize(this._getCacheCanvasDimensions()),minCacheSize=fabric.minCacheSideLimit,width=dims.width,height=dims.height,drawingWidth,drawingHeight,zoomX=dims.zoomX,zoomY=dims.zoomY,dimensionsChanged=width!==this.cacheWidth||height!==this.cacheHeight,zoomChanged=this.zoomX!==zoomX||this.zoomY!==zoomY,shouldRedraw=dimensionsChanged||zoomChanged,additionalWidth=0,additionalHeight=0,shouldResizeCanvas=false;if(dimensionsChanged){var canvasWidth=this._cacheCanvas.width,canvasHeight=this._cacheCanvas.height,sizeGrowing=width>canvasWidth||height>canvasHeight,sizeShrinking=(width<canvasWidth*0.9||height<canvasHeight*0.9)&&canvasWidth>minCacheSize&&canvasHeight>minCacheSize;shouldResizeCanvas=sizeGrowing||sizeShrinking;if(sizeGrowing&&!dims.capped&&(width>minCacheSize||height>minCacheSize)){additionalWidth=width*0.1;additionalHeight=height*0.1;}}
if(this instanceof fabric.Text&&this.path){shouldRedraw=true;shouldResizeCanvas=true;additionalWidth+=this.getHeightOfLine(0)*this.zoomX;additionalHeight+=this.getHeightOfLine(0)*this.zoomY;}
if(shouldRedraw){if(shouldResizeCanvas){canvas.width=Math.ceil(width+additionalWidth);canvas.height=Math.ceil(height+additionalHeight);}
else{this._cacheContext.setTransform(1,0,0,1,0,0);this._cacheContext.clearRect(0,0,canvas.width,canvas.height);}
drawingWidth=dims.x/2;drawingHeight=dims.y/2;this.cacheTranslationX=Math.round(canvas.width/2-drawingWidth)+drawingWidth;this.cacheTranslationY=Math.round(canvas.height/2-drawingHeight)+drawingHeight;this.cacheWidth=width;this.cacheHeight=height;this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY);this._cacheContext.scale(zoomX,zoomY);this.zoomX=zoomX;this.zoomY=zoomY;return true;}
return false;},setOptions:function(options){this._setOptions(options);this._initGradient(options.fill,'fill');this._initGradient(options.stroke,'stroke');this._initPattern(options.fill,'fill');this._initPattern(options.stroke,'stroke');},transform:function(ctx){var needFullTransform=(this.group&&!this.group._transformDone)||(this.group&&this.canvas&&ctx===this.canvas.contextTop);var m=this.calcTransformMatrix(!needFullTransform);ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]);},toObject:function(propertiesToInclude){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS,object={type:this.type,version:fabric.version,originX:this.originX,originY:this.originY,left:toFixed(this.left,NUM_FRACTION_DIGITS),top:toFixed(this.top,NUM_FRACTION_DIGITS),width:toFixed(this.width,NUM_FRACTION_DIGITS),height:toFixed(this.height,NUM_FRACTION_DIGITS),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:toFixed(this.strokeWidth,NUM_FRACTION_DIGITS),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:toFixed(this.strokeMiterLimit,NUM_FRACTION_DIGITS),scaleX:toFixed(this.scaleX,NUM_FRACTION_DIGITS),scaleY:toFixed(this.scaleY,NUM_FRACTION_DIGITS),angle:toFixed(this.angle,NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:toFixed(this.opacity,NUM_FRACTION_DIGITS),shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:toFixed(this.skewX,NUM_FRACTION_DIGITS),skewY:toFixed(this.skewY,NUM_FRACTION_DIGITS),};if(this.clipPath&&!this.clipPath.excludeFromExport){object.clipPath=this.clipPath.toObject(propertiesToInclude);object.clipPath.inverted=this.clipPath.inverted;object.clipPath.absolutePositioned=this.clipPath.absolutePositioned;}
fabric.util.populateWithProperties(this,object,propertiesToInclude);if(!this.includeDefaultValues){object=this._removeDefaultValues(object);}
return object;},toDatalessObject:function(propertiesToInclude){return this.toObject(propertiesToInclude);},_removeDefaultValues:function(object){var prototype=fabric.util.getKlass(object.type).prototype,stateProperties=prototype.stateProperties;stateProperties.forEach(function(prop){if(prop==='left'||prop==='top'){return;}
if(object[prop]===prototype[prop]){delete object[prop];}
var isArray=Object.prototype.toString.call(object[prop])==='[object Array]'&&Object.prototype.toString.call(prototype[prop])==='[object Array]';if(isArray&&object[prop].length===0&&prototype[prop].length===0){delete object[prop];}});return object;},toString:function(){return'#<fabric.'+capitalize(this.type)+'>';},getObjectScaling:function(){if(!this.group){return{scaleX:this.scaleX,scaleY:this.scaleY,};}
var options=fabric.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(options.scaleX),scaleY:Math.abs(options.scaleY)};},getTotalObjectScaling:function(){var scale=this.getObjectScaling(),scaleX=scale.scaleX,scaleY=scale.scaleY;if(this.canvas){var zoom=this.canvas.getZoom();var retina=this.canvas.getRetinaScaling();scaleX*=zoom*retina;scaleY*=zoom*retina;}
return{scaleX:scaleX,scaleY:scaleY};},getObjectOpacity:function(){var opacity=this.opacity;if(this.group){opacity*=this.group.getObjectOpacity();}
return opacity;},_set:function(key,value){var shouldConstrainValue=(key==='scaleX'||key==='scaleY'),isChanged=this[key]!==value,groupNeedsUpdate=false;if(shouldConstrainValue){value=this._constrainScale(value);}
if(key==='scaleX'&&value<0){this.flipX=!this.flipX;value*=-1;}
else if(key==='scaleY'&&value<0){this.flipY=!this.flipY;value*=-1;}
else if(key==='shadow'&&value&&!(value instanceof fabric.Shadow)){value=new fabric.Shadow(value);}
else if(key==='dirty'&&this.group){this.group.set('dirty',value);}
this[key]=value;if(isChanged){groupNeedsUpdate=this.group&&this.group.isOnACache();if(this.cacheProperties.indexOf(key)>-1){this.dirty=true;groupNeedsUpdate&&this.group.set('dirty',true);}
else if(groupNeedsUpdate&&this.stateProperties.indexOf(key)>-1){this.group.set('dirty',true);}}
return this;},setOnGroup:function(){},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform;}
return fabric.iMatrix.concat();},isNotVisible:function(){return this.opacity===0||(!this.width&&!this.height&&this.strokeWidth===0)||!this.visible;},render:function(ctx){if(this.isNotVisible()){return;}
if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return;}
ctx.save();this._setupCompositeOperation(ctx);this.drawSelectionBackground(ctx);this.transform(ctx);this._setOpacity(ctx);this._setShadow(ctx,this);if(this.shouldCache()){this.renderCache();this.drawCacheOnCanvas(ctx);}
else{this._removeCacheCanvas();this.dirty=false;this.drawObject(ctx);if(this.objectCaching&&this.statefullCache){this.saveState({propertySet:'cacheProperties'});}}
ctx.restore();},renderCache:function(options){options=options||{};if(!this._cacheCanvas){this._createCacheCanvas();}
if(this.isCacheDirty()){this.statefullCache&&this.saveState({propertySet:'cacheProperties'});this.drawObject(this._cacheContext,options.forClipping);this.dirty=false;}},_removeCacheCanvas:function(){this._cacheCanvas=null;this.cacheWidth=0;this.cacheHeight=0;},hasStroke:function(){return this.stroke&&this.stroke!=='transparent'&&this.strokeWidth!==0;},hasFill:function(){return this.fill&&this.fill!=='transparent';},needsItsOwnCache:function(){if(this.paintFirst==='stroke'&&this.hasFill()&&this.hasStroke()&&typeof this.shadow==='object'){return true;}
if(this.clipPath){return true;}
return false;},shouldCache:function(){this.ownCaching=this.needsItsOwnCache()||(this.objectCaching&&(!this.group||!this.group.isOnACache()));return this.ownCaching;},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0);},drawClipPathOnCache:function(ctx){var path=this.clipPath;ctx.save();if(path.inverted){ctx.globalCompositeOperation='destination-out';}
else{ctx.globalCompositeOperation='destination-in';}
if(path.absolutePositioned){var m=fabric.util.invertTransform(this.calcTransformMatrix());ctx.transform(m[0],m[1],m[2],m[3],m[4],m[5]);}
path.transform(ctx);ctx.scale(1/path.zoomX,1/path.zoomY);ctx.drawImage(path._cacheCanvas,-path.cacheTranslationX,-path.cacheTranslationY);ctx.restore();},drawObject:function(ctx,forClipping){var originalFill=this.fill,originalStroke=this.stroke;if(forClipping){this.fill='black';this.stroke='';this._setClippingProperties(ctx);}
else{this._renderBackground(ctx);}
this._render(ctx);this._drawClipPath(ctx);this.fill=originalFill;this.stroke=originalStroke;},_drawClipPath:function(ctx){var path=this.clipPath;if(!path){return;}
path.canvas=this.canvas;path.shouldCache();path._transformDone=true;path.renderCache({forClipping:true});this.drawClipPathOnCache(ctx);},drawCacheOnCanvas:function(ctx){ctx.scale(1/this.zoomX,1/this.zoomY);ctx.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY);},isCacheDirty:function(skipCanvas){if(this.isNotVisible()){return false;}
if(this._cacheCanvas&&!skipCanvas&&this._updateCacheCanvas()){return true;}
else{if(this.dirty||(this.clipPath&&this.clipPath.absolutePositioned)||(this.statefullCache&&this.hasStateChanged('cacheProperties'))){if(this._cacheCanvas&&!skipCanvas){var width=this.cacheWidth/this.zoomX;var height=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-width/2,-height/2,width,height);}
return true;}}
return false;},_renderBackground:function(ctx){if(!this.backgroundColor){return;}
var dim=this._getNonTransformedDimensions();ctx.fillStyle=this.backgroundColor;ctx.fillRect(-dim.x/2,-dim.y/2,dim.x,dim.y);this._removeShadow(ctx);},_setOpacity:function(ctx){if(this.group&&!this.group._transformDone){ctx.globalAlpha=this.getObjectOpacity();}
else{ctx.globalAlpha*=this.opacity;}},_setStrokeStyles:function(ctx,decl){var stroke=decl.stroke;if(stroke){ctx.lineWidth=decl.strokeWidth;ctx.lineCap=decl.strokeLineCap;ctx.lineDashOffset=decl.strokeDashOffset;ctx.lineJoin=decl.strokeLineJoin;ctx.miterLimit=decl.strokeMiterLimit;if(stroke.toLive){if(stroke.gradientUnits==='percentage'||stroke.gradientTransform||stroke.patternTransform){this._applyPatternForTransformedGradient(ctx,stroke);}
else{ctx.strokeStyle=stroke.toLive(ctx,this);this._applyPatternGradientTransform(ctx,stroke);}}
else{ctx.strokeStyle=decl.stroke;}}},_setFillStyles:function(ctx,decl){var fill=decl.fill;if(fill){if(fill.toLive){ctx.fillStyle=fill.toLive(ctx,this);this._applyPatternGradientTransform(ctx,decl.fill);}
else{ctx.fillStyle=fill;}}},_setClippingProperties:function(ctx){ctx.globalAlpha=1;ctx.strokeStyle='transparent';ctx.fillStyle='#000000';},_setLineDash:function(ctx,dashArray){if(!dashArray||dashArray.length===0){return;}
if(1&dashArray.length){dashArray.push.apply(dashArray,dashArray);}
ctx.setLineDash(dashArray);},_renderControls:function(ctx,styleOverride){var vpt=this.getViewportTransform(),matrix=this.calcTransformMatrix(),options,drawBorders,drawControls;styleOverride=styleOverride||{};drawBorders=typeof styleOverride.hasBorders!=='undefined'?styleOverride.hasBorders:this.hasBorders;drawControls=typeof styleOverride.hasControls!=='undefined'?styleOverride.hasControls:this.hasControls;matrix=fabric.util.multiplyTransformMatrices(vpt,matrix);options=fabric.util.qrDecompose(matrix);ctx.save();ctx.translate(options.translateX,options.translateY);ctx.lineWidth=1*this.borderScaleFactor;if(!this.group){ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;}
ctx.rotate(degreesToRadians(options.angle));if(styleOverride.forActiveSelection||this.group){drawBorders&&this.drawBordersInGroup(ctx,options,styleOverride);}
else{drawBorders&&this.drawBorders(ctx,styleOverride);}
drawControls&&this.drawControls(ctx,styleOverride);ctx.restore();},_setShadow:function(ctx){if(!this.shadow){return;}
var shadow=this.shadow,canvas=this.canvas,scaling,multX=(canvas&&canvas.viewportTransform[0])||1,multY=(canvas&&canvas.viewportTransform[3])||1;if(shadow.nonScaling){scaling={scaleX:1,scaleY:1};}
else{scaling=this.getObjectScaling();}
if(canvas&&canvas._isRetinaScaling()){multX*=fabric.devicePixelRatio;multY*=fabric.devicePixelRatio;}
ctx.shadowColor=shadow.color;ctx.shadowBlur=shadow.blur*fabric.browserShadowBlurConstant*(multX+multY)*(scaling.scaleX+scaling.scaleY)/4;ctx.shadowOffsetX=shadow.offsetX*multX*scaling.scaleX;ctx.shadowOffsetY=shadow.offsetY*multY*scaling.scaleY;},_removeShadow:function(ctx){if(!this.shadow){return;}
ctx.shadowColor='';ctx.shadowBlur=ctx.shadowOffsetX=ctx.shadowOffsetY=0;},_applyPatternGradientTransform:function(ctx,filler){if(!filler||!filler.toLive){return{offsetX:0,offsetY:0};}
var t=filler.gradientTransform||filler.patternTransform;var offsetX=-this.width/2+filler.offsetX||0,offsetY=-this.height/2+filler.offsetY||0;if(filler.gradientUnits==='percentage'){ctx.transform(this.width,0,0,this.height,offsetX,offsetY);}
else{ctx.transform(1,0,0,1,offsetX,offsetY);}
if(t){ctx.transform(t[0],t[1],t[2],t[3],t[4],t[5]);}
return{offsetX:offsetX,offsetY:offsetY};},_renderPaintInOrder:function(ctx){if(this.paintFirst==='stroke'){this._renderStroke(ctx);this._renderFill(ctx);}
else{this._renderFill(ctx);this._renderStroke(ctx);}},_render:function(){},_renderFill:function(ctx){if(!this.fill){return;}
ctx.save();this._setFillStyles(ctx,this);if(this.fillRule==='evenodd'){ctx.fill('evenodd');}
else{ctx.fill();}
ctx.restore();},_renderStroke:function(ctx){if(!this.stroke||this.strokeWidth===0){return;}
if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(ctx);}
ctx.save();if(this.strokeUniform&&this.group){var scaling=this.getObjectScaling();ctx.scale(1/scaling.scaleX,1/scaling.scaleY);}
else if(this.strokeUniform){ctx.scale(1/this.scaleX,1/this.scaleY);}
this._setLineDash(ctx,this.strokeDashArray);this._setStrokeStyles(ctx,this);ctx.stroke();ctx.restore();},_applyPatternForTransformedGradient:function(ctx,filler){var dims=this._limitCacheSize(this._getCacheCanvasDimensions()),pCanvas=fabric.util.createCanvasElement(),pCtx,retinaScaling=this.canvas.getRetinaScaling(),width=dims.x/this.scaleX/retinaScaling,height=dims.y/this.scaleY/retinaScaling;pCanvas.width=width;pCanvas.height=height;pCtx=pCanvas.getContext('2d');pCtx.beginPath();pCtx.moveTo(0,0);pCtx.lineTo(width,0);pCtx.lineTo(width,height);pCtx.lineTo(0,height);pCtx.closePath();pCtx.translate(width/2,height/2);pCtx.scale(dims.zoomX/this.scaleX/retinaScaling,dims.zoomY/this.scaleY/retinaScaling);this._applyPatternGradientTransform(pCtx,filler);pCtx.fillStyle=filler.toLive(ctx);pCtx.fill();ctx.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2);ctx.scale(retinaScaling*this.scaleX/dims.zoomX,retinaScaling*this.scaleY/dims.zoomY);ctx.strokeStyle=pCtx.createPattern(pCanvas,'no-repeat');},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2};},_assignTransformMatrixProps:function(){if(this.transformMatrix){var options=fabric.util.qrDecompose(this.transformMatrix);this.flipX=false;this.flipY=false;this.set('scaleX',options.scaleX);this.set('scaleY',options.scaleY);this.angle=options.angle;this.skewX=options.skewX;this.skewY=0;}},_removeTransformMatrix:function(preserveAspectRatioOptions){var center=this._findCenterFromElement();if(this.transformMatrix){this._assignTransformMatrixProps();center=fabric.util.transformPoint(center,this.transformMatrix);}
this.transformMatrix=null;if(preserveAspectRatioOptions){this.scaleX*=preserveAspectRatioOptions.scaleX;this.scaleY*=preserveAspectRatioOptions.scaleY;this.cropX=preserveAspectRatioOptions.cropX;this.cropY=preserveAspectRatioOptions.cropY;center.x+=preserveAspectRatioOptions.offsetLeft;center.y+=preserveAspectRatioOptions.offsetTop;this.width=preserveAspectRatioOptions.width;this.height=preserveAspectRatioOptions.height;}
this.setPositionByOrigin(center,'center','center');},clone:function(callback,propertiesToInclude){var objectForm=this.toObject(propertiesToInclude);if(this.constructor.fromObject){this.constructor.fromObject(objectForm,callback);}
else{fabric.Object._fromObject('Object',objectForm,callback);}},cloneAsImage:function(callback,options){var canvasEl=this.toCanvasElement(options);if(callback){callback(new fabric.Image(canvasEl));}
return this;},toCanvasElement:function(options){options||(options={});var utils=fabric.util,origParams=utils.saveObjectTransform(this),originalGroup=this.group,originalShadow=this.shadow,abs=Math.abs,multiplier=(options.multiplier||1)*(options.enableRetinaScaling?fabric.devicePixelRatio:1);delete this.group;if(options.withoutTransform){utils.resetObjectTransform(this);}
if(options.withoutShadow){this.shadow=null;}
var el=fabric.util.createCanvasElement(),boundingRect=this.getBoundingRect(true,true),shadow=this.shadow,scaling,shadowOffset={x:0,y:0},shadowBlur,width,height;if(shadow){shadowBlur=shadow.blur;if(shadow.nonScaling){scaling={scaleX:1,scaleY:1};}
else{scaling=this.getObjectScaling();}
shadowOffset.x=2*Math.round(abs(shadow.offsetX)+shadowBlur)*(abs(scaling.scaleX));shadowOffset.y=2*Math.round(abs(shadow.offsetY)+shadowBlur)*(abs(scaling.scaleY));}
width=boundingRect.width+shadowOffset.x;height=boundingRect.height+shadowOffset.y;el.width=Math.ceil(width);el.height=Math.ceil(height);var canvas=new fabric.StaticCanvas(el,{enableRetinaScaling:false,renderOnAddRemove:false,skipOffscreen:false,});if(options.format==='jpeg'){canvas.backgroundColor='#fff';}
this.setPositionByOrigin(new fabric.Point(canvas.width/2,canvas.height/2),'center','center');var originalCanvas=this.canvas;canvas.add(this);var canvasEl=canvas.toCanvasElement(multiplier||1,options);this.shadow=originalShadow;this.set('canvas',originalCanvas);if(originalGroup){this.group=originalGroup;}
this.set(origParams).setCoords();canvas._objects=[];canvas.dispose();canvas=null;return canvasEl;},toDataURL:function(options){options||(options={});return fabric.util.toDataURL(this.toCanvasElement(options),options.format||'png',options.quality||1);},isType:function(type){return this.type===type;},complexity:function(){return 1;},toJSON:function(propertiesToInclude){return this.toObject(propertiesToInclude);},rotate:function(angle){var shouldCenterOrigin=(this.originX!=='center'||this.originY!=='center')&&this.centeredRotation;if(shouldCenterOrigin){this._setOriginToCenter();}
this.set('angle',angle);if(shouldCenterOrigin){this._resetOrigin();}
return this;},centerH:function(){this.canvas&&this.canvas.centerObjectH(this);return this;},viewportCenterH:function(){this.canvas&&this.canvas.viewportCenterObjectH(this);return this;},centerV:function(){this.canvas&&this.canvas.centerObjectV(this);return this;},viewportCenterV:function(){this.canvas&&this.canvas.viewportCenterObjectV(this);return this;},center:function(){this.canvas&&this.canvas.centerObject(this);return this;},viewportCenter:function(){this.canvas&&this.canvas.viewportCenterObject(this);return this;},getLocalPointer:function(e,pointer){pointer=pointer||this.canvas.getPointer(e);var pClicked=new fabric.Point(pointer.x,pointer.y),objectLeftTop=this._getLeftTopCoords();if(this.angle){pClicked=fabric.util.rotatePoint(pClicked,objectLeftTop,degreesToRadians(-this.angle));}
return{x:pClicked.x-objectLeftTop.x,y:pClicked.y-objectLeftTop.y};},_setupCompositeOperation:function(ctx){if(this.globalCompositeOperation){ctx.globalCompositeOperation=this.globalCompositeOperation;}}});fabric.util.createAccessors&&fabric.util.createAccessors(fabric.Object);extend(fabric.Object.prototype,fabric.Observable);fabric.Object.NUM_FRACTION_DIGITS=2;fabric.Object._fromObject=function(className,object,callback,extraParam){var klass=fabric[className];object=clone(object,true);fabric.util.enlivenPatterns([object.fill,object.stroke],function(patterns){if(typeof patterns[0]!=='undefined'){object.fill=patterns[0];}
if(typeof patterns[1]!=='undefined'){object.stroke=patterns[1];}
fabric.util.enlivenObjects([object.clipPath],function(enlivedProps){object.clipPath=enlivedProps[0];var instance=extraParam?new klass(object[extraParam],object):new klass(object);callback&&callback(instance);});});};fabric.Object.__uid=0;})(true?exports:0);(function(){var degreesToRadians=fabric.util.degreesToRadians,originXOffset={left:-0.5,center:0,right:0.5},originYOffset={top:-0.5,center:0,bottom:0.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(point,fromOriginX,fromOriginY,toOriginX,toOriginY){var x=point.x,y=point.y,offsetX,offsetY,dim;if(typeof fromOriginX==='string'){fromOriginX=originXOffset[fromOriginX];}
else{fromOriginX-=0.5;}
if(typeof toOriginX==='string'){toOriginX=originXOffset[toOriginX];}
else{toOriginX-=0.5;}
offsetX=toOriginX-fromOriginX;if(typeof fromOriginY==='string'){fromOriginY=originYOffset[fromOriginY];}
else{fromOriginY-=0.5;}
if(typeof toOriginY==='string'){toOriginY=originYOffset[toOriginY];}
else{toOriginY-=0.5;}
offsetY=toOriginY-fromOriginY;if(offsetX||offsetY){dim=this._getTransformedDimensions();x=point.x+offsetX*dim.x;y=point.y+offsetY*dim.y;}
return new fabric.Point(x,y);},translateToCenterPoint:function(point,originX,originY){var p=this.translateToGivenOrigin(point,originX,originY,'center','center');if(this.angle){return fabric.util.rotatePoint(p,point,degreesToRadians(this.angle));}
return p;},translateToOriginPoint:function(center,originX,originY){var p=this.translateToGivenOrigin(center,'center','center',originX,originY);if(this.angle){return fabric.util.rotatePoint(p,center,degreesToRadians(this.angle));}
return p;},getCenterPoint:function(){var leftTop=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(leftTop,this.originX,this.originY);},getPointByOrigin:function(originX,originY){var center=this.getCenterPoint();return this.translateToOriginPoint(center,originX,originY);},toLocalPoint:function(point,originX,originY){var center=this.getCenterPoint(),p,p2;if(typeof originX!=='undefined'&&typeof originY!=='undefined'){p=this.translateToGivenOrigin(center,'center','center',originX,originY);}
else{p=new fabric.Point(this.left,this.top);}
p2=new fabric.Point(point.x,point.y);if(this.angle){p2=fabric.util.rotatePoint(p2,center,-degreesToRadians(this.angle));}
return p2.subtractEquals(p);},setPositionByOrigin:function(pos,originX,originY){var center=this.translateToCenterPoint(pos,originX,originY),position=this.translateToOriginPoint(center,this.originX,this.originY);this.set('left',position.x);this.set('top',position.y);},adjustPosition:function(to){var angle=degreesToRadians(this.angle),hypotFull=this.getScaledWidth(),xFull=fabric.util.cos(angle)*hypotFull,yFull=fabric.util.sin(angle)*hypotFull,offsetFrom,offsetTo;if(typeof this.originX==='string'){offsetFrom=originXOffset[this.originX];}
else{offsetFrom=this.originX-0.5;}
if(typeof to==='string'){offsetTo=originXOffset[to];}
else{offsetTo=to-0.5;}
this.left+=xFull*(offsetTo-offsetFrom);this.top+=yFull*(offsetTo-offsetFrom);this.setCoords();this.originX=to;},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var center=this.getCenterPoint();this.originX='center';this.originY='center';this.left=center.x;this.top=center.y;},_resetOrigin:function(){var originPoint=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=originPoint.x;this.top=originPoint.y;this._originalOriginX=null;this._originalOriginY=null;},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),'left','top');},});})();(function(){function arrayFromCoords(coords){return[new fabric.Point(coords.tl.x,coords.tl.y),new fabric.Point(coords.tr.x,coords.tr.y),new fabric.Point(coords.br.x,coords.br.y),new fabric.Point(coords.bl.x,coords.bl.y)];}
var util=fabric.util,degreesToRadians=util.degreesToRadians,multiplyMatrices=util.multiplyTransformMatrices,transformPoint=util.transformPoint;util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(absolute,calculate){if(calculate){return(absolute?this.calcACoords():this.calcLineCoords());}
if(!this.aCoords||!this.lineCoords){this.setCoords(true);}
return(absolute?this.aCoords:this.lineCoords);},getCoords:function(absolute,calculate){return arrayFromCoords(this._getCoords(absolute,calculate));},intersectsWithRect:function(pointTL,pointBR,absolute,calculate){var coords=this.getCoords(absolute,calculate),intersection=fabric.Intersection.intersectPolygonRectangle(coords,pointTL,pointBR);return intersection.status==='Intersection';},intersectsWithObject:function(other,absolute,calculate){var intersection=fabric.Intersection.intersectPolygonPolygon(this.getCoords(absolute,calculate),other.getCoords(absolute,calculate));return intersection.status==='Intersection'||other.isContainedWithinObject(this,absolute,calculate)||this.isContainedWithinObject(other,absolute,calculate);},isContainedWithinObject:function(other,absolute,calculate){var points=this.getCoords(absolute,calculate),otherCoords=absolute?other.aCoords:other.lineCoords,i=0,lines=other._getImageLines(otherCoords);for(;i<4;i++){if(!other.containsPoint(points[i],lines)){return false;}}
return true;},isContainedWithinRect:function(pointTL,pointBR,absolute,calculate){var boundingRect=this.getBoundingRect(absolute,calculate);return(boundingRect.left>=pointTL.x&&boundingRect.left+boundingRect.width<=pointBR.x&&boundingRect.top>=pointTL.y&&boundingRect.top+boundingRect.height<=pointBR.y);},containsPoint:function(point,lines,absolute,calculate){var coords=this._getCoords(absolute,calculate),lines=lines||this._getImageLines(coords),xPoints=this._findCrossPoints(point,lines);return(xPoints!==0&&xPoints%2===1);},isOnScreen:function(calculate){if(!this.canvas){return false;}
var pointTL=this.canvas.vptCoords.tl,pointBR=this.canvas.vptCoords.br;var points=this.getCoords(true,calculate);if(points.some(function(point){return point.x<=pointBR.x&&point.x>=pointTL.x&&point.y<=pointBR.y&&point.y>=pointTL.y;})){return true;}
if(this.intersectsWithRect(pointTL,pointBR,true,calculate)){return true;}
return this._containsCenterOfCanvas(pointTL,pointBR,calculate);},_containsCenterOfCanvas:function(pointTL,pointBR,calculate){var centerPoint={x:(pointTL.x+pointBR.x)/2,y:(pointTL.y+pointBR.y)/2};if(this.containsPoint(centerPoint,null,true,calculate)){return true;}
return false;},isPartiallyOnScreen:function(calculate){if(!this.canvas){return false;}
var pointTL=this.canvas.vptCoords.tl,pointBR=this.canvas.vptCoords.br;if(this.intersectsWithRect(pointTL,pointBR,true,calculate)){return true;}
var allPointsAreOutside=this.getCoords(true,calculate).every(function(point){return(point.x>=pointBR.x||point.x<=pointTL.x)&&(point.y>=pointBR.y||point.y<=pointTL.y);});return allPointsAreOutside&&this._containsCenterOfCanvas(pointTL,pointBR,calculate);},_getImageLines:function(oCoords){var lines={topline:{o:oCoords.tl,d:oCoords.tr},rightline:{o:oCoords.tr,d:oCoords.br},bottomline:{o:oCoords.br,d:oCoords.bl},leftline:{o:oCoords.bl,d:oCoords.tl}};return lines;},_findCrossPoints:function(point,lines){var b1,b2,a1,a2,xi,xcount=0,iLine;for(var lineKey in lines){iLine=lines[lineKey];if((iLine.o.y<point.y)&&(iLine.d.y<point.y)){continue;}
if((iLine.o.y>=point.y)&&(iLine.d.y>=point.y)){continue;}
if((iLine.o.x===iLine.d.x)&&(iLine.o.x>=point.x)){xi=iLine.o.x;}
else{b1=0;b2=(iLine.d.y-iLine.o.y)/(iLine.d.x-iLine.o.x);a1=point.y-b1*point.x;a2=iLine.o.y-b2*iLine.o.x;xi=-(a1-a2)/(b1-b2);}
if(xi>=point.x){xcount+=1;}
if(xcount===2){break;}}
return xcount;},getBoundingRect:function(absolute,calculate){var coords=this.getCoords(absolute,calculate);return util.makeBoundingBoxFromPoints(coords);},getScaledWidth:function(){return this._getTransformedDimensions().x;},getScaledHeight:function(){return this._getTransformedDimensions().y;},_constrainScale:function(value){if(Math.abs(value)<this.minScaleLimit){if(value<0){return-this.minScaleLimit;}
else{return this.minScaleLimit;}}
else if(value===0){return 0.0001;}
return value;},scale:function(value){this._set('scaleX',value);this._set('scaleY',value);return this.setCoords();},scaleToWidth:function(value,absolute){var boundingRectFactor=this.getBoundingRect(absolute).width/this.getScaledWidth();return this.scale(value/this.width/boundingRectFactor);},scaleToHeight:function(value,absolute){var boundingRectFactor=this.getBoundingRect(absolute).height/this.getScaledHeight();return this.scale(value/this.height/boundingRectFactor);},calcCoords:function(absolute){if(absolute){return this.calcACoords();}
return this.calcOCoords();},calcLineCoords:function(){var vpt=this.getViewportTransform(),padding=this.padding,angle=degreesToRadians(this.angle),cos=util.cos(angle),sin=util.sin(angle),cosP=cos*padding,sinP=sin*padding,cosPSinP=cosP+sinP,cosPMinusSinP=cosP-sinP,aCoords=this.calcACoords();var lineCoords={tl:transformPoint(aCoords.tl,vpt),tr:transformPoint(aCoords.tr,vpt),bl:transformPoint(aCoords.bl,vpt),br:transformPoint(aCoords.br,vpt),};if(padding){lineCoords.tl.x-=cosPMinusSinP;lineCoords.tl.y-=cosPSinP;lineCoords.tr.x+=cosPSinP;lineCoords.tr.y-=cosPMinusSinP;lineCoords.bl.x-=cosPSinP;lineCoords.bl.y+=cosPMinusSinP;lineCoords.br.x+=cosPMinusSinP;lineCoords.br.y+=cosPSinP;}
return lineCoords;},calcOCoords:function(){var rotateMatrix=this._calcRotateMatrix(),translateMatrix=this._calcTranslateMatrix(),vpt=this.getViewportTransform(),startMatrix=multiplyMatrices(vpt,translateMatrix),finalMatrix=multiplyMatrices(startMatrix,rotateMatrix),finalMatrix=multiplyMatrices(finalMatrix,[1/vpt[0],0,0,1/vpt[3],0,0]),dim=this._calculateCurrentDimensions(),coords={};this.forEachControl(function(control,key,fabricObject){coords[key]=control.positionHandler(dim,finalMatrix,fabricObject);});return coords;},calcACoords:function(){var rotateMatrix=this._calcRotateMatrix(),translateMatrix=this._calcTranslateMatrix(),finalMatrix=multiplyMatrices(translateMatrix,rotateMatrix),dim=this._getTransformedDimensions(),w=dim.x/2,h=dim.y/2;return{tl:transformPoint({x:-w,y:-h},finalMatrix),tr:transformPoint({x:w,y:-h},finalMatrix),bl:transformPoint({x:-w,y:h},finalMatrix),br:transformPoint({x:w,y:h},finalMatrix)};},setCoords:function(skipCorners){this.aCoords=this.calcACoords();this.lineCoords=this.group?this.aCoords:this.calcLineCoords();if(skipCorners){return this;}
this.oCoords=this.calcOCoords();this._setCornerCoords&&this._setCornerCoords();return this;},_calcRotateMatrix:function(){return util.calcRotateMatrix(this);},_calcTranslateMatrix:function(){var center=this.getCenterPoint();return[1,0,0,1,center.x,center.y];},transformMatrixKey:function(skipGroup){var sep='_',prefix='';if(!skipGroup&&this.group){prefix=this.group.transformMatrixKey(skipGroup)+sep;};return prefix+this.top+sep+this.left+sep+this.scaleX+sep+this.scaleY+
sep+this.skewX+sep+this.skewY+sep+this.angle+sep+this.originX+sep+this.originY+
sep+this.width+sep+this.height+sep+this.strokeWidth+this.flipX+this.flipY;},calcTransformMatrix:function(skipGroup){var matrix=this.calcOwnMatrix();if(skipGroup||!this.group){return matrix;}
var key=this.transformMatrixKey(skipGroup),cache=this.matrixCache||(this.matrixCache={});if(cache.key===key){return cache.value;}
if(this.group){matrix=multiplyMatrices(this.group.calcTransformMatrix(false),matrix);}
cache.key=key;cache.value=matrix;return matrix;},calcOwnMatrix:function(){var key=this.transformMatrixKey(true),cache=this.ownMatrixCache||(this.ownMatrixCache={});if(cache.key===key){return cache.value;}
var tMatrix=this._calcTranslateMatrix(),options={angle:this.angle,translateX:tMatrix[4],translateY:tMatrix[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY,};cache.key=key;cache.value=util.composeMatrix(options);return cache.value;},_calcDimensionsTransformMatrix:function(skewX,skewY,flipping){return util.calcDimensionsMatrix({skewX:skewX,skewY:skewY,scaleX:this.scaleX*(flipping&&this.flipX?-1:1),scaleY:this.scaleY*(flipping&&this.flipY?-1:1)});},_getNonTransformedDimensions:function(){var strokeWidth=this.strokeWidth,w=this.width+strokeWidth,h=this.height+strokeWidth;return{x:w,y:h};},_getTransformedDimensions:function(skewX,skewY){if(typeof skewX==='undefined'){skewX=this.skewX;}
if(typeof skewY==='undefined'){skewY=this.skewY;}
var dimensions,dimX,dimY,noSkew=skewX===0&&skewY===0;if(this.strokeUniform){dimX=this.width;dimY=this.height;}
else{dimensions=this._getNonTransformedDimensions();dimX=dimensions.x;dimY=dimensions.y;}
if(noSkew){return this._finalizeDimensions(dimX*this.scaleX,dimY*this.scaleY);}
var bbox=util.sizeAfterTransform(dimX,dimY,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:skewX,skewY:skewY,});return this._finalizeDimensions(bbox.x,bbox.y);},_finalizeDimensions:function(width,height){return this.strokeUniform?{x:width+this.strokeWidth,y:height+this.strokeWidth}:{x:width,y:height};},_calculateCurrentDimensions:function(){var vpt=this.getViewportTransform(),dim=this._getTransformedDimensions(),p=transformPoint(dim,vpt,true);return p.scalarAdd(2*this.padding);},});})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this);}
else if(this.canvas){this.canvas.sendToBack(this);}
return this;},bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this);}
else if(this.canvas){this.canvas.bringToFront(this);}
return this;},sendBackwards:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,intersecting);}
else if(this.canvas){this.canvas.sendBackwards(this,intersecting);}
return this;},bringForward:function(intersecting){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,intersecting);}
else if(this.canvas){this.canvas.bringForward(this,intersecting);}
return this;},moveTo:function(index){if(this.group&&this.group.type!=='activeSelection'){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,index);}
else if(this.canvas){this.canvas.moveTo(this,index);}
return this;}});(function(){function getSvgColorString(prop,value){if(!value){return prop+': none; ';}
else if(value.toLive){return prop+': url(#SVGID_'+value.id+'); ';}
else{var color=new fabric.Color(value),str=prop+': '+color.toRgb()+'; ',opacity=color.getAlpha();if(opacity!==1){str+=prop+'-opacity: '+opacity.toString()+'; ';}
return str;}}
var toFixed=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(skipShadow){var fillRule=this.fillRule?this.fillRule:'nonzero',strokeWidth=this.strokeWidth?this.strokeWidth:'0',strokeDashArray=this.strokeDashArray?this.strokeDashArray.join(' '):'none',strokeDashOffset=this.strokeDashOffset?this.strokeDashOffset:'0',strokeLineCap=this.strokeLineCap?this.strokeLineCap:'butt',strokeLineJoin=this.strokeLineJoin?this.strokeLineJoin:'miter',strokeMiterLimit=this.strokeMiterLimit?this.strokeMiterLimit:'4',opacity=typeof this.opacity!=='undefined'?this.opacity:'1',visibility=this.visible?'':' visibility: hidden;',filter=skipShadow?'':this.getSvgFilter(),fill=getSvgColorString('fill',this.fill),stroke=getSvgColorString('stroke',this.stroke);return[stroke,'stroke-width: ',strokeWidth,'; ','stroke-dasharray: ',strokeDashArray,'; ','stroke-linecap: ',strokeLineCap,'; ','stroke-dashoffset: ',strokeDashOffset,'; ','stroke-linejoin: ',strokeLineJoin,'; ','stroke-miterlimit: ',strokeMiterLimit,'; ',fill,'fill-rule: ',fillRule,'; ','opacity: ',opacity,';',filter,visibility].join('');},getSvgSpanStyles:function(style,useWhiteSpace){var term='; ';var fontFamily=style.fontFamily?'font-family: '+(((style.fontFamily.indexOf('\'')===-1&&style.fontFamily.indexOf('"')===-1)?'\''+style.fontFamily+'\'':style.fontFamily))+term:'';var strokeWidth=style.strokeWidth?'stroke-width: '+style.strokeWidth+term:'',fontFamily=fontFamily,fontSize=style.fontSize?'font-size: '+style.fontSize+'px'+term:'',fontStyle=style.fontStyle?'font-style: '+style.fontStyle+term:'',fontWeight=style.fontWeight?'font-weight: '+style.fontWeight+term:'',fill=style.fill?getSvgColorString('fill',style.fill):'',stroke=style.stroke?getSvgColorString('stroke',style.stroke):'',textDecoration=this.getSvgTextDecoration(style),deltaY=style.deltaY?'baseline-shift: '+(-style.deltaY)+'; ':'';if(textDecoration){textDecoration='text-decoration: '+textDecoration+term;}
return[stroke,strokeWidth,fontFamily,fontSize,fontStyle,fontWeight,textDecoration,fill,deltaY,useWhiteSpace?'white-space: pre; ':''].join('');},getSvgTextDecoration:function(style){return['overline','underline','line-through'].filter(function(decoration){return style[decoration.replace('-','')];}).join(' ');},getSvgFilter:function(){return this.shadow?'filter: url(#SVGID_'+this.shadow.id+');':'';},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':'',this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':'',].join('');},getSvgTransform:function(full,additionalTransform){var transform=full?this.calcTransformMatrix():this.calcOwnMatrix(),svgTransform='transform="'+fabric.util.matrixToSVG(transform);return svgTransform+
(additionalTransform||'')+'" ';},_setSVGBg:function(textBgRects){if(this.backgroundColor){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;textBgRects.push('\t\t<rect ',this._getFillAttributes(this.backgroundColor),' x="',toFixed(-this.width/2,NUM_FRACTION_DIGITS),'" y="',toFixed(-this.height/2,NUM_FRACTION_DIGITS),'" width="',toFixed(this.width,NUM_FRACTION_DIGITS),'" height="',toFixed(this.height,NUM_FRACTION_DIGITS),'"></rect>\n');}},toSVG:function(reviver){return this._createBaseSVGMarkup(this._toSVG(reviver),{reviver:reviver});},toClipPathSVG:function(reviver){return'\t'+this._createBaseClipPathSVGMarkup(this._toSVG(reviver),{reviver:reviver});},_createBaseClipPathSVGMarkup:function(objectMarkup,options){options=options||{};var reviver=options.reviver,additionalTransform=options.additionalTransform||'',commonPieces=[this.getSvgTransform(true,additionalTransform),this.getSvgCommons(),].join(''),index=objectMarkup.indexOf('COMMON_PARTS');objectMarkup[index]=commonPieces;return reviver?reviver(objectMarkup.join('')):objectMarkup.join('');},_createBaseSVGMarkup:function(objectMarkup,options){options=options||{};var noStyle=options.noStyle,reviver=options.reviver,styleInfo=noStyle?'':'style="'+this.getSvgStyles()+'" ',shadowInfo=options.withShadow?'style="'+this.getSvgFilter()+'" ':'',clipPath=this.clipPath,vectorEffect=this.strokeUniform?'vector-effect="non-scaling-stroke" ':'',absoluteClipPath=clipPath&&clipPath.absolutePositioned,stroke=this.stroke,fill=this.fill,shadow=this.shadow,commonPieces,markup=[],clipPathMarkup,index=objectMarkup.indexOf('COMMON_PARTS'),additionalTransform=options.additionalTransform;if(clipPath){clipPath.clipPathId='CLIPPATH_'+fabric.Object.__uid++;clipPathMarkup='<clipPath id="'+clipPath.clipPathId+'" >\n'+
clipPath.toClipPathSVG(reviver)+'</clipPath>\n';}
if(absoluteClipPath){markup.push('<g ',shadowInfo,this.getSvgCommons(),' >\n');}
markup.push('<g ',this.getSvgTransform(false),!absoluteClipPath?shadowInfo+this.getSvgCommons():'',' >\n');commonPieces=[styleInfo,vectorEffect,noStyle?'':this.addPaintOrder(),' ',additionalTransform?'transform="'+additionalTransform+'" ':'',].join('');objectMarkup[index]=commonPieces;if(fill&&fill.toLive){markup.push(fill.toSVG(this));}
if(stroke&&stroke.toLive){markup.push(stroke.toSVG(this));}
if(shadow){markup.push(shadow.toSVG(this));}
if(clipPath){markup.push(clipPathMarkup);}
markup.push(objectMarkup.join(''));markup.push('</g>\n');absoluteClipPath&&markup.push('</g>\n');return reviver?reviver(markup.join('')):markup.join('');},addPaintOrder:function(){return this.paintFirst!=='fill'?' paint-order="'+this.paintFirst+'" ':'';}});})();(function(){var extend=fabric.util.object.extend,originalSet='stateProperties';function saveProps(origin,destination,props){var tmpObj={},deep=true;props.forEach(function(prop){tmpObj[prop]=origin[prop];});extend(origin[destination],tmpObj,deep);}
function _isEqual(origValue,currentValue,firstPass){if(origValue===currentValue){return true;}
else if(Array.isArray(origValue)){if(!Array.isArray(currentValue)||origValue.length!==currentValue.length){return false;}
for(var i=0,len=origValue.length;i<len;i++){if(!_isEqual(origValue[i],currentValue[i])){return false;}}
return true;}
else if(origValue&&typeof origValue==='object'){var keys=Object.keys(origValue),key;if(!currentValue||typeof currentValue!=='object'||(!firstPass&&keys.length!==Object.keys(currentValue).length)){return false;}
for(var i=0,len=keys.length;i<len;i++){key=keys[i];if(key==='canvas'||key==='group'){continue;}
if(!_isEqual(origValue[key],currentValue[key])){return false;}}
return true;}}
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(propertySet){propertySet=propertySet||originalSet;var dashedPropertySet='_'+propertySet;if(Object.keys(this[dashedPropertySet]).length<this[propertySet].length){return true;}
return!_isEqual(this[dashedPropertySet],this,true);},saveState:function(options){var propertySet=options&&options.propertySet||originalSet,destination='_'+propertySet;if(!this[destination]){return this.setupState(options);}
saveProps(this,destination,this[propertySet]);if(options&&options.stateProperties){saveProps(this,destination,options.stateProperties);}
return this;},setupState:function(options){options=options||{};var propertySet=options.propertySet||originalSet;options.propertySet=propertySet;this['_'+propertySet]={};this.saveState(options);return this;}});})();(function(){var degreesToRadians=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(pointer,forTouch){if(!this.hasControls||this.group||(!this.canvas||this.canvas._activeObject!==this)){return false;}
var ex=pointer.x,ey=pointer.y,xPoints,lines,keys=Object.keys(this.oCoords),j=keys.length-1,i;this.__corner=0;for(;j>=0;j--){i=keys[j];if(!this.isControlVisible(i)){continue;}
lines=this._getImageLines(forTouch?this.oCoords[i].touchCorner:this.oCoords[i].corner);xPoints=this._findCrossPoints({x:ex,y:ey},lines);if(xPoints!==0&&xPoints%2===1){this.__corner=i;return i;}}
return false;},forEachControl:function(fn){for(var i in this.controls){fn(this.controls[i],i,this);};},_setCornerCoords:function(){var coords=this.oCoords;for(var control in coords){var controlObject=this.controls[control];coords[control].corner=controlObject.calcCornerCoords(this.angle,this.cornerSize,coords[control].x,coords[control].y,false);coords[control].touchCorner=controlObject.calcCornerCoords(this.angle,this.touchCornerSize,coords[control].x,coords[control].y,true);}},drawSelectionBackground:function(ctx){if(!this.selectionBackgroundColor||(this.canvas&&!this.canvas.interactive)||(this.canvas&&this.canvas._activeObject!==this)){return this;}
ctx.save();var center=this.getCenterPoint(),wh=this._calculateCurrentDimensions(),vpt=this.canvas.viewportTransform;ctx.translate(center.x,center.y);ctx.scale(1/vpt[0],1/vpt[3]);ctx.rotate(degreesToRadians(this.angle));ctx.fillStyle=this.selectionBackgroundColor;ctx.fillRect(-wh.x/2,-wh.y/2,wh.x,wh.y);ctx.restore();return this;},drawBorders:function(ctx,styleOverride){styleOverride=styleOverride||{};var wh=this._calculateCurrentDimensions(),strokeWidth=this.borderScaleFactor,width=wh.x+strokeWidth,height=wh.y+strokeWidth,hasControls=typeof styleOverride.hasControls!=='undefined'?styleOverride.hasControls:this.hasControls,shouldStroke=false;ctx.save();ctx.strokeStyle=styleOverride.borderColor||this.borderColor;this._setLineDash(ctx,styleOverride.borderDashArray||this.borderDashArray);ctx.strokeRect(-width/2,-height/2,width,height);if(hasControls){ctx.beginPath();this.forEachControl(function(control,key,fabricObject){if(control.withConnection&&control.getVisibility(fabricObject,key)){shouldStroke=true;ctx.moveTo(control.x*width,control.y*height);ctx.lineTo(control.x*width+control.offsetX,control.y*height+control.offsetY);}});if(shouldStroke){ctx.stroke();}}
ctx.restore();return this;},drawBordersInGroup:function(ctx,options,styleOverride){styleOverride=styleOverride||{};var bbox=fabric.util.sizeAfterTransform(this.width,this.height,options),strokeWidth=this.strokeWidth,strokeUniform=this.strokeUniform,borderScaleFactor=this.borderScaleFactor,width=bbox.x+strokeWidth*(strokeUniform?this.canvas.getZoom():options.scaleX)+borderScaleFactor,height=bbox.y+strokeWidth*(strokeUniform?this.canvas.getZoom():options.scaleY)+borderScaleFactor;ctx.save();this._setLineDash(ctx,styleOverride.borderDashArray||this.borderDashArray);ctx.strokeStyle=styleOverride.borderColor||this.borderColor;ctx.strokeRect(-width/2,-height/2,width,height);ctx.restore();return this;},drawControls:function(ctx,styleOverride){styleOverride=styleOverride||{};ctx.save();var retinaScaling=this.canvas.getRetinaScaling(),matrix,p;ctx.setTransform(retinaScaling,0,0,retinaScaling,0,0);ctx.strokeStyle=ctx.fillStyle=styleOverride.cornerColor||this.cornerColor;if(!this.transparentCorners){ctx.strokeStyle=styleOverride.cornerStrokeColor||this.cornerStrokeColor;}
this._setLineDash(ctx,styleOverride.cornerDashArray||this.cornerDashArray);this.setCoords();if(this.group){matrix=this.group.calcTransformMatrix();}
this.forEachControl(function(control,key,fabricObject){p=fabricObject.oCoords[key];if(control.getVisibility(fabricObject,key)){if(matrix){p=fabric.util.transformPoint(p,matrix);}
control.render(ctx,p.x,p.y,styleOverride,fabricObject);}});ctx.restore();return this;},isControlVisible:function(controlKey){return this.controls[controlKey]&&this.controls[controlKey].getVisibility(this,controlKey);},setControlVisible:function(controlKey,visible){if(!this._controlsVisibility){this._controlsVisibility={};}
this._controlsVisibility[controlKey]=visible;return this;},setControlsVisibility:function(options){options||(options={});for(var p in options){this.setControlVisible(p,options[p]);}
return this;},onDeselect:function(){},onSelect:function(){}});})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(value){object.set('left',value);_this.requestRenderAll();onChange();},onComplete:function(){object.setCoords();onComplete();}});return this;},fxCenterObjectV:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(value){object.set('top',value);_this.requestRenderAll();onChange();},onComplete:function(){object.setCoords();onComplete();}});return this;},fxRemove:function(object,callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:object.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(value){object.set('opacity',value);_this.requestRenderAll();onChange();},onComplete:function(){_this.remove(object);onComplete();}});return this;}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==='object'){var propsToAnimate=[],prop,skipCallbacks;for(prop in arguments[0]){propsToAnimate.push(prop);}
for(var i=0,len=propsToAnimate.length;i<len;i++){prop=propsToAnimate[i];skipCallbacks=i!==len-1;this._animate(prop,arguments[0][prop],arguments[1],skipCallbacks);}}
else{this._animate.apply(this,arguments);}
return this;},_animate:function(property,to,options,skipCallbacks){var _this=this,propPair;to=to.toString();if(!options){options={};}
else{options=fabric.util.object.clone(options);}
if(~property.indexOf('.')){propPair=property.split('.');}
var propIsColor=_this.colorProperties.indexOf(property)>-1||(propPair&&_this.colorProperties.indexOf(propPair[1])>-1);var currentValue=propPair?this.get(propPair[0])[propPair[1]]:this.get(property);if(!('from'in options)){options.from=currentValue;}
if(!propIsColor){if(~to.indexOf('=')){to=currentValue+parseFloat(to.replace('=',''));}
else{to=parseFloat(to);}}
var _options={startValue:options.from,endValue:to,byValue:options.by,easing:options.easing,duration:options.duration,abort:options.abort&&function(value,valueProgress,timeProgress){return options.abort.call(_this,value,valueProgress,timeProgress);},onChange:function(value,valueProgress,timeProgress){if(propPair){_this[propPair[0]][propPair[1]]=value;}
else{_this.set(property,value);}
if(skipCallbacks){return;}
options.onChange&&options.onChange(value,valueProgress,timeProgress);},onComplete:function(value,valueProgress,timeProgress){if(skipCallbacks){return;}
_this.setCoords();options.onComplete&&options.onComplete(value,valueProgress,timeProgress);}};if(propIsColor){return fabric.util.animateColor(_options.startValue,_options.endValue,_options.duration,_options);}
else{return fabric.util.animate(_options);}}});(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,clone=fabric.util.object.clone,coordProps={x1:1,x2:1,y1:1,y2:1};if(fabric.Line){fabric.warn('fabric.Line is already defined');return;}
fabric.Line=fabric.util.createClass(fabric.Object,{type:'line',x1:0,y1:0,x2:0,y2:0,cacheProperties:fabric.Object.prototype.cacheProperties.concat('x1','x2','y1','y2'),initialize:function(points,options){if(!points){points=[0,0,0,0];}
this.callSuper('initialize',options);this.set('x1',points[0]);this.set('y1',points[1]);this.set('x2',points[2]);this.set('y2',points[3]);this._setWidthHeight(options);},_setWidthHeight:function(options){options||(options={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left='left'in options?options.left:this._getLeftToOriginX();this.top='top'in options?options.top:this._getTopToOriginY();},_set:function(key,value){this.callSuper('_set',key,value);if(typeof coordProps[key]!=='undefined'){this._setWidthHeight();}
return this;},_getLeftToOriginX:makeEdgeToOriginGetter({origin:'originX',axis1:'x1',axis2:'x2',dimension:'width'},{nearest:'left',center:'center',farthest:'right'}),_getTopToOriginY:makeEdgeToOriginGetter({origin:'originY',axis1:'y1',axis2:'y2',dimension:'height'},{nearest:'top',center:'center',farthest:'bottom'}),_render:function(ctx){ctx.beginPath();var p=this.calcLinePoints();ctx.moveTo(p.x1,p.y1);ctx.lineTo(p.x2,p.y2);ctx.lineWidth=this.strokeWidth;var origStrokeStyle=ctx.strokeStyle;ctx.strokeStyle=this.stroke||ctx.fillStyle;this.stroke&&this._renderStroke(ctx);ctx.strokeStyle=origStrokeStyle;},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2,};},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),this.calcLinePoints());},_getNonTransformedDimensions:function(){var dim=this.callSuper('_getNonTransformedDimensions');if(this.strokeLineCap==='butt'){if(this.width===0){dim.y-=this.strokeWidth;}
if(this.height===0){dim.x-=this.strokeWidth;}}
return dim;},calcLinePoints:function(){var xMult=this.x1<=this.x2?-1:1,yMult=this.y1<=this.y2?-1:1,x1=(xMult*this.width*0.5),y1=(yMult*this.height*0.5),x2=(xMult*this.width*-0.5),y2=(yMult*this.height*-0.5);return{x1:x1,x2:x2,y1:y1,y2:y2};},_toSVG:function(){var p=this.calcLinePoints();return['<line ','COMMON_PARTS','x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,'" />\n'];},});fabric.Line.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));fabric.Line.fromElement=function(element,callback,options){options=options||{};var parsedAttributes=fabric.parseAttributes(element,fabric.Line.ATTRIBUTE_NAMES),points=[parsedAttributes.x1||0,parsedAttributes.y1||0,parsedAttributes.x2||0,parsedAttributes.y2||0];callback(new fabric.Line(points,extend(parsedAttributes,options)));};fabric.Line.fromObject=function(object,callback){function _callback(instance){delete instance.points;callback&&callback(instance);};var options=clone(object,true);options.points=[object.x1,object.y1,object.x2,object.y2];fabric.Object._fromObject('Line',options,_callback,'points');};function makeEdgeToOriginGetter(propertyNames,originValues){var origin=propertyNames.origin,axis1=propertyNames.axis1,axis2=propertyNames.axis2,dimension=propertyNames.dimension,nearest=originValues.nearest,center=originValues.center,farthest=originValues.farthest;return function(){switch(this.get(origin)){case nearest:return Math.min(this.get(axis1),this.get(axis2));case center:return Math.min(this.get(axis1),this.get(axis2))+(0.5*this.get(dimension));case farthest:return Math.max(this.get(axis1),this.get(axis2));}};}})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),pi=Math.PI;if(fabric.Circle){fabric.warn('fabric.Circle is already defined.');return;}
fabric.Circle=fabric.util.createClass(fabric.Object,{type:'circle',radius:0,startAngle:0,endAngle:pi*2,cacheProperties:fabric.Object.prototype.cacheProperties.concat('radius','startAngle','endAngle'),_set:function(key,value){this.callSuper('_set',key,value);if(key==='radius'){this.setRadius(value);}
return this;},toObject:function(propertiesToInclude){return this.callSuper('toObject',['radius','startAngle','endAngle'].concat(propertiesToInclude));},_toSVG:function(){var svgString,x=0,y=0,angle=(this.endAngle-this.startAngle)%(2*pi);if(angle===0){svgString=['<circle ','COMMON_PARTS','cx="'+x+'" cy="'+y+'" ','r="',this.radius,'" />\n'];}
else{var startX=fabric.util.cos(this.startAngle)*this.radius,startY=fabric.util.sin(this.startAngle)*this.radius,endX=fabric.util.cos(this.endAngle)*this.radius,endY=fabric.util.sin(this.endAngle)*this.radius,largeFlag=angle>pi?'1':'0';svgString=['<path d="M '+startX+' '+startY,' A '+this.radius+' '+this.radius,' 0 ',+largeFlag+' 1',' '+endX+' '+endY,'" ','COMMON_PARTS',' />\n'];}
return svgString;},_render:function(ctx){ctx.beginPath();ctx.arc(0,0,this.radius,this.startAngle,this.endAngle,false);this._renderPaintInOrder(ctx);},getRadiusX:function(){return this.get('radius')*this.get('scaleX');},getRadiusY:function(){return this.get('radius')*this.get('scaleY');},setRadius:function(value){this.radius=value;return this.set('width',value*2).set('height',value*2);},});fabric.Circle.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));fabric.Circle.fromElement=function(element,callback){var parsedAttributes=fabric.parseAttributes(element,fabric.Circle.ATTRIBUTE_NAMES);if(!isValidRadius(parsedAttributes)){throw new Error('value of `r` attribute is required and can not be negative');}
parsedAttributes.left=(parsedAttributes.left||0)-parsedAttributes.radius;parsedAttributes.top=(parsedAttributes.top||0)-parsedAttributes.radius;callback(new fabric.Circle(parsedAttributes));};function isValidRadius(attributes){return(('radius'in attributes)&&(attributes.radius>=0));}
fabric.Circle.fromObject=function(object,callback){fabric.Object._fromObject('Circle',object,callback);};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Triangle){fabric.warn('fabric.Triangle is already defined');return;}
fabric.Triangle=fabric.util.createClass(fabric.Object,{type:'triangle',width:100,height:100,_render:function(ctx){var widthBy2=this.width/2,heightBy2=this.height/2;ctx.beginPath();ctx.moveTo(-widthBy2,heightBy2);ctx.lineTo(0,-heightBy2);ctx.lineTo(widthBy2,heightBy2);ctx.closePath();this._renderPaintInOrder(ctx);},_toSVG:function(){var widthBy2=this.width/2,heightBy2=this.height/2,points=[-widthBy2+' '+heightBy2,'0 '+-heightBy2,widthBy2+' '+heightBy2].join(',');return['<polygon ','COMMON_PARTS','points="',points,'" />'];},});fabric.Triangle.fromObject=function(object,callback){return fabric.Object._fromObject('Triangle',object,callback);};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),piBy2=Math.PI*2;if(fabric.Ellipse){fabric.warn('fabric.Ellipse is already defined.');return;}
fabric.Ellipse=fabric.util.createClass(fabric.Object,{type:'ellipse',rx:0,ry:0,cacheProperties:fabric.Object.prototype.cacheProperties.concat('rx','ry'),initialize:function(options){this.callSuper('initialize',options);this.set('rx',options&&options.rx||0);this.set('ry',options&&options.ry||0);},_set:function(key,value){this.callSuper('_set',key,value);switch(key){case'rx':this.rx=value;this.set('width',value*2);break;case'ry':this.ry=value;this.set('height',value*2);break;}
return this;},getRx:function(){return this.get('rx')*this.get('scaleX');},getRy:function(){return this.get('ry')*this.get('scaleY');},toObject:function(propertiesToInclude){return this.callSuper('toObject',['rx','ry'].concat(propertiesToInclude));},_toSVG:function(){return['<ellipse ','COMMON_PARTS','cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n'];},_render:function(ctx){ctx.beginPath();ctx.save();ctx.transform(1,0,0,this.ry/this.rx,0,0);ctx.arc(0,0,this.rx,0,piBy2,false);ctx.restore();this._renderPaintInOrder(ctx);},});fabric.Ellipse.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));fabric.Ellipse.fromElement=function(element,callback){var parsedAttributes=fabric.parseAttributes(element,fabric.Ellipse.ATTRIBUTE_NAMES);parsedAttributes.left=(parsedAttributes.left||0)-parsedAttributes.rx;parsedAttributes.top=(parsedAttributes.top||0)-parsedAttributes.ry;callback(new fabric.Ellipse(parsedAttributes));};fabric.Ellipse.fromObject=function(object,callback){fabric.Object._fromObject('Ellipse',object,callback);};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend;if(fabric.Rect){fabric.warn('fabric.Rect is already defined');return;}
fabric.Rect=fabric.util.createClass(fabric.Object,{stateProperties:fabric.Object.prototype.stateProperties.concat('rx','ry'),type:'rect',rx:0,ry:0,cacheProperties:fabric.Object.prototype.cacheProperties.concat('rx','ry'),initialize:function(options){this.callSuper('initialize',options);this._initRxRy();},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx;}
else if(this.ry&&!this.rx){this.rx=this.ry;}},_render:function(ctx){var rx=this.rx?Math.min(this.rx,this.width/2):0,ry=this.ry?Math.min(this.ry,this.height/2):0,w=this.width,h=this.height,x=-this.width/2,y=-this.height/2,isRounded=rx!==0||ry!==0,k=1-0.5522847498;ctx.beginPath();ctx.moveTo(x+rx,y);ctx.lineTo(x+w-rx,y);isRounded&&ctx.bezierCurveTo(x+w-k*rx,y,x+w,y+k*ry,x+w,y+ry);ctx.lineTo(x+w,y+h-ry);isRounded&&ctx.bezierCurveTo(x+w,y+h-k*ry,x+w-k*rx,y+h,x+w-rx,y+h);ctx.lineTo(x+rx,y+h);isRounded&&ctx.bezierCurveTo(x+k*rx,y+h,x,y+h-k*ry,x,y+h-ry);ctx.lineTo(x,y+ry);isRounded&&ctx.bezierCurveTo(x,y+k*ry,x+k*rx,y,x+rx,y);ctx.closePath();this._renderPaintInOrder(ctx);},toObject:function(propertiesToInclude){return this.callSuper('toObject',['rx','ry'].concat(propertiesToInclude));},_toSVG:function(){var x=-this.width/2,y=-this.height/2;return['<rect ','COMMON_PARTS','x="',x,'" y="',y,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n'];},});fabric.Rect.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));fabric.Rect.fromElement=function(element,callback,options){if(!element){return callback(null);}
options=options||{};var parsedAttributes=fabric.parseAttributes(element,fabric.Rect.ATTRIBUTE_NAMES);parsedAttributes.left=parsedAttributes.left||0;parsedAttributes.top=parsedAttributes.top||0;parsedAttributes.height=parsedAttributes.height||0;parsedAttributes.width=parsedAttributes.width||0;var rect=new fabric.Rect(extend((options?fabric.util.object.clone(options):{}),parsedAttributes));rect.visible=rect.visible&&rect.width>0&&rect.height>0;callback(rect);};fabric.Rect.fromObject=function(object,callback){return fabric.Object._fromObject('Rect',object,callback);};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,min=fabric.util.array.min,max=fabric.util.array.max,toFixed=fabric.util.toFixed;if(fabric.Polyline){fabric.warn('fabric.Polyline is already defined');return;}
fabric.Polyline=fabric.util.createClass(fabric.Object,{type:'polyline',points:null,cacheProperties:fabric.Object.prototype.cacheProperties.concat('points'),initialize:function(points,options){options=options||{};this.points=points||[];this.callSuper('initialize',options);this._setPositionDimensions(options);},_setPositionDimensions:function(options){var calcDim=this._calcDimensions(options),correctLeftTop;this.width=calcDim.width;this.height=calcDim.height;if(!options.fromSVG){correctLeftTop=this.translateToGivenOrigin({x:calcDim.left-this.strokeWidth/2,y:calcDim.top-this.strokeWidth/2},'left','top',this.originX,this.originY);}
if(typeof options.left==='undefined'){this.left=options.fromSVG?calcDim.left:correctLeftTop.x;}
if(typeof options.top==='undefined'){this.top=options.fromSVG?calcDim.top:correctLeftTop.y;}
this.pathOffset={x:calcDim.left+this.width/2,y:calcDim.top+this.height/2};},_calcDimensions:function(){var points=this.points,minX=min(points,'x')||0,minY=min(points,'y')||0,maxX=max(points,'x')||0,maxY=max(points,'y')||0,width=(maxX-minX),height=(maxY-minY);return{left:minX,top:minY,width:width,height:height};},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),{points:this.points.concat()});},_toSVG:function(){var points=[],diffX=this.pathOffset.x,diffY=this.pathOffset.y,NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;for(var i=0,len=this.points.length;i<len;i++){points.push(toFixed(this.points[i].x-diffX,NUM_FRACTION_DIGITS),',',toFixed(this.points[i].y-diffY,NUM_FRACTION_DIGITS),' ');}
return['<'+this.type+' ','COMMON_PARTS','points="',points.join(''),'" />\n'];},commonRender:function(ctx){var point,len=this.points.length,x=this.pathOffset.x,y=this.pathOffset.y;if(!len||isNaN(this.points[len-1].y)){return false;}
ctx.beginPath();ctx.moveTo(this.points[0].x-x,this.points[0].y-y);for(var i=0;i<len;i++){point=this.points[i];ctx.lineTo(point.x-x,point.y-y);}
return true;},_render:function(ctx){if(!this.commonRender(ctx)){return;}
this._renderPaintInOrder(ctx);},complexity:function(){return this.get('points').length;}});fabric.Polyline.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();fabric.Polyline.fromElementGenerator=function(_class){return function(element,callback,options){if(!element){return callback(null);}
options||(options={});var points=fabric.parsePointsAttribute(element.getAttribute('points')),parsedAttributes=fabric.parseAttributes(element,fabric[_class].ATTRIBUTE_NAMES);parsedAttributes.fromSVG=true;callback(new fabric[_class](points,extend(parsedAttributes,options)));};};fabric.Polyline.fromElement=fabric.Polyline.fromElementGenerator('Polyline');fabric.Polyline.fromObject=function(object,callback){return fabric.Object._fromObject('Polyline',object,callback,'points');};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.Polygon){fabric.warn('fabric.Polygon is already defined');return;}
fabric.Polygon=fabric.util.createClass(fabric.Polyline,{type:'polygon',_render:function(ctx){if(!this.commonRender(ctx)){return;}
ctx.closePath();this._renderPaintInOrder(ctx);},});fabric.Polygon.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat();fabric.Polygon.fromElement=fabric.Polyline.fromElementGenerator('Polygon');fabric.Polygon.fromObject=function(object,callback){fabric.Object._fromObject('Polygon',object,callback,'points');};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max,extend=fabric.util.object.extend,_toString=Object.prototype.toString,toFixed=fabric.util.toFixed;if(fabric.Path){fabric.warn('fabric.Path is already defined');return;}
fabric.Path=fabric.util.createClass(fabric.Object,{type:'path',path:null,cacheProperties:fabric.Object.prototype.cacheProperties.concat('path','fillRule'),stateProperties:fabric.Object.prototype.stateProperties.concat('path'),initialize:function(path,options){options=options||{};this.callSuper('initialize',options);if(!path){path=[];}
var fromArray=_toString.call(path)==='[object Array]';this.path=fabric.util.makePathSimpler(fromArray?path:fabric.util.parsePath(path));if(!this.path){return;}
fabric.Polyline.prototype._setPositionDimensions.call(this,options);},_renderPathCommands:function(ctx){var current,subpathStartX=0,subpathStartY=0,x=0,y=0,controlX=0,controlY=0,l=-this.pathOffset.x,t=-this.pathOffset.y;ctx.beginPath();for(var i=0,len=this.path.length;i<len;++i){current=this.path[i];switch(current[0]){case'L':x=current[1];y=current[2];ctx.lineTo(x+l,y+t);break;case'M':x=current[1];y=current[2];subpathStartX=x;subpathStartY=y;ctx.moveTo(x+l,y+t);break;case'C':x=current[5];y=current[6];controlX=current[3];controlY=current[4];ctx.bezierCurveTo(current[1]+l,current[2]+t,controlX+l,controlY+t,x+l,y+t);break;case'Q':ctx.quadraticCurveTo(current[1]+l,current[2]+t,current[3]+l,current[4]+t);x=current[3];y=current[4];controlX=current[1];controlY=current[2];break;case'z':case'Z':x=subpathStartX;y=subpathStartY;ctx.closePath();break;}}},_render:function(ctx){this._renderPathCommands(ctx);this._renderPaintInOrder(ctx);},toString:function(){return'#<fabric.Path ('+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+' }>';},toObject:function(propertiesToInclude){return extend(this.callSuper('toObject',propertiesToInclude),{path:this.path.map(function(item){return item.slice();}),});},toDatalessObject:function(propertiesToInclude){var o=this.toObject(['sourcePath'].concat(propertiesToInclude));if(o.sourcePath){delete o.path;}
return o;},_toSVG:function(){var path=fabric.util.joinPath(this.path);return['<path ','COMMON_PARTS','d="',path,'" stroke-linecap="round" ','/>\n'];},_getOffsetTransform:function(){var digits=fabric.Object.NUM_FRACTION_DIGITS;return' translate('+toFixed(-this.pathOffset.x,digits)+', '+
toFixed(-this.pathOffset.y,digits)+')';},toClipPathSVG:function(reviver){var additionalTransform=this._getOffsetTransform();return'\t'+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:reviver,additionalTransform:additionalTransform});},toSVG:function(reviver){var additionalTransform=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:reviver,additionalTransform:additionalTransform});},complexity:function(){return this.path.length;},_calcDimensions:function(){var aX=[],aY=[],current,subpathStartX=0,subpathStartY=0,x=0,y=0,bounds;for(var i=0,len=this.path.length;i<len;++i){current=this.path[i];switch(current[0]){case'L':x=current[1];y=current[2];bounds=[];break;case'M':x=current[1];y=current[2];subpathStartX=x;subpathStartY=y;bounds=[];break;case'C':bounds=fabric.util.getBoundsOfCurve(x,y,current[1],current[2],current[3],current[4],current[5],current[6]);x=current[5];y=current[6];break;case'Q':bounds=fabric.util.getBoundsOfCurve(x,y,current[1],current[2],current[1],current[2],current[3],current[4]);x=current[3];y=current[4];break;case'z':case'Z':x=subpathStartX;y=subpathStartY;break;}
bounds.forEach(function(point){aX.push(point.x);aY.push(point.y);});aX.push(x);aY.push(y);}
var minX=min(aX)||0,minY=min(aY)||0,maxX=max(aX)||0,maxY=max(aY)||0,deltaX=maxX-minX,deltaY=maxY-minY;return{left:minX,top:minY,width:deltaX,height:deltaY};}});fabric.Path.fromObject=function(object,callback){if(typeof object.sourcePath==='string'){var pathUrl=object.sourcePath;fabric.loadSVGFromURL(pathUrl,function(elements){var path=elements[0];path.setOptions(object);callback&&callback(path);});}
else{fabric.Object._fromObject('Path',object,callback,'path');}};fabric.Path.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(['d']);fabric.Path.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Path.ATTRIBUTE_NAMES);parsedAttributes.fromSVG=true;callback(new fabric.Path(parsedAttributes.d,extend(parsedAttributes,options)));};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),min=fabric.util.array.min,max=fabric.util.array.max;if(fabric.Group){return;}
fabric.Group=fabric.util.createClass(fabric.Object,fabric.Collection,{type:'group',strokeWidth:0,subTargetCheck:false,cacheProperties:[],useSetOnGroup:false,initialize:function(objects,options,isAlreadyGrouped){options=options||{};this._objects=[];isAlreadyGrouped&&this.callSuper('initialize',options);this._objects=objects||[];for(var i=this._objects.length;i--;){this._objects[i].group=this;}
if(!isAlreadyGrouped){var center=options&&options.centerPoint;if(options.originX!==undefined){this.originX=options.originX;}
if(options.originY!==undefined){this.originY=options.originY;}
center||this._calcBounds();this._updateObjectsCoords(center);delete options.centerPoint;this.callSuper('initialize',options);}
else{this._updateObjectsACoords();}
this.setCoords();},_updateObjectsACoords:function(){var skipControls=true;for(var i=this._objects.length;i--;){this._objects[i].setCoords(skipControls);}},_updateObjectsCoords:function(center){var center=center||this.getCenterPoint();for(var i=this._objects.length;i--;){this._updateObjectCoords(this._objects[i],center);}},_updateObjectCoords:function(object,center){var objectLeft=object.left,objectTop=object.top,skipControls=true;object.set({left:objectLeft-center.x,top:objectTop-center.y});object.group=this;object.setCoords(skipControls);},toString:function(){return'#<fabric.Group: ('+this.complexity()+')>';},addWithUpdate:function(object){var nested=!!this.group;this._restoreObjectsState();fabric.util.resetObjectTransform(this);if(object){if(nested){fabric.util.removeTransformFromObject(object,this.group.calcTransformMatrix());}
this._objects.push(object);object.group=this;object._set('canvas',this.canvas);}
this._calcBounds();this._updateObjectsCoords();this.dirty=true;if(nested){this.group.addWithUpdate();}
else{this.setCoords();}
return this;},removeWithUpdate:function(object){this._restoreObjectsState();fabric.util.resetObjectTransform(this);this.remove(object);this._calcBounds();this._updateObjectsCoords();this.setCoords();this.dirty=true;return this;},_onObjectAdded:function(object){this.dirty=true;object.group=this;object._set('canvas',this.canvas);},_onObjectRemoved:function(object){this.dirty=true;delete object.group;},_set:function(key,value){var i=this._objects.length;if(this.useSetOnGroup){while(i--){this._objects[i].setOnGroup(key,value);}}
if(key==='canvas'){while(i--){this._objects[i]._set(key,value);}}
fabric.Object.prototype._set.call(this,key,value);},toObject:function(propertiesToInclude){var _includeDefaultValues=this.includeDefaultValues;var objsToObject=this._objects.filter(function(obj){return!obj.excludeFromExport;}).map(function(obj){var originalDefaults=obj.includeDefaultValues;obj.includeDefaultValues=_includeDefaultValues;var _obj=obj.toObject(propertiesToInclude);obj.includeDefaultValues=originalDefaults;return _obj;});var obj=fabric.Object.prototype.toObject.call(this,propertiesToInclude);obj.objects=objsToObject;return obj;},toDatalessObject:function(propertiesToInclude){var objsToObject,sourcePath=this.sourcePath;if(sourcePath){objsToObject=sourcePath;}
else{var _includeDefaultValues=this.includeDefaultValues;objsToObject=this._objects.map(function(obj){var originalDefaults=obj.includeDefaultValues;obj.includeDefaultValues=_includeDefaultValues;var _obj=obj.toDatalessObject(propertiesToInclude);obj.includeDefaultValues=originalDefaults;return _obj;});}
var obj=fabric.Object.prototype.toDatalessObject.call(this,propertiesToInclude);obj.objects=objsToObject;return obj;},render:function(ctx){this._transformDone=true;this.callSuper('render',ctx);this._transformDone=false;},shouldCache:function(){var ownCache=fabric.Object.prototype.shouldCache.call(this);if(ownCache){for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i].willDrawShadow()){this.ownCaching=false;return false;}}}
return ownCache;},willDrawShadow:function(){if(fabric.Object.prototype.willDrawShadow.call(this)){return true;}
for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i].willDrawShadow()){return true;}}
return false;},isOnACache:function(){return this.ownCaching||(this.group&&this.group.isOnACache());},drawObject:function(ctx){for(var i=0,len=this._objects.length;i<len;i++){this._objects[i].render(ctx);}
this._drawClipPath(ctx);},isCacheDirty:function(skipCanvas){if(this.callSuper('isCacheDirty',skipCanvas)){return true;}
if(!this.statefullCache){return false;}
for(var i=0,len=this._objects.length;i<len;i++){if(this._objects[i].isCacheDirty(true)){if(this._cacheCanvas){var x=this.cacheWidth/this.zoomX,y=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-x/2,-y/2,x,y);}
return true;}}
return false;},_restoreObjectsState:function(){var groupMatrix=this.calcOwnMatrix();this._objects.forEach(function(object){fabric.util.addTransformToObject(object,groupMatrix);delete object.group;object.setCoords();});return this;},realizeTransform:function(object,parentMatrix){fabric.util.addTransformToObject(object,parentMatrix);return object;},destroy:function(){this._objects.forEach(function(object){object.set('dirty',true);});return this._restoreObjectsState();},toActiveSelection:function(){if(!this.canvas){return;}
var objects=this._objects,canvas=this.canvas;this._objects=[];var options=this.toObject();delete options.objects;var activeSelection=new fabric.ActiveSelection([]);activeSelection.set(options);activeSelection.type='activeSelection';canvas.remove(this);objects.forEach(function(object){object.group=activeSelection;object.dirty=true;canvas.add(object);});activeSelection.canvas=canvas;activeSelection._objects=objects;canvas._activeObject=activeSelection;activeSelection.setCoords();return activeSelection;},ungroupOnCanvas:function(){return this._restoreObjectsState();},setObjectsCoords:function(){var skipControls=true;this.forEachObject(function(object){object.setCoords(skipControls);});return this;},_calcBounds:function(onlyWidthHeight){var aX=[],aY=[],o,prop,coords,props=['tr','br','bl','tl'],i=0,iLen=this._objects.length,j,jLen=props.length;for(;i<iLen;++i){o=this._objects[i];coords=o.calcACoords();for(j=0;j<jLen;j++){prop=props[j];aX.push(coords[prop].x);aY.push(coords[prop].y);}
o.aCoords=coords;}
this._getBounds(aX,aY,onlyWidthHeight);},_getBounds:function(aX,aY,onlyWidthHeight){var minXY=new fabric.Point(min(aX),min(aY)),maxXY=new fabric.Point(max(aX),max(aY)),top=minXY.y||0,left=minXY.x||0,width=(maxXY.x-minXY.x)||0,height=(maxXY.y-minXY.y)||0;this.width=width;this.height=height;if(!onlyWidthHeight){this.setPositionByOrigin({x:left,y:top},'left','top');}},_toSVG:function(reviver){var svgString=['<g ','COMMON_PARTS',' >\n'];for(var i=0,len=this._objects.length;i<len;i++){svgString.push('\t\t',this._objects[i].toSVG(reviver));}
svgString.push('</g>\n');return svgString;},getSvgStyles:function(){var opacity=typeof this.opacity!=='undefined'&&this.opacity!==1?'opacity: '+this.opacity+';':'',visibility=this.visible?'':' visibility: hidden;';return[opacity,this.getSvgFilter(),visibility].join('');},toClipPathSVG:function(reviver){var svgString=[];for(var i=0,len=this._objects.length;i<len;i++){svgString.push('\t',this._objects[i].toClipPathSVG(reviver));}
return this._createBaseClipPathSVGMarkup(svgString,{reviver:reviver});},});fabric.Group.fromObject=function(object,callback){var objects=object.objects,options=fabric.util.object.clone(object,true);delete options.objects;if(typeof objects==='string'){fabric.loadSVGFromURL(objects,function(elements){var group=fabric.util.groupSVGElements(elements,object,objects);group.set(options);callback&&callback(group);});return;}
fabric.util.enlivenObjects(objects,function(enlivenedObjects){fabric.util.enlivenObjects([object.clipPath],function(enlivedClipPath){var options=fabric.util.object.clone(object,true);options.clipPath=enlivedClipPath[0];delete options.objects;callback&&callback(new fabric.Group(enlivenedObjects,options,true));});});};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={});if(fabric.ActiveSelection){return;}
fabric.ActiveSelection=fabric.util.createClass(fabric.Group,{type:'activeSelection',initialize:function(objects,options){options=options||{};this._objects=objects||[];for(var i=this._objects.length;i--;){this._objects[i].group=this;}
if(options.originX){this.originX=options.originX;}
if(options.originY){this.originY=options.originY;}
this._calcBounds();this._updateObjectsCoords();fabric.Object.prototype.initialize.call(this,options);this.setCoords();},toGroup:function(){var objects=this._objects.concat();this._objects=[];var options=fabric.Object.prototype.toObject.call(this);var newGroup=new fabric.Group([]);delete options.type;newGroup.set(options);objects.forEach(function(object){object.canvas.remove(object);object.group=newGroup;});newGroup._objects=objects;if(!this.canvas){return newGroup;}
var canvas=this.canvas;canvas.add(newGroup);canvas._activeObject=newGroup;newGroup.setCoords();return newGroup;},onDeselect:function(){this.destroy();return false;},toString:function(){return'#<fabric.ActiveSelection: ('+this.complexity()+')>';},shouldCache:function(){return false;},isOnACache:function(){return false;},_renderControls:function(ctx,styleOverride,childrenOverride){ctx.save();ctx.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;this.callSuper('_renderControls',ctx,styleOverride);childrenOverride=childrenOverride||{};if(typeof childrenOverride.hasControls==='undefined'){childrenOverride.hasControls=false;}
childrenOverride.forActiveSelection=true;for(var i=0,len=this._objects.length;i<len;i++){this._objects[i]._renderControls(ctx,childrenOverride);}
ctx.restore();},});fabric.ActiveSelection.fromObject=function(object,callback){fabric.util.enlivenObjects(object.objects,function(enlivenedObjects){delete object.objects;callback&&callback(new fabric.ActiveSelection(enlivenedObjects,object,true));});};})(true?exports:0);(function(global){'use strict';var extend=fabric.util.object.extend;if(!global.fabric){global.fabric={};}
if(global.fabric.Image){fabric.warn('fabric.Image is already defined.');return;}
fabric.Image=fabric.util.createClass(fabric.Object,{type:'image',strokeWidth:0,srcFromAttribute:false,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:0.5,stateProperties:fabric.Object.prototype.stateProperties.concat('cropX','cropY'),cacheProperties:fabric.Object.prototype.cacheProperties.concat('cropX','cropY'),cacheKey:'',cropX:0,cropY:0,imageSmoothing:true,initialize:function(element,options){options||(options={});this.filters=[];this.cacheKey='texture'+fabric.Object.__uid++;this.callSuper('initialize',options);this._initElement(element,options);},getElement:function(){return this._element||{};},setElement:function(element,options){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+'_filtered');this._element=element;this._originalElement=element;this._initConfig(options);if(this.filters.length!==0){this.applyFilters();}
if(this.resizeFilter){this.applyResizeFilters();}
return this;},removeTexture:function(key){var backend=fabric.filterBackend;if(backend&&backend.evictCachesForKey){backend.evictCachesForKey(key);}},dispose:function(){this.removeTexture(this.cacheKey);this.removeTexture(this.cacheKey+'_filtered');this._cacheContext=undefined;['_originalElement','_element','_filteredEl','_cacheCanvas'].forEach((function(element){fabric.util.cleanUpJsdomNode(this[element]);this[element]=undefined;}).bind(this));},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null);},getOriginalSize:function(){var element=this.getElement();return{width:element.naturalWidth||element.width,height:element.naturalHeight||element.height};},_stroke:function(ctx){if(!this.stroke||this.strokeWidth===0){return;}
var w=this.width/2,h=this.height/2;ctx.beginPath();ctx.moveTo(-w,-h);ctx.lineTo(w,-h);ctx.lineTo(w,h);ctx.lineTo(-w,h);ctx.lineTo(-w,-h);ctx.closePath();},toObject:function(propertiesToInclude){var filters=[];this.filters.forEach(function(filterObj){if(filterObj){filters.push(filterObj.toObject());}});var object=extend(this.callSuper('toObject',['cropX','cropY'].concat(propertiesToInclude)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:filters,});if(this.resizeFilter){object.resizeFilter=this.resizeFilter.toObject();}
return object;},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height;},_toSVG:function(){var svgString=[],imageMarkup=[],strokeSvg,element=this._element,x=-this.width/2,y=-this.height/2,clipPath='',imageRendering='';if(!element){return[];}
if(this.hasCrop()){var clipPathId=fabric.Object.__uid++;svgString.push('<clipPath id="imageCrop_'+clipPathId+'">\n','\t<rect x="'+x+'" y="'+y+'" width="'+this.width+'" height="'+this.height+'" />\n','</clipPath>\n');clipPath=' clip-path="url(#imageCrop_'+clipPathId+')" ';}
if(!this.imageSmoothing){imageRendering='" image-rendering="optimizeSpeed';}
imageMarkup.push('\t<image ','COMMON_PARTS','xlink:href="',this.getSvgSrc(true),'" x="',x-this.cropX,'" y="',y-this.cropY,'" width="',element.width||element.naturalWidth,'" height="',element.height||element.height,imageRendering,'"',clipPath,'></image>\n');if(this.stroke||this.strokeDashArray){var origFill=this.fill;this.fill=null;strokeSvg=['\t<rect ','x="',x,'" y="',y,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'];this.fill=origFill;}
if(this.paintFirst!=='fill'){svgString=svgString.concat(strokeSvg,imageMarkup);}
else{svgString=svgString.concat(imageMarkup,strokeSvg);}
return svgString;},getSrc:function(filtered){var element=filtered?this._element:this._originalElement;if(element){if(element.toDataURL){return element.toDataURL();}
if(this.srcFromAttribute){return element.getAttribute('src');}
else{return element.src;}}
else{return this.src||'';}},setSrc:function(src,callback,options){fabric.util.loadImage(src,function(img,isError){this.setElement(img,options);this._setWidthHeight();callback&&callback(this,isError);},this,options&&options.crossOrigin);return this;},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>';},applyResizeFilters:function(){var filter=this.resizeFilter,minimumScale=this.minimumScaleTrigger,objectScale=this.getTotalObjectScaling(),scaleX=objectScale.scaleX,scaleY=objectScale.scaleY,elementToFilter=this._filteredEl||this._originalElement;if(this.group){this.set('dirty',true);}
if(!filter||(scaleX>minimumScale&&scaleY>minimumScale)){this._element=elementToFilter;this._filterScalingX=1;this._filterScalingY=1;this._lastScaleX=scaleX;this._lastScaleY=scaleY;return;}
if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend();}
var canvasEl=fabric.util.createCanvasElement(),cacheKey=this._filteredEl?(this.cacheKey+'_filtered'):this.cacheKey,sourceWidth=elementToFilter.width,sourceHeight=elementToFilter.height;canvasEl.width=sourceWidth;canvasEl.height=sourceHeight;this._element=canvasEl;this._lastScaleX=filter.scaleX=scaleX;this._lastScaleY=filter.scaleY=scaleY;fabric.filterBackend.applyFilters([filter],elementToFilter,sourceWidth,sourceHeight,this._element,cacheKey);this._filterScalingX=canvasEl.width/this._originalElement.width;this._filterScalingY=canvasEl.height/this._originalElement.height;},applyFilters:function(filters){filters=filters||this.filters||[];filters=filters.filter(function(filter){return filter&&!filter.isNeutralState();});this.set('dirty',true);this.removeTexture(this.cacheKey+'_filtered');if(filters.length===0){this._element=this._originalElement;this._filteredEl=null;this._filterScalingX=1;this._filterScalingY=1;return this;}
var imgElement=this._originalElement,sourceWidth=imgElement.naturalWidth||imgElement.width,sourceHeight=imgElement.naturalHeight||imgElement.height;if(this._element===this._originalElement){var canvasEl=fabric.util.createCanvasElement();canvasEl.width=sourceWidth;canvasEl.height=sourceHeight;this._element=canvasEl;this._filteredEl=canvasEl;}
else{this._element=this._filteredEl;this._filteredEl.getContext('2d').clearRect(0,0,sourceWidth,sourceHeight);this._lastScaleX=1;this._lastScaleY=1;}
if(!fabric.filterBackend){fabric.filterBackend=fabric.initFilterBackend();}
fabric.filterBackend.applyFilters(filters,this._originalElement,sourceWidth,sourceHeight,this._element,this.cacheKey);if(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height){this._filterScalingX=this._element.width/this._originalElement.width;this._filterScalingY=this._element.height/this._originalElement.height;}
return this;},_render:function(ctx){fabric.util.setImageSmoothing(ctx,this.imageSmoothing);if(this.isMoving!==true&&this.resizeFilter&&this._needsResize()){this.applyResizeFilters();}
this._stroke(ctx);this._renderPaintInOrder(ctx);},drawCacheOnCanvas:function(ctx){fabric.util.setImageSmoothing(ctx,this.imageSmoothing);fabric.Object.prototype.drawCacheOnCanvas.call(this,ctx);},shouldCache:function(){return this.needsItsOwnCache();},_renderFill:function(ctx){var elementToDraw=this._element;if(!elementToDraw){return;}
var scaleX=this._filterScalingX,scaleY=this._filterScalingY,w=this.width,h=this.height,min=Math.min,max=Math.max,cropX=max(this.cropX,0),cropY=max(this.cropY,0),elWidth=elementToDraw.naturalWidth||elementToDraw.width,elHeight=elementToDraw.naturalHeight||elementToDraw.height,sX=cropX*scaleX,sY=cropY*scaleY,sW=min(w*scaleX,elWidth-sX),sH=min(h*scaleY,elHeight-sY),x=-w/2,y=-h/2,maxDestW=min(w,elWidth/scaleX-cropX),maxDestH=min(h,elHeight/scaleY-cropY);elementToDraw&&ctx.drawImage(elementToDraw,sX,sY,sW,sH,x,y,maxDestW,maxDestH);},_needsResize:function(){var scale=this.getTotalObjectScaling();return(scale.scaleX!==this._lastScaleX||scale.scaleY!==this._lastScaleY);},_resetWidthHeight:function(){this.set(this.getOriginalSize());},_initElement:function(element,options){this.setElement(fabric.util.getById(element),options);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS);},_initConfig:function(options){options||(options={});this.setOptions(options);this._setWidthHeight(options);},_initFilters:function(filters,callback){if(filters&&filters.length){fabric.util.enlivenObjects(filters,function(enlivenedObjects){callback&&callback(enlivenedObjects);},'fabric.Image.filters');}
else{callback&&callback();}},_setWidthHeight:function(options){options||(options={});var el=this.getElement();this.width=options.width||el.naturalWidth||el.width||0;this.height=options.height||el.naturalHeight||el.height||0;},parsePreserveAspectRatioAttribute:function(){var pAR=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||''),rWidth=this._element.width,rHeight=this._element.height,scaleX=1,scaleY=1,offsetLeft=0,offsetTop=0,cropX=0,cropY=0,offset,pWidth=this.width,pHeight=this.height,parsedAttributes={width:pWidth,height:pHeight};if(pAR&&(pAR.alignX!=='none'||pAR.alignY!=='none')){if(pAR.meetOrSlice==='meet'){scaleX=scaleY=fabric.util.findScaleToFit(this._element,parsedAttributes);offset=(pWidth-rWidth*scaleX)/2;if(pAR.alignX==='Min'){offsetLeft=-offset;}
if(pAR.alignX==='Max'){offsetLeft=offset;}
offset=(pHeight-rHeight*scaleY)/2;if(pAR.alignY==='Min'){offsetTop=-offset;}
if(pAR.alignY==='Max'){offsetTop=offset;}}
if(pAR.meetOrSlice==='slice'){scaleX=scaleY=fabric.util.findScaleToCover(this._element,parsedAttributes);offset=rWidth-pWidth/scaleX;if(pAR.alignX==='Mid'){cropX=offset/2;}
if(pAR.alignX==='Max'){cropX=offset;}
offset=rHeight-pHeight/scaleY;if(pAR.alignY==='Mid'){cropY=offset/2;}
if(pAR.alignY==='Max'){cropY=offset;}
rWidth=pWidth/scaleX;rHeight=pHeight/scaleY;}}
else{scaleX=pWidth/rWidth;scaleY=pHeight/rHeight;}
return{width:rWidth,height:rHeight,scaleX:scaleX,scaleY:scaleY,offsetLeft:offsetLeft,offsetTop:offsetTop,cropX:cropX,cropY:cropY};}});fabric.Image.CSS_CANVAS='canvas-img';fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(_object,callback){var object=fabric.util.object.clone(_object);fabric.util.loadImage(object.src,function(img,isError){if(isError){callback&&callback(null,true);return;}
fabric.Image.prototype._initFilters.call(object,object.filters,function(filters){object.filters=filters||[];fabric.Image.prototype._initFilters.call(object,[object.resizeFilter],function(resizeFilters){object.resizeFilter=resizeFilters[0];fabric.util.enlivenObjects([object.clipPath],function(enlivedProps){object.clipPath=enlivedProps[0];var image=new fabric.Image(img,object);callback(image,false);});});});},null,object.crossOrigin);};fabric.Image.fromURL=function(url,callback,imgOptions){fabric.util.loadImage(url,function(img,isError){callback&&callback(new fabric.Image(img,imgOptions),isError);},null,imgOptions&&imgOptions.crossOrigin);};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x y width height preserveAspectRatio xlink:href crossOrigin image-rendering'.split(' '));fabric.Image.fromElement=function(element,callback,options){var parsedAttributes=fabric.parseAttributes(element,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(parsedAttributes['xlink:href'],callback,extend((options?fabric.util.object.clone(options):{}),parsedAttributes));};})(true?exports:0);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var angle=this.angle%360;if(angle>0){return Math.round((angle-1)/90)*90;}
return Math.round(angle/90)*90;},straighten:function(){this.rotate(this._getAngleValueForStraighten());return this;},fxStraighten:function(callbacks){callbacks=callbacks||{};var empty=function(){},onComplete=callbacks.onComplete||empty,onChange=callbacks.onChange||empty,_this=this;fabric.util.animate({startValue:this.get('angle'),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(value){_this.rotate(value);onChange();},onComplete:function(){_this.setCoords();onComplete();},});return this;}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(object){object.straighten();this.requestRenderAll();return this;},fxStraightenObject:function(object){object.fxStraighten({onChange:this.requestRenderAllBound});return this;}});(function(){'use strict';function testPrecision(gl,precision){var fragmentSource='precision '+precision+' float;\nvoid main(){}';var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragmentSource);gl.compileShader(fragmentShader);if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){return false;}
return true;}
fabric.isWebglSupported=function(tileSize){if(fabric.isLikelyNode){return false;}
tileSize=tileSize||fabric.WebglFilterBackend.prototype.tileSize;var canvas=document.createElement('canvas');var gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');var isSupported=false;if(gl){fabric.maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);isSupported=fabric.maxTextureSize>=tileSize;var precisions=['highp','mediump','lowp'];for(var i=0;i<3;i++){if(testPrecision(gl,precisions[i])){fabric.webGlPrecision=precisions[i];break;};}}
this.isSupported=isSupported;return isSupported;};fabric.WebglFilterBackend=WebglFilterBackend;function WebglFilterBackend(options){if(options&&options.tileSize){this.tileSize=options.tileSize;}
this.setupGLContext(this.tileSize,this.tileSize);this.captureGPUInfo();};WebglFilterBackend.prototype={tileSize:2048,resources:{},setupGLContext:function(width,height){this.dispose();this.createWebGLCanvas(width,height);this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]);this.chooseFastestCopyGLTo2DMethod(width,height);},chooseFastestCopyGLTo2DMethod:function(width,height){var canMeasurePerf=typeof window.performance!=='undefined',canUseImageData;try{new ImageData(1,1);canUseImageData=true;}
catch(e){canUseImageData=false;}
var canUseArrayBuffer=typeof ArrayBuffer!=='undefined';var canUseUint8Clamped=typeof Uint8ClampedArray!=='undefined';if(!(canMeasurePerf&&canUseImageData&&canUseArrayBuffer&&canUseUint8Clamped)){return;}
var targetCanvas=fabric.util.createCanvasElement();var imageBuffer=new ArrayBuffer(width*height*4);if(fabric.forceGLPutImageData){this.imageBuffer=imageBuffer;this.copyGLTo2D=copyGLTo2DPutImageData;return;}
var testContext={imageBuffer:imageBuffer,destinationWidth:width,destinationHeight:height,targetCanvas:targetCanvas};var startTime,drawImageTime,putImageDataTime;targetCanvas.width=width;targetCanvas.height=height;startTime=window.performance.now();copyGLTo2DDrawImage.call(testContext,this.gl,testContext);drawImageTime=window.performance.now()-startTime;startTime=window.performance.now();copyGLTo2DPutImageData.call(testContext,this.gl,testContext);putImageDataTime=window.performance.now()-startTime;if(drawImageTime>putImageDataTime){this.imageBuffer=imageBuffer;this.copyGLTo2D=copyGLTo2DPutImageData;}
else{this.copyGLTo2D=copyGLTo2DDrawImage;}},createWebGLCanvas:function(width,height){var canvas=fabric.util.createCanvasElement();canvas.width=width;canvas.height=height;var glOptions={alpha:true,premultipliedAlpha:false,depth:false,stencil:false,antialias:false},gl=canvas.getContext('webgl',glOptions);if(!gl){gl=canvas.getContext('experimental-webgl',glOptions);}
if(!gl){return;}
gl.clearColor(0,0,0,0);this.canvas=canvas;this.gl=gl;},applyFilters:function(filters,source,width,height,targetCanvas,cacheKey){var gl=this.gl;var cachedTexture;if(cacheKey){cachedTexture=this.getCachedTexture(cacheKey,source);}
var pipelineState={originalWidth:source.width||source.originalWidth,originalHeight:source.height||source.originalHeight,sourceWidth:width,sourceHeight:height,destinationWidth:width,destinationHeight:height,context:gl,sourceTexture:this.createTexture(gl,width,height,!cachedTexture&&source),targetTexture:this.createTexture(gl,width,height),originalTexture:cachedTexture||this.createTexture(gl,width,height,!cachedTexture&&source),passes:filters.length,webgl:true,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:targetCanvas};var tempFbo=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,tempFbo);filters.forEach(function(filter){filter&&filter.applyTo(pipelineState);});resizeCanvasIfNeeded(pipelineState);this.copyGLTo2D(gl,pipelineState);gl.bindTexture(gl.TEXTURE_2D,null);gl.deleteTexture(pipelineState.sourceTexture);gl.deleteTexture(pipelineState.targetTexture);gl.deleteFramebuffer(tempFbo);targetCanvas.getContext('2d').setTransform(1,0,0,1,0,0);return pipelineState;},dispose:function(){if(this.canvas){this.canvas=null;this.gl=null;}
this.clearWebGLCaches();},clearWebGLCaches:function(){this.programCache={};this.textureCache={};},createTexture:function(gl,width,height,textureImageSource){var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(textureImageSource){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,textureImageSource);}
else{gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);}
return texture;},getCachedTexture:function(uniqueId,textureImageSource){if(this.textureCache[uniqueId]){return this.textureCache[uniqueId];}
else{var texture=this.createTexture(this.gl,textureImageSource.width,textureImageSource.height,textureImageSource);this.textureCache[uniqueId]=texture;return texture;}},evictCachesForKey:function(cacheKey){if(this.textureCache[cacheKey]){this.gl.deleteTexture(this.textureCache[cacheKey]);delete this.textureCache[cacheKey];}},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo){return this.gpuInfo;}
var gl=this.gl,gpuInfo={renderer:'',vendor:''};if(!gl){return gpuInfo;}
var ext=gl.getExtension('WEBGL_debug_renderer_info');if(ext){var renderer=gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);var vendor=gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);if(renderer){gpuInfo.renderer=renderer.toLowerCase();}
if(vendor){gpuInfo.vendor=vendor.toLowerCase();}}
this.gpuInfo=gpuInfo;return gpuInfo;},};})();function resizeCanvasIfNeeded(pipelineState){var targetCanvas=pipelineState.targetCanvas,width=targetCanvas.width,height=targetCanvas.height,dWidth=pipelineState.destinationWidth,dHeight=pipelineState.destinationHeight;if(width!==dWidth||height!==dHeight){targetCanvas.width=dWidth;targetCanvas.height=dHeight;}}
function copyGLTo2DDrawImage(gl,pipelineState){var glCanvas=gl.canvas,targetCanvas=pipelineState.targetCanvas,ctx=targetCanvas.getContext('2d');ctx.translate(0,targetCanvas.height);ctx.scale(1,-1);var sourceY=glCanvas.height-targetCanvas.height;ctx.drawImage(glCanvas,0,sourceY,targetCanvas.width,targetCanvas.height,0,0,targetCanvas.width,targetCanvas.height);}
function copyGLTo2DPutImageData(gl,pipelineState){var targetCanvas=pipelineState.targetCanvas,ctx=targetCanvas.getContext('2d'),dWidth=pipelineState.destinationWidth,dHeight=pipelineState.destinationHeight,numBytes=dWidth*dHeight*4;var u8=new Uint8Array(this.imageBuffer,0,numBytes);var u8Clamped=new Uint8ClampedArray(this.imageBuffer,0,numBytes);gl.readPixels(0,0,dWidth,dHeight,gl.RGBA,gl.UNSIGNED_BYTE,u8);var imgData=new ImageData(u8Clamped,dWidth,dHeight);ctx.putImageData(imgData,0,0);}
(function(){'use strict';var noop=function(){};fabric.Canvas2dFilterBackend=Canvas2dFilterBackend;function Canvas2dFilterBackend(){};Canvas2dFilterBackend.prototype={evictCachesForKey:noop,dispose:noop,clearWebGLCaches:noop,resources:{},applyFilters:function(filters,sourceElement,sourceWidth,sourceHeight,targetCanvas){var ctx=targetCanvas.getContext('2d');ctx.drawImage(sourceElement,0,0,sourceWidth,sourceHeight);var imageData=ctx.getImageData(0,0,sourceWidth,sourceHeight);var originalImageData=ctx.getImageData(0,0,sourceWidth,sourceHeight);var pipelineState={sourceWidth:sourceWidth,sourceHeight:sourceHeight,imageData:imageData,originalEl:sourceElement,originalImageData:originalImageData,canvasEl:targetCanvas,ctx:ctx,filterBackend:this,};filters.forEach(function(filter){filter.applyTo(pipelineState);});if(pipelineState.imageData.width!==sourceWidth||pipelineState.imageData.height!==sourceHeight){targetCanvas.width=pipelineState.imageData.width;targetCanvas.height=pipelineState.imageData.height;}
ctx.putImageData(pipelineState.imageData,0,0);return pipelineState;},};})();fabric.Image=fabric.Image||{};fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:'BaseFilter',vertexSource:'attribute vec2 aPosition;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vTexCoord = aPosition;\n'+'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n'+'}',fragmentSource:'precision highp float;\n'+'varying vec2 vTexCoord;\n'+'uniform sampler2D uTexture;\n'+'void main() {\n'+'gl_FragColor = texture2D(uTexture, vTexCoord);\n'+'}',initialize:function(options){if(options){this.setOptions(options);}},setOptions:function(options){for(var prop in options){this[prop]=options[prop];}},createProgram:function(gl,fragmentSource,vertexSource){fragmentSource=fragmentSource||this.fragmentSource;vertexSource=vertexSource||this.vertexSource;if(fabric.webGlPrecision!=='highp'){fragmentSource=fragmentSource.replace(/precision highp float/g,'precision '+fabric.webGlPrecision+' float');}
var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,vertexSource);gl.compileShader(vertexShader);if(!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)){throw new Error('Vertex shader compile error for '+this.type+': '+
gl.getShaderInfoLog(vertexShader));}
var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragmentSource);gl.compileShader(fragmentShader);if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){throw new Error('Fragment shader compile error for '+this.type+': '+
gl.getShaderInfoLog(fragmentShader));}
var program=gl.createProgram();gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){throw new Error('Shader link error for "${this.type}" '+
gl.getProgramInfoLog(program));}
var attributeLocations=this.getAttributeLocations(gl,program);var uniformLocations=this.getUniformLocations(gl,program)||{};uniformLocations.uStepW=gl.getUniformLocation(program,'uStepW');uniformLocations.uStepH=gl.getUniformLocation(program,'uStepH');return{program:program,attributeLocations:attributeLocations,uniformLocations:uniformLocations};},getAttributeLocations:function(gl,program){return{aPosition:gl.getAttribLocation(program,'aPosition'),};},getUniformLocations:function(){return{};},sendAttributeData:function(gl,attributeLocations,aPositionData){var attributeLocation=attributeLocations.aPosition;var buffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buffer);gl.enableVertexAttribArray(attributeLocation);gl.vertexAttribPointer(attributeLocation,2,gl.FLOAT,false,0,0);gl.bufferData(gl.ARRAY_BUFFER,aPositionData,gl.STATIC_DRAW);},_setupFrameBuffer:function(options){var gl=options.context,width,height;if(options.passes>1){width=options.destinationWidth;height=options.destinationHeight;if(options.sourceWidth!==width||options.sourceHeight!==height){gl.deleteTexture(options.targetTexture);options.targetTexture=options.filterBackend.createTexture(gl,width,height);}
gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,options.targetTexture,0);}
else{gl.bindFramebuffer(gl.FRAMEBUFFER,null);gl.finish();}},_swapTextures:function(options){options.passes--;options.pass++;var temp=options.targetTexture;options.targetTexture=options.sourceTexture;options.sourceTexture=temp;},isNeutralState:function(){var main=this.mainParameter,_class=fabric.Image.filters[this.type].prototype;if(main){if(Array.isArray(_class[main])){for(var i=_class[main].length;i--;){if(this[main][i]!==_class[main][i]){return false;}}
return true;}
else{return _class[main]===this[main];}}
else{return false;}},applyTo:function(options){if(options.webgl){this._setupFrameBuffer(options);this.applyToWebGL(options);this._swapTextures(options);}
else{this.applyTo2d(options);}},retrieveShader:function(options){if(!options.programCache.hasOwnProperty(this.type)){options.programCache[this.type]=this.createProgram(options.context);}
return options.programCache[this.type];},applyToWebGL:function(options){var gl=options.context;var shader=this.retrieveShader(options);if(options.pass===0&&options.originalTexture){gl.bindTexture(gl.TEXTURE_2D,options.originalTexture);}
else{gl.bindTexture(gl.TEXTURE_2D,options.sourceTexture);}
gl.useProgram(shader.program);this.sendAttributeData(gl,shader.attributeLocations,options.aPosition);gl.uniform1f(shader.uniformLocations.uStepW,1/options.sourceWidth);gl.uniform1f(shader.uniformLocations.uStepH,1/options.sourceHeight);this.sendUniformData(gl,shader.uniformLocations);gl.viewport(0,0,options.destinationWidth,options.destinationHeight);gl.drawArrays(gl.TRIANGLE_STRIP,0,4);},bindAdditionalTexture:function(gl,texture,textureUnit){gl.activeTexture(textureUnit);gl.bindTexture(gl.TEXTURE_2D,texture);gl.activeTexture(gl.TEXTURE0);},unbindAdditionalTexture:function(gl,textureUnit){gl.activeTexture(textureUnit);gl.bindTexture(gl.TEXTURE_2D,null);gl.activeTexture(gl.TEXTURE0);},getMainParameter:function(){return this[this.mainParameter];},setMainParameter:function(value){this[this.mainParameter]=value;},sendUniformData:function(){},createHelpLayer:function(options){if(!options.helpLayer){var helpLayer=document.createElement('canvas');helpLayer.width=options.sourceWidth;helpLayer.height=options.sourceHeight;options.helpLayer=helpLayer;}},toObject:function(){var object={type:this.type},mainP=this.mainParameter;if(mainP){object[mainP]=this[mainP];}
return object;},toJSON:function(){return this.toObject();}});fabric.Image.filters.BaseFilter.fromObject=function(object,callback){var filter=new fabric.Image.filters[object.type](object);callback&&callback(filter);return filter;};(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.ColorMatrix=createClass(filters.BaseFilter,{type:'ColorMatrix',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'varying vec2 vTexCoord;\n'+'uniform mat4 uColorMatrix;\n'+'uniform vec4 uConstants;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'color *= uColorMatrix;\n'+'color += uConstants;\n'+'gl_FragColor = color;\n'+'}',matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:'matrix',colorsOnly:true,initialize:function(options){this.callSuper('initialize',options);this.matrix=this.matrix.slice(0);},applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,iLen=data.length,m=this.matrix,r,g,b,a,i,colorsOnly=this.colorsOnly;for(i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(colorsOnly){data[i]=r*m[0]+g*m[1]+b*m[2]+m[4]*255;data[i+1]=r*m[5]+g*m[6]+b*m[7]+m[9]*255;data[i+2]=r*m[10]+g*m[11]+b*m[12]+m[14]*255;}
else{a=data[i+3];data[i]=r*m[0]+g*m[1]+b*m[2]+a*m[3]+m[4]*255;data[i+1]=r*m[5]+g*m[6]+b*m[7]+a*m[8]+m[9]*255;data[i+2]=r*m[10]+g*m[11]+b*m[12]+a*m[13]+m[14]*255;data[i+3]=r*m[15]+g*m[16]+b*m[17]+a*m[18]+m[19]*255;}}},getUniformLocations:function(gl,program){return{uColorMatrix:gl.getUniformLocation(program,'uColorMatrix'),uConstants:gl.getUniformLocation(program,'uConstants'),};},sendUniformData:function(gl,uniformLocations){var m=this.matrix,matrix=[m[0],m[1],m[2],m[3],m[5],m[6],m[7],m[8],m[10],m[11],m[12],m[13],m[15],m[16],m[17],m[18]],constants=[m[4],m[9],m[14],m[19]];gl.uniformMatrix4fv(uniformLocations.uColorMatrix,false,matrix);gl.uniform4fv(uniformLocations.uConstants,constants);},});fabric.Image.filters.ColorMatrix.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Brightness=createClass(filters.BaseFilter,{type:'Brightness',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uBrightness;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'color.rgb += uBrightness;\n'+'gl_FragColor = color;\n'+'}',brightness:0,mainParameter:'brightness',applyTo2d:function(options){if(this.brightness===0){return;}
var imageData=options.imageData,data=imageData.data,i,len=data.length,brightness=Math.round(this.brightness*255);for(i=0;i<len;i+=4){data[i]=data[i]+brightness;data[i+1]=data[i+1]+brightness;data[i+2]=data[i+2]+brightness;}},getUniformLocations:function(gl,program){return{uBrightness:gl.getUniformLocation(program,'uBrightness'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uBrightness,this.brightness);},});fabric.Image.filters.Brightness.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Convolute=createClass(filters.BaseFilter,{type:'Convolute',opaque:false,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[9];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 0);\n'+'for (float h = 0.0; h < 3.0; h+=1.0) {\n'+'for (float w = 0.0; w < 3.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n'+'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n'+'}\n'+'}\n'+'gl_FragColor = color;\n'+'}',Convolute_3_0:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[9];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 1);\n'+'for (float h = 0.0; h < 3.0; h+=1.0) {\n'+'for (float w = 0.0; w < 3.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n'+'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n'+'}\n'+'}\n'+'float alpha = texture2D(uTexture, vTexCoord).a;\n'+'gl_FragColor = color;\n'+'gl_FragColor.a = alpha;\n'+'}',Convolute_5_1:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[25];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 0);\n'+'for (float h = 0.0; h < 5.0; h+=1.0) {\n'+'for (float w = 0.0; w < 5.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n'+'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n'+'}\n'+'}\n'+'gl_FragColor = color;\n'+'}',Convolute_5_0:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[25];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 1);\n'+'for (float h = 0.0; h < 5.0; h+=1.0) {\n'+'for (float w = 0.0; w < 5.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n'+'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n'+'}\n'+'}\n'+'float alpha = texture2D(uTexture, vTexCoord).a;\n'+'gl_FragColor = color;\n'+'gl_FragColor.a = alpha;\n'+'}',Convolute_7_1:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[49];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 0);\n'+'for (float h = 0.0; h < 7.0; h+=1.0) {\n'+'for (float w = 0.0; w < 7.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n'+'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n'+'}\n'+'}\n'+'gl_FragColor = color;\n'+'}',Convolute_7_0:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[49];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 1);\n'+'for (float h = 0.0; h < 7.0; h+=1.0) {\n'+'for (float w = 0.0; w < 7.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n'+'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n'+'}\n'+'}\n'+'float alpha = texture2D(uTexture, vTexCoord).a;\n'+'gl_FragColor = color;\n'+'gl_FragColor.a = alpha;\n'+'}',Convolute_9_1:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[81];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 0);\n'+'for (float h = 0.0; h < 9.0; h+=1.0) {\n'+'for (float w = 0.0; w < 9.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n'+'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n'+'}\n'+'}\n'+'gl_FragColor = color;\n'+'}',Convolute_9_0:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uMatrix[81];\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = vec4(0, 0, 0, 1);\n'+'for (float h = 0.0; h < 9.0; h+=1.0) {\n'+'for (float w = 0.0; w < 9.0; w+=1.0) {\n'+'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n'+'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n'+'}\n'+'}\n'+'float alpha = texture2D(uTexture, vTexCoord).a;\n'+'gl_FragColor = color;\n'+'gl_FragColor.a = alpha;\n'+'}',},retrieveShader:function(options){var size=Math.sqrt(this.matrix.length);var cacheKey=this.type+'_'+size+'_'+(this.opaque?1:0);var shaderSource=this.fragmentSource[cacheKey];if(!options.programCache.hasOwnProperty(cacheKey)){options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}
return options.programCache[cacheKey];},applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,weights=this.matrix,side=Math.round(Math.sqrt(weights.length)),halfSide=Math.floor(side/2),sw=imageData.width,sh=imageData.height,output=options.ctx.createImageData(sw,sh),dst=output.data,alphaFac=this.opaque?1:0,r,g,b,a,dstOff,scx,scy,srcOff,wt,x,y,cx,cy;for(y=0;y<sh;y++){for(x=0;x<sw;x++){dstOff=(y*sw+x)*4;r=0;g=0;b=0;a=0;for(cy=0;cy<side;cy++){for(cx=0;cx<side;cx++){scy=y+cy-halfSide;scx=x+cx-halfSide;if(scy<0||scy>=sh||scx<0||scx>=sw){continue;}
srcOff=(scy*sw+scx)*4;wt=weights[cy*side+cx];r+=data[srcOff]*wt;g+=data[srcOff+1]*wt;b+=data[srcOff+2]*wt;if(!alphaFac){a+=data[srcOff+3]*wt;}}}
dst[dstOff]=r;dst[dstOff+1]=g;dst[dstOff+2]=b;if(!alphaFac){dst[dstOff+3]=a;}
else{dst[dstOff+3]=data[dstOff+3];}}}
options.imageData=output;},getUniformLocations:function(gl,program){return{uMatrix:gl.getUniformLocation(program,'uMatrix'),uOpaque:gl.getUniformLocation(program,'uOpaque'),uHalfSize:gl.getUniformLocation(program,'uHalfSize'),uSize:gl.getUniformLocation(program,'uSize'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1fv(uniformLocations.uMatrix,this.matrix);},toObject:function(){return extend(this.callSuper('toObject'),{opaque:this.opaque,matrix:this.matrix});}});fabric.Image.filters.Convolute.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Grayscale=createClass(filters.BaseFilter,{type:'Grayscale',fragmentSource:{average:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'float average = (color.r + color.b + color.g) / 3.0;\n'+'gl_FragColor = vec4(average, average, average, color.a);\n'+'}',lightness:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform int uMode;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 col = texture2D(uTexture, vTexCoord);\n'+'float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n'+'gl_FragColor = vec4(average, average, average, col.a);\n'+'}',luminosity:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform int uMode;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 col = texture2D(uTexture, vTexCoord);\n'+'float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n'+'gl_FragColor = vec4(average, average, average, col.a);\n'+'}',},mode:'average',mainParameter:'mode',applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,i,len=data.length,value,mode=this.mode;for(i=0;i<len;i+=4){if(mode==='average'){value=(data[i]+data[i+1]+data[i+2])/3;}
else if(mode==='lightness'){value=(Math.min(data[i],data[i+1],data[i+2])+
Math.max(data[i],data[i+1],data[i+2]))/2;}
else if(mode==='luminosity'){value=0.21*data[i]+0.72*data[i+1]+0.07*data[i+2];}
data[i]=value;data[i+1]=value;data[i+2]=value;}},retrieveShader:function(options){var cacheKey=this.type+'_'+this.mode;if(!options.programCache.hasOwnProperty(cacheKey)){var shaderSource=this.fragmentSource[this.mode];options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}
return options.programCache[cacheKey];},getUniformLocations:function(gl,program){return{uMode:gl.getUniformLocation(program,'uMode'),};},sendUniformData:function(gl,uniformLocations){var mode=1;gl.uniform1i(uniformLocations.uMode,mode);},isNeutralState:function(){return false;},});fabric.Image.filters.Grayscale.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Invert=createClass(filters.BaseFilter,{type:'Invert',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform int uInvert;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'if (uInvert == 1) {\n'+'gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n'+'} else {\n'+'gl_FragColor = color;\n'+'}\n'+'}',invert:true,mainParameter:'invert',applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,i,len=data.length;for(i=0;i<len;i+=4){data[i]=255-data[i];data[i+1]=255-data[i+1];data[i+2]=255-data[i+2];}},isNeutralState:function(){return!this.invert;},getUniformLocations:function(gl,program){return{uInvert:gl.getUniformLocation(program,'uInvert'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1i(uniformLocations.uInvert,this.invert);},});fabric.Image.filters.Invert.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Noise=createClass(filters.BaseFilter,{type:'Noise',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uStepH;\n'+'uniform float uNoise;\n'+'uniform float uSeed;\n'+'varying vec2 vTexCoord;\n'+'float rand(vec2 co, float seed, float vScale) {\n'+'return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n'+'}\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n'+'gl_FragColor = color;\n'+'}',mainParameter:'noise',noise:0,applyTo2d:function(options){if(this.noise===0){return;}
var imageData=options.imageData,data=imageData.data,i,len=data.length,noise=this.noise,rand;for(i=0,len=data.length;i<len;i+=4){rand=(0.5-Math.random())*noise;data[i]+=rand;data[i+1]+=rand;data[i+2]+=rand;}},getUniformLocations:function(gl,program){return{uNoise:gl.getUniformLocation(program,'uNoise'),uSeed:gl.getUniformLocation(program,'uSeed'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uNoise,this.noise/255);gl.uniform1f(uniformLocations.uSeed,Math.random());},toObject:function(){return extend(this.callSuper('toObject'),{noise:this.noise});}});fabric.Image.filters.Noise.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Pixelate=createClass(filters.BaseFilter,{type:'Pixelate',blocksize:4,mainParameter:'blocksize',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uBlocksize;\n'+'uniform float uStepW;\n'+'uniform float uStepH;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'float blockW = uBlocksize * uStepW;\n'+'float blockH = uBlocksize * uStepW;\n'+'int posX = int(vTexCoord.x / blockW);\n'+'int posY = int(vTexCoord.y / blockH);\n'+'float fposX = float(posX);\n'+'float fposY = float(posY);\n'+'vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n'+'vec4 color = texture2D(uTexture, squareCoords);\n'+'gl_FragColor = color;\n'+'}',applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,iLen=imageData.height,jLen=imageData.width,index,i,j,r,g,b,a,_i,_j,_iLen,_jLen;for(i=0;i<iLen;i+=this.blocksize){for(j=0;j<jLen;j+=this.blocksize){index=(i*4)*jLen+(j*4);r=data[index];g=data[index+1];b=data[index+2];a=data[index+3];_iLen=Math.min(i+this.blocksize,iLen);_jLen=Math.min(j+this.blocksize,jLen);for(_i=i;_i<_iLen;_i++){for(_j=j;_j<_jLen;_j++){index=(_i*4)*jLen+(_j*4);data[index]=r;data[index+1]=g;data[index+2]=b;data[index+3]=a;}}}}},isNeutralState:function(){return this.blocksize===1;},getUniformLocations:function(gl,program){return{uBlocksize:gl.getUniformLocation(program,'uBlocksize'),uStepW:gl.getUniformLocation(program,'uStepW'),uStepH:gl.getUniformLocation(program,'uStepH'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uBlocksize,this.blocksize);},});fabric.Image.filters.Pixelate.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),extend=fabric.util.object.extend,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.RemoveColor=createClass(filters.BaseFilter,{type:'RemoveColor',color:'#FFFFFF',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec4 uLow;\n'+'uniform vec4 uHigh;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'gl_FragColor = texture2D(uTexture, vTexCoord);\n'+'if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n'+'gl_FragColor.a = 0.0;\n'+'}\n'+'}',distance:0.02,useAlpha:false,applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,i,distance=this.distance*255,r,g,b,source=new fabric.Color(this.color).getSource(),lowC=[source[0]-distance,source[1]-distance,source[2]-distance,],highC=[source[0]+distance,source[1]+distance,source[2]+distance,];for(i=0;i<data.length;i+=4){r=data[i];g=data[i+1];b=data[i+2];if(r>lowC[0]&&g>lowC[1]&&b>lowC[2]&&r<highC[0]&&g<highC[1]&&b<highC[2]){data[i+3]=0;}}},getUniformLocations:function(gl,program){return{uLow:gl.getUniformLocation(program,'uLow'),uHigh:gl.getUniformLocation(program,'uHigh'),};},sendUniformData:function(gl,uniformLocations){var source=new fabric.Color(this.color).getSource(),distance=parseFloat(this.distance),lowC=[0+source[0]/255-distance,0+source[1]/255-distance,0+source[2]/255-distance,1],highC=[source[0]/255+distance,source[1]/255+distance,source[2]/255+distance,1];gl.uniform4fv(uniformLocations.uLow,lowC);gl.uniform4fv(uniformLocations.uHigh,highC);},toObject:function(){return extend(this.callSuper('toObject'),{color:this.color,distance:this.distance});}});fabric.Image.filters.RemoveColor.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;var matrices={Brownie:[0.59970,0.34553,-0.27082,0,0.186,-0.03770,0.86095,0.15059,0,-0.1449,0.24113,-0.07441,0.44972,0,-0.02965,0,0,0,1,0],Vintage:[0.62793,0.32021,-0.03965,0,0.03784,0.02578,0.64411,0.03259,0,0.02926,0.04660,-0.08512,0.52416,0,0.02023,0,0,0,1,0],Kodachrome:[1.12855,-0.39673,-0.03992,0,0.24991,-0.16404,1.08352,-0.05498,0,0.09698,-0.16786,-0.56034,1.60148,0,0.13972,0,0,0,1,0],Technicolor:[1.91252,-0.85453,-0.09155,0,0.04624,-0.30878,1.76589,-0.10601,0,-0.27589,-0.23110,-0.75018,1.84759,0,0.12137,0,0,0,1,0],Polaroid:[1.438,-0.062,-0.062,0,0,-0.122,1.378,-0.122,0,0,-0.016,-0.016,1.483,0,0,0,0,0,1,0],Sepia:[0.393,0.769,0.189,0,0,0.349,0.686,0.168,0,0,0.272,0.534,0.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0,]};for(var key in matrices){filters[key]=createClass(filters.ColorMatrix,{type:key,matrix:matrices[key],mainParameter:false,colorsOnly:true,});fabric.Image.filters[key].fromObject=fabric.Image.filters.BaseFilter.fromObject;}})(true?exports:0);(function(global){'use strict';var fabric=global.fabric,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.BlendColor=createClass(filters.BaseFilter,{type:'BlendColor',color:'#F95C63',mode:'multiply',alpha:1,fragmentSource:{multiply:'gl_FragColor.rgb *= uColor.rgb;\n',screen:'gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n',add:'gl_FragColor.rgb += uColor.rgb;\n',diff:'gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n',subtract:'gl_FragColor.rgb -= uColor.rgb;\n',lighten:'gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n',darken:'gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n',exclusion:'gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n',overlay:'if (uColor.r < 0.5) {\n'+'gl_FragColor.r *= 2.0 * uColor.r;\n'+'} else {\n'+'gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n'+'}\n'+'if (uColor.g < 0.5) {\n'+'gl_FragColor.g *= 2.0 * uColor.g;\n'+'} else {\n'+'gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n'+'}\n'+'if (uColor.b < 0.5) {\n'+'gl_FragColor.b *= 2.0 * uColor.b;\n'+'} else {\n'+'gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n'+'}\n',tint:'gl_FragColor.rgb *= (1.0 - uColor.a);\n'+'gl_FragColor.rgb += uColor.rgb;\n',},buildSource:function(mode){return'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec4 uColor;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'gl_FragColor = color;\n'+'if (color.a > 0.0) {\n'+
this.fragmentSource[mode]+'}\n'+'}';},retrieveShader:function(options){var cacheKey=this.type+'_'+this.mode,shaderSource;if(!options.programCache.hasOwnProperty(cacheKey)){shaderSource=this.buildSource(this.mode);options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}
return options.programCache[cacheKey];},applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,iLen=data.length,tr,tg,tb,r,g,b,source,alpha1=1-this.alpha;source=new fabric.Color(this.color).getSource();tr=source[0]*this.alpha;tg=source[1]*this.alpha;tb=source[2]*this.alpha;for(var i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];switch(this.mode){case'multiply':data[i]=r*tr/255;data[i+1]=g*tg/255;data[i+2]=b*tb/255;break;case'screen':data[i]=255-(255-r)*(255-tr)/255;data[i+1]=255-(255-g)*(255-tg)/255;data[i+2]=255-(255-b)*(255-tb)/255;break;case'add':data[i]=r+tr;data[i+1]=g+tg;data[i+2]=b+tb;break;case'diff':case'difference':data[i]=Math.abs(r-tr);data[i+1]=Math.abs(g-tg);data[i+2]=Math.abs(b-tb);break;case'subtract':data[i]=r-tr;data[i+1]=g-tg;data[i+2]=b-tb;break;case'darken':data[i]=Math.min(r,tr);data[i+1]=Math.min(g,tg);data[i+2]=Math.min(b,tb);break;case'lighten':data[i]=Math.max(r,tr);data[i+1]=Math.max(g,tg);data[i+2]=Math.max(b,tb);break;case'overlay':data[i]=tr<128?(2*r*tr/255):(255-2*(255-r)*(255-tr)/255);data[i+1]=tg<128?(2*g*tg/255):(255-2*(255-g)*(255-tg)/255);data[i+2]=tb<128?(2*b*tb/255):(255-2*(255-b)*(255-tb)/255);break;case'exclusion':data[i]=tr+r-((2*tr*r)/255);data[i+1]=tg+g-((2*tg*g)/255);data[i+2]=tb+b-((2*tb*b)/255);break;case'tint':data[i]=tr+r*alpha1;data[i+1]=tg+g*alpha1;data[i+2]=tb+b*alpha1;}}},getUniformLocations:function(gl,program){return{uColor:gl.getUniformLocation(program,'uColor'),};},sendUniformData:function(gl,uniformLocations){var source=new fabric.Color(this.color).getSource();source[0]=this.alpha*source[0]/255;source[1]=this.alpha*source[1]/255;source[2]=this.alpha*source[2]/255;source[3]=this.alpha;gl.uniform4fv(uniformLocations.uColor,source);},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha};}});fabric.Image.filters.BlendColor.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.BlendImage=createClass(filters.BaseFilter,{type:'BlendImage',image:null,mode:'multiply',alpha:1,vertexSource:'attribute vec2 aPosition;\n'+'varying vec2 vTexCoord;\n'+'varying vec2 vTexCoord2;\n'+'uniform mat3 uTransformMatrix;\n'+'void main() {\n'+'vTexCoord = aPosition;\n'+'vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n'+'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n'+'}',fragmentSource:{multiply:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform sampler2D uImage;\n'+'uniform vec4 uColor;\n'+'varying vec2 vTexCoord;\n'+'varying vec2 vTexCoord2;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'vec4 color2 = texture2D(uImage, vTexCoord2);\n'+'color.rgba *= color2.rgba;\n'+'gl_FragColor = color;\n'+'}',mask:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform sampler2D uImage;\n'+'uniform vec4 uColor;\n'+'varying vec2 vTexCoord;\n'+'varying vec2 vTexCoord2;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'vec4 color2 = texture2D(uImage, vTexCoord2);\n'+'color.a = color2.a;\n'+'gl_FragColor = color;\n'+'}',},retrieveShader:function(options){var cacheKey=this.type+'_'+this.mode;var shaderSource=this.fragmentSource[this.mode];if(!options.programCache.hasOwnProperty(cacheKey)){options.programCache[cacheKey]=this.createProgram(options.context,shaderSource);}
return options.programCache[cacheKey];},applyToWebGL:function(options){var gl=options.context,texture=this.createTexture(options.filterBackend,this.image);this.bindAdditionalTexture(gl,texture,gl.TEXTURE1);this.callSuper('applyToWebGL',options);this.unbindAdditionalTexture(gl,gl.TEXTURE1);},createTexture:function(backend,image){return backend.getCachedTexture(image.cacheKey,image._element);},calculateMatrix:function(){var image=this.image,width=image._element.width,height=image._element.height;return[1/image.scaleX,0,0,0,1/image.scaleY,0,-image.left/width,-image.top/height,1];},applyTo2d:function(options){var imageData=options.imageData,resources=options.filterBackend.resources,data=imageData.data,iLen=data.length,width=imageData.width,height=imageData.height,tr,tg,tb,ta,r,g,b,a,canvas1,context,image=this.image,blendData;if(!resources.blendImage){resources.blendImage=fabric.util.createCanvasElement();}
canvas1=resources.blendImage;context=canvas1.getContext('2d');if(canvas1.width!==width||canvas1.height!==height){canvas1.width=width;canvas1.height=height;}
else{context.clearRect(0,0,width,height);}
context.setTransform(image.scaleX,0,0,image.scaleY,image.left,image.top);context.drawImage(image._element,0,0,width,height);blendData=context.getImageData(0,0,width,height).data;for(var i=0;i<iLen;i+=4){r=data[i];g=data[i+1];b=data[i+2];a=data[i+3];tr=blendData[i];tg=blendData[i+1];tb=blendData[i+2];ta=blendData[i+3];switch(this.mode){case'multiply':data[i]=r*tr/255;data[i+1]=g*tg/255;data[i+2]=b*tb/255;data[i+3]=a*ta/255;break;case'mask':data[i+3]=ta;break;}}},getUniformLocations:function(gl,program){return{uTransformMatrix:gl.getUniformLocation(program,'uTransformMatrix'),uImage:gl.getUniformLocation(program,'uImage'),};},sendUniformData:function(gl,uniformLocations){var matrix=this.calculateMatrix();gl.uniform1i(uniformLocations.uImage,1);gl.uniformMatrix3fv(uniformLocations.uTransformMatrix,false,matrix);},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha};}});fabric.Image.filters.BlendImage.fromObject=function(object,callback){fabric.Image.fromObject(object.image,function(image){var options=fabric.util.object.clone(object);options.image=image;callback(new fabric.Image.filters.BlendImage(options));});};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),pow=Math.pow,floor=Math.floor,sqrt=Math.sqrt,abs=Math.abs,round=Math.round,sin=Math.sin,ceil=Math.ceil,filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Resize=createClass(filters.BaseFilter,{type:'Resize',resizeType:'hermite',scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(gl,program){return{uDelta:gl.getUniformLocation(program,'uDelta'),uTaps:gl.getUniformLocation(program,'uTaps'),};},sendUniformData:function(gl,uniformLocations){gl.uniform2fv(uniformLocations.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]);gl.uniform1fv(uniformLocations.uTaps,this.taps);},retrieveShader:function(options){var filterWindow=this.getFilterWindow(),cacheKey=this.type+'_'+filterWindow;if(!options.programCache.hasOwnProperty(cacheKey)){var fragmentShader=this.generateShader(filterWindow);options.programCache[cacheKey]=this.createProgram(options.context,fragmentShader);}
return options.programCache[cacheKey];},getFilterWindow:function(){var scale=this.tempScale;return Math.ceil(this.lanczosLobes/scale);},getTaps:function(){var lobeFunction=this.lanczosCreate(this.lanczosLobes),scale=this.tempScale,filterWindow=this.getFilterWindow(),taps=new Array(filterWindow);for(var i=1;i<=filterWindow;i++){taps[i-1]=lobeFunction(i*scale);}
return taps;},generateShader:function(filterWindow){var offsets=new Array(filterWindow),fragmentShader=this.fragmentSourceTOP,filterWindow;for(var i=1;i<=filterWindow;i++){offsets[i-1]=i+'.0 * uDelta';}
fragmentShader+='uniform float uTaps['+filterWindow+'];\n';fragmentShader+='void main() {\n';fragmentShader+='  vec4 color = texture2D(uTexture, vTexCoord);\n';fragmentShader+='  float sum = 1.0;\n';offsets.forEach(function(offset,i){fragmentShader+='  color += texture2D(uTexture, vTexCoord + '+offset+') * uTaps['+i+'];\n';fragmentShader+='  color += texture2D(uTexture, vTexCoord - '+offset+') * uTaps['+i+'];\n';fragmentShader+='  sum += 2.0 * uTaps['+i+'];\n';});fragmentShader+='  gl_FragColor = color / sum;\n';fragmentShader+='}';return fragmentShader;},fragmentSourceTOP:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec2 uDelta;\n'+'varying vec2 vTexCoord;\n',applyTo:function(options){if(options.webgl){options.passes++;this.width=options.sourceWidth;this.horizontal=true;this.dW=Math.round(this.width*this.scaleX);this.dH=options.sourceHeight;this.tempScale=this.dW/this.width;this.taps=this.getTaps();options.destinationWidth=this.dW;this._setupFrameBuffer(options);this.applyToWebGL(options);this._swapTextures(options);options.sourceWidth=options.destinationWidth;this.height=options.sourceHeight;this.horizontal=false;this.dH=Math.round(this.height*this.scaleY);this.tempScale=this.dH/this.height;this.taps=this.getTaps();options.destinationHeight=this.dH;this._setupFrameBuffer(options);this.applyToWebGL(options);this._swapTextures(options);options.sourceHeight=options.destinationHeight;}
else{this.applyTo2d(options);}},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1;},lanczosCreate:function(lobes){return function(x){if(x>=lobes||x<=-lobes){return 0.0;}
if(x<1.19209290E-07&&x>-1.19209290E-07){return 1.0;}
x*=Math.PI;var xx=x/lobes;return(sin(x)/x)*sin(xx)/xx;};},applyTo2d:function(options){var imageData=options.imageData,scaleX=this.scaleX,scaleY=this.scaleY;this.rcpScaleX=1/scaleX;this.rcpScaleY=1/scaleY;var oW=imageData.width,oH=imageData.height,dW=round(oW*scaleX),dH=round(oH*scaleY),newData;if(this.resizeType==='sliceHack'){newData=this.sliceByTwo(options,oW,oH,dW,dH);}
else if(this.resizeType==='hermite'){newData=this.hermiteFastResize(options,oW,oH,dW,dH);}
else if(this.resizeType==='bilinear'){newData=this.bilinearFiltering(options,oW,oH,dW,dH);}
else if(this.resizeType==='lanczos'){newData=this.lanczosResize(options,oW,oH,dW,dH);}
options.imageData=newData;},sliceByTwo:function(options,oW,oH,dW,dH){var imageData=options.imageData,mult=0.5,doneW=false,doneH=false,stepW=oW*mult,stepH=oH*mult,resources=fabric.filterBackend.resources,tmpCanvas,ctx,sX=0,sY=0,dX=oW,dY=0;if(!resources.sliceByTwo){resources.sliceByTwo=document.createElement('canvas');}
tmpCanvas=resources.sliceByTwo;if(tmpCanvas.width<oW*1.5||tmpCanvas.height<oH){tmpCanvas.width=oW*1.5;tmpCanvas.height=oH;}
ctx=tmpCanvas.getContext('2d');ctx.clearRect(0,0,oW*1.5,oH);ctx.putImageData(imageData,0,0);dW=floor(dW);dH=floor(dH);while(!doneW||!doneH){oW=stepW;oH=stepH;if(dW<floor(stepW*mult)){stepW=floor(stepW*mult);}
else{stepW=dW;doneW=true;}
if(dH<floor(stepH*mult)){stepH=floor(stepH*mult);}
else{stepH=dH;doneH=true;}
ctx.drawImage(tmpCanvas,sX,sY,oW,oH,dX,dY,stepW,stepH);sX=dX;sY=dY;dY+=stepH;}
return ctx.getImageData(sX,sY,dW,dH);},lanczosResize:function(options,oW,oH,dW,dH){function process(u){var v,i,weight,idx,a,red,green,blue,alpha,fX,fY;center.x=(u+0.5)*ratioX;icenter.x=floor(center.x);for(v=0;v<dH;v++){center.y=(v+0.5)*ratioY;icenter.y=floor(center.y);a=0;red=0;green=0;blue=0;alpha=0;for(i=icenter.x-range2X;i<=icenter.x+range2X;i++){if(i<0||i>=oW){continue;}
fX=floor(1000*abs(i-center.x));if(!cacheLanc[fX]){cacheLanc[fX]={};}
for(var j=icenter.y-range2Y;j<=icenter.y+range2Y;j++){if(j<0||j>=oH){continue;}
fY=floor(1000*abs(j-center.y));if(!cacheLanc[fX][fY]){cacheLanc[fX][fY]=lanczos(sqrt(pow(fX*rcpRatioX,2)+pow(fY*rcpRatioY,2))/1000);}
weight=cacheLanc[fX][fY];if(weight>0){idx=(j*oW+i)*4;a+=weight;red+=weight*srcData[idx];green+=weight*srcData[idx+1];blue+=weight*srcData[idx+2];alpha+=weight*srcData[idx+3];}}}
idx=(v*dW+u)*4;destData[idx]=red/a;destData[idx+1]=green/a;destData[idx+2]=blue/a;destData[idx+3]=alpha/a;}
if(++u<dW){return process(u);}
else{return destImg;}}
var srcData=options.imageData.data,destImg=options.ctx.createImageData(dW,dH),destData=destImg.data,lanczos=this.lanczosCreate(this.lanczosLobes),ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,rcpRatioX=2/this.rcpScaleX,rcpRatioY=2/this.rcpScaleY,range2X=ceil(ratioX*this.lanczosLobes/2),range2Y=ceil(ratioY*this.lanczosLobes/2),cacheLanc={},center={},icenter={};return process(0);},bilinearFiltering:function(options,oW,oH,dW,dH){var a,b,c,d,x,y,i,j,xDiff,yDiff,chnl,color,offset=0,origPix,ratioX=this.rcpScaleX,ratioY=this.rcpScaleY,w4=4*(oW-1),img=options.imageData,pixels=img.data,destImage=options.ctx.createImageData(dW,dH),destPixels=destImage.data;for(i=0;i<dH;i++){for(j=0;j<dW;j++){x=floor(ratioX*j);y=floor(ratioY*i);xDiff=ratioX*j-x;yDiff=ratioY*i-y;origPix=4*(y*oW+x);for(chnl=0;chnl<4;chnl++){a=pixels[origPix+chnl];b=pixels[origPix+4+chnl];c=pixels[origPix+w4+chnl];d=pixels[origPix+w4+4+chnl];color=a*(1-xDiff)*(1-yDiff)+b*xDiff*(1-yDiff)+
c*yDiff*(1-xDiff)+d*xDiff*yDiff;destPixels[offset++]=color;}}}
return destImage;},hermiteFastResize:function(options,oW,oH,dW,dH){var ratioW=this.rcpScaleX,ratioH=this.rcpScaleY,ratioWHalf=ceil(ratioW/2),ratioHHalf=ceil(ratioH/2),img=options.imageData,data=img.data,img2=options.ctx.createImageData(dW,dH),data2=img2.data;for(var j=0;j<dH;j++){for(var i=0;i<dW;i++){var x2=(i+j*dW)*4,weight=0,weights=0,weightsAlpha=0,gxR=0,gxG=0,gxB=0,gxA=0,centerY=(j+0.5)*ratioH;for(var yy=floor(j*ratioH);yy<(j+1)*ratioH;yy++){var dy=abs(centerY-(yy+0.5))/ratioHHalf,centerX=(i+0.5)*ratioW,w0=dy*dy;for(var xx=floor(i*ratioW);xx<(i+1)*ratioW;xx++){var dx=abs(centerX-(xx+0.5))/ratioWHalf,w=sqrt(w0+dx*dx);if(w>1&&w<-1){continue;}
weight=2*w*w*w-3*w*w+1;if(weight>0){dx=4*(xx+yy*oW);gxA+=weight*data[dx+3];weightsAlpha+=weight;if(data[dx+3]<255){weight=weight*data[dx+3]/250;}
gxR+=weight*data[dx];gxG+=weight*data[dx+1];gxB+=weight*data[dx+2];weights+=weight;}}}
data2[x2]=gxR/weights;data2[x2+1]=gxG/weights;data2[x2+2]=gxB/weights;data2[x2+3]=gxA/weightsAlpha;}}
return img2;},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes};}});fabric.Image.filters.Resize.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Contrast=createClass(filters.BaseFilter,{type:'Contrast',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uContrast;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n'+'color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n'+'gl_FragColor = color;\n'+'}',contrast:0,mainParameter:'contrast',applyTo2d:function(options){if(this.contrast===0){return;}
var imageData=options.imageData,i,len,data=imageData.data,len=data.length,contrast=Math.floor(this.contrast*255),contrastF=259*(contrast+255)/(255*(259-contrast));for(i=0;i<len;i+=4){data[i]=contrastF*(data[i]-128)+128;data[i+1]=contrastF*(data[i+1]-128)+128;data[i+2]=contrastF*(data[i+2]-128)+128;}},getUniformLocations:function(gl,program){return{uContrast:gl.getUniformLocation(program,'uContrast'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uContrast,this.contrast);},});fabric.Image.filters.Contrast.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Saturation=createClass(filters.BaseFilter,{type:'Saturation',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uSaturation;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'float rgMax = max(color.r, color.g);\n'+'float rgbMax = max(rgMax, color.b);\n'+'color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n'+'color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n'+'color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n'+'gl_FragColor = color;\n'+'}',saturation:0,mainParameter:'saturation',applyTo2d:function(options){if(this.saturation===0){return;}
var imageData=options.imageData,data=imageData.data,len=data.length,adjust=-this.saturation,i,max;for(i=0;i<len;i+=4){max=Math.max(data[i],data[i+1],data[i+2]);data[i]+=max!==data[i]?(max-data[i])*adjust:0;data[i+1]+=max!==data[i+1]?(max-data[i+1])*adjust:0;data[i+2]+=max!==data[i+2]?(max-data[i+2])*adjust:0;}},getUniformLocations:function(gl,program){return{uSaturation:gl.getUniformLocation(program,'uSaturation'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uSaturation,-this.saturation);},});fabric.Image.filters.Saturation.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Vibrance=createClass(filters.BaseFilter,{type:'Vibrance',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform float uVibrance;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'float max = max(color.r, max(color.g, color.b));\n'+'float avg = (color.r + color.g + color.b) / 3.0;\n'+'float amt = (abs(max - avg) * 2.0) * uVibrance;\n'+'color.r += max != color.r ? (max - color.r) * amt : 0.00;\n'+'color.g += max != color.g ? (max - color.g) * amt : 0.00;\n'+'color.b += max != color.b ? (max - color.b) * amt : 0.00;\n'+'gl_FragColor = color;\n'+'}',vibrance:0,mainParameter:'vibrance',applyTo2d:function(options){if(this.vibrance===0){return;}
var imageData=options.imageData,data=imageData.data,len=data.length,adjust=-this.vibrance,i,max,avg,amt;for(i=0;i<len;i+=4){max=Math.max(data[i],data[i+1],data[i+2]);avg=(data[i]+data[i+1]+data[i+2])/3;amt=((Math.abs(max-avg)*2/255)*adjust);data[i]+=max!==data[i]?(max-data[i])*amt:0;data[i+1]+=max!==data[i+1]?(max-data[i+1])*amt:0;data[i+2]+=max!==data[i+2]?(max-data[i+2])*amt:0;}},getUniformLocations:function(gl,program){return{uVibrance:gl.getUniformLocation(program,'uVibrance'),};},sendUniformData:function(gl,uniformLocations){gl.uniform1f(uniformLocations.uVibrance,-this.vibrance);},});fabric.Image.filters.Vibrance.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Blur=createClass(filters.BaseFilter,{type:'Blur',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec2 uDelta;\n'+'varying vec2 vTexCoord;\n'+'const float nSamples = 15.0;\n'+'vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n'+'float random(vec3 scale) {\n'+'return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n'+'}\n'+'void main() {\n'+'vec4 color = vec4(0.0);\n'+'float total = 0.0;\n'+'float offset = random(v3offset);\n'+'for (float t = -nSamples; t <= nSamples; t++) {\n'+'float percent = (t + offset - 0.5) / nSamples;\n'+'float weight = 1.0 - abs(percent);\n'+'color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\n'+'total += weight;\n'+'}\n'+'gl_FragColor = color / total;\n'+'}',blur:0,mainParameter:'blur',applyTo:function(options){if(options.webgl){this.aspectRatio=options.sourceWidth/options.sourceHeight;options.passes++;this._setupFrameBuffer(options);this.horizontal=true;this.applyToWebGL(options);this._swapTextures(options);this._setupFrameBuffer(options);this.horizontal=false;this.applyToWebGL(options);this._swapTextures(options);}
else{this.applyTo2d(options);}},applyTo2d:function(options){options.imageData=this.simpleBlur(options);},simpleBlur:function(options){var resources=options.filterBackend.resources,canvas1,canvas2,width=options.imageData.width,height=options.imageData.height;if(!resources.blurLayer1){resources.blurLayer1=fabric.util.createCanvasElement();resources.blurLayer2=fabric.util.createCanvasElement();}
canvas1=resources.blurLayer1;canvas2=resources.blurLayer2;if(canvas1.width!==width||canvas1.height!==height){canvas2.width=canvas1.width=width;canvas2.height=canvas1.height=height;}
var ctx1=canvas1.getContext('2d'),ctx2=canvas2.getContext('2d'),nSamples=15,random,percent,j,i,blur=this.blur*0.06*0.5;ctx1.putImageData(options.imageData,0,0);ctx2.clearRect(0,0,width,height);for(i=-nSamples;i<=nSamples;i++){random=(Math.random()-0.5)/4;percent=i/nSamples;j=blur*percent*width+random;ctx2.globalAlpha=1-Math.abs(percent);ctx2.drawImage(canvas1,j,random);ctx1.drawImage(canvas2,0,0);ctx2.globalAlpha=1;ctx2.clearRect(0,0,canvas2.width,canvas2.height);}
for(i=-nSamples;i<=nSamples;i++){random=(Math.random()-0.5)/4;percent=i/nSamples;j=blur*percent*height+random;ctx2.globalAlpha=1-Math.abs(percent);ctx2.drawImage(canvas1,random,j);ctx1.drawImage(canvas2,0,0);ctx2.globalAlpha=1;ctx2.clearRect(0,0,canvas2.width,canvas2.height);}
options.ctx.drawImage(canvas1,0,0);var newImageData=options.ctx.getImageData(0,0,canvas1.width,canvas1.height);ctx1.globalAlpha=1;ctx1.clearRect(0,0,canvas1.width,canvas1.height);return newImageData;},getUniformLocations:function(gl,program){return{delta:gl.getUniformLocation(program,'uDelta'),};},sendUniformData:function(gl,uniformLocations){var delta=this.chooseRightDelta();gl.uniform2fv(uniformLocations.delta,delta);},chooseRightDelta:function(){var blurScale=1,delta=[0,0],blur;if(this.horizontal){if(this.aspectRatio>1){blurScale=1/this.aspectRatio;}}
else{if(this.aspectRatio<1){blurScale=this.aspectRatio;}}
blur=blurScale*this.blur*0.12;if(this.horizontal){delta[0]=blur;}
else{delta[1]=blur;}
return delta;},});filters.Blur.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Gamma=createClass(filters.BaseFilter,{type:'Gamma',fragmentSource:'precision highp float;\n'+'uniform sampler2D uTexture;\n'+'uniform vec3 uGamma;\n'+'varying vec2 vTexCoord;\n'+'void main() {\n'+'vec4 color = texture2D(uTexture, vTexCoord);\n'+'vec3 correction = (1.0 / uGamma);\n'+'color.r = pow(color.r, correction.r);\n'+'color.g = pow(color.g, correction.g);\n'+'color.b = pow(color.b, correction.b);\n'+'gl_FragColor = color;\n'+'gl_FragColor.rgb *= color.a;\n'+'}',gamma:[1,1,1],mainParameter:'gamma',initialize:function(options){this.gamma=[1,1,1];filters.BaseFilter.prototype.initialize.call(this,options);},applyTo2d:function(options){var imageData=options.imageData,data=imageData.data,gamma=this.gamma,len=data.length,rInv=1/gamma[0],gInv=1/gamma[1],bInv=1/gamma[2],i;if(!this.rVals){this.rVals=new Uint8Array(256);this.gVals=new Uint8Array(256);this.bVals=new Uint8Array(256);}
for(i=0,len=256;i<len;i++){this.rVals[i]=Math.pow(i/255,rInv)*255;this.gVals[i]=Math.pow(i/255,gInv)*255;this.bVals[i]=Math.pow(i/255,bInv)*255;}
for(i=0,len=data.length;i<len;i+=4){data[i]=this.rVals[data[i]];data[i+1]=this.gVals[data[i+1]];data[i+2]=this.bVals[data[i+2]];}},getUniformLocations:function(gl,program){return{uGamma:gl.getUniformLocation(program,'uGamma'),};},sendUniformData:function(gl,uniformLocations){gl.uniform3fv(uniformLocations.uGamma,this.gamma);},});fabric.Image.filters.Gamma.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.Composed=createClass(filters.BaseFilter,{type:'Composed',subFilters:[],initialize:function(options){this.callSuper('initialize',options);this.subFilters=this.subFilters.slice(0);},applyTo:function(options){options.passes+=this.subFilters.length-1;this.subFilters.forEach(function(filter){filter.applyTo(options);});},toObject:function(){return fabric.util.object.extend(this.callSuper('toObject'),{subFilters:this.subFilters.map(function(filter){return filter.toObject();}),});},isNeutralState:function(){return!this.subFilters.some(function(filter){return!filter.isNeutralState();});}});fabric.Image.filters.Composed.fromObject=function(object,callback){var filters=object.subFilters||[],subFilters=filters.map(function(filter){return new fabric.Image.filters[filter.type](filter);}),instance=new fabric.Image.filters.Composed({subFilters:subFilters});callback&&callback(instance);return instance;};})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),filters=fabric.Image.filters,createClass=fabric.util.createClass;filters.HueRotation=createClass(filters.ColorMatrix,{type:'HueRotation',rotation:0,mainParameter:'rotation',calculateMatrix:function(){var rad=this.rotation*Math.PI,cos=fabric.util.cos(rad),sin=fabric.util.sin(rad),aThird=1/3,aThirdSqtSin=Math.sqrt(aThird)*sin,OneMinusCos=1-cos;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this.matrix[0]=cos+OneMinusCos/3;this.matrix[1]=aThird*OneMinusCos-aThirdSqtSin;this.matrix[2]=aThird*OneMinusCos+aThirdSqtSin;this.matrix[5]=aThird*OneMinusCos+aThirdSqtSin;this.matrix[6]=cos+aThird*OneMinusCos;this.matrix[7]=aThird*OneMinusCos-aThirdSqtSin;this.matrix[10]=aThird*OneMinusCos-aThirdSqtSin;this.matrix[11]=aThird*OneMinusCos+aThirdSqtSin;this.matrix[12]=cos+aThird*OneMinusCos;},isNeutralState:function(options){this.calculateMatrix();return filters.BaseFilter.prototype.isNeutralState.call(this,options);},applyTo:function(options){this.calculateMatrix();filters.BaseFilter.prototype.applyTo.call(this,options);},});fabric.Image.filters.HueRotation.fromObject=fabric.Image.filters.BaseFilter.fromObject;})(true?exports:0);(function(global){'use strict';var fabric=global.fabric||(global.fabric={}),clone=fabric.util.object.clone;if(fabric.Text){fabric.warn('fabric.Text is already defined');return;}
var additionalProps=('fontFamily fontWeight fontSize text underline overline linethrough'+' textAlign fontStyle lineHeight textBackgroundColor charSpacing styles'+' direction path pathStartOffset pathSide').split(' ');fabric.Text=fabric.util.createClass(fabric.Object,{_dimensionAffectingProps:['fontSize','fontWeight','fontFamily','fontStyle','lineHeight','text','charSpacing','textAlign','styles','path','pathStartOffset','pathSide'],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:'text',fontSize:40,fontWeight:'normal',fontFamily:'Times New Roman',underline:false,overline:false,linethrough:false,textAlign:'left',fontStyle:'normal',lineHeight:1.16,superscript:{size:0.60,baseline:-0.35},subscript:{size:0.60,baseline:0.11},textBackgroundColor:'',stateProperties:fabric.Object.prototype.stateProperties.concat(additionalProps),cacheProperties:fabric.Object.prototype.cacheProperties.concat(additionalProps),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:'left',_fontSizeFraction:0.222,offsets:{underline:0.10,linethrough:-0.315,overline:-0.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:'ltr',_styleProperties:['stroke','strokeWidth','fill','fontFamily','fontSize','fontWeight','fontStyle','underline','overline','linethrough','deltaY','textBackgroundColor',],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(text,options){this.styles=options?(options.styles||{}):{};this.text=text;this.__skipDimension=true;this.callSuper('initialize',options);if(this.path){this.setPathInfo();}
this.__skipDimension=false;this.initDimensions();this.setCoords();this.setupState({propertySet:'_dimensionAffectingProps'});},setPathInfo:function(){var path=this.path;if(path){path.segmentsInfo=fabric.util.getPathSegmentsInfo(path.path);}},getMeasuringContext:function(){if(!fabric._measuringContext){fabric._measuringContext=this.canvas&&this.canvas.contextCache||fabric.util.createCanvasElement().getContext('2d');}
return fabric._measuringContext;},_splitText:function(){var newLines=this._splitTextIntoLines(this.text);this.textLines=newLines.lines;this._textLines=newLines.graphemeLines;this._unwrappedTextLines=newLines._unwrappedLines;this._text=newLines.graphemeText;return newLines;},initDimensions:function(){if(this.__skipDimension){return;}
this._splitText();this._clearCache();if(this.path){this.width=this.path.width;this.height=this.path.height;}
else{this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH;this.height=this.calcTextHeight();}
if(this.textAlign.indexOf('justify')!==-1){this.enlargeSpaces();}
this.saveState({propertySet:'_dimensionAffectingProps'});},enlargeSpaces:function(){var diffSpace,currentLineWidth,numberOfSpaces,accumulatedSpace,line,charBound,spaces;for(var i=0,len=this._textLines.length;i<len;i++){if(this.textAlign!=='justify'&&(i===len-1||this.isEndOfWrapping(i))){continue;}
accumulatedSpace=0;line=this._textLines[i];currentLineWidth=this.getLineWidth(i);if(currentLineWidth<this.width&&(spaces=this.textLines[i].match(this._reSpacesAndTabs))){numberOfSpaces=spaces.length;diffSpace=(this.width-currentLineWidth)/numberOfSpaces;for(var j=0,jlen=line.length;j<=jlen;j++){charBound=this.__charBounds[i][j];if(this._reSpaceAndTab.test(line[j])){charBound.width+=diffSpace;charBound.kernedWidth+=diffSpace;charBound.left+=accumulatedSpace;accumulatedSpace+=diffSpace;}
else{charBound.left+=accumulatedSpace;}}}}},isEndOfWrapping:function(lineIndex){return lineIndex===this._textLines.length-1;},missingNewlineOffset:function(){return 1;},toString:function(){return'#<fabric.Text ('+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>';},_getCacheCanvasDimensions:function(){var dims=this.callSuper('_getCacheCanvasDimensions');var fontSize=this.fontSize;dims.width+=fontSize*dims.zoomX;dims.height+=fontSize*dims.zoomY;return dims;},_render:function(ctx){var path=this.path;path&&!path.isNotVisible()&&path._render(ctx);this._setTextStyles(ctx);this._renderTextLinesBackground(ctx);this._renderTextDecoration(ctx,'underline');this._renderText(ctx);this._renderTextDecoration(ctx,'overline');this._renderTextDecoration(ctx,'linethrough');},_renderText:function(ctx){if(this.paintFirst==='stroke'){this._renderTextStroke(ctx);this._renderTextFill(ctx);}
else{this._renderTextFill(ctx);this._renderTextStroke(ctx);}},_setTextStyles:function(ctx,charStyle,forMeasuring){ctx.textBaseline='alphabetic';ctx.font=this._getFontDeclaration(charStyle,forMeasuring);},calcTextWidth:function(){var maxWidth=this.getLineWidth(0);for(var i=1,len=this._textLines.length;i<len;i++){var currentLineWidth=this.getLineWidth(i);if(currentLineWidth>maxWidth){maxWidth=currentLineWidth;}}
return maxWidth;},_renderTextLine:function(method,ctx,line,left,top,lineIndex){this._renderChars(method,ctx,line,left,top,lineIndex);},_renderTextLinesBackground:function(ctx){if(!this.textBackgroundColor&&!this.styleHas('textBackgroundColor')){return;}
var heightOfLine,lineLeftOffset,originalFill=ctx.fillStyle,line,lastColor,leftOffset=this._getLeftOffset(),lineTopOffset=this._getTopOffset(),boxStart=0,boxWidth=0,charBox,currentColor,path=this.path,drawStart;for(var i=0,len=this._textLines.length;i<len;i++){heightOfLine=this.getHeightOfLine(i);if(!this.textBackgroundColor&&!this.styleHas('textBackgroundColor',i)){lineTopOffset+=heightOfLine;continue;}
line=this._textLines[i];lineLeftOffset=this._getLineLeftOffset(i);boxWidth=0;boxStart=0;lastColor=this.getValueOfPropertyAt(i,0,'textBackgroundColor');for(var j=0,jlen=line.length;j<jlen;j++){charBox=this.__charBounds[i][j];currentColor=this.getValueOfPropertyAt(i,j,'textBackgroundColor');if(path){ctx.save();ctx.translate(charBox.renderLeft,charBox.renderTop);ctx.rotate(charBox.angle);ctx.fillStyle=currentColor;currentColor&&ctx.fillRect(-charBox.width/2,-heightOfLine/this.lineHeight*(1-this._fontSizeFraction),charBox.width,heightOfLine/this.lineHeight);ctx.restore();}
else if(currentColor!==lastColor){drawStart=leftOffset+lineLeftOffset+boxStart;if(this.direction==='rtl'){drawStart=this.width-drawStart-boxWidth;}
ctx.fillStyle=lastColor;lastColor&&ctx.fillRect(drawStart,lineTopOffset,boxWidth,heightOfLine/this.lineHeight);boxStart=charBox.left;boxWidth=charBox.width;lastColor=currentColor;}
else{boxWidth+=charBox.kernedWidth;}}
if(currentColor&&!path){drawStart=leftOffset+lineLeftOffset+boxStart;if(this.direction==='rtl'){drawStart=this.width-drawStart-boxWidth;}
ctx.fillStyle=currentColor;ctx.fillRect(drawStart,lineTopOffset,boxWidth,heightOfLine/this.lineHeight);}
lineTopOffset+=heightOfLine;}
ctx.fillStyle=originalFill;this._removeShadow(ctx);},getFontCache:function(decl){var fontFamily=decl.fontFamily.toLowerCase();if(!fabric.charWidthsCache[fontFamily]){fabric.charWidthsCache[fontFamily]={};}
var cache=fabric.charWidthsCache[fontFamily],cacheProp=decl.fontStyle.toLowerCase()+'_'+(decl.fontWeight+'').toLowerCase();if(!cache[cacheProp]){cache[cacheProp]={};}
return cache[cacheProp];},_measureChar:function(_char,charStyle,previousChar,prevCharStyle){var fontCache=this.getFontCache(charStyle),fontDeclaration=this._getFontDeclaration(charStyle),previousFontDeclaration=this._getFontDeclaration(prevCharStyle),couple=previousChar+_char,stylesAreEqual=fontDeclaration===previousFontDeclaration,width,coupleWidth,previousWidth,fontMultiplier=charStyle.fontSize/this.CACHE_FONT_SIZE,kernedWidth;if(previousChar&&fontCache[previousChar]!==undefined){previousWidth=fontCache[previousChar];}
if(fontCache[_char]!==undefined){kernedWidth=width=fontCache[_char];}
if(stylesAreEqual&&fontCache[couple]!==undefined){coupleWidth=fontCache[couple];kernedWidth=coupleWidth-previousWidth;}
if(width===undefined||previousWidth===undefined||coupleWidth===undefined){var ctx=this.getMeasuringContext();this._setTextStyles(ctx,charStyle,true);}
if(width===undefined){kernedWidth=width=ctx.measureText(_char).width;fontCache[_char]=width;}
if(previousWidth===undefined&&stylesAreEqual&&previousChar){previousWidth=ctx.measureText(previousChar).width;fontCache[previousChar]=previousWidth;}
if(stylesAreEqual&&coupleWidth===undefined){coupleWidth=ctx.measureText(couple).width;fontCache[couple]=coupleWidth;kernedWidth=coupleWidth-previousWidth;}
return{width:width*fontMultiplier,kernedWidth:kernedWidth*fontMultiplier};},getHeightOfChar:function(line,_char){return this.getValueOfPropertyAt(line,_char,'fontSize');},measureLine:function(lineIndex){var lineInfo=this._measureLine(lineIndex);if(this.charSpacing!==0){lineInfo.width-=this._getWidthOfCharSpacing();}
if(lineInfo.width<0){lineInfo.width=0;}
return lineInfo;},_measureLine:function(lineIndex){var width=0,i,grapheme,line=this._textLines[lineIndex],prevGrapheme,graphemeInfo,numOfSpaces=0,lineBounds=new Array(line.length),positionInPath=0,startingPoint,totalPathLength,path=this.path,reverse=this.pathSide==='right';this.__charBounds[lineIndex]=lineBounds;for(i=0;i<line.length;i++){grapheme=line[i];graphemeInfo=this._getGraphemeBox(grapheme,lineIndex,i,prevGrapheme);lineBounds[i]=graphemeInfo;width+=graphemeInfo.kernedWidth;prevGrapheme=grapheme;}
lineBounds[i]={left:graphemeInfo?graphemeInfo.left+graphemeInfo.width:0,width:0,kernedWidth:0,height:this.fontSize};if(path){totalPathLength=path.segmentsInfo[path.segmentsInfo.length-1].length;startingPoint=fabric.util.getPointOnPath(path.path,0,path.segmentsInfo);startingPoint.x+=path.pathOffset.x;startingPoint.y+=path.pathOffset.y;switch(this.textAlign){case'left':positionInPath=reverse?(totalPathLength-width):0;break;case'center':positionInPath=(totalPathLength-width)/2;break;case'right':positionInPath=reverse?0:(totalPathLength-width);break;}
positionInPath+=this.pathStartOffset*(reverse?-1:1);for(i=reverse?line.length-1:0;reverse?i>=0:i<line.length;reverse?i--:i++){graphemeInfo=lineBounds[i];if(positionInPath>totalPathLength){positionInPath%=totalPathLength;}
else if(positionInPath<0){positionInPath+=totalPathLength;}
this._setGraphemeOnPath(positionInPath,graphemeInfo,startingPoint);positionInPath+=graphemeInfo.kernedWidth;}}
return{width:width,numOfSpaces:numOfSpaces};},_setGraphemeOnPath:function(positionInPath,graphemeInfo,startingPoint){var centerPosition=positionInPath+graphemeInfo.kernedWidth/2,path=this.path;var info=fabric.util.getPointOnPath(path.path,centerPosition,path.segmentsInfo);graphemeInfo.renderLeft=info.x-startingPoint.x;graphemeInfo.renderTop=info.y-startingPoint.y;graphemeInfo.angle=info.angle+(this.pathSide==='right'?Math.PI:0);},_getGraphemeBox:function(grapheme,lineIndex,charIndex,prevGrapheme,skipLeft){var style=this.getCompleteStyleDeclaration(lineIndex,charIndex),prevStyle=prevGrapheme?this.getCompleteStyleDeclaration(lineIndex,charIndex-1):{},info=this._measureChar(grapheme,style,prevGrapheme,prevStyle),kernedWidth=info.kernedWidth,width=info.width,charSpacing;if(this.charSpacing!==0){charSpacing=this._getWidthOfCharSpacing();width+=charSpacing;kernedWidth+=charSpacing;}
var box={width:width,left:0,height:style.fontSize,kernedWidth:kernedWidth,deltaY:style.deltaY,};if(charIndex>0&&!skipLeft){var previousBox=this.__charBounds[lineIndex][charIndex-1];box.left=previousBox.left+previousBox.width+info.kernedWidth-info.width;}
return box;},getHeightOfLine:function(lineIndex){if(this.__lineHeights[lineIndex]){return this.__lineHeights[lineIndex];}
var line=this._textLines[lineIndex],maxHeight=this.getHeightOfChar(lineIndex,0);for(var i=1,len=line.length;i<len;i++){maxHeight=Math.max(this.getHeightOfChar(lineIndex,i),maxHeight);}
return this.__lineHeights[lineIndex]=maxHeight*this.lineHeight*this._fontSizeMult;},calcTextHeight:function(){var lineHeight,height=0;for(var i=0,len=this._textLines.length;i<len;i++){lineHeight=this.getHeightOfLine(i);height+=(i===len-1?lineHeight/this.lineHeight:lineHeight);}
return height;},_getLeftOffset:function(){return this.direction==='ltr'?-this.width/2:this.width/2;},_getTopOffset:function(){return-this.height/2;},_renderTextCommon:function(ctx,method){ctx.save();var lineHeights=0,left=this._getLeftOffset(),top=this._getTopOffset();for(var i=0,len=this._textLines.length;i<len;i++){var heightOfLine=this.getHeightOfLine(i),maxHeight=heightOfLine/this.lineHeight,leftOffset=this._getLineLeftOffset(i);this._renderTextLine(method,ctx,this._textLines[i],left+leftOffset,top+lineHeights+maxHeight,i);lineHeights+=heightOfLine;}
ctx.restore();},_renderTextFill:function(ctx){if(!this.fill&&!this.styleHas('fill')){return;}
this._renderTextCommon(ctx,'fillText');},_renderTextStroke:function(ctx){if((!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()){return;}
if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(ctx);}
ctx.save();this._setLineDash(ctx,this.strokeDashArray);ctx.beginPath();this._renderTextCommon(ctx,'strokeText');ctx.closePath();ctx.restore();},_renderChars:function(method,ctx,line,left,top,lineIndex){var lineHeight=this.getHeightOfLine(lineIndex),isJustify=this.textAlign.indexOf('justify')!==-1,actualStyle,nextStyle,charsToRender='',charBox,boxWidth=0,timeToRender,path=this.path,shortCut=!isJustify&&this.charSpacing===0&&this.isEmptyStyles(lineIndex)&&!path,isLtr=this.direction==='ltr',sign=this.direction==='ltr'?1:-1,drawingLeft;ctx.save();top-=lineHeight*this._fontSizeFraction/this.lineHeight;if(shortCut){ctx.canvas.setAttribute('dir',isLtr?'ltr':'rtl');ctx.direction=isLtr?'ltr':'rtl';ctx.textAlign=isLtr?'left':'right';this._renderChar(method,ctx,lineIndex,0,line.join(''),left,top,lineHeight);ctx.restore();return;}
for(var i=0,len=line.length-1;i<=len;i++){timeToRender=i===len||this.charSpacing||path;charsToRender+=line[i];charBox=this.__charBounds[lineIndex][i];if(boxWidth===0){left+=sign*(charBox.kernedWidth-charBox.width);boxWidth+=charBox.width;}
else{boxWidth+=charBox.kernedWidth;}
if(isJustify&&!timeToRender){if(this._reSpaceAndTab.test(line[i])){timeToRender=true;}}
if(!timeToRender){actualStyle=actualStyle||this.getCompleteStyleDeclaration(lineIndex,i);nextStyle=this.getCompleteStyleDeclaration(lineIndex,i+1);timeToRender=this._hasStyleChanged(actualStyle,nextStyle);}
if(timeToRender){if(path){ctx.save();ctx.translate(charBox.renderLeft,charBox.renderTop);ctx.rotate(charBox.angle);this._renderChar(method,ctx,lineIndex,i,charsToRender,-boxWidth/2,0,lineHeight);ctx.restore();}
else{drawingLeft=left;ctx.canvas.setAttribute('dir',isLtr?'ltr':'rtl');ctx.direction=isLtr?'ltr':'rtl';ctx.textAlign=isLtr?'left':'right';this._renderChar(method,ctx,lineIndex,i,charsToRender,drawingLeft,top,lineHeight);}
charsToRender='';actualStyle=nextStyle;left+=sign*boxWidth;boxWidth=0;}}
ctx.restore();},_applyPatternGradientTransformText:function(filler){var pCanvas=fabric.util.createCanvasElement(),pCtx,width=this.width+this.strokeWidth,height=this.height+this.strokeWidth;pCanvas.width=width;pCanvas.height=height;pCtx=pCanvas.getContext('2d');pCtx.beginPath();pCtx.moveTo(0,0);pCtx.lineTo(width,0);pCtx.lineTo(width,height);pCtx.lineTo(0,height);pCtx.closePath();pCtx.translate(width/2,height/2);pCtx.fillStyle=filler.toLive(pCtx);this._applyPatternGradientTransform(pCtx,filler);pCtx.fill();return pCtx.createPattern(pCanvas,'no-repeat');},handleFiller:function(ctx,property,filler){var offsetX,offsetY;if(filler.toLive){if(filler.gradientUnits==='percentage'||filler.gradientTransform||filler.patternTransform){offsetX=-this.width/2;offsetY=-this.height/2;ctx.translate(offsetX,offsetY);ctx[property]=this._applyPatternGradientTransformText(filler);return{offsetX:offsetX,offsetY:offsetY};}
else{ctx[property]=filler.toLive(ctx,this);return this._applyPatternGradientTransform(ctx,filler);}}
else{ctx[property]=filler;}
return{offsetX:0,offsetY:0};},_setStrokeStyles:function(ctx,decl){ctx.lineWidth=decl.strokeWidth;ctx.lineCap=this.strokeLineCap;ctx.lineDashOffset=this.strokeDashOffset;ctx.lineJoin=this.strokeLineJoin;ctx.miterLimit=this.strokeMiterLimit;return this.handleFiller(ctx,'strokeStyle',decl.stroke);},_setFillStyles:function(ctx,decl){return this.handleFiller(ctx,'fillStyle',decl.fill);},_renderChar:function(method,ctx,lineIndex,charIndex,_char,left,top){var decl=this._getStyleDeclaration(lineIndex,charIndex),fullDecl=this.getCompleteStyleDeclaration(lineIndex,charIndex),shouldFill=method==='fillText'&&fullDecl.fill,shouldStroke=method==='strokeText'&&fullDecl.stroke&&fullDecl.strokeWidth,fillOffsets,strokeOffsets;if(!shouldStroke&&!shouldFill){return;}
ctx.save();shouldFill&&(fillOffsets=this._setFillStyles(ctx,fullDecl));shouldStroke&&(strokeOffsets=this._setStrokeStyles(ctx,fullDecl));ctx.font=this._getFontDeclaration(fullDecl);if(decl&&decl.textBackgroundColor){this._removeShadow(ctx);}
if(decl&&decl.deltaY){top+=decl.deltaY;}
shouldFill&&ctx.fillText(_char,left-fillOffsets.offsetX,top-fillOffsets.offsetY);shouldStroke&&ctx.strokeText(_char,left-strokeOffsets.offsetX,top-strokeOffsets.offsetY);ctx.restore();},setSuperscript:function(start,end){return this._setScript(start,end,this.superscript);},setSubscript:function(start,end){return this._setScript(start,end,this.subscript);},_setScript:function(start,end,schema){var loc=this.get2DCursorLocation(start,true),fontSize=this.getValueOfPropertyAt(loc.lineIndex,loc.charIndex,'fontSize'),dy=this.getValueOfPropertyAt(loc.lineIndex,loc.charIndex,'deltaY'),style={fontSize:fontSize*schema.size,deltaY:dy+fontSize*schema.baseline};this.setSelectionStyles(style,start,end);return this;},_hasStyleChanged:function(prevStyle,thisStyle){return prevStyle.fill!==thisStyle.fill||prevStyle.stroke!==thisStyle.stroke||prevStyle.strokeWidth!==thisStyle.strokeWidth||prevStyle.fontSize!==thisStyle.fontSize||prevStyle.fontFamily!==thisStyle.fontFamily||prevStyle.fontWeight!==thisStyle.fontWeight||prevStyle.fontStyle!==thisStyle.fontStyle||prevStyle.deltaY!==thisStyle.deltaY;},_hasStyleChangedForSvg:function(prevStyle,thisStyle){return this._hasStyleChanged(prevStyle,thisStyle)||prevStyle.overline!==thisStyle.overline||prevStyle.underline!==thisStyle.underline||prevStyle.linethrough!==thisStyle.linethrough;},_getLineLeftOffset:function(lineIndex){var lineWidth=this.getLineWidth(lineIndex),lineDiff=this.width-lineWidth,textAlign=this.textAlign,direction=this.direction,isEndOfWrapping,leftOffset=0,isEndOfWrapping=this.isEndOfWrapping(lineIndex);if(textAlign==='justify'||(textAlign==='justify-center'&&!isEndOfWrapping)||(textAlign==='justify-right'&&!isEndOfWrapping)||(textAlign==='justify-left'&&!isEndOfWrapping)){return 0;}
if(textAlign==='center'){leftOffset=lineDiff/2;}
if(textAlign==='right'){leftOffset=lineDiff;}
if(textAlign==='justify-center'){leftOffset=lineDiff/2;}
if(textAlign==='justify-right'){leftOffset=lineDiff;}
if(direction==='rtl'){leftOffset-=lineDiff;}
return leftOffset;},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__charBounds=[];},_shouldClearDimensionCache:function(){var shouldClear=this._forceClearCache;shouldClear||(shouldClear=this.hasStateChanged('_dimensionAffectingProps'));if(shouldClear){this.dirty=true;this._forceClearCache=false;}
return shouldClear;},getLineWidth:function(lineIndex){if(this.__lineWidths[lineIndex]){return this.__lineWidths[lineIndex];}
var width,line=this._textLines[lineIndex],lineInfo;if(line===''){width=0;}
else{lineInfo=this.measureLine(lineIndex);width=lineInfo.width;}
this.__lineWidths[lineIndex]=width;return width;},_getWidthOfCharSpacing:function(){if(this.charSpacing!==0){return this.fontSize*this.charSpacing/1000;}
return 0;},getValueOfPropertyAt:function(lineIndex,charIndex,property){var charStyle=this._getStyleDeclaration(lineIndex,charIndex);if(charStyle&&typeof charStyle[property]!=='undefined'){return charStyle[property];}
return this[property];},_renderTextDecoration:function(ctx,type){if(!this[type]&&!this.styleHas(type)){return;}
var heightOfLine,size,_size,lineLeftOffset,dy,_dy,line,lastDecoration,leftOffset=this._getLeftOffset(),topOffset=this._getTopOffset(),top,boxStart,boxWidth,charBox,currentDecoration,maxHeight,currentFill,lastFill,path=this.path,charSpacing=this._getWidthOfCharSpacing(),offsetY=this.offsets[type];for(var i=0,len=this._textLines.length;i<len;i++){heightOfLine=this.getHeightOfLine(i);if(!this[type]&&!this.styleHas(type,i)){topOffset+=heightOfLine;continue;}
line=this._textLines[i];maxHeight=heightOfLine/this.lineHeight;lineLeftOffset=this._getLineLeftOffset(i);boxStart=0;boxWidth=0;lastDecoration=this.getValueOfPropertyAt(i,0,type);lastFill=this.getValueOfPropertyAt(i,0,'fill');top=topOffset+maxHeight*(1-this._fontSizeFraction);size=this.getHeightOfChar(i,0);dy=this.getValueOfPropertyAt(i,0,'deltaY');for(var j=0,jlen=line.length;j<jlen;j++){charBox=this.__charBounds[i][j];currentDecoration=this.getValueOfPropertyAt(i,j,type);currentFill=this.getValueOfPropertyAt(i,j,'fill');_size=this.getHeightOfChar(i,j);_dy=this.getValueOfPropertyAt(i,j,'deltaY');if(path&&currentDecoration&&currentFill){ctx.save();ctx.fillStyle=lastFill;ctx.translate(charBox.renderLeft,charBox.renderTop);ctx.rotate(charBox.angle);ctx.fillRect(-charBox.kernedWidth/2,offsetY*_size+_dy,charBox.kernedWidth,this.fontSize/15);ctx.restore();}
else if((currentDecoration!==lastDecoration||currentFill!==lastFill||_size!==size||_dy!==dy)&&boxWidth>0){var drawStart=leftOffset+lineLeftOffset+boxStart;if(this.direction==='rtl'){drawStart=this.width-drawStart-boxWidth;}
if(lastDecoration&&lastFill){ctx.fillStyle=lastFill;ctx.fillRect(drawStart,top+offsetY*size+dy,boxWidth,this.fontSize/15);}
boxStart=charBox.left;boxWidth=charBox.width;lastDecoration=currentDecoration;lastFill=currentFill;size=_size;dy=_dy;}
else{boxWidth+=charBox.kernedWidth;}}
var drawStart=leftOffset+lineLeftOffset+boxStart;if(this.direction==='rtl'){drawStart=this.width-drawStart-boxWidth;}
ctx.fillStyle=currentFill;currentDecoration&&currentFill&&ctx.fillRect(drawStart,top+offsetY*size+dy,boxWidth-charSpacing,this.fontSize/15);topOffset+=heightOfLine;}
this._removeShadow(ctx);},_getFontDeclaration:function(styleObject,forMeasuring){var style=styleObject||this,family=this.fontFamily,fontIsGeneric=fabric.Text.genericFonts.indexOf(family.toLowerCase())>-1;var fontFamily=family===undefined||family.indexOf('\'')>-1||family.indexOf(',')>-1||family.indexOf('"')>-1||fontIsGeneric?style.fontFamily:'"'+style.fontFamily+'"';return[(fabric.isLikelyNode?style.fontWeight:style.fontStyle),(fabric.isLikelyNode?style.fontStyle:style.fontWeight),forMeasuring?this.CACHE_FONT_SIZE+'px':style.fontSize+'px',fontFamily].join(' ');},render:function(ctx){if(!this.visible){return;}
if(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()){return;}
if(this._shouldClearDimensionCache()){this.initDimensions();}
this.callSuper('render',ctx);},_splitTextIntoLines:function(text){var lines=text.split(this._reNewline),newLines=new Array(lines.length),newLine=['\n'],newText=[];for(var i=0;i<lines.length;i++){newLines[i]=fabric.util.string.graphemeSplit(lines[i]);newText=newText.concat(newLines[i],newLine);}
newText.pop();return{_unwrappedLines:newLines,lines:lines,graphemeText:newText,graphemeLines:newLines};},toObject:function(propertiesToInclude){var allProperties=additionalProps.concat(propertiesToInclude);var obj=this.callSuper('toObject',allProperties);obj.styles=clone(this.styles,true);if(obj.path){obj.path=this.path.toObject();}
return obj;},set:function(key,value){this.callSuper('set',key,value);var needsDims=false;var isAddingPath=false;if(typeof key==='object'){for(var _key in key){if(_key==='path'){this.setPathInfo();}
needsDims=needsDims||this._dimensionAffectingProps.indexOf(_key)!==-1;isAddingPath=isAddingPath||_key==='path';}}
else{needsDims=this._dimensionAffectingProps.indexOf(key)!==-1;isAddingPath=key==='path';}
if(isAddingPath){this.setPathInfo();}
if(needsDims){this.initDimensions();this.setCoords();}
return this;},complexity:function(){return 1;}});fabric.Text.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat('x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor'.split(' '));fabric.Text.DEFAULT_SVG_FONT_SIZE=16;fabric.Text.fromElement=function(element,callback,options){if(!element){return callback(null);}
var parsedAttributes=fabric.parseAttributes(element,fabric.Text.ATTRIBUTE_NAMES),parsedAnchor=parsedAttributes.textAnchor||'left';options=fabric.util.object.extend((options?clone(options):{}),parsedAttributes);options.top=options.top||0;options.left=options.left||0;if(parsedAttributes.textDecoration){var textDecoration=parsedAttributes.textDecoration;if(textDecoration.indexOf('underline')!==-1){options.underline=true;}
if(textDecoration.indexOf('overline')!==-1){options.overline=true;}
if(textDecoration.indexOf('line-through')!==-1){options.linethrough=true;}
delete options.textDecoration;}
if('dx'in parsedAttributes){options.left+=parsedAttributes.dx;}
if('dy'in parsedAttributes){options.top+=parsedAttributes.dy;}
if(!('fontSize'in options)){options.fontSize=fabric.Text.DEFAULT_SVG_FONT_SIZE;}
var textContent='';if(!('textContent'in element)){if('firstChild'in element&&element.firstChild!==null){if('data'in element.firstChild&&element.firstChild.data!==null){textContent=element.firstChild.data;}}}
else{textContent=element.textContent;}
textContent=textContent.replace(/^\s+|\s+$|\n+/g,'').replace(/\s+/g,' ');var originalStrokeWidth=options.strokeWidth;options.strokeWidth=0;var text=new fabric.Text(textContent,options),textHeightScaleFactor=text.getScaledHeight()/text.height,lineHeightDiff=(text.height+text.strokeWidth)*text.lineHeight-text.height,scaledDiff=lineHeightDiff*textHeightScaleFactor,textHeight=text.getScaledHeight()+scaledDiff,offX=0;if(parsedAnchor==='center'){offX=text.getScaledWidth()/2;}
if(parsedAnchor==='right'){offX=text.getScaledWidth();}
text.set({left:text.left-offX,top:text.top-(textHeight-text.fontSize*(0.07+text._fontSizeFraction))/text.lineHeight,strokeWidth:typeof originalStrokeWidth!=='undefined'?originalStrokeWidth:1,});callback(text);};fabric.Text.fromObject=function(object,callback){var objectCopy=clone(object),path=object.path;delete objectCopy.path;return fabric.Object._fromObject('Text',objectCopy,function(textInstance){if(path){fabric.Object._fromObject('Path',path,function(pathInstance){textInstance.set('path',pathInstance);callback(textInstance);},'path');}
else{callback(textInstance);}},'text');};fabric.Text.genericFonts=['sans-serif','serif','cursive','fantasy','monospace'];fabric.util.createAccessors&&fabric.util.createAccessors(fabric.Text);})(true?exports:0);(function(){fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(lineIndex){if(!this.styles){return true;}
if(typeof lineIndex!=='undefined'&&!this.styles[lineIndex]){return true;}
var obj=typeof lineIndex==='undefined'?this.styles:{line:this.styles[lineIndex]};for(var p1 in obj){for(var p2 in obj[p1]){for(var p3 in obj[p1][p2]){return false;}}}
return true;},styleHas:function(property,lineIndex){if(!this.styles||!property||property===''){return false;}
if(typeof lineIndex!=='undefined'&&!this.styles[lineIndex]){return false;}
var obj=typeof lineIndex==='undefined'?this.styles:{0:this.styles[lineIndex]};for(var p1 in obj){for(var p2 in obj[p1]){if(typeof obj[p1][p2][property]!=='undefined'){return true;}}}
return false;},cleanStyle:function(property){if(!this.styles||!property||property===''){return false;}
var obj=this.styles,stylesCount=0,letterCount,stylePropertyValue,allStyleObjectPropertiesMatch=true,graphemeCount=0,styleObject;for(var p1 in obj){letterCount=0;for(var p2 in obj[p1]){var styleObject=obj[p1][p2],stylePropertyHasBeenSet=styleObject.hasOwnProperty(property);stylesCount++;if(stylePropertyHasBeenSet){if(!stylePropertyValue){stylePropertyValue=styleObject[property];}
else if(styleObject[property]!==stylePropertyValue){allStyleObjectPropertiesMatch=false;}
if(styleObject[property]===this[property]){delete styleObject[property];}}
else{allStyleObjectPropertiesMatch=false;}
if(Object.keys(styleObject).length!==0){letterCount++;}
else{delete obj[p1][p2];}}
if(letterCount===0){delete obj[p1];}}
for(var i=0;i<this._textLines.length;i++){graphemeCount+=this._textLines[i].length;}
if(allStyleObjectPropertiesMatch&&stylesCount===graphemeCount){this[property]=stylePropertyValue;this.removeStyle(property);}},removeStyle:function(property){if(!this.styles||!property||property===''){return;}
var obj=this.styles,line,lineNum,charNum;for(lineNum in obj){line=obj[lineNum];for(charNum in line){delete line[charNum][property];if(Object.keys(line[charNum]).length===0){delete line[charNum];}}
if(Object.keys(line).length===0){delete obj[lineNum];}}},_extendStyles:function(index,styles){var loc=this.get2DCursorLocation(index);if(!this._getLineStyle(loc.lineIndex)){this._setLineStyle(loc.lineIndex);}
if(!this._getStyleDeclaration(loc.lineIndex,loc.charIndex)){this._setStyleDeclaration(loc.lineIndex,loc.charIndex,{});}
fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex,loc.charIndex),styles);},get2DCursorLocation:function(selectionStart,skipWrapping){if(typeof selectionStart==='undefined'){selectionStart=this.selectionStart;}
var lines=skipWrapping?this._unwrappedTextLines:this._textLines,len=lines.length;for(var i=0;i<len;i++){if(selectionStart<=lines[i].length){return{lineIndex:i,charIndex:selectionStart};}
selectionStart-=lines[i].length+this.missingNewlineOffset(i);}
return{lineIndex:i-1,charIndex:lines[i-1].length<selectionStart?lines[i-1].length:selectionStart};},getSelectionStyles:function(startIndex,endIndex,complete){if(typeof startIndex==='undefined'){startIndex=this.selectionStart||0;}
if(typeof endIndex==='undefined'){endIndex=this.selectionEnd||startIndex;}
var styles=[];for(var i=startIndex;i<endIndex;i++){styles.push(this.getStyleAtPosition(i,complete));}
return styles;},getStyleAtPosition:function(position,complete){var loc=this.get2DCursorLocation(position),style=complete?this.getCompleteStyleDeclaration(loc.lineIndex,loc.charIndex):this._getStyleDeclaration(loc.lineIndex,loc.charIndex);return style||{};},setSelectionStyles:function(styles,startIndex,endIndex){if(typeof startIndex==='undefined'){startIndex=this.selectionStart||0;}
if(typeof endIndex==='undefined'){endIndex=this.selectionEnd||startIndex;}
for(var i=startIndex;i<endIndex;i++){this._extendStyles(i,styles);}
this._forceClearCache=true;return this;},_getStyleDeclaration:function(lineIndex,charIndex){var lineStyle=this.styles&&this.styles[lineIndex];if(!lineStyle){return null;}
return lineStyle[charIndex];},getCompleteStyleDeclaration:function(lineIndex,charIndex){var style=this._getStyleDeclaration(lineIndex,charIndex)||{},styleObject={},prop;for(var i=0;i<this._styleProperties.length;i++){prop=this._styleProperties[i];styleObject[prop]=typeof style[prop]==='undefined'?this[prop]:style[prop];}
return styleObject;},_setStyleDeclaration:function(lineIndex,charIndex,style){this.styles[lineIndex][charIndex]=style;},_deleteStyleDeclaration:function(lineIndex,charIndex){delete this.styles[lineIndex][charIndex];},_getLineStyle:function(lineIndex){return!!this.styles[lineIndex];},_setLineStyle:function(lineIndex){this.styles[lineIndex]={};},_deleteLineStyle:function(lineIndex){delete this.styles[lineIndex];}});})();(function(){function parseDecoration(object){if(object.textDecoration){object.textDecoration.indexOf('underline')>-1&&(object.underline=true);object.textDecoration.indexOf('line-through')>-1&&(object.linethrough=true);object.textDecoration.indexOf('overline')>-1&&(object.overline=true);delete object.textDecoration;}}
fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:'i-text',selectionStart:0,selectionEnd:0,selectionColor:'rgba(17,119,255,0.3)',isEditing:false,editable:true,editingBorderColor:'rgba(102,153,255,0.25)',cursorWidth:2,cursorColor:'',cursorDelay:1000,cursorDuration:600,caching:true,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:false,__widthOfSpace:[],inCompositionMode:false,initialize:function(text,options){this.callSuper('initialize',text,options);this.initBehavior();},setSelectionStart:function(index){index=Math.max(index,0);this._updateAndFire('selectionStart',index);},setSelectionEnd:function(index){index=Math.min(index,this.text.length);this._updateAndFire('selectionEnd',index);},_updateAndFire:function(property,index){if(this[property]!==index){this._fireSelectionChanged();this[property]=index;}
this._updateTextarea();},_fireSelectionChanged:function(){this.fire('selection:changed');this.canvas&&this.canvas.fire('text:selection:changed',{target:this});},initDimensions:function(){this.isEditing&&this.initDelayedCursor();this.clearContextTop();this.callSuper('initDimensions');},render:function(ctx){this.clearContextTop();this.callSuper('render',ctx);this.cursorOffsetCache={};this.renderCursorOrSelection();},_render:function(ctx){this.callSuper('_render',ctx);},clearContextTop:function(skipRestore){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return;}
var ctx=this.canvas.contextTop,v=this.canvas.viewportTransform;ctx.save();ctx.transform(v[0],v[1],v[2],v[3],v[4],v[5]);this.transform(ctx);this._clearTextArea(ctx);skipRestore||ctx.restore();},renderCursorOrSelection:function(){if(!this.isEditing||!this.canvas||!this.canvas.contextTop){return;}
var boundaries=this._getCursorBoundaries(),ctx=this.canvas.contextTop;this.clearContextTop(true);if(this.selectionStart===this.selectionEnd){this.renderCursor(boundaries,ctx);}
else{this.renderSelection(boundaries,ctx);}
ctx.restore();},_clearTextArea:function(ctx){var width=this.width+4,height=this.height+4;ctx.clearRect(-width/2,-height/2,width,height);},_getCursorBoundaries:function(position){if(typeof position==='undefined'){position=this.selectionStart;}
var left=this._getLeftOffset(),top=this._getTopOffset(),offsets=this._getCursorBoundariesOffsets(position);return{left:left,top:top,leftOffset:offsets.left,topOffset:offsets.top};},_getCursorBoundariesOffsets:function(position){if(this.cursorOffsetCache&&'top'in this.cursorOffsetCache){return this.cursorOffsetCache;}
var lineLeftOffset,lineIndex,charIndex,topOffset=0,leftOffset=0,boundaries,cursorPosition=this.get2DCursorLocation(position);charIndex=cursorPosition.charIndex;lineIndex=cursorPosition.lineIndex;for(var i=0;i<lineIndex;i++){topOffset+=this.getHeightOfLine(i);}
lineLeftOffset=this._getLineLeftOffset(lineIndex);var bound=this.__charBounds[lineIndex][charIndex];bound&&(leftOffset=bound.left);if(this.charSpacing!==0&&charIndex===this._textLines[lineIndex].length){leftOffset-=this._getWidthOfCharSpacing();}
boundaries={top:topOffset,left:lineLeftOffset+(leftOffset>0?leftOffset:0),};if(this.direction==='rtl'){boundaries.left*=-1;}
this.cursorOffsetCache=boundaries;return this.cursorOffsetCache;},renderCursor:function(boundaries,ctx){var cursorLocation=this.get2DCursorLocation(),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex>0?cursorLocation.charIndex-1:0,charHeight=this.getValueOfPropertyAt(lineIndex,charIndex,'fontSize'),multiplier=this.scaleX*this.canvas.getZoom(),cursorWidth=this.cursorWidth/multiplier,topOffset=boundaries.topOffset,dy=this.getValueOfPropertyAt(lineIndex,charIndex,'deltaY');topOffset+=(1-this._fontSizeFraction)*this.getHeightOfLine(lineIndex)/this.lineHeight
-charHeight*(1-this._fontSizeFraction);if(this.inCompositionMode){this.renderSelection(boundaries,ctx);}
ctx.fillStyle=this.cursorColor||this.getValueOfPropertyAt(lineIndex,charIndex,'fill');ctx.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;ctx.fillRect(boundaries.left+boundaries.leftOffset-cursorWidth/2,topOffset+boundaries.top+dy,cursorWidth,charHeight);},renderSelection:function(boundaries,ctx){var selectionStart=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,isJustify=this.textAlign.indexOf('justify')!==-1,start=this.get2DCursorLocation(selectionStart),end=this.get2DCursorLocation(selectionEnd),startLine=start.lineIndex,endLine=end.lineIndex,startChar=start.charIndex<0?0:start.charIndex,endChar=end.charIndex<0?0:end.charIndex;for(var i=startLine;i<=endLine;i++){var lineOffset=this._getLineLeftOffset(i)||0,lineHeight=this.getHeightOfLine(i),realLineHeight=0,boxStart=0,boxEnd=0;if(i===startLine){boxStart=this.__charBounds[startLine][startChar].left;}
if(i>=startLine&&i<endLine){boxEnd=isJustify&&!this.isEndOfWrapping(i)?this.width:this.getLineWidth(i)||5;}
else if(i===endLine){if(endChar===0){boxEnd=this.__charBounds[endLine][endChar].left;}
else{var charSpacing=this._getWidthOfCharSpacing();boxEnd=this.__charBounds[endLine][endChar-1].left
+this.__charBounds[endLine][endChar-1].width-charSpacing;}}
realLineHeight=lineHeight;if(this.lineHeight<1||(i===endLine&&this.lineHeight>1)){lineHeight/=this.lineHeight;}
var drawStart=boundaries.left+lineOffset+boxStart,drawWidth=boxEnd-boxStart,drawHeight=lineHeight,extraTop=0;if(this.inCompositionMode){ctx.fillStyle=this.compositionColor||'black';drawHeight=1;extraTop=lineHeight;}
else{ctx.fillStyle=this.selectionColor;}
if(this.direction==='rtl'){drawStart=this.width-drawStart-drawWidth;}
ctx.fillRect(drawStart,boundaries.top+boundaries.topOffset+extraTop,drawWidth,drawHeight);boundaries.topOffset+=realLineHeight;}},getCurrentCharFontSize:function(){var cp=this._getCurrentCharIndex();return this.getValueOfPropertyAt(cp.l,cp.c,'fontSize');},getCurrentCharColor:function(){var cp=this._getCurrentCharIndex();return this.getValueOfPropertyAt(cp.l,cp.c,'fill');},_getCurrentCharIndex:function(){var cursorPosition=this.get2DCursorLocation(this.selectionStart,true),charIndex=cursorPosition.charIndex>0?cursorPosition.charIndex-1:0;return{l:cursorPosition.lineIndex,c:charIndex};}});fabric.IText.fromObject=function(object,callback){parseDecoration(object);if(object.styles){for(var i in object.styles){for(var j in object.styles[i]){parseDecoration(object.styles[i][j]);}}}
fabric.Object._fromObject('IText',object,callback,'text');};})();(function(){var clone=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation();this.mouseMoveHandler=this.mouseMoveHandler.bind(this);},onDeselect:function(){this.isEditing&&this.exitEditing();this.selected=false;},initAddedHandler:function(){var _this=this;this.on('added',function(){var canvas=_this.canvas;if(canvas){if(!canvas._hasITextHandlers){canvas._hasITextHandlers=true;_this._initCanvasHandlers(canvas);}
canvas._iTextInstances=canvas._iTextInstances||[];canvas._iTextInstances.push(_this);}});},initRemovedHandler:function(){var _this=this;this.on('removed',function(){var canvas=_this.canvas;if(canvas){canvas._iTextInstances=canvas._iTextInstances||[];fabric.util.removeFromArray(canvas._iTextInstances,_this);if(canvas._iTextInstances.length===0){canvas._hasITextHandlers=false;_this._removeCanvasHandlers(canvas);}}});},_initCanvasHandlers:function(canvas){canvas._mouseUpITextHandler=function(){if(canvas._iTextInstances){canvas._iTextInstances.forEach(function(obj){obj.__isMousedown=false;});}};canvas.on('mouse:up',canvas._mouseUpITextHandler);},_removeCanvasHandlers:function(canvas){canvas.off('mouse:up',canvas._mouseUpITextHandler);},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,'_onTickComplete');},_animateCursor:function(obj,targetOpacity,duration,completeMethod){var tickState;tickState={isAborted:false,abort:function(){this.isAborted=true;},};obj.animate('_currentCursorOpacity',targetOpacity,{duration:duration,onComplete:function(){if(!tickState.isAborted){obj[completeMethod]();}},onChange:function(){if(obj.canvas&&obj.selectionStart===obj.selectionEnd){obj.renderCursorOrSelection();}},abort:function(){return tickState.isAborted;}});return tickState;},_onTickComplete:function(){var _this=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1);}
this._cursorTimeout1=setTimeout(function(){_this._currentTickCompleteState=_this._animateCursor(_this,0,this.cursorDuration/2,'_tick');},100);},initDelayedCursor:function(restart){var _this=this,delay=restart?0:this.cursorDelay;this.abortCursorAnimation();this._currentCursorOpacity=1;this._cursorTimeout2=setTimeout(function(){_this._tick();},delay);},abortCursorAnimation:function(){var shouldClear=this._currentTickState||this._currentTickCompleteState,canvas=this.canvas;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;if(shouldClear&&canvas){canvas.clearContext(canvas.contextTop||canvas.contextContainer);}},selectAll:function(){this.selectionStart=0;this.selectionEnd=this._text.length;this._fireSelectionChanged();this._updateTextarea();return this;},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join('');},findWordBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;if(this._reSpace.test(this._text[index])){while(this._reSpace.test(this._text[index])){offset++;index--;}}
while(/\S/.test(this._text[index])&&index>-1){offset++;index--;}
return startFrom-offset;},findWordBoundaryRight:function(startFrom){var offset=0,index=startFrom;if(this._reSpace.test(this._text[index])){while(this._reSpace.test(this._text[index])){offset++;index++;}}
while(/\S/.test(this._text[index])&&index<this._text.length){offset++;index++;}
return startFrom+offset;},findLineBoundaryLeft:function(startFrom){var offset=0,index=startFrom-1;while(!/\n/.test(this._text[index])&&index>-1){offset++;index--;}
return startFrom-offset;},findLineBoundaryRight:function(startFrom){var offset=0,index=startFrom;while(!/\n/.test(this._text[index])&&index<this._text.length){offset++;index++;}
return startFrom+offset;},searchWordBoundary:function(selectionStart,direction){var text=this._text,index=this._reSpace.test(text[selectionStart])?selectionStart-1:selectionStart,_char=text[index],reNonWord=fabric.reNonWord;while(!reNonWord.test(_char)&&index>0&&index<text.length){index+=direction;_char=text[index];}
if(reNonWord.test(_char)){index+=direction===1?0:1;}
return index;},selectWord:function(selectionStart){selectionStart=selectionStart||this.selectionStart;var newSelectionStart=this.searchWordBoundary(selectionStart,-1),newSelectionEnd=this.searchWordBoundary(selectionStart,1);this.selectionStart=newSelectionStart;this.selectionEnd=newSelectionEnd;this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection();},selectLine:function(selectionStart){selectionStart=selectionStart||this.selectionStart;var newSelectionStart=this.findLineBoundaryLeft(selectionStart),newSelectionEnd=this.findLineBoundaryRight(selectionStart);this.selectionStart=newSelectionStart;this.selectionEnd=newSelectionEnd;this._fireSelectionChanged();this._updateTextarea();return this;},enterEditing:function(e){if(this.isEditing||!this.editable){return;}
if(this.canvas){this.canvas.calcOffset();this.exitEditingOnOthers(this.canvas);}
this.isEditing=true;this.initHiddenTextarea(e);this.hiddenTextarea.focus();this.hiddenTextarea.value=this.text;this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._textBeforeEdit=this.text;this._tick();this.fire('editing:entered');this._fireSelectionChanged();if(!this.canvas){return this;}
this.canvas.fire('text:editing:entered',{target:this});this.initMouseMoveHandler();this.canvas.requestRenderAll();return this;},exitEditingOnOthers:function(canvas){if(canvas._iTextInstances){canvas._iTextInstances.forEach(function(obj){obj.selected=false;if(obj.isEditing){obj.exitEditing();}});}},initMouseMoveHandler:function(){this.canvas.on('mouse:move',this.mouseMoveHandler);},mouseMoveHandler:function(options){if(!this.__isMousedown||!this.isEditing){return;}
var newSelectionStart=this.getSelectionStartFromPointer(options.e),currentStart=this.selectionStart,currentEnd=this.selectionEnd;if((newSelectionStart!==this.__selectionStartOnMouseDown||currentStart===currentEnd)&&(currentStart===newSelectionStart||currentEnd===newSelectionStart)){return;}
if(newSelectionStart>this.__selectionStartOnMouseDown){this.selectionStart=this.__selectionStartOnMouseDown;this.selectionEnd=newSelectionStart;}
else{this.selectionStart=newSelectionStart;this.selectionEnd=this.__selectionStartOnMouseDown;}
if(this.selectionStart!==currentStart||this.selectionEnd!==currentEnd){this.restartCursorIfNeeded();this._fireSelectionChanged();this._updateTextarea();this.renderCursorOrSelection();}},_setEditingProps:function(){this.hoverCursor='text';if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor='text';}
this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true;},fromStringToGraphemeSelection:function(start,end,text){var smallerTextStart=text.slice(0,start),graphemeStart=fabric.util.string.graphemeSplit(smallerTextStart).length;if(start===end){return{selectionStart:graphemeStart,selectionEnd:graphemeStart};}
var smallerTextEnd=text.slice(start,end),graphemeEnd=fabric.util.string.graphemeSplit(smallerTextEnd).length;return{selectionStart:graphemeStart,selectionEnd:graphemeStart+graphemeEnd};},fromGraphemeToStringSelection:function(start,end,_text){var smallerTextStart=_text.slice(0,start),graphemeStart=smallerTextStart.join('').length;if(start===end){return{selectionStart:graphemeStart,selectionEnd:graphemeStart};}
var smallerTextEnd=_text.slice(start,end),graphemeEnd=smallerTextEnd.join('').length;return{selectionStart:graphemeStart,selectionEnd:graphemeStart+graphemeEnd};},_updateTextarea:function(){this.cursorOffsetCache={};if(!this.hiddenTextarea){return;}
if(!this.inCompositionMode){var newSelection=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=newSelection.selectionStart;this.hiddenTextarea.selectionEnd=newSelection.selectionEnd;}
this.updateTextareaPosition();},updateFromTextArea:function(){if(!this.hiddenTextarea){return;}
this.cursorOffsetCache={};this.text=this.hiddenTextarea.value;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}
var newSelection=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=newSelection.selectionEnd;if(!this.inCompositionMode){this.selectionStart=newSelection.selectionStart;}
this.updateTextareaPosition();},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var style=this._calcTextareaPosition();this.hiddenTextarea.style.left=style.left;this.hiddenTextarea.style.top=style.top;}},_calcTextareaPosition:function(){if(!this.canvas){return{x:1,y:1};}
var desiredPosition=this.inCompositionMode?this.compositionStart:this.selectionStart,boundaries=this._getCursorBoundaries(desiredPosition),cursorLocation=this.get2DCursorLocation(desiredPosition),lineIndex=cursorLocation.lineIndex,charIndex=cursorLocation.charIndex,charHeight=this.getValueOfPropertyAt(lineIndex,charIndex,'fontSize')*this.lineHeight,leftOffset=boundaries.leftOffset,m=this.calcTransformMatrix(),p={x:boundaries.left+leftOffset,y:boundaries.top+boundaries.topOffset+charHeight},retinaScaling=this.canvas.getRetinaScaling(),upperCanvas=this.canvas.upperCanvasEl,upperCanvasWidth=upperCanvas.width/retinaScaling,upperCanvasHeight=upperCanvas.height/retinaScaling,maxWidth=upperCanvasWidth-charHeight,maxHeight=upperCanvasHeight-charHeight,scaleX=upperCanvas.clientWidth/upperCanvasWidth,scaleY=upperCanvas.clientHeight/upperCanvasHeight;p=fabric.util.transformPoint(p,m);p=fabric.util.transformPoint(p,this.canvas.viewportTransform);p.x*=scaleX;p.y*=scaleY;if(p.x<0){p.x=0;}
if(p.x>maxWidth){p.x=maxWidth;}
if(p.y<0){p.y=0;}
if(p.y>maxHeight){p.y=maxHeight;}
p.x+=this.canvas._offset.left;p.y+=this.canvas._offset.top;return{left:p.x+'px',top:p.y+'px',fontSize:charHeight+'px',charHeight:charHeight};},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor};},_restoreEditingProps:function(){if(!this._savedProps){return;}
this.hoverCursor=this._savedProps.hoverCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.selectable=this._savedProps.selectable;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor;}},exitEditing:function(){var isTextChanged=(this._textBeforeEdit!==this.text);var hiddenTextarea=this.hiddenTextarea;this.selected=false;this.isEditing=false;this.selectionEnd=this.selectionStart;if(hiddenTextarea){hiddenTextarea.blur&&hiddenTextarea.blur();hiddenTextarea.parentNode&&hiddenTextarea.parentNode.removeChild(hiddenTextarea);}
this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}
this.fire('editing:exited');isTextChanged&&this.fire('modified');if(this.canvas){this.canvas.off('mouse:move',this.mouseMoveHandler);this.canvas.fire('text:editing:exited',{target:this});isTextChanged&&this.canvas.fire('object:modified',{target:this});}
return this;},_removeExtraneousStyles:function(){for(var prop in this.styles){if(!this._textLines[prop]){delete this.styles[prop];}}},removeStyleFromTo:function(start,end){var cursorStart=this.get2DCursorLocation(start,true),cursorEnd=this.get2DCursorLocation(end,true),lineStart=cursorStart.lineIndex,charStart=cursorStart.charIndex,lineEnd=cursorEnd.lineIndex,charEnd=cursorEnd.charIndex,i,styleObj;if(lineStart!==lineEnd){if(this.styles[lineStart]){for(i=charStart;i<this._unwrappedTextLines[lineStart].length;i++){delete this.styles[lineStart][i];}}
if(this.styles[lineEnd]){for(i=charEnd;i<this._unwrappedTextLines[lineEnd].length;i++){styleObj=this.styles[lineEnd][i];if(styleObj){this.styles[lineStart]||(this.styles[lineStart]={});this.styles[lineStart][charStart+i-charEnd]=styleObj;}}}
for(i=lineStart+1;i<=lineEnd;i++){delete this.styles[i];}
this.shiftLineStyles(lineEnd,lineStart-lineEnd);}
else{if(this.styles[lineStart]){styleObj=this.styles[lineStart];var diff=charEnd-charStart,numericChar,_char;for(i=charStart;i<charEnd;i++){delete styleObj[i];}
for(_char in this.styles[lineStart]){numericChar=parseInt(_char,10);if(numericChar>=charEnd){styleObj[numericChar-diff]=styleObj[_char];delete styleObj[_char];}}}}},shiftLineStyles:function(lineIndex,offset){var clonedStyles=clone(this.styles);for(var line in this.styles){var numericLine=parseInt(line,10);if(numericLine>lineIndex){this.styles[numericLine+offset]=clonedStyles[numericLine];if(!clonedStyles[numericLine-offset]){delete this.styles[numericLine];}}}},restartCursorIfNeeded:function(){if(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted){this.initDelayedCursor();}},insertNewlineStyleObject:function(lineIndex,charIndex,qty,copiedStyle){var currentCharStyle,newLineStyles={},somethingAdded=false,isEndOfLine=this._unwrappedTextLines[lineIndex].length===charIndex;qty||(qty=1);this.shiftLineStyles(lineIndex,qty);if(this.styles[lineIndex]){currentCharStyle=this.styles[lineIndex][charIndex===0?charIndex:charIndex-1];}
for(var index in this.styles[lineIndex]){var numIndex=parseInt(index,10);if(numIndex>=charIndex){somethingAdded=true;newLineStyles[numIndex-charIndex]=this.styles[lineIndex][index];if(!(isEndOfLine&&charIndex===0)){delete this.styles[lineIndex][index];}}}
var styleCarriedOver=false;if(somethingAdded&&!isEndOfLine){this.styles[lineIndex+qty]=newLineStyles;styleCarriedOver=true;}
if(styleCarriedOver){qty--;}
while(qty>0){if(copiedStyle&&copiedStyle[qty-1]){this.styles[lineIndex+qty]={0:clone(copiedStyle[qty-1])};}
else if(currentCharStyle){this.styles[lineIndex+qty]={0:clone(currentCharStyle)};}
else{delete this.styles[lineIndex+qty];}
qty--;}
this._forceClearCache=true;},insertCharStyleObject:function(lineIndex,charIndex,quantity,copiedStyle){if(!this.styles){this.styles={};}
var currentLineStyles=this.styles[lineIndex],currentLineStylesCloned=currentLineStyles?clone(currentLineStyles):{};quantity||(quantity=1);for(var index in currentLineStylesCloned){var numericIndex=parseInt(index,10);if(numericIndex>=charIndex){currentLineStyles[numericIndex+quantity]=currentLineStylesCloned[numericIndex];if(!currentLineStylesCloned[numericIndex-quantity]){delete currentLineStyles[numericIndex];}}}
this._forceClearCache=true;if(copiedStyle){while(quantity--){if(!Object.keys(copiedStyle[quantity]).length){continue;}
if(!this.styles[lineIndex]){this.styles[lineIndex]={};}
this.styles[lineIndex][charIndex+quantity]=clone(copiedStyle[quantity]);}
return;}
if(!currentLineStyles){return;}
var newStyle=currentLineStyles[charIndex?charIndex-1:1];while(newStyle&&quantity--){this.styles[lineIndex][charIndex+quantity]=clone(newStyle);}},insertNewStyleBlock:function(insertedText,start,copiedStyle){var cursorLoc=this.get2DCursorLocation(start,true),addedLines=[0],linesLength=0;for(var i=0;i<insertedText.length;i++){if(insertedText[i]==='\n'){linesLength++;addedLines[linesLength]=0;}
else{addedLines[linesLength]++;}}
if(addedLines[0]>0){this.insertCharStyleObject(cursorLoc.lineIndex,cursorLoc.charIndex,addedLines[0],copiedStyle);copiedStyle=copiedStyle&&copiedStyle.slice(addedLines[0]+1);}
linesLength&&this.insertNewlineStyleObject(cursorLoc.lineIndex,cursorLoc.charIndex+addedLines[0],linesLength);for(var i=1;i<linesLength;i++){if(addedLines[i]>0){this.insertCharStyleObject(cursorLoc.lineIndex+i,0,addedLines[i],copiedStyle);}
else if(copiedStyle){this.styles[cursorLoc.lineIndex+i][0]=copiedStyle[0];}
copiedStyle=copiedStyle&&copiedStyle.slice(addedLines[i]+1);}
if(addedLines[i]>0){this.insertCharStyleObject(cursorLoc.lineIndex+i,0,addedLines[i],copiedStyle);}},setSelectionStartEndWithShift:function(start,end,newSelection){if(newSelection<=start){if(end===start){this._selectionDirection='left';}
else if(this._selectionDirection==='right'){this._selectionDirection='left';this.selectionEnd=start;}
this.selectionStart=newSelection;}
else if(newSelection>start&&newSelection<end){if(this._selectionDirection==='right'){this.selectionEnd=newSelection;}
else{this.selectionStart=newSelection;}}
else{if(end===start){this._selectionDirection='right';}
else if(this._selectionDirection==='left'){this._selectionDirection='right';this.selectionStart=end;}
this.selectionEnd=newSelection;}},setSelectionInBoundaries:function(){var length=this.text.length;if(this.selectionStart>length){this.selectionStart=length;}
else if(this.selectionStart<0){this.selectionStart=0;}
if(this.selectionEnd>length){this.selectionEnd=length;}
else if(this.selectionEnd<0){this.selectionEnd=0;}}});})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date();this.__lastLastClickTime=+new Date();this.__lastPointer={};this.on('mousedown',this.onMouseDown);},onMouseDown:function(options){if(!this.canvas){return;}
this.__newClickTime=+new Date();var newPointer=options.pointer;if(this.isTripleClick(newPointer)){this.fire('tripleclick',options);this._stopEvent(options.e);}
this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=newPointer;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected;},isTripleClick:function(newPointer){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===newPointer.x&&this.__lastPointer.y===newPointer.y;},_stopEvent:function(e){e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();},initCursorSelectionHandlers:function(){this.initMousedownHandler();this.initMouseupHandler();this.initClicks();},doubleClickHandler:function(options){if(!this.isEditing){return;}
this.selectWord(this.getSelectionStartFromPointer(options.e));},tripleClickHandler:function(options){if(!this.isEditing){return;}
this.selectLine(this.getSelectionStartFromPointer(options.e));},initClicks:function(){this.on('mousedblclick',this.doubleClickHandler);this.on('tripleclick',this.tripleClickHandler);},_mouseDownHandler:function(options){if(!this.canvas||!this.editable||(options.e.button&&options.e.button!==1)){return;}
this.__isMousedown=true;if(this.selected){this.inCompositionMode=false;this.setCursorByClick(options.e);}
if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;if(this.selectionStart===this.selectionEnd){this.abortCursorAnimation();}
this.renderCursorOrSelection();}},_mouseDownHandlerBefore:function(options){if(!this.canvas||!this.editable||(options.e.button&&options.e.button!==1)){return;}
this.selected=this===this.canvas._activeObject;},initMousedownHandler:function(){this.on('mousedown',this._mouseDownHandler);this.on('mousedown:before',this._mouseDownHandlerBefore);},initMouseupHandler:function(){this.on('mouseup',this.mouseUpHandler);},mouseUpHandler:function(options){this.__isMousedown=false;if(!this.editable||this.group||(options.transform&&options.transform.actionPerformed)||(options.e.button&&options.e.button!==1)){return;}
if(this.canvas){var currentActive=this.canvas._activeObject;if(currentActive&&currentActive!==this){return;}}
if(this.__lastSelected&&!this.__corner){this.selected=false;this.__lastSelected=false;this.enterEditing(options.e);if(this.selectionStart===this.selectionEnd){this.initDelayedCursor(true);}
else{this.renderCursorOrSelection();}}
else{this.selected=true;}},setCursorByClick:function(e){var newSelection=this.getSelectionStartFromPointer(e),start=this.selectionStart,end=this.selectionEnd;if(e.shiftKey){this.setSelectionStartEndWithShift(start,end,newSelection);}
else{this.selectionStart=newSelection;this.selectionEnd=newSelection;}
if(this.isEditing){this._fireSelectionChanged();this._updateTextarea();}},getSelectionStartFromPointer:function(e){var mouseOffset=this.getLocalPointer(e),prevWidth=0,width=0,height=0,charIndex=0,lineIndex=0,lineLeftOffset,line;for(var i=0,len=this._textLines.length;i<len;i++){if(height<=mouseOffset.y){height+=this.getHeightOfLine(i)*this.scaleY;lineIndex=i;if(i>0){charIndex+=this._textLines[i-1].length+this.missingNewlineOffset(i-1);}}
else{break;}}
lineLeftOffset=this._getLineLeftOffset(lineIndex);width=lineLeftOffset*this.scaleX;line=this._textLines[lineIndex];if(this.direction==='rtl'){mouseOffset.x=this.width*this.scaleX-mouseOffset.x+width;}
for(var j=0,jlen=line.length;j<jlen;j++){prevWidth=width;width+=this.__charBounds[lineIndex][j].kernedWidth*this.scaleX;if(width<=mouseOffset.x){charIndex++;}
else{break;}}
return this._getNewSelectionStartFromOffset(mouseOffset,prevWidth,width,charIndex,jlen);},_getNewSelectionStartFromOffset:function(mouseOffset,prevWidth,width,index,jlen){var distanceBtwLastCharAndCursor=mouseOffset.x-prevWidth,distanceBtwNextCharAndCursor=width-mouseOffset.x,offset=distanceBtwNextCharAndCursor>distanceBtwLastCharAndCursor||distanceBtwNextCharAndCursor<0?0:1,newSelectionStart=index+offset;if(this.flipX){newSelectionStart=jlen-newSelectionStart;}
if(newSelectionStart>this._text.length){newSelectionStart=this._text.length;}
return newSelectionStart;}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement('textarea');this.hiddenTextarea.setAttribute('autocapitalize','off');this.hiddenTextarea.setAttribute('autocorrect','off');this.hiddenTextarea.setAttribute('autocomplete','off');this.hiddenTextarea.setAttribute('spellcheck','false');this.hiddenTextarea.setAttribute('data-fabric-hiddentextarea','');this.hiddenTextarea.setAttribute('wrap','off');var style=this._calcTextareaPosition();this.hiddenTextarea.style.cssText='position: absolute; top: '+style.top+'; left: '+style.left+'; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;'+' paddingï½°top: '+style.fontSize+';';if(this.hiddenTextareaContainer){this.hiddenTextareaContainer.appendChild(this.hiddenTextarea);}
else{fabric.document.body.appendChild(this.hiddenTextarea);}
fabric.util.addListener(this.hiddenTextarea,'keydown',this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,'keyup',this.onKeyUp.bind(this));fabric.util.addListener(this.hiddenTextarea,'input',this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,'copy',this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,'cut',this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,'paste',this.paste.bind(this));fabric.util.addListener(this.hiddenTextarea,'compositionstart',this.onCompositionStart.bind(this));fabric.util.addListener(this.hiddenTextarea,'compositionupdate',this.onCompositionUpdate.bind(this));fabric.util.addListener(this.hiddenTextarea,'compositionend',this.onCompositionEnd.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,'click',this.onClick.bind(this));this._clickHandlerInitialized=true;}},keysMap:{9:'exitEditing',27:'exitEditing',33:'moveCursorUp',34:'moveCursorDown',35:'moveCursorRight',36:'moveCursorLeft',37:'moveCursorLeft',38:'moveCursorUp',39:'moveCursorRight',40:'moveCursorDown',},keysMapRtl:{9:'exitEditing',27:'exitEditing',33:'moveCursorUp',34:'moveCursorDown',35:'moveCursorLeft',36:'moveCursorRight',37:'moveCursorRight',38:'moveCursorUp',39:'moveCursorLeft',40:'moveCursorDown',},ctrlKeysMapUp:{67:'copy',88:'cut'},ctrlKeysMapDown:{65:'selectAll'},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus();},onKeyDown:function(e){if(!this.isEditing){return;}
var keyMap=this.direction==='rtl'?this.keysMapRtl:this.keysMap;if(e.keyCode in keyMap){this[keyMap[e.keyCode]](e);}
else if((e.keyCode in this.ctrlKeysMapDown)&&(e.ctrlKey||e.metaKey)){this[this.ctrlKeysMapDown[e.keyCode]](e);}
else{return;}
e.stopImmediatePropagation();e.preventDefault();if(e.keyCode>=33&&e.keyCode<=40){this.inCompositionMode=false;this.clearContextTop();this.renderCursorOrSelection();}
else{this.canvas&&this.canvas.requestRenderAll();}},onKeyUp:function(e){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=false;return;}
if((e.keyCode in this.ctrlKeysMapUp)&&(e.ctrlKey||e.metaKey)){this[this.ctrlKeysMapUp[e.keyCode]](e);}
else{return;}
e.stopImmediatePropagation();e.preventDefault();this.canvas&&this.canvas.requestRenderAll();},onInput:function(e){var fromPaste=this.fromPaste;this.fromPaste=false;e&&e.stopPropagation();if(!this.isEditing){return;}
var nextText=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,charCount=this._text.length,nextCharCount=nextText.length,removedText,insertedText,charDiff=nextCharCount-charCount,selectionStart=this.selectionStart,selectionEnd=this.selectionEnd,selection=selectionStart!==selectionEnd,copiedStyle,removeFrom,removeTo;if(this.hiddenTextarea.value===''){this.styles={};this.updateFromTextArea();this.fire('changed');if(this.canvas){this.canvas.fire('text:changed',{target:this});this.canvas.requestRenderAll();}
return;}
var textareaSelection=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);var backDelete=selectionStart>textareaSelection.selectionStart;if(selection){removedText=this._text.slice(selectionStart,selectionEnd);charDiff+=selectionEnd-selectionStart;}
else if(nextCharCount<charCount){if(backDelete){removedText=this._text.slice(selectionEnd+charDiff,selectionEnd);}
else{removedText=this._text.slice(selectionStart,selectionStart-charDiff);}}
insertedText=nextText.slice(textareaSelection.selectionEnd-charDiff,textareaSelection.selectionEnd);if(removedText&&removedText.length){if(insertedText.length){copiedStyle=this.getSelectionStyles(selectionStart,selectionStart+1,false);copiedStyle=insertedText.map(function(){return copiedStyle[0];});}
if(selection){removeFrom=selectionStart;removeTo=selectionEnd;}
else if(backDelete){removeFrom=selectionEnd-removedText.length;removeTo=selectionEnd;}
else{removeFrom=selectionEnd;removeTo=selectionEnd+removedText.length;}
this.removeStyleFromTo(removeFrom,removeTo);}
if(insertedText.length){if(fromPaste&&insertedText.join('')===fabric.copiedText&&!fabric.disableStyleCopyPaste){copiedStyle=fabric.copiedTextStyle;}
this.insertNewStyleBlock(insertedText,selectionStart,copiedStyle);}
this.updateFromTextArea();this.fire('changed');if(this.canvas){this.canvas.fire('text:changed',{target:this});this.canvas.requestRenderAll();}},onCompositionStart:function(){this.inCompositionMode=true;},onCompositionEnd:function(){this.inCompositionMode=false;},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart;this.compositionEnd=e.target.selectionEnd;this.updateTextareaPosition();},copy:function(){if(this.selectionStart===this.selectionEnd){return;}
fabric.copiedText=this.getSelectedText();if(!fabric.disableStyleCopyPaste){fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,true);}
else{fabric.copiedTextStyle=null;}
this._copyDone=true;},paste:function(){this.fromPaste=true;},_getClipboardData:function(e){return(e&&e.clipboardData)||fabric.window.clipboardData;},_getWidthBeforeCursor:function(lineIndex,charIndex){var widthBeforeCursor=this._getLineLeftOffset(lineIndex),bound;if(charIndex>0){bound=this.__charBounds[lineIndex][charIndex-1];widthBeforeCursor+=bound.left+bound.width;}
return widthBeforeCursor;},getDownCursorOffset:function(e,isRight){var selectionProp=this._getSelectionForOffset(e,isRight),cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex;if(lineIndex===this._textLines.length-1||e.metaKey||e.keyCode===34){return this._text.length-selectionProp;}
var charIndex=cursorLocation.charIndex,widthBeforeCursor=this._getWidthBeforeCursor(lineIndex,charIndex),indexOnOtherLine=this._getIndexOnLine(lineIndex+1,widthBeforeCursor),textAfterCursor=this._textLines[lineIndex].slice(charIndex);return textAfterCursor.length+indexOnOtherLine+1+this.missingNewlineOffset(lineIndex);},_getSelectionForOffset:function(e,isRight){if(e.shiftKey&&this.selectionStart!==this.selectionEnd&&isRight){return this.selectionEnd;}
else{return this.selectionStart;}},getUpCursorOffset:function(e,isRight){var selectionProp=this._getSelectionForOffset(e,isRight),cursorLocation=this.get2DCursorLocation(selectionProp),lineIndex=cursorLocation.lineIndex;if(lineIndex===0||e.metaKey||e.keyCode===33){return-selectionProp;}
var charIndex=cursorLocation.charIndex,widthBeforeCursor=this._getWidthBeforeCursor(lineIndex,charIndex),indexOnOtherLine=this._getIndexOnLine(lineIndex-1,widthBeforeCursor),textBeforeCursor=this._textLines[lineIndex].slice(0,charIndex),missingNewlineOffset=this.missingNewlineOffset(lineIndex-1);return-this._textLines[lineIndex-1].length
+indexOnOtherLine-textBeforeCursor.length+(1-missingNewlineOffset);},_getIndexOnLine:function(lineIndex,width){var line=this._textLines[lineIndex],lineLeftOffset=this._getLineLeftOffset(lineIndex),widthOfCharsOnLine=lineLeftOffset,indexOnLine=0,charWidth,foundMatch;for(var j=0,jlen=line.length;j<jlen;j++){charWidth=this.__charBounds[lineIndex][j].width;widthOfCharsOnLine+=charWidth;if(widthOfCharsOnLine>width){foundMatch=true;var leftEdge=widthOfCharsOnLine-charWidth,rightEdge=widthOfCharsOnLine,offsetFromLeftEdge=Math.abs(leftEdge-width),offsetFromRightEdge=Math.abs(rightEdge-width);indexOnLine=offsetFromRightEdge<offsetFromLeftEdge?j:(j-1);break;}}
if(!foundMatch){indexOnLine=line.length-1;}
return indexOnLine;},moveCursorDown:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return;}
this._moveCursorUpOrDown('Down',e);},moveCursorUp:function(e){if(this.selectionStart===0&&this.selectionEnd===0){return;}
this._moveCursorUpOrDown('Up',e);},_moveCursorUpOrDown:function(direction,e){var action='get'+direction+'CursorOffset',offset=this[action](e,this._selectionDirection==='right');if(e.shiftKey){this.moveCursorWithShift(offset);}
else{this.moveCursorWithoutShift(offset);}
if(offset!==0){this.setSelectionInBoundaries();this.abortCursorAnimation();this._currentCursorOpacity=1;this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea();}},moveCursorWithShift:function(offset){var newSelection=this._selectionDirection==='left'?this.selectionStart+offset:this.selectionEnd+offset;this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,newSelection);return offset!==0;},moveCursorWithoutShift:function(offset){if(offset<0){this.selectionStart+=offset;this.selectionEnd=this.selectionStart;}
else{this.selectionEnd+=offset;this.selectionStart=this.selectionEnd;}
return offset!==0;},moveCursorLeft:function(e){if(this.selectionStart===0&&this.selectionEnd===0){return;}
this._moveCursorLeftOrRight('Left',e);},_move:function(e,prop,direction){var newValue;if(e.altKey){newValue=this['findWordBoundary'+direction](this[prop]);}
else if(e.metaKey||e.keyCode===35||e.keyCode===36){newValue=this['findLineBoundary'+direction](this[prop]);}
else{this[prop]+=direction==='Left'?-1:1;return true;}
if(typeof newValue!==undefined&&this[prop]!==newValue){this[prop]=newValue;return true;}},_moveLeft:function(e,prop){return this._move(e,prop,'Left');},_moveRight:function(e,prop){return this._move(e,prop,'Right');},moveCursorLeftWithoutShift:function(e){var change=true;this._selectionDirection='left';if(this.selectionEnd===this.selectionStart&&this.selectionStart!==0){change=this._moveLeft(e,'selectionStart');}
this.selectionEnd=this.selectionStart;return change;},moveCursorLeftWithShift:function(e){if(this._selectionDirection==='right'&&this.selectionStart!==this.selectionEnd){return this._moveLeft(e,'selectionEnd');}
else if(this.selectionStart!==0){this._selectionDirection='left';return this._moveLeft(e,'selectionStart');}},moveCursorRight:function(e){if(this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length){return;}
this._moveCursorLeftOrRight('Right',e);},_moveCursorLeftOrRight:function(direction,e){var actionName='moveCursor'+direction+'With';this._currentCursorOpacity=1;if(e.shiftKey){actionName+='Shift';}
else{actionName+='outShift';}
if(this[actionName](e)){this.abortCursorAnimation();this.initDelayedCursor();this._fireSelectionChanged();this._updateTextarea();}},moveCursorRightWithShift:function(e){if(this._selectionDirection==='left'&&this.selectionStart!==this.selectionEnd){return this._moveRight(e,'selectionStart');}
else if(this.selectionEnd!==this._text.length){this._selectionDirection='right';return this._moveRight(e,'selectionEnd');}},moveCursorRightWithoutShift:function(e){var changed=true;this._selectionDirection='right';if(this.selectionStart===this.selectionEnd){changed=this._moveRight(e,'selectionStart');this.selectionEnd=this.selectionStart;}
else{this.selectionStart=this.selectionEnd;}
return changed;},removeChars:function(start,end){if(typeof end==='undefined'){end=start+1;}
this.removeStyleFromTo(start,end);this._text.splice(start,end-start);this.text=this._text.join('');this.set('dirty',true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}
this._removeExtraneousStyles();},insertChars:function(text,style,start,end){if(typeof end==='undefined'){end=start;}
if(end>start){this.removeStyleFromTo(start,end);}
var graphemes=fabric.util.string.graphemeSplit(text);this.insertNewStyleBlock(graphemes,start,style);this._text=[].concat(this._text.slice(0,start),graphemes,this._text.slice(end));this.text=this._text.join('');this.set('dirty',true);if(this._shouldClearDimensionCache()){this.initDimensions();this.setCoords();}
this._removeExtraneousStyles();},});(function(){var toFixed=fabric.util.toFixed,multipleSpacesRegex=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{_toSVG:function(){var offsets=this._getSVGLeftTopOffsets(),textAndBg=this._getSVGTextAndBg(offsets.textTop,offsets.textLeft);return this._wrapSVGTextAndBg(textAndBg);},toSVG:function(reviver){return this._createBaseSVGMarkup(this._toSVG(),{reviver:reviver,noStyle:true,withShadow:true});},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)};},_wrapSVGTextAndBg:function(textAndBg){var noShadow=true,textDecoration=this.getSvgTextDecoration(this);return[textAndBg.textBgRects.join(''),'\t\t<text xml:space="preserve" ',(this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,'\'')+'" ':''),(this.fontSize?'font-size="'+this.fontSize+'" ':''),(this.fontStyle?'font-style="'+this.fontStyle+'" ':''),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':''),(textDecoration?'text-decoration="'+textDecoration+'" ':''),'style="',this.getSvgStyles(noShadow),'"',this.addPaintOrder(),' >',textAndBg.textSpans.join(''),'</text>\n'];},_getSVGTextAndBg:function(textTopOffset,textLeftOffset){var textSpans=[],textBgRects=[],height=textTopOffset,lineOffset;this._setSVGBg(textBgRects);for(var i=0,len=this._textLines.length;i<len;i++){lineOffset=this._getLineLeftOffset(i);if(this.textBackgroundColor||this.styleHas('textBackgroundColor',i)){this._setSVGTextLineBg(textBgRects,i,textLeftOffset+lineOffset,height);}
this._setSVGTextLineText(textSpans,i,textLeftOffset+lineOffset,height);height+=this.getHeightOfLine(i);}
return{textSpans:textSpans,textBgRects:textBgRects};},_createTextCharSpan:function(_char,styleDecl,left,top){var shouldUseWhitespace=_char!==_char.trim()||_char.match(multipleSpacesRegex),styleProps=this.getSvgSpanStyles(styleDecl,shouldUseWhitespace),fillStyles=styleProps?'style="'+styleProps+'"':'',dy=styleDecl.deltaY,dySpan='',NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;if(dy){dySpan=' dy="'+toFixed(dy,NUM_FRACTION_DIGITS)+'" ';}
return['<tspan x="',toFixed(left,NUM_FRACTION_DIGITS),'" y="',toFixed(top,NUM_FRACTION_DIGITS),'" ',dySpan,fillStyles,'>',fabric.util.string.escapeXml(_char),'</tspan>'].join('');},_setSVGTextLineText:function(textSpans,lineIndex,textLeftOffset,textTopOffset){var lineHeight=this.getHeightOfLine(lineIndex),isJustify=this.textAlign.indexOf('justify')!==-1,actualStyle,nextStyle,charsToRender='',charBox,style,boxWidth=0,line=this._textLines[lineIndex],timeToRender;textTopOffset+=lineHeight*(1-this._fontSizeFraction)/this.lineHeight;for(var i=0,len=line.length-1;i<=len;i++){timeToRender=i===len||this.charSpacing;charsToRender+=line[i];charBox=this.__charBounds[lineIndex][i];if(boxWidth===0){textLeftOffset+=charBox.kernedWidth-charBox.width;boxWidth+=charBox.width;}
else{boxWidth+=charBox.kernedWidth;}
if(isJustify&&!timeToRender){if(this._reSpaceAndTab.test(line[i])){timeToRender=true;}}
if(!timeToRender){actualStyle=actualStyle||this.getCompleteStyleDeclaration(lineIndex,i);nextStyle=this.getCompleteStyleDeclaration(lineIndex,i+1);timeToRender=this._hasStyleChangedForSvg(actualStyle,nextStyle);}
if(timeToRender){style=this._getStyleDeclaration(lineIndex,i)||{};textSpans.push(this._createTextCharSpan(charsToRender,style,textLeftOffset,textTopOffset));charsToRender='';actualStyle=nextStyle;textLeftOffset+=boxWidth;boxWidth=0;}}},_pushTextBgRect:function(textBgRects,color,left,top,width,height){var NUM_FRACTION_DIGITS=fabric.Object.NUM_FRACTION_DIGITS;textBgRects.push('\t\t<rect ',this._getFillAttributes(color),' x="',toFixed(left,NUM_FRACTION_DIGITS),'" y="',toFixed(top,NUM_FRACTION_DIGITS),'" width="',toFixed(width,NUM_FRACTION_DIGITS),'" height="',toFixed(height,NUM_FRACTION_DIGITS),'"></rect>\n');},_setSVGTextLineBg:function(textBgRects,i,leftOffset,textTopOffset){var line=this._textLines[i],heightOfLine=this.getHeightOfLine(i)/this.lineHeight,boxWidth=0,boxStart=0,charBox,currentColor,lastColor=this.getValueOfPropertyAt(i,0,'textBackgroundColor');for(var j=0,jlen=line.length;j<jlen;j++){charBox=this.__charBounds[i][j];currentColor=this.getValueOfPropertyAt(i,j,'textBackgroundColor');if(currentColor!==lastColor){lastColor&&this._pushTextBgRect(textBgRects,lastColor,leftOffset+boxStart,textTopOffset,boxWidth,heightOfLine);boxStart=charBox.left;boxWidth=charBox.width;lastColor=currentColor;}
else{boxWidth+=charBox.kernedWidth;}}
currentColor&&this._pushTextBgRect(textBgRects,currentColor,leftOffset+boxStart,textTopOffset,boxWidth,heightOfLine);},_getFillAttributes:function(value){var fillColor=(value&&typeof value==='string')?new fabric.Color(value):'';if(!fillColor||!fillColor.getSource()||fillColor.getAlpha()===1){return'fill="'+value+'"';}
return'opacity="'+fillColor.getAlpha()+'" fill="'+fillColor.setAlpha(1).toRgb()+'"';},_getSVGLineTopOffset:function(lineIndex){var lineTopOffset=0,lastHeight=0;for(var j=0;j<lineIndex;j++){lineTopOffset+=this.getHeightOfLine(j);}
lastHeight=this.getHeightOfLine(j);return{lineTop:lineTopOffset,offset:(this._fontSizeMult-this._fontSizeFraction)*lastHeight/(this.lineHeight*this._fontSizeMult)};},getSvgStyles:function(skipShadow){var svgStyle=fabric.Object.prototype.getSvgStyles.call(this,skipShadow);return svgStyle+' white-space: pre;';},});})();(function(global){'use strict';var fabric=global.fabric||(global.fabric={});fabric.Textbox=fabric.util.createClass(fabric.IText,fabric.Observable,{type:'textbox',minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:true,noScaleCache:false,_dimensionAffectingProps:fabric.Text.prototype._dimensionAffectingProps.concat('width'),_wordJoiners:/[ \t\r]/,splitByGrapheme:false,initDimensions:function(){if(this.__skipDimension){return;}
this.isEditing&&this.initDelayedCursor();this.clearContextTop();this._clearCache();this.dynamicMinWidth=0;this._styleMap=this._generateStyleMap(this._splitText());if(this.dynamicMinWidth>this.width){this._set('width',this.dynamicMinWidth);}
if(this.textAlign.indexOf('justify')!==-1){this.enlargeSpaces();}
this.height=this.calcTextHeight();this.saveState({propertySet:'_dimensionAffectingProps'});},_generateStyleMap:function(textInfo){var realLineCount=0,realLineCharCount=0,charCount=0,map={};for(var i=0;i<textInfo.graphemeLines.length;i++){if(textInfo.graphemeText[charCount]==='\n'&&i>0){realLineCharCount=0;charCount++;realLineCount++;}
else if(!this.splitByGrapheme&&this._reSpaceAndTab.test(textInfo.graphemeText[charCount])&&i>0){realLineCharCount++;charCount++;}
map[i]={line:realLineCount,offset:realLineCharCount};charCount+=textInfo.graphemeLines[i].length;realLineCharCount+=textInfo.graphemeLines[i].length;}
return map;},styleHas:function(property,lineIndex){if(this._styleMap&&!this.isWrapping){var map=this._styleMap[lineIndex];if(map){lineIndex=map.line;}}
return fabric.Text.prototype.styleHas.call(this,property,lineIndex);},isEmptyStyles:function(lineIndex){if(!this.styles){return true;}
var offset=0,nextLineIndex=lineIndex+1,nextOffset,obj,shouldLimit=false,map=this._styleMap[lineIndex],mapNextLine=this._styleMap[lineIndex+1];if(map){lineIndex=map.line;offset=map.offset;}
if(mapNextLine){nextLineIndex=mapNextLine.line;shouldLimit=nextLineIndex===lineIndex;nextOffset=mapNextLine.offset;}
obj=typeof lineIndex==='undefined'?this.styles:{line:this.styles[lineIndex]};for(var p1 in obj){for(var p2 in obj[p1]){if(p2>=offset&&(!shouldLimit||p2<nextOffset)){for(var p3 in obj[p1][p2]){return false;}}}}
return true;},_getStyleDeclaration:function(lineIndex,charIndex){if(this._styleMap&&!this.isWrapping){var map=this._styleMap[lineIndex];if(!map){return null;}
lineIndex=map.line;charIndex=map.offset+charIndex;}
return this.callSuper('_getStyleDeclaration',lineIndex,charIndex);},_setStyleDeclaration:function(lineIndex,charIndex,style){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;this.styles[lineIndex][charIndex]=style;},_deleteStyleDeclaration:function(lineIndex,charIndex){var map=this._styleMap[lineIndex];lineIndex=map.line;charIndex=map.offset+charIndex;delete this.styles[lineIndex][charIndex];},_getLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];return!!this.styles[map.line];},_setLineStyle:function(lineIndex){var map=this._styleMap[lineIndex];this.styles[map.line]={};},_wrapText:function(lines,desiredWidth){var wrapped=[],i;this.isWrapping=true;for(i=0;i<lines.length;i++){wrapped=wrapped.concat(this._wrapLine(lines[i],i,desiredWidth));}
this.isWrapping=false;return wrapped;},_measureWord:function(word,lineIndex,charOffset){var width=0,prevGrapheme,skipLeft=true;charOffset=charOffset||0;for(var i=0,len=word.length;i<len;i++){var box=this._getGraphemeBox(word[i],lineIndex,i+charOffset,prevGrapheme,skipLeft);width+=box.kernedWidth;prevGrapheme=word[i];}
return width;},_wrapLine:function(_line,lineIndex,desiredWidth,reservedSpace){var lineWidth=0,splitByGrapheme=this.splitByGrapheme,graphemeLines=[],line=[],words=splitByGrapheme?fabric.util.string.graphemeSplit(_line):_line.split(this._wordJoiners),word='',offset=0,infix=splitByGrapheme?'':' ',wordWidth=0,infixWidth=0,largestWordWidth=0,lineJustStarted=true,additionalSpace=this._getWidthOfCharSpacing(),reservedSpace=reservedSpace||0;if(words.length===0){words.push([]);}
desiredWidth-=reservedSpace;for(var i=0;i<words.length;i++){word=splitByGrapheme?words[i]:fabric.util.string.graphemeSplit(words[i]);wordWidth=this._measureWord(word,lineIndex,offset);offset+=word.length;lineWidth+=infixWidth+wordWidth-additionalSpace;if(lineWidth>desiredWidth&&!lineJustStarted){graphemeLines.push(line);line=[];lineWidth=wordWidth;lineJustStarted=true;}
else{lineWidth+=additionalSpace;}
if(!lineJustStarted&&!splitByGrapheme){line.push(infix);}
line=line.concat(word);infixWidth=splitByGrapheme?0:this._measureWord([infix],lineIndex,offset);offset++;lineJustStarted=false;if(wordWidth>largestWordWidth){largestWordWidth=wordWidth;}}
i&&graphemeLines.push(line);if(largestWordWidth+reservedSpace>this.dynamicMinWidth){this.dynamicMinWidth=largestWordWidth-additionalSpace+reservedSpace;}
return graphemeLines;},isEndOfWrapping:function(lineIndex){if(!this._styleMap[lineIndex+1]){return true;}
if(this._styleMap[lineIndex+1].line!==this._styleMap[lineIndex].line){return true;}
return false;},missingNewlineOffset:function(lineIndex){if(this.splitByGrapheme){return this.isEndOfWrapping(lineIndex)?1:0;}
return 1;},_splitTextIntoLines:function(text){var newText=fabric.Text.prototype._splitTextIntoLines.call(this,text),graphemeLines=this._wrapText(newText.lines,this.width),lines=new Array(graphemeLines.length);for(var i=0;i<graphemeLines.length;i++){lines[i]=graphemeLines[i].join('');}
newText.lines=lines;newText.graphemeLines=graphemeLines;return newText;},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth);},_removeExtraneousStyles:function(){var linesToKeep={};for(var prop in this._styleMap){if(this._textLines[prop]){linesToKeep[this._styleMap[prop].line]=1;}}
for(var prop in this.styles){if(!linesToKeep[prop]){delete this.styles[prop];}}},toObject:function(propertiesToInclude){return this.callSuper('toObject',['minWidth','splitByGrapheme'].concat(propertiesToInclude));}});fabric.Textbox.fromObject=function(object,callback){return fabric.Object._fromObject('Textbox',object,callback,'text');};})(true?exports:0);(function(){var controlsUtils=fabric.controlsUtils,scaleSkewStyleHandler=controlsUtils.scaleSkewCursorStyleHandler,scaleStyleHandler=controlsUtils.scaleCursorStyleHandler,scalingEqually=controlsUtils.scalingEqually,scalingYOrSkewingX=controlsUtils.scalingYOrSkewingX,scalingXOrSkewingY=controlsUtils.scalingXOrSkewingY,scaleOrSkewActionName=controlsUtils.scaleOrSkewActionName,objectControls=fabric.Object.prototype.controls;objectControls.ml=new fabric.Control({x:-0.5,y:0,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingXOrSkewingY,getActionName:scaleOrSkewActionName,});objectControls.mr=new fabric.Control({x:0.5,y:0,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingXOrSkewingY,getActionName:scaleOrSkewActionName,});objectControls.mb=new fabric.Control({x:0,y:0.5,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingYOrSkewingX,getActionName:scaleOrSkewActionName,});objectControls.mt=new fabric.Control({x:0,y:-0.5,cursorStyleHandler:scaleSkewStyleHandler,actionHandler:scalingYOrSkewingX,getActionName:scaleOrSkewActionName,});objectControls.tl=new fabric.Control({x:-0.5,y:-0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.tr=new fabric.Control({x:0.5,y:-0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.bl=new fabric.Control({x:-0.5,y:0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.br=new fabric.Control({x:0.5,y:0.5,cursorStyleHandler:scaleStyleHandler,actionHandler:scalingEqually});objectControls.mtr=new fabric.Control({x:0,y:-0.5,actionHandler:controlsUtils.rotationWithSnapping,cursorStyleHandler:controlsUtils.rotationStyleHandler,offsetY:-40,withConnection:true,actionName:'rotate',});if(fabric.Textbox){var textBoxControls=fabric.Textbox.prototype.controls={};textBoxControls.mtr=objectControls.mtr;textBoxControls.tr=objectControls.tr;textBoxControls.br=objectControls.br;textBoxControls.tl=objectControls.tl;textBoxControls.bl=objectControls.bl;textBoxControls.mt=objectControls.mt;textBoxControls.mb=objectControls.mb;textBoxControls.mr=new fabric.Control({x:0.5,y:0,actionHandler:controlsUtils.changeWidth,cursorStyleHandler:scaleSkewStyleHandler,actionName:'resizing',});textBoxControls.ml=new fabric.Control({x:-0.5,y:0,actionHandler:controlsUtils.changeWidth,cursorStyleHandler:scaleSkewStyleHandler,actionName:'resizing',});}})();}),3053:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var isArray=__webpack_require__(602);function inArray(searchElement,array,startIndex){var i;var length;startIndex=startIndex||0;if(!isArray(array)){return-1;}
if(Array.prototype.indexOf){return Array.prototype.indexOf.call(array,searchElement,startIndex);}
length=array.length;for(i=startIndex;startIndex>=0&&i<length;i+=1){if(array[i]===searchElement){return i;}}
return-1;}
module.exports=inArray;}),8592:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var isArray=__webpack_require__(602);var forEachArray=__webpack_require__(6092);var forEachOwnProperties=__webpack_require__(5573);function forEach(obj,iteratee,context){if(isArray(obj)){forEachArray(obj,iteratee,context);}else{forEachOwnProperties(obj,iteratee,context);}}
module.exports=forEach;}),6092:(function(module){"use strict";function forEachArray(arr,iteratee,context){var index=0;var len=arr.length;context=context||null;for(;index<len;index+=1){if(iteratee.call(context,arr[index],index,arr)===false){break;}}}
module.exports=forEachArray;}),5573:(function(module){"use strict";function forEachOwnProperties(obj,iteratee,context){var key;context=context||null;for(key in obj){if(obj.hasOwnProperty(key)){if(iteratee.call(context,obj[key],key,obj)===false){break;}}}}
module.exports=forEachOwnProperties;}),9052:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var extend=__webpack_require__(961);var isExisty=__webpack_require__(9886);var isString=__webpack_require__(2560);var isObject=__webpack_require__(5393);var isArray=__webpack_require__(602);var isFunction=__webpack_require__(5183);var forEach=__webpack_require__(8592);var R_EVENTNAME_SPLIT=/\s+/g;function CustomEvents(){this.events=null;this.contexts=null;}
CustomEvents.mixin=function(func){extend(func.prototype,CustomEvents.prototype);};CustomEvents.prototype._getHandlerItem=function(handler,context){var item={handler:handler};if(context){item.context=context;}
return item;};CustomEvents.prototype._safeEvent=function(eventName){var events=this.events;var byName;if(!events){events=this.events={};}
if(eventName){byName=events[eventName];if(!byName){byName=[];events[eventName]=byName;}
events=byName;}
return events;};CustomEvents.prototype._safeContext=function(){var context=this.contexts;if(!context){context=this.contexts=[];}
return context;};CustomEvents.prototype._indexOfContext=function(ctx){var context=this._safeContext();var index=0;while(context[index]){if(ctx===context[index][0]){return index;}
index+=1;}
return-1;};CustomEvents.prototype._memorizeContext=function(ctx){var context,index;if(!isExisty(ctx)){return;}
context=this._safeContext();index=this._indexOfContext(ctx);if(index>-1){context[index][1]+=1;}else{context.push([ctx,1]);}};CustomEvents.prototype._forgetContext=function(ctx){var context,contextIndex;if(!isExisty(ctx)){return;}
context=this._safeContext();contextIndex=this._indexOfContext(ctx);if(contextIndex>-1){context[contextIndex][1]-=1;if(context[contextIndex][1]<=0){context.splice(contextIndex,1);}}};CustomEvents.prototype._bindEvent=function(eventName,handler,context){var events=this._safeEvent(eventName);this._memorizeContext(context);events.push(this._getHandlerItem(handler,context));};CustomEvents.prototype.on=function(eventName,handler,context){var self=this;if(isString(eventName)){eventName=eventName.split(R_EVENTNAME_SPLIT);forEach(eventName,function(name){self._bindEvent(name,handler,context);});}else if(isObject(eventName)){context=handler;forEach(eventName,function(func,name){self.on(name,func,context);});}};CustomEvents.prototype.once=function(eventName,handler,context){var self=this;if(isObject(eventName)){context=handler;forEach(eventName,function(func,name){self.once(name,func,context);});return;}
function onceHandler(){handler.apply(context,arguments);self.off(eventName,onceHandler,context);}
this.on(eventName,onceHandler,context);};CustomEvents.prototype._spliceMatches=function(arr,predicate){var i=0;var len;if(!isArray(arr)){return;}
for(len=arr.length;i<len;i+=1){if(predicate(arr[i])===true){arr.splice(i,1);len-=1;i-=1;}}};CustomEvents.prototype._matchHandler=function(handler){var self=this;return function(item){var needRemove=handler===item.handler;if(needRemove){self._forgetContext(item.context);}
return needRemove;};};CustomEvents.prototype._matchContext=function(context){var self=this;return function(item){var needRemove=context===item.context;if(needRemove){self._forgetContext(item.context);}
return needRemove;};};CustomEvents.prototype._matchHandlerAndContext=function(handler,context){var self=this;return function(item){var matchHandler=(handler===item.handler);var matchContext=(context===item.context);var needRemove=(matchHandler&&matchContext);if(needRemove){self._forgetContext(item.context);}
return needRemove;};};CustomEvents.prototype._offByEventName=function(eventName,handler){var self=this;var andByHandler=isFunction(handler);var matchHandler=self._matchHandler(handler);eventName=eventName.split(R_EVENTNAME_SPLIT);forEach(eventName,function(name){var handlerItems=self._safeEvent(name);if(andByHandler){self._spliceMatches(handlerItems,matchHandler);}else{forEach(handlerItems,function(item){self._forgetContext(item.context);});self.events[name]=[];}});};CustomEvents.prototype._offByHandler=function(handler){var self=this;var matchHandler=this._matchHandler(handler);forEach(this._safeEvent(),function(handlerItems){self._spliceMatches(handlerItems,matchHandler);});};CustomEvents.prototype._offByObject=function(obj,handler){var self=this;var matchFunc;if(this._indexOfContext(obj)<0){forEach(obj,function(func,name){self.off(name,func);});}else if(isString(handler)){matchFunc=this._matchContext(obj);self._spliceMatches(this._safeEvent(handler),matchFunc);}else if(isFunction(handler)){matchFunc=this._matchHandlerAndContext(handler,obj);forEach(this._safeEvent(),function(handlerItems){self._spliceMatches(handlerItems,matchFunc);});}else{matchFunc=this._matchContext(obj);forEach(this._safeEvent(),function(handlerItems){self._spliceMatches(handlerItems,matchFunc);});}};CustomEvents.prototype.off=function(eventName,handler){if(isString(eventName)){this._offByEventName(eventName,handler);}else if(!arguments.length){this.events={};this.contexts=[];}else if(isFunction(eventName)){this._offByHandler(eventName);}else if(isObject(eventName)){this._offByObject(eventName,handler);}};CustomEvents.prototype.fire=function(eventName){this.invoke.apply(this,arguments);};CustomEvents.prototype.invoke=function(eventName){var events,args,index,item;if(!this.hasListener(eventName)){return true;}
events=this._safeEvent(eventName);args=Array.prototype.slice.call(arguments,1);index=0;while(events[index]){item=events[index];if(item.handler.apply(item.context,args)===false){return false;}
index+=1;}
return true;};CustomEvents.prototype.hasListener=function(eventName){return this.getListenerLength(eventName)>0;};CustomEvents.prototype.getListenerLength=function(eventName){var events=this._safeEvent(eventName);return events.length;};module.exports=CustomEvents;}),961:(function(module){"use strict";function extend(target,objects){var hasOwnProp=Object.prototype.hasOwnProperty;var source,prop,i,len;for(i=1,len=arguments.length;i<len;i+=1){source=arguments[i];for(prop in source){if(hasOwnProp.call(source,prop)){target[prop]=source[prop];}}}
return target;}
module.exports=extend;}),1610:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var isUndefined=__webpack_require__(5695);var isNull=__webpack_require__(3778);function pick(obj,paths){var args=arguments;var target=args[0];var i=1;var length=args.length;for(;i<length;i+=1){if(isUndefined(target)||isNull(target)){return;}
target=target[args[i]];}
return target;}
module.exports=pick;}),4564:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var forEachOwnProperties=__webpack_require__(5573);function imagePing(url,trackingInfo){var trackingElement=document.createElement('img');var queryString='';forEachOwnProperties(trackingInfo,function(value,key){queryString+='&'+key+'='+value;});queryString=queryString.substring(1);trackingElement.src=url+'?'+queryString;trackingElement.style.display='none';document.body.appendChild(trackingElement);document.body.removeChild(trackingElement);return trackingElement;}
module.exports=imagePing;}),4729:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var isUndefined=__webpack_require__(5695);var imagePing=__webpack_require__(4564);var ms7days=7*24*60*60*1000;function isExpired(date){var now=new Date().getTime();return now-date>ms7days;}
function sendHostname(appName,trackingId){var url='https://www.google-analytics.com/collect';var hostname=location.hostname;var hitType='event';var eventCategory='use';var applicationKeyForStorage='TOAST UI '+appName+' for '+hostname+': Statistics';var date=window.localStorage.getItem(applicationKeyForStorage);if(!isUndefined(window.tui)&&window.tui.usageStatistics===false){return;}
if(date&&!isExpired(date)){return;}
window.localStorage.setItem(applicationKeyForStorage,new Date().getTime());setTimeout(function(){if(document.readyState==='interactive'||document.readyState==='complete'){imagePing(url,{v:1,t:hitType,tid:trackingId,cid:hostname,dp:hostname,dh:appName,el:appName,ec:eventCategory});}},1000);}
module.exports=sendHostname;}),602:(function(module){"use strict";function isArray(obj){return obj instanceof Array;}
module.exports=isArray;}),9886:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var isUndefined=__webpack_require__(5695);var isNull=__webpack_require__(3778);function isExisty(param){return!isUndefined(param)&&!isNull(param);}
module.exports=isExisty;}),5183:(function(module){"use strict";function isFunction(obj){return obj instanceof Function;}
module.exports=isFunction;}),3778:(function(module){"use strict";function isNull(obj){return obj===null;}
module.exports=isNull;}),5393:(function(module){"use strict";function isObject(obj){return obj===Object(obj);}
module.exports=isObject;}),2560:(function(module){"use strict";function isString(obj){return typeof obj==='string'||obj instanceof String;}
module.exports=isString;}),5695:(function(module){"use strict";function isUndefined(obj){return obj===undefined;}
module.exports=isUndefined;}),4426:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(4486);}),9406:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(4877);}),789:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(7178);}),381:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(5603);}),7636:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(1206);}),1899:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(6174);}),899:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(57);}),8005:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(4741);}),6562:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(8368);}),9131:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(3739);}),4383:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(172);}),6065:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(4963);}),1734:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(7820);}),2461:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(5636);}),5214:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(5059);}),6397:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(3969);}),8189:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(6618);}),9146:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(5279);}),4496:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(9562);}),3972:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(652);}),7172:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(2813);}),1845:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(8664);}),662:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(1457);}),711:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(2937);}),6623:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(9297);}),7077:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(8026);}),9856:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(2044);}),4230:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(2214);}),184:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(9256);}),3742:(function(module,__unused_webpack_exports,__webpack_require__){module.exports=__webpack_require__(5659);}),1801:(function(module){var DIVISOR={rect:1,circle:2,triangle:1};var DIMENSION_KEYS={rect:{w:'width',h:'height'},circle:{w:'rx',h:'ry'},triangle:{w:'width',h:'height'}};function setStartPoint(shape){var originX=shape.originX,originY=shape.originY;var originKey=originX.substring(0,1)+originY.substring(0,1);shape.startPoint=shape.origins[originKey];}
function getPositionsOfRotatedOrigin(origin,pointer,angle){var sx=origin.x;var sy=origin.y;var px=pointer.x;var py=pointer.y;var r=angle*Math.PI/180;var rx=(px-sx)*Math.cos(r)-(py-sy)*Math.sin(r)+sx;var ry=(px-sx)*Math.sin(r)+(py-sy)*Math.cos(r)+sy;return{originX:sx>rx?'right':'left',originY:sy>ry?'bottom':'top'};}
function hasCenterOrigin(shape){return shape.originX==='center'&&shape.originY==='center';}
function adjustOriginByStartPoint(pointer,shape){var centerPoint=shape.getPointByOrigin('center','center');var angle=-shape.angle;var originPositions=getPositionsOfRotatedOrigin(centerPoint,pointer,angle);var originX=originPositions.originX,originY=originPositions.originY;var origin=shape.getPointByOrigin(originX,originY);var left=shape.left-(centerPoint.x-origin.x);var top=shape.top-(centerPoint.y-origin.y);shape.set({originX:originX,originY:originY,left:left,top:top});shape.setCoords();}
function adjustOriginByMovingPointer(pointer,shape){var origin=shape.startPoint;var angle=-shape.angle;var originPositions=getPositionsOfRotatedOrigin(origin,pointer,angle);var originX=originPositions.originX,originY=originPositions.originY;shape.setPositionByOrigin(origin,originX,originY);shape.setCoords();}
function adjustDimensionOnScaling(shape){var type=shape.type,scaleX=shape.scaleX,scaleY=shape.scaleY;var dimensionKeys=DIMENSION_KEYS[type];var width=shape[dimensionKeys.w]*scaleX;var height=shape[dimensionKeys.h]*scaleY;if(shape.isRegular){var maxScale=Math.max(scaleX,scaleY);width=shape[dimensionKeys.w]*maxScale;height=shape[dimensionKeys.h]*maxScale;}
var options={hasControls:false,hasBorders:false,scaleX:1,scaleY:1};options[dimensionKeys.w]=width;options[dimensionKeys.h]=height;shape.set(options);}
function adjustDimensionOnMouseMove(pointer,shape){var type=shape.type,strokeWidth=shape.strokeWidth,origin=shape.startPoint;var divisor=DIVISOR[type];var dimensionKeys=DIMENSION_KEYS[type];var isTriangle=!!(shape.type==='triangle');var options={};var width=Math.abs(origin.x-pointer.x)/divisor;var height=Math.abs(origin.y-pointer.y)/divisor;if(width>strokeWidth){width-=strokeWidth/divisor;}
if(height>strokeWidth){height-=strokeWidth/divisor;}
if(shape.isRegular){width=height=Math.max(width,height);if(isTriangle){height=Math.sqrt(3)/2*width;}}
options[dimensionKeys.w]=width;options[dimensionKeys.h]=height;shape.set(options);}
module.exports={setOrigins:function setOrigins(shape){var leftTopPoint=shape.getPointByOrigin('left','top');var rightTopPoint=shape.getPointByOrigin('right','top');var rightBottomPoint=shape.getPointByOrigin('right','bottom');var leftBottomPoint=shape.getPointByOrigin('left','bottom');shape.origins={lt:leftTopPoint,rt:rightTopPoint,rb:rightBottomPoint,lb:leftBottomPoint};},resize:function resize(shape,pointer,isScaling){if(hasCenterOrigin(shape)){adjustOriginByStartPoint(pointer,shape);setStartPoint(shape);}
if(isScaling){adjustDimensionOnScaling(shape,pointer);}else{adjustDimensionOnMouseMove(pointer,shape);}
adjustOriginByMovingPointer(pointer,shape);},adjustOriginToCenter:function adjustOriginToCenter(shape){var centerPoint=shape.getPointByOrigin('center','center');var originX=shape.originX,originY=shape.originY;var origin=shape.getPointByOrigin(originX,originY);var left=shape.left+(centerPoint.x-origin.x);var top=shape.top+(centerPoint.y-origin.y);shape.set({hasControls:true,hasBorders:true,originX:'center',originY:'center',left:left,top:top});shape.setCoords();}};}),2221:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(5454);__webpack_require__(9173);var path=__webpack_require__(7545);module.exports=path.Array.from;}),5078:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(8118);var path=__webpack_require__(7545);module.exports=path.Array.isArray;}),6135:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(9106);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('Array').concat;}),9510:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(1710);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('Array').fill;}),3971:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(3436);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('Array').filter;}),98:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(9823);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('Array').forEach;}),2089:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(2276);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('Array').indexOf;}),6209:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(3838);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('Array').map;}),2671:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(5818);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('Array').slice;}),1375:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(2178);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('Array').splice;}),3528:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(665);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('Function').bind;}),5739:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(8939);__webpack_require__(5454);var getIteratorMethod=__webpack_require__(8703);module.exports=getIteratorMethod;}),278:(function(module,__unused_webpack_exports,__webpack_require__){var bind=__webpack_require__(3528);var FunctionPrototype=Function.prototype;module.exports=function(it){var own=it.bind;return it===FunctionPrototype||(it instanceof Function&&own===FunctionPrototype.bind)?bind:own;};}),1484:(function(module,__unused_webpack_exports,__webpack_require__){var concat=__webpack_require__(6135);var ArrayPrototype=Array.prototype;module.exports=function(it){var own=it.concat;return it===ArrayPrototype||(it instanceof Array&&own===ArrayPrototype.concat)?concat:own;};}),7731:(function(module,__unused_webpack_exports,__webpack_require__){var fill=__webpack_require__(9510);var ArrayPrototype=Array.prototype;module.exports=function(it){var own=it.fill;return it===ArrayPrototype||(it instanceof Array&&own===ArrayPrototype.fill)?fill:own;};}),3669:(function(module,__unused_webpack_exports,__webpack_require__){var filter=__webpack_require__(3971);var ArrayPrototype=Array.prototype;module.exports=function(it){var own=it.filter;return it===ArrayPrototype||(it instanceof Array&&own===ArrayPrototype.filter)?filter:own;};}),2604:(function(module,__unused_webpack_exports,__webpack_require__){var indexOf=__webpack_require__(2089);var ArrayPrototype=Array.prototype;module.exports=function(it){var own=it.indexOf;return it===ArrayPrototype||(it instanceof Array&&own===ArrayPrototype.indexOf)?indexOf:own;};}),263:(function(module,__unused_webpack_exports,__webpack_require__){var map=__webpack_require__(6209);var ArrayPrototype=Array.prototype;module.exports=function(it){var own=it.map;return it===ArrayPrototype||(it instanceof Array&&own===ArrayPrototype.map)?map:own;};}),7663:(function(module,__unused_webpack_exports,__webpack_require__){var slice=__webpack_require__(2671);var ArrayPrototype=Array.prototype;module.exports=function(it){var own=it.slice;return it===ArrayPrototype||(it instanceof Array&&own===ArrayPrototype.slice)?slice:own;};}),5063:(function(module,__unused_webpack_exports,__webpack_require__){var splice=__webpack_require__(1375);var ArrayPrototype=Array.prototype;module.exports=function(it){var own=it.splice;return it===ArrayPrototype||(it instanceof Array&&own===ArrayPrototype.splice)?splice:own;};}),6813:(function(module,__unused_webpack_exports,__webpack_require__){var trim=__webpack_require__(3842);var StringPrototype=String.prototype;module.exports=function(it){var own=it.trim;return typeof it==='string'||it===StringPrototype||(it instanceof String&&own===StringPrototype.trim)?trim:own;};}),6285:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(2666);var path=__webpack_require__(7545);module.exports=path.Number.parseInt;}),3213:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(3113);var path=__webpack_require__(7545);var Object=path.Object;module.exports=function create(P,D){return Object.create(P,D);};}),3512:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(297);var path=__webpack_require__(7545);var Object=path.Object;var defineProperty=module.exports=function defineProperty(it,key,desc){return Object.defineProperty(it,key,desc);};if(Object.defineProperty.sham)defineProperty.sham=true;}),8168:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(9234);var path=__webpack_require__(7545);module.exports=path.Object.getPrototypeOf;}),8651:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(2647);var path=__webpack_require__(7545);module.exports=path.Object.keys;}),3083:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(3222);var path=__webpack_require__(7545);module.exports=path.Object.setPrototypeOf;}),2987:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(4859);var path=__webpack_require__(7545);module.exports=path.parseFloat;}),2239:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(5706);var path=__webpack_require__(7545);module.exports=path.parseInt;}),3154:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(4242);__webpack_require__(8939);__webpack_require__(6663);__webpack_require__(9021);__webpack_require__(7884);__webpack_require__(8885);__webpack_require__(1868);__webpack_require__(5454);var path=__webpack_require__(7545);module.exports=path.Promise;}),6577:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(5397);var path=__webpack_require__(7545);module.exports=path.Reflect.construct;}),3842:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(957);var entryVirtual=__webpack_require__(5607);module.exports=entryVirtual('String').trim;}),5008:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(9106);__webpack_require__(6663);__webpack_require__(6187);__webpack_require__(9781);__webpack_require__(492);__webpack_require__(6681);__webpack_require__(9594);__webpack_require__(3665);__webpack_require__(9017);__webpack_require__(1250);__webpack_require__(9786);__webpack_require__(503);__webpack_require__(6565);__webpack_require__(9322);__webpack_require__(3610);__webpack_require__(6886);__webpack_require__(3514);__webpack_require__(8671);__webpack_require__(8556);__webpack_require__(1367);var path=__webpack_require__(7545);module.exports=path.Symbol;}),994:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(8939);__webpack_require__(6663);__webpack_require__(5454);__webpack_require__(3665);var WrappedWellKnownSymbolModule=__webpack_require__(9207);module.exports=WrappedWellKnownSymbolModule.f('iterator');}),2813:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(3822);module.exports=parent;}),8664:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(1434);module.exports=parent;}),1457:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(7710);module.exports=parent;}),2937:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(4741);module.exports=parent;}),9297:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(4963);module.exports=parent;}),8026:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(7820);module.exports=parent;}),2044:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(8980);module.exports=parent;}),2214:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(6672);module.exports=parent;}),9256:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(2285);__webpack_require__(177);__webpack_require__(9031);__webpack_require__(6658);__webpack_require__(1875);__webpack_require__(8658);__webpack_require__(4592);__webpack_require__(6680);module.exports=parent;}),5659:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(8535);module.exports=parent;}),6235:(function(module,__unused_webpack_exports,__webpack_require__){var isCallable=__webpack_require__(6447);var tryToString=__webpack_require__(9288);module.exports=function(argument){if(isCallable(argument))return argument;throw TypeError(tryToString(argument)+' is not a function');};}),1404:(function(module,__unused_webpack_exports,__webpack_require__){var isConstructor=__webpack_require__(2091);var tryToString=__webpack_require__(9288);module.exports=function(argument){if(isConstructor(argument))return argument;throw TypeError(tryToString(argument)+' is not a constructor');};}),7757:(function(module,__unused_webpack_exports,__webpack_require__){var isCallable=__webpack_require__(6447);module.exports=function(argument){if(typeof argument==='object'||isCallable(argument))return argument;throw TypeError("Can't set "+String(argument)+' as a prototype');};}),7423:(function(module){module.exports=function(){};}),6961:(function(module){module.exports=function(it,Constructor,name){if(it instanceof Constructor)return it;throw TypeError('Incorrect '+(name?name+' ':'')+'invocation');};}),1138:(function(module,__unused_webpack_exports,__webpack_require__){var isObject=__webpack_require__(5744);module.exports=function(argument){if(isObject(argument))return argument;throw TypeError(String(argument)+' is not an object');};}),2724:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var toObject=__webpack_require__(1795);var toAbsoluteIndex=__webpack_require__(7739);var lengthOfArrayLike=__webpack_require__(4104);module.exports=function fill(value){var O=toObject(this);var length=lengthOfArrayLike(O);var argumentsLength=arguments.length;var index=toAbsoluteIndex(argumentsLength>1?arguments[1]:undefined,length);var end=argumentsLength>2?arguments[2]:undefined;var endPos=end===undefined?length:toAbsoluteIndex(end,length);while(endPos>index)O[index++]=value;return O;};}),7397:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var $forEach=__webpack_require__(454).forEach;var arrayMethodIsStrict=__webpack_require__(424);var STRICT_METHOD=arrayMethodIsStrict('forEach');module.exports=!STRICT_METHOD?function forEach(callbackfn){return $forEach(this,callbackfn,arguments.length>1?arguments[1]:undefined);}:[].forEach;}),841:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var bind=__webpack_require__(8043);var toObject=__webpack_require__(1795);var callWithSafeIterationClosing=__webpack_require__(1635);var isArrayIteratorMethod=__webpack_require__(6109);var isConstructor=__webpack_require__(2091);var lengthOfArrayLike=__webpack_require__(4104);var createProperty=__webpack_require__(9361);var getIterator=__webpack_require__(1669);var getIteratorMethod=__webpack_require__(8703);module.exports=function from(arrayLike){var O=toObject(arrayLike);var IS_CONSTRUCTOR=isConstructor(this);var argumentsLength=arguments.length;var mapfn=argumentsLength>1?arguments[1]:undefined;var mapping=mapfn!==undefined;if(mapping)mapfn=bind(mapfn,argumentsLength>2?arguments[2]:undefined,2);var iteratorMethod=getIteratorMethod(O);var index=0;var length,result,step,iterator,next,value;if(iteratorMethod&&!(this==Array&&isArrayIteratorMethod(iteratorMethod))){iterator=getIterator(O,iteratorMethod);next=iterator.next;result=IS_CONSTRUCTOR?new this():[];for(;!(step=next.call(iterator)).done;index++){value=mapping?callWithSafeIterationClosing(iterator,mapfn,[step.value,index],true):step.value;createProperty(result,index,value);}}else{length=lengthOfArrayLike(O);result=IS_CONSTRUCTOR?new this(length):Array(length);for(;length>index;index++){value=mapping?mapfn(O[index],index):O[index];createProperty(result,index,value);}}
result.length=index;return result;};}),8180:(function(module,__unused_webpack_exports,__webpack_require__){var toIndexedObject=__webpack_require__(101);var toAbsoluteIndex=__webpack_require__(7739);var lengthOfArrayLike=__webpack_require__(4104);var createMethod=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIndexedObject($this);var length=lengthOfArrayLike(O);var index=toAbsoluteIndex(fromIndex,length);var value;if(IS_INCLUDES&&el!=el)while(length>index){value=O[index++];if(value!=value)return true;}else for(;length>index;index++){if((IS_INCLUDES||index in O)&&O[index]===el)return IS_INCLUDES||index||0;}return!IS_INCLUDES&&-1;};};module.exports={includes:createMethod(true),indexOf:createMethod(false)};}),454:(function(module,__unused_webpack_exports,__webpack_require__){var bind=__webpack_require__(8043);var IndexedObject=__webpack_require__(2202);var toObject=__webpack_require__(1795);var lengthOfArrayLike=__webpack_require__(4104);var arraySpeciesCreate=__webpack_require__(1321);var push=[].push;var createMethod=function(TYPE){var IS_MAP=TYPE==1;var IS_FILTER=TYPE==2;var IS_SOME=TYPE==3;var IS_EVERY=TYPE==4;var IS_FIND_INDEX=TYPE==6;var IS_FILTER_REJECT=TYPE==7;var NO_HOLES=TYPE==5||IS_FIND_INDEX;return function($this,callbackfn,that,specificCreate){var O=toObject($this);var self=IndexedObject(O);var boundFunction=bind(callbackfn,that,3);var length=lengthOfArrayLike(self);var index=0;var create=specificCreate||arraySpeciesCreate;var target=IS_MAP?create($this,length):IS_FILTER||IS_FILTER_REJECT?create($this,0):undefined;var value,result;for(;length>index;index++)if(NO_HOLES||index in self){value=self[index];result=boundFunction(value,index,O);if(TYPE){if(IS_MAP)target[index]=result;else if(result)switch(TYPE){case 3:return true;case 5:return value;case 6:return index;case 2:push.call(target,value);}else switch(TYPE){case 4:return false;case 7:push.call(target,value);}}}
return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:target;};};module.exports={forEach:createMethod(0),map:createMethod(1),filter:createMethod(2),some:createMethod(3),every:createMethod(4),find:createMethod(5),findIndex:createMethod(6),filterReject:createMethod(7)};}),242:(function(module,__unused_webpack_exports,__webpack_require__){var fails=__webpack_require__(6192);var wellKnownSymbol=__webpack_require__(8182);var V8_VERSION=__webpack_require__(4218);var SPECIES=wellKnownSymbol('species');module.exports=function(METHOD_NAME){return V8_VERSION>=51||!fails(function(){var array=[];var constructor=array.constructor={};constructor[SPECIES]=function(){return{foo:1};};return array[METHOD_NAME](Boolean).foo!==1;});};}),424:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var fails=__webpack_require__(6192);module.exports=function(METHOD_NAME,argument){var method=[][METHOD_NAME];return!!method&&fails(function(){method.call(null,argument||function(){throw 1;},1);});};}),3712:(function(module,__unused_webpack_exports,__webpack_require__){var isArray=__webpack_require__(4770);var isConstructor=__webpack_require__(2091);var isObject=__webpack_require__(5744);var wellKnownSymbol=__webpack_require__(8182);var SPECIES=wellKnownSymbol('species');module.exports=function(originalArray){var C;if(isArray(originalArray)){C=originalArray.constructor;if(isConstructor(C)&&(C===Array||isArray(C.prototype)))C=undefined;else if(isObject(C)){C=C[SPECIES];if(C===null)C=undefined;}}return C===undefined?Array:C;};}),1321:(function(module,__unused_webpack_exports,__webpack_require__){var arraySpeciesConstructor=__webpack_require__(3712);module.exports=function(originalArray,length){return new(arraySpeciesConstructor(originalArray))(length===0?0:length);};}),1635:(function(module,__unused_webpack_exports,__webpack_require__){var anObject=__webpack_require__(1138);var iteratorClose=__webpack_require__(6639);module.exports=function(iterator,fn,value,ENTRIES){try{return ENTRIES?fn(anObject(value)[0],value[1]):fn(value);}catch(error){iteratorClose(iterator,'throw',error);}};}),9770:(function(module,__unused_webpack_exports,__webpack_require__){var wellKnownSymbol=__webpack_require__(8182);var ITERATOR=wellKnownSymbol('iterator');var SAFE_CLOSING=false;try{var called=0;var iteratorWithReturn={next:function(){return{done:!!called++};},'return':function(){SAFE_CLOSING=true;}};iteratorWithReturn[ITERATOR]=function(){return this;};Array.from(iteratorWithReturn,function(){throw 2;});}catch(error){}
module.exports=function(exec,SKIP_CLOSING){if(!SKIP_CLOSING&&!SAFE_CLOSING)return false;var ITERATION_SUPPORT=false;try{var object={};object[ITERATOR]=function(){return{next:function(){return{done:ITERATION_SUPPORT=true};}};};exec(object);}catch(error){}
return ITERATION_SUPPORT;};}),9272:(function(module){var toString={}.toString;module.exports=function(it){return toString.call(it).slice(8,-1);};}),4696:(function(module,__unused_webpack_exports,__webpack_require__){var TO_STRING_TAG_SUPPORT=__webpack_require__(3471);var isCallable=__webpack_require__(6447);var classofRaw=__webpack_require__(9272);var wellKnownSymbol=__webpack_require__(8182);var TO_STRING_TAG=wellKnownSymbol('toStringTag');var CORRECT_ARGUMENTS=classofRaw(function(){return arguments;}())=='Arguments';var tryGet=function(it,key){try{return it[key];}catch(error){}};module.exports=TO_STRING_TAG_SUPPORT?classofRaw:function(it){var O,tag,result;return it===undefined?'Undefined':it===null?'Null':typeof(tag=tryGet(O=Object(it),TO_STRING_TAG))=='string'?tag:CORRECT_ARGUMENTS?classofRaw(O):(result=classofRaw(O))=='Object'&&isCallable(O.callee)?'Arguments':result;};}),4635:(function(module,__unused_webpack_exports,__webpack_require__){var fails=__webpack_require__(6192);module.exports=!fails(function(){function F(){}
F.prototype.constructor=null;return Object.getPrototypeOf(new F())!==F.prototype;});}),5148:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var IteratorPrototype=__webpack_require__(4413).IteratorPrototype;var create=__webpack_require__(2853);var createPropertyDescriptor=__webpack_require__(774);var setToStringTag=__webpack_require__(1284);var Iterators=__webpack_require__(7771);var returnThis=function(){return this;};module.exports=function(IteratorConstructor,NAME,next){var TO_STRING_TAG=NAME+' Iterator';IteratorConstructor.prototype=create(IteratorPrototype,{next:createPropertyDescriptor(1,next)});setToStringTag(IteratorConstructor,TO_STRING_TAG,false,true);Iterators[TO_STRING_TAG]=returnThis;return IteratorConstructor;};}),8711:(function(module,__unused_webpack_exports,__webpack_require__){var DESCRIPTORS=__webpack_require__(69);var definePropertyModule=__webpack_require__(2760);var createPropertyDescriptor=__webpack_require__(774);module.exports=DESCRIPTORS?function(object,key,value){return definePropertyModule.f(object,key,createPropertyDescriptor(1,value));}:function(object,key,value){object[key]=value;return object;};}),774:(function(module){module.exports=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value};};}),9361:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var toPropertyKey=__webpack_require__(77);var definePropertyModule=__webpack_require__(2760);var createPropertyDescriptor=__webpack_require__(774);module.exports=function(object,key,value){var propertyKey=toPropertyKey(key);if(propertyKey in object)definePropertyModule.f(object,propertyKey,createPropertyDescriptor(0,value));else object[propertyKey]=value;};}),7218:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var IS_PURE=__webpack_require__(5546);var FunctionName=__webpack_require__(2282);var isCallable=__webpack_require__(6447);var createIteratorConstructor=__webpack_require__(5148);var getPrototypeOf=__webpack_require__(9341);var setPrototypeOf=__webpack_require__(4469);var setToStringTag=__webpack_require__(1284);var createNonEnumerableProperty=__webpack_require__(8711);var redefine=__webpack_require__(9482);var wellKnownSymbol=__webpack_require__(8182);var Iterators=__webpack_require__(7771);var IteratorsCore=__webpack_require__(4413);var PROPER_FUNCTION_NAME=FunctionName.PROPER;var CONFIGURABLE_FUNCTION_NAME=FunctionName.CONFIGURABLE;var IteratorPrototype=IteratorsCore.IteratorPrototype;var BUGGY_SAFARI_ITERATORS=IteratorsCore.BUGGY_SAFARI_ITERATORS;var ITERATOR=wellKnownSymbol('iterator');var KEYS='keys';var VALUES='values';var ENTRIES='entries';var returnThis=function(){return this;};module.exports=function(Iterable,NAME,IteratorConstructor,next,DEFAULT,IS_SET,FORCED){createIteratorConstructor(IteratorConstructor,NAME,next);var getIterationMethod=function(KIND){if(KIND===DEFAULT&&defaultIterator)return defaultIterator;if(!BUGGY_SAFARI_ITERATORS&&KIND in IterablePrototype)return IterablePrototype[KIND];switch(KIND){case KEYS:return function keys(){return new IteratorConstructor(this,KIND);};case VALUES:return function values(){return new IteratorConstructor(this,KIND);};case ENTRIES:return function entries(){return new IteratorConstructor(this,KIND);};}return function(){return new IteratorConstructor(this);};};var TO_STRING_TAG=NAME+' Iterator';var INCORRECT_VALUES_NAME=false;var IterablePrototype=Iterable.prototype;var nativeIterator=IterablePrototype[ITERATOR]||IterablePrototype['@@iterator']||DEFAULT&&IterablePrototype[DEFAULT];var defaultIterator=!BUGGY_SAFARI_ITERATORS&&nativeIterator||getIterationMethod(DEFAULT);var anyNativeIterator=NAME=='Array'?IterablePrototype.entries||nativeIterator:nativeIterator;var CurrentIteratorPrototype,methods,KEY;if(anyNativeIterator){CurrentIteratorPrototype=getPrototypeOf(anyNativeIterator.call(new Iterable()));if(CurrentIteratorPrototype!==Object.prototype&&CurrentIteratorPrototype.next){if(!IS_PURE&&getPrototypeOf(CurrentIteratorPrototype)!==IteratorPrototype){if(setPrototypeOf){setPrototypeOf(CurrentIteratorPrototype,IteratorPrototype);}else if(!isCallable(CurrentIteratorPrototype[ITERATOR])){redefine(CurrentIteratorPrototype,ITERATOR,returnThis);}}
setToStringTag(CurrentIteratorPrototype,TO_STRING_TAG,true,true);if(IS_PURE)Iterators[TO_STRING_TAG]=returnThis;}}
if(PROPER_FUNCTION_NAME&&DEFAULT==VALUES&&nativeIterator&&nativeIterator.name!==VALUES){if(!IS_PURE&&CONFIGURABLE_FUNCTION_NAME){createNonEnumerableProperty(IterablePrototype,'name',VALUES);}else{INCORRECT_VALUES_NAME=true;defaultIterator=function values(){return nativeIterator.call(this);};}}
if(DEFAULT){methods={values:getIterationMethod(VALUES),keys:IS_SET?defaultIterator:getIterationMethod(KEYS),entries:getIterationMethod(ENTRIES)};if(FORCED)for(KEY in methods){if(BUGGY_SAFARI_ITERATORS||INCORRECT_VALUES_NAME||!(KEY in IterablePrototype)){redefine(IterablePrototype,KEY,methods[KEY]);}}else $({target:NAME,proto:true,forced:BUGGY_SAFARI_ITERATORS||INCORRECT_VALUES_NAME},methods);}
if((!IS_PURE||FORCED)&&IterablePrototype[ITERATOR]!==defaultIterator){redefine(IterablePrototype,ITERATOR,defaultIterator,{name:DEFAULT});}
Iterators[NAME]=defaultIterator;return methods;};}),1488:(function(module,__unused_webpack_exports,__webpack_require__){var path=__webpack_require__(7545);var hasOwn=__webpack_require__(4500);var wrappedWellKnownSymbolModule=__webpack_require__(9207);var defineProperty=__webpack_require__(2760).f;module.exports=function(NAME){var Symbol=path.Symbol||(path.Symbol={});if(!hasOwn(Symbol,NAME))defineProperty(Symbol,NAME,{value:wrappedWellKnownSymbolModule.f(NAME)});};}),69:(function(module,__unused_webpack_exports,__webpack_require__){var fails=__webpack_require__(6192);module.exports=!fails(function(){return Object.defineProperty({},1,{get:function(){return 7;}})[1]!=7;});}),7449:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var isObject=__webpack_require__(5744);var document=global.document;var EXISTS=isObject(document)&&isObject(document.createElement);module.exports=function(it){return EXISTS?document.createElement(it):{};};}),7365:(function(module){module.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};}),2957:(function(module){module.exports=typeof window=='object';}),9347:(function(module,__unused_webpack_exports,__webpack_require__){var userAgent=__webpack_require__(8989);var global=__webpack_require__(8576);module.exports=/ipad|iphone|ipod/i.test(userAgent)&&global.Pebble!==undefined;}),9536:(function(module,__unused_webpack_exports,__webpack_require__){var userAgent=__webpack_require__(8989);module.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(userAgent);}),224:(function(module,__unused_webpack_exports,__webpack_require__){var classof=__webpack_require__(9272);var global=__webpack_require__(8576);module.exports=classof(global.process)=='process';}),5914:(function(module,__unused_webpack_exports,__webpack_require__){var userAgent=__webpack_require__(8989);module.exports=/web0s(?!.*chrome)/i.test(userAgent);}),8989:(function(module,__unused_webpack_exports,__webpack_require__){var getBuiltIn=__webpack_require__(150);module.exports=getBuiltIn('navigator','userAgent')||'';}),4218:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var userAgent=__webpack_require__(8989);var process=global.process;var Deno=global.Deno;var versions=process&&process.versions||Deno&&Deno.version;var v8=versions&&versions.v8;var match,version;if(v8){match=v8.split('.');version=match[0]<4?1:match[0]+match[1];}else if(userAgent){match=userAgent.match(/Edge\/(\d+)/);if(!match||match[1]>=74){match=userAgent.match(/Chrome\/(\d+)/);if(match)version=match[1];}}
module.exports=version&&+version;}),5607:(function(module,__unused_webpack_exports,__webpack_require__){var path=__webpack_require__(7545);module.exports=function(CONSTRUCTOR){return path[CONSTRUCTOR+'Prototype'];};}),2952:(function(module){module.exports=['constructor','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','toLocaleString','toString','valueOf'];}),3085:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var global=__webpack_require__(8576);var isCallable=__webpack_require__(6447);var getOwnPropertyDescriptor=__webpack_require__(5141).f;var isForced=__webpack_require__(9245);var path=__webpack_require__(7545);var bind=__webpack_require__(8043);var createNonEnumerableProperty=__webpack_require__(8711);var hasOwn=__webpack_require__(4500);var wrapConstructor=function(NativeConstructor){var Wrapper=function(a,b,c){if(this instanceof NativeConstructor){switch(arguments.length){case 0:return new NativeConstructor();case 1:return new NativeConstructor(a);case 2:return new NativeConstructor(a,b);}return new NativeConstructor(a,b,c);}return NativeConstructor.apply(this,arguments);};Wrapper.prototype=NativeConstructor.prototype;return Wrapper;};module.exports=function(options,source){var TARGET=options.target;var GLOBAL=options.global;var STATIC=options.stat;var PROTO=options.proto;var nativeSource=GLOBAL?global:STATIC?global[TARGET]:(global[TARGET]||{}).prototype;var target=GLOBAL?path:path[TARGET]||createNonEnumerableProperty(path,TARGET,{})[TARGET];var targetPrototype=target.prototype;var FORCED,USE_NATIVE,VIRTUAL_PROTOTYPE;var key,sourceProperty,targetProperty,nativeProperty,resultProperty,descriptor;for(key in source){FORCED=isForced(GLOBAL?key:TARGET+(STATIC?'.':'#')+key,options.forced);USE_NATIVE=!FORCED&&nativeSource&&hasOwn(nativeSource,key);targetProperty=target[key];if(USE_NATIVE)if(options.noTargetGet){descriptor=getOwnPropertyDescriptor(nativeSource,key);nativeProperty=descriptor&&descriptor.value;}else nativeProperty=nativeSource[key];sourceProperty=(USE_NATIVE&&nativeProperty)?nativeProperty:source[key];if(USE_NATIVE&&typeof targetProperty===typeof sourceProperty)continue;if(options.bind&&USE_NATIVE)resultProperty=bind(sourceProperty,global);else if(options.wrap&&USE_NATIVE)resultProperty=wrapConstructor(sourceProperty);else if(PROTO&&isCallable(sourceProperty))resultProperty=bind(Function.call,sourceProperty);else resultProperty=sourceProperty;if(options.sham||(sourceProperty&&sourceProperty.sham)||(targetProperty&&targetProperty.sham)){createNonEnumerableProperty(resultProperty,'sham',true);}
createNonEnumerableProperty(target,key,resultProperty);if(PROTO){VIRTUAL_PROTOTYPE=TARGET+'Prototype';if(!hasOwn(path,VIRTUAL_PROTOTYPE)){createNonEnumerableProperty(path,VIRTUAL_PROTOTYPE,{});}
createNonEnumerableProperty(path[VIRTUAL_PROTOTYPE],key,sourceProperty);if(options.real&&targetPrototype&&!targetPrototype[key]){createNonEnumerableProperty(targetPrototype,key,sourceProperty);}}}};}),6192:(function(module){module.exports=function(exec){try{return!!exec();}catch(error){return true;}};}),8043:(function(module,__unused_webpack_exports,__webpack_require__){var aCallable=__webpack_require__(6235);module.exports=function(fn,that,length){aCallable(fn);if(that===undefined)return fn;switch(length){case 0:return function(){return fn.call(that);};case 1:return function(a){return fn.call(that,a);};case 2:return function(a,b){return fn.call(that,a,b);};case 3:return function(a,b,c){return fn.call(that,a,b,c);};}
return function(){return fn.apply(that,arguments);};};}),6782:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var aCallable=__webpack_require__(6235);var isObject=__webpack_require__(5744);var slice=[].slice;var factories={};var construct=function(C,argsLength,args){if(!(argsLength in factories)){for(var list=[],i=0;i<argsLength;i++)list[i]='a['+i+']';factories[argsLength]=Function('C,a','return new C('+list.join(',')+')');}return factories[argsLength](C,args);};module.exports=Function.bind||function bind(that){var fn=aCallable(this);var partArgs=slice.call(arguments,1);var boundFunction=function bound(){var args=partArgs.concat(slice.call(arguments));return this instanceof boundFunction?construct(fn,args.length,args):fn.apply(that,args);};if(isObject(fn.prototype))boundFunction.prototype=fn.prototype;return boundFunction;};}),2282:(function(module,__unused_webpack_exports,__webpack_require__){var DESCRIPTORS=__webpack_require__(69);var hasOwn=__webpack_require__(4500);var FunctionPrototype=Function.prototype;var getDescriptor=DESCRIPTORS&&Object.getOwnPropertyDescriptor;var EXISTS=hasOwn(FunctionPrototype,'name');var PROPER=EXISTS&&(function something(){}).name==='something';var CONFIGURABLE=EXISTS&&(!DESCRIPTORS||(DESCRIPTORS&&getDescriptor(FunctionPrototype,'name').configurable));module.exports={EXISTS:EXISTS,PROPER:PROPER,CONFIGURABLE:CONFIGURABLE};}),150:(function(module,__unused_webpack_exports,__webpack_require__){var path=__webpack_require__(7545);var global=__webpack_require__(8576);var isCallable=__webpack_require__(6447);var aFunction=function(variable){return isCallable(variable)?variable:undefined;};module.exports=function(namespace,method){return arguments.length<2?aFunction(path[namespace])||aFunction(global[namespace]):path[namespace]&&path[namespace][method]||global[namespace]&&global[namespace][method];};}),8703:(function(module,__unused_webpack_exports,__webpack_require__){var classof=__webpack_require__(4696);var getMethod=__webpack_require__(5037);var Iterators=__webpack_require__(7771);var wellKnownSymbol=__webpack_require__(8182);var ITERATOR=wellKnownSymbol('iterator');module.exports=function(it){if(it!=undefined)return getMethod(it,ITERATOR)||getMethod(it,'@@iterator')||Iterators[classof(it)];};}),1669:(function(module,__unused_webpack_exports,__webpack_require__){var aCallable=__webpack_require__(6235);var anObject=__webpack_require__(1138);var getIteratorMethod=__webpack_require__(8703);module.exports=function(argument,usingIterator){var iteratorMethod=arguments.length<2?getIteratorMethod(argument):usingIterator;if(aCallable(iteratorMethod))return anObject(iteratorMethod.call(argument));throw TypeError(String(argument)+' is not iterable');};}),5037:(function(module,__unused_webpack_exports,__webpack_require__){var aCallable=__webpack_require__(6235);module.exports=function(V,P){var func=V[P];return func==null?undefined:aCallable(func);};}),8576:(function(module,__unused_webpack_exports,__webpack_require__){var check=function(it){return it&&it.Math==Math&&it;};module.exports=check(typeof globalThis=='object'&&globalThis)||check(typeof window=='object'&&window)||check(typeof self=='object'&&self)||check(typeof __webpack_require__.g=='object'&&__webpack_require__.g)||(function(){return this;})()||Function('return this')();}),4500:(function(module,__unused_webpack_exports,__webpack_require__){var toObject=__webpack_require__(1795);var hasOwnProperty={}.hasOwnProperty;module.exports=Object.hasOwn||function hasOwn(it,key){return hasOwnProperty.call(toObject(it),key);};}),4535:(function(module){module.exports={};}),3681:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);module.exports=function(a,b){var console=global.console;if(console&&console.error){arguments.length===1?console.error(a):console.error(a,b);}};}),7403:(function(module,__unused_webpack_exports,__webpack_require__){var getBuiltIn=__webpack_require__(150);module.exports=getBuiltIn('document','documentElement');}),188:(function(module,__unused_webpack_exports,__webpack_require__){var DESCRIPTORS=__webpack_require__(69);var fails=__webpack_require__(6192);var createElement=__webpack_require__(7449);module.exports=!DESCRIPTORS&&!fails(function(){return Object.defineProperty(createElement('div'),'a',{get:function(){return 7;}}).a!=7;});}),2202:(function(module,__unused_webpack_exports,__webpack_require__){var fails=__webpack_require__(6192);var classof=__webpack_require__(9272);var split=''.split;module.exports=fails(function(){return!Object('z').propertyIsEnumerable(0);})?function(it){return classof(it)=='String'?split.call(it,''):Object(it);}:Object;}),9516:(function(module,__unused_webpack_exports,__webpack_require__){var isCallable=__webpack_require__(6447);var store=__webpack_require__(6434);var functionToString=Function.toString;if(!isCallable(store.inspectSource)){store.inspectSource=function(it){return functionToString.call(it);};}
module.exports=store.inspectSource;}),273:(function(module,__unused_webpack_exports,__webpack_require__){var isObject=__webpack_require__(5744);var createNonEnumerableProperty=__webpack_require__(8711);module.exports=function(O,options){if(isObject(options)&&'cause'in options){createNonEnumerableProperty(O,'cause',O.cause);}};}),3326:(function(module,__unused_webpack_exports,__webpack_require__){var NATIVE_WEAK_MAP=__webpack_require__(8921);var global=__webpack_require__(8576);var isObject=__webpack_require__(5744);var createNonEnumerableProperty=__webpack_require__(8711);var hasOwn=__webpack_require__(4500);var shared=__webpack_require__(6434);var sharedKey=__webpack_require__(9766);var hiddenKeys=__webpack_require__(4535);var OBJECT_ALREADY_INITIALIZED='Object already initialized';var WeakMap=global.WeakMap;var set,get,has;var enforce=function(it){return has(it)?get(it):set(it,{});};var getterFor=function(TYPE){return function(it){var state;if(!isObject(it)||(state=get(it)).type!==TYPE){throw TypeError('Incompatible receiver, '+TYPE+' required');}return state;};};if(NATIVE_WEAK_MAP||shared.state){var store=shared.state||(shared.state=new WeakMap());var wmget=store.get;var wmhas=store.has;var wmset=store.set;set=function(it,metadata){if(wmhas.call(store,it))throw new TypeError(OBJECT_ALREADY_INITIALIZED);metadata.facade=it;wmset.call(store,it,metadata);return metadata;};get=function(it){return wmget.call(store,it)||{};};has=function(it){return wmhas.call(store,it);};}else{var STATE=sharedKey('state');hiddenKeys[STATE]=true;set=function(it,metadata){if(hasOwn(it,STATE))throw new TypeError(OBJECT_ALREADY_INITIALIZED);metadata.facade=it;createNonEnumerableProperty(it,STATE,metadata);return metadata;};get=function(it){return hasOwn(it,STATE)?it[STATE]:{};};has=function(it){return hasOwn(it,STATE);};}
module.exports={set:set,get:get,has:has,enforce:enforce,getterFor:getterFor};}),6109:(function(module,__unused_webpack_exports,__webpack_require__){var wellKnownSymbol=__webpack_require__(8182);var Iterators=__webpack_require__(7771);var ITERATOR=wellKnownSymbol('iterator');var ArrayPrototype=Array.prototype;module.exports=function(it){return it!==undefined&&(Iterators.Array===it||ArrayPrototype[ITERATOR]===it);};}),4770:(function(module,__unused_webpack_exports,__webpack_require__){var classof=__webpack_require__(9272);module.exports=Array.isArray||function isArray(argument){return classof(argument)=='Array';};}),6447:(function(module){module.exports=function(argument){return typeof argument==='function';};}),2091:(function(module,__unused_webpack_exports,__webpack_require__){var fails=__webpack_require__(6192);var isCallable=__webpack_require__(6447);var classof=__webpack_require__(4696);var getBuiltIn=__webpack_require__(150);var inspectSource=__webpack_require__(9516);var empty=[];var construct=getBuiltIn('Reflect','construct');var constructorRegExp=/^\s*(?:class|function)\b/;var exec=constructorRegExp.exec;var INCORRECT_TO_STRING=!constructorRegExp.exec(function(){});var isConstructorModern=function(argument){if(!isCallable(argument))return false;try{construct(Object,empty,argument);return true;}catch(error){return false;}};var isConstructorLegacy=function(argument){if(!isCallable(argument))return false;switch(classof(argument)){case'AsyncFunction':case'GeneratorFunction':case'AsyncGeneratorFunction':return false;}return INCORRECT_TO_STRING||!!exec.call(constructorRegExp,inspectSource(argument));};module.exports=!construct||fails(function(){var called;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern(function(){called=true;})||called;})?isConstructorLegacy:isConstructorModern;}),9245:(function(module,__unused_webpack_exports,__webpack_require__){var fails=__webpack_require__(6192);var isCallable=__webpack_require__(6447);var replacement=/#|\.prototype\./;var isForced=function(feature,detection){var value=data[normalize(feature)];return value==POLYFILL?true:value==NATIVE?false:isCallable(detection)?fails(detection):!!detection;};var normalize=isForced.normalize=function(string){return String(string).replace(replacement,'.').toLowerCase();};var data=isForced.data={};var NATIVE=isForced.NATIVE='N';var POLYFILL=isForced.POLYFILL='P';module.exports=isForced;}),5744:(function(module,__unused_webpack_exports,__webpack_require__){var isCallable=__webpack_require__(6447);module.exports=function(it){return typeof it==='object'?it!==null:isCallable(it);};}),5546:(function(module){module.exports=true;}),3236:(function(module,__unused_webpack_exports,__webpack_require__){var isCallable=__webpack_require__(6447);var getBuiltIn=__webpack_require__(150);var USE_SYMBOL_AS_UID=__webpack_require__(615);module.exports=USE_SYMBOL_AS_UID?function(it){return typeof it=='symbol';}:function(it){var $Symbol=getBuiltIn('Symbol');return isCallable($Symbol)&&Object(it)instanceof $Symbol;};}),3442:(function(module,__unused_webpack_exports,__webpack_require__){var anObject=__webpack_require__(1138);var isArrayIteratorMethod=__webpack_require__(6109);var lengthOfArrayLike=__webpack_require__(4104);var bind=__webpack_require__(8043);var getIterator=__webpack_require__(1669);var getIteratorMethod=__webpack_require__(8703);var iteratorClose=__webpack_require__(6639);var Result=function(stopped,result){this.stopped=stopped;this.result=result;};module.exports=function(iterable,unboundFunction,options){var that=options&&options.that;var AS_ENTRIES=!!(options&&options.AS_ENTRIES);var IS_ITERATOR=!!(options&&options.IS_ITERATOR);var INTERRUPTED=!!(options&&options.INTERRUPTED);var fn=bind(unboundFunction,that,1+AS_ENTRIES+INTERRUPTED);var iterator,iterFn,index,length,result,next,step;var stop=function(condition){if(iterator)iteratorClose(iterator,'normal',condition);return new Result(true,condition);};var callFn=function(value){if(AS_ENTRIES){anObject(value);return INTERRUPTED?fn(value[0],value[1],stop):fn(value[0],value[1]);}return INTERRUPTED?fn(value,stop):fn(value);};if(IS_ITERATOR){iterator=iterable;}else{iterFn=getIteratorMethod(iterable);if(!iterFn)throw TypeError(String(iterable)+' is not iterable');if(isArrayIteratorMethod(iterFn)){for(index=0,length=lengthOfArrayLike(iterable);length>index;index++){result=callFn(iterable[index]);if(result&&result instanceof Result)return result;}return new Result(false);}
iterator=getIterator(iterable,iterFn);}
next=iterator.next;while(!(step=next.call(iterator)).done){try{result=callFn(step.value);}catch(error){iteratorClose(iterator,'throw',error);}
if(typeof result=='object'&&result&&result instanceof Result)return result;}return new Result(false);};}),6639:(function(module,__unused_webpack_exports,__webpack_require__){var anObject=__webpack_require__(1138);var getMethod=__webpack_require__(5037);module.exports=function(iterator,kind,value){var innerResult,innerError;anObject(iterator);try{innerResult=getMethod(iterator,'return');if(!innerResult){if(kind==='throw')throw value;return value;}
innerResult=innerResult.call(iterator);}catch(error){innerError=true;innerResult=error;}
if(kind==='throw')throw value;if(innerError)throw innerResult;anObject(innerResult);return value;};}),4413:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var fails=__webpack_require__(6192);var isCallable=__webpack_require__(6447);var create=__webpack_require__(2853);var getPrototypeOf=__webpack_require__(9341);var redefine=__webpack_require__(9482);var wellKnownSymbol=__webpack_require__(8182);var IS_PURE=__webpack_require__(5546);var ITERATOR=wellKnownSymbol('iterator');var BUGGY_SAFARI_ITERATORS=false;var IteratorPrototype,PrototypeOfArrayIteratorPrototype,arrayIterator;if([].keys){arrayIterator=[].keys();if(!('next'in arrayIterator))BUGGY_SAFARI_ITERATORS=true;else{PrototypeOfArrayIteratorPrototype=getPrototypeOf(getPrototypeOf(arrayIterator));if(PrototypeOfArrayIteratorPrototype!==Object.prototype)IteratorPrototype=PrototypeOfArrayIteratorPrototype;}}
var NEW_ITERATOR_PROTOTYPE=IteratorPrototype==undefined||fails(function(){var test={};return IteratorPrototype[ITERATOR].call(test)!==test;});if(NEW_ITERATOR_PROTOTYPE)IteratorPrototype={};else if(IS_PURE)IteratorPrototype=create(IteratorPrototype);if(!isCallable(IteratorPrototype[ITERATOR])){redefine(IteratorPrototype,ITERATOR,function(){return this;});}
module.exports={IteratorPrototype:IteratorPrototype,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS};}),7771:(function(module){module.exports={};}),4104:(function(module,__unused_webpack_exports,__webpack_require__){var toLength=__webpack_require__(8445);module.exports=function(obj){return toLength(obj.length);};}),2950:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var getOwnPropertyDescriptor=__webpack_require__(5141).f;var macrotask=__webpack_require__(7160).set;var IS_IOS=__webpack_require__(9536);var IS_IOS_PEBBLE=__webpack_require__(9347);var IS_WEBOS_WEBKIT=__webpack_require__(5914);var IS_NODE=__webpack_require__(224);var MutationObserver=global.MutationObserver||global.WebKitMutationObserver;var document=global.document;var process=global.process;var Promise=global.Promise;var queueMicrotaskDescriptor=getOwnPropertyDescriptor(global,'queueMicrotask');var queueMicrotask=queueMicrotaskDescriptor&&queueMicrotaskDescriptor.value;var flush,head,last,notify,toggle,node,promise,then;if(!queueMicrotask){flush=function(){var parent,fn;if(IS_NODE&&(parent=process.domain))parent.exit();while(head){fn=head.fn;head=head.next;try{fn();}catch(error){if(head)notify();else last=undefined;throw error;}}last=undefined;if(parent)parent.enter();};if(!IS_IOS&&!IS_NODE&&!IS_WEBOS_WEBKIT&&MutationObserver&&document){toggle=true;node=document.createTextNode('');new MutationObserver(flush).observe(node,{characterData:true});notify=function(){node.data=toggle=!toggle;};}else if(!IS_IOS_PEBBLE&&Promise&&Promise.resolve){promise=Promise.resolve(undefined);promise.constructor=Promise;then=promise.then;notify=function(){then.call(promise,flush);};}else if(IS_NODE){notify=function(){process.nextTick(flush);};}else{notify=function(){macrotask.call(global,flush);};}}
module.exports=queueMicrotask||function(fn){var task={fn:fn,next:undefined};if(last)last.next=task;if(!head){head=task;notify();}last=task;};}),4471:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);module.exports=global.Promise;}),3045:(function(module,__unused_webpack_exports,__webpack_require__){var V8_VERSION=__webpack_require__(4218);var fails=__webpack_require__(6192);module.exports=!!Object.getOwnPropertySymbols&&!fails(function(){var symbol=Symbol();return!String(symbol)||!(Object(symbol)instanceof Symbol)||!Symbol.sham&&V8_VERSION&&V8_VERSION<41;});}),4551:(function(module,__unused_webpack_exports,__webpack_require__){var fails=__webpack_require__(6192);var wellKnownSymbol=__webpack_require__(8182);var IS_PURE=__webpack_require__(5546);var ITERATOR=wellKnownSymbol('iterator');module.exports=!fails(function(){var url=new URL('b?a=1&b=2&c=3','http://a');var searchParams=url.searchParams;var result='';url.pathname='c%20d';searchParams.forEach(function(value,key){searchParams['delete']('b');result+=key+value;});return(IS_PURE&&!url.toJSON)||!searchParams.sort||url.href!=='http://a/c%20d?a=1&c=3'||searchParams.get('c')!=='3'||String(new URLSearchParams('?a=1'))!=='a=1'||!searchParams[ITERATOR]||new URL('https://a@b').username!=='a'||new URLSearchParams(new URLSearchParams('a=b')).get('a')!=='b'||new URL('http://ÑÐµÑÑ').host!=='xn--e1aybc'||new URL('http://a#Ð±').hash!=='#%D0%B1'||result!=='a1c3'||new URL('http://x',undefined).host!=='x';});}),8921:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var isCallable=__webpack_require__(6447);var inspectSource=__webpack_require__(9516);var WeakMap=global.WeakMap;module.exports=isCallable(WeakMap)&&/native code/.test(inspectSource(WeakMap));}),9438:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var aCallable=__webpack_require__(6235);var PromiseCapability=function(C){var resolve,reject;this.promise=new C(function($$resolve,$$reject){if(resolve!==undefined||reject!==undefined)throw TypeError('Bad Promise constructor');resolve=$$resolve;reject=$$reject;});this.resolve=aCallable(resolve);this.reject=aCallable(reject);};module.exports.f=function(C){return new PromiseCapability(C);};}),15:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var fails=__webpack_require__(6192);var toString=__webpack_require__(4845);var trim=__webpack_require__(4277).trim;var whitespaces=__webpack_require__(1450);var $parseFloat=global.parseFloat;var Symbol=global.Symbol;var ITERATOR=Symbol&&Symbol.iterator;var FORCED=1/$parseFloat(whitespaces+'-0')!==-Infinity||(ITERATOR&&!fails(function(){$parseFloat(Object(ITERATOR));}));module.exports=FORCED?function parseFloat(string){var trimmedString=trim(toString(string));var result=$parseFloat(trimmedString);return result===0&&trimmedString.charAt(0)=='-'?-0:result;}:$parseFloat;}),2558:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var fails=__webpack_require__(6192);var toString=__webpack_require__(4845);var trim=__webpack_require__(4277).trim;var whitespaces=__webpack_require__(1450);var $parseInt=global.parseInt;var Symbol=global.Symbol;var ITERATOR=Symbol&&Symbol.iterator;var hex=/^[+-]?0[Xx]/;var FORCED=$parseInt(whitespaces+'08')!==8||$parseInt(whitespaces+'0x16')!==22||(ITERATOR&&!fails(function(){$parseInt(Object(ITERATOR));}));module.exports=FORCED?function parseInt(string,radix){var S=trim(toString(string));return $parseInt(S,(radix>>>0)||(hex.test(S)?16:10));}:$parseInt;}),2503:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var DESCRIPTORS=__webpack_require__(69);var fails=__webpack_require__(6192);var objectKeys=__webpack_require__(7653);var getOwnPropertySymbolsModule=__webpack_require__(4750);var propertyIsEnumerableModule=__webpack_require__(6007);var toObject=__webpack_require__(1795);var IndexedObject=__webpack_require__(2202);var $assign=Object.assign;var defineProperty=Object.defineProperty;module.exports=!$assign||fails(function(){if(DESCRIPTORS&&$assign({b:1},$assign(defineProperty({},'a',{enumerable:true,get:function(){defineProperty(this,'b',{value:3,enumerable:false});}}),{b:2})).b!==1)return true;var A={};var B={};var symbol=Symbol();var alphabet='abcdefghijklmnopqrst';A[symbol]=7;alphabet.split('').forEach(function(chr){B[chr]=chr;});return $assign({},A)[symbol]!=7||objectKeys($assign({},B)).join('')!=alphabet;})?function assign(target,source){var T=toObject(target);var argumentsLength=arguments.length;var index=1;var getOwnPropertySymbols=getOwnPropertySymbolsModule.f;var propertyIsEnumerable=propertyIsEnumerableModule.f;while(argumentsLength>index){var S=IndexedObject(arguments[index++]);var keys=getOwnPropertySymbols?objectKeys(S).concat(getOwnPropertySymbols(S)):objectKeys(S);var length=keys.length;var j=0;var key;while(length>j){key=keys[j++];if(!DESCRIPTORS||propertyIsEnumerable.call(S,key))T[key]=S[key];}}return T;}:$assign;}),2853:(function(module,__unused_webpack_exports,__webpack_require__){var anObject=__webpack_require__(1138);var defineProperties=__webpack_require__(1187);var enumBugKeys=__webpack_require__(2952);var hiddenKeys=__webpack_require__(4535);var html=__webpack_require__(7403);var documentCreateElement=__webpack_require__(7449);var sharedKey=__webpack_require__(9766);var GT='>';var LT='<';var PROTOTYPE='prototype';var SCRIPT='script';var IE_PROTO=sharedKey('IE_PROTO');var EmptyConstructor=function(){};var scriptTag=function(content){return LT+SCRIPT+GT+content+LT+'/'+SCRIPT+GT;};var NullProtoObjectViaActiveX=function(activeXDocument){activeXDocument.write(scriptTag(''));activeXDocument.close();var temp=activeXDocument.parentWindow.Object;activeXDocument=null;return temp;};var NullProtoObjectViaIFrame=function(){var iframe=documentCreateElement('iframe');var JS='java'+SCRIPT+':';var iframeDocument;iframe.style.display='none';html.appendChild(iframe);iframe.src=String(JS);iframeDocument=iframe.contentWindow.document;iframeDocument.open();iframeDocument.write(scriptTag('document.F=Object'));iframeDocument.close();return iframeDocument.F;};var activeXDocument;var NullProtoObject=function(){try{activeXDocument=new ActiveXObject('htmlfile');}catch(error){}
NullProtoObject=typeof document!='undefined'?document.domain&&activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(activeXDocument);var length=enumBugKeys.length;while(length--)delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];return NullProtoObject();};hiddenKeys[IE_PROTO]=true;module.exports=Object.create||function create(O,Properties){var result;if(O!==null){EmptyConstructor[PROTOTYPE]=anObject(O);result=new EmptyConstructor();EmptyConstructor[PROTOTYPE]=null;result[IE_PROTO]=O;}else result=NullProtoObject();return Properties===undefined?result:defineProperties(result,Properties);};}),1187:(function(module,__unused_webpack_exports,__webpack_require__){var DESCRIPTORS=__webpack_require__(69);var definePropertyModule=__webpack_require__(2760);var anObject=__webpack_require__(1138);var objectKeys=__webpack_require__(7653);module.exports=DESCRIPTORS?Object.defineProperties:function defineProperties(O,Properties){anObject(O);var keys=objectKeys(Properties);var length=keys.length;var index=0;var key;while(length>index)definePropertyModule.f(O,key=keys[index++],Properties[key]);return O;};}),2760:(function(__unused_webpack_module,exports,__webpack_require__){var DESCRIPTORS=__webpack_require__(69);var IE8_DOM_DEFINE=__webpack_require__(188);var anObject=__webpack_require__(1138);var toPropertyKey=__webpack_require__(77);var $defineProperty=Object.defineProperty;exports.f=DESCRIPTORS?$defineProperty:function defineProperty(O,P,Attributes){anObject(O);P=toPropertyKey(P);anObject(Attributes);if(IE8_DOM_DEFINE)try{return $defineProperty(O,P,Attributes);}catch(error){}
if('get'in Attributes||'set'in Attributes)throw TypeError('Accessors not supported');if('value'in Attributes)O[P]=Attributes.value;return O;};}),5141:(function(__unused_webpack_module,exports,__webpack_require__){var DESCRIPTORS=__webpack_require__(69);var propertyIsEnumerableModule=__webpack_require__(6007);var createPropertyDescriptor=__webpack_require__(774);var toIndexedObject=__webpack_require__(101);var toPropertyKey=__webpack_require__(77);var hasOwn=__webpack_require__(4500);var IE8_DOM_DEFINE=__webpack_require__(188);var $getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;exports.f=DESCRIPTORS?$getOwnPropertyDescriptor:function getOwnPropertyDescriptor(O,P){O=toIndexedObject(O);P=toPropertyKey(P);if(IE8_DOM_DEFINE)try{return $getOwnPropertyDescriptor(O,P);}catch(error){}
if(hasOwn(O,P))return createPropertyDescriptor(!propertyIsEnumerableModule.f.call(O,P),O[P]);};}),4052:(function(module,__unused_webpack_exports,__webpack_require__){var toIndexedObject=__webpack_require__(101);var $getOwnPropertyNames=__webpack_require__(2092).f;var toString={}.toString;var windowNames=typeof window=='object'&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var getWindowNames=function(it){try{return $getOwnPropertyNames(it);}catch(error){return windowNames.slice();}};module.exports.f=function getOwnPropertyNames(it){return windowNames&&toString.call(it)=='[object Window]'?getWindowNames(it):$getOwnPropertyNames(toIndexedObject(it));};}),2092:(function(__unused_webpack_module,exports,__webpack_require__){var internalObjectKeys=__webpack_require__(7934);var enumBugKeys=__webpack_require__(2952);var hiddenKeys=enumBugKeys.concat('length','prototype');exports.f=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return internalObjectKeys(O,hiddenKeys);};}),4750:(function(__unused_webpack_module,exports){exports.f=Object.getOwnPropertySymbols;}),9341:(function(module,__unused_webpack_exports,__webpack_require__){var hasOwn=__webpack_require__(4500);var isCallable=__webpack_require__(6447);var toObject=__webpack_require__(1795);var sharedKey=__webpack_require__(9766);var CORRECT_PROTOTYPE_GETTER=__webpack_require__(4635);var IE_PROTO=sharedKey('IE_PROTO');var ObjectPrototype=Object.prototype;module.exports=CORRECT_PROTOTYPE_GETTER?Object.getPrototypeOf:function(O){var object=toObject(O);if(hasOwn(object,IE_PROTO))return object[IE_PROTO];var constructor=object.constructor;if(isCallable(constructor)&&object instanceof constructor){return constructor.prototype;}return object instanceof Object?ObjectPrototype:null;};}),7934:(function(module,__unused_webpack_exports,__webpack_require__){var hasOwn=__webpack_require__(4500);var toIndexedObject=__webpack_require__(101);var indexOf=__webpack_require__(8180).indexOf;var hiddenKeys=__webpack_require__(4535);module.exports=function(object,names){var O=toIndexedObject(object);var i=0;var result=[];var key;for(key in O)!hasOwn(hiddenKeys,key)&&hasOwn(O,key)&&result.push(key);while(names.length>i)if(hasOwn(O,key=names[i++])){~indexOf(result,key)||result.push(key);}
return result;};}),7653:(function(module,__unused_webpack_exports,__webpack_require__){var internalObjectKeys=__webpack_require__(7934);var enumBugKeys=__webpack_require__(2952);module.exports=Object.keys||function keys(O){return internalObjectKeys(O,enumBugKeys);};}),6007:(function(__unused_webpack_module,exports){"use strict";var $propertyIsEnumerable={}.propertyIsEnumerable;var getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;var NASHORN_BUG=getOwnPropertyDescriptor&&!$propertyIsEnumerable.call({1:2},1);exports.f=NASHORN_BUG?function propertyIsEnumerable(V){var descriptor=getOwnPropertyDescriptor(this,V);return!!descriptor&&descriptor.enumerable;}:$propertyIsEnumerable;}),4469:(function(module,__unused_webpack_exports,__webpack_require__){var anObject=__webpack_require__(1138);var aPossiblePrototype=__webpack_require__(7757);module.exports=Object.setPrototypeOf||('__proto__'in{}?function(){var CORRECT_SETTER=false;var test={};var setter;try{setter=Object.getOwnPropertyDescriptor(Object.prototype,'__proto__').set;setter.call(test,[]);CORRECT_SETTER=test instanceof Array;}catch(error){}
return function setPrototypeOf(O,proto){anObject(O);aPossiblePrototype(proto);if(CORRECT_SETTER)setter.call(O,proto);else O.__proto__=proto;return O;};}():undefined);}),158:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var TO_STRING_TAG_SUPPORT=__webpack_require__(3471);var classof=__webpack_require__(4696);module.exports=TO_STRING_TAG_SUPPORT?{}.toString:function toString(){return'[object '+classof(this)+']';};}),380:(function(module,__unused_webpack_exports,__webpack_require__){var isCallable=__webpack_require__(6447);var isObject=__webpack_require__(5744);module.exports=function(input,pref){var fn,val;if(pref==='string'&&isCallable(fn=input.toString)&&!isObject(val=fn.call(input)))return val;if(isCallable(fn=input.valueOf)&&!isObject(val=fn.call(input)))return val;if(pref!=='string'&&isCallable(fn=input.toString)&&!isObject(val=fn.call(input)))return val;throw TypeError("Can't convert object to primitive value");};}),7545:(function(module){module.exports={};}),892:(function(module){module.exports=function(exec){try{return{error:false,value:exec()};}catch(error){return{error:true,value:error};}};}),9126:(function(module,__unused_webpack_exports,__webpack_require__){var anObject=__webpack_require__(1138);var isObject=__webpack_require__(5744);var newPromiseCapability=__webpack_require__(9438);module.exports=function(C,x){anObject(C);if(isObject(x)&&x.constructor===C)return x;var promiseCapability=newPromiseCapability.f(C);var resolve=promiseCapability.resolve;resolve(x);return promiseCapability.promise;};}),533:(function(module,__unused_webpack_exports,__webpack_require__){var redefine=__webpack_require__(9482);module.exports=function(target,src,options){for(var key in src){if(options&&options.unsafe&&target[key])target[key]=src[key];else redefine(target,key,src[key],options);}return target;};}),9482:(function(module,__unused_webpack_exports,__webpack_require__){var createNonEnumerableProperty=__webpack_require__(8711);module.exports=function(target,key,value,options){if(options&&options.enumerable)target[key]=value;else createNonEnumerableProperty(target,key,value);};}),3209:(function(module){module.exports=function(it){if(it==undefined)throw TypeError("Can't call method on "+it);return it;};}),7613:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);module.exports=function(key,value){try{Object.defineProperty(global,key,{value:value,configurable:true,writable:true});}catch(error){global[key]=value;}return value;};}),3656:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var getBuiltIn=__webpack_require__(150);var definePropertyModule=__webpack_require__(2760);var wellKnownSymbol=__webpack_require__(8182);var DESCRIPTORS=__webpack_require__(69);var SPECIES=wellKnownSymbol('species');module.exports=function(CONSTRUCTOR_NAME){var Constructor=getBuiltIn(CONSTRUCTOR_NAME);var defineProperty=definePropertyModule.f;if(DESCRIPTORS&&Constructor&&!Constructor[SPECIES]){defineProperty(Constructor,SPECIES,{configurable:true,get:function(){return this;}});}};}),1284:(function(module,__unused_webpack_exports,__webpack_require__){var TO_STRING_TAG_SUPPORT=__webpack_require__(3471);var defineProperty=__webpack_require__(2760).f;var createNonEnumerableProperty=__webpack_require__(8711);var hasOwn=__webpack_require__(4500);var toString=__webpack_require__(158);var wellKnownSymbol=__webpack_require__(8182);var TO_STRING_TAG=wellKnownSymbol('toStringTag');module.exports=function(it,TAG,STATIC,SET_METHOD){if(it){var target=STATIC?it:it.prototype;if(!hasOwn(target,TO_STRING_TAG)){defineProperty(target,TO_STRING_TAG,{configurable:true,value:TAG});}
if(SET_METHOD&&!TO_STRING_TAG_SUPPORT){createNonEnumerableProperty(target,'toString',toString);}}};}),9766:(function(module,__unused_webpack_exports,__webpack_require__){var shared=__webpack_require__(8717);var uid=__webpack_require__(2759);var keys=shared('keys');module.exports=function(key){return keys[key]||(keys[key]=uid(key));};}),6434:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var setGlobal=__webpack_require__(7613);var SHARED='__core-js_shared__';var store=global[SHARED]||setGlobal(SHARED,{});module.exports=store;}),8717:(function(module,__unused_webpack_exports,__webpack_require__){var IS_PURE=__webpack_require__(5546);var store=__webpack_require__(6434);(module.exports=function(key,value){return store[key]||(store[key]=value!==undefined?value:{});})('versions',[]).push({version:'3.18.2',mode:IS_PURE?'pure':'global',copyright:'Â© 2021 Denis Pushkarev (zloirock.ru)'});}),4743:(function(module,__unused_webpack_exports,__webpack_require__){var anObject=__webpack_require__(1138);var aConstructor=__webpack_require__(1404);var wellKnownSymbol=__webpack_require__(8182);var SPECIES=wellKnownSymbol('species');module.exports=function(O,defaultConstructor){var C=anObject(O).constructor;var S;return C===undefined||(S=anObject(C)[SPECIES])==undefined?defaultConstructor:aConstructor(S);};}),863:(function(module,__unused_webpack_exports,__webpack_require__){var toIntegerOrInfinity=__webpack_require__(1941);var toString=__webpack_require__(4845);var requireObjectCoercible=__webpack_require__(3209);var createMethod=function(CONVERT_TO_STRING){return function($this,pos){var S=toString(requireObjectCoercible($this));var position=toIntegerOrInfinity(pos);var size=S.length;var first,second;if(position<0||position>=size)return CONVERT_TO_STRING?'':undefined;first=S.charCodeAt(position);return first<0xD800||first>0xDBFF||position+1===size||(second=S.charCodeAt(position+1))<0xDC00||second>0xDFFF?CONVERT_TO_STRING?S.charAt(position):first:CONVERT_TO_STRING?S.slice(position,position+2):(first-0xD800<<10)+(second-0xDC00)+0x10000;};};module.exports={codeAt:createMethod(false),charAt:createMethod(true)};}),7977:(function(module){"use strict";var maxInt=2147483647;var base=36;var tMin=1;var tMax=26;var skew=38;var damp=700;var initialBias=72;var initialN=128;var delimiter='-';var regexNonASCII=/[^\0-\u007E]/;var regexSeparators=/[.\u3002\uFF0E\uFF61]/g;var OVERFLOW_ERROR='Overflow: input needs wider integers to process';var baseMinusTMin=base-tMin;var floor=Math.floor;var stringFromCharCode=String.fromCharCode;var ucs2decode=function(string){var output=[];var counter=0;var length=string.length;while(counter<length){var value=string.charCodeAt(counter++);if(value>=0xD800&&value<=0xDBFF&&counter<length){var extra=string.charCodeAt(counter++);if((extra&0xFC00)==0xDC00){output.push(((value&0x3FF)<<10)+(extra&0x3FF)+0x10000);}else{output.push(value);counter--;}}else{output.push(value);}}
return output;};var digitToBasic=function(digit){return digit+22+75*(digit<26);};var adapt=function(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin);}
return floor(k+(baseMinusTMin+1)*delta/(delta+skew));};var encode=function(input){var output=[];input=ucs2decode(input);var inputLength=input.length;var n=initialN;var delta=0;var bias=initialBias;var i,currentValue;for(i=0;i<input.length;i++){currentValue=input[i];if(currentValue<0x80){output.push(stringFromCharCode(currentValue));}}
var basicLength=output.length;var handledCPCount=basicLength;if(basicLength){output.push(delimiter);}
while(handledCPCount<inputLength){var m=maxInt;for(i=0;i<input.length;i++){currentValue=input[i];if(currentValue>=n&&currentValue<m){m=currentValue;}}
var handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){throw RangeError(OVERFLOW_ERROR);}
delta+=(m-n)*handledCPCountPlusOne;n=m;for(i=0;i<input.length;i++){currentValue=input[i];if(currentValue<n&&++delta>maxInt){throw RangeError(OVERFLOW_ERROR);}
if(currentValue==n){var q=delta;for(var k=base;;k+=base){var t=k<=bias?tMin:(k>=bias+tMax?tMax:k-bias);if(q<t)break;var qMinusT=q-t;var baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT)));q=floor(qMinusT/baseMinusT);}
output.push(stringFromCharCode(digitToBasic(q)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount;}}
++delta;++n;}
return output.join('');};module.exports=function(input){var encoded=[];var labels=input.toLowerCase().replace(regexSeparators,'\u002E').split('.');var i,label;for(i=0;i<labels.length;i++){label=labels[i];encoded.push(regexNonASCII.test(label)?'xn--'+encode(label):label);}
return encoded.join('.');};}),6815:(function(module,__unused_webpack_exports,__webpack_require__){var PROPER_FUNCTION_NAME=__webpack_require__(2282).PROPER;var fails=__webpack_require__(6192);var whitespaces=__webpack_require__(1450);var non='\u200B\u0085\u180E';module.exports=function(METHOD_NAME){return fails(function(){return!!whitespaces[METHOD_NAME]()||non[METHOD_NAME]()!==non||(PROPER_FUNCTION_NAME&&whitespaces[METHOD_NAME].name!==METHOD_NAME);});};}),4277:(function(module,__unused_webpack_exports,__webpack_require__){var requireObjectCoercible=__webpack_require__(3209);var toString=__webpack_require__(4845);var whitespaces=__webpack_require__(1450);var whitespace='['+whitespaces+']';var ltrim=RegExp('^'+whitespace+whitespace+'*');var rtrim=RegExp(whitespace+whitespace+'*$');var createMethod=function(TYPE){return function($this){var string=toString(requireObjectCoercible($this));if(TYPE&1)string=string.replace(ltrim,'');if(TYPE&2)string=string.replace(rtrim,'');return string;};};module.exports={start:createMethod(1),end:createMethod(2),trim:createMethod(3)};}),7160:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var isCallable=__webpack_require__(6447);var fails=__webpack_require__(6192);var bind=__webpack_require__(8043);var html=__webpack_require__(7403);var createElement=__webpack_require__(7449);var IS_IOS=__webpack_require__(9536);var IS_NODE=__webpack_require__(224);var set=global.setImmediate;var clear=global.clearImmediate;var process=global.process;var MessageChannel=global.MessageChannel;var Dispatch=global.Dispatch;var counter=0;var queue={};var ONREADYSTATECHANGE='onreadystatechange';var location,defer,channel,port;try{location=global.location;}catch(error){}
var run=function(id){if(queue.hasOwnProperty(id)){var fn=queue[id];delete queue[id];fn();}};var runner=function(id){return function(){run(id);};};var listener=function(event){run(event.data);};var post=function(id){global.postMessage(String(id),location.protocol+'//'+location.host);};if(!set||!clear){set=function setImmediate(fn){var args=[];var argumentsLength=arguments.length;var i=1;while(argumentsLength>i)args.push(arguments[i++]);queue[++counter]=function(){(isCallable(fn)?fn:Function(fn)).apply(undefined,args);};defer(counter);return counter;};clear=function clearImmediate(id){delete queue[id];};if(IS_NODE){defer=function(id){process.nextTick(runner(id));};}else if(Dispatch&&Dispatch.now){defer=function(id){Dispatch.now(runner(id));};}else if(MessageChannel&&!IS_IOS){channel=new MessageChannel();port=channel.port2;channel.port1.onmessage=listener;defer=bind(port.postMessage,port,1);}else if(global.addEventListener&&isCallable(global.postMessage)&&!global.importScripts&&location&&location.protocol!=='file:'&&!fails(post)){defer=post;global.addEventListener('message',listener,false);}else if(ONREADYSTATECHANGE in createElement('script')){defer=function(id){html.appendChild(createElement('script'))[ONREADYSTATECHANGE]=function(){html.removeChild(this);run(id);};};}else{defer=function(id){setTimeout(runner(id),0);};}}
module.exports={set:set,clear:clear};}),7739:(function(module,__unused_webpack_exports,__webpack_require__){var toIntegerOrInfinity=__webpack_require__(1941);var max=Math.max;var min=Math.min;module.exports=function(index,length){var integer=toIntegerOrInfinity(index);return integer<0?max(integer+length,0):min(integer,length);};}),101:(function(module,__unused_webpack_exports,__webpack_require__){var IndexedObject=__webpack_require__(2202);var requireObjectCoercible=__webpack_require__(3209);module.exports=function(it){return IndexedObject(requireObjectCoercible(it));};}),1941:(function(module){var ceil=Math.ceil;var floor=Math.floor;module.exports=function(argument){var number=+argument;return number!==number||number===0?0:(number>0?floor:ceil)(number);};}),8445:(function(module,__unused_webpack_exports,__webpack_require__){var toIntegerOrInfinity=__webpack_require__(1941);var min=Math.min;module.exports=function(argument){return argument>0?min(toIntegerOrInfinity(argument),0x1FFFFFFFFFFFFF):0;};}),1795:(function(module,__unused_webpack_exports,__webpack_require__){var requireObjectCoercible=__webpack_require__(3209);module.exports=function(argument){return Object(requireObjectCoercible(argument));};}),7888:(function(module,__unused_webpack_exports,__webpack_require__){var isObject=__webpack_require__(5744);var isSymbol=__webpack_require__(3236);var getMethod=__webpack_require__(5037);var ordinaryToPrimitive=__webpack_require__(380);var wellKnownSymbol=__webpack_require__(8182);var TO_PRIMITIVE=wellKnownSymbol('toPrimitive');module.exports=function(input,pref){if(!isObject(input)||isSymbol(input))return input;var exoticToPrim=getMethod(input,TO_PRIMITIVE);var result;if(exoticToPrim){if(pref===undefined)pref='default';result=exoticToPrim.call(input,pref);if(!isObject(result)||isSymbol(result))return result;throw TypeError("Can't convert object to primitive value");}
if(pref===undefined)pref='number';return ordinaryToPrimitive(input,pref);};}),77:(function(module,__unused_webpack_exports,__webpack_require__){var toPrimitive=__webpack_require__(7888);var isSymbol=__webpack_require__(3236);module.exports=function(argument){var key=toPrimitive(argument,'string');return isSymbol(key)?key:String(key);};}),3471:(function(module,__unused_webpack_exports,__webpack_require__){var wellKnownSymbol=__webpack_require__(8182);var TO_STRING_TAG=wellKnownSymbol('toStringTag');var test={};test[TO_STRING_TAG]='z';module.exports=String(test)==='[object z]';}),4845:(function(module,__unused_webpack_exports,__webpack_require__){var classof=__webpack_require__(4696);module.exports=function(argument){if(classof(argument)==='Symbol')throw TypeError('Cannot convert a Symbol value to a string');return String(argument);};}),9288:(function(module){module.exports=function(argument){try{return String(argument);}catch(error){return'Object';}};}),2759:(function(module){var id=0;var postfix=Math.random();module.exports=function(key){return'Symbol('+String(key===undefined?'':key)+')_'+(++id+postfix).toString(36);};}),615:(function(module,__unused_webpack_exports,__webpack_require__){var NATIVE_SYMBOL=__webpack_require__(3045);module.exports=NATIVE_SYMBOL&&!Symbol.sham&&typeof Symbol.iterator=='symbol';}),9207:(function(__unused_webpack_module,exports,__webpack_require__){var wellKnownSymbol=__webpack_require__(8182);exports.f=wellKnownSymbol;}),8182:(function(module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var shared=__webpack_require__(8717);var hasOwn=__webpack_require__(4500);var uid=__webpack_require__(2759);var NATIVE_SYMBOL=__webpack_require__(3045);var USE_SYMBOL_AS_UID=__webpack_require__(615);var WellKnownSymbolsStore=shared('wks');var Symbol=global.Symbol;var createWellKnownSymbol=USE_SYMBOL_AS_UID?Symbol:Symbol&&Symbol.withoutSetter||uid;module.exports=function(name){if(!hasOwn(WellKnownSymbolsStore,name)||!(NATIVE_SYMBOL||typeof WellKnownSymbolsStore[name]=='string')){if(NATIVE_SYMBOL&&hasOwn(Symbol,name)){WellKnownSymbolsStore[name]=Symbol[name];}else{WellKnownSymbolsStore[name]=createWellKnownSymbol('Symbol.'+name);}}return WellKnownSymbolsStore[name];};}),1450:(function(module){module.exports='\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u2000\u2001\u2002'+'\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF';}),4242:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var getPrototypeOf=__webpack_require__(9341);var setPrototypeOf=__webpack_require__(4469);var create=__webpack_require__(2853);var createNonEnumerableProperty=__webpack_require__(8711);var createPropertyDescriptor=__webpack_require__(774);var installErrorCause=__webpack_require__(273);var iterate=__webpack_require__(3442);var toString=__webpack_require__(4845);var $AggregateError=function AggregateError(errors,message){var that=this;var options=arguments.length>2?arguments[2]:undefined;if(!(that instanceof $AggregateError))return new $AggregateError(errors,message,options);if(setPrototypeOf){that=setPrototypeOf(new Error(undefined),getPrototypeOf(that));}
if(message!==undefined)createNonEnumerableProperty(that,'message',toString(message));installErrorCause(that,options);var errorsArray=[];iterate(errors,errorsArray.push,{that:errorsArray});createNonEnumerableProperty(that,'errors',errorsArray);return that;};$AggregateError.prototype=create(Error.prototype,{constructor:createPropertyDescriptor(5,$AggregateError),message:createPropertyDescriptor(5,''),name:createPropertyDescriptor(5,'AggregateError')});$({global:true},{AggregateError:$AggregateError});}),9106:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var fails=__webpack_require__(6192);var isArray=__webpack_require__(4770);var isObject=__webpack_require__(5744);var toObject=__webpack_require__(1795);var lengthOfArrayLike=__webpack_require__(4104);var createProperty=__webpack_require__(9361);var arraySpeciesCreate=__webpack_require__(1321);var arrayMethodHasSpeciesSupport=__webpack_require__(242);var wellKnownSymbol=__webpack_require__(8182);var V8_VERSION=__webpack_require__(4218);var IS_CONCAT_SPREADABLE=wellKnownSymbol('isConcatSpreadable');var MAX_SAFE_INTEGER=0x1FFFFFFFFFFFFF;var MAXIMUM_ALLOWED_INDEX_EXCEEDED='Maximum allowed index exceeded';var IS_CONCAT_SPREADABLE_SUPPORT=V8_VERSION>=51||!fails(function(){var array=[];array[IS_CONCAT_SPREADABLE]=false;return array.concat()[0]!==array;});var SPECIES_SUPPORT=arrayMethodHasSpeciesSupport('concat');var isConcatSpreadable=function(O){if(!isObject(O))return false;var spreadable=O[IS_CONCAT_SPREADABLE];return spreadable!==undefined?!!spreadable:isArray(O);};var FORCED=!IS_CONCAT_SPREADABLE_SUPPORT||!SPECIES_SUPPORT;$({target:'Array',proto:true,forced:FORCED},{concat:function concat(arg){var O=toObject(this);var A=arraySpeciesCreate(O,0);var n=0;var i,k,length,len,E;for(i=-1,length=arguments.length;i<length;i++){E=i===-1?O:arguments[i];if(isConcatSpreadable(E)){len=lengthOfArrayLike(E);if(n+len>MAX_SAFE_INTEGER)throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);for(k=0;k<len;k++,n++)if(k in E)createProperty(A,n,E[k]);}else{if(n>=MAX_SAFE_INTEGER)throw TypeError(MAXIMUM_ALLOWED_INDEX_EXCEEDED);createProperty(A,n++,E);}}
A.length=n;return A;}});}),1710:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var fill=__webpack_require__(2724);var addToUnscopables=__webpack_require__(7423);$({target:'Array',proto:true},{fill:fill});addToUnscopables('fill');}),3436:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var $filter=__webpack_require__(454).filter;var arrayMethodHasSpeciesSupport=__webpack_require__(242);var HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport('filter');$({target:'Array',proto:true,forced:!HAS_SPECIES_SUPPORT},{filter:function filter(callbackfn){return $filter(this,callbackfn,arguments.length>1?arguments[1]:undefined);}});}),9823:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var forEach=__webpack_require__(7397);$({target:'Array',proto:true,forced:[].forEach!=forEach},{forEach:forEach});}),9173:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var from=__webpack_require__(841);var checkCorrectnessOfIteration=__webpack_require__(9770);var INCORRECT_ITERATION=!checkCorrectnessOfIteration(function(iterable){Array.from(iterable);});$({target:'Array',stat:true,forced:INCORRECT_ITERATION},{from:from});}),2276:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var $indexOf=__webpack_require__(8180).indexOf;var arrayMethodIsStrict=__webpack_require__(424);var nativeIndexOf=[].indexOf;var NEGATIVE_ZERO=!!nativeIndexOf&&1/[1].indexOf(1,-0)<0;var STRICT_METHOD=arrayMethodIsStrict('indexOf');$({target:'Array',proto:true,forced:NEGATIVE_ZERO||!STRICT_METHOD},{indexOf:function indexOf(searchElement){return NEGATIVE_ZERO?nativeIndexOf.apply(this,arguments)||0:$indexOf(this,searchElement,arguments.length>1?arguments[1]:undefined);}});}),8118:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var isArray=__webpack_require__(4770);$({target:'Array',stat:true},{isArray:isArray});}),8939:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";var toIndexedObject=__webpack_require__(101);var addToUnscopables=__webpack_require__(7423);var Iterators=__webpack_require__(7771);var InternalStateModule=__webpack_require__(3326);var defineIterator=__webpack_require__(7218);var ARRAY_ITERATOR='Array Iterator';var setInternalState=InternalStateModule.set;var getInternalState=InternalStateModule.getterFor(ARRAY_ITERATOR);module.exports=defineIterator(Array,'Array',function(iterated,kind){setInternalState(this,{type:ARRAY_ITERATOR,target:toIndexedObject(iterated),index:0,kind:kind});},function(){var state=getInternalState(this);var target=state.target;var kind=state.kind;var index=state.index++;if(!target||index>=target.length){state.target=undefined;return{value:undefined,done:true};}
if(kind=='keys')return{value:index,done:false};if(kind=='values')return{value:target[index],done:false};return{value:[index,target[index]],done:false};},'values');Iterators.Arguments=Iterators.Array;addToUnscopables('keys');addToUnscopables('values');addToUnscopables('entries');}),3838:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var $map=__webpack_require__(454).map;var arrayMethodHasSpeciesSupport=__webpack_require__(242);var HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport('map');$({target:'Array',proto:true,forced:!HAS_SPECIES_SUPPORT},{map:function map(callbackfn){return $map(this,callbackfn,arguments.length>1?arguments[1]:undefined);}});}),5818:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var isArray=__webpack_require__(4770);var isConstructor=__webpack_require__(2091);var isObject=__webpack_require__(5744);var toAbsoluteIndex=__webpack_require__(7739);var lengthOfArrayLike=__webpack_require__(4104);var toIndexedObject=__webpack_require__(101);var createProperty=__webpack_require__(9361);var wellKnownSymbol=__webpack_require__(8182);var arrayMethodHasSpeciesSupport=__webpack_require__(242);var HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport('slice');var SPECIES=wellKnownSymbol('species');var nativeSlice=[].slice;var max=Math.max;$({target:'Array',proto:true,forced:!HAS_SPECIES_SUPPORT},{slice:function slice(start,end){var O=toIndexedObject(this);var length=lengthOfArrayLike(O);var k=toAbsoluteIndex(start,length);var fin=toAbsoluteIndex(end===undefined?length:end,length);var Constructor,result,n;if(isArray(O)){Constructor=O.constructor;if(isConstructor(Constructor)&&(Constructor===Array||isArray(Constructor.prototype))){Constructor=undefined;}else if(isObject(Constructor)){Constructor=Constructor[SPECIES];if(Constructor===null)Constructor=undefined;}
if(Constructor===Array||Constructor===undefined){return nativeSlice.call(O,k,fin);}}
result=new(Constructor===undefined?Array:Constructor)(max(fin-k,0));for(n=0;k<fin;k++,n++)if(k in O)createProperty(result,n,O[k]);result.length=n;return result;}});}),2178:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var toAbsoluteIndex=__webpack_require__(7739);var toIntegerOrInfinity=__webpack_require__(1941);var lengthOfArrayLike=__webpack_require__(4104);var toObject=__webpack_require__(1795);var arraySpeciesCreate=__webpack_require__(1321);var createProperty=__webpack_require__(9361);var arrayMethodHasSpeciesSupport=__webpack_require__(242);var HAS_SPECIES_SUPPORT=arrayMethodHasSpeciesSupport('splice');var max=Math.max;var min=Math.min;var MAX_SAFE_INTEGER=0x1FFFFFFFFFFFFF;var MAXIMUM_ALLOWED_LENGTH_EXCEEDED='Maximum allowed length exceeded';$({target:'Array',proto:true,forced:!HAS_SPECIES_SUPPORT},{splice:function splice(start,deleteCount){var O=toObject(this);var len=lengthOfArrayLike(O);var actualStart=toAbsoluteIndex(start,len);var argumentsLength=arguments.length;var insertCount,actualDeleteCount,A,k,from,to;if(argumentsLength===0){insertCount=actualDeleteCount=0;}else if(argumentsLength===1){insertCount=0;actualDeleteCount=len-actualStart;}else{insertCount=argumentsLength-2;actualDeleteCount=min(max(toIntegerOrInfinity(deleteCount),0),len-actualStart);}
if(len+insertCount-actualDeleteCount>MAX_SAFE_INTEGER){throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);}
A=arraySpeciesCreate(O,actualDeleteCount);for(k=0;k<actualDeleteCount;k++){from=actualStart+k;if(from in O)createProperty(A,k,O[from]);}
A.length=actualDeleteCount;if(insertCount<actualDeleteCount){for(k=actualStart;k<len-actualDeleteCount;k++){from=k+actualDeleteCount;to=k+insertCount;if(from in O)O[to]=O[from];else delete O[to];}
for(k=len;k>len-actualDeleteCount+insertCount;k--)delete O[k-1];}else if(insertCount>actualDeleteCount){for(k=len-actualDeleteCount;k>actualStart;k--){from=k+actualDeleteCount-1;to=k+insertCount-1;if(from in O)O[to]=O[from];else delete O[to];}}
for(k=0;k<insertCount;k++){O[k+actualStart]=arguments[k+2];}
O.length=len-actualDeleteCount+insertCount;return A;}});}),665:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var bind=__webpack_require__(6782);$({target:'Function',proto:true},{bind:bind});}),8671:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var global=__webpack_require__(8576);var setToStringTag=__webpack_require__(1284);setToStringTag(global.JSON,'JSON',true);}),8556:(function(){}),2666:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var parseInt=__webpack_require__(2558);$({target:'Number',stat:true,forced:Number.parseInt!=parseInt},{parseInt:parseInt});}),3113:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var DESCRIPTORS=__webpack_require__(69);var create=__webpack_require__(2853);$({target:'Object',stat:true,sham:!DESCRIPTORS},{create:create});}),297:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var DESCRIPTORS=__webpack_require__(69);var objectDefinePropertyModile=__webpack_require__(2760);$({target:'Object',stat:true,forced:!DESCRIPTORS,sham:!DESCRIPTORS},{defineProperty:objectDefinePropertyModile.f});}),9234:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var fails=__webpack_require__(6192);var toObject=__webpack_require__(1795);var nativeGetPrototypeOf=__webpack_require__(9341);var CORRECT_PROTOTYPE_GETTER=__webpack_require__(4635);var FAILS_ON_PRIMITIVES=fails(function(){nativeGetPrototypeOf(1);});$({target:'Object',stat:true,forced:FAILS_ON_PRIMITIVES,sham:!CORRECT_PROTOTYPE_GETTER},{getPrototypeOf:function getPrototypeOf(it){return nativeGetPrototypeOf(toObject(it));}});}),2647:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var toObject=__webpack_require__(1795);var nativeKeys=__webpack_require__(7653);var fails=__webpack_require__(6192);var FAILS_ON_PRIMITIVES=fails(function(){nativeKeys(1);});$({target:'Object',stat:true,forced:FAILS_ON_PRIMITIVES},{keys:function keys(it){return nativeKeys(toObject(it));}});}),3222:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var setPrototypeOf=__webpack_require__(4469);$({target:'Object',stat:true},{setPrototypeOf:setPrototypeOf});}),6663:(function(){}),4859:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var $parseFloat=__webpack_require__(15);$({global:true,forced:parseFloat!=$parseFloat},{parseFloat:$parseFloat});}),5706:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var $parseInt=__webpack_require__(2558);$({global:true,forced:parseInt!=$parseInt},{parseInt:$parseInt});}),7884:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var aCallable=__webpack_require__(6235);var newPromiseCapabilityModule=__webpack_require__(9438);var perform=__webpack_require__(892);var iterate=__webpack_require__(3442);$({target:'Promise',stat:true},{allSettled:function allSettled(iterable){var C=this;var capability=newPromiseCapabilityModule.f(C);var resolve=capability.resolve;var reject=capability.reject;var result=perform(function(){var promiseResolve=aCallable(C.resolve);var values=[];var counter=0;var remaining=1;iterate(iterable,function(promise){var index=counter++;var alreadyCalled=false;values.push(undefined);remaining++;promiseResolve.call(C,promise).then(function(value){if(alreadyCalled)return;alreadyCalled=true;values[index]={status:'fulfilled',value:value};--remaining||resolve(values);},function(error){if(alreadyCalled)return;alreadyCalled=true;values[index]={status:'rejected',reason:error};--remaining||resolve(values);});});--remaining||resolve(values);});if(result.error)reject(result.value);return capability.promise;}});}),8885:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var aCallable=__webpack_require__(6235);var getBuiltIn=__webpack_require__(150);var newPromiseCapabilityModule=__webpack_require__(9438);var perform=__webpack_require__(892);var iterate=__webpack_require__(3442);var PROMISE_ANY_ERROR='No one promise resolved';$({target:'Promise',stat:true},{any:function any(iterable){var C=this;var capability=newPromiseCapabilityModule.f(C);var resolve=capability.resolve;var reject=capability.reject;var result=perform(function(){var promiseResolve=aCallable(C.resolve);var errors=[];var counter=0;var remaining=1;var alreadyResolved=false;iterate(iterable,function(promise){var index=counter++;var alreadyRejected=false;errors.push(undefined);remaining++;promiseResolve.call(C,promise).then(function(value){if(alreadyRejected||alreadyResolved)return;alreadyResolved=true;resolve(value);},function(error){if(alreadyRejected||alreadyResolved)return;alreadyRejected=true;errors[index]=error;--remaining||reject(new(getBuiltIn('AggregateError'))(errors,PROMISE_ANY_ERROR));});});--remaining||reject(new(getBuiltIn('AggregateError'))(errors,PROMISE_ANY_ERROR));});if(result.error)reject(result.value);return capability.promise;}});}),1868:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var IS_PURE=__webpack_require__(5546);var NativePromise=__webpack_require__(4471);var fails=__webpack_require__(6192);var getBuiltIn=__webpack_require__(150);var isCallable=__webpack_require__(6447);var speciesConstructor=__webpack_require__(4743);var promiseResolve=__webpack_require__(9126);var redefine=__webpack_require__(9482);var NON_GENERIC=!!NativePromise&&fails(function(){NativePromise.prototype['finally'].call({then:function(){}},function(){});});$({target:'Promise',proto:true,real:true,forced:NON_GENERIC},{'finally':function(onFinally){var C=speciesConstructor(this,getBuiltIn('Promise'));var isFunction=isCallable(onFinally);return this.then(isFunction?function(x){return promiseResolve(C,onFinally()).then(function(){return x;});}:onFinally,isFunction?function(e){return promiseResolve(C,onFinally()).then(function(){throw e;});}:onFinally);}});if(!IS_PURE&&isCallable(NativePromise)){var method=getBuiltIn('Promise').prototype['finally'];if(NativePromise.prototype['finally']!==method){redefine(NativePromise.prototype,'finally',method,{unsafe:true});}}}),9021:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var IS_PURE=__webpack_require__(5546);var global=__webpack_require__(8576);var getBuiltIn=__webpack_require__(150);var NativePromise=__webpack_require__(4471);var redefine=__webpack_require__(9482);var redefineAll=__webpack_require__(533);var setPrototypeOf=__webpack_require__(4469);var setToStringTag=__webpack_require__(1284);var setSpecies=__webpack_require__(3656);var aCallable=__webpack_require__(6235);var isCallable=__webpack_require__(6447);var isObject=__webpack_require__(5744);var anInstance=__webpack_require__(6961);var inspectSource=__webpack_require__(9516);var iterate=__webpack_require__(3442);var checkCorrectnessOfIteration=__webpack_require__(9770);var speciesConstructor=__webpack_require__(4743);var task=__webpack_require__(7160).set;var microtask=__webpack_require__(2950);var promiseResolve=__webpack_require__(9126);var hostReportErrors=__webpack_require__(3681);var newPromiseCapabilityModule=__webpack_require__(9438);var perform=__webpack_require__(892);var InternalStateModule=__webpack_require__(3326);var isForced=__webpack_require__(9245);var wellKnownSymbol=__webpack_require__(8182);var IS_BROWSER=__webpack_require__(2957);var IS_NODE=__webpack_require__(224);var V8_VERSION=__webpack_require__(4218);var SPECIES=wellKnownSymbol('species');var PROMISE='Promise';var getInternalState=InternalStateModule.get;var setInternalState=InternalStateModule.set;var getInternalPromiseState=InternalStateModule.getterFor(PROMISE);var NativePromisePrototype=NativePromise&&NativePromise.prototype;var PromiseConstructor=NativePromise;var PromiseConstructorPrototype=NativePromisePrototype;var TypeError=global.TypeError;var document=global.document;var process=global.process;var newPromiseCapability=newPromiseCapabilityModule.f;var newGenericPromiseCapability=newPromiseCapability;var DISPATCH_EVENT=!!(document&&document.createEvent&&global.dispatchEvent);var NATIVE_REJECTION_EVENT=isCallable(global.PromiseRejectionEvent);var UNHANDLED_REJECTION='unhandledrejection';var REJECTION_HANDLED='rejectionhandled';var PENDING=0;var FULFILLED=1;var REJECTED=2;var HANDLED=1;var UNHANDLED=2;var SUBCLASSING=false;var Internal,OwnPromiseCapability,PromiseWrapper,nativeThen;var FORCED=isForced(PROMISE,function(){var PROMISE_CONSTRUCTOR_SOURCE=inspectSource(PromiseConstructor);var GLOBAL_CORE_JS_PROMISE=PROMISE_CONSTRUCTOR_SOURCE!==String(PromiseConstructor);if(!GLOBAL_CORE_JS_PROMISE&&V8_VERSION===66)return true;if(IS_PURE&&!PromiseConstructorPrototype['finally'])return true;if(V8_VERSION>=51&&/native code/.test(PROMISE_CONSTRUCTOR_SOURCE))return false;var promise=new PromiseConstructor(function(resolve){resolve(1);});var FakePromise=function(exec){exec(function(){},function(){});};var constructor=promise.constructor={};constructor[SPECIES]=FakePromise;SUBCLASSING=promise.then(function(){})instanceof FakePromise;if(!SUBCLASSING)return true;return!GLOBAL_CORE_JS_PROMISE&&IS_BROWSER&&!NATIVE_REJECTION_EVENT;});var INCORRECT_ITERATION=FORCED||!checkCorrectnessOfIteration(function(iterable){PromiseConstructor.all(iterable)['catch'](function(){});});var isThenable=function(it){var then;return isObject(it)&&isCallable(then=it.then)?then:false;};var notify=function(state,isReject){if(state.notified)return;state.notified=true;var chain=state.reactions;microtask(function(){var value=state.value;var ok=state.state==FULFILLED;var index=0;while(chain.length>index){var reaction=chain[index++];var handler=ok?reaction.ok:reaction.fail;var resolve=reaction.resolve;var reject=reaction.reject;var domain=reaction.domain;var result,then,exited;try{if(handler){if(!ok){if(state.rejection===UNHANDLED)onHandleUnhandled(state);state.rejection=HANDLED;}
if(handler===true)result=value;else{if(domain)domain.enter();result=handler(value);if(domain){domain.exit();exited=true;}}
if(result===reaction.promise){reject(TypeError('Promise-chain cycle'));}else if(then=isThenable(result)){then.call(result,resolve,reject);}else resolve(result);}else reject(value);}catch(error){if(domain&&!exited)domain.exit();reject(error);}}
state.reactions=[];state.notified=false;if(isReject&&!state.rejection)onUnhandled(state);});};var dispatchEvent=function(name,promise,reason){var event,handler;if(DISPATCH_EVENT){event=document.createEvent('Event');event.promise=promise;event.reason=reason;event.initEvent(name,false,true);global.dispatchEvent(event);}else event={promise:promise,reason:reason};if(!NATIVE_REJECTION_EVENT&&(handler=global['on'+name]))handler(event);else if(name===UNHANDLED_REJECTION)hostReportErrors('Unhandled promise rejection',reason);};var onUnhandled=function(state){task.call(global,function(){var promise=state.facade;var value=state.value;var IS_UNHANDLED=isUnhandled(state);var result;if(IS_UNHANDLED){result=perform(function(){if(IS_NODE){process.emit('unhandledRejection',value,promise);}else dispatchEvent(UNHANDLED_REJECTION,promise,value);});state.rejection=IS_NODE||isUnhandled(state)?UNHANDLED:HANDLED;if(result.error)throw result.value;}});};var isUnhandled=function(state){return state.rejection!==HANDLED&&!state.parent;};var onHandleUnhandled=function(state){task.call(global,function(){var promise=state.facade;if(IS_NODE){process.emit('rejectionHandled',promise);}else dispatchEvent(REJECTION_HANDLED,promise,state.value);});};var bind=function(fn,state,unwrap){return function(value){fn(state,value,unwrap);};};var internalReject=function(state,value,unwrap){if(state.done)return;state.done=true;if(unwrap)state=unwrap;state.value=value;state.state=REJECTED;notify(state,true);};var internalResolve=function(state,value,unwrap){if(state.done)return;state.done=true;if(unwrap)state=unwrap;try{if(state.facade===value)throw TypeError("Promise can't be resolved itself");var then=isThenable(value);if(then){microtask(function(){var wrapper={done:false};try{then.call(value,bind(internalResolve,wrapper,state),bind(internalReject,wrapper,state));}catch(error){internalReject(wrapper,error,state);}});}else{state.value=value;state.state=FULFILLED;notify(state,false);}}catch(error){internalReject({done:false},error,state);}};if(FORCED){PromiseConstructor=function Promise(executor){anInstance(this,PromiseConstructor,PROMISE);aCallable(executor);Internal.call(this);var state=getInternalState(this);try{executor(bind(internalResolve,state),bind(internalReject,state));}catch(error){internalReject(state,error);}};PromiseConstructorPrototype=PromiseConstructor.prototype;Internal=function Promise(executor){setInternalState(this,{type:PROMISE,done:false,notified:false,parent:false,reactions:[],rejection:false,state:PENDING,value:undefined});};Internal.prototype=redefineAll(PromiseConstructorPrototype,{then:function then(onFulfilled,onRejected){var state=getInternalPromiseState(this);var reaction=newPromiseCapability(speciesConstructor(this,PromiseConstructor));reaction.ok=isCallable(onFulfilled)?onFulfilled:true;reaction.fail=isCallable(onRejected)&&onRejected;reaction.domain=IS_NODE?process.domain:undefined;state.parent=true;state.reactions.push(reaction);if(state.state!=PENDING)notify(state,false);return reaction.promise;},'catch':function(onRejected){return this.then(undefined,onRejected);}});OwnPromiseCapability=function(){var promise=new Internal();var state=getInternalState(promise);this.promise=promise;this.resolve=bind(internalResolve,state);this.reject=bind(internalReject,state);};newPromiseCapabilityModule.f=newPromiseCapability=function(C){return C===PromiseConstructor||C===PromiseWrapper?new OwnPromiseCapability(C):newGenericPromiseCapability(C);};if(!IS_PURE&&isCallable(NativePromise)&&NativePromisePrototype!==Object.prototype){nativeThen=NativePromisePrototype.then;if(!SUBCLASSING){redefine(NativePromisePrototype,'then',function then(onFulfilled,onRejected){var that=this;return new PromiseConstructor(function(resolve,reject){nativeThen.call(that,resolve,reject);}).then(onFulfilled,onRejected);},{unsafe:true});redefine(NativePromisePrototype,'catch',PromiseConstructorPrototype['catch'],{unsafe:true});}
try{delete NativePromisePrototype.constructor;}catch(error){}
if(setPrototypeOf){setPrototypeOf(NativePromisePrototype,PromiseConstructorPrototype);}}}
$({global:true,wrap:true,forced:FORCED},{Promise:PromiseConstructor});setToStringTag(PromiseConstructor,PROMISE,false,true);setSpecies(PROMISE);PromiseWrapper=getBuiltIn(PROMISE);$({target:PROMISE,stat:true,forced:FORCED},{reject:function reject(r){var capability=newPromiseCapability(this);capability.reject.call(undefined,r);return capability.promise;}});$({target:PROMISE,stat:true,forced:IS_PURE||FORCED},{resolve:function resolve(x){return promiseResolve(IS_PURE&&this===PromiseWrapper?PromiseConstructor:this,x);}});$({target:PROMISE,stat:true,forced:INCORRECT_ITERATION},{all:function all(iterable){var C=this;var capability=newPromiseCapability(C);var resolve=capability.resolve;var reject=capability.reject;var result=perform(function(){var $promiseResolve=aCallable(C.resolve);var values=[];var counter=0;var remaining=1;iterate(iterable,function(promise){var index=counter++;var alreadyCalled=false;values.push(undefined);remaining++;$promiseResolve.call(C,promise).then(function(value){if(alreadyCalled)return;alreadyCalled=true;values[index]=value;--remaining||resolve(values);},reject);});--remaining||resolve(values);});if(result.error)reject(result.value);return capability.promise;},race:function race(iterable){var C=this;var capability=newPromiseCapability(C);var reject=capability.reject;var result=perform(function(){var $promiseResolve=aCallable(C.resolve);iterate(iterable,function(promise){$promiseResolve.call(C,promise).then(capability.resolve,reject);});});if(result.error)reject(result.value);return capability.promise;}});}),5397:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var getBuiltIn=__webpack_require__(150);var aConstructor=__webpack_require__(1404);var anObject=__webpack_require__(1138);var isObject=__webpack_require__(5744);var create=__webpack_require__(2853);var bind=__webpack_require__(6782);var fails=__webpack_require__(6192);var nativeConstruct=getBuiltIn('Reflect','construct');var NEW_TARGET_BUG=fails(function(){function F(){}
return!(nativeConstruct(function(){},[],F)instanceof F);});var ARGS_BUG=!fails(function(){nativeConstruct(function(){});});var FORCED=NEW_TARGET_BUG||ARGS_BUG;$({target:'Reflect',stat:true,forced:FORCED,sham:FORCED},{construct:function construct(Target,args){aConstructor(Target);anObject(args);var newTarget=arguments.length<3?Target:aConstructor(arguments[2]);if(ARGS_BUG&&!NEW_TARGET_BUG)return nativeConstruct(Target,args,newTarget);if(Target==newTarget){switch(args.length){case 0:return new Target();case 1:return new Target(args[0]);case 2:return new Target(args[0],args[1]);case 3:return new Target(args[0],args[1],args[2]);case 4:return new Target(args[0],args[1],args[2],args[3]);}
var $args=[null];$args.push.apply($args,args);return new(bind.apply(Target,$args))();}
var proto=newTarget.prototype;var instance=create(isObject(proto)?proto:Object.prototype);var result=Function.apply.call(Target,instance,args);return isObject(result)?result:instance;}});}),1367:(function(){}),5454:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var charAt=__webpack_require__(863).charAt;var toString=__webpack_require__(4845);var InternalStateModule=__webpack_require__(3326);var defineIterator=__webpack_require__(7218);var STRING_ITERATOR='String Iterator';var setInternalState=InternalStateModule.set;var getInternalState=InternalStateModule.getterFor(STRING_ITERATOR);defineIterator(String,'String',function(iterated){setInternalState(this,{type:STRING_ITERATOR,string:toString(iterated),index:0});},function next(){var state=getInternalState(this);var string=state.string;var index=state.index;var point;if(index>=string.length)return{value:undefined,done:true};point=charAt(string,index);state.index+=point.length;return{value:point,done:false};});}),957:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var $trim=__webpack_require__(4277).trim;var forcedStringTrimMethod=__webpack_require__(6815);$({target:'String',proto:true,forced:forcedStringTrimMethod('trim')},{trim:function trim(){return $trim(this);}});}),9781:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('asyncIterator');}),492:(function(){}),6681:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('hasInstance');}),9594:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('isConcatSpreadable');}),3665:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('iterator');}),6187:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";var $=__webpack_require__(3085);var global=__webpack_require__(8576);var getBuiltIn=__webpack_require__(150);var IS_PURE=__webpack_require__(5546);var DESCRIPTORS=__webpack_require__(69);var NATIVE_SYMBOL=__webpack_require__(3045);var fails=__webpack_require__(6192);var hasOwn=__webpack_require__(4500);var isArray=__webpack_require__(4770);var isCallable=__webpack_require__(6447);var isObject=__webpack_require__(5744);var isSymbol=__webpack_require__(3236);var anObject=__webpack_require__(1138);var toObject=__webpack_require__(1795);var toIndexedObject=__webpack_require__(101);var toPropertyKey=__webpack_require__(77);var $toString=__webpack_require__(4845);var createPropertyDescriptor=__webpack_require__(774);var nativeObjectCreate=__webpack_require__(2853);var objectKeys=__webpack_require__(7653);var getOwnPropertyNamesModule=__webpack_require__(2092);var getOwnPropertyNamesExternal=__webpack_require__(4052);var getOwnPropertySymbolsModule=__webpack_require__(4750);var getOwnPropertyDescriptorModule=__webpack_require__(5141);var definePropertyModule=__webpack_require__(2760);var propertyIsEnumerableModule=__webpack_require__(6007);var redefine=__webpack_require__(9482);var shared=__webpack_require__(8717);var sharedKey=__webpack_require__(9766);var hiddenKeys=__webpack_require__(4535);var uid=__webpack_require__(2759);var wellKnownSymbol=__webpack_require__(8182);var wrappedWellKnownSymbolModule=__webpack_require__(9207);var defineWellKnownSymbol=__webpack_require__(1488);var setToStringTag=__webpack_require__(1284);var InternalStateModule=__webpack_require__(3326);var $forEach=__webpack_require__(454).forEach;var HIDDEN=sharedKey('hidden');var SYMBOL='Symbol';var PROTOTYPE='prototype';var TO_PRIMITIVE=wellKnownSymbol('toPrimitive');var setInternalState=InternalStateModule.set;var getInternalState=InternalStateModule.getterFor(SYMBOL);var ObjectPrototype=Object[PROTOTYPE];var $Symbol=global.Symbol;var $stringify=getBuiltIn('JSON','stringify');var nativeGetOwnPropertyDescriptor=getOwnPropertyDescriptorModule.f;var nativeDefineProperty=definePropertyModule.f;var nativeGetOwnPropertyNames=getOwnPropertyNamesExternal.f;var nativePropertyIsEnumerable=propertyIsEnumerableModule.f;var AllSymbols=shared('symbols');var ObjectPrototypeSymbols=shared('op-symbols');var StringToSymbolRegistry=shared('string-to-symbol-registry');var SymbolToStringRegistry=shared('symbol-to-string-registry');var WellKnownSymbolsStore=shared('wks');var QObject=global.QObject;var USE_SETTER=!QObject||!QObject[PROTOTYPE]||!QObject[PROTOTYPE].findChild;var setSymbolDescriptor=DESCRIPTORS&&fails(function(){return nativeObjectCreate(nativeDefineProperty({},'a',{get:function(){return nativeDefineProperty(this,'a',{value:7}).a;}})).a!=7;})?function(O,P,Attributes){var ObjectPrototypeDescriptor=nativeGetOwnPropertyDescriptor(ObjectPrototype,P);if(ObjectPrototypeDescriptor)delete ObjectPrototype[P];nativeDefineProperty(O,P,Attributes);if(ObjectPrototypeDescriptor&&O!==ObjectPrototype){nativeDefineProperty(ObjectPrototype,P,ObjectPrototypeDescriptor);}}:nativeDefineProperty;var wrap=function(tag,description){var symbol=AllSymbols[tag]=nativeObjectCreate($Symbol[PROTOTYPE]);setInternalState(symbol,{type:SYMBOL,tag:tag,description:description});if(!DESCRIPTORS)symbol.description=description;return symbol;};var $defineProperty=function defineProperty(O,P,Attributes){if(O===ObjectPrototype)$defineProperty(ObjectPrototypeSymbols,P,Attributes);anObject(O);var key=toPropertyKey(P);anObject(Attributes);if(hasOwn(AllSymbols,key)){if(!Attributes.enumerable){if(!hasOwn(O,HIDDEN))nativeDefineProperty(O,HIDDEN,createPropertyDescriptor(1,{}));O[HIDDEN][key]=true;}else{if(hasOwn(O,HIDDEN)&&O[HIDDEN][key])O[HIDDEN][key]=false;Attributes=nativeObjectCreate(Attributes,{enumerable:createPropertyDescriptor(0,false)});}return setSymbolDescriptor(O,key,Attributes);}return nativeDefineProperty(O,key,Attributes);};var $defineProperties=function defineProperties(O,Properties){anObject(O);var properties=toIndexedObject(Properties);var keys=objectKeys(properties).concat($getOwnPropertySymbols(properties));$forEach(keys,function(key){if(!DESCRIPTORS||$propertyIsEnumerable.call(properties,key))$defineProperty(O,key,properties[key]);});return O;};var $create=function create(O,Properties){return Properties===undefined?nativeObjectCreate(O):$defineProperties(nativeObjectCreate(O),Properties);};var $propertyIsEnumerable=function propertyIsEnumerable(V){var P=toPropertyKey(V);var enumerable=nativePropertyIsEnumerable.call(this,P);if(this===ObjectPrototype&&hasOwn(AllSymbols,P)&&!hasOwn(ObjectPrototypeSymbols,P))return false;return enumerable||!hasOwn(this,P)||!hasOwn(AllSymbols,P)||hasOwn(this,HIDDEN)&&this[HIDDEN][P]?enumerable:true;};var $getOwnPropertyDescriptor=function getOwnPropertyDescriptor(O,P){var it=toIndexedObject(O);var key=toPropertyKey(P);if(it===ObjectPrototype&&hasOwn(AllSymbols,key)&&!hasOwn(ObjectPrototypeSymbols,key))return;var descriptor=nativeGetOwnPropertyDescriptor(it,key);if(descriptor&&hasOwn(AllSymbols,key)&&!(hasOwn(it,HIDDEN)&&it[HIDDEN][key])){descriptor.enumerable=true;}
return descriptor;};var $getOwnPropertyNames=function getOwnPropertyNames(O){var names=nativeGetOwnPropertyNames(toIndexedObject(O));var result=[];$forEach(names,function(key){if(!hasOwn(AllSymbols,key)&&!hasOwn(hiddenKeys,key))result.push(key);});return result;};var $getOwnPropertySymbols=function getOwnPropertySymbols(O){var IS_OBJECT_PROTOTYPE=O===ObjectPrototype;var names=nativeGetOwnPropertyNames(IS_OBJECT_PROTOTYPE?ObjectPrototypeSymbols:toIndexedObject(O));var result=[];$forEach(names,function(key){if(hasOwn(AllSymbols,key)&&(!IS_OBJECT_PROTOTYPE||hasOwn(ObjectPrototype,key))){result.push(AllSymbols[key]);}});return result;};if(!NATIVE_SYMBOL){$Symbol=function Symbol(){if(this instanceof $Symbol)throw TypeError('Symbol is not a constructor');var description=!arguments.length||arguments[0]===undefined?undefined:$toString(arguments[0]);var tag=uid(description);var setter=function(value){if(this===ObjectPrototype)setter.call(ObjectPrototypeSymbols,value);if(hasOwn(this,HIDDEN)&&hasOwn(this[HIDDEN],tag))this[HIDDEN][tag]=false;setSymbolDescriptor(this,tag,createPropertyDescriptor(1,value));};if(DESCRIPTORS&&USE_SETTER)setSymbolDescriptor(ObjectPrototype,tag,{configurable:true,set:setter});return wrap(tag,description);};redefine($Symbol[PROTOTYPE],'toString',function toString(){return getInternalState(this).tag;});redefine($Symbol,'withoutSetter',function(description){return wrap(uid(description),description);});propertyIsEnumerableModule.f=$propertyIsEnumerable;definePropertyModule.f=$defineProperty;getOwnPropertyDescriptorModule.f=$getOwnPropertyDescriptor;getOwnPropertyNamesModule.f=getOwnPropertyNamesExternal.f=$getOwnPropertyNames;getOwnPropertySymbolsModule.f=$getOwnPropertySymbols;wrappedWellKnownSymbolModule.f=function(name){return wrap(wellKnownSymbol(name),name);};if(DESCRIPTORS){nativeDefineProperty($Symbol[PROTOTYPE],'description',{configurable:true,get:function description(){return getInternalState(this).description;}});if(!IS_PURE){redefine(ObjectPrototype,'propertyIsEnumerable',$propertyIsEnumerable,{unsafe:true});}}}
$({global:true,wrap:true,forced:!NATIVE_SYMBOL,sham:!NATIVE_SYMBOL},{Symbol:$Symbol});$forEach(objectKeys(WellKnownSymbolsStore),function(name){defineWellKnownSymbol(name);});$({target:SYMBOL,stat:true,forced:!NATIVE_SYMBOL},{'for':function(key){var string=$toString(key);if(hasOwn(StringToSymbolRegistry,string))return StringToSymbolRegistry[string];var symbol=$Symbol(string);StringToSymbolRegistry[string]=symbol;SymbolToStringRegistry[symbol]=string;return symbol;},keyFor:function keyFor(sym){if(!isSymbol(sym))throw TypeError(sym+' is not a symbol');if(hasOwn(SymbolToStringRegistry,sym))return SymbolToStringRegistry[sym];},useSetter:function(){USE_SETTER=true;},useSimple:function(){USE_SETTER=false;}});$({target:'Object',stat:true,forced:!NATIVE_SYMBOL,sham:!DESCRIPTORS},{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor});$({target:'Object',stat:true,forced:!NATIVE_SYMBOL},{getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols});$({target:'Object',stat:true,forced:fails(function(){getOwnPropertySymbolsModule.f(1);})},{getOwnPropertySymbols:function getOwnPropertySymbols(it){return getOwnPropertySymbolsModule.f(toObject(it));}});if($stringify){var FORCED_JSON_STRINGIFY=!NATIVE_SYMBOL||fails(function(){var symbol=$Symbol();return $stringify([symbol])!='[null]'||$stringify({a:symbol})!='{}'||$stringify(Object(symbol))!='{}';});$({target:'JSON',stat:true,forced:FORCED_JSON_STRINGIFY},{stringify:function stringify(it,replacer,space){var args=[it];var index=1;var $replacer;while(arguments.length>index)args.push(arguments[index++]);$replacer=replacer;if(!isObject(replacer)&&it===undefined||isSymbol(it))return;if(!isArray(replacer))replacer=function(key,value){if(isCallable($replacer))value=$replacer.call(this,key,value);if(!isSymbol(value))return value;};args[1]=replacer;return $stringify.apply(null,args);}});}
if(!$Symbol[PROTOTYPE][TO_PRIMITIVE]){var valueOf=$Symbol[PROTOTYPE].valueOf;redefine($Symbol[PROTOTYPE],TO_PRIMITIVE,function(){return valueOf.apply(this,arguments);});}
setToStringTag($Symbol,SYMBOL);hiddenKeys[HIDDEN]=true;}),1250:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('matchAll');}),9017:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('match');}),9786:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('replace');}),503:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('search');}),6565:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('species');}),9322:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('split');}),3610:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('toPrimitive');}),6886:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('toStringTag');}),3514:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('unscopables');}),177:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('asyncDispose');}),9031:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('dispose');}),6658:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('matcher');}),1875:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('metadata');}),8658:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('observable');}),4592:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('patternMatch');}),6680:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var defineWellKnownSymbol=__webpack_require__(1488);defineWellKnownSymbol('replaceAll');}),162:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){__webpack_require__(8939);var DOMIterables=__webpack_require__(7365);var global=__webpack_require__(8576);var classof=__webpack_require__(4696);var createNonEnumerableProperty=__webpack_require__(8711);var Iterators=__webpack_require__(7771);var wellKnownSymbol=__webpack_require__(8182);var TO_STRING_TAG=wellKnownSymbol('toStringTag');for(var COLLECTION_NAME in DOMIterables){var Collection=global[COLLECTION_NAME];var CollectionPrototype=Collection&&Collection.prototype;if(CollectionPrototype&&classof(CollectionPrototype)!==TO_STRING_TAG){createNonEnumerableProperty(CollectionPrototype,TO_STRING_TAG,COLLECTION_NAME);}
Iterators[COLLECTION_NAME]=Iterators.Array;}}),2906:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){var $=__webpack_require__(3085);var global=__webpack_require__(8576);var isCallable=__webpack_require__(6447);var userAgent=__webpack_require__(8989);var slice=[].slice;var MSIE=/MSIE .\./.test(userAgent);var wrap=function(scheduler){return function(handler,timeout){var boundArgs=arguments.length>2;var args=boundArgs?slice.call(arguments,2):undefined;return scheduler(boundArgs?function(){(isCallable(handler)?handler:Function(handler)).apply(this,args);}:handler,timeout);};};$({global:true,bind:true,forced:MSIE},{setTimeout:wrap(global.setTimeout),setInterval:wrap(global.setInterval)});}),9336:(function(module,__unused_webpack_exports,__webpack_require__){"use strict";__webpack_require__(8939);var $=__webpack_require__(3085);var getBuiltIn=__webpack_require__(150);var USE_NATIVE_URL=__webpack_require__(4551);var redefine=__webpack_require__(9482);var redefineAll=__webpack_require__(533);var setToStringTag=__webpack_require__(1284);var createIteratorConstructor=__webpack_require__(5148);var InternalStateModule=__webpack_require__(3326);var anInstance=__webpack_require__(6961);var isCallable=__webpack_require__(6447);var hasOwn=__webpack_require__(4500);var bind=__webpack_require__(8043);var classof=__webpack_require__(4696);var anObject=__webpack_require__(1138);var isObject=__webpack_require__(5744);var $toString=__webpack_require__(4845);var create=__webpack_require__(2853);var createPropertyDescriptor=__webpack_require__(774);var getIterator=__webpack_require__(1669);var getIteratorMethod=__webpack_require__(8703);var wellKnownSymbol=__webpack_require__(8182);var nativeFetch=getBuiltIn('fetch');var NativeRequest=getBuiltIn('Request');var RequestPrototype=NativeRequest&&NativeRequest.prototype;var Headers=getBuiltIn('Headers');var ITERATOR=wellKnownSymbol('iterator');var URL_SEARCH_PARAMS='URLSearchParams';var URL_SEARCH_PARAMS_ITERATOR=URL_SEARCH_PARAMS+'Iterator';var setInternalState=InternalStateModule.set;var getInternalParamsState=InternalStateModule.getterFor(URL_SEARCH_PARAMS);var getInternalIteratorState=InternalStateModule.getterFor(URL_SEARCH_PARAMS_ITERATOR);var plus=/\+/g;var sequences=Array(4);var percentSequence=function(bytes){return sequences[bytes-1]||(sequences[bytes-1]=RegExp('((?:%[\\da-f]{2}){'+bytes+'})','gi'));};var percentDecode=function(sequence){try{return decodeURIComponent(sequence);}catch(error){return sequence;}};var deserialize=function(it){var result=it.replace(plus,' ');var bytes=4;try{return decodeURIComponent(result);}catch(error){while(bytes){result=result.replace(percentSequence(bytes--),percentDecode);}
return result;}};var find=/[!'()~]|%20/g;var replace={'!':'%21',"'":'%27','(':'%28',')':'%29','~':'%7E','%20':'+'};var replacer=function(match){return replace[match];};var serialize=function(it){return encodeURIComponent(it).replace(find,replacer);};var parseSearchParams=function(result,query){if(query){var attributes=query.split('&');var index=0;var attribute,entry;while(index<attributes.length){attribute=attributes[index++];if(attribute.length){entry=attribute.split('=');result.push({key:deserialize(entry.shift()),value:deserialize(entry.join('='))});}}}};var updateSearchParams=function(query){this.entries.length=0;parseSearchParams(this.entries,query);};var validateArgumentsLength=function(passed,required){if(passed<required)throw TypeError('Not enough arguments');};var URLSearchParamsIterator=createIteratorConstructor(function Iterator(params,kind){setInternalState(this,{type:URL_SEARCH_PARAMS_ITERATOR,iterator:getIterator(getInternalParamsState(params).entries),kind:kind});},'Iterator',function next(){var state=getInternalIteratorState(this);var kind=state.kind;var step=state.iterator.next();var entry=step.value;if(!step.done){step.value=kind==='keys'?entry.key:kind==='values'?entry.value:[entry.key,entry.value];}return step;});var URLSearchParamsConstructor=function URLSearchParams(){anInstance(this,URLSearchParamsConstructor,URL_SEARCH_PARAMS);var init=arguments.length>0?arguments[0]:undefined;var that=this;var entries=[];var iteratorMethod,iterator,next,step,entryIterator,entryNext,first,second,key;setInternalState(that,{type:URL_SEARCH_PARAMS,entries:entries,updateURL:function(){},updateSearchParams:updateSearchParams});if(init!==undefined){if(isObject(init)){iteratorMethod=getIteratorMethod(init);if(iteratorMethod){iterator=getIterator(init,iteratorMethod);next=iterator.next;while(!(step=next.call(iterator)).done){entryIterator=getIterator(anObject(step.value));entryNext=entryIterator.next;if((first=entryNext.call(entryIterator)).done||(second=entryNext.call(entryIterator)).done||!entryNext.call(entryIterator).done)throw TypeError('Expected sequence with length 2');entries.push({key:$toString(first.value),value:$toString(second.value)});}}else for(key in init)if(hasOwn(init,key))entries.push({key:key,value:$toString(init[key])});}else{parseSearchParams(entries,typeof init==='string'?init.charAt(0)==='?'?init.slice(1):init:$toString(init));}}};var URLSearchParamsPrototype=URLSearchParamsConstructor.prototype;redefineAll(URLSearchParamsPrototype,{append:function append(name,value){validateArgumentsLength(arguments.length,2);var state=getInternalParamsState(this);state.entries.push({key:$toString(name),value:$toString(value)});state.updateURL();},'delete':function(name){validateArgumentsLength(arguments.length,1);var state=getInternalParamsState(this);var entries=state.entries;var key=$toString(name);var index=0;while(index<entries.length){if(entries[index].key===key)entries.splice(index,1);else index++;}
state.updateURL();},get:function get(name){validateArgumentsLength(arguments.length,1);var entries=getInternalParamsState(this).entries;var key=$toString(name);var index=0;for(;index<entries.length;index++){if(entries[index].key===key)return entries[index].value;}
return null;},getAll:function getAll(name){validateArgumentsLength(arguments.length,1);var entries=getInternalParamsState(this).entries;var key=$toString(name);var result=[];var index=0;for(;index<entries.length;index++){if(entries[index].key===key)result.push(entries[index].value);}
return result;},has:function has(name){validateArgumentsLength(arguments.length,1);var entries=getInternalParamsState(this).entries;var key=$toString(name);var index=0;while(index<entries.length){if(entries[index++].key===key)return true;}
return false;},set:function set(name,value){validateArgumentsLength(arguments.length,1);var state=getInternalParamsState(this);var entries=state.entries;var found=false;var key=$toString(name);var val=$toString(value);var index=0;var entry;for(;index<entries.length;index++){entry=entries[index];if(entry.key===key){if(found)entries.splice(index--,1);else{found=true;entry.value=val;}}}
if(!found)entries.push({key:key,value:val});state.updateURL();},sort:function sort(){var state=getInternalParamsState(this);var entries=state.entries;var slice=entries.slice();var entry,entriesIndex,sliceIndex;entries.length=0;for(sliceIndex=0;sliceIndex<slice.length;sliceIndex++){entry=slice[sliceIndex];for(entriesIndex=0;entriesIndex<sliceIndex;entriesIndex++){if(entries[entriesIndex].key>entry.key){entries.splice(entriesIndex,0,entry);break;}}
if(entriesIndex===sliceIndex)entries.push(entry);}
state.updateURL();},forEach:function forEach(callback){var entries=getInternalParamsState(this).entries;var boundFunction=bind(callback,arguments.length>1?arguments[1]:undefined,3);var index=0;var entry;while(index<entries.length){entry=entries[index++];boundFunction(entry.value,entry.key,this);}},keys:function keys(){return new URLSearchParamsIterator(this,'keys');},values:function values(){return new URLSearchParamsIterator(this,'values');},entries:function entries(){return new URLSearchParamsIterator(this,'entries');}},{enumerable:true});redefine(URLSearchParamsPrototype,ITERATOR,URLSearchParamsPrototype.entries,{name:'entries'});redefine(URLSearchParamsPrototype,'toString',function toString(){var entries=getInternalParamsState(this).entries;var result=[];var index=0;var entry;while(index<entries.length){entry=entries[index++];result.push(serialize(entry.key)+'='+serialize(entry.value));}return result.join('&');},{enumerable:true});setToStringTag(URLSearchParamsConstructor,URL_SEARCH_PARAMS);$({global:true,forced:!USE_NATIVE_URL},{URLSearchParams:URLSearchParamsConstructor});if(!USE_NATIVE_URL&&isCallable(Headers)){var wrapRequestOptions=function(init){if(isObject(init)){var body=init.body;var headers;if(classof(body)===URL_SEARCH_PARAMS){headers=init.headers?new Headers(init.headers):new Headers();if(!headers.has('content-type')){headers.set('content-type','application/x-www-form-urlencoded;charset=UTF-8');}
return create(init,{body:createPropertyDescriptor(0,String(body)),headers:createPropertyDescriptor(0,headers)});}}return init;};if(isCallable(nativeFetch)){$({global:true,enumerable:true,forced:true},{fetch:function fetch(input){return nativeFetch(input,arguments.length>1?wrapRequestOptions(arguments[1]):{});}});}
if(isCallable(NativeRequest)){var RequestConstructor=function Request(input){anInstance(this,RequestConstructor,'Request');return new NativeRequest(input,arguments.length>1?wrapRequestOptions(arguments[1]):{});};RequestPrototype.constructor=RequestConstructor;RequestConstructor.prototype=RequestPrototype;$({global:true,forced:true},{Request:RequestConstructor});}}
module.exports={URLSearchParams:URLSearchParamsConstructor,getState:getInternalParamsState};}),4948:(function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){"use strict";__webpack_require__(5454);var $=__webpack_require__(3085);var DESCRIPTORS=__webpack_require__(69);var USE_NATIVE_URL=__webpack_require__(4551);var global=__webpack_require__(8576);var defineProperties=__webpack_require__(1187);var redefine=__webpack_require__(9482);var anInstance=__webpack_require__(6961);var hasOwn=__webpack_require__(4500);var assign=__webpack_require__(2503);var arrayFrom=__webpack_require__(841);var codeAt=__webpack_require__(863).codeAt;var toASCII=__webpack_require__(7977);var $toString=__webpack_require__(4845);var setToStringTag=__webpack_require__(1284);var URLSearchParamsModule=__webpack_require__(9336);var InternalStateModule=__webpack_require__(3326);var NativeURL=global.URL;var URLSearchParams=URLSearchParamsModule.URLSearchParams;var getInternalSearchParamsState=URLSearchParamsModule.getState;var setInternalState=InternalStateModule.set;var getInternalURLState=InternalStateModule.getterFor('URL');var floor=Math.floor;var pow=Math.pow;var INVALID_AUTHORITY='Invalid authority';var INVALID_SCHEME='Invalid scheme';var INVALID_HOST='Invalid host';var INVALID_PORT='Invalid port';var ALPHA=/[A-Za-z]/;var ALPHANUMERIC=/[\d+-.A-Za-z]/;var DIGIT=/\d/;var HEX_START=/^0x/i;var OCT=/^[0-7]+$/;var DEC=/^\d+$/;var HEX=/^[\dA-Fa-f]+$/;var FORBIDDEN_HOST_CODE_POINT=/[\0\t\n\r #%/:<>?@[\\\]^|]/;var FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT=/[\0\t\n\r #/:<>?@[\\\]^|]/;var LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g;var TAB_AND_NEW_LINE=/[\t\n\r]/g;var EOF;var parseHost=function(url,input){var result,codePoints,index;if(input.charAt(0)=='['){if(input.charAt(input.length-1)!=']')return INVALID_HOST;result=parseIPv6(input.slice(1,-1));if(!result)return INVALID_HOST;url.host=result;}else if(!isSpecial(url)){if(FORBIDDEN_HOST_CODE_POINT_EXCLUDING_PERCENT.test(input))return INVALID_HOST;result='';codePoints=arrayFrom(input);for(index=0;index<codePoints.length;index++){result+=percentEncode(codePoints[index],C0ControlPercentEncodeSet);}
url.host=result;}else{input=toASCII(input);if(FORBIDDEN_HOST_CODE_POINT.test(input))return INVALID_HOST;result=parseIPv4(input);if(result===null)return INVALID_HOST;url.host=result;}};var parseIPv4=function(input){var parts=input.split('.');var partsLength,numbers,index,part,radix,number,ipv4;if(parts.length&&parts[parts.length-1]==''){parts.pop();}
partsLength=parts.length;if(partsLength>4)return input;numbers=[];for(index=0;index<partsLength;index++){part=parts[index];if(part=='')return input;radix=10;if(part.length>1&&part.charAt(0)=='0'){radix=HEX_START.test(part)?16:8;part=part.slice(radix==8?1:2);}
if(part===''){number=0;}else{if(!(radix==10?DEC:radix==8?OCT:HEX).test(part))return input;number=parseInt(part,radix);}
numbers.push(number);}
for(index=0;index<partsLength;index++){number=numbers[index];if(index==partsLength-1){if(number>=pow(256,5-partsLength))return null;}else if(number>255)return null;}
ipv4=numbers.pop();for(index=0;index<numbers.length;index++){ipv4+=numbers[index]*pow(256,3-index);}
return ipv4;};var parseIPv6=function(input){var address=[0,0,0,0,0,0,0,0];var pieceIndex=0;var compress=null;var pointer=0;var value,length,numbersSeen,ipv4Piece,number,swaps,swap;var chr=function(){return input.charAt(pointer);};if(chr()==':'){if(input.charAt(1)!=':')return;pointer+=2;pieceIndex++;compress=pieceIndex;}
while(chr()){if(pieceIndex==8)return;if(chr()==':'){if(compress!==null)return;pointer++;pieceIndex++;compress=pieceIndex;continue;}
value=length=0;while(length<4&&HEX.test(chr())){value=value*16+parseInt(chr(),16);pointer++;length++;}
if(chr()=='.'){if(length==0)return;pointer-=length;if(pieceIndex>6)return;numbersSeen=0;while(chr()){ipv4Piece=null;if(numbersSeen>0){if(chr()=='.'&&numbersSeen<4)pointer++;else return;}
if(!DIGIT.test(chr()))return;while(DIGIT.test(chr())){number=parseInt(chr(),10);if(ipv4Piece===null)ipv4Piece=number;else if(ipv4Piece==0)return;else ipv4Piece=ipv4Piece*10+number;if(ipv4Piece>255)return;pointer++;}
address[pieceIndex]=address[pieceIndex]*256+ipv4Piece;numbersSeen++;if(numbersSeen==2||numbersSeen==4)pieceIndex++;}
if(numbersSeen!=4)return;break;}else if(chr()==':'){pointer++;if(!chr())return;}else if(chr())return;address[pieceIndex++]=value;}
if(compress!==null){swaps=pieceIndex-compress;pieceIndex=7;while(pieceIndex!=0&&swaps>0){swap=address[pieceIndex];address[pieceIndex--]=address[compress+swaps-1];address[compress+--swaps]=swap;}}else if(pieceIndex!=8)return;return address;};var findLongestZeroSequence=function(ipv6){var maxIndex=null;var maxLength=1;var currStart=null;var currLength=0;var index=0;for(;index<8;index++){if(ipv6[index]!==0){if(currLength>maxLength){maxIndex=currStart;maxLength=currLength;}
currStart=null;currLength=0;}else{if(currStart===null)currStart=index;++currLength;}}
if(currLength>maxLength){maxIndex=currStart;maxLength=currLength;}
return maxIndex;};var serializeHost=function(host){var result,index,compress,ignore0;if(typeof host=='number'){result=[];for(index=0;index<4;index++){result.unshift(host%256);host=floor(host/256);}return result.join('.');}else if(typeof host=='object'){result='';compress=findLongestZeroSequence(host);for(index=0;index<8;index++){if(ignore0&&host[index]===0)continue;if(ignore0)ignore0=false;if(compress===index){result+=index?':':'::';ignore0=true;}else{result+=host[index].toString(16);if(index<7)result+=':';}}
return'['+result+']';}return host;};var C0ControlPercentEncodeSet={};var fragmentPercentEncodeSet=assign({},C0ControlPercentEncodeSet,{' ':1,'"':1,'<':1,'>':1,'`':1});var pathPercentEncodeSet=assign({},fragmentPercentEncodeSet,{'#':1,'?':1,'{':1,'}':1});var userinfoPercentEncodeSet=assign({},pathPercentEncodeSet,{'/':1,':':1,';':1,'=':1,'@':1,'[':1,'\\':1,']':1,'^':1,'|':1});var percentEncode=function(chr,set){var code=codeAt(chr,0);return code>0x20&&code<0x7F&&!hasOwn(set,chr)?chr:encodeURIComponent(chr);};var specialSchemes={ftp:21,file:null,http:80,https:443,ws:80,wss:443};var isSpecial=function(url){return hasOwn(specialSchemes,url.scheme);};var includesCredentials=function(url){return url.username!=''||url.password!='';};var cannotHaveUsernamePasswordPort=function(url){return!url.host||url.cannotBeABaseURL||url.scheme=='file';};var isWindowsDriveLetter=function(string,normalized){var second;return string.length==2&&ALPHA.test(string.charAt(0))&&((second=string.charAt(1))==':'||(!normalized&&second=='|'));};var startsWithWindowsDriveLetter=function(string){var third;return string.length>1&&isWindowsDriveLetter(string.slice(0,2))&&(string.length==2||((third=string.charAt(2))==='/'||third==='\\'||third==='?'||third==='#'));};var shortenURLsPath=function(url){var path=url.path;var pathSize=path.length;if(pathSize&&(url.scheme!='file'||pathSize!=1||!isWindowsDriveLetter(path[0],true))){path.pop();}};var isSingleDot=function(segment){return segment==='.'||segment.toLowerCase()==='%2e';};var isDoubleDot=function(segment){segment=segment.toLowerCase();return segment==='..'||segment==='%2e.'||segment==='.%2e'||segment==='%2e%2e';};var SCHEME_START={};var SCHEME={};var NO_SCHEME={};var SPECIAL_RELATIVE_OR_AUTHORITY={};var PATH_OR_AUTHORITY={};var RELATIVE={};var RELATIVE_SLASH={};var SPECIAL_AUTHORITY_SLASHES={};var SPECIAL_AUTHORITY_IGNORE_SLASHES={};var AUTHORITY={};var HOST={};var HOSTNAME={};var PORT={};var FILE={};var FILE_SLASH={};var FILE_HOST={};var PATH_START={};var PATH={};var CANNOT_BE_A_BASE_URL_PATH={};var QUERY={};var FRAGMENT={};var parseURL=function(url,input,stateOverride,base){var state=stateOverride||SCHEME_START;var pointer=0;var buffer='';var seenAt=false;var seenBracket=false;var seenPasswordToken=false;var codePoints,chr,bufferCodePoints,failure;if(!stateOverride){url.scheme='';url.username='';url.password='';url.host=null;url.port=null;url.path=[];url.query=null;url.fragment=null;url.cannotBeABaseURL=false;input=input.replace(LEADING_AND_TRAILING_C0_CONTROL_OR_SPACE,'');}
input=input.replace(TAB_AND_NEW_LINE,'');codePoints=arrayFrom(input);while(pointer<=codePoints.length){chr=codePoints[pointer];switch(state){case SCHEME_START:if(chr&&ALPHA.test(chr)){buffer+=chr.toLowerCase();state=SCHEME;}else if(!stateOverride){state=NO_SCHEME;continue;}else return INVALID_SCHEME;break;case SCHEME:if(chr&&(ALPHANUMERIC.test(chr)||chr=='+'||chr=='-'||chr=='.')){buffer+=chr.toLowerCase();}else if(chr==':'){if(stateOverride&&((isSpecial(url)!=hasOwn(specialSchemes,buffer))||(buffer=='file'&&(includesCredentials(url)||url.port!==null))||(url.scheme=='file'&&!url.host)))return;url.scheme=buffer;if(stateOverride){if(isSpecial(url)&&specialSchemes[url.scheme]==url.port)url.port=null;return;}
buffer='';if(url.scheme=='file'){state=FILE;}else if(isSpecial(url)&&base&&base.scheme==url.scheme){state=SPECIAL_RELATIVE_OR_AUTHORITY;}else if(isSpecial(url)){state=SPECIAL_AUTHORITY_SLASHES;}else if(codePoints[pointer+1]=='/'){state=PATH_OR_AUTHORITY;pointer++;}else{url.cannotBeABaseURL=true;url.path.push('');state=CANNOT_BE_A_BASE_URL_PATH;}}else if(!stateOverride){buffer='';state=NO_SCHEME;pointer=0;continue;}else return INVALID_SCHEME;break;case NO_SCHEME:if(!base||(base.cannotBeABaseURL&&chr!='#'))return INVALID_SCHEME;if(base.cannotBeABaseURL&&chr=='#'){url.scheme=base.scheme;url.path=base.path.slice();url.query=base.query;url.fragment='';url.cannotBeABaseURL=true;state=FRAGMENT;break;}
state=base.scheme=='file'?FILE:RELATIVE;continue;case SPECIAL_RELATIVE_OR_AUTHORITY:if(chr=='/'&&codePoints[pointer+1]=='/'){state=SPECIAL_AUTHORITY_IGNORE_SLASHES;pointer++;}else{state=RELATIVE;continue;}break;case PATH_OR_AUTHORITY:if(chr=='/'){state=AUTHORITY;break;}else{state=PATH;continue;}
case RELATIVE:url.scheme=base.scheme;if(chr==EOF){url.username=base.username;url.password=base.password;url.host=base.host;url.port=base.port;url.path=base.path.slice();url.query=base.query;}else if(chr=='/'||(chr=='\\'&&isSpecial(url))){state=RELATIVE_SLASH;}else if(chr=='?'){url.username=base.username;url.password=base.password;url.host=base.host;url.port=base.port;url.path=base.path.slice();url.query='';state=QUERY;}else if(chr=='#'){url.username=base.username;url.password=base.password;url.host=base.host;url.port=base.port;url.path=base.path.slice();url.query=base.query;url.fragment='';state=FRAGMENT;}else{url.username=base.username;url.password=base.password;url.host=base.host;url.port=base.port;url.path=base.path.slice();url.path.pop();state=PATH;continue;}break;case RELATIVE_SLASH:if(isSpecial(url)&&(chr=='/'||chr=='\\')){state=SPECIAL_AUTHORITY_IGNORE_SLASHES;}else if(chr=='/'){state=AUTHORITY;}else{url.username=base.username;url.password=base.password;url.host=base.host;url.port=base.port;state=PATH;continue;}break;case SPECIAL_AUTHORITY_SLASHES:state=SPECIAL_AUTHORITY_IGNORE_SLASHES;if(chr!='/'||buffer.charAt(pointer+1)!='/')continue;pointer++;break;case SPECIAL_AUTHORITY_IGNORE_SLASHES:if(chr!='/'&&chr!='\\'){state=AUTHORITY;continue;}break;case AUTHORITY:if(chr=='@'){if(seenAt)buffer='%40'+buffer;seenAt=true;bufferCodePoints=arrayFrom(buffer);for(var i=0;i<bufferCodePoints.length;i++){var codePoint=bufferCodePoints[i];if(codePoint==':'&&!seenPasswordToken){seenPasswordToken=true;continue;}
var encodedCodePoints=percentEncode(codePoint,userinfoPercentEncodeSet);if(seenPasswordToken)url.password+=encodedCodePoints;else url.username+=encodedCodePoints;}
buffer='';}else if(chr==EOF||chr=='/'||chr=='?'||chr=='#'||(chr=='\\'&&isSpecial(url))){if(seenAt&&buffer=='')return INVALID_AUTHORITY;pointer-=arrayFrom(buffer).length+1;buffer='';state=HOST;}else buffer+=chr;break;case HOST:case HOSTNAME:if(stateOverride&&url.scheme=='file'){state=FILE_HOST;continue;}else if(chr==':'&&!seenBracket){if(buffer=='')return INVALID_HOST;failure=parseHost(url,buffer);if(failure)return failure;buffer='';state=PORT;if(stateOverride==HOSTNAME)return;}else if(chr==EOF||chr=='/'||chr=='?'||chr=='#'||(chr=='\\'&&isSpecial(url))){if(isSpecial(url)&&buffer=='')return INVALID_HOST;if(stateOverride&&buffer==''&&(includesCredentials(url)||url.port!==null))return;failure=parseHost(url,buffer);if(failure)return failure;buffer='';state=PATH_START;if(stateOverride)return;continue;}else{if(chr=='[')seenBracket=true;else if(chr==']')seenBracket=false;buffer+=chr;}break;case PORT:if(DIGIT.test(chr)){buffer+=chr;}else if(chr==EOF||chr=='/'||chr=='?'||chr=='#'||(chr=='\\'&&isSpecial(url))||stateOverride){if(buffer!=''){var port=parseInt(buffer,10);if(port>0xFFFF)return INVALID_PORT;url.port=(isSpecial(url)&&port===specialSchemes[url.scheme])?null:port;buffer='';}
if(stateOverride)return;state=PATH_START;continue;}else return INVALID_PORT;break;case FILE:url.scheme='file';if(chr=='/'||chr=='\\')state=FILE_SLASH;else if(base&&base.scheme=='file'){if(chr==EOF){url.host=base.host;url.path=base.path.slice();url.query=base.query;}else if(chr=='?'){url.host=base.host;url.path=base.path.slice();url.query='';state=QUERY;}else if(chr=='#'){url.host=base.host;url.path=base.path.slice();url.query=base.query;url.fragment='';state=FRAGMENT;}else{if(!startsWithWindowsDriveLetter(codePoints.slice(pointer).join(''))){url.host=base.host;url.path=base.path.slice();shortenURLsPath(url);}
state=PATH;continue;}}else{state=PATH;continue;}break;case FILE_SLASH:if(chr=='/'||chr=='\\'){state=FILE_HOST;break;}
if(base&&base.scheme=='file'&&!startsWithWindowsDriveLetter(codePoints.slice(pointer).join(''))){if(isWindowsDriveLetter(base.path[0],true))url.path.push(base.path[0]);else url.host=base.host;}
state=PATH;continue;case FILE_HOST:if(chr==EOF||chr=='/'||chr=='\\'||chr=='?'||chr=='#'){if(!stateOverride&&isWindowsDriveLetter(buffer)){state=PATH;}else if(buffer==''){url.host='';if(stateOverride)return;state=PATH_START;}else{failure=parseHost(url,buffer);if(failure)return failure;if(url.host=='localhost')url.host='';if(stateOverride)return;buffer='';state=PATH_START;}continue;}else buffer+=chr;break;case PATH_START:if(isSpecial(url)){state=PATH;if(chr!='/'&&chr!='\\')continue;}else if(!stateOverride&&chr=='?'){url.query='';state=QUERY;}else if(!stateOverride&&chr=='#'){url.fragment='';state=FRAGMENT;}else if(chr!=EOF){state=PATH;if(chr!='/')continue;}break;case PATH:if(chr==EOF||chr=='/'||(chr=='\\'&&isSpecial(url))||(!stateOverride&&(chr=='?'||chr=='#'))){if(isDoubleDot(buffer)){shortenURLsPath(url);if(chr!='/'&&!(chr=='\\'&&isSpecial(url))){url.path.push('');}}else if(isSingleDot(buffer)){if(chr!='/'&&!(chr=='\\'&&isSpecial(url))){url.path.push('');}}else{if(url.scheme=='file'&&!url.path.length&&isWindowsDriveLetter(buffer)){if(url.host)url.host='';buffer=buffer.charAt(0)+':';}
url.path.push(buffer);}
buffer='';if(url.scheme=='file'&&(chr==EOF||chr=='?'||chr=='#')){while(url.path.length>1&&url.path[0]===''){url.path.shift();}}
if(chr=='?'){url.query='';state=QUERY;}else if(chr=='#'){url.fragment='';state=FRAGMENT;}}else{buffer+=percentEncode(chr,pathPercentEncodeSet);}break;case CANNOT_BE_A_BASE_URL_PATH:if(chr=='?'){url.query='';state=QUERY;}else if(chr=='#'){url.fragment='';state=FRAGMENT;}else if(chr!=EOF){url.path[0]+=percentEncode(chr,C0ControlPercentEncodeSet);}break;case QUERY:if(!stateOverride&&chr=='#'){url.fragment='';state=FRAGMENT;}else if(chr!=EOF){if(chr=="'"&&isSpecial(url))url.query+='%27';else if(chr=='#')url.query+='%23';else url.query+=percentEncode(chr,C0ControlPercentEncodeSet);}break;case FRAGMENT:if(chr!=EOF)url.fragment+=percentEncode(chr,fragmentPercentEncodeSet);break;}
pointer++;}};var URLConstructor=function URL(url){var that=anInstance(this,URLConstructor,'URL');var base=arguments.length>1?arguments[1]:undefined;var urlString=$toString(url);var state=setInternalState(that,{type:'URL'});var baseState,failure;if(base!==undefined){if(base instanceof URLConstructor)baseState=getInternalURLState(base);else{failure=parseURL(baseState={},$toString(base));if(failure)throw TypeError(failure);}}
failure=parseURL(state,urlString,null,baseState);if(failure)throw TypeError(failure);var searchParams=state.searchParams=new URLSearchParams();var searchParamsState=getInternalSearchParamsState(searchParams);searchParamsState.updateSearchParams(state.query);searchParamsState.updateURL=function(){state.query=String(searchParams)||null;};if(!DESCRIPTORS){that.href=serializeURL.call(that);that.origin=getOrigin.call(that);that.protocol=getProtocol.call(that);that.username=getUsername.call(that);that.password=getPassword.call(that);that.host=getHost.call(that);that.hostname=getHostname.call(that);that.port=getPort.call(that);that.pathname=getPathname.call(that);that.search=getSearch.call(that);that.searchParams=getSearchParams.call(that);that.hash=getHash.call(that);}};var URLPrototype=URLConstructor.prototype;var serializeURL=function(){var url=getInternalURLState(this);var scheme=url.scheme;var username=url.username;var password=url.password;var host=url.host;var port=url.port;var path=url.path;var query=url.query;var fragment=url.fragment;var output=scheme+':';if(host!==null){output+='//';if(includesCredentials(url)){output+=username+(password?':'+password:'')+'@';}
output+=serializeHost(host);if(port!==null)output+=':'+port;}else if(scheme=='file')output+='//';output+=url.cannotBeABaseURL?path[0]:path.length?'/'+path.join('/'):'';if(query!==null)output+='?'+query;if(fragment!==null)output+='#'+fragment;return output;};var getOrigin=function(){var url=getInternalURLState(this);var scheme=url.scheme;var port=url.port;if(scheme=='blob')try{return new URLConstructor(scheme.path[0]).origin;}catch(error){return'null';}
if(scheme=='file'||!isSpecial(url))return'null';return scheme+'://'+serializeHost(url.host)+(port!==null?':'+port:'');};var getProtocol=function(){return getInternalURLState(this).scheme+':';};var getUsername=function(){return getInternalURLState(this).username;};var getPassword=function(){return getInternalURLState(this).password;};var getHost=function(){var url=getInternalURLState(this);var host=url.host;var port=url.port;return host===null?'':port===null?serializeHost(host):serializeHost(host)+':'+port;};var getHostname=function(){var host=getInternalURLState(this).host;return host===null?'':serializeHost(host);};var getPort=function(){var port=getInternalURLState(this).port;return port===null?'':String(port);};var getPathname=function(){var url=getInternalURLState(this);var path=url.path;return url.cannotBeABaseURL?path[0]:path.length?'/'+path.join('/'):'';};var getSearch=function(){var query=getInternalURLState(this).query;return query?'?'+query:'';};var getSearchParams=function(){return getInternalURLState(this).searchParams;};var getHash=function(){var fragment=getInternalURLState(this).fragment;return fragment?'#'+fragment:'';};var accessorDescriptor=function(getter,setter){return{get:getter,set:setter,configurable:true,enumerable:true};};if(DESCRIPTORS){defineProperties(URLPrototype,{href:accessorDescriptor(serializeURL,function(href){var url=getInternalURLState(this);var urlString=$toString(href);var failure=parseURL(url,urlString);if(failure)throw TypeError(failure);getInternalSearchParamsState(url.searchParams).updateSearchParams(url.query);}),origin:accessorDescriptor(getOrigin),protocol:accessorDescriptor(getProtocol,function(protocol){var url=getInternalURLState(this);parseURL(url,$toString(protocol)+':',SCHEME_START);}),username:accessorDescriptor(getUsername,function(username){var url=getInternalURLState(this);var codePoints=arrayFrom($toString(username));if(cannotHaveUsernamePasswordPort(url))return;url.username='';for(var i=0;i<codePoints.length;i++){url.username+=percentEncode(codePoints[i],userinfoPercentEncodeSet);}}),password:accessorDescriptor(getPassword,function(password){var url=getInternalURLState(this);var codePoints=arrayFrom($toString(password));if(cannotHaveUsernamePasswordPort(url))return;url.password='';for(var i=0;i<codePoints.length;i++){url.password+=percentEncode(codePoints[i],userinfoPercentEncodeSet);}}),host:accessorDescriptor(getHost,function(host){var url=getInternalURLState(this);if(url.cannotBeABaseURL)return;parseURL(url,$toString(host),HOST);}),hostname:accessorDescriptor(getHostname,function(hostname){var url=getInternalURLState(this);if(url.cannotBeABaseURL)return;parseURL(url,$toString(hostname),HOSTNAME);}),port:accessorDescriptor(getPort,function(port){var url=getInternalURLState(this);if(cannotHaveUsernamePasswordPort(url))return;port=$toString(port);if(port=='')url.port=null;else parseURL(url,port,PORT);}),pathname:accessorDescriptor(getPathname,function(pathname){var url=getInternalURLState(this);if(url.cannotBeABaseURL)return;url.path=[];parseURL(url,$toString(pathname),PATH_START);}),search:accessorDescriptor(getSearch,function(search){var url=getInternalURLState(this);search=$toString(search);if(search==''){url.query=null;}else{if('?'==search.charAt(0))search=search.slice(1);url.query='';parseURL(url,search,QUERY);}
getInternalSearchParamsState(url.searchParams).updateSearchParams(url.query);}),searchParams:accessorDescriptor(getSearchParams),hash:accessorDescriptor(getHash,function(hash){var url=getInternalURLState(this);hash=$toString(hash);if(hash==''){url.fragment=null;return;}
if('#'==hash.charAt(0))hash=hash.slice(1);url.fragment='';parseURL(url,hash,FRAGMENT);})});}
redefine(URLPrototype,'toJSON',function toJSON(){return serializeURL.call(this);},{enumerable:true});redefine(URLPrototype,'toString',function toString(){return serializeURL.call(this);},{enumerable:true});if(NativeURL){var nativeCreateObjectURL=NativeURL.createObjectURL;var nativeRevokeObjectURL=NativeURL.revokeObjectURL;if(nativeCreateObjectURL)redefine(URLConstructor,'createObjectURL',function createObjectURL(blob){return nativeCreateObjectURL.apply(NativeURL,arguments);});if(nativeRevokeObjectURL)redefine(URLConstructor,'revokeObjectURL',function revokeObjectURL(url){return nativeRevokeObjectURL.apply(NativeURL,arguments);});}
setToStringTag(URLConstructor,'URL');$({global:true,forced:!USE_NATIVE_URL,sham:!DESCRIPTORS},{URL:URLConstructor});}),9801:(function(){}),3822:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(2221);module.exports=parent;}),1434:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(5078);module.exports=parent;}),6899:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(98);module.exports=parent;}),7710:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(5739);__webpack_require__(162);module.exports=parent;}),4486:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(278);module.exports=parent;}),4877:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(1484);module.exports=parent;}),7178:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(7731);module.exports=parent;}),5603:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(3669);module.exports=parent;}),1206:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(162);var forEach=__webpack_require__(6899);var classof=__webpack_require__(4696);var ArrayPrototype=Array.prototype;var DOMIterables={DOMTokenList:true,NodeList:true};module.exports=function(it){var own=it.forEach;return it===ArrayPrototype||(it instanceof Array&&own===ArrayPrototype.forEach)||DOMIterables.hasOwnProperty(classof(it))?forEach:own;};}),6174:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(2604);module.exports=parent;}),57:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(263);module.exports=parent;}),4741:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(7663);module.exports=parent;}),8368:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(5063);module.exports=parent;}),3739:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(6813);module.exports=parent;}),172:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(6285);module.exports=parent;}),4963:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(3213);module.exports=parent;}),7820:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(3512);module.exports=parent;}),8980:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(8168);module.exports=parent;}),5636:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(8651);module.exports=parent;}),6672:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(3083);module.exports=parent;}),5059:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(2987);module.exports=parent;}),3969:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(2239);module.exports=parent;}),6618:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(3154);__webpack_require__(162);module.exports=parent;}),5279:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(6577);module.exports=parent;}),9562:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(2906);var path=__webpack_require__(7545);module.exports=path.setTimeout;}),2285:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(5008);__webpack_require__(162);module.exports=parent;}),8535:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(994);__webpack_require__(162);module.exports=parent;}),652:(function(module,__unused_webpack_exports,__webpack_require__){var parent=__webpack_require__(5668);module.exports=parent;}),5668:(function(module,__unused_webpack_exports,__webpack_require__){__webpack_require__(4948);__webpack_require__(9801);__webpack_require__(9336);var path=__webpack_require__(7545);module.exports=path.URL;}),2534:(function(module){"use strict";module.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyBkaXNwbGF5PSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMgaWQ9InR1aS1pbWFnZS1lZGl0b3Itc3ZnLWRlZmF1bHQtaWNvbnMiPgo8c3ltYm9sIGlkPSJpYy1hcHBseSIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIHN0cm9rZT0ibm9uZSIgZmlsbD0ibm9uZSIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJpbmhlcml0IiBkPSJNNCAxMi4wMTFsNSA1TDIwLjAxMSA2Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1jYW5jZWwiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiLz4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iaW5oZXJpdCIgZD0iTTYgNmwxMiAxMk0xOCA2TDYgMTgiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWNyb3AiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBzdHJva2U9Im5vbmUiIGZpbGw9Im5vbmUiIC8+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik00IDBoMXYyMGExIDEgMCAwIDEtMS0xVjB6TTIwIDE3aC0xVjVoMXYxMnptMCAydjVoLTF2LTVoMXoiLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTUgMTloMTl2MUg1ek00Ljc2MiA0djFIMFY0aDQuNzYyek03IDRoMTJhMSAxIDAgMCAxIDEgMUg3VjR6Ii8+Cjwvc3ltYm9sPgo8IS0tIFRoaXMgaWNvbiBtYWRlIGJ5IFBpeGVsIHBlcmZlY3QgZnJvbSB3d3cuZmxhdGljb24uY29tIC0tPgo8c3ltYm9sIGlkPSJpYy1yZXNpemUiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgc3Ryb2tlPSJub25lIiBmaWxsPSJub25lIi8+CiAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNIDE4Ljk4ODI4MSAzLjAxMTcxOSBDIDE4LjgwMDc4MSAyLjgyNDIxOSAxOC41IDIuODI0MjE5IDE4LjMxMjUgMy4wMTE3MTkgTCAxMS42MjEwOTQgOS43MDcwMzEgQyAxMS40Mjk2ODggOS44OTQ1MzEgMTEuNDI5Njg4IDEwLjE5NTMxMiAxMS42MjEwOTQgMTAuMzc4OTA2IEMgMTEuNzEwOTM4IDEwLjQ3MjY1NiAxMS44MzU5MzggMTAuNTE5NTMxIDExLjk1NzAzMSAxMC41MTk1MzEgQyAxMi4wNzgxMjUgMTAuNTE5NTMxIDEyLjIwMzEyNSAxMC40NzI2NTYgMTIuMjkyOTY5IDEwLjM3ODkwNiBMIDE4Ljk4ODI4MSAzLjY4NzUgQyAxOS4xNzU3ODEgMy41IDE5LjE3NTc4MSAzLjE5OTIxOSAxOC45ODgyODEgMy4wMTE3MTkgWiBNIDE4Ljk4ODI4MSAzLjAxMTcxOSAiLz4KICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0gMTguNjUyMzQ0IDIuODY3MTg4IEMgMTguMzg2NzE5IDIuODY3MTg4IDE4LjE3MTg3NSAzLjA4MjAzMSAxOC4xNzE4NzUgMy4zNDc2NTYgTCAxOC4xNzE4NzUgOS4wODU5MzggQyAxOC4xNzE4NzUgOS4zNDc2NTYgMTguMzg2NzE5IDkuNTYyNSAxOC42NTIzNDQgOS41NjI1IEMgMTguOTE3OTY5IDkuNTYyNSAxOS4xMzI4MTIgOS4zNDc2NTYgMTkuMTMyODEyIDkuMDg1OTM4IEwgMTkuMTMyODEyIDMuMzQ3NjU2IEMgMTkuMTMyODEyIDMuMDgyMDMxIDE4LjkxNzk2OSAyLjg2NzE4OCAxOC42NTIzNDQgMi44NjcxODggWiBNIDE4LjY1MjM0NCAyLjg2NzE4OCAiLz4KICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0gMTguNjUyMzQ0IDIuODY3MTg4IEwgMTIuOTE0MDYyIDIuODY3MTg4IEMgMTIuNjUyMzQ0IDIuODY3MTg4IDEyLjQzNzUgMy4wODIwMzEgMTIuNDM3NSAzLjM0NzY1NiBDIDEyLjQzNzUgMy42MTMyODEgMTIuNjUyMzQ0IDMuODI4MTI1IDEyLjkxNDA2MiAzLjgyODEyNSBMIDE4LjY1MjM0NCAzLjgyODEyNSBDIDE4LjkxNzk2OSAzLjgyODEyNSAxOS4xMzI4MTIgMy42MTMyODEgMTkuMTMyODEyIDMuMzQ3NjU2IEMgMTkuMTMyODEyIDMuMDgyMDMxIDE4LjkxNzk2OSAyLjg2NzE4OCAxOC42NTIzNDQgMi44NjcxODggWiBNIDE4LjY1MjM0NCAyLjg2NzE4OCAiLz4KICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0gMTAuMzc4OTA2IDExLjYyMTA5NCBDIDEwLjE5NTMxMiAxMS40MzM1OTQgOS44OTA2MjUgMTEuNDMzNTk0IDkuNzAzMTI1IDExLjYyMTA5NCBMIDMuMDA3ODEyIDE4LjMxNjQwNiBDIDIuODIwMzEyIDE4LjUgMi44MjAzMTIgMTguODA0Njg4IDMuMDA3ODEyIDE4Ljk5MjE4OCBDIDMuMTA1NDY5IDE5LjA4NTkzOCAzLjIyNjU2MiAxOS4xMzI4MTIgMy4zNDc2NTYgMTkuMTMyODEyIEMgMy40Njg3NSAxOS4xMzI4MTIgMy41ODk4NDQgMTkuMDg1OTM4IDMuNjgzNTk0IDE4Ljk5MjE4OCBMIDEwLjM3ODkwNiAxMi4yOTY4NzUgQyAxMC41NjY0MDYgMTIuMTA5Mzc1IDEwLjU2NjQwNiAxMS44MDQ2ODggMTAuMzc4OTA2IDExLjYyMTA5NCBaIE0gMTAuMzc4OTA2IDExLjYyMTA5NCAiLz4KICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0gMy4zNDc2NTYgMTIuNDM3NSBDIDMuMDgyMDMxIDEyLjQzNzUgMi44NjcxODggMTIuNjUyMzQ0IDIuODY3MTg4IDEyLjkxNDA2MiBMIDIuODY3MTg4IDE4LjY1MjM0NCBDIDIuODY3MTg4IDE4LjkxNzk2OSAzLjA4MjAzMSAxOS4xMzI4MTIgMy4zNDc2NTYgMTkuMTMyODEyIEMgMy42MTMyODEgMTkuMTMyODEyIDMuODI4MTI1IDE4LjkxNzk2OSAzLjgyODEyNSAxOC42NTIzNDQgTCAzLjgyODEyNSAxMi45MTQwNjIgQyAzLjgyODEyNSAxMi42NTIzNDQgMy42MTMyODEgMTIuNDM3NSAzLjM0NzY1NiAxMi40Mzc1IFogTSAzLjM0NzY1NiAxMi40Mzc1ICIvPgogIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTSA5LjA4NTkzOCAxOC4xNzE4NzUgTCAzLjM0NzY1NiAxOC4xNzE4NzUgQyAzLjA4MjAzMSAxOC4xNzE4NzUgMi44NjcxODggMTguMzg2NzE5IDIuODY3MTg4IDE4LjY1MjM0NCBDIDIuODY3MTg4IDE4LjkxNzk2OSAzLjA4MjAzMSAxOS4xMzI4MTIgMy4zNDc2NTYgMTkuMTMyODEyIEwgOS4wODU5MzggMTkuMTMyODEyIEMgOS4zNDc2NTYgMTkuMTMyODEyIDkuNTYyNSAxOC45MTc5NjkgOS41NjI1IDE4LjY1MjM0NCBDIDkuNTYyNSAxOC4zODY3MTkgOS4zNDc2NTYgMTguMTcxODc1IDkuMDg1OTM4IDE4LjE3MTg3NSBaIE0gOS4wODU5MzggMTguMTcxODc1ICIvPgogIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTSAyMC41NjI1IDAgTCAxLjQzNzUgMCBDIDAuNjQ0NTMxIDAgMCAwLjY0NDUzMSAwIDEuNDM3NSBMIDAgMjAuNTYyNSBDIDAgMjEuMzU1NDY5IDAuNjQ0NTMxIDIyIDEuNDM3NSAyMiBMIDIwLjU2MjUgMjIgQyAyMS4zNTU0NjkgMjIgMjIgMjEuMzU1NDY5IDIyIDIwLjU2MjUgTCAyMiAxLjQzNzUgQyAyMiAwLjY0NDUzMSAyMS4zNTU0NjkgMCAyMC41NjI1IDAgWiBNIDIxLjA0Mjk2OSAyMC41NjI1IEMgMjEuMDQyOTY5IDIwLjgyODEyNSAyMC44MjgxMjUgMjEuMDQyOTY5IDIwLjU2MjUgMjEuMDQyOTY5IEwgMS40Mzc1IDIxLjA0Mjk2OSBDIDEuMTcxODc1IDIxLjA0Mjk2OSAwLjk1NzAzMSAyMC44MjgxMjUgMC45NTcwMzEgMjAuNTYyNSBMIDAuOTU3MDMxIDEuNDM3NSBDIDAuOTU3MDMxIDEuMTcxODc1IDEuMTcxODc1IDAuOTU3MDMxIDEuNDM3NSAwLjk1NzAzMSBMIDIwLjU2MjUgMC45NTcwMzEgQyAyMC44MjgxMjUgMC45NTcwMzEgMjEuMDQyOTY5IDEuMTcxODc1IDIxLjA0Mjk2OSAxLjQzNzUgWiBNIDIxLjA0Mjk2OSAyMC41NjI1ICIvPgo8L3N5bWJvbD4KPCEtLSAgLS0+CjxzeW1ib2wgaWQ9ImljLWRlbGV0ZS1hbGwiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik01IDIzSDNhMSAxIDAgMCAxLTEtMVY2aDF2MTZoMnYxem0xNi0xMGgtMVY2aDF2N3pNOSAxM0g4di0zaDF2M3ptMyAwaC0xdi0zaDF2M3ptMyAwaC0xdi0zaDF2M3pNMTQuNzk0IDMuNzk0TDEzIDJoLTNMOC4yMDYgMy43OTRBLjk2My45NjMgMCAwIDEgOCAyLjVsLjcwMy0xLjA1NUExIDEgMCAwIDEgOS41MzUgMWgzLjkzYTEgMSAwIDAgMSAuODMyLjQ0NUwxNSAyLjVhLjk2NS45NjUgMCAwIDEtLjIwNiAxLjI5NHpNMTQuMTk3IDRIOC44MDNoNS4zOTR6Ii8+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0wIDNoMjN2MUgwek0xMS4yODYgMjFIOC43MTRMOCAyM0g3bDEtMi44VjIwaC4wNzFMOS41IDE2aDFsMS40MjkgNEgxMnYuMmwxIDIuOGgtMWwtLjcxNC0yem0tLjM1Ny0xTDEwIDE3LjQgOS4wNzEgMjBoMS44NTh6TTIwIDIyaDN2MWgtNHYtN2gxdjZ6bS01IDBoM3YxaC00di03aDF2NnoiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWRlbGV0ZSIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTMgNnYxNmgxN1Y2aDF2MTZhMSAxIDAgMCAxLTEgMUgzYTEgMSAwIDAgMS0xLTFWNmgxek0xNC43OTQgMy43OTRMMTMgMmgtM0w4LjIwNiAzLjc5NEEuOTYzLjk2MyAwIDAgMSA4IDIuNWwuNzAzLTEuMDU1QTEgMSAwIDAgMSA5LjUzNSAxaDMuOTNhMSAxIDAgMCAxIC44MzIuNDQ1TDE1IDIuNWEuOTY1Ljk2NSAwIDAgMS0uMjA2IDEuMjk0ek0xNC4xOTcgNEg4LjgwM2g1LjM5NHoiLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTAgM2gyM3YxSDB6TTggMTBoMXY2SDh2LTZ6bTMgMGgxdjZoLTF2LTZ6bTMgMGgxdjZoLTF2LTZ6Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1kcmF3LWZyZWUiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIGQ9Ik0yLjUgMjAuOTI5QzIuNTk0IDEwLjk3NiA0LjMyMyA2IDcuNjg2IDZjNS44NzIgMCAyLjUyNCAxOSA3LjY5NyAxOXMxLjg5LTE0LjkyOSA2LjQxNC0xNC45MjkgMS4zNTcgMTAuODU4IDUuMTMgMTAuODU4YzEuODAyIDAgMi42NTctMi4yNjIgMi41NjYtNi43ODYiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWRyYXctbGluZSIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iaW5oZXJpdCIgZD0iTTIgMTUuNWgyOCIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtZHJhdyIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iaW5oZXJpdCIgZD0iTTIuNSAyMS41SDVjLjI0NSAwIC40OC0uMDU4LjY5MS0uMTY4bC4xMjQtLjA2NS4xNC4wMWMuNDI5LjAyOC44NS0uMTI3IDEuMTYtLjQzN0wyMi41NSA1LjQwNWEuNS41IDAgMCAwIDAtLjcwN2wtMy4yNDYtMy4yNDVhLjUuNSAwIDAgMC0uNzA3IDBMMy4xNjIgMTYuODg4YTEuNDk1IDEuNDk1IDAgMCAwLS40MzcgMS4xNTVsLjAxLjE0LS4wNjUuMTIzYy0uMTExLjIxMi0uMTcuNDQ4LS4xNy42OTR2Mi41eiIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNMTYuNDE0IDMuNzA3bDMuODkgMy44OS0uNzA4LjcwNi0zLjg4OS0zLjg4OXoiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWZpbHRlciIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTEyIDd2MUgyVjdoMTB6bTYgMGg0djFoLTRWN3pNMTIgMTZ2MWgxMHYtMUgxMnptLTYgMEgydjFoNHYtMXoiLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTguNSAyMGEzLjUgMy41IDAgMSAxIDAtNyAzLjUgMy41IDAgMCAxIDAgN3ptMC0xYTIuNSAyLjUgMCAxIDAgMC01IDIuNSAyLjUgMCAwIDAgMCA1ek0xNS41IDExYTMuNSAzLjUgMCAxIDEgMC03IDMuNSAzLjUgMCAwIDEgMCA3em0wLTFhMi41IDIuNSAwIDEgMCAwLTUgMi41IDIuNSAwIDAgMCAwIDV6Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1mbGlwLXJlc2V0IiB2aWV3Qm94PSIwIDAgMzEgMzIiPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBkPSJNMzEgMEgwdjMyaDMxeiIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNMjggMTZhOCA4IDAgMCAxLTggOEgzdi0xaDF2LTdIM2E4IDggMCAwIDEgOC04aDE3djFoLTF2N2gxek0xMSA5YTcgNyAwIDAgMC03IDd2N2gxNmE3IDcgMCAwIDAgNy03VjlIMTF6Ii8+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiIGQ9Ik0yNCA1bDMuNSAzLjVMMjQgMTJNNyAyMGwtMy41IDMuNUw3IDI3Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1mbGlwLXgiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIGQ9Ik0zMiAzMkgwVjBoMzJ6Ii8+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0xNyAzMmgtMVYwaDF6TTI3LjE2NyAxMWwuNSAzaC0xLjAzbC0uNTQ2LTNoMS4wNzZ6bS0uNS0zaC0xLjEyMkwyNSA1aC01VjRoNS4xNTNhMSAxIDAgMCAxIC45ODYuODM2TDI2LjY2NyA4em0xLjUgOWwuNSAzaC0uOTRsLS41NDUtM2guOTg1em0xIDZsLjYzOSAzLjgzNkExIDEgMCAwIDEgMjguODE5IDI4SDI2di0xaDNsLS43MjYtNGguODk0ek0yMyAyOGgtM3YtMWgzdjF6TTEzIDR2MUg3TDMgMjdoMTB2MUgzLjE4YTEgMSAwIDAgMS0uOTg2LTEuMTY0bDMuNjY2LTIyQTEgMSAwIDAgMSA2Ljg0NyA0SDEzeiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtZmxpcC15IiB2aWV3Qm94PSIwIDAgMzIgMzIiPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBkPSJNMCAwdjMyaDMyVjB6Ii8+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0wIDE2djFoMzJ2LTF6TTExIDI3LjE2N2wzIC41di0xLjAzbC0zLS41NDZ2MS4wNzZ6bS0zLS41di0xLjEyMkw1IDI1di01SDR2NS4xNTNhMSAxIDAgMCAwIC44MzYuOTg2TDggMjYuNjY3em05IDEuNWwzIC41di0uOTRsLTMtLjU0NXYuOTg1em02IDFsMy44MzYuNjM5QTEgMSAwIDAgMCAyOCAyOC44MlYyNmgtMXYzbC00LS43Mjd2Ljg5NHpNMjggMjN2LTNoLTF2M2gxek00IDEzaDFWN2wyMi00djEwaDFWMy4xOGExIDEgMCAwIDAtMS4xNjQtLjk4NmwtMjIgMy42NjdBMSAxIDAgMCAwIDQgNi44NDdWMTN6Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1mbGlwIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiAvPgogICAgPHBhdGggZmlsbD0iaW5oZXJpdCIgc3Ryb2tlPSJub25lIiBkPSJNMTEgMGgxdjI0aC0xek0xOSAyMXYtMWgydi0yaDF2MmExIDEgMCAwIDEtMSAxaC0yem0tMiAwaC0zdi0xaDN2MXptNS01aC0xdi0zaDF2M3ptMC01aC0xVjhoMXYzem0wLTVoLTFWNGgtMlYzaDJhMSAxIDAgMCAxIDEgMXYyem0tNS0zdjFoLTNWM2gzek05IDN2MUgydjE2aDd2MUgyYTEgMSAwIDAgMS0xLTFWNGExIDEgMCAwIDEgMS0xaDd6Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1oaXN0b3J5IiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBkPSJNMCAwSDI0VjI0SDB6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNzQwIC0xNikgdHJhbnNsYXRlKDU0NyA4KSB0cmFuc2xhdGUoMTkzIDgpIi8+CiAgICA8cGF0aCBmaWxsPSJpbmhlcml0IiBzdHJva2U9Im5vbmUiIGQ9Ik0xMi41IDFDMTguMjk5IDEgMjMgNS43MDEgMjMgMTEuNVMxOC4yOTkgMjIgMTIuNSAyMmMtNS4yOSAwLTkuNjY1LTMuOTExLTEwLjM5NC04Ljk5OWgxLjAxMkMzLjgzOCAxNy41MzQgNy43NjQgMjEgMTIuNSAyMWM1LjI0NyAwIDkuNS00LjI1MyA5LjUtOS41UzE3Ljc0NyAyIDEyLjUgMkM4LjQ5IDIgNS4wNiA0LjQ4NSAzLjY2NiA4SDNoNHYxSDJWNGgxdjMuMDIyQzQuNjggMy40NjIgOC4zMDMgMSAxMi41IDF6bS41IDVsLS4wMDEgNS4yOTEgMi41MzcgMi41MzctLjcwOC43MDhMMTIuMjkyIDEySDEyVjZoMXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03NDAgLTE2KSB0cmFuc2xhdGUoNTQ3IDgpIHRyYW5zbGF0ZSgxOTMgOCkiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWhpc3RvcnktY2hlY2siIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiID4KICAgICAgICA8cGF0aCBzdHJva2U9IiM1NTU1NTUiIGQ9Ik00LjUgLTFMMS41IDIgNi41IDciIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MCAtODA0KSB0cmFuc2xhdGUoNjAgODA0KSB0cmFuc2xhdGUoMiAzKSByb3RhdGUoLTkwIDQgMykiIC8+CiAgICA8L2c+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1oaXN0b3J5LWNyb3AiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8ZyBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgPgogICAgICAgIDxwYXRoIGQ9Ik0wIDBIMTJWMTJIMHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC04NCAtODA0KSB0cmFuc2xhdGUoODQgODA0KSIvPgogICAgICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik0yIDBoMXYxMGMtLjU1MiAwLTEtLjQ0OC0xLTFWMHpNMTAgOXYzSDlWOWgxek05IDJoMXY2SDlWMnoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC04NCAtODA0KSB0cmFuc2xhdGUoODQgODA0KSIvPgogICAgICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik0yIDlIMTJWMTBIMnpNOSAyYy41MTMgMCAuOTM2LjM4Ni45OTMuODgzTDEwIDNIM1YyaDZ6TTIgM0gwVjJoMnYxeiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTg0IC04MDQpIHRyYW5zbGF0ZSg4NCA4MDQpIi8+CiAgICA8L2c+Cjwvc3ltYm9sPgo8IS0tIFRoaXMgaWNvbiBtYWRlIGJ5IFBpeGVsIHBlcmZlY3QgZnJvbSB3d3cuZmxhdGljb24uY29tIC0tPgo8c3ltYm9sIGlkPSJpYy1oaXN0b3J5LXJlc2l6ZSIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICA8ZyBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgPgogICAgPHBhdGggZmlsbD0iIzQzNDM0MyIgZD0iTSA5LjQ5MjE4OCAxLjUwNzgxMiBDIDkuMzk4NDM4IDEuNDE0MDYyIDkuMjUgMS40MTQwNjIgOS4xNTYyNSAxLjUwNzgxMiBMIDUuODEyNSA0Ljg1MTU2MiBDIDUuNzE0ODQ0IDQuOTQ1MzEyIDUuNzE0ODQ0IDUuMDk3NjU2IDUuODEyNSA1LjE4NzUgQyA1Ljg1NTQ2OSA1LjIzNDM3NSA1LjkxNzk2OSA1LjI1NzgxMiA1Ljk3NjU2MiA1LjI1NzgxMiBDIDYuMDM5MDYyIDUuMjU3ODEyIDYuMTAxNTYyIDUuMjM0Mzc1IDYuMTQ4NDM4IDUuMTg3NSBMIDkuNDkyMTg4IDEuODQzNzUgQyA5LjU4NTkzOCAxLjc1IDkuNTg1OTM4IDEuNjAxNTYyIDkuNDkyMTg4IDEuNTA3ODEyIFogTSA5LjQ5MjE4OCAxLjUwNzgxMiAiLz4KICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik0gOS4zMjgxMjUgMS40MzM1OTQgQyA5LjE5NTMxMiAxLjQzMzU5NCA5LjA4NTkzOCAxLjUzOTA2MiA5LjA4NTkzOCAxLjY3MTg3NSBMIDkuMDg1OTM4IDQuNTQyOTY5IEMgOS4wODU5MzggNC42NzE4NzUgOS4xOTUzMTIgNC43ODEyNSA5LjMyODEyNSA0Ljc4MTI1IEMgOS40NjA5MzggNC43ODEyNSA5LjU2NjQwNiA0LjY3MTg3NSA5LjU2NjQwNiA0LjU0Mjk2OSBMIDkuNTY2NDA2IDEuNjcxODc1IEMgOS41NjY0MDYgMS41MzkwNjIgOS40NjA5MzggMS40MzM1OTQgOS4zMjgxMjUgMS40MzM1OTQgWiBNIDkuMzI4MTI1IDEuNDMzNTk0ICIvPgogICAgPHBhdGggZmlsbD0iIzQzNDM0MyIgZD0iTSA5LjMyODEyNSAxLjQzMzU5NCBMIDYuNDU3MDMxIDEuNDMzNTk0IEMgNi4zMjgxMjUgMS40MzM1OTQgNi4yMTg3NSAxLjUzOTA2MiA2LjIxODc1IDEuNjcxODc1IEMgNi4yMTg3NSAxLjgwNDY4OCA2LjMyODEyNSAxLjkxNDA2MiA2LjQ1NzAzMSAxLjkxNDA2MiBMIDkuMzI4MTI1IDEuOTE0MDYyIEMgOS40NjA5MzggMS45MTQwNjIgOS41NjY0MDYgMS44MDQ2ODggOS41NjY0MDYgMS42NzE4NzUgQyA5LjU2NjQwNiAxLjUzOTA2MiA5LjQ2MDkzOCAxLjQzMzU5NCA5LjMyODEyNSAxLjQzMzU5NCBaIE0gOS4zMjgxMjUgMS40MzM1OTQgIi8+CiAgICA8cGF0aCBmaWxsPSIjNDM0MzQzIiBkPSJNIDUuMTg3NSA1LjgxMjUgQyA1LjA5NzY1NiA1LjcxODc1IDQuOTQ1MzEyIDUuNzE4NzUgNC44NTE1NjIgNS44MTI1IEwgMS41MDM5MDYgOS4xNTYyNSBDIDEuNDEwMTU2IDkuMjUgMS40MTAxNTYgOS40MDIzNDQgMS41MDM5MDYgOS40OTYwOTQgQyAxLjU1NDY4OCA5LjU0Mjk2OSAxLjYxMzI4MSA5LjU2NjQwNiAxLjY3MTg3NSA5LjU2NjQwNiBDIDEuNzM0Mzc1IDkuNTY2NDA2IDEuNzk2ODc1IDkuNTQyOTY5IDEuODQzNzUgOS40OTYwOTQgTCA1LjE4NzUgNi4xNDg0MzggQyA1LjI4MTI1IDYuMDU0Njg4IDUuMjgxMjUgNS45MDIzNDQgNS4xODc1IDUuODEyNSBaIE0gNS4xODc1IDUuODEyNSAiLz4KICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik0gMS42NzE4NzUgNi4yMTg3NSBDIDEuNTM5MDYyIDYuMjE4NzUgMS40MzM1OTQgNi4zMjgxMjUgMS40MzM1OTQgNi40NTcwMzEgTCAxLjQzMzU5NCA5LjMyODEyNSBDIDEuNDMzNTk0IDkuNDYwOTM4IDEuNTM5MDYyIDkuNTY2NDA2IDEuNjcxODc1IDkuNTY2NDA2IEMgMS44MDQ2ODggOS41NjY0MDYgMS45MTQwNjIgOS40NjA5MzggMS45MTQwNjIgOS4zMjgxMjUgTCAxLjkxNDA2MiA2LjQ1NzAzMSBDIDEuOTE0MDYyIDYuMzI4MTI1IDEuODA0Njg4IDYuMjE4NzUgMS42NzE4NzUgNi4yMTg3NSBaIE0gMS42NzE4NzUgNi4yMTg3NSAiLz4KICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik0gNC41NDI5NjkgOS4wODU5MzggTCAxLjY3MTg3NSA5LjA4NTkzOCBDIDEuNTM5MDYyIDkuMDg1OTM4IDEuNDMzNTk0IDkuMTk1MzEyIDEuNDMzNTk0IDkuMzI4MTI1IEMgMS40MzM1OTQgOS40NjA5MzggMS41MzkwNjIgOS41NjY0MDYgMS42NzE4NzUgOS41NjY0MDYgTCA0LjU0Mjk2OSA5LjU2NjQwNiBDIDQuNjcxODc1IDkuNTY2NDA2IDQuNzgxMjUgOS40NjA5MzggNC43ODEyNSA5LjMyODEyNSBDIDQuNzgxMjUgOS4xOTUzMTIgNC42NzE4NzUgOS4wODU5MzggNC41NDI5NjkgOS4wODU5MzggWiBNIDQuNTQyOTY5IDkuMDg1OTM4ICIvPgogICAgPHBhdGggZmlsbD0iIzQzNDM0MyIgZD0iTSAxMC4yODEyNSAwIEwgMC43MTg3NSAwIEMgMC4zMjAzMTIgMCAwIDAuMzIwMzEyIDAgMC43MTg3NSBMIDAgMTAuMjgxMjUgQyAwIDEwLjY3OTY4OCAwLjMyMDMxMiAxMSAwLjcxODc1IDExIEwgMTAuMjgxMjUgMTEgQyAxMC42Nzk2ODggMTEgMTEgMTAuNjc5Njg4IDExIDEwLjI4MTI1IEwgMTEgMC43MTg3NSBDIDExIDAuMzIwMzEyIDEwLjY3OTY4OCAwIDEwLjI4MTI1IDAgWiBNIDEwLjUyMzQzOCAxMC4yODEyNSBDIDEwLjUyMzQzOCAxMC40MTQwNjIgMTAuNDE0MDYyIDEwLjUyMzQzOCAxMC4yODEyNSAxMC41MjM0MzggTCAwLjcxODc1IDEwLjUyMzQzOCBDIDAuNTg1OTM4IDEwLjUyMzQzOCAwLjQ3NjU2MiAxMC40MTQwNjIgMC40NzY1NjIgMTAuMjgxMjUgTCAwLjQ3NjU2MiAwLjcxODc1IEMgMC40NzY1NjIgMC41ODU5MzggMC41ODU5MzggMC40NzY1NjIgMC43MTg3NSAwLjQ3NjU2MiBMIDEwLjI4MTI1IDAuNDc2NTYyIEMgMTAuNDE0MDYyIDAuNDc2NTYyIDEwLjUyMzQzOCAwLjU4NTkzOCAxMC41MjM0MzggMC43MTg3NSBaIE0gMTAuNTIzNDM4IDEwLjI4MTI1ICIvPgogIDwvZz4KPC9zeW1ib2w+CjwhLS0gIC0tPgo8c3ltYm9sIGlkPSJpYy1oaXN0b3J5LWRyYXciIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8ZyBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgPgogICAgICAgIDxwYXRoIGQ9Ik0wIDFIMTJWMTNIMHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNTYgLTgwNCkgdHJhbnNsYXRlKDE1NiA4MDMpIi8+CiAgICAgICAgPHBhdGggc3Ryb2tlPSIjNDM0MzQzIiBkPSJNOS42MjIgMS41ODRsMS44MzUgMS42NTgtOC4zMSA4LjQwN0wuNSAxMi41VjExbDkuMTIyLTkuNDE2eiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE1NiAtODA0KSB0cmFuc2xhdGUoMTU2IDgwMykiLz4KICAgICAgICA8cGF0aCBmaWxsPSIjNDM0MzQzIiBkPSJNNy42MjggMy43NTNMMTAuMzc4IDMuNzUzIDEwLjM3OCA0LjI1MyA3LjYyOCA0LjI1M3oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNTYgLTgwNCkgdHJhbnNsYXRlKDE1NiA4MDMpIHJvdGF0ZSg0NSA5LjAwMyA0LjAwMykiLz4KICAgIDwvZz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWhpc3RvcnktZmlsdGVyIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPGcgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiID4KICAgICAgICA8cGF0aCBkPSJNMCAwSDEyVjEySDB6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjc2IC04MDQpIHRyYW5zbGF0ZSgyNzYgODA0KSIvPgogICAgICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik0xMiAzdjFIOVYzaDN6TTcgNEgwVjNoN3YxeiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI3NiAtODA0KSB0cmFuc2xhdGUoMjc2IDgwNCkiLz4KICAgICAgICA8cGF0aCBmaWxsPSIjNDM0MzQzIiBkPSJNMTIgOHYxSDlWOGgzek03IDlIMFY4aDd2MXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNzYgLTgwNCkgdHJhbnNsYXRlKDI3NiA4MDQpIG1hdHJpeCgtMSAwIDAgMSAxMiAwKSIvPgogICAgICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik04IDFjMS4xMDUgMCAyIC44OTUgMiAycy0uODk1IDItMiAyLTItLjg5NS0yLTIgLjg5NS0yIDItMnptMCAxYy0uNTUyIDAtMSAuNDQ4LTEgMXMuNDQ4IDEgMSAxIDEtLjQ0OCAxLTEtLjQ0OC0xLTEtMXpNNCA3YzEuMTA1IDAgMiAuODk1IDIgMnMtLjg5NSAyLTIgMi0yLS44OTUtMi0yIC44OTUtMiAyLTJ6bTAgMWMtLjU1MiAwLTEgLjQ0OC0xIDFzLjQ0OCAxIDEgMSAxLS40NDggMS0xLS40NDgtMS0xLTF6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjc2IC04MDQpIHRyYW5zbGF0ZSgyNzYgODA0KSIvPgogICAgPC9nPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtaGlzdG9yeS1mbGlwIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPGcgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiID4KICAgICAgICA8cGF0aCBkPSJNMCAwSDEyVjEySDB6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTA4IC04MDQpIHRyYW5zbGF0ZSgxMDggODA0KSIvPgogICAgICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik02IDBMNyAwIDcgMTIgNiAxMnpNMTEgMTBWOWgxdjEuNWMwIC4yNzYtLjIyNC41LS41LjVIMTB2LTFoMXpNNSAxdjFIMXY4aDR2MUguNWMtLjI3NiAwLS41LS4yMjQtLjUtLjV2LTljMC0uMjc2LjIyNC0uNS41LS41SDV6bTcgNXYyaC0xVjZoMXptMC0zdjJoLTFWM2gxek05IDF2MUg3VjFoMnptMi41IDBjLjI3NiAwIC41LjIyNC41LjVWMmgtMlYxaDEuNXpNOSAxMUg3di0xaDJ2MXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMDggLTgwNCkgdHJhbnNsYXRlKDEwOCA4MDQpIi8+CiAgICA8L2c+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1oaXN0b3J5LWljb24iIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8ZyBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgPgogICAgICAgIDxwYXRoIGQ9Ik0wIDBIMTJWMTJIMHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMDQgLTgwNCkgdHJhbnNsYXRlKDIwNCA4MDQpIi8+CiAgICAgICAgPHBhdGggc3Ryb2tlPSIjNDM0MzQzIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMS4xIiBkPSJNNiA5LjU2OEwyLjYwMSAxMSAyLjk3NSA3LjQ2NyAwLjUgNC44MiA0LjEzIDQuMDY4IDYgMSA3Ljg3IDQuMDY4IDExLjUgNC44MiA5LjAyNSA3LjQ2NyA5LjM5OSAxMXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMDQgLTgwNCkgdHJhbnNsYXRlKDIwNCA4MDQpIi8+CiAgICA8L2c+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1oaXN0b3J5LW1hc2siIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8ZyBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNTIgLTgwNCkgdHJhbnNsYXRlKDI1MiA4MDQpIj4KICAgICAgICAgICAgPHBhdGggZD0iTTAgMEgxMlYxMkgweiIvPgogICAgICAgICAgICA8Y2lyY2xlIGN4PSI2IiBjeT0iNiIgcj0iMi41IiBzdHJva2U9IiM0NDQiLz4KICAgICAgICAgICAgPHBhdGggZmlsbD0iIzQzNDM0MyIgZD0iTTExLjUgMGMuMjc2IDAgLjUuMjI0LjUuNXYxMWMwIC4yNzYtLjIyNC41LS41LjVILjVjLS4yNzYgMC0uNS0uMjI0LS41LS41Vi41QzAgLjIyNC4yMjQgMCAuNSAwaDExek0xMSAxSDF2MTBoMTBWMXoiLz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1oaXN0b3J5LXJvdGF0ZSIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxkZWZzPgogICAgICAgIDxwYXRoIGlkPSJyZm40cnlsZmZhIiBkPSJNNyAxMmMtLjMzNSAwLS42NjMtLjAyNS0uOTgzLS4wNzRDMy4xNzEgMTEuNDkyIDEgOS4yMDUgMSA2LjQ0NGMwLTEuMzYzLjUzNC0yLjYxMyAxLjQxNS0zLjU4Ii8+CiAgICAgICAgPG1hc2sgaWQ9IjZmOWduMmR5c2IiIHdpZHRoPSI2IiBoZWlnaHQ9IjkuMTM2IiB4PSIwIiB5PSIwIiBtYXNrVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94Ij4KICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcmZuNHJ5bGZmYSIgc3Ryb2tlPSI0MzQzNDMiLz4KICAgICAgICA8L21hc2s+CiAgICA8L2RlZnM+CiAgICA8ZyBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgPgogICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMzIgLTgwNCkgdHJhbnNsYXRlKDEzMiA4MDQpIj4KICAgICAgICAgICAgPHBhdGggZD0iTTAgMC41SDEyVjEyLjVIMHoiLz4KICAgICAgICAgICAgPHBhdGggZmlsbD0iIzQzNDM0MyIgZD0iTTYuNSAxQzkuNTM4IDEgMTIgMy40NjIgMTIgNi41YzAgMi4zNy0xLjUgNC4zOS0zLjYgNS4xNjNsLS40MDctLjkxNkM5Ljc0NCAxMC4xMyAxMSA4LjQ2MiAxMSA2LjUgMTEgNC4wMTUgOC45ODUgMiA2LjUgMmMtLjc3NyAwLTEuNTA5LjE5Ny0yLjE0Ny41NDRMNCAxLjc1bC0uMjA1LS4wNEM0LjU5NCAxLjI1OCA1LjUxNyAxIDYuNSAxeiIvPgogICAgICAgICAgICA8dXNlIHN0cm9rZT0iIzQzNDM0MyIgc3Ryb2tlLWRhc2hhcnJheT0iMiAxLjI1IiBzdHJva2Utd2lkdGg9IjEiIG1hc2s9InVybCgjNmY5Z24yZHlzYikiIHhsaW5rOmhyZWY9IiNyZm40cnlsZmZhIi8+CiAgICAgICAgICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik00LjI3OSAwTDYgMS43NSA0LjI1IDMuNTcxIDMuNTQzIDIuODY0IDQuNTg2IDEuNzUgMy41NzIgMC43MDd6IiB0cmFuc2Zvcm09Im1hdHJpeCgtMSAwIDAgMSA5LjU0MyAwKSIvPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWhpc3Rvcnktc2hhcGUiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8ZyBmaWxsPSJub25lIiBzdHJva2U9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgPgogICAgICAgIDxwYXRoIGQ9Ik0wIDBIMTJWMTJIMHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xODAgLTgwNCkgdHJhbnNsYXRlKDE4MCA4MDQpIi8+CiAgICAgICAgPHBhdGggZmlsbD0iIzQzNDM0MyIgZD0iTTExLjUgNGMuMjc2IDAgLjUuMjI0LjUuNXY3YzAgLjI3Ni0uMjI0LjUtLjUuNWgtN2MtLjI3NiAwLS41LS4yMjQtLjUtLjVWOC44aDFWMTFoNlY1SDguMzQxbC0uNTY4LTFIMTEuNXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xODAgLTgwNCkgdHJhbnNsYXRlKDE4MCA4MDQpIi8+CiAgICAgICAgPHBhdGggc3Ryb2tlPSIjNDM0MzQzIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik00LjUgMC41TDguNSA3LjYxMSAwLjUgNy42MTF6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTgwIC04MDQpIHRyYW5zbGF0ZSgxODAgODA0KSIvPgogICAgPC9nPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtaGlzdG9yeS10ZXh0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPGcgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiID4KICAgICAgICA8cGF0aCBkPSJNMCAwSDEyVjEySDB6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjI4IC04MDQpIHRyYW5zbGF0ZSgyMjggODA0KSIvPgogICAgICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik0yIDFoOGMuNTUyIDAgMSAuNDQ4IDEgMUgxYzAtLjU1Mi40NDgtMSAxLTF6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjI4IC04MDQpIHRyYW5zbGF0ZSgyMjggODA0KSIvPgogICAgICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik0xIDFIMlYzSDF6TTEwIDFIMTFWM0gxMHpNNS41IDFMNi41IDEgNi41IDExIDUuNSAxMXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMjggLTgwNCkgdHJhbnNsYXRlKDIyOCA4MDQpIi8+CiAgICAgICAgPHBhdGggZmlsbD0iIzQzNDM0MyIgZD0iTTQgMTBIOFYxMUg0eiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIyOCAtODA0KSB0cmFuc2xhdGUoMjI4IDgwNCkiLz4KICAgIDwvZz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWhpc3RvcnktbG9hZCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxnIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8cGF0aCBkPSJNMCAwSDEyVjEySDB6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzI0IC04MDUpIHRyYW5zbGF0ZSgzMjQgODA1KSIvPgogICAgICAgIDxwYXRoIGZpbGw9IiM0MzQzNDMiIGQ9Ik01IDBjLjU1MiAwIDEgLjQ0OCAxIDF2MWg1LjVjLjI3NiAwIC41LjIyNC41LjV2OGMwIC4yNzYtLjIyNC41LS41LjVILjVjLS4yNzYgMC0uNS0uMjI0LS41LS41VjFjMC0uNTUyLjQ0OC0xIDEtMWg0em0wIDFIMXY5aDEwVjNINVYxeiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTMyNCAtODA1KSB0cmFuc2xhdGUoMzI0IDgwNSkiLz4KICAgICAgICA8cGF0aCBmaWxsPSIjNDM0MzQzIiBkPSJNMSAyTDUgMiA1IDMgMSAzeiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTMyNCAtODA1KSB0cmFuc2xhdGUoMzI0IDgwNSkiLz4KICAgIDwvZz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWhpc3RvcnktZGVsZXRlIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPGcgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGZpbGw9IiM0MzQzNDMiPgogICAgICAgICAgICA8cGF0aCBkPSJNMiA5aDhWMWgxdjguNWMwIC4yNzYtLjIyNC41LS41LjVoLTljLS4yNzYgMC0uNS0uMjI0LS41LS41VjFoMXY4ek0wIDBIMTJWMUgweiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTMwMCAtODA0KSB0cmFuc2xhdGUoMzAwIDgwNCkgdHJhbnNsYXRlKDAgMikiLz4KICAgICAgICAgICAgPHBhdGggZD0iTTQgM0g1VjdINHpNNyAzSDhWN0g3eiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTMwMCAtODA0KSB0cmFuc2xhdGUoMzAwIDgwNCkgdHJhbnNsYXRlKDAgMikiLz4KICAgICAgICAgICAgPHBhdGggZD0iTTQgMWg0VjBoMXYxLjVjMCAuMjc2LS4yMjQuNS0uNS41aC01Yy0uMjc2IDAtLjUtLjIyNC0uNS0uNVYwaDF2MXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zMDAgLTgwNCkgdHJhbnNsYXRlKDMwMCA4MDQpIG1hdHJpeCgxIDAgMCAtMSAwIDIpIi8+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtaGlzdG9yeS1ncm91cCIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxnIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMzQ4IC04MDQpIHRyYW5zbGF0ZSgzNDggODA0KSI+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0wIDBIMTJWMTJIMHoiLz4KICAgICAgICAgICAgPHBhdGggZmlsbD0iIzQzNDM0MyIgZD0iTTEgOXYyaDF2MUguNWMtLjI3NiAwLS41LS4yMjQtLjUtLjVWOWgxem0xMSAxdjEuNWMwIC4yNzYtLjIyNC41LS41LjVIOXYtMWgydi0xaDF6bS00IDF2MUg2di0xaDJ6bS0zIDB2MUgzdi0xaDJ6bTctNHYyaC0xVjdoMXpNMSA2djJIMFY2aDF6bTExLTJ2MmgtMVY0aDF6TTEgM3YySDBWM2gxem0xMC41LTNjLjI3NiAwIC41LjIyNC41LjVWM2gtMVYxaC0xVjBoMS41ek02IDB2MUg0VjBoMnptMyAwdjFIN1YwaDJ6TTAgLjVDMCAuMjI0LjIyNCAwIC41IDBIM3YxSDF2MUgwVi41ek05LjUgNGMuMjc2IDAgLjUuMjI0LjUuNXY1YzAgLjI3Ni0uMjI0LjUtLjUuNWgtNWMtLjI3NiAwLS41LS4yMjQtLjUtLjVWOC4zNTVjLjMxNy4wOTQuNjUyLjE0NSAxIC4xNDVWOWg0VjVoLS41YzAtLjM0OC0uMDUtLjY4My0uMTQ1LTFIOS41eiIvPgogICAgICAgICAgICA8Y2lyY2xlIGN4PSI1IiBjeT0iNSIgcj0iMi41IiBzdHJva2U9IiM0MzQzNDMiLz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1pY29uLWFycm93LTIiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTIxLjc5MyAxOC41SDIuNXYtNWgxOC45MzVsLTcuNi04aDUuODcybDEwLjUgMTAuNS0xMC41IDEwLjVoLTUuOTE0bDgtOHoiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWljb24tYXJyb3ctMyIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iaW5oZXJpdCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMjUuMjg4IDE2LjQyTDE0LjIwOCAyNy41SDYuNzkybDExLjI5MS0xMS4yOTFMNi44MjYgNC41aDcuMzgxbDExLjY2MSAxMS42NjEtLjU4LjI1OHoiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWljb24tYXJyb3ciIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIGQ9Ik0yLjUgMTEuNXY5aDE4djUuMjkzTDMwLjI5MyAxNiAyMC41IDYuMjA3VjExLjVoLTE4eiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtaWNvbi1idWJibGUiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTIyLjIwNyAyNC41TDE2LjUgMzAuMjA3VjI0LjVIOEE2LjUgNi41IDAgMCAxIDEuNSAxOFY5QTYuNSA2LjUgMCAwIDEgOCAyLjVoMTZBNi41IDYuNSAwIDAgMSAzMC41IDl2OWE2LjUgNi41IDAgMCAxLTYuNSA2LjVoLTEuNzkzeiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtaWNvbi1oZWFydCIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJpbmhlcml0IiBkPSJNMTUuOTk2IDMwLjY3NWwxLjk4MS0xLjc5YzcuODk4LTcuMTc3IDEwLjM2NS05LjcxOCAxMi4xMzUtMTMuMDEyLjkyMi0xLjcxNiAxLjM3Ny0zLjM3IDEuMzc3LTUuMDc2IDAtNC42NS0zLjY0Ny04LjI5Ny04LjI5Ny04LjI5Ny0yLjMzIDAtNC44NiAxLjUyNy02LjgxNyAzLjgyNGwtLjM4LjQ0Ny0uMzgxLS40NDdDMTMuNjU4IDQuMDI3IDExLjEyNiAyLjUgOC43OTcgMi41IDQuMTQ3IDIuNS41IDYuMTQ3LjUgMTAuNzk3YzAgMS43MTQuNDYgMy4zNzUgMS4zODkgNS4wOTggMS43NzUgMy4yODggNC4yNiA1Ljg0MyAxMi4xMjMgMTIuOTc0bDEuOTg0IDEuODA2eiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtaWNvbi1sb2FkIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJpbmhlcml0IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik0xNy4zMTQgMTguODY3bDEuOTUxLTIuNTMgNCA1LjE4NGgtMTdsNi41LTguODQgNC41NDkgNi4xODZ6Ii8+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0xOC4wMSA0YTExLjc5OCAxMS43OTggMCAwIDAgMCAxSDN2MjRoMjRWMTQuOTg2YTguNzM4IDguNzM4IDAgMCAwIDEgMFYyOWExIDEgMCAwIDEtMSAxSDNhMSAxIDAgMCAxLTEtMVY1YTEgMSAwIDAgMSAxLTFoMTUuMDF6Ii8+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0yNSAzaDF2OWgtMXoiLz4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iaW5oZXJpdCIgZD0iTTIyIDZsMy41LTMuNUwyOSA2Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1pY29uLWxvY2F0aW9uIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJpbmhlcml0IiBkPSJNMTYgMzEuMjhDMjMuNjc1IDIzLjMwMiAyNy41IDE3LjE4MSAyNy41IDEzYzAtNi4zNTEtNS4xNDktMTEuNS0xMS41LTExLjVTNC41IDYuNjQ5IDQuNSAxM2MwIDQuMTgxIDMuODI1IDEwLjMwMiAxMS41IDE4LjI4eiIvPgogICAgPGNpcmNsZSBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIGN4PSIxNiIgY3k9IjEzIiByPSI0LjUiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLWljb24tcG9seWdvbiIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iaW5oZXJpdCIgZD0iTS41NzYgMTZMOC4yOSAyOS41aDE1LjQyTDMxLjQyNCAxNiAyMy43MSAyLjVIOC4yOUwuNTc2IDE2eiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtaWNvbi1zdGFyLTIiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIGQ9Ik0xOS40NDYgMzEuNTkybDIuMjY1LTMuMjcyIDMuOTQ2LjI1LjYzNi0zLjk0IDMuNjY1LTEuNTA1LTEuMTItMy44MzIgMi42NTUtMi45NjItMi42NTYtMi45NjIgMS4xMi0zLjgzMi0zLjY2NC0xLjUwNS0uNjM2LTMuOTQxLTMuOTQ2LjI1LTIuMjY1LTMuMjcxTDE2IDMuMDI0IDEyLjU1NCAxLjA3IDEwLjI4OSA0LjM0bC0zLjk0Ni0uMjUtLjYzNiAzLjk0MS0zLjY2NSAxLjUwNSAxLjEyIDMuODMyTC41MDggMTYuMzNsMi42NTYgMi45NjItMS4xMiAzLjgzMiAzLjY2NCAxLjUwNC42MzYgMy45NDIgMy45NDYtLjI1IDIuMjY1IDMuMjdMMTYgMjkuNjM4bDMuNDQ2IDEuOTU1eiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtaWNvbi1zdGFyIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJpbmhlcml0IiBkPSJNMjUuMjkyIDI5Ljg3OGwtMS43NzUtMTAuMzQ2IDcuNTE3LTcuMzI3LTEwLjM4OC0xLjUxTDE2IDEuMjgybC00LjY0NiA5LjQxMy0xMC4zODggMS41MSA3LjUxNyA3LjMyNy0xLjc3NSAxMC4zNDZMMTYgMjQuOTkzbDkuMjkyIDQuODg1eiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtaWNvbiIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iaW5oZXJpdCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBkPSJNMTEuOTIzIDE5LjEzNkw1LjQyNCAyMmwuNzE1LTcuMDY1LTQuNzMxLTUuMjk2IDYuOTQtMS41MDNMMTEuOTIzIDJsMy41NzQgNi4xMzYgNi45NCAxLjUwMy00LjczMSA1LjI5NkwxOC40MiAyMnoiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLW1hc2stbG9hZCIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0ibm9uZSIgZD0iTTAgMGgzMnYzMkgweiIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNMTguMDEgNGExMS43OTggMTEuNzk4IDAgMCAwIDAgMUgzdjI0aDI0VjE0Ljk4NmE4LjczOCA4LjczOCAwIDAgMCAxIDBWMjlhMSAxIDAgMCAxLTEgMUgzYTEgMSAwIDAgMS0xLTFWNWExIDEgMCAwIDEgMS0xaDE1LjAxek0xNSAyM2E2IDYgMCAxIDEgMC0xMiA2IDYgMCAwIDEgMCAxMnptMC0xYTUgNSAwIDEgMCAwLTEwIDUgNSAwIDAgMCAwIDEweiIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNMjUgM2gxdjloLTF6Ii8+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIGQ9Ik0yMiA2bDMuNS0zLjVMMjkgNiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtbWFzayIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjQuNSIgc3Ryb2tlPSJpbmhlcml0IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0yIDFoMjBhMSAxIDAgMCAxIDEgMXYyMGExIDEgMCAwIDEtMSAxSDJhMSAxIDAgMCAxLTEtMVYyYTEgMSAwIDAgMSAxLTF6bTAgMXYyMGgyMFYySDJ6Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1yZWRvIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgb3BhY2l0eT0iLjUiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTIxIDZIOWE2IDYgMCAxIDAgMCAxMmgxMnYxSDlBNyA3IDAgMCAxIDkgNWgxMnYxeiIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJpbmhlcml0IiBzdHJva2UtbGluZWNhcD0ic3F1YXJlIiBkPSJNMTkgM2wyLjUgMi41TDE5IDgiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLXJlc2V0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgb3BhY2l0eT0iLjUiIHN0cm9rZT0ibm9uZSIgZmlsbD0ibm9uZSIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNMiAxM3YtMWE3IDcgMCAwIDEgNy03aDEzdjFoLTF2NWgxdjFhNyA3IDAgMCAxLTcgN0gydi0xaDF2LTVIMnptNy03YTYgNiAwIDAgMC02IDZ2NmgxMmE2IDYgMCAwIDAgNi02VjZIOXoiLz4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iaW5oZXJpdCIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIgZD0iTTE5IDNsMi41IDIuNUwxOSA4TTUgMTZsLTIuNSAyLjVMNSAyMSIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtcm90YXRlLWNsb2Nrd2lzZSIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTI5IDE3aC0uOTI0YzAgNi42MjctNS4zNzMgMTItMTIgMTItNi42MjggMC0xMi01LjM3My0xMi0xMkM0LjA3NiAxMC4zOTggOS40MDcgNS4wNDEgMTYgNVY0QzguODIgNCAzIDkuODIgMyAxN3M1LjgyIDEzIDEzIDEzIDEzLTUuODIgMTMtMTN6Ii8+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiIGQ9Ik0xNiAxLjVsNCAzLTQgMyIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBmaWxsLXJ1bGU9Im5vbnplcm8iIGQ9Ik0xNiA0aDR2MWgtNHoiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLXJvdGF0ZS1jb3VudGVyY2xvY2t3aXNlIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBkPSJNMyAxN2guOTI0YzAgNi42MjcgNS4zNzMgMTIgMTIgMTIgNi42MjggMCAxMi01LjM3MyAxMi0xMiAwLTYuNjAyLTUuMzMxLTExLjk2LTExLjkyNC0xMlY0YzcuMTggMCAxMyA1LjgyIDEzIDEzcy01LjgyIDEzLTEzIDEzUzMgMjQuMTggMyAxN3oiLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZmlsbC1ydWxlPSJub256ZXJvIiBkPSJNMTIgNGg0djFoLTR6Ii8+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiIGQ9Ik0xNiAxLjVsLTQgMyA0IDMiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLXJvdGF0ZSIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgLz4KICAgIDxwYXRoIGZpbGw9ImluaGVyaXQiIHN0cm9rZT0ibm9uZSIgZD0iTTguMzQ5IDIyLjI1NGExMC4wMDIgMTAuMDAyIDAgMCAxLTIuNzc4LTEuNzE5bC42NS0uNzZhOS4wMDIgOS4wMDIgMCAwIDAgMi40OTUgMS41NDhsLS4zNjcuOTMxem0yLjg3My43MDRsLjA3OC0uOTk3YTkgOSAwIDEgMC0uNTU3LTE3Ljg1MmwtLjE0LS45OUExMC4wNzYgMTAuMDc2IDAgMCAxIDEyLjE0NSAzYzUuNTIzIDAgMTAgNC40NzcgMTAgMTBzLTQuNDc3IDEwLTEwIDEwYy0uMzEyIDAtLjYyLS4wMTQtLjkyNC0uMDQyem0tNy41NTYtNC42NTVhOS45NDIgOS45NDIgMCAwIDEtMS4yNTMtMi45OTZsLjk3My0uMjM0YTguOTQ4IDguOTQ4IDAgMCAwIDEuMTI0IDIuNjkzbC0uODQ0LjUzN3ptLTEuNTAyLTUuOTFBOS45NDkgOS45NDkgMCAwIDEgMi44OCA5LjIzbC45MjUuMzgyYTguOTU0IDguOTU0IDAgMCAwLS42NDQgMi44NDRsLS45OTgtLjA2MnptMi4yMS01LjY4NmMuNjg3LS44NDggMS41MS0xLjU4IDIuNDM2LTIuMTY2bC41MjMuODUyYTkuMDQ4IDkuMDQ4IDAgMCAwLTIuMTg4IDEuOTVsLS43NzEtLjYzNnoiLz4KICAgIDxwYXRoIHN0cm9rZT0iaW5oZXJpdCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIgZD0iTTEzIDFsLTIuNSAyLjVMMTMgNiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtc2hhcGUtY2lyY2xlIiB2aWV3Qm94PSIwIDAgMzIgMzIiPgogICAgPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTQuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJpbmhlcml0Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1zaGFwZS1yZWN0YW5nbGUiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cmVjdCB3aWR0aD0iMjciIGhlaWdodD0iMjciIHg9IjIuNSIgeT0iMi41IiBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIHJ4PSIxIi8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1zaGFwZS10cmlhbmdsZSIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgZD0iTTE2IDIuNWwxNS41IDI3SC41eiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtc2hhcGUiIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0xNC43MDYgOEgyMWExIDEgMCAwIDEgMSAxdjEyYTEgMSAwIDAgMS0xIDFIOWExIDEgMCAwIDEtMS0xdi00aDF2NGgxMlY5aC01LjcwNmwtLjU4OC0xeiIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJpbmhlcml0IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGQ9Ik04LjUgMS41bDcuNSAxM0gxeiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtdGV4dC1hbGlnbi1jZW50ZXIiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9Im5vbmUiIGQ9Ik0wIDBoMzJ2MzJIMHoiLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTIgNWgyOHYxSDJ6TTggMTJoMTZ2MUg4ek0yIDE5aDI4djFIMnpNOCAyNmgxNnYxSDh6Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy10ZXh0LWFsaWduLWxlZnQiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9Im5vbmUiIGQ9Ik0wIDBoMzJ2MzJIMHoiLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTIgNWgyOHYxSDJ6TTIgMTJoMTZ2MUgyek0yIDE5aDI4djFIMnpNMiAyNmgxNnYxSDJ6Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy10ZXh0LWFsaWduLXJpZ2h0IiB2aWV3Qm94PSIwIDAgMzIgMzIiPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJub25lIiBkPSJNMCAwaDMydjMySDB6Ii8+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9ImluaGVyaXQiIGQ9Ik0yIDVoMjh2MUgyek0xNCAxMmgxNnYxSDE0ek0yIDE5aDI4djFIMnpNMTQgMjZoMTZ2MUgxNHoiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLXRleHQtYm9sZCIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgZD0iTTAgMGgzMnYzMkgweiIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNNyAyaDJ2Mkg3ek03IDI4aDJ2Mkg3eiIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJpbmhlcml0IiBzdHJva2Utd2lkdGg9IjIiIGQ9Ik05IDN2MTJoOWE2IDYgMCAxIDAgMC0xMkg5ek05IDE1djE0aDEwYTcgNyAwIDAgMCAwLTE0SDl6Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy10ZXh0LWl0YWxpYyIgdmlld0JveD0iMCAwIDMyIDMyIj4KICAgIDxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgZD0iTTAgMGgzMnYzMkgweiIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNMTUgMmg1djFoLTV6TTExIDI5aDV2MWgtNXpNMTcgM2gxbC00IDI2aC0xeiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtdGV4dC11bmRlcmxpbmUiIHZpZXdCb3g9IjAgMCAzMiAzMiI+CiAgICA8cGF0aCBzdHJva2U9Im5vbmUiIGZpbGw9Im5vbmUiIGQ9Ik0wIDBoMzJ2MzJIMHoiLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTggMnYxNGE4IDggMCAxIDAgMTYgMFYyaDF2MTRhOSA5IDAgMCAxLTE4IDBWMmgxek0zIDI5aDI2djFIM3oiLz4KICAgIDxwYXRoIHN0cm9rZT0ibm9uZSIgZmlsbD0iaW5oZXJpdCIgZD0iTTUgMmg1djFINXpNMjIgMmg1djFoLTV6Ii8+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy10ZXh0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNNCAzaDE1YTEgMSAwIDAgMSAxIDFIM2ExIDEgMCAwIDEgMS0xek0zIDRoMXYxSDN6TTE5IDRoMXYxaC0xeiIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNMTEgM2gxdjE4aC0xeiIvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNMTAgMjBoM3YxaC0zeiIvPgo8L3N5bWJvbD4KPHN5bWJvbCBpZD0iaWMtdW5kbyIgdmlld0JveD0iMCAwIDI0IDI0Ij4KICAgIDxwYXRoIGQ9Ik0yNCAwSDB2MjRoMjR6IiBvcGFjaXR5PSIuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIiAvPgogICAgPHBhdGggc3Ryb2tlPSJub25lIiBmaWxsPSJpbmhlcml0IiBkPSJNMyA2aDEyYTYgNiAwIDEgMSAwIDEySDN2MWgxMmE3IDcgMCAwIDAgMC0xNEgzdjF6Ii8+CiAgICA8cGF0aCBmaWxsPSJub25lIiBzdHJva2U9ImluaGVyaXQiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiIGQ9Ik01IDNMMi41IDUuNSA1IDgiLz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLXpvb20taW4iIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjI5IC0yOTApIHRyYW5zbGF0ZSgyMjkgMjkwKSI+CiAgICAgICAgPGNpcmNsZSBjeD0iMTAuNSIgY3k9IjEwLjUiIHI9IjkiIHN0cm9rZT0iaW5oZXJpdCIgZmlsbD0ibm9uZSIvPgogICAgICAgIDxwYXRoIGZpbGw9ImluaGVyaXQiIGQ9Ik0xOC44MjggMTUuODI4SDE5LjgyOFYyMi44MjhIMTguODI4eiIgdHJhbnNmb3JtPSJyb3RhdGUoLTQ1IDE5LjMyOCAxOS4zMjgpIi8+CiAgICAgICAgPHBhdGggZmlsbD0iaW5oZXJpdCIgZD0iTTcgMTBIMTRWMTFIN3oiLz4KICAgICAgICA8cGF0aCBmaWxsPSJpbmhlcml0IiBkPSJNMTAgN0gxMVYxNEgxMHoiLz4KICAgIDwvZz4KPC9zeW1ib2w+CjxzeW1ib2wgaWQ9ImljLXpvb20tb3V0IiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI2MyAtMjkwKSB0cmFuc2xhdGUoMjYzIDI5MCkiPgogICAgICAgIDxjaXJjbGUgY3g9IjEwLjUiIGN5PSIxMC41IiByPSI5IiBzdHJva2U9ImluaGVyaXQiIGZpbGw9Im5vbmUiLz4KICAgICAgICA8cGF0aCBmaWxsPSJpbmhlcml0IiBkPSJNMTguODI4IDE1LjgyOEgxOS44MjhWMjIuODI4SDE4LjgyOHoiIHRyYW5zZm9ybT0icm90YXRlKC00NSAxOS4zMjggMTkuMzI4KSIvPgogICAgICAgIDxwYXRoIGZpbGw9ImluaGVyaXQiIGQ9Ik03IDEwSDE0VjExSDd6Ii8+CiAgICA8L2c+Cjwvc3ltYm9sPgo8c3ltYm9sIGlkPSJpYy1oYW5kIiB2aWV3Qm94PSIwIDAgMjQgMjQiPgogICAgPGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj4KICAgICAgICA8cGF0aCBmaWxsPSJpbmhlcml0IiBmaWxsLXJ1bGU9Im5vbnplcm8iIGQ9Ik04LjY3MiAzLjM2YzEuMzI4IDAgMi4xMTQuNzggMi4yOSAxLjg2OWwuMDE0LjEwMS4wMjMuMDA2djEuMDQybC0uNjM4LS4xODVjLS4xODctLjA1NS0uMzIzLS4yMTEtLjM1NC0uMzk5TDEwIDUuNzEzYzAtLjgyNS0uNDItMS4zNTMtMS4zMjgtMS4zNTNDNy42OTUgNC4zNiA3IDUuMDQxIDcgNS43MTN2Ny45NDFjMCAuNDM5LS41MjQuNjY1LS44NDMuMzY0bC0xLjg2OC0xLjc2MWMtLjU5NS0uNTI4LTEuMzE2LS42MTctMS45MTgtLjIxNi0uNTIyLjM0OC0uNTYyIDEuMjAzLS4xOCAxLjhMNy43MzggMjJoMTEuMDEzbC4yODUtLjUxOGMxLjI0Ny0yLjMyNiAxLjg5Ny00LjI1OSAxLjk2LTUuNzg1bC4wMDQtLjIzOVY4LjAzNWMwLS42NTYtLjUtMS4xNy0xLTEuMTctLjUwMyAwLTEgLjQ1Ni0xIDEuMTcgMCAuMzMzLS4zMi41NzMtLjY0LjQ4TDE4IDguNDFWNy4zNjhsLjA4Ni4wMjYuMDQyLS4xMzZjLjI3OS0uODA1Ljk3OC0xLjMzMiAxLjczOC0xLjM4OEwyMCA1Ljg2NWMxLjA1NyAwIDIgLjk2NyAyIDIuMTd2Ny40MjNjMCAxLjkyOS0uODQ1IDQuMzUyLTIuNTIxIDcuMjktLjA5LjE1Ni0uMjU1LjI1Mi0uNDM1LjI1Mkg3LjQ3NGMtLjE2NiAwLS4zMjEtLjA4Mi0uNDE0LS4yMTlsLTUuNzA0LTguMzljLS42NTMtMS4wMTktLjU4NC0yLjQ4Ni40Ni0zLjE4MiAxLS42NjYgMi4yMTYtLjUxNiAzLjE0OC4zMUw2IDEyLjQ5NVY1LjcxM2MwLTEuMTggMS4wNTgtMi4yNjMgMi40OS0yLjM0OHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yOTcgLTI5MCkgdHJhbnNsYXRlKDI5NyAyOTApIi8+CiAgICAgICAgPHBhdGggZmlsbD0iaW5oZXJpdCIgZmlsbC1ydWxlPSJub256ZXJvIiBkPSJNMTIuNSAxLjVjMS4zMjUgMCAyLjQxIDEuMDMyIDIuNDk1IDIuMzM2TDE1IDR2Ny4yMmgtMVY0YzAtLjgyOC0uNjcyLTEuNS0xLjUtMS41LS43OCAwLTEuNDIuNTk1LTEuNDkzIDEuMzU2TDExIDR2Ny4yMmgtMVY0YzAtMS4zOCAxLjEyLTIuNSAyLjUtMi41eiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI5NyAtMjkwKSB0cmFuc2xhdGUoMjk3IDI5MCkiLz4KICAgICAgICA8cGF0aCBmaWxsPSJpbmhlcml0IiBmaWxsLXJ1bGU9Im5vbnplcm8iIGQ9Ik0xNi41IDMuNWMxLjMyNSAwIDIuNDEgMS4wMzIgMi40OTUgMi4zMzZMMTkgNnY2LjNoLTFWNmMwLS44MjgtLjY3Mi0xLjUtMS41LTEuNS0uNzggMC0xLjQyLjU5NS0xLjQ5MyAxLjM1NkwxNSA2djIuNDRoLTFWNmMwLTEuMzggMS4xMi0yLjUgMi41LTIuNXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yOTcgLTI5MCkgdHJhbnNsYXRlKDI5NyAyOTApIi8+CiAgICA8L2c+Cjwvc3ltYm9sPgo8L2RlZnM+Cjwvc3ZnPgo=";}),4858:(function(module){"use strict";module.exports=__WEBPACK_EXTERNAL_MODULE__4858__;}),4960:(function(){}),6759:(function(){}),6272:(function(){})});var __webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==undefined){return cachedModule.exports;}
var module=__webpack_module_cache__[moduleId]={exports:{}};__webpack_modules__[moduleId](module,module.exports,__webpack_require__);return module.exports;}
!function(){__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module['default'];}:function(){return module;};__webpack_require__.d(getter,{a:getter});return getter;};}();!function(){__webpack_require__.d=function(exports,definition){for(var key in definition){if(__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)){Object.defineProperty(exports,key,{enumerable:true,get:definition[key]});}}};}();!function(){__webpack_require__.g=(function(){if(typeof globalThis==='object')return globalThis;try{return this||new Function('return this')();}catch(e){if(typeof window==='object')return window;}})();}();!function(){__webpack_require__.o=function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop);}}();var __webpack_exports__={};!function(){"use strict";__webpack_require__.d(__webpack_exports__,{"default":function(){return src;}});var trim=__webpack_require__(9131);var trim_default=__webpack_require__.n(trim);var index_of=__webpack_require__(1899);var index_of_default=__webpack_require__.n(index_of);var splice=__webpack_require__(6562);var splice_default=__webpack_require__.n(splice);var define_property=__webpack_require__(1734);var define_property_default=__webpack_require__.n(define_property);var slice=__webpack_require__(8005);var slice_default=__webpack_require__.n(slice);var create=__webpack_require__(6065);var create_default=__webpack_require__.n(create);var set_timeout=__webpack_require__(4496);var set_timeout_default=__webpack_require__.n(set_timeout);;if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;}
if(!Element.prototype.closest){Element.prototype.closest=function(s){var el=this;do{if(Element.prototype.matches.call(el,s))return el;el=el.parentElement||el.parentNode;}while(el!==null&&el.nodeType===1);return null;};}
if('document'in self){if(!('classList'in document.createElement('_'))||document.createElementNS&&!('classList'in document.createElementNS('http://www.w3.org/2000/svg','g'))){(function(view){'use strict';if(!('Element'in view))return;var classListProp='classList',protoProp='prototype',elemCtrProto=view.Element[protoProp],objCtr=Object,strTrim=trim_default()(String[protoProp])||function(){return this.replace(/^\s+|\s+$/g,'');},arrIndexOf=index_of_default()(Array[protoProp])||function(item){var i=0,len=this.length;for(;i<len;i++){if(i in this&&this[i]===item){return i;}}
return-1;},DOMEx=function DOMEx(type,message){this.name=type;this.code=DOMException[type];this.message=message;},checkTokenAndGetIndex=function checkTokenAndGetIndex(classList,token){if(token===''){throw new DOMEx('SYNTAX_ERR','The token must not be empty.');}
if(/\s/.test(token)){throw new DOMEx('INVALID_CHARACTER_ERR','The token must not contain space characters.');}
return arrIndexOf.call(classList,token);},ClassList=function ClassList(elem){var trimmedClasses=strTrim.call(elem.getAttribute('class')||''),classes=trimmedClasses?trimmedClasses.split(/\s+/):[],i=0,len=classes.length;for(;i<len;i++){this.push(classes[i]);}
this._updateClassName=function(){elem.setAttribute('class',this.toString());};},classListProto=ClassList[protoProp]=[],classListGetter=function classListGetter(){return new ClassList(this);};DOMEx[protoProp]=Error[protoProp];classListProto.item=function(i){return this[i]||null;};classListProto.contains=function(token){return~checkTokenAndGetIndex(this,token+'');};classListProto.add=function(){var tokens=arguments,i=0,l=tokens.length,token,updated=false;do{token=tokens[i]+'';if(!~checkTokenAndGetIndex(this,token)){this.push(token);updated=true;}}while(++i<l);if(updated){this._updateClassName();}};classListProto.remove=function(){var tokens=arguments,i=0,l=tokens.length,token,updated=false,index;do{token=tokens[i]+'';index=checkTokenAndGetIndex(this,token);while(~index){var _context;splice_default()(_context=this).call(_context,index,1);updated=true;index=checkTokenAndGetIndex(this,token);}}while(++i<l);if(updated){this._updateClassName();}};classListProto.toggle=function(token,force){var result=this.contains(token),method=result?force!==true&&'remove':force!==false&&'add';if(method){this[method](token);}
if(force===true||force===false){return force;}else{return!result;}};classListProto.replace=function(token,replacement_token){var index=checkTokenAndGetIndex(token+'');if(~index){var _context2;splice_default()(_context2=this).call(_context2,index,1,replacement_token);this._updateClassName();}};classListProto.toString=function(){return this.join(' ');};if((define_property_default())){var classListPropDesc={get:classListGetter,enumerable:true,configurable:true};try{define_property_default()(elemCtrProto,classListProp,classListPropDesc);}catch(ex){if(ex.number===undefined||ex.number===-0x7ff5ec54){classListPropDesc.enumerable=false;define_property_default()(elemCtrProto,classListProp,classListPropDesc);}}}else if(objCtr[protoProp].__defineGetter__){elemCtrProto.__defineGetter__(classListProp,classListGetter);}})(self);}
(function(){'use strict';var testElement=document.createElement('_');testElement.classList.add('c1','c2');if(!testElement.classList.contains('c2')){var createMethod=function createMethod(method){var original=DOMTokenList.prototype[method];DOMTokenList.prototype[method]=function(token){var i,len=arguments.length;for(i=0;i<len;i++){token=arguments[i];original.call(this,token);}};};createMethod('add');createMethod('remove');}
testElement.classList.toggle('c3',false);if(testElement.classList.contains('c3')){var _toggle=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(token,force){if(1 in arguments&&!this.contains(token)===!force){return force;}else{return _toggle.call(this,token);}};}
if(!('replace'in document.createElement('_').classList)){DOMTokenList.prototype.replace=function(token,replacement_token){var tokens=this.toString().split(' '),index=index_of_default()(tokens).call(tokens,token+'');if(~index){tokens=slice_default()(tokens).call(tokens,index);this.remove.apply(this,tokens);this.add(replacement_token);this.add.apply(this,slice_default()(tokens).call(tokens,1));}};}
testElement=null;})();}
(function(){'use strict';if(typeof window!=='undefined'&&window.addEventListener){var cache=create_default()(null);var checkUseElems;var tid;var debouncedCheck=function debouncedCheck(){clearTimeout(tid);tid=set_timeout_default()(checkUseElems,100);};var unobserveChanges=function unobserveChanges(){return;};var observeChanges=function observeChanges(){var observer;window.addEventListener('resize',debouncedCheck,false);window.addEventListener('orientationchange',debouncedCheck,false);if(window.MutationObserver){observer=new MutationObserver(debouncedCheck);observer.observe(document.documentElement,{childList:true,subtree:true,attributes:true});unobserveChanges=function unobserveChanges(){try{observer.disconnect();window.removeEventListener('resize',debouncedCheck,false);window.removeEventListener('orientationchange',debouncedCheck,false);}catch(ignore){}};}else{document.documentElement.addEventListener('DOMSubtreeModified',debouncedCheck,false);unobserveChanges=function unobserveChanges(){document.documentElement.removeEventListener('DOMSubtreeModified',debouncedCheck,false);window.removeEventListener('resize',debouncedCheck,false);window.removeEventListener('orientationchange',debouncedCheck,false);};}};var createRequest=function createRequest(url){function getOrigin(loc){var a;if(loc.protocol!==undefined){a=loc;}else{a=document.createElement('a');a.href=loc;}
return a.protocol.replace(/:/g,'')+a.host;}
var Request;var origin;var origin2;if(window.XMLHttpRequest){Request=new XMLHttpRequest();origin=getOrigin(location);origin2=getOrigin(url);if(Request.withCredentials===undefined&&origin2!==''&&origin2!==origin){Request=XDomainRequest||undefined;}else{Request=XMLHttpRequest;}}
return Request;};var xlinkNS='http://www.w3.org/1999/xlink';checkUseElems=function checkUseElems(){var base;var bcr;var fallback='';var hash;var href;var i;var inProgressCount=0;var isHidden;var Request;var url;var uses;var xhr;function observeIfDone(){inProgressCount-=1;if(inProgressCount===0){unobserveChanges();observeChanges();}}
function attrUpdateFunc(spec){return function(){if(cache[spec.base]!==true){spec.useEl.setAttributeNS(xlinkNS,'xlink:href','#'+spec.hash);if(spec.useEl.hasAttribute('href')){spec.useEl.setAttribute('href','#'+spec.hash);}}};}
function onloadFunc(xhr){return function(){var body=document.body;var x=document.createElement('x');var svg;xhr.onload=null;x.innerHTML=xhr.responseText;svg=x.getElementsByTagName('svg')[0];if(svg){svg.setAttribute('aria-hidden','true');svg.style.position='absolute';svg.style.width=0;svg.style.height=0;svg.style.overflow='hidden';body.insertBefore(svg,body.firstChild);}
observeIfDone();};}
function onErrorTimeout(xhr){return function(){xhr.onerror=null;xhr.ontimeout=null;observeIfDone();};}
unobserveChanges();uses=document.getElementsByTagName('use');for(i=0;i<uses.length;i+=1){try{bcr=uses[i].getBoundingClientRect();}catch(ignore){bcr=false;}
href=uses[i].getAttribute('href')||uses[i].getAttributeNS(xlinkNS,'href')||uses[i].getAttribute('xlink:href');if(href&&href.split){url=href.split('#');}else{url=['',''];}
base=url[0];hash=url[1];isHidden=bcr&&bcr.left===0&&bcr.right===0&&bcr.top===0&&bcr.bottom===0;if(bcr&&bcr.width===0&&bcr.height===0&&!isHidden){if(fallback&&!base.length&&hash&&!document.getElementById(hash)){base=fallback;}
if(uses[i].hasAttribute('href')){uses[i].setAttributeNS(xlinkNS,'xlink:href',href);}
if(base.length){xhr=cache[base];if(xhr!==true){set_timeout_default()(attrUpdateFunc({useEl:uses[i],base:base,hash:hash}),0);}
if(xhr===undefined){Request=createRequest(base);if(Request!==undefined){xhr=new Request();cache[base]=xhr;xhr.onload=onloadFunc(xhr);xhr.onerror=onErrorTimeout(xhr);xhr.ontimeout=onErrorTimeout(xhr);xhr.open('GET',base);xhr.send();inProgressCount+=1;}}}}else{if(!isHidden){if(cache[base]===undefined){cache[base]=true;}else if(cache[base].onload){cache[base].abort();delete cache[base].onload;cache[base]=true;}}else if(base.length&&cache[base]){set_timeout_default()(attrUpdateFunc({useEl:uses[i],base:base,hash:hash}),0);}}}
uses='';inProgressCount+=1;observeIfDone();};var _winLoad;_winLoad=function winLoad(){window.removeEventListener('load',_winLoad,false);tid=set_timeout_default()(checkUseElems,0);};if(document.readyState!=='complete'){window.addEventListener('load',_winLoad,false);}else{_winLoad();}}})();var is_array=__webpack_require__(1845);;function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}
return arr2;};function _arrayWithoutHoles(arr){if(is_array(arr))return _arrayLikeToArray(arr);}
var symbol=__webpack_require__(184);var get_iterator_method=__webpack_require__(662);var from=__webpack_require__(7172);;function _iterableToArray(iter){if(typeof symbol!=="undefined"&&get_iterator_method(iter)!=null||iter["@@iterator"]!=null)return from(iter);}
var instance_slice=__webpack_require__(711);;function _unsupportedIterableToArray(o,minLen){var _context;if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=instance_slice(_context=Object.prototype.toString.call(o)).call(_context,8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);};function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");};function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}
var object_define_property=__webpack_require__(7077);;function _defineProperty(obj,key,value){if(key in obj){object_define_property(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}
return obj;};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}};function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;object_define_property(target,descriptor.key,descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}
var bind=__webpack_require__(4426);var bind_default=__webpack_require__.n(bind);var concat=__webpack_require__(9406);var concat_default=__webpack_require__.n(concat);var core_js_stable_promise=__webpack_require__(8189);var promise_default=__webpack_require__.n(core_js_stable_promise);var url=__webpack_require__(3972);var url_default=__webpack_require__.n(url);var fabric=__webpack_require__(2777);var extend=__webpack_require__(961);var extend_default=__webpack_require__.n(extend);var type_isUndefined=__webpack_require__(5695);var isUndefined_default=__webpack_require__.n(type_isUndefined);var collection_forEach=__webpack_require__(8592);var forEach_default=__webpack_require__.n(collection_forEach);var customEvents=__webpack_require__(9052);var customEvents_default=__webpack_require__.n(customEvents);var isString=__webpack_require__(2560);var isString_default=__webpack_require__.n(isString);var keys=__webpack_require__(2461);var keys_default=__webpack_require__.n(keys);;function _arrayWithHoles(arr){if(is_array(arr))return arr;};function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof symbol!=="undefined"&&get_iterator_method(arr)||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}
return _arr;};function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");};function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}
var parse_int=__webpack_require__(6397);var parse_int_default=__webpack_require__.n(parse_int);var for_each=__webpack_require__(7636);var for_each_default=__webpack_require__.n(for_each);var instance_fill=__webpack_require__(789);var fill_default=__webpack_require__.n(instance_fill);var sendHostname=__webpack_require__(4729);var sendHostname_default=__webpack_require__.n(sendHostname);var pick=__webpack_require__(1610);var pick_default=__webpack_require__.n(pick);var inArray=__webpack_require__(3053);var inArray_default=__webpack_require__.n(inArray);;var _context;var ZOOM_HELP_MENUS=['zoomIn','zoomOut','hand'];var COMMAND_HELP_MENUS=['history','undo','redo','reset'];var DELETE_HELP_MENUS=['delete','deleteAll'];var HELP_MENUS=concat_default()(_context=[]).call(_context,ZOOM_HELP_MENUS,COMMAND_HELP_MENUS,DELETE_HELP_MENUS);var SHAPE_FILL_TYPE={FILTER:'filter',COLOR:'color'};var SHAPE_TYPE=['rect','circle','triangle'];var OBJ_TYPE={CROPZONE:'cropzone'};var filterType={VINTAGE:'vintage',SEPIA2:'sepia2',REMOVE_COLOR:'removeColor',COLOR_FILTER:'colorFilter',REMOVE_WHITE:'removeWhite',BLEND_COLOR:'blendColor',BLEND:'blend'};var componentNames=keyMirror('IMAGE_LOADER','CROPPER','FLIP','ROTATION','FREE_DRAWING','LINE','TEXT','ICON','FILTER','SHAPE','ZOOM','RESIZE');var SHAPE_DEFAULT_OPTIONS={lockSkewingX:true,lockSkewingY:true,bringForward:true,isRegular:false};var CROPZONE_DEFAULT_OPTIONS={hasRotatingPoint:false,hasBorders:false,lockScalingFlip:true,lockRotation:true,lockSkewingX:true,lockSkewingY:true};var commandNames={CLEAR_OBJECTS:'clearObjects',LOAD_IMAGE:'loadImage',FLIP_IMAGE:'flip',ROTATE_IMAGE:'rotate',ADD_OBJECT:'addObject',REMOVE_OBJECT:'removeObject',APPLY_FILTER:'applyFilter',REMOVE_FILTER:'removeFilter',ADD_ICON:'addIcon',CHANGE_ICON_COLOR:'changeIconColor',ADD_SHAPE:'addShape',CHANGE_SHAPE:'changeShape',ADD_TEXT:'addText',CHANGE_TEXT:'changeText',CHANGE_TEXT_STYLE:'changeTextStyle',ADD_IMAGE_OBJECT:'addImageObject',RESIZE_CANVAS_DIMENSION:'resizeCanvasDimension',SET_OBJECT_PROPERTIES:'setObjectProperties',SET_OBJECT_POSITION:'setObjectPosition',CHANGE_SELECTION:'changeSelection',RESIZE_IMAGE:'resize'};var eventNames={OBJECT_ACTIVATED:'objectActivated',OBJECT_MOVED:'objectMoved',OBJECT_SCALED:'objectScaled',OBJECT_CREATED:'objectCreated',OBJECT_ROTATED:'objectRotated',OBJECT_ADDED:'objectAdded',OBJECT_MODIFIED:'objectModified',TEXT_EDITING:'textEditing',TEXT_CHANGED:'textChanged',ICON_CREATE_RESIZE:'iconCreateResize',ICON_CREATE_END:'iconCreateEnd',ADD_TEXT:'addText',ADD_OBJECT:'addObject',ADD_OBJECT_AFTER:'addObjectAfter',MOUSE_DOWN:'mousedown',MOUSE_UP:'mouseup',MOUSE_MOVE:'mousemove',REDO_STACK_CHANGED:'redoStackChanged',UNDO_STACK_CHANGED:'undoStackChanged',SELECTION_CLEARED:'selectionCleared',SELECTION_CREATED:'selectionCreated',EXECUTE_COMMAND:'executeCommand',AFTER_UNDO:'afterUndo',AFTER_REDO:'afterRedo',ZOOM_CHANGED:'zoomChanged',HAND_STARTED:'handStarted',HAND_STOPPED:'handStopped',KEY_DOWN:'keydown',KEY_UP:'keyup',INPUT_BOX_EDITING_STARTED:'inputBoxEditingStarted',INPUT_BOX_EDITING_STOPPED:'inputBoxEditingStopped',FOCUS:'focus',BLUR:'blur',IMAGE_RESIZED:'imageResized'};var selectorNames={COLOR_PICKER_INPUT_BOX:'.tui-colorpicker-palette-hex'};var historyNames={LOAD_IMAGE:'Load',LOAD_MASK_IMAGE:'Mask',ADD_MASK_IMAGE:'Mask',ADD_IMAGE_OBJECT:'Mask',CROP:'Crop',RESIZE:'Resize',APPLY_FILTER:'Filter',REMOVE_FILTER:'Filter',CHANGE_SHAPE:'Shape',CHANGE_ICON_COLOR:'Icon',ADD_TEXT:'Text',CHANGE_TEXT_STYLE:'Text',REMOVE_OBJECT:'Delete',CLEAR_OBJECTS:'Delete'};var drawingModes=keyMirror('NORMAL','CROPPER','FREE_DRAWING','LINE_DRAWING','TEXT','SHAPE','ICON','ZOOM','RESIZE');var drawingMenuNames={TEXT:'text',CROP:'crop',RESIZE:'resize',SHAPE:'shape',ZOOM:'zoom'};var zoomModes={DEFAULT:'normal',ZOOM:'zoom',HAND:'hand'};var keyCodes={Z:90,Y:89,C:67,V:86,SHIFT:16,BACKSPACE:8,DEL:46,ARROW_DOWN:40,ARROW_UP:38,SPACE:32,DIGIT_0:48,DIGIT_9:57};var fObjectOptions={SELECTION_STYLE:{borderColor:'red',cornerColor:'green',cornerSize:10,originX:'center',originY:'center',transparentCorners:false}};var rejectMessages={addedObject:'The object is already added.',flip:'The flipX and flipY setting values are not changed.',invalidDrawingMode:'This operation is not supported in the drawing mode.',invalidParameters:'Invalid parameters.',isLock:'The executing command state is locked.',loadImage:'The background image is empty.',loadingImageFailed:'Invalid image loaded.',noActiveObject:'There is no active object.',noObject:'The object is not in canvas.',redo:'The promise of redo command is reject.',rotation:'The current angle is same the old angle.',undo:'The promise of undo command is reject.',unsupportedOperation:'Unsupported operation.',unsupportedType:'Unsupported object type.'};var defaultIconPath={'icon-arrow':'M40 12V0l24 24-24 24V36H0V12h40z','icon-arrow-2':'M49,32 H3 V22 h46 l-18,-18 h12 l23,23 L43,50 h-12 l18,-18  z ','icon-arrow-3':'M43.349998,27 L17.354,53 H1.949999 l25.996,-26 L1.949999,1 h15.404 L43.349998,27  z ','icon-star':'M35,54.557999 l-19.912001,10.468 l3.804,-22.172001 l-16.108,-15.7 l22.26,-3.236 L35,3.746 l9.956,20.172001 l22.26,3.236 l-16.108,15.7 l3.804,22.172001  z ','icon-star-2':'M17,31.212 l-7.194,4.08 l-4.728,-6.83 l-8.234,0.524 l-1.328,-8.226 l-7.644,-3.14 l2.338,-7.992 l-5.54,-6.18 l5.54,-6.176 l-2.338,-7.994 l7.644,-3.138 l1.328,-8.226 l8.234,0.522 l4.728,-6.83 L17,-24.312 l7.194,-4.08 l4.728,6.83 l8.234,-0.522 l1.328,8.226 l7.644,3.14 l-2.338,7.992 l5.54,6.178 l-5.54,6.178 l2.338,7.992 l-7.644,3.14 l-1.328,8.226 l-8.234,-0.524 l-4.728,6.83  z ','icon-polygon':'M3,31 L19,3 h32 l16,28 l-16,28 H19  z ','icon-location':'M24 62C8 45.503 0 32.837 0 24 0 10.745 10.745 0 24 0s24 10.745 24 24c0 8.837-8 21.503-24 38zm0-28c5.523 0 10-4.477 10-10s-4.477-10-10-10-10 4.477-10 10 4.477 10 10 10z','icon-heart':'M49.994999,91.349998 l-6.96,-6.333 C18.324001,62.606995 2.01,47.829002 2.01,29.690998 C2.01,14.912998 13.619999,3.299999 28.401001,3.299999 c8.349,0 16.362,5.859 21.594,12 c5.229,-6.141 13.242001,-12 21.591,-12 c14.778,0 26.390999,11.61 26.390999,26.390999 c0,18.138 -16.314001,32.916 -41.025002,55.374001 l-6.96,6.285  z ','icon-bubble':'M44 48L34 58V48H12C5.373 48 0 42.627 0 36V12C0 5.373 5.373 0 12 0h40c6.627 0 12 5.373 12 12v24c0 6.627-5.373 12-12 12h-8z'};var defaultRotateRangeValues={realTimeEvent:true,min:-360,max:360,value:0};var defaultDrawRangeValues={min:5,max:30,value:12};var defaultShapeStrokeValues={realTimeEvent:true,min:2,max:300,value:3};var defaultTextRangeValues={realTimeEvent:true,min:10,max:100,value:50};var defaultFilterRangeValues={tintOpacityRange:{realTimeEvent:true,min:0,max:1,value:0.7,useDecimal:true},removewhiteDistanceRange:{realTimeEvent:true,min:0,max:1,value:0.2,useDecimal:true},brightnessRange:{realTimeEvent:true,min:-1,max:1,value:0,useDecimal:true},noiseRange:{realTimeEvent:true,min:0,max:1000,value:100},pixelateRange:{realTimeEvent:true,min:2,max:20,value:4},colorfilterThresholdRange:{realTimeEvent:true,min:0,max:1,value:0.2,useDecimal:true},blurFilterRange:{value:0.1}};var emptyCropRectValues={LEFT:0,TOP:0,WIDTH:0.5,HEIGHT:0.5};var defaultResizePixelValues={realTimeEvent:true,min:32,max:4088,value:800};;var FLOATING_POINT_DIGIT=2;var CSS_PREFIX='tui-image-editor-';var min=Math.min,max=Math.max;var hostnameSent=false;var lastId=0;function stamp(obj){if(!obj.__fe_id){lastId+=1;obj.__fe_id=lastId;}
return obj.__fe_id;}
function hasStamp(obj){return!isNil(obj===null||obj===void 0?void 0:obj.__fe_id);}
function isNil(value){return isUndefined(value)||value===null;}
function isFunction(value){return typeof value==='function';}
function clamp(value,minValue,maxValue){if(minValue>maxValue){var _ref=[maxValue,minValue];minValue=_ref[0];maxValue=_ref[1];}
return max(minValue,min(value,maxValue));}
function keyMirror(){var obj={};for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}
forEach_default()(args,function(key){obj[key]=key;});return obj;}
function makeStyleText(styleObj){var styleStr='';forEach(styleObj,function(value,prop){var _context;styleStr+=_concatInstanceProperty(_context="".concat(prop,": ")).call(_context,value,";");});return styleStr;}
function getProperties(obj,keys){var props={};var length=keys.length;var i=0;var key;for(i=0;i<length;i+=1){key=keys[i];props[key]=obj[key];}
return props;}
function toInteger(value){return parse_int_default()(value,10);}
function toCamelCase(targetString){return targetString.replace(/-([a-z])/g,function($0,$1){return $1.toUpperCase();});}
function isSupportFileApi(){return!!(window.File&&window.FileList&&window.FileReader);}
function getRgb(color,alpha){var _context3,_context4,_context5;if(color.length===4){var _context2;color=concat_default()(_context2="".concat(color)).call(_context2,slice_default()(color).call(color,1,4));}
var r=parse_int_default()(slice_default()(color).call(color,1,3),16);var g=parse_int_default()(slice_default()(color).call(color,3,5),16);var b=parse_int_default()(slice_default()(color).call(color,5,7),16);var a=alpha||1;return concat_default()(_context3=concat_default()(_context4=concat_default()(_context5="rgba(".concat(r,", ")).call(_context5,g,", ")).call(_context4,b,", ")).call(_context3,a,")");}
function sendHostName(){if(hostnameSent){return;}
hostnameSent=true;sendHostname_default()('image-editor','UA-129999381-1');}
function styleLoad(styleBuffer,tagId){var _document$getElements=document.getElementsByTagName('head'),_document$getElements2=_slicedToArray(_document$getElements,1),head=_document$getElements2[0];var linkElement=document.createElement('link');var styleData=encodeURIComponent(styleBuffer);if(tagId){linkElement.id=tagId;}
linkElement.setAttribute('rel','stylesheet');linkElement.setAttribute('type','text/css');linkElement.setAttribute('href',"data:text/css;charset=UTF-8,".concat(styleData));head.appendChild(linkElement);}
function getSelector(targetElement){return function(str){return targetElement.querySelector(str);};}
function base64ToBlob(data){var rImageType=/data:(image\/.+);base64,/;var mimeString='';var raw,uInt8Array,i;raw=data.replace(rImageType,function(header,imageType){mimeString=imageType;return'';});raw=atob(raw);var rawLength=raw.length;uInt8Array=new Uint8Array(rawLength);for(i=0;i<rawLength;i+=1){uInt8Array[i]=raw.charCodeAt(i);}
return new Blob([uInt8Array],{type:mimeString});}
function fixFloatingPoint(value){return Number(value.toFixed(FLOATING_POINT_DIGIT));}
function assignmentForDestroy(targetObject){forEach_default()(targetObject,function(value,key){targetObject[key]=null;});}
function cls(){var _context7;var str=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var prefix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';if(str.charAt(0)==='.'){var _context6;return concat_default()(_context6=".".concat(CSS_PREFIX).concat(prefix)).call(_context6,slice_default()(str).call(str,1));}
return concat_default()(_context7="".concat(CSS_PREFIX).concat(prefix)).call(_context7,str);}
function changeOrigin(fObject,origin){var originX=origin.originX,originY=origin.originY;var _fObject$getPointByOr=fObject.getPointByOrigin(originX,originY),left=_fObject$getPointByOr.x,top=_fObject$getPointByOr.y;fObject.set({left:left,top:top,originX:originX,originY:originY});fObject.setCoords();}
function flipObject(targetObject){var _context8;var result={};for_each_default()(_context8=keys_default()(targetObject)).call(_context8,function(key){result[targetObject[key]]=key;});return result;}
function setCustomProperty(targetObject,props){targetObject.customProps=targetObject.customProps||{};extend_default()(targetObject.customProps,props);}
function getCustomProperty(fObject,propNames){var resultObject={};if(isString_default()(propNames)){propNames=[propNames];}
forEach_default()(propNames,function(propName){resultObject[propName]=fObject.customProps[propName];});return resultObject;}
function capitalizeString(targetString){return targetString.charAt(0).toUpperCase()+slice_default()(targetString).call(targetString,1);}
function includes(targetArray,compareValue){return index_of_default()(targetArray).call(targetArray,compareValue)>=0;}
function getFillTypeFromOption(){var fillOption=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return pick_default()(fillOption,'type')||SHAPE_FILL_TYPE.COLOR;}
function getFillTypeFromObject(shapeObj){var _shapeObj$fill=fill_default()(shapeObj),fill=_shapeObj$fill===void 0?{}:_shapeObj$fill;if(fill.source){return SHAPE_FILL_TYPE.FILTER;}
return SHAPE_FILL_TYPE.COLOR;}
function isShape(obj){return inArray_default()(obj.get('type'),SHAPE_TYPE)>=0;}
function getObjectType(type){if(includes(SHAPE_TYPE,type)){return'Shape';}
switch(type){case'i-text':return'Text';case'path':case'line':return'Draw';case'activeSelection':return'Group';default:return toStartOfCapital(type);}}
function getFilterType(type){var _ref2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref2$useAlpha=_ref2.useAlpha,useAlpha=_ref2$useAlpha===void 0?true:_ref2$useAlpha,mode=_ref2.mode;var VINTAGE=filterType.VINTAGE,REMOVE_COLOR=filterType.REMOVE_COLOR,BLEND_COLOR=filterType.BLEND_COLOR,SEPIA2=filterType.SEPIA2,COLOR_FILTER=filterType.COLOR_FILTER,REMOVE_WHITE=filterType.REMOVE_WHITE,BLEND=filterType.BLEND;var filterName;switch(type){case VINTAGE:filterName=SEPIA2;break;case REMOVE_COLOR:filterName=useAlpha?COLOR_FILTER:REMOVE_WHITE;break;case BLEND_COLOR:filterName=mode==='add'?BLEND:mode;break;default:filterName=type;}
return toStartOfCapital(filterName);}
function isSilentCommand(command){var LOAD_IMAGE=commandNames.LOAD_IMAGE;return typeof command==='string'?LOAD_IMAGE===command:LOAD_IMAGE===command.name;}
function getHistoryTitle(command){var _context9,_context10;var FLIP_IMAGE=commandNames.FLIP_IMAGE,ROTATE_IMAGE=commandNames.ROTATE_IMAGE,ADD_TEXT=commandNames.ADD_TEXT,APPLY_FILTER=commandNames.APPLY_FILTER,REMOVE_FILTER=commandNames.REMOVE_FILTER,CHANGE_SHAPE=commandNames.CHANGE_SHAPE,CHANGE_ICON_COLOR=commandNames.CHANGE_ICON_COLOR,CHANGE_TEXT_STYLE=commandNames.CHANGE_TEXT_STYLE,CLEAR_OBJECTS=commandNames.CLEAR_OBJECTS,ADD_IMAGE_OBJECT=commandNames.ADD_IMAGE_OBJECT,REMOVE_OBJECT=commandNames.REMOVE_OBJECT,RESIZE_IMAGE=commandNames.RESIZE_IMAGE;var name=command.name,args=command.args;var historyInfo;switch(name){case FLIP_IMAGE:historyInfo={name:name,detail:args[1]==='reset'?args[1]:slice_default()(_context9=args[1]).call(_context9,4)};break;case ROTATE_IMAGE:historyInfo={name:name,detail:args[2]};break;case APPLY_FILTER:historyInfo={name:historyNames.APPLY_FILTER,detail:getFilterType(args[1],args[2])};break;case REMOVE_FILTER:historyInfo={name:historyNames.REMOVE_FILTER,detail:'Remove'};break;case CHANGE_SHAPE:historyInfo={name:historyNames.CHANGE_SHAPE,detail:'Change'};break;case CHANGE_ICON_COLOR:historyInfo={name:historyNames.CHANGE_ICON_COLOR,detail:'Change'};break;case CHANGE_TEXT_STYLE:historyInfo={name:historyNames.CHANGE_TEXT_STYLE,detail:'Change'};break;case REMOVE_OBJECT:historyInfo={name:historyNames.REMOVE_OBJECT,detail:args[2]};break;case CLEAR_OBJECTS:historyInfo={name:historyNames.CLEAR_OBJECTS,detail:'All'};break;case ADD_IMAGE_OBJECT:historyInfo={name:historyNames.ADD_IMAGE_OBJECT,detail:'Add'};break;case ADD_TEXT:historyInfo={name:historyNames.ADD_TEXT};break;case RESIZE_IMAGE:historyInfo={name:historyNames.RESIZE,detail:concat_default()(_context10="".concat(~~args[1].width,"x")).call(_context10,~~args[1].height)};break;default:historyInfo={name:name};break;}
if(args[1]==='mask'){historyInfo={name:historyNames.LOAD_MASK_IMAGE,detail:'Apply'};}
return historyInfo;}
function getHelpMenuBarPosition(position){if(position==='top'){return'bottom';}
if(position==='left'){return'right';}
if(position==='right'){return'left';}
return'top';}
function toStartOfCapital(str){return str.replace(/[a-z]/,function(first){return first.toUpperCase();});}
function isEmptyCropzone(cropRect){var left=cropRect.left,top=cropRect.top,width=cropRect.width,height=cropRect.height;var LEFT=emptyCropRectValues.LEFT,TOP=emptyCropRectValues.TOP,WIDTH=emptyCropRectValues.WIDTH,HEIGHT=emptyCropRectValues.HEIGHT;return left===LEFT&&top===TOP&&width===WIDTH&&height===HEIGHT;};var types=keyMirror('UN_IMPLEMENTATION','NO_COMPONENT_NAME');var messages={UN_IMPLEMENTATION:'Should implement a method: ',NO_COMPONENT_NAME:'Should set a component name'};var map={UN_IMPLEMENTATION:function UN_IMPLEMENTATION(methodName){return messages.UN_IMPLEMENTATION+methodName;},NO_COMPONENT_NAME:function NO_COMPONENT_NAME(){return messages.NO_COMPONENT_NAME;}};var errorMessage=({types:extend_default()({},types),create:function create(type){type=type.toLowerCase();var func=map[type];for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}
return func.apply(void 0,args);}});;var createMessage=errorMessage.create;var errorTypes=errorMessage.types;var Command=function(){function Command(actions,args){_classCallCheck(this,Command);this.name=actions.name;this.args=args;this.execute=actions.execute;this.undo=actions.undo;this.executeCallback=actions.executeCallback||null;this.undoCallback=actions.undoCallback||null;this.undoData={};}
_createClass(Command,[{key:"execute",value:function execute(){throw new Error(createMessage(errorTypes.UN_IMPLEMENTATION,'execute'));}},{key:"undo",value:function undo(){throw new Error(createMessage(errorTypes.UN_IMPLEMENTATION,'undo'));}},{key:"isRedo",get:function get(){return keys_default()(this.undoData).length>0;}},{key:"setUndoData",value:function setUndoData(undoData,cachedUndoDataForSilent,isSilent){if(cachedUndoDataForSilent){undoData=cachedUndoDataForSilent;}
if(!isSilent){extend_default()(this.undoData,undoData);cachedUndoDataForSilent=null;}else if(!cachedUndoDataForSilent){cachedUndoDataForSilent=undoData;}
return cachedUndoDataForSilent;}},{key:"setExecuteCallback",value:function setExecuteCallback(callback){this.executeCallback=callback;return this;}},{key:"setUndoCallback",value:function setUndoCallback(callback){this.undoCallback=callback;return this;}}]);return Command;}();var command=(Command);;var commands={};function command_create(name){var actions=commands[name];if(actions){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}
return new command(actions,args);}
return null;}
function register(command){commands[command.name]=command;}
var factory_command=({create:command_create,register:register});;var Invoker=function(){function Invoker(){_classCallCheck(this,Invoker);this._undoStack=[];this._redoStack=[];this._isLocked=false;this._isSilent=false;}
_createClass(Invoker,[{key:"_invokeExecution",value:function _invokeExecution(command){var _this=this;var isRedo=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.lock();var args=command.args;if(!args){args=[];}
return command.execute.apply(command,_toConsumableArray(args)).then(function(value){if(!_this._isSilent){_this.pushUndoStack(command);_this.fire(isRedo?eventNames.AFTER_REDO:eventNames.EXECUTE_COMMAND,command);}
_this.unlock();if(isFunction(command.executeCallback)){command.executeCallback(value);}
return value;})['catch'](function(message){_this.unlock();return promise_default().reject(message);});}},{key:"_invokeUndo",value:function _invokeUndo(command){var _this2=this;this.lock();var args=command.args;if(!args){args=[];}
return command.undo.apply(command,_toConsumableArray(args)).then(function(value){_this2.pushRedoStack(command);_this2.fire(eventNames.AFTER_UNDO,command);_this2.unlock();if(isFunction(command.undoCallback)){command.undoCallback(value);}
return value;})['catch'](function(message){_this2.unlock();return promise_default().reject(message);});}},{key:"_fireRedoStackChanged",value:function _fireRedoStackChanged(){this.fire(eventNames.REDO_STACK_CHANGED,this._redoStack.length);}},{key:"_fireUndoStackChanged",value:function _fireUndoStackChanged(){this.fire(eventNames.UNDO_STACK_CHANGED,this._undoStack.length);}},{key:"lock",value:function lock(){this._isLocked=true;}},{key:"unlock",value:function unlock(){this._isLocked=false;}},{key:"executeSilent",value:function executeSilent(){var _this3=this;this._isSilent=true;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}
return this.execute.apply(this,concat_default()(args).call(args,[this._isSilent])).then(function(){_this3._isSilent=false;});}},{key:"execute",value:function execute(){var _this4=this;if(this._isLocked){return promise_default().reject(rejectMessages.isLock);}
for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}
var command=args[0];if(isString_default()(command)){command=factory_command.create.apply(factory_command,args);}
return this._invokeExecution(command).then(function(value){_this4.clearRedoStack();return value;});}},{key:"undo",value:function undo(){var command=this._undoStack.pop();var promise;var message='';if(command&&this._isLocked){this.pushUndoStack(command,true);command=null;}
if(command){if(this.isEmptyUndoStack()){this._fireUndoStackChanged();}
promise=this._invokeUndo(command);}else{message=rejectMessages.undo;if(this._isLocked){var _context;message=concat_default()(_context="".concat(message," Because ")).call(_context,rejectMessages.isLock);}
promise=promise_default().reject(message);}
return promise;}},{key:"redo",value:function redo(){var command=this._redoStack.pop();var promise;var message='';if(command&&this._isLocked){this.pushRedoStack(command,true);command=null;}
if(command){if(this.isEmptyRedoStack()){this._fireRedoStackChanged();}
promise=this._invokeExecution(command,true);}else{message=rejectMessages.redo;if(this._isLocked){var _context2;message=concat_default()(_context2="".concat(message," Because ")).call(_context2,rejectMessages.isLock);}
promise=promise_default().reject(message);}
return promise;}},{key:"pushUndoStack",value:function pushUndoStack(command,isSilent){this._undoStack.push(command);if(!isSilent){this._fireUndoStackChanged();}}},{key:"pushRedoStack",value:function pushRedoStack(command,isSilent){this._redoStack.push(command);if(!isSilent){this._fireRedoStackChanged();}}},{key:"isEmptyRedoStack",value:function isEmptyRedoStack(){return this._redoStack.length===0;}},{key:"isEmptyUndoStack",value:function isEmptyUndoStack(){return this._undoStack.length===0;}},{key:"clearUndoStack",value:function clearUndoStack(){if(!this.isEmptyUndoStack()){this._undoStack=[];this._fireUndoStackChanged();}}},{key:"clearRedoStack",value:function clearRedoStack(){if(!this.isEmptyRedoStack()){this._redoStack=[];this._fireRedoStackChanged();}}}]);return Invoker;}();customEvents_default().mixin(Invoker);var invoker=(Invoker);var parse_float=__webpack_require__(5214);var parse_float_default=__webpack_require__.n(parse_float);;var mainContainer=(function(_ref){var _context,_context2,_context3,_context4,_context5,_context6,_context7;var locale=_ref.locale,biImage=_ref.biImage,commonStyle=_ref.commonStyle,headerStyle=_ref.headerStyle,loadButtonStyle=_ref.loadButtonStyle,downloadButtonStyle=_ref.downloadButtonStyle,submenuStyle=_ref.submenuStyle;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5=concat_default()(_context6=concat_default()(_context7="\n    <div class=\"tui-image-editor-main-container\" style=\"".concat(commonStyle,"\">\n        <div class=\"tui-image-editor-header\" style=\"")).call(_context7,headerStyle,"\">\n            <div class=\"tui-image-editor-header-logo\">\n                <img src=\"")).call(_context6,biImage,"\" />\n            </div>\n            <div class=\"tui-image-editor-header-buttons\">\n                <div style=\"")).call(_context5,loadButtonStyle,"\">\n                    ")).call(_context4,locale.localize('Load'),"\n                    <input type=\"file\" class=\"tui-image-editor-load-btn\" />\n                </div>\n                <button class=\"tui-image-editor-download-btn\" style=\"")).call(_context3,downloadButtonStyle,"\">\n                    ")).call(_context2,locale.localize('Download'),"\n                </button>\n            </div>\n        </div>\n        <div class=\"tui-image-editor-main\">\n            <div class=\"tui-image-editor-submenu\">\n                <div class=\"tui-image-editor-submenu-style\" style=\"")).call(_context,submenuStyle,"\"></div>\n            </div>\n            <div class=\"tui-image-editor-wrap\">\n                <div class=\"tui-image-editor-size-wrap\">\n                    <div class=\"tui-image-editor-align-wrap\">\n                        <div class=\"tui-image-editor\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n");});;var controls=(function(_ref){var _context,_context2,_context3,_context4,_context5;var locale=_ref.locale,biImage=_ref.biImage,loadButtonStyle=_ref.loadButtonStyle,downloadButtonStyle=_ref.downloadButtonStyle,menuBarPosition=_ref.menuBarPosition;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5="\n    <ul class=\"tui-image-editor-help-menu ".concat(getHelpMenuBarPosition(menuBarPosition),"\"></ul>\n    <div class=\"tui-image-editor-controls\">\n        <div class=\"tui-image-editor-controls-logo\">\n            <img src=\"")).call(_context5,biImage,"\" />\n        </div>\n        <ul class=\"tui-image-editor-menu\"></ul>\n\n        <div class=\"tui-image-editor-controls-buttons\">\n            <div style=\"")).call(_context4,loadButtonStyle,"\">\n                ")).call(_context3,locale.localize('Load'),"\n                <input type=\"file\" class=\"tui-image-editor-load-btn\" />\n            </div>\n            <button class=\"tui-image-editor-download-btn\" style=\"")).call(_context2,downloadButtonStyle,"\">\n                ")).call(_context,locale.localize('Download'),"\n            </button>\n        </div>\n    </div>\n");});var instance_map=__webpack_require__(899);var map_default=__webpack_require__.n(instance_map);;var style=(function(_ref){var _context,_context2,_context3,_context4,_context5,_context6,_context7,_context8,_context9,_context10,_context11,_context12,_context13,_context14,_context15,_context16,_context17,_context18,_context19,_context20,_context21,_context22,_context23,_context24,_context25,_context26,_context27,_context28,_context29;var subMenuLabelActive=_ref.subMenuLabelActive,subMenuLabelNormal=_ref.subMenuLabelNormal,subMenuRangeTitle=_ref.subMenuRangeTitle,submenuPartitionVertical=_ref.submenuPartitionVertical,submenuPartitionHorizontal=_ref.submenuPartitionHorizontal,submenuCheckbox=_ref.submenuCheckbox,submenuRangePointer=_ref.submenuRangePointer,submenuRangeValue=_ref.submenuRangeValue,submenuColorpickerTitle=_ref.submenuColorpickerTitle,submenuColorpickerButton=_ref.submenuColorpickerButton,submenuRangeBar=_ref.submenuRangeBar,submenuRangeSubbar=_ref.submenuRangeSubbar,submenuDisabledRangePointer=_ref.submenuDisabledRangePointer,submenuDisabledRangeBar=_ref.submenuDisabledRangeBar,submenuDisabledRangeSubbar=_ref.submenuDisabledRangeSubbar,submenuIconSize=_ref.submenuIconSize,menuIconSize=_ref.menuIconSize,biSize=_ref.biSize,menuIconStyle=_ref.menuIconStyle,submenuIconStyle=_ref.submenuIconStyle;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5=concat_default()(_context6=concat_default()(_context7=concat_default()(_context8=concat_default()(_context9=concat_default()(_context10=concat_default()(_context11=concat_default()(_context12=concat_default()(_context13=concat_default()(_context14=concat_default()(_context15=concat_default()(_context16=concat_default()(_context17=concat_default()(_context18=concat_default()(_context19=concat_default()(_context20=concat_default()(_context21=concat_default()(_context22=concat_default()(_context23=concat_default()(_context24=concat_default()(_context25=concat_default()(_context26=concat_default()(_context27=concat_default()(_context28=concat_default()(_context29="\n    .tie-icon-add-button.icon-bubble .tui-image-editor-button[data-icontype=\"icon-bubble\"] label,\n    .tie-icon-add-button.icon-heart .tui-image-editor-button[data-icontype=\"icon-heart\"] label,\n    .tie-icon-add-button.icon-location .tui-image-editor-button[data-icontype=\"icon-location\"] label,\n    .tie-icon-add-button.icon-polygon .tui-image-editor-button[data-icontype=\"icon-polygon\"] label,\n    .tie-icon-add-button.icon-star .tui-image-editor-button[data-icontype=\"icon-star\"] label,\n    .tie-icon-add-button.icon-star-2 .tui-image-editor-button[data-icontype=\"icon-star-2\"] label,\n    .tie-icon-add-button.icon-arrow-3 .tui-image-editor-button[data-icontype=\"icon-arrow-3\"] label,\n    .tie-icon-add-button.icon-arrow-2 .tui-image-editor-button[data-icontype=\"icon-arrow-2\"] label,\n    .tie-icon-add-button.icon-arrow .tui-image-editor-button[data-icontype=\"icon-arrow\"] label,\n    .tie-icon-add-button.icon-bubble .tui-image-editor-button[data-icontype=\"icon-bubble\"] label,\n    .tie-draw-line-select-button.line .tui-image-editor-button.line label,\n    .tie-draw-line-select-button.free .tui-image-editor-button.free label,\n    .tie-flip-button.flipX .tui-image-editor-button.flipX label,\n    .tie-flip-button.flipY .tui-image-editor-button.flipY label,\n    .tie-flip-button.resetFlip .tui-image-editor-button.resetFlip label,\n    .tie-crop-button .tui-image-editor-button.apply.active label,\n    .tie-crop-preset-button .tui-image-editor-button.preset.active label,\n    .tie-resize-button .tui-image-editor-button.apply.active label,\n    .tie-resize-preset-button .tui-image-editor-button.preset.active label,\n    .tie-shape-button.rect .tui-image-editor-button.rect label,\n    .tie-shape-button.circle .tui-image-editor-button.circle label,\n    .tie-shape-button.triangle .tui-image-editor-button.triangle label,\n    .tie-text-effect-button .tui-image-editor-button.active label,\n    .tie-text-align-button.tie-text-align-left .tui-image-editor-button.left label,\n    .tie-text-align-button.tie-text-align-center .tui-image-editor-button.center label,\n    .tie-text-align-button.tie-text-align-right .tui-image-editor-button.right label,\n    .tie-mask-apply.apply.active .tui-image-editor-button.apply label,\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button:hover > label,\n    .tui-image-editor-container .tui-image-editor-checkbox label > span {\n        ".concat(subMenuLabelActive,"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button > label,\n    .tui-image-editor-container .tui-image-editor-range-wrap.tui-image-editor-newline.short label,\n    .tui-image-editor-container .tui-image-editor-range-wrap.tui-image-editor-newline.short label > span {\n        ")).call(_context29,subMenuLabelNormal,"\n    }\n    .tui-image-editor-container .tui-image-editor-range-wrap label > span {\n        ")).call(_context28,subMenuRangeTitle,"\n    }\n    .tui-image-editor-container .tui-image-editor-partition > div {\n        ")).call(_context27,submenuPartitionVertical,"\n    }\n    .tui-image-editor-container.left .tui-image-editor-submenu .tui-image-editor-partition > div,\n    .tui-image-editor-container.right .tui-image-editor-submenu .tui-image-editor-partition > div {\n        ")).call(_context26,submenuPartitionHorizontal,"\n    }\n    .tui-image-editor-container .tui-image-editor-checkbox label > span:before {\n        ")).call(_context25,submenuCheckbox,"\n    }\n    .tui-image-editor-container .tui-image-editor-checkbox label > input:checked + span:before {\n        border: 0;\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-pointer {\n        ")).call(_context24,submenuRangePointer,"\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-bar {\n        ")).call(_context23,submenuRangeBar,"\n    }\n    .tui-image-editor-container .tui-image-editor-virtual-range-subbar {\n        ")).call(_context22,submenuRangeSubbar,"\n    }\n    .tui-image-editor-container .tui-image-editor-disabled .tui-image-editor-virtual-range-pointer {\n        ")).call(_context21,submenuDisabledRangePointer,"\n    }\n    .tui-image-editor-container .tui-image-editor-disabled .tui-image-editor-virtual-range-subbar {\n        ")).call(_context20,submenuDisabledRangeSubbar,"\n    }\n    .tui-image-editor-container .tui-image-editor-disabled .tui-image-editor-virtual-range-bar {\n        ")).call(_context19,submenuDisabledRangeBar,"\n    }\n    .tui-image-editor-container .tui-image-editor-range-value {\n        ")).call(_context18,submenuRangeValue,"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button .color-picker-value + label {\n        ")).call(_context17,submenuColorpickerTitle,"\n    }\n    .tui-image-editor-container .tui-image-editor-submenu .tui-image-editor-button .color-picker-value {\n        ")).call(_context16,submenuColorpickerButton,"\n    }\n    .tui-image-editor-container .svg_ic-menu {\n        ")).call(_context15,menuIconSize,"\n    }\n    .tui-image-editor-container .svg_ic-submenu {\n        ")).call(_context14,submenuIconSize,"\n    }\n    .tui-image-editor-container .tui-image-editor-controls-logo > img,\n    .tui-image-editor-container .tui-image-editor-header-logo > img {\n        ")).call(_context13,biSize,"\n    }\n    .tui-image-editor-menu use.normal.use-default,\n    .tui-image-editor-help-menu use.normal.use-default {\n        fill-rule: evenodd;\n        fill: ")).call(_context12,menuIconStyle.normal.color,";\n        stroke: ")).call(_context11,menuIconStyle.normal.color,";\n    }\n    .tui-image-editor-menu use.active.use-default,\n    .tui-image-editor-help-menu use.active.use-default {\n        fill-rule: evenodd;\n        fill: ")).call(_context10,menuIconStyle.active.color,";\n        stroke: ")).call(_context9,menuIconStyle.active.color,";\n    }\n    .tui-image-editor-menu use.hover.use-default,\n    .tui-image-editor-help-menu use.hover.use-default {\n        fill-rule: evenodd;\n        fill: ")).call(_context8,menuIconStyle.hover.color,";\n        stroke: ")).call(_context7,menuIconStyle.hover.color,";\n    }\n    .tui-image-editor-menu use.disabled.use-default,\n    .tui-image-editor-help-menu use.disabled.use-default {\n        fill-rule: evenodd;\n        fill: ")).call(_context6,menuIconStyle.disabled.color,";\n        stroke: ")).call(_context5,menuIconStyle.disabled.color,";\n    }\n    .tui-image-editor-submenu use.normal.use-default {\n        fill-rule: evenodd;\n        fill: ")).call(_context4,submenuIconStyle.normal.color,";\n        stroke: ")).call(_context3,submenuIconStyle.normal.color,";\n    }\n    .tui-image-editor-submenu use.active.use-default {\n        fill-rule: evenodd;\n        fill: ")).call(_context2,submenuIconStyle.active.color,";\n        stroke: ")).call(_context,submenuIconStyle.active.color,";\n    }\n");});;var standard=({'common.bi.image':'https://uicdn.toast.com/toastui/img/tui-image-editor-bi.png','common.bisize.width':'251px','common.bisize.height':'21px','common.backgroundImage':'none','common.backgroundColor':'#1e1e1e','common.border':'0px','header.backgroundImage':'none','header.backgroundColor':'transparent','header.border':'0px','loadButton.backgroundColor':'#fff','loadButton.border':'1px solid #ddd','loadButton.color':'#222','loadButton.fontFamily':"'Noto Sans', sans-serif",'loadButton.fontSize':'12px','downloadButton.backgroundColor':'#fdba3b','downloadButton.border':'1px solid #fdba3b','downloadButton.color':'#fff','downloadButton.fontFamily':"'Noto Sans', sans-serif",'downloadButton.fontSize':'12px','menu.normalIcon.color':'#8a8a8a','menu.activeIcon.color':'#555555','menu.disabledIcon.color':'#434343','menu.hoverIcon.color':'#e9e9e9','submenu.normalIcon.color':'#8a8a8a','submenu.activeIcon.color':'#e9e9e9','menu.iconSize.width':'24px','menu.iconSize.height':'24px','submenu.iconSize.width':'32px','submenu.iconSize.height':'32px','submenu.backgroundColor':'#1e1e1e','submenu.partition.color':'#3c3c3c','submenu.normalLabel.color':'#8a8a8a','submenu.normalLabel.fontWeight':'lighter','submenu.activeLabel.color':'#fff','submenu.activeLabel.fontWeight':'lighter','checkbox.border':'0px','checkbox.backgroundColor':'#fff','range.pointer.color':'#fff','range.bar.color':'#666','range.subbar.color':'#d1d1d1','range.disabledPointer.color':'#414141','range.disabledBar.color':'#282828','range.disabledSubbar.color':'#414141','range.value.color':'#fff','range.value.fontWeight':'lighter','range.value.fontSize':'11px','range.value.border':'1px solid #353535','range.value.backgroundColor':'#151515','range.title.color':'#fff','range.title.fontWeight':'lighter','colorpicker.button.border':'1px solid #1e1e1e','colorpicker.title.color':'#fff'});var svg_default=__webpack_require__(2534);;var Theme=function(){function Theme(customTheme){_classCallCheck(this,Theme);this.styles=this._changeToObject(extend_default()({},standard,customTheme));styleLoad(this._styleMaker());this._loadDefaultSvgIcon();}
_createClass(Theme,[{key:"getStyle",value:function getStyle(type){var result=null;var firstProperty=type.replace(/\..+$/,'');var option=this.styles[type];switch(type){case'common.bi':result=this.styles[type].image;break;case'menu.icon':result={active:this.styles["".concat(firstProperty,".activeIcon")],normal:this.styles["".concat(firstProperty,".normalIcon")],hover:this.styles["".concat(firstProperty,".hoverIcon")],disabled:this.styles["".concat(firstProperty,".disabledIcon")]};break;case'submenu.icon':result={active:this.styles["".concat(firstProperty,".activeIcon")],normal:this.styles["".concat(firstProperty,".normalIcon")]};break;case'submenu.label':result={active:this._makeCssText(this.styles["".concat(firstProperty,".activeLabel")]),normal:this._makeCssText(this.styles["".concat(firstProperty,".normalLabel")])};break;case'submenu.partition':result={vertical:this._makeCssText(extend_default()({},option,{borderLeft:"1px solid ".concat(option.color)})),horizontal:this._makeCssText(extend_default()({},option,{borderBottom:"1px solid ".concat(option.color)}))};break;case'range.disabledPointer':case'range.disabledBar':case'range.disabledSubbar':case'range.pointer':case'range.bar':case'range.subbar':option.backgroundColor=option.color;result=this._makeCssText(option);break;default:result=this._makeCssText(option);break;}
return result;}},{key:"_styleMaker",value:function _styleMaker(){var submenuLabelStyle=this.getStyle('submenu.label');var submenuPartitionStyle=this.getStyle('submenu.partition');return style({subMenuLabelActive:submenuLabelStyle.active,subMenuLabelNormal:submenuLabelStyle.normal,submenuPartitionVertical:submenuPartitionStyle.vertical,submenuPartitionHorizontal:submenuPartitionStyle.horizontal,biSize:this.getStyle('common.bisize'),subMenuRangeTitle:this.getStyle('range.title'),submenuRangePointer:this.getStyle('range.pointer'),submenuRangeBar:this.getStyle('range.bar'),submenuRangeSubbar:this.getStyle('range.subbar'),submenuDisabledRangePointer:this.getStyle('range.disabledPointer'),submenuDisabledRangeBar:this.getStyle('range.disabledBar'),submenuDisabledRangeSubbar:this.getStyle('range.disabledSubbar'),submenuRangeValue:this.getStyle('range.value'),submenuColorpickerTitle:this.getStyle('colorpicker.title'),submenuColorpickerButton:this.getStyle('colorpicker.button'),submenuCheckbox:this.getStyle('checkbox'),menuIconSize:this.getStyle('menu.iconSize'),submenuIconSize:this.getStyle('submenu.iconSize'),menuIconStyle:this.getStyle('menu.icon'),submenuIconStyle:this.getStyle('submenu.icon')});}},{key:"_changeToObject",value:function _changeToObject(styleOptions){var styleObject={};forEach_default()(styleOptions,function(value,key){var keyExplode=key.match(/^(.+)\.([a-z]+)$/i);var _keyExplode=_slicedToArray(keyExplode,3),property=_keyExplode[1],subProperty=_keyExplode[2];if(!styleObject[property]){styleObject[property]={};}
styleObject[property][subProperty]=value;});return styleObject;}},{key:"_makeCssText",value:function _makeCssText(styleObject){var _this=this;var converterStack=[];forEach_default()(styleObject,function(value,key){var _context,_context2;if(index_of_default()(_context=['backgroundImage']).call(_context,key)>-1&&value!=='none'){value="url(".concat(value,")");}
converterStack.push(concat_default()(_context2="".concat(_this._toUnderScore(key),": ")).call(_context2,value));});return converterStack.join(';');}},{key:"_toUnderScore",value:function _toUnderScore(targetString){return targetString.replace(/([A-Z])/g,function($0,$1){return"-".concat($1.toLowerCase());});}},{key:"_loadDefaultSvgIcon",value:function _loadDefaultSvgIcon(){if(!document.getElementById('tui-image-editor-svg-default-icons')){var parser=new DOMParser();var encodedURI=svg_default.replace(/data:image\/svg\+xml;base64,/,'');var dom=parser.parseFromString(atob(encodedURI),'text/xml');document.body.appendChild(dom.documentElement);}}},{key:"_makeIconClassName",value:function _makeIconClassName(iconType,isSubmenu){var iconStyleInfo=isSubmenu?this.getStyle('submenu.icon'):this.getStyle('menu.icon');var _iconStyleInfo$iconTy=iconStyleInfo[iconType],path=_iconStyleInfo$iconTy.path,name=_iconStyleInfo$iconTy.name;return path&&name?iconType:"".concat(iconType," use-default");}},{key:"_makeSvgIconPrefix",value:function _makeSvgIconPrefix(iconType,isSubmenu){var _context3;var iconStyleInfo=isSubmenu?this.getStyle('submenu.icon'):this.getStyle('menu.icon');var _iconStyleInfo$iconTy2=iconStyleInfo[iconType],path=_iconStyleInfo$iconTy2.path,name=_iconStyleInfo$iconTy2.name;return path&&name?concat_default()(_context3="".concat(path,"#")).call(_context3,name,"-"):'#';}},{key:"_makeSvgItem",value:function _makeSvgItem(useIconTypes,menuName,isSubmenu){var _this2=this;return map_default()(useIconTypes).call(useIconTypes,function(iconType){var _context4,_context5;var svgIconPrefix=_this2._makeSvgIconPrefix(iconType,isSubmenu);var iconName=_this2._toUnderScore(menuName);var svgIconClassName=_this2._makeIconClassName(iconType,isSubmenu);return concat_default()(_context4=concat_default()(_context5="<use xlink:href=\"".concat(svgIconPrefix,"ic-")).call(_context5,iconName,"\" class=\"")).call(_context4,svgIconClassName,"\"/>");}).join('');}},{key:"makeMenSvgIconSet",value:function makeMenSvgIconSet(useIconTypes,menuName){var _context6;var isSubmenu=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return concat_default()(_context6="<svg class=\"svg_ic-".concat(isSubmenu?'submenu':'menu',"\">")).call(_context6,this._makeSvgItem(useIconTypes,menuName,isSubmenu),"</svg>");}}]);return Theme;}();var theme=(Theme);var construct=__webpack_require__(9146);var construct_default=__webpack_require__.n(construct);var object_create=__webpack_require__(6623);var set_prototype_of=__webpack_require__(4230);;function _setPrototypeOf(o,p){_setPrototypeOf=set_prototype_of||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);};function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}
subClass.prototype=object_create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}
var iterator=__webpack_require__(3742);;function _typeof(obj){"@babel/helpers - typeof";if(typeof symbol==="function"&&typeof iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof symbol==="function"&&obj.constructor===symbol&&obj!==symbol.prototype?"symbol":typeof obj;};}
return _typeof(obj);};function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}
return self;};function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}
return _assertThisInitialized(self);}
var get_prototype_of=__webpack_require__(9856);;function _getPrototypeOf(o){_getPrototypeOf=set_prototype_of?get_prototype_of:function _getPrototypeOf(o){return o.__proto__||get_prototype_of(o);};return _getPrototypeOf(o);}
var forEachArray=__webpack_require__(6092);var forEachArray_default=__webpack_require__.n(forEachArray);var external_commonjs_tui_color_picker_commonjs2_tui_color_picker_amd_tui_color_picker_root_tui_colorPicker_=__webpack_require__(4858);var external_commonjs_tui_color_picker_commonjs2_tui_color_picker_amd_tui_color_picker_root_tui_colorPicker_default=__webpack_require__.n(external_commonjs_tui_color_picker_commonjs2_tui_color_picker_amd_tui_color_picker_root_tui_colorPicker_);;var PICKER_COLOR=['#000000','#2a2a2a','#545454','#7e7e7e','#a8a8a8','#d2d2d2','#ffffff','','#ff4040','#ff6518','#ffbb3b','#03bd9e','#00a9ff','#515ce6','#9e5fff','#ff5583'];var Colorpicker=function(){function Colorpicker(colorpickerElement,_ref){var _ref$defaultColor=_ref.defaultColor,defaultColor=_ref$defaultColor===void 0?'#7e7e7e':_ref$defaultColor,_ref$toggleDirection=_ref.toggleDirection,toggleDirection=_ref$toggleDirection===void 0?'up':_ref$toggleDirection,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Colorpicker);this.colorpickerElement=colorpickerElement;this.usageStatistics=usageStatistics;this._show=false;this._colorpickerElement=colorpickerElement;this._toggleDirection=toggleDirection;this._makePickerButtonElement(defaultColor);this._makePickerLayerElement(colorpickerElement,colorpickerElement.getAttribute('title'));this._color=defaultColor;this.picker=external_commonjs_tui_color_picker_commonjs2_tui_color_picker_amd_tui_color_picker_root_tui_colorPicker_default().create({container:this.pickerElement,preset:PICKER_COLOR,color:defaultColor,usageStatistics:this.usageStatistics});this._addEvent();}
_createClass(Colorpicker,[{key:"destroy",value:function destroy(){var _this=this;this._removeEvent();this.picker.destroy();this.colorpickerElement.innerHTML='';forEach_default()(this,function(value,key){_this[key]=null;});}},{key:"color",get:function get(){return this._color;},set:function set(color){this._color=color;this._changeColorElement(color);}},{key:"_changeColorElement",value:function _changeColorElement(color){if(color){this.colorElement.classList.remove('transparent');this.colorElement.style.backgroundColor=color;}else{this.colorElement.style.backgroundColor='#fff';this.colorElement.classList.add('transparent');}}},{key:"_makePickerButtonElement",value:function _makePickerButtonElement(defaultColor){this.colorpickerElement.classList.add('tui-image-editor-button');this.colorElement=document.createElement('div');this.colorElement.className='color-picker-value';if(defaultColor){this.colorElement.style.backgroundColor=defaultColor;}else{this.colorElement.classList.add('transparent');}}},{key:"_makePickerLayerElement",value:function _makePickerLayerElement(colorpickerElement,title){var label=document.createElement('label');var triangle=document.createElement('div');this.pickerControl=document.createElement('div');this.pickerControl.className='color-picker-control';this.pickerElement=document.createElement('div');this.pickerElement.className='color-picker';label.innerHTML=title;triangle.className='triangle';this.pickerControl.appendChild(this.pickerElement);this.pickerControl.appendChild(triangle);colorpickerElement.appendChild(this.pickerControl);colorpickerElement.appendChild(this.colorElement);colorpickerElement.appendChild(label);}},{key:"_addEvent",value:function _addEvent(){var _this2=this,_context;this.picker.on('selectColor',function(value){_this2._changeColorElement(value.color);_this2._color=value.color;_this2.fire('change',value.color);});this.eventHandler={pickerToggle:bind_default()(_context=this._pickerToggleEventHandler).call(_context,this),pickerHide:function pickerHide(){return _this2.hide();}};this.colorpickerElement.addEventListener('click',this.eventHandler.pickerToggle);document.body.addEventListener('click',this.eventHandler.pickerHide);}},{key:"_removeEvent",value:function _removeEvent(){this.colorpickerElement.removeEventListener('click',this.eventHandler.pickerToggle);document.body.removeEventListener('click',this.eventHandler.pickerHide);this.picker.off();}},{key:"_pickerToggleEventHandler",value:function _pickerToggleEventHandler(event){var target=event.target;var isInPickerControl=target&&this._isElementInColorPickerControl(target);if(!isInPickerControl||isInPickerControl&&this._isPaletteButton(target)){this._show=!this._show;this.pickerControl.style.display=this._show?'block':'none';this._setPickerControlPosition();this.fire('changeShow',this);}
event.stopPropagation();}},{key:"_isPaletteButton",value:function _isPaletteButton(target){return target.className==='tui-colorpicker-palette-button';}},{key:"_isElementInColorPickerControl",value:function _isElementInColorPickerControl(element){var parentNode=element;while(parentNode!==document.body){if(!parentNode){break;}
if(parentNode===this.pickerControl){return true;}
parentNode=parentNode.parentNode;}
return false;}},{key:"hide",value:function hide(){this._show=false;this.pickerControl.style.display='none';}},{key:"_setPickerControlPosition",value:function _setPickerControlPosition(){var controlStyle=this.pickerControl.style;var halfPickerWidth=this._colorpickerElement.clientWidth/2+2;var left=this.pickerControl.offsetWidth/2-halfPickerWidth;var top=(this.pickerControl.offsetHeight+10)*-1;if(this._toggleDirection==='down'){top=30;}
controlStyle.top="".concat(top,"px");controlStyle.left="-".concat(left,"px");}}]);return Colorpicker;}();customEvents_default().mixin(Colorpicker);var colorpicker=(Colorpicker);;var INPUT_FILTER_REGEXP=/(-?)([0-9]*)[^0-9]*([0-9]*)/g;var Range=function(){function Range(rangeElements){var _context,_context2,_context3,_context4,_context5,_context6,_context7;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Range);this._value=options.value||0;this.rangeElement=rangeElements.slider;this.rangeInputElement=rangeElements.input;this._drawRangeElement();this.rangeWidth=this._getRangeWidth();this._min=options.min||0;this._max=options.max||100;this._useDecimal=options.useDecimal;this._absMax=this._min*-1+this._max;this.realTimeEvent=options.realTimeEvent||false;this._userInputTimer=null;this.eventHandler={startChangingSlide:bind_default()(_context=this._startChangingSlide).call(_context,this),stopChangingSlide:bind_default()(_context2=this._stopChangingSlide).call(_context2,this),changeSlide:bind_default()(_context3=this._changeSlide).call(_context3,this),changeSlideFinally:bind_default()(_context4=this._changeSlideFinally).call(_context4,this),changeInput:bind_default()(_context5=this._changeInput).call(_context5,this),changeInputFinally:bind_default()(_context6=this._changeValueWithInput).call(_context6,this,true),changeInputWithArrow:bind_default()(_context7=this._changeValueWithInputKeyEvent).call(_context7,this)};this._addClickEvent();this._addDragEvent();this._addInputEvent();this.value=options.value;this.trigger('change');}
_createClass(Range,[{key:"destroy",value:function destroy(){var _this=this;this._removeClickEvent();this._removeDragEvent();this._removeInputEvent();this.rangeElement.innerHTML='';forEach_default()(this,function(value,key){_this[key]=null;});}},{key:"max",get:function get(){return this._max;},set:function set(maxValue){this._max=maxValue;this._absMax=this._min*-1+this._max;this.value=this._value;}},{key:"min",get:function get(){return this._min;},set:function set(minValue){this._min=minValue;this.max=this._max;}},{key:"value",get:function get(){return this._value;},set:function set(value){value=this._useDecimal?value:toInteger(value);var absValue=value-this._min;var leftPosition=absValue*this.rangeWidth/this._absMax;if(this.rangeWidth<leftPosition){leftPosition=this.rangeWidth;}
this.pointer.style.left="".concat(leftPosition,"px");this.subbar.style.right="".concat(this.rangeWidth-leftPosition,"px");this._value=value;if(this.rangeInputElement){this.rangeInputElement.value=value;}}},{key:"trigger",value:function trigger(type){this.fire(type,this._value);}},{key:"_getRangeWidth",value:function _getRangeWidth(){var getElementWidth=function getElementWidth(element){return toInteger(window.getComputedStyle(element,null).width);};return getElementWidth(this.rangeElement)-getElementWidth(this.pointer);}},{key:"_drawRangeElement",value:function _drawRangeElement(){this.rangeElement.classList.add('tui-image-editor-range');this.bar=document.createElement('div');this.bar.className='tui-image-editor-virtual-range-bar';this.subbar=document.createElement('div');this.subbar.className='tui-image-editor-virtual-range-subbar';this.pointer=document.createElement('div');this.pointer.className='tui-image-editor-virtual-range-pointer';this.bar.appendChild(this.subbar);this.bar.appendChild(this.pointer);this.rangeElement.appendChild(this.bar);}},{key:"_addInputEvent",value:function _addInputEvent(){if(this.rangeInputElement){this.rangeInputElement.addEventListener('keydown',this.eventHandler.changeInputWithArrow);this.rangeInputElement.addEventListener('keydown',this.eventHandler.changeInput);this.rangeInputElement.addEventListener('blur',this.eventHandler.changeInputFinally);}}},{key:"_removeInputEvent",value:function _removeInputEvent(){if(this.rangeInputElement){this.rangeInputElement.removeEventListener('keydown',this.eventHandler.changeInputWithArrow);this.rangeInputElement.removeEventListener('keydown',this.eventHandler.changeInput);this.rangeInputElement.removeEventListener('blur',this.eventHandler.changeInputFinally);}}},{key:"_changeValueWithInputKeyEvent",value:function _changeValueWithInputKeyEvent(event){var _context8;var keyCode=event.keyCode,target=event.target;if(index_of_default()(_context8=[keyCodes.ARROW_UP,keyCodes.ARROW_DOWN]).call(_context8,keyCode)<0){return;}
var value=Number(target.value);value=this._valueUpDownForKeyEvent(value,keyCode);var unChanged=value<this._min||value>this._max;if(!unChanged){var clampValue=clamp(value,this._min,this.max);this.value=clampValue;this.fire('change',clampValue,false);}}},{key:"_valueUpDownForKeyEvent",value:function _valueUpDownForKeyEvent(value,keyCode){var step=this._useDecimal?0.1:1;if(keyCode===keyCodes.ARROW_UP){value+=step;}else if(keyCode===keyCodes.ARROW_DOWN){value-=step;}
return value;}},{key:"_changeInput",value:function _changeInput(event){var _this2=this;clearTimeout(this._userInputTimer);var keyCode=event.keyCode;if(keyCode<keyCodes.DIGIT_0||keyCode>keyCodes.DIGIT_9){event.preventDefault();return;}
this._userInputTimer=set_timeout_default()(function(){_this2._inputSetValue(event.target.value);},350);}},{key:"_inputSetValue",value:function _inputSetValue(stringValue){var value=this._useDecimal?Number(stringValue):toInteger(stringValue);value=clamp(value,this._min,this.max);this.value=value;this.fire('change',value,true);}},{key:"_changeValueWithInput",value:function _changeValueWithInput(isLast,event){var _context9;var keyCode=event.keyCode,target=event.target;if(index_of_default()(_context9=[keyCodes.ARROW_UP,keyCodes.ARROW_DOWN]).call(_context9,keyCode)>=0){return;}
var stringValue=this._filterForInputText(target.value);var waitForChange=!stringValue||isNaN(stringValue);target.value=stringValue;if(!waitForChange){this._inputSetValue(stringValue);}}},{key:"_addClickEvent",value:function _addClickEvent(){this.rangeElement.addEventListener('click',this.eventHandler.changeSlideFinally);}},{key:"_removeClickEvent",value:function _removeClickEvent(){this.rangeElement.removeEventListener('click',this.eventHandler.changeSlideFinally);}},{key:"_addDragEvent",value:function _addDragEvent(){this.pointer.addEventListener('mousedown',this.eventHandler.startChangingSlide);}},{key:"_removeDragEvent",value:function _removeDragEvent(){this.pointer.removeEventListener('mousedown',this.eventHandler.startChangingSlide);}},{key:"_changeSlide",value:function _changeSlide(event){var changePosition=event.screenX;var diffPosition=changePosition-this.firstPosition;var touchPx=this.firstLeft+diffPosition;touchPx=touchPx>this.rangeWidth?this.rangeWidth:touchPx;touchPx=touchPx<0?0:touchPx;this.pointer.style.left="".concat(touchPx,"px");this.subbar.style.right="".concat(this.rangeWidth-touchPx,"px");var ratio=touchPx/this.rangeWidth;var resultValue=this._absMax*ratio+this._min;var value=this._useDecimal?resultValue:toInteger(resultValue);var isValueChanged=this.value!==value;if(isValueChanged){this.value=value;if(this.realTimeEvent){this.fire('change',this._value,false);}}}},{key:"_changeSlideFinally",value:function _changeSlideFinally(event){event.stopPropagation();if(event.target.className!=='tui-image-editor-range'){return;}
var touchPx=event.offsetX;var ratio=touchPx/this.rangeWidth;var value=this._absMax*ratio+this._min;this.pointer.style.left="".concat(ratio*this.rangeWidth,"px");this.subbar.style.right="".concat((1-ratio)*this.rangeWidth,"px");this.value=value;this.fire('change',value,true);}},{key:"_startChangingSlide",value:function _startChangingSlide(event){this.firstPosition=event.screenX;this.firstLeft=toInteger(this.pointer.style.left)||0;document.addEventListener('mousemove',this.eventHandler.changeSlide);document.addEventListener('mouseup',this.eventHandler.stopChangingSlide);}},{key:"_stopChangingSlide",value:function _stopChangingSlide(){this.fire('change',this._value,true);document.removeEventListener('mousemove',this.eventHandler.changeSlide);document.removeEventListener('mouseup',this.eventHandler.stopChangingSlide);}},{key:"_filterForInputText",value:function _filterForInputText(inputValue){return inputValue.replace(INPUT_FILTER_REGEXP,'$1$2$3');}}]);return Range;}();customEvents_default().mixin(Range);var range=(Range);;var Submenu=function(){function Submenu(subMenuElement,_ref){var locale=_ref.locale,name=_ref.name,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,templateHtml=_ref.templateHtml,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Submenu);this.subMenuElement=subMenuElement;this.menuBarPosition=menuBarPosition;this.toggleDirection=menuBarPosition==='top'?'down':'up';this.colorPickerControls=[];this.usageStatistics=usageStatistics;this.eventHandler={};this._makeSubMenuElement({locale:locale,name:name,makeSvgIcon:makeSvgIcon,templateHtml:templateHtml});}
_createClass(Submenu,[{key:"selector",value:function selector(selectName){return this.subMenuElement.querySelector(selectName);}},{key:"colorPickerChangeShow",value:function colorPickerChangeShow(occurredControl){var _context;for_each_default()(_context=this.colorPickerControls).call(_context,function(pickerControl){if(occurredControl!==pickerControl){pickerControl.hide();}});}},{key:"getButtonType",value:function getButtonType(button,buttonNames){return button.className.match(RegExp("(".concat(buttonNames.join('|'),")")))[0];}},{key:"changeClass",value:function changeClass(target,removeClass,addClass){target.classList.remove(removeClass);target.classList.add(addClass);}},{key:"changeStandbyMode",value:function changeStandbyMode(){}},{key:"changeStartMode",value:function changeStartMode(){}},{key:"_makeSubMenuElement",value:function _makeSubMenuElement(_ref2){var locale=_ref2.locale,name=_ref2.name,iconStyle=_ref2.iconStyle,makeSvgIcon=_ref2.makeSvgIcon,templateHtml=_ref2.templateHtml;var iconSubMenu=document.createElement('div');iconSubMenu.className="tui-image-editor-menu-".concat(name);iconSubMenu.innerHTML=templateHtml({locale:locale,iconStyle:iconStyle,makeSvgIcon:makeSvgIcon});this.subMenuElement.appendChild(iconSubMenu);}},{key:"_onStartEditingInputBox",value:function _onStartEditingInputBox(){this.fire(eventNames.INPUT_BOX_EDITING_STARTED);}},{key:"_onStopEditingInputBox",value:function _onStopEditingInputBox(){this.fire(eventNames.INPUT_BOX_EDITING_STOPPED);}}]);return Submenu;}();customEvents_default().mixin(Submenu);var submenuBase=(Submenu);;var shape=(function(_ref){var _context,_context2,_context3,_context4,_context5,_context6,_context7,_context8;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5=concat_default()(_context6=concat_default()(_context7=concat_default()(_context8="\n    <ul class=\"tui-image-editor-submenu-item\">\n        <li class=\"tie-shape-button\">\n            <div class=\"tui-image-editor-button rect\">\n                <div>\n                    ".concat(makeSvgIcon(['normal','active'],'shape-rectangle',true),"\n                </div>\n                <label> ")).call(_context8,locale.localize('Rectangle')," </label>\n            </div>\n            <div class=\"tui-image-editor-button circle\">\n                <div>\n                    ")).call(_context7,makeSvgIcon(['normal','active'],'shape-circle',true),"\n                </div>\n                <label> ")).call(_context6,locale.localize('Circle')," </label>\n            </div>\n            <div class=\"tui-image-editor-button triangle\">\n                <div>\n                    ")).call(_context5,makeSvgIcon(['normal','active'],'shape-triangle',true),"\n                </div>\n                <label> ")).call(_context4,locale.localize('Triangle')," </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition\">\n            <div></div>\n        </li>\n        <li class=\"tie-shape-color-button\">\n            <div class=\"tie-color-fill\" title=\"")).call(_context3,locale.localize('Fill'),"\"></div>\n            <div class=\"tie-color-stroke\" title=\"")).call(_context2,locale.localize('Stroke'),"\"></div>\n        </li>\n        <li class=\"tui-image-editor-partition only-left-right\">\n            <div></div>\n        </li>\n        <li class=\"tui-image-editor-newline tui-image-editor-range-wrap\">\n            <label class=\"range\">")).call(_context,locale.localize('Stroke'),"</label>\n            <div class=\"tie-stroke-range\"></div>\n            <input class=\"tie-stroke-range-value tui-image-editor-range-value\" value=\"0\" />\n        </li>\n    </ul>\n");});;function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var SHAPE_DEFAULT_OPTION={stroke:'#ffbb3b',fill:'',strokeWidth:3};var Shape=function(_Submenu){_inherits(Shape,_Submenu);var _super=_createSuper(Shape);function Shape(subMenuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Shape);_this=_super.call(this,subMenuElement,{locale:locale,name:'shape',makeSvgIcon:makeSvgIcon,menuBarPosition:menuBarPosition,templateHtml:shape,usageStatistics:usageStatistics});_this.type=null;_this.options=SHAPE_DEFAULT_OPTION;_this._els={shapeSelectButton:_this.selector('.tie-shape-button'),shapeColorButton:_this.selector('.tie-shape-color-button'),strokeRange:new range({slider:_this.selector('.tie-stroke-range'),input:_this.selector('.tie-stroke-range-value')},defaultShapeStrokeValues),fillColorpicker:new colorpicker(_this.selector('.tie-color-fill'),{defaultColor:'',toggleDirection:_this.toggleDirection,usageStatistics:_this.usageStatistics}),strokeColorpicker:new colorpicker(_this.selector('.tie-color-stroke'),{defaultColor:'#ffbb3b',toggleDirection:_this.toggleDirection,usageStatistics:_this.usageStatistics})};_this.colorPickerControls.push(_this._els.fillColorpicker);_this.colorPickerControls.push(_this._els.strokeColorpicker);_this.colorPickerInputBoxes=[];_this.colorPickerInputBoxes.push(_this._els.fillColorpicker.colorpickerElement.querySelector(selectorNames.COLOR_PICKER_INPUT_BOX));_this.colorPickerInputBoxes.push(_this._els.strokeColorpicker.colorpickerElement.querySelector(selectorNames.COLOR_PICKER_INPUT_BOX));return _this;}
_createClass(Shape,[{key:"destroy",value:function destroy(){this._removeEvent();this._els.strokeRange.destroy();this._els.fillColorpicker.destroy();this._els.strokeColorpicker.destroy();assignmentForDestroy(this);}},{key:"addEvent",value:function addEvent(actions){var _context,_context2,_context3,_context4,_context5,_context6,_this2=this;this.eventHandler.shapeTypeSelected=bind_default()(_context=this._changeShapeHandler).call(_context,this);this.actions=actions;this._els.shapeSelectButton.addEventListener('click',this.eventHandler.shapeTypeSelected);this._els.strokeRange.on('change',bind_default()(_context2=this._changeStrokeRangeHandler).call(_context2,this));this._els.fillColorpicker.on('change',bind_default()(_context3=this._changeFillColorHandler).call(_context3,this));this._els.strokeColorpicker.on('change',bind_default()(_context4=this._changeStrokeColorHandler).call(_context4,this));this._els.fillColorpicker.on('changeShow',bind_default()(_context5=this.colorPickerChangeShow).call(_context5,this));this._els.strokeColorpicker.on('changeShow',bind_default()(_context6=this.colorPickerChangeShow).call(_context6,this));forEachArray_default()(this.colorPickerInputBoxes,function(inputBox){var _context7,_context8;inputBox.addEventListener(eventNames.FOCUS,bind_default()(_context7=_this2._onStartEditingInputBox).call(_context7,_this2));inputBox.addEventListener(eventNames.BLUR,bind_default()(_context8=_this2._onStopEditingInputBox).call(_context8,_this2));},this);}},{key:"_removeEvent",value:function _removeEvent(){var _this3=this;this._els.shapeSelectButton.removeEventListener('click',this.eventHandler.shapeTypeSelected);this._els.strokeRange.off();this._els.fillColorpicker.off();this._els.strokeColorpicker.off();forEachArray_default()(this.colorPickerInputBoxes,function(inputBox){var _context9,_context10;inputBox.removeEventListener(eventNames.FOCUS,bind_default()(_context9=_this3._onStartEditingInputBox).call(_context9,_this3));inputBox.removeEventListener(eventNames.BLUR,bind_default()(_context10=_this3._onStopEditingInputBox).call(_context10,_this3));},this);}},{key:"setShapeStatus",value:function setShapeStatus(_ref2){var strokeWidth=_ref2.strokeWidth,strokeColor=_ref2.strokeColor,fillColor=_ref2.fillColor;this._els.strokeRange.value=strokeWidth;this._els.strokeColorpicker.color=strokeColor;this._els.fillColorpicker.color=fillColor;this.options.stroke=strokeColor;this.options.fill=fillColor;this.options.strokeWidth=strokeWidth;this.actions.setDrawingShape(this.type,{strokeWidth:strokeWidth});}},{key:"changeStartMode",value:function changeStartMode(){this.actions.stopDrawingMode();}},{key:"changeStandbyMode",value:function changeStandbyMode(){this.type=null;this.actions.changeSelectableAll(true);this._els.shapeSelectButton.classList.remove('circle');this._els.shapeSelectButton.classList.remove('triangle');this._els.shapeSelectButton.classList.remove('rect');}},{key:"setMaxStrokeValue",value:function setMaxStrokeValue(maxValue){var strokeMaxValue=maxValue;if(strokeMaxValue<=0){strokeMaxValue=defaultShapeStrokeValues.max;}
this._els.strokeRange.max=strokeMaxValue;}},{key:"setStrokeValue",value:function setStrokeValue(value){this._els.strokeRange.value=value;this._els.strokeRange.trigger('change');}},{key:"getStrokeValue",value:function getStrokeValue(){return this._els.strokeRange.value;}},{key:"_changeShapeHandler",value:function _changeShapeHandler(event){var button=event.target.closest('.tui-image-editor-button');if(button){this.actions.stopDrawingMode();this.actions.discardSelection();var shapeType=this.getButtonType(button,['circle','triangle','rect']);if(this.type===shapeType){this.changeStandbyMode();return;}
this.changeStandbyMode();this.type=shapeType;event.currentTarget.classList.add(shapeType);this.actions.changeSelectableAll(false);this.actions.modeChange('shape');}}},{key:"_changeStrokeRangeHandler",value:function _changeStrokeRangeHandler(value,isLast){this.options.strokeWidth=toInteger(value);this.actions.changeShape({strokeWidth:value},!isLast);this.actions.setDrawingShape(this.type,this.options);}},{key:"_changeFillColorHandler",value:function _changeFillColorHandler(color){color=color||'transparent';this.options.fill=color;this.actions.changeShape({fill:color});}},{key:"_changeStrokeColorHandler",value:function _changeStrokeColorHandler(color){color=color||'transparent';this.options.stroke=color;this.actions.changeShape({stroke:color});}}]);return Shape;}(submenuBase);var ui_shape=(Shape);;var crop=(function(_ref){var _context,_context2,_context3,_context4,_context5,_context6,_context7,_context8,_context9,_context10,_context11,_context12,_context13,_context14,_context15,_context16,_context17;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5=concat_default()(_context6=concat_default()(_context7=concat_default()(_context8=concat_default()(_context9=concat_default()(_context10=concat_default()(_context11=concat_default()(_context12=concat_default()(_context13=concat_default()(_context14=concat_default()(_context15=concat_default()(_context16=concat_default()(_context17="\n    <ul class=\"tui-image-editor-submenu-item\">\n        <li class=\"tie-crop-preset-button\">\n            <div class=\"tui-image-editor-button preset preset-none active\">\n                <div>\n                    ".concat(makeSvgIcon(['normal','active'],'shape-rectangle',true),"\n                </div>\n                <label> ")).call(_context17,locale.localize('Custom')," </label>\n            </div>\n            <div class=\"tui-image-editor-button preset preset-square\">\n                <div>\n                    ")).call(_context16,makeSvgIcon(['normal','active'],'crop',true),"\n                </div>\n                <label> ")).call(_context15,locale.localize('Square')," </label>\n            </div>\n            <div class=\"tui-image-editor-button preset preset-3-2\">\n                <div>\n                    ")).call(_context14,makeSvgIcon(['normal','active'],'crop',true),"\n                </div>\n                <label> ")).call(_context13,locale.localize('3:2')," </label>\n            </div>\n            <div class=\"tui-image-editor-button preset preset-4-3\">\n                <div>\n                    ")).call(_context12,makeSvgIcon(['normal','active'],'crop',true),"\n                </div>\n                <label> ")).call(_context11,locale.localize('4:3')," </label>\n            </div>\n            <div class=\"tui-image-editor-button preset preset-5-4\">\n                <div>\n                    ")).call(_context10,makeSvgIcon(['normal','active'],'crop',true),"\n                </div>\n                <label> ")).call(_context9,locale.localize('5:4')," </label>\n            </div>\n            <div class=\"tui-image-editor-button preset preset-7-5\">\n                <div>\n                    ")).call(_context8,makeSvgIcon(['normal','active'],'crop',true),"\n                </div>\n                <label> ")).call(_context7,locale.localize('7:5')," </label>\n            </div>\n            <div class=\"tui-image-editor-button preset preset-16-9\">\n                <div>\n                    ")).call(_context6,makeSvgIcon(['normal','active'],'crop',true),"\n                </div>\n                <label> ")).call(_context5,locale.localize('16:9')," </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition tui-image-editor-newline\">\n        </li>\n        <li class=\"tui-image-editor-partition only-left-right\">\n            <div></div>\n        </li>\n        <li class=\"tie-crop-button action\">\n            <div class=\"tui-image-editor-button apply\">\n                ")).call(_context4,makeSvgIcon(['normal','active'],'apply'),"\n                <label>\n                    ")).call(_context3,locale.localize('Apply'),"\n                </label>\n            </div>\n            <div class=\"tui-image-editor-button cancel\">\n                ")).call(_context2,makeSvgIcon(['normal','active'],'cancel'),"\n                <label>\n                    ")).call(_context,locale.localize('Cancel'),"\n                </label>\n            </div>\n        </li>\n    </ul>\n");});;function crop_createSuper(Derived){var hasNativeReflectConstruct=crop_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function crop_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var Crop=function(_Submenu){_inherits(Crop,_Submenu);var _super=crop_createSuper(Crop);function Crop(subMenuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Crop);_this=_super.call(this,subMenuElement,{locale:locale,name:'crop',makeSvgIcon:makeSvgIcon,menuBarPosition:menuBarPosition,templateHtml:crop,usageStatistics:usageStatistics});_this.status='active';_this._els={apply:_this.selector('.tie-crop-button .apply'),cancel:_this.selector('.tie-crop-button .cancel'),preset:_this.selector('.tie-crop-preset-button')};_this.defaultPresetButton=_this._els.preset.querySelector('.preset-none');return _this;}
_createClass(Crop,[{key:"destroy",value:function destroy(){this._removeEvent();assignmentForDestroy(this);}},{key:"addEvent",value:function addEvent(actions){var _context,_context2,_context3;var apply=bind_default()(_context=this._applyEventHandler).call(_context,this);var cancel=bind_default()(_context2=this._cancelEventHandler).call(_context2,this);var cropzonePreset=bind_default()(_context3=this._cropzonePresetEventHandler).call(_context3,this);this.eventHandler={apply:apply,cancel:cancel,cropzonePreset:cropzonePreset};this.actions=actions;this._els.apply.addEventListener('click',apply);this._els.cancel.addEventListener('click',cancel);this._els.preset.addEventListener('click',cropzonePreset);}},{key:"_removeEvent",value:function _removeEvent(){this._els.apply.removeEventListener('click',this.eventHandler.apply);this._els.cancel.removeEventListener('click',this.eventHandler.cancel);this._els.preset.removeEventListener('click',this.eventHandler.cropzonePreset);}},{key:"_applyEventHandler",value:function _applyEventHandler(){this.actions.crop();this._els.apply.classList.remove('active');}},{key:"_cancelEventHandler",value:function _cancelEventHandler(){this.actions.cancel();this._els.apply.classList.remove('active');}},{key:"_cropzonePresetEventHandler",value:function _cropzonePresetEventHandler(event){var button=event.target.closest('.tui-image-editor-button.preset');if(button){var _button$className$mat=button.className.match(/preset-[^\s]+/),_button$className$mat2=_slicedToArray(_button$className$mat,1),presetType=_button$className$mat2[0];this._setPresetButtonActive(button);this.actions.preset(presetType);}}},{key:"changeStartMode",value:function changeStartMode(){this.actions.modeChange('crop');}},{key:"changeStandbyMode",value:function changeStandbyMode(){this.actions.stopDrawingMode();this._setPresetButtonActive();}},{key:"changeApplyButtonStatus",value:function changeApplyButtonStatus(enableStatus){if(enableStatus){this._els.apply.classList.add('active');}else{this._els.apply.classList.remove('active');}}},{key:"_setPresetButtonActive",value:function _setPresetButtonActive(){var button=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.defaultPresetButton;forEach_default()(this._els.preset.querySelectorAll('.preset'),function(presetButton){presetButton.classList.remove('active');});if(button){button.classList.add('active');}}}]);return Crop;}(submenuBase);var ui_crop=(Crop);;var resize=(function(_ref){var _context,_context2,_context3,_context4,_context5,_context6;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5=concat_default()(_context6="\n    <ul class=\"tui-image-editor-submenu-item\">\n        <li class=\"tui-image-editor-submenu-align\">\n            <div class=\"tui-image-editor-range-wrap tui-image-editor-newline\">\n                <label class=\"range\">".concat(locale.localize('Width'),"&nbsp;</label>\n                <div class=\"tie-width-range\"></div>\n                <input class=\"tie-width-range-value tui-image-editor-range-value\" value=\"0\" /> <label>px</label>\n                <div class=\"tui-image-editor-partition tui-image-editor-newline\"></div>\n                <label class=\"range\">")).call(_context6,locale.localize('Height'),"</label>\n                <div class=\"tie-height-range\"></div>\n                <input class=\"tie-height-range-value tui-image-editor-range-value\" value=\"0\" /> <label>px</label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition tui-image-editor-newline\"></li>\n        <li class=\"tui-image-editor-partition only-left-right\">\n            <div></div>\n        </li>\n        <li class=\"tui-image-editor-submenu-align\">\n            <div class=\"tui-image-editor-checkbox-wrap\">\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-lock-aspect-ratio\">\n                        <span>")).call(_context5,locale.localize('Lock Aspect Ratio'),"</span>\n                    </label>\n                </div>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition tui-image-editor-newline\"></li>\n        <li class=\"tui-image-editor-partition only-left-right\">\n            <div></div>\n        </li>\n        <li class=\"tui-image-editor-partition tui-image-editor-newline\"></li>\n        <li class=\"tie-resize-button action\">\n            <div class=\"tui-image-editor-button apply\">\n                ")).call(_context4,makeSvgIcon(['normal','active'],'apply'),"\n                <label>\n                    ")).call(_context3,locale.localize('Apply'),"\n                </label>\n            </div>\n            <div class=\"tui-image-editor-button cancel\">\n                ")).call(_context2,makeSvgIcon(['normal','active'],'cancel'),"\n                <label>\n                    ")).call(_context,locale.localize('Cancel'),"\n                </label>\n            </div>\n        </li>\n    </ul>\n");});;function resize_createSuper(Derived){var hasNativeReflectConstruct=resize_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function resize_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var Resize=function(_Submenu){_inherits(Resize,_Submenu);var _super=resize_createSuper(Resize);function Resize(subMenuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Resize);_this=_super.call(this,subMenuElement,{locale:locale,name:'resize',makeSvgIcon:makeSvgIcon,menuBarPosition:menuBarPosition,templateHtml:resize,usageStatistics:usageStatistics});_this.status='active';_this._lockState=false;_this._originalDimensions=null;_this._els={widthRange:new range({slider:_this.selector('.tie-width-range'),input:_this.selector('.tie-width-range-value')},defaultResizePixelValues),heightRange:new range({slider:_this.selector('.tie-height-range'),input:_this.selector('.tie-height-range-value')},defaultResizePixelValues),lockAspectRatio:_this.selector('.tie-lock-aspect-ratio'),apply:_this.selector('.tie-resize-button .apply'),cancel:_this.selector('.tie-resize-button .cancel')};return _this;}
_createClass(Resize,[{key:"changeStartMode",value:function changeStartMode(){this.actions.modeChange('resize');var dimensions=this.actions.getCurrentDimensions();this._originalDimensions=dimensions;this.setWidthValue(dimensions.width);this.setHeightValue(dimensions.height);}},{key:"changeStandbyMode",value:function changeStandbyMode(){this.actions.stopDrawingMode();this.actions.reset(true);}},{key:"setLimit",value:function setLimit(limits){this._els.widthRange.min=this.calcMinValue(limits.minWidth);this._els.heightRange.min=this.calcMinValue(limits.minHeight);this._els.widthRange.max=this.calcMaxValue(limits.maxWidth);this._els.heightRange.max=this.calcMaxValue(limits.maxHeight);}},{key:"calcMaxValue",value:function calcMaxValue(maxValue){if(maxValue<=0){maxValue=defaultResizePixelValues.max;}
return maxValue;}},{key:"calcMinValue",value:function calcMinValue(minValue){if(minValue<=0){minValue=defaultResizePixelValues.min;}
return minValue;}},{key:"setWidthValue",value:function setWidthValue(value){var trigger=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this._els.widthRange.value=value;if(trigger){this._els.widthRange.trigger('change');}}},{key:"setHeightValue",value:function setHeightValue(value){var trigger=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this._els.heightRange.value=value;if(trigger){this._els.heightRange.trigger('change');}}},{key:"destroy",value:function destroy(){this._removeEvent();assignmentForDestroy(this);}},{key:"addEvent",value:function addEvent(actions){var _context,_context2,_context3,_context4,_context5;this._els.widthRange.on('change',bind_default()(_context=this._changeWidthRangeHandler).call(_context,this));this._els.heightRange.on('change',bind_default()(_context2=this._changeHeightRangeHandler).call(_context2,this));this._els.lockAspectRatio.addEventListener('change',bind_default()(_context3=this._changeLockAspectRatio).call(_context3,this));var apply=bind_default()(_context4=this._applyEventHandler).call(_context4,this);var cancel=bind_default()(_context5=this._cancelEventHandler).call(_context5,this);this.eventHandler={apply:apply,cancel:cancel};this.actions=actions;this._els.apply.addEventListener('click',apply);this._els.cancel.addEventListener('click',cancel);}},{key:"_changeWidthRangeHandler",value:function _changeWidthRangeHandler(value){this.actions.preview('width',toInteger(value),this._lockState);}},{key:"_changeHeightRangeHandler",value:function _changeHeightRangeHandler(value){this.actions.preview('height',toInteger(value),this._lockState);}},{key:"_changeLockAspectRatio",value:function _changeLockAspectRatio(event){this._lockState=event.target.checked;this.actions.lockAspectRatio(this._lockState,defaultResizePixelValues.min,defaultResizePixelValues.max);}},{key:"_removeEvent",value:function _removeEvent(){this._els.apply.removeEventListener('click',this.eventHandler.apply);this._els.cancel.removeEventListener('click',this.eventHandler.cancel);}},{key:"_applyEventHandler",value:function _applyEventHandler(){this.actions.resize();this._els.apply.classList.remove('active');}},{key:"_cancelEventHandler",value:function _cancelEventHandler(){this.actions.reset();this._els.cancel.classList.remove('active');}},{key:"changeApplyButtonStatus",value:function changeApplyButtonStatus(enableStatus){if(enableStatus){this._els.apply.classList.add('active');}else{this._els.apply.classList.remove('active');}}}]);return Resize;}(submenuBase);var ui_resize=(Resize);;var flip=(function(_ref){var _context,_context2,_context3,_context4,_context5;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5="\n    <ul class=\"tie-flip-button tui-image-editor-submenu-item\">\n        <li>\n            <div class=\"tui-image-editor-button flipX\">\n                <div>\n                    ".concat(makeSvgIcon(['normal','active'],'flip-x',true),"\n                </div>\n                <label>\n                    ")).call(_context5,locale.localize('Flip X'),"\n                </label>\n            </div>\n            <div class=\"tui-image-editor-button flipY\">\n                <div>\n                    ")).call(_context4,makeSvgIcon(['normal','active'],'flip-y',true),"\n                </div>\n                <label>\n                    ")).call(_context3,locale.localize('Flip Y'),"\n                </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition\">\n            <div></div>\n        </li>\n        <li>\n            <div class=\"tui-image-editor-button resetFlip\">\n                <div>\n                    ")).call(_context2,makeSvgIcon(['normal','active'],'flip-reset',true),"\n                </div>\n                <label>\n                    ")).call(_context,locale.localize('Reset'),"\n                </label>\n            </div>\n        </li>\n    </ul>\n");});;function flip_createSuper(Derived){var hasNativeReflectConstruct=flip_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function flip_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var Flip=function(_Submenu){_inherits(Flip,_Submenu);var _super=flip_createSuper(Flip);function Flip(subMenuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Flip);_this=_super.call(this,subMenuElement,{locale:locale,name:'flip',makeSvgIcon:makeSvgIcon,menuBarPosition:menuBarPosition,templateHtml:flip,usageStatistics:usageStatistics});_this.flipStatus=false;_this._els={flipButton:_this.selector('.tie-flip-button')};return _this;}
_createClass(Flip,[{key:"destroy",value:function destroy(){this._removeEvent();assignmentForDestroy(this);}},{key:"addEvent",value:function addEvent(actions){var _context;this.eventHandler.changeFlip=bind_default()(_context=this._changeFlip).call(_context,this);this._actions=actions;this._els.flipButton.addEventListener('click',this.eventHandler.changeFlip);}},{key:"_removeEvent",value:function _removeEvent(){this._els.flipButton.removeEventListener('click',this.eventHandler.changeFlip);}},{key:"_changeFlip",value:function _changeFlip(event){var _this2=this;var button=event.target.closest('.tui-image-editor-button');if(button){var flipType=this.getButtonType(button,['flipX','flipY','resetFlip']);if(!this.flipStatus&&flipType==='resetFlip'){return;}
this._actions.flip(flipType).then(function(flipStatus){var flipClassList=_this2._els.flipButton.classList;_this2.flipStatus=false;flipClassList.remove('resetFlip');forEach_default()(['flipX','flipY'],function(type){flipClassList.remove(type);if(flipStatus[type]){flipClassList.add(type);flipClassList.add('resetFlip');_this2.flipStatus=true;}});});}}}]);return Flip;}(submenuBase);var ui_flip=(Flip);;var rotate=(function(_ref){var _context,_context2;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;return concat_default()(_context=concat_default()(_context2="\n    <ul class=\"tui-image-editor-submenu-item\">\n        <li class=\"tie-rotate-button\">\n            <div class=\"tui-image-editor-button clockwise\">\n                <div>\n                    ".concat(makeSvgIcon(['normal','active'],'rotate-clockwise',true),"\n                </div>\n                <label> 30 </label>\n            </div>\n            <div class=\"tui-image-editor-button counterclockwise\">\n                <div>\n                    ")).call(_context2,makeSvgIcon(['normal','active'],'rotate-counterclockwise',true),"\n                </div>\n                <label> -30 </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition only-left-right\">\n            <div></div>\n        </li>\n        <li class=\"tui-image-editor-newline tui-image-editor-range-wrap\">\n            <label class=\"range\">")).call(_context,locale.localize('Range'),"</label>\n            <div class=\"tie-rotate-range\"></div>\n            <input class=\"tie-rotate-range-value tui-image-editor-range-value\" value=\"0\" />\n        </li>\n    </ul>\n");});;function rotate_createSuper(Derived){var hasNativeReflectConstruct=rotate_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function rotate_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var CLOCKWISE=30;var COUNTERCLOCKWISE=-30;var Rotate=function(_Submenu){_inherits(Rotate,_Submenu);var _super=rotate_createSuper(Rotate);function Rotate(subMenuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Rotate);_this=_super.call(this,subMenuElement,{locale:locale,name:'rotate',makeSvgIcon:makeSvgIcon,menuBarPosition:menuBarPosition,templateHtml:rotate,usageStatistics:usageStatistics});_this._value=0;_this._els={rotateButton:_this.selector('.tie-rotate-button'),rotateRange:new range({slider:_this.selector('.tie-rotate-range'),input:_this.selector('.tie-rotate-range-value')},defaultRotateRangeValues)};return _this;}
_createClass(Rotate,[{key:"destroy",value:function destroy(){this._removeEvent();this._els.rotateRange.destroy();assignmentForDestroy(this);}},{key:"setRangeBarAngle",value:function setRangeBarAngle(type,angle){var resultAngle=angle;if(type==='rotate'){resultAngle=parse_int_default()(this._els.rotateRange.value,10)+angle;}
this._setRangeBarRatio(resultAngle);}},{key:"_setRangeBarRatio",value:function _setRangeBarRatio(angle){this._els.rotateRange.value=angle;}},{key:"addEvent",value:function addEvent(actions){var _context,_context2;this.eventHandler.rotationAngleChanged=bind_default()(_context=this._changeRotateForButton).call(_context,this);this.actions=actions;this._els.rotateButton.addEventListener('click',this.eventHandler.rotationAngleChanged);this._els.rotateRange.on('change',bind_default()(_context2=this._changeRotateForRange).call(_context2,this));}},{key:"_removeEvent",value:function _removeEvent(){this._els.rotateButton.removeEventListener('click',this.eventHandler.rotationAngleChanged);this._els.rotateRange.off();}},{key:"_changeRotateForRange",value:function _changeRotateForRange(value,isLast){var angle=toInteger(value);this.actions.setAngle(angle,!isLast);this._value=angle;}},{key:"_changeRotateForButton",value:function _changeRotateForButton(event){var button=event.target.closest('.tui-image-editor-button');var angle=this._els.rotateRange.value;if(button){var rotateType=this.getButtonType(button,['counterclockwise','clockwise']);var rotateAngle={clockwise:CLOCKWISE,counterclockwise:COUNTERCLOCKWISE}[rotateType];var newAngle=parse_int_default()(angle,10)+rotateAngle;var isRotatable=newAngle>=-360&&newAngle<=360;if(isRotatable){this.actions.rotate(rotateAngle);}}}}]);return Rotate;}(submenuBase);var ui_rotate=(Rotate);;var submenu_text=(function(_ref){var _context,_context2,_context3,_context4,_context5,_context6,_context7,_context8,_context9,_context10,_context11,_context12,_context13;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5=concat_default()(_context6=concat_default()(_context7=concat_default()(_context8=concat_default()(_context9=concat_default()(_context10=concat_default()(_context11=concat_default()(_context12=concat_default()(_context13="\n    <ul class=\"tui-image-editor-submenu-item\">\n        <li class=\"tie-text-effect-button\">\n            <div class=\"tui-image-editor-button bold\">\n                <div>\n                    ".concat(makeSvgIcon(['normal','active'],'text-bold',true),"\n                </div>\n                <label> ")).call(_context13,locale.localize('Bold')," </label>\n            </div>\n            <div class=\"tui-image-editor-button italic\">\n                <div>\n                    ")).call(_context12,makeSvgIcon(['normal','active'],'text-italic',true),"\n                </div>\n                <label> ")).call(_context11,locale.localize('Italic')," </label>\n            </div>\n            <div class=\"tui-image-editor-button underline\">\n                <div>\n                    ")).call(_context10,makeSvgIcon(['normal','active'],'text-underline',true),"\n                </div>\n                <label> ")).call(_context9,locale.localize('Underline')," </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition\">\n            <div></div>\n        </li>\n        <li class=\"tie-text-align-button\">\n            <div class=\"tui-image-editor-button left\">\n                <div>\n                    ")).call(_context8,makeSvgIcon(['normal','active'],'text-align-left',true),"\n                </div>\n                <label> ")).call(_context7,locale.localize('Left')," </label>\n            </div>\n            <div class=\"tui-image-editor-button center\">\n                <div>\n                    ")).call(_context6,makeSvgIcon(['normal','active'],'text-align-center',true),"\n                </div>\n                <label> ")).call(_context5,locale.localize('Center')," </label>\n            </div>\n            <div class=\"tui-image-editor-button right\">\n                <div>\n                    ")).call(_context4,makeSvgIcon(['normal','active'],'text-align-right',true),"\n                </div>\n                <label> ")).call(_context3,locale.localize('Right')," </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition\">\n            <div></div>\n        </li>\n        <li>\n            <div class=\"tie-text-color\" title=\"")).call(_context2,locale.localize('Color'),"\"></div>\n        </li>\n        <li class=\"tui-image-editor-partition only-left-right\">\n            <div></div>\n        </li>\n        <li class=\"tui-image-editor-newline tui-image-editor-range-wrap\">\n            <label class=\"range\">")).call(_context,locale.localize('Text size'),"</label>\n            <div class=\"tie-text-range\"></div>\n            <input class=\"tie-text-range-value tui-image-editor-range-value\" value=\"0\" />\n        </li>\n    </ul>\n");});;function text_createSuper(Derived){var hasNativeReflectConstruct=text_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function text_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var Text=function(_Submenu){_inherits(Text,_Submenu);var _super=text_createSuper(Text);function Text(subMenuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Text);_this=_super.call(this,subMenuElement,{locale:locale,name:'text',makeSvgIcon:makeSvgIcon,menuBarPosition:menuBarPosition,templateHtml:submenu_text,usageStatistics:usageStatistics});_this.effect={bold:false,italic:false,underline:false};_this.align='tie-text-align-left';_this._els={textEffectButton:_this.selector('.tie-text-effect-button'),textAlignButton:_this.selector('.tie-text-align-button'),textColorpicker:new colorpicker(_this.selector('.tie-text-color'),{defaultColor:'#ffbb3b',toggleDirection:_this.toggleDirection,usageStatistics:_this.usageStatistics}),textRange:new range({slider:_this.selector('.tie-text-range'),input:_this.selector('.tie-text-range-value')},defaultTextRangeValues)};_this.colorPickerInputBox=_this._els.textColorpicker.colorpickerElement.querySelector(selectorNames.COLOR_PICKER_INPUT_BOX);return _this;}
_createClass(Text,[{key:"destroy",value:function destroy(){this._removeEvent();this._els.textColorpicker.destroy();this._els.textRange.destroy();assignmentForDestroy(this);}},{key:"addEvent",value:function addEvent(actions){var _context,_context2,_context3,_context4,_context5,_context6;var setTextEffect=bind_default()(_context=this._setTextEffectHandler).call(_context,this);var setTextAlign=bind_default()(_context2=this._setTextAlignHandler).call(_context2,this);this.eventHandler={setTextEffect:setTextEffect,setTextAlign:setTextAlign};this.actions=actions;this._els.textEffectButton.addEventListener('click',setTextEffect);this._els.textAlignButton.addEventListener('click',setTextAlign);this._els.textRange.on('change',bind_default()(_context3=this._changeTextRnageHandler).call(_context3,this));this._els.textColorpicker.on('change',bind_default()(_context4=this._changeColorHandler).call(_context4,this));this.colorPickerInputBox.addEventListener(eventNames.FOCUS,bind_default()(_context5=this._onStartEditingInputBox).call(_context5,this));this.colorPickerInputBox.addEventListener(eventNames.BLUR,bind_default()(_context6=this._onStopEditingInputBox).call(_context6,this));}},{key:"_removeEvent",value:function _removeEvent(){var _context7,_context8;var _this$eventHandler=this.eventHandler,setTextEffect=_this$eventHandler.setTextEffect,setTextAlign=_this$eventHandler.setTextAlign;this._els.textEffectButton.removeEventListener('click',setTextEffect);this._els.textAlignButton.removeEventListener('click',setTextAlign);this._els.textRange.off();this._els.textColorpicker.off();this.colorPickerInputBox.removeEventListener(eventNames.FOCUS,bind_default()(_context7=this._onStartEditingInputBox).call(_context7,this));this.colorPickerInputBox.removeEventListener(eventNames.BLUR,bind_default()(_context8=this._onStopEditingInputBox).call(_context8,this));}},{key:"changeStandbyMode",value:function changeStandbyMode(){this.actions.stopDrawingMode();}},{key:"changeStartMode",value:function changeStartMode(){this.actions.modeChange('text');}},{key:"textColor",get:function get(){return this._els.textColorpicker.color;},set:function set(color){this._els.textColorpicker.color=color;}},{key:"fontSize",get:function get(){return this._els.textRange.value;},set:function set(value){this._els.textRange.value=value;}},{key:"fontStyle",get:function get(){return this.effect.italic?'italic':'normal';}},{key:"fontWeight",get:function get(){return this.effect.bold?'bold':'normal';}},{key:"underline",get:function get(){return this.effect.underline;}},{key:"setTextStyleStateOnAction",value:function setTextStyleStateOnAction(){var textStyle=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var fill=fill_default()(textStyle),fontSize=textStyle.fontSize,fontStyle=textStyle.fontStyle,fontWeight=textStyle.fontWeight,textDecoration=textStyle.textDecoration,textAlign=textStyle.textAlign;this.textColor=fill;this.fontSize=fontSize;this.setEffectState('italic',fontStyle);this.setEffectState('bold',fontWeight);this.setEffectState('underline',textDecoration);this.setAlignState("tie-text-align-".concat(textAlign));}},{key:"setEffectState",value:function setEffectState(effectName,value){var effectValue=value==='italic'||value==='bold'||value==='underline';var button=this._els.textEffectButton.querySelector(".tui-image-editor-button.".concat(effectName));this.effect[effectName]=effectValue;button.classList[effectValue?'add':'remove']('active');}},{key:"setAlignState",value:function setAlignState(value){var button=this._els.textAlignButton;button.classList.remove(this.align);button.classList.add(value);this.align=value;}},{key:"_setTextEffectHandler",value:function _setTextEffectHandler(event){var button=event.target.closest('.tui-image-editor-button');if(button){var _button$className$mat=button.className.match(/(bold|italic|underline)/),_button$className$mat2=_slicedToArray(_button$className$mat,1),styleType=_button$className$mat2[0];var styleObj={bold:{fontWeight:'bold'},italic:{fontStyle:'italic'},underline:{textDecoration:'underline'}}[styleType];this.effect[styleType]=!this.effect[styleType];button.classList.toggle('active');this.actions.changeTextStyle(styleObj);}}},{key:"_setTextAlignHandler",value:function _setTextAlignHandler(event){var button=event.target.closest('.tui-image-editor-button');if(button){var styleType=this.getButtonType(button,['left','center','right']);var styleTypeAlias="tie-text-align-".concat(styleType);event.currentTarget.classList.remove(this.align);if(this.align!==styleTypeAlias){event.currentTarget.classList.add(styleTypeAlias);}
this.actions.changeTextStyle({textAlign:styleType});this.align=styleTypeAlias;}}},{key:"_changeTextRnageHandler",value:function _changeTextRnageHandler(value,isLast){this.actions.changeTextStyle({fontSize:value},!isLast);}},{key:"_changeColorHandler",value:function _changeColorHandler(color){color=color||'transparent';this.actions.changeTextStyle({fill:color});}}]);return Text;}(submenuBase);var ui_text=(Text);;var mask=(function(_ref){var _context,_context2,_context3;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3="\n    <ul class=\"tui-image-editor-submenu-item\">\n        <li>\n            <div class=\"tui-image-editor-button\">\n                <div>\n                    <input type=\"file\" accept=\"image/*\" class=\"tie-mask-image-file\">\n                    ".concat(makeSvgIcon(['normal','active'],'mask-load',true),"\n                </div>\n                <label> ")).call(_context3,locale.localize('Load Mask Image')," </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition only-left-right\">\n            <div></div>\n        </li>\n        <li class=\"tie-mask-apply tui-image-editor-newline apply\" style=\"margin-top: 22px;margin-bottom: 5px\">\n            <div class=\"tui-image-editor-button apply\">\n                ")).call(_context2,makeSvgIcon(['normal','active'],'apply'),"\n                <label>\n                    ")).call(_context,locale.localize('Apply'),"\n                </label>\n            </div>\n        </li>\n    </ul>\n");});;function mask_createSuper(Derived){var hasNativeReflectConstruct=mask_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function mask_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var Mask=function(_Submenu){_inherits(Mask,_Submenu);var _super=mask_createSuper(Mask);function Mask(subMenuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Mask);_this=_super.call(this,subMenuElement,{locale:locale,name:'mask',makeSvgIcon:makeSvgIcon,menuBarPosition:menuBarPosition,templateHtml:mask,usageStatistics:usageStatistics});_this._els={applyButton:_this.selector('.tie-mask-apply'),maskImageButton:_this.selector('.tie-mask-image-file')};return _this;}
_createClass(Mask,[{key:"destroy",value:function destroy(){this._removeEvent();assignmentForDestroy(this);}},{key:"addEvent",value:function addEvent(actions){var _context,_context2;var loadMaskFile=bind_default()(_context=this._loadMaskFile).call(_context,this);var applyMask=bind_default()(_context2=this._applyMask).call(_context2,this);this.eventHandler={loadMaskFile:loadMaskFile,applyMask:applyMask};this.actions=actions;this._els.maskImageButton.addEventListener('change',loadMaskFile);this._els.applyButton.addEventListener('click',applyMask);}},{key:"_removeEvent",value:function _removeEvent(){this._els.maskImageButton.removeEventListener('change',this.eventHandler.loadMaskFile);this._els.applyButton.removeEventListener('click',this.eventHandler.applyMask);}},{key:"_applyMask",value:function _applyMask(){this.actions.applyFilter();this._els.applyButton.classList.remove('active');}},{key:"_loadMaskFile",value:function _loadMaskFile(event){var imgUrl;if(!isSupportFileApi()){alert('This browser does not support file-api');}
var _event$target$files=_slicedToArray(event.target.files,1),file=_event$target$files[0];if(file){imgUrl=url_default().createObjectURL(file);this.actions.loadImageFromURL(imgUrl,file);this._els.applyButton.classList.add('active');}}}]);return Mask;}(submenuBase);var ui_mask=(Mask);;var icon=(function(_ref){var _context,_context2,_context3,_context4,_context5,_context6,_context7,_context8,_context9,_context10,_context11,_context12,_context13,_context14,_context15,_context16,_context17,_context18,_context19,_context20;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5=concat_default()(_context6=concat_default()(_context7=concat_default()(_context8=concat_default()(_context9=concat_default()(_context10=concat_default()(_context11=concat_default()(_context12=concat_default()(_context13=concat_default()(_context14=concat_default()(_context15=concat_default()(_context16=concat_default()(_context17=concat_default()(_context18=concat_default()(_context19=concat_default()(_context20="\n    <ul class=\"tui-image-editor-submenu-item\">\n        <li class=\"tie-icon-add-button\">\n            <div class=\"tui-image-editor-button\" data-icontype=\"icon-arrow\">\n                <div>\n                    ".concat(makeSvgIcon(['normal','active'],'icon-arrow',true),"\n                </div>\n                <label>\n                    ")).call(_context20,locale.localize('Arrow'),"\n                </label>\n            </div>\n            <div class=\"tui-image-editor-button\" data-icontype=\"icon-arrow-2\">\n                <div>\n                    ")).call(_context19,makeSvgIcon(['normal','active'],'icon-arrow-2',true),"\n                </div>\n                <label>\n                    ")).call(_context18,locale.localize('Arrow-2'),"\n                </label>\n            </div>\n            <div class=\"tui-image-editor-button\" data-icontype=\"icon-arrow-3\">\n                <div>\n                    ")).call(_context17,makeSvgIcon(['normal','active'],'icon-arrow-3',true),"\n                </div>\n                <label>\n                    ")).call(_context16,locale.localize('Arrow-3'),"\n                </label>\n            </div>\n            <div class=\"tui-image-editor-button\" data-icontype=\"icon-star\">\n                <div>\n                    ")).call(_context15,makeSvgIcon(['normal','active'],'icon-star',true),"\n                </div>\n                <label>\n                    ")).call(_context14,locale.localize('Star-1'),"\n                </label>\n            </div>\n            <div class=\"tui-image-editor-button\" data-icontype=\"icon-star-2\">\n                <div>\n                    ")).call(_context13,makeSvgIcon(['normal','active'],'icon-star-2',true),"\n                </div>\n                <label>\n                    ")).call(_context12,locale.localize('Star-2'),"\n                </label>\n            </div>\n\n            <div class=\"tui-image-editor-button\" data-icontype=\"icon-polygon\">\n                <div>\n                    ")).call(_context11,makeSvgIcon(['normal','active'],'icon-polygon',true),"\n                </div>\n                <label>\n                    ")).call(_context10,locale.localize('Polygon'),"\n                </label>\n            </div>\n\n            <div class=\"tui-image-editor-button\" data-icontype=\"icon-location\">\n                <div>\n                    ")).call(_context9,makeSvgIcon(['normal','active'],'icon-location',true),"\n                </div>\n                <label>\n                    ")).call(_context8,locale.localize('Location'),"\n                </label>\n            </div>\n\n            <div class=\"tui-image-editor-button\" data-icontype=\"icon-heart\">\n                <div>\n                    ")).call(_context7,makeSvgIcon(['normal','active'],'icon-heart',true),"\n                </div>\n                <label>\n                    ")).call(_context6,locale.localize('Heart'),"\n                </label>\n            </div>\n\n            <div class=\"tui-image-editor-button\" data-icontype=\"icon-bubble\">\n                <div>\n                    ")).call(_context5,makeSvgIcon(['normal','active'],'icon-bubble',true),"\n                </div>\n                <label>\n                    ")).call(_context4,locale.localize('Bubble'),"\n                </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition\">\n            <div></div>\n        </li>\n        <li class=\"tie-icon-add-button\">\n            <div class=\"tui-image-editor-button\" style=\"margin:0\">\n                <div>\n                    <input type=\"file\" accept=\"image/*\" class=\"tie-icon-image-file\">\n                    ")).call(_context3,makeSvgIcon(['normal','active'],'icon-load',true),"\n                </div>\n                <label>\n                    ")).call(_context2,locale.localize('Custom icon'),"\n                </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition\">\n            <div></div>\n        </li>\n        <li>\n            <div class=\"tie-icon-color\" title=\"")).call(_context,locale.localize('Color'),"\"></div>\n        </li>\n    </ul>\n");});;function icon_createSuper(Derived){var hasNativeReflectConstruct=icon_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function icon_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var Icon=function(_Submenu){_inherits(Icon,_Submenu);var _super=icon_createSuper(Icon);function Icon(subMenuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Icon);_this=_super.call(this,subMenuElement,{locale:locale,name:'icon',makeSvgIcon:makeSvgIcon,menuBarPosition:menuBarPosition,templateHtml:icon,usageStatistics:usageStatistics});_this.iconType=null;_this._iconMap={};_this._els={registerIconButton:_this.selector('.tie-icon-image-file'),addIconButton:_this.selector('.tie-icon-add-button'),iconColorpicker:new colorpicker(_this.selector('.tie-icon-color'),{defaultColor:'#ffbb3b',toggleDirection:_this.toggleDirection,usageStatistics:_this.usageStatistics})};_this.colorPickerInputBox=_this._els.iconColorpicker.colorpickerElement.querySelector(selectorNames.COLOR_PICKER_INPUT_BOX);return _this;}
_createClass(Icon,[{key:"destroy",value:function destroy(){this._removeEvent();this._els.iconColorpicker.destroy();assignmentForDestroy(this);}},{key:"addEvent",value:function addEvent(actions){var _context,_context2,_context3,_context4,_context5;var registerIcon=bind_default()(_context=this._registerIconHandler).call(_context,this);var addIcon=bind_default()(_context2=this._addIconHandler).call(_context2,this);this.eventHandler={registerIcon:registerIcon,addIcon:addIcon};this.actions=actions;this._els.iconColorpicker.on('change',bind_default()(_context3=this._changeColorHandler).call(_context3,this));this._els.registerIconButton.addEventListener('change',registerIcon);this._els.addIconButton.addEventListener('click',addIcon);this.colorPickerInputBox.addEventListener(eventNames.FOCUS,bind_default()(_context4=this._onStartEditingInputBox).call(_context4,this));this.colorPickerInputBox.addEventListener(eventNames.BLUR,bind_default()(_context5=this._onStopEditingInputBox).call(_context5,this));}},{key:"_removeEvent",value:function _removeEvent(){var _context6,_context7;this._els.iconColorpicker.off();this._els.registerIconButton.removeEventListener('change',this.eventHandler.registerIcon);this._els.addIconButton.removeEventListener('click',this.eventHandler.addIcon);this.colorPickerInputBox.removeEventListener(eventNames.FOCUS,bind_default()(_context6=this._onStartEditingInputBox).call(_context6,this));this.colorPickerInputBox.removeEventListener(eventNames.BLUR,bind_default()(_context7=this._onStopEditingInputBox).call(_context7,this));}},{key:"clearIconType",value:function clearIconType(){this._els.addIconButton.classList.remove(this.iconType);this.iconType=null;}},{key:"registerDefaultIcon",value:function registerDefaultIcon(){var _this2=this;forEach_default()(defaultIconPath,function(path,type){_this2.actions.registerDefaultIcons(type,path);});}},{key:"setIconPickerColor",value:function setIconPickerColor(iconColor){this._els.iconColorpicker.color=iconColor;}},{key:"changeStandbyMode",value:function changeStandbyMode(){this.clearIconType();this.actions.cancelAddIcon();}},{key:"_changeColorHandler",value:function _changeColorHandler(color){color=color||'transparent';this.actions.changeColor(color);}},{key:"_addIconHandler",value:function _addIconHandler(event){var button=event.target.closest('.tui-image-editor-button');if(button){var iconType=button.getAttribute('data-icontype');var iconColor=this._els.iconColorpicker.color;this.actions.discardSelection();this.actions.changeSelectableAll(false);this._els.addIconButton.classList.remove(this.iconType);this._els.addIconButton.classList.add(iconType);if(this.iconType===iconType){this.changeStandbyMode();}else{this.actions.addIcon(iconType,iconColor);this.iconType=iconType;}}}},{key:"_registerIconHandler",value:function _registerIconHandler(event){var imgUrl;if(!isSupportFileApi){alert('This browser does not support file-api');}
var _event$target$files=_slicedToArray(event.target.files,1),file=_event$target$files[0];if(file){imgUrl=url_default().createObjectURL(file);this.actions.registerCustomIcon(imgUrl,file);}}}]);return Icon;}(submenuBase);var ui_icon=(Icon);;var draw=(function(_ref){var _context,_context2,_context3,_context4,_context5;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5="\n    <ul class=\"tui-image-editor-submenu-item\">\n        <li class=\"tie-draw-line-select-button\">\n            <div class=\"tui-image-editor-button free\">\n                <div>\n                    ".concat(makeSvgIcon(['normal','active'],'draw-free',true),"\n                </div>\n                <label>\n                    ")).call(_context5,locale.localize('Free'),"\n                </label>\n            </div>\n            <div class=\"tui-image-editor-button line\">\n                <div>\n                    ")).call(_context4,makeSvgIcon(['normal','active'],'draw-line',true),"\n                </div>\n                <label>\n                    ")).call(_context3,locale.localize('Straight'),"\n                </label>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition\">\n            <div></div>\n        </li>\n        <li>\n            <div class=\"tie-draw-color\" title=\"")).call(_context2,locale.localize('Color'),"\"></div>\n        </li>\n        <li class=\"tui-image-editor-partition only-left-right\">\n            <div></div>\n        </li>\n        <li class=\"tui-image-editor-newline tui-image-editor-range-wrap\">\n            <label class=\"range\">")).call(_context,locale.localize('Range'),"</label>\n            <div class=\"tie-draw-range\"></div>\n            <input class=\"tie-draw-range-value tui-image-editor-range-value\" value=\"0\" />\n        </li>\n    </ul>\n");});;function draw_createSuper(Derived){var hasNativeReflectConstruct=draw_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function draw_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var DRAW_OPACITY=0.7;var Draw=function(_Submenu){_inherits(Draw,_Submenu);var _super=draw_createSuper(Draw);function Draw(subMenuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Draw);_this=_super.call(this,subMenuElement,{locale:locale,name:'draw',makeSvgIcon:makeSvgIcon,menuBarPosition:menuBarPosition,templateHtml:draw,usageStatistics:usageStatistics});_this._els={lineSelectButton:_this.selector('.tie-draw-line-select-button'),drawColorPicker:new colorpicker(_this.selector('.tie-draw-color'),{defaultColor:'#00a9ff',toggleDirection:_this.toggleDirection,usageStatistics:_this.usageStatistics}),drawRange:new range({slider:_this.selector('.tie-draw-range'),input:_this.selector('.tie-draw-range-value')},defaultDrawRangeValues)};_this.type=null;_this.color=_this._els.drawColorPicker.color;_this.width=_this._els.drawRange.value;_this.colorPickerInputBox=_this._els.drawColorPicker.colorpickerElement.querySelector(selectorNames.COLOR_PICKER_INPUT_BOX);return _this;}
_createClass(Draw,[{key:"destroy",value:function destroy(){this._removeEvent();this._els.drawColorPicker.destroy();this._els.drawRange.destroy();assignmentForDestroy(this);}},{key:"addEvent",value:function addEvent(actions){var _context,_context2,_context3,_context4,_context5;this.eventHandler.changeDrawType=bind_default()(_context=this._changeDrawType).call(_context,this);this.actions=actions;this._els.lineSelectButton.addEventListener('click',this.eventHandler.changeDrawType);this._els.drawColorPicker.on('change',bind_default()(_context2=this._changeDrawColor).call(_context2,this));this._els.drawRange.on('change',bind_default()(_context3=this._changeDrawRange).call(_context3,this));this.colorPickerInputBox.addEventListener(eventNames.FOCUS,bind_default()(_context4=this._onStartEditingInputBox).call(_context4,this));this.colorPickerInputBox.addEventListener(eventNames.BLUR,bind_default()(_context5=this._onStopEditingInputBox).call(_context5,this));}},{key:"_removeEvent",value:function _removeEvent(){var _context6,_context7;this._els.lineSelectButton.removeEventListener('click',this.eventHandler.changeDrawType);this._els.drawColorPicker.off();this._els.drawRange.off();this.colorPickerInputBox.removeEventListener(eventNames.FOCUS,bind_default()(_context6=this._onStartEditingInputBox).call(_context6,this));this.colorPickerInputBox.removeEventListener(eventNames.BLUR,bind_default()(_context7=this._onStopEditingInputBox).call(_context7,this));}},{key:"setDrawMode",value:function setDrawMode(){this.actions.setDrawMode(this.type,{width:this.width,color:getRgb(this.color,DRAW_OPACITY)});}},{key:"changeStandbyMode",value:function changeStandbyMode(){this.type=null;this.actions.stopDrawingMode();this.actions.changeSelectableAll(true);this._els.lineSelectButton.classList.remove('free');this._els.lineSelectButton.classList.remove('line');}},{key:"changeStartMode",value:function changeStartMode(){this.type='free';this._els.lineSelectButton.classList.add('free');this.setDrawMode();}},{key:"_changeDrawType",value:function _changeDrawType(event){var button=event.target.closest('.tui-image-editor-button');if(button){var lineType=this.getButtonType(button,['free','line']);this.actions.discardSelection();if(this.type===lineType){this.changeStandbyMode();return;}
this.changeStandbyMode();this.type=lineType;this._els.lineSelectButton.classList.add(lineType);this.setDrawMode();}}},{key:"_changeDrawColor",value:function _changeDrawColor(color){this.color=color||'transparent';if(!this.type){this.changeStartMode();}else{this.setDrawMode();}}},{key:"_changeDrawRange",value:function _changeDrawRange(value){this.width=value;if(!this.type){this.changeStartMode();}else{this.setDrawMode();}}}]);return Draw;}(submenuBase);var ui_draw=(Draw);var isExisty=__webpack_require__(9886);var isExisty_default=__webpack_require__.n(isExisty);;var filter=(function(_ref){var _context,_context2,_context3,_context4,_context5,_context6,_context7,_context8,_context9,_context10,_context11,_context12,_context13,_context14,_context15,_context16;var locale=_ref.locale;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3=concat_default()(_context4=concat_default()(_context5=concat_default()(_context6=concat_default()(_context7=concat_default()(_context8=concat_default()(_context9=concat_default()(_context10=concat_default()(_context11=concat_default()(_context12=concat_default()(_context13=concat_default()(_context14=concat_default()(_context15=concat_default()(_context16="\n    <ul class=\"tui-image-editor-submenu-item\">\n        <li class=\"tui-image-editor-submenu-align\">\n            <div class=\"tui-image-editor-checkbox-wrap fixed-width\">\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-grayscale\">\n                        <span>".concat(locale.localize('Grayscale'),"</span>\n                    </label>\n                </div>\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-invert\">\n                        <span>")).call(_context16,locale.localize('Invert'),"</span>\n                    </label>\n                </div>\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-sepia\">\n                        <span>")).call(_context15,locale.localize('Sepia'),"</span>\n                    </label>\n                </div>\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-vintage\">\n                        <span>")).call(_context14,locale.localize('Sepia2'),"</span>\n                    </label>\n                </div>\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-blur\">\n                        <span>")).call(_context13,locale.localize('Blur'),"</span>\n                    </label>\n                </div>\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-sharpen\">\n                        <span>")).call(_context12,locale.localize('Sharpen'),"</span>\n                    </label>\n                </div>\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-emboss\">\n                        <span>")).call(_context11,locale.localize('Emboss'),"</span>\n                    </label>\n                </div>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition\">\n            <div></div>\n        </li>\n        <li class=\"tui-image-editor-submenu-align\">\n            <div class=\"tui-image-editor-checkbox-group tui-image-editor-disabled\" style=\"margin-bottom: 7px;\">\n                <div class=\"tui-image-editor-checkbox-wrap\">\n                    <div class=\"tui-image-editor-checkbox\">\n                        <label>\n                            <input type=\"checkbox\" class=\"tie-remove-white\">\n                            <span>")).call(_context10,locale.localize('Remove White'),"</span>\n                        </label>\n                    </div>\n                </div>\n                <div class=\"tui-image-editor-newline tui-image-editor-range-wrap short\">\n                    <label>")).call(_context9,locale.localize('Distance'),"</label>\n                    <div class=\"tie-removewhite-distance-range\"></div>\n                </div>\n            </div>\n            <div class=\"tui-image-editor-checkbox-group tui-image-editor-disabled\">\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-brightness\">\n                        <span>")).call(_context8,locale.localize('Brightness'),"</span>\n                    </label>\n                </div>\n                <div class=\"tui-image-editor-range-wrap short\">\n                    <div class=\"tie-brightness-range\"></div>\n                </div>\n            </div>\n            <div class=\"tui-image-editor-checkbox-group tui-image-editor-disabled\">\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-noise\">\n                        <span>")).call(_context7,locale.localize('Noise'),"</span>\n                    </label>\n                </div>\n                <div class=\"tui-image-editor-range-wrap short\">\n                    <div class=\"tie-noise-range\"></div>\n                </div>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition only-left-right\">\n            <div></div>\n        </li>\n        <li class=\"tui-image-editor-submenu-align\">\n            <div class=\"tui-image-editor-checkbox-group tui-image-editor-disabled\">\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-pixelate\">\n                        <span>")).call(_context6,locale.localize('Pixelate'),"</span>\n                    </label>\n                </div>\n                <div class=\"tui-image-editor-range-wrap short\">\n                    <div class=\"tie-pixelate-range\"></div>\n                </div>\n            </div>\n            <div class=\"tui-image-editor-checkbox-group tui-image-editor-disabled\">\n                <div class=\"tui-image-editor-newline tui-image-editor-checkbox-wrap\">\n                    <div class=\"tui-image-editor-checkbox\">\n                        <label>\n                            <input type=\"checkbox\" class=\"tie-color-filter\">\n                            <span>")).call(_context5,locale.localize('Color Filter'),"</span>\n                        </label>\n                    </div>\n                </div>\n                <div class=\"tui-image-editor-newline tui-image-editor-range-wrap short\">\n                    <label>")).call(_context4,locale.localize('Threshold'),"</label>\n                    <div class=\"tie-colorfilter-threshold-range\"></div>\n                </div>\n            </div>\n        </li>\n        <li class=\"tui-image-editor-partition\">\n            <div></div>\n        </li>\n        <li>\n            <div class=\"filter-color-item\">\n                <div class=\"tie-filter-tint-color\" title=\"")).call(_context3,locale.localize('Tint'),"\"></div>\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-tint\">\n                        <span></span>\n                    </label>\n                </div>\n            </div>\n            <div class=\"filter-color-item\">\n                <div class=\"tie-filter-multiply-color\" title=\"")).call(_context2,locale.localize('Multiply'),"\"></div>\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-multiply\">\n                        <span></span>\n                    </label>\n                </div>\n            </div>\n            <div class=\"filter-color-item\">\n                <div class=\"tie-filter-blend-color\" title=\"")).call(_context,locale.localize('Blend'),"\"></div>\n                <div class=\"tui-image-editor-checkbox\">\n                    <label>\n                        <input type=\"checkbox\" class=\"tie-blend\">\n                        <span></span>\n                    </label>\n                </div>\n            </div>\n        </li>\n    </ul>\n");});;function filter_createSuper(Derived){var hasNativeReflectConstruct=filter_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function filter_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var PICKER_CONTROL_HEIGHT='130px';var BLEND_OPTIONS=['add','diff','subtract','multiply','screen','lighten','darken'];var FILTER_OPTIONS=['grayscale','invert','sepia','vintage','blur','sharpen','emboss','remove-white','brightness','noise','pixelate','color-filter','tint','multiply','blend'];var filterNameMap={grayscale:'grayscale',invert:'invert',sepia:'sepia',blur:'blur',sharpen:'sharpen',emboss:'emboss',removeWhite:'removeColor',brightness:'brightness',contrast:'contrast',saturation:'saturation',vintage:'vintage',polaroid:'polaroid',noise:'noise',pixelate:'pixelate',colorFilter:'removeColor',tint:'blendColor',multiply:'blendColor',blend:'blendColor',hue:'hue',gamma:'gamma'};var RANGE_INSTANCE_NAMES=['removewhiteDistanceRange','colorfilterThresholdRange','pixelateRange','noiseRange','brightnessRange','tintOpacity'];var COLORPICKER_INSTANCE_NAMES=['filterBlendColor','filterMultiplyColor','filterTintColor'];var Filter=function(_Submenu){_inherits(Filter,_Submenu);var _super=filter_createSuper(Filter);function Filter(subMenuElement,_ref){var _this;var locale=_ref.locale,menuBarPosition=_ref.menuBarPosition,usageStatistics=_ref.usageStatistics;_classCallCheck(this,Filter);_this=_super.call(this,subMenuElement,{locale:locale,name:'filter',menuBarPosition:menuBarPosition,templateHtml:filter,usageStatistics:usageStatistics});_this.selectBoxShow=false;_this.checkedMap={};_this._makeControlElement();return _this;}
_createClass(Filter,[{key:"destroy",value:function destroy(){this._removeEvent();this._destroyToolInstance();assignmentForDestroy(this);}},{key:"_removeEvent",value:function _removeEvent(){var _this2=this,_context;forEach_default()(FILTER_OPTIONS,function(filter){var filterCheckElement=_this2.selector(".tie-".concat(filter));var filterNameCamelCase=toCamelCase(filter);filterCheckElement.removeEventListener('change',_this2.eventHandler[filterNameCamelCase]);});forEach_default()(concat_default()(_context=[]).call(_context,RANGE_INSTANCE_NAMES,COLORPICKER_INSTANCE_NAMES),function(instanceName){_this2._els[instanceName].off();});this._els.blendType.removeEventListener('change',this.eventHandler.changeBlendFilter);this._els.blendType.removeEventListener('click',this.eventHandler.changeBlendFilter);forEachArray_default()(this.colorPickerInputBoxes,function(inputBox){var _context2,_context3;inputBox.removeEventListener(eventNames.FOCUS,bind_default()(_context2=_this2._onStartEditingInputBox).call(_context2,_this2));inputBox.removeEventListener(eventNames.BLUR,bind_default()(_context3=_this2._onStopEditingInputBox).call(_context3,_this2));},this);}},{key:"_destroyToolInstance",value:function _destroyToolInstance(){var _context4,_this3=this;forEach_default()(concat_default()(_context4=[]).call(_context4,RANGE_INSTANCE_NAMES,COLORPICKER_INSTANCE_NAMES),function(instanceName){_this3._els[instanceName].destroy();});}},{key:"addEvent",value:function addEvent(_ref2){var _this4=this,_context6,_context7,_context8;var applyFilter=_ref2.applyFilter;var changeFilterState=function changeFilterState(filterName){var _context5;return bind_default()(_context5=_this4._changeFilterState).call(_context5,_this4,applyFilter,filterName);};var changeFilterStateForRange=function changeFilterStateForRange(filterName){return function(value,isLast){return _this4._changeFilterState(applyFilter,filterName,isLast);};};this.eventHandler={changeBlendFilter:changeFilterState('blend'),blandTypeClick:function blandTypeClick(event){return event.stopPropagation();}};forEach_default()(FILTER_OPTIONS,function(filter){var filterCheckElement=_this4.selector(".tie-".concat(filter));var filterNameCamelCase=toCamelCase(filter);_this4.checkedMap[filterNameCamelCase]=filterCheckElement;_this4.eventHandler[filterNameCamelCase]=changeFilterState(filterNameCamelCase);filterCheckElement.addEventListener('change',_this4.eventHandler[filterNameCamelCase]);});this._els.removewhiteDistanceRange.on('change',changeFilterStateForRange('removeWhite'));this._els.colorfilterThresholdRange.on('change',changeFilterStateForRange('colorFilter'));this._els.pixelateRange.on('change',changeFilterStateForRange('pixelate'));this._els.noiseRange.on('change',changeFilterStateForRange('noise'));this._els.brightnessRange.on('change',changeFilterStateForRange('brightness'));this._els.filterBlendColor.on('change',this.eventHandler.changeBlendFilter);this._els.filterMultiplyColor.on('change',changeFilterState('multiply'));this._els.filterTintColor.on('change',changeFilterState('tint'));this._els.tintOpacity.on('change',changeFilterStateForRange('tint'));this._els.filterMultiplyColor.on('changeShow',bind_default()(_context6=this.colorPickerChangeShow).call(_context6,this));this._els.filterTintColor.on('changeShow',bind_default()(_context7=this.colorPickerChangeShow).call(_context7,this));this._els.filterBlendColor.on('changeShow',bind_default()(_context8=this.colorPickerChangeShow).call(_context8,this));this._els.blendType.addEventListener('change',this.eventHandler.changeBlendFilter);this._els.blendType.addEventListener('click',this.eventHandler.blandTypeClick);forEachArray_default()(this.colorPickerInputBoxes,function(inputBox){var _context9,_context10;inputBox.addEventListener(eventNames.FOCUS,bind_default()(_context9=_this4._onStartEditingInputBox).call(_context9,_this4));inputBox.addEventListener(eventNames.BLUR,bind_default()(_context10=_this4._onStopEditingInputBox).call(_context10,_this4));},this);}},{key:"setFilterState",value:function setFilterState(changedFilterInfos){var type=changedFilterInfos.type,options=changedFilterInfos.options,action=changedFilterInfos.action;var filterName=this._getFilterNameFromOptions(type,options);var isRemove=action==='remove';if(!isRemove){this._setFilterState(filterName,options);}
this.checkedMap[filterName].checked=!isRemove;}},{key:"initFilterCheckBoxState",value:function initFilterCheckBoxState(){forEach_default()(this.checkedMap,function(filter){filter.checked=false;},this);}},{key:"_setFilterState",value:function _setFilterState(filterName,options){if(filterName==='colorFilter'){this._els.colorfilterThresholdRange.value=options.distance;}else if(filterName==='removeWhite'){this._els.removewhiteDistanceRange.value=options.distance;}else if(filterName==='pixelate'){this._els.pixelateRange.value=options.blocksize;}else if(filterName==='brightness'){this._els.brightnessRange.value=options.brightness;}else if(filterName==='noise'){this._els.noiseRange.value=options.noise;}else if(filterName==='tint'){this._els.tintOpacity.value=options.alpha;this._els.filterTintColor.color=options.color;}else if(filterName==='blend'){this._els.filterBlendColor.color=options.color;}else if(filterName==='multiply'){this._els.filterMultiplyColor.color=options.color;}}},{key:"_getFilterNameFromOptions",value:function _getFilterNameFromOptions(type,options){var filterName=type;if(type==='removeColor'){filterName=isExisty_default()(options.useAlpha)?'removeWhite':'colorFilter';}else if(type==='blendColor'){filterName={add:'blend',multiply:'multiply',tint:'tint'}[options.mode];}
return filterName;}},{key:"_changeFilterState",value:function _changeFilterState(applyFilter,filterName){var isLast=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var apply=this.checkedMap[filterName].checked;var type=filterNameMap[filterName];var checkboxGroup=this.checkedMap[filterName].closest('.tui-image-editor-checkbox-group');if(checkboxGroup){if(apply){checkboxGroup.classList.remove('tui-image-editor-disabled');}else{checkboxGroup.classList.add('tui-image-editor-disabled');}}
applyFilter(apply,type,this._getFilterOption(filterName),!isLast);}},{key:"_getFilterOption",value:function _getFilterOption(type){var option={};switch(type){case'removeWhite':option.color='#FFFFFF';option.useAlpha=false;option.distance=parse_float_default()(this._els.removewhiteDistanceRange.value);break;case'colorFilter':option.color='#FFFFFF';option.distance=parse_float_default()(this._els.colorfilterThresholdRange.value);break;case'pixelate':option.blocksize=toInteger(this._els.pixelateRange.value);break;case'noise':option.noise=toInteger(this._els.noiseRange.value);break;case'brightness':option.brightness=parse_float_default()(this._els.brightnessRange.value);break;case'blend':option.mode='add';option.color=this._els.filterBlendColor.color;option.mode=this._els.blendType.value;break;case'multiply':option.mode='multiply';option.color=this._els.filterMultiplyColor.color;break;case'tint':option.mode='tint';option.color=this._els.filterTintColor.color;option.alpha=this._els.tintOpacity.value;break;case'blur':option.blur=this._els.blurRange.value;break;default:break;}
return option;}},{key:"_makeControlElement",value:function _makeControlElement(){this._els={removewhiteDistanceRange:new range({slider:this.selector('.tie-removewhite-distance-range')},defaultFilterRangeValues.removewhiteDistanceRange),brightnessRange:new range({slider:this.selector('.tie-brightness-range')},defaultFilterRangeValues.brightnessRange),noiseRange:new range({slider:this.selector('.tie-noise-range')},defaultFilterRangeValues.noiseRange),pixelateRange:new range({slider:this.selector('.tie-pixelate-range')},defaultFilterRangeValues.pixelateRange),colorfilterThresholdRange:new range({slider:this.selector('.tie-colorfilter-threshold-range')},defaultFilterRangeValues.colorfilterThresholdRange),filterTintColor:new colorpicker(this.selector('.tie-filter-tint-color'),{defaultColor:'#03bd9e',toggleDirection:this.toggleDirection,usageStatistics:this.usageStatistics}),filterMultiplyColor:new colorpicker(this.selector('.tie-filter-multiply-color'),{defaultColor:'#515ce6',toggleDirection:this.toggleDirection,usageStatistics:this.usageStatistics}),filterBlendColor:new colorpicker(this.selector('.tie-filter-blend-color'),{defaultColor:'#ffbb3b',toggleDirection:this.toggleDirection,usageStatistics:this.usageStatistics}),blurRange:defaultFilterRangeValues.blurFilterRange};this._els.tintOpacity=this._pickerWithRange(this._els.filterTintColor.pickerControl);this._els.blendType=this._pickerWithSelectbox(this._els.filterBlendColor.pickerControl);this.colorPickerControls.push(this._els.filterTintColor);this.colorPickerControls.push(this._els.filterMultiplyColor);this.colorPickerControls.push(this._els.filterBlendColor);this.colorPickerInputBoxes=[];this.colorPickerInputBoxes.push(this._els.filterTintColor.colorpickerElement.querySelector(selectorNames.COLOR_PICKER_INPUT_BOX));this.colorPickerInputBoxes.push(this._els.filterMultiplyColor.colorpickerElement.querySelector(selectorNames.COLOR_PICKER_INPUT_BOX));this.colorPickerInputBoxes.push(this._els.filterBlendColor.colorpickerElement.querySelector(selectorNames.COLOR_PICKER_INPUT_BOX));}},{key:"_pickerWithRange",value:function _pickerWithRange(pickerControl){var rangeWrap=document.createElement('div');var rangeLabel=document.createElement('label');var slider=document.createElement('div');slider.id='tie-filter-tint-opacity';rangeLabel.innerHTML='Opacity';rangeWrap.appendChild(rangeLabel);rangeWrap.appendChild(slider);pickerControl.appendChild(rangeWrap);pickerControl.style.height=PICKER_CONTROL_HEIGHT;return new range({slider:slider},defaultFilterRangeValues.tintOpacityRange);}},{key:"_pickerWithSelectbox",value:function _pickerWithSelectbox(pickerControl){var selectlistWrap=document.createElement('div');var selectlist=document.createElement('select');var optionlist=document.createElement('ul');selectlistWrap.className='tui-image-editor-selectlist-wrap';optionlist.className='tui-image-editor-selectlist';selectlistWrap.appendChild(selectlist);selectlistWrap.appendChild(optionlist);this._makeSelectOptionList(selectlist);pickerControl.appendChild(selectlistWrap);pickerControl.style.height=PICKER_CONTROL_HEIGHT;this._drawSelectOptionList(selectlist,optionlist);this._pickerWithSelectboxForAddEvent(selectlist,optionlist);return selectlist;}},{key:"_drawSelectOptionList",value:function _drawSelectOptionList(selectlist,optionlist){var options=selectlist.querySelectorAll('option');forEach_default()(options,function(option){var optionElement=document.createElement('li');optionElement.innerHTML=option.innerHTML;optionElement.setAttribute('data-item',option.value);optionlist.appendChild(optionElement);});}},{key:"_pickerWithSelectboxForAddEvent",value:function _pickerWithSelectboxForAddEvent(selectlist,optionlist){var _this5=this;optionlist.addEventListener('click',function(event){var optionValue=event.target.getAttribute('data-item');var fireEvent=document.createEvent('HTMLEvents');selectlist.querySelector("[value=\"".concat(optionValue,"\"]")).selected=true;fireEvent.initEvent('change',true,true);selectlist.dispatchEvent(fireEvent);_this5.selectBoxShow=false;optionlist.style.display='none';});selectlist.addEventListener('mousedown',function(event){event.preventDefault();_this5.selectBoxShow=!_this5.selectBoxShow;optionlist.style.display=_this5.selectBoxShow?'block':'none';optionlist.setAttribute('data-selectitem',selectlist.value);optionlist.querySelector("[data-item='".concat(selectlist.value,"']")).classList.add('active');});}},{key:"_makeSelectOptionList",value:function _makeSelectOptionList(selectlist){forEach_default()(BLEND_OPTIONS,function(option){var selectOption=document.createElement('option');selectOption.setAttribute('value',option);selectOption.innerHTML=option.replace(/^[a-z]/,function($0){return $0.toUpperCase();});selectlist.appendChild(selectOption);});}}]);return Filter;}(submenuBase);var ui_filter=(Filter);var number_parse_int=__webpack_require__(4383);var number_parse_int_default=__webpack_require__.n(number_parse_int);;var Panel=function(){function Panel(menuElement,_ref){var name=_ref.name;_classCallCheck(this,Panel);this.name=name;this.items=[];this.panelElement=this._makePanelElement();this.listElement=this._makeListElement();this.panelElement.appendChild(this.listElement);menuElement.appendChild(this.panelElement);}
_createClass(Panel,[{key:"_makePanelElement",value:function _makePanelElement(){var panel=document.createElement('div');panel.className="tie-panel-".concat(this.name);return panel;}},{key:"_makeListElement",value:function _makeListElement(){var list=document.createElement('ol');list.className="".concat(this.name,"-list");return list;}},{key:"makeListItemElement",value:function makeListItemElement(html){var listItem=document.createElement('li');listItem.innerHTML=html;listItem.className="".concat(this.name,"-item");listItem.setAttribute('data-index',this.items.length);return listItem;}},{key:"pushListItemElement",value:function pushListItemElement(item){this.listElement.appendChild(item);this.listElement.scrollTop+=item.offsetHeight;this.items.push(item);}},{key:"deleteListItemElement",value:function deleteListItemElement(start,end){var items=this.items;for(var i=start;i<end;i+=1){this.listElement.removeChild(items[i]);}
splice_default()(items).call(items,start,end-start+1);}},{key:"getListLength",value:function getListLength(){return this.items.length;}},{key:"addClass",value:function addClass(index,className){if(this.items[index]){this.items[index].classList.add(className);}}},{key:"removeClass",value:function removeClass(index,className){if(this.items[index]){this.items[index].classList.remove(className);}}},{key:"toggleClass",value:function toggleClass(index,className){if(this.items[index]){this.items[index].classList.toggle(className);}}}]);return Panel;}();var panelMenu=(Panel);;var submenu_history=(function(_ref){var _context,_context2,_context3;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon,name=_ref.name,detail=_ref.detail;return concat_default()(_context=concat_default()(_context2=concat_default()(_context3="\n    <div class=\"tui-image-editor-history-item history\">\n        <div class=\"history-item-icon\">\n            ".concat(makeSvgIcon(['normal','active'],"history-".concat(name.toLowerCase()),true),"\n        </div>\n        <span>\n            ")).call(_context3,locale.localize(name),"\n            ")).call(_context2,detail?"(".concat(locale.localize(detail),")"):'',"\n        </span>\n        <div class=\"history-item-checkbox\">\n            ")).call(_context,makeSvgIcon(['normal'],'history-check',true),"\n        </div>\n    </div>\n");});;function history_createSuper(Derived){var hasNativeReflectConstruct=history_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function history_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var historyClassName='history-item';var selectedClassName='selected-item';var disabledClassName='disabled-item';var History=function(_Panel){_inherits(History,_Panel);var _super=history_createSuper(History);function History(menuElement,_ref){var _this;var locale=_ref.locale,makeSvgIcon=_ref.makeSvgIcon;_classCallCheck(this,History);_this=_super.call(this,menuElement,{name:'history'});menuElement.classList.add('enabled');_this.locale=locale;_this.makeSvgIcon=makeSvgIcon;_this._eventHandler={};_this._historyIndex=_this.getListLength();return _this;}
_createClass(History,[{key:"add",value:function add(_ref2){var name=_ref2.name,detail=_ref2.detail;if(this._hasDisabledItem()){this.deleteListItemElement(this._historyIndex+1,this.getListLength());}
var html=submenu_history({locale:this.locale,makeSvgIcon:this.makeSvgIcon,name:name,detail:detail});var item=this.makeListItemElement(html);this.pushListItemElement(item);this._historyIndex=this.getListLength()-1;this._selectItem(this._historyIndex);}},{key:"init",value:function init(){this.deleteListItemElement(1,this.getListLength());this._historyIndex=0;this._selectItem(this._historyIndex);}},{key:"clear",value:function clear(){this.deleteListItemElement(0,this.getListLength());this._historyIndex=-1;}},{key:"prev",value:function prev(){this._historyIndex-=1;this._selectItem(this._historyIndex);}},{key:"next",value:function next(){this._historyIndex+=1;this._selectItem(this._historyIndex);}},{key:"_hasDisabledItem",value:function _hasDisabledItem(){return this.getListLength()-1>this._historyIndex;}},{key:"_addHistoryEventListener",value:function _addHistoryEventListener(){var _this2=this;this._eventHandler.history=function(event){return _this2._clickHistoryItem(event);};this.listElement.addEventListener('click',this._eventHandler.history);}},{key:"_removeHistoryEventListener",value:function _removeHistoryEventListener(){this.listElement.removeEventListener('click',this._eventHandler.history);}},{key:"_clickHistoryItem",value:function _clickHistoryItem(event){var target=event.target;var item=target.closest(".".concat(historyClassName));if(!item){return;}
var index=number_parse_int_default()(item.getAttribute('data-index'),10);if(index!==this._historyIndex){var count=Math.abs(index-this._historyIndex);if(index<this._historyIndex){this._actions.undo(count);}else{this._actions.redo(count);}}}},{key:"_selectItem",value:function _selectItem(index){for(var i=0;i<this.getListLength();i+=1){this.removeClass(i,selectedClassName);this.removeClass(i,disabledClassName);if(i>index){this.addClass(i,disabledClassName);}}
this.addClass(index,selectedClassName);}},{key:"destroy",value:function destroy(){this.removeEvent();assignmentForDestroy(this);}},{key:"addEvent",value:function addEvent(actions){this._actions=actions;this._addHistoryEventListener();}},{key:"removeEvent",value:function removeEvent(){this._removeHistoryEventListener();}}]);return History;}(panelMenu);var ui_history=(History);;var Locale=function(){function Locale(locale){_classCallCheck(this,Locale);this._locale=locale;}
_createClass(Locale,[{key:"localize",value:function localize(message){return this._locale[message]||message;}}]);return Locale;}();var locale=(Locale);;var SUB_UI_COMPONENT={Shape:ui_shape,Crop:ui_crop,Resize:ui_resize,Flip:ui_flip,Rotate:ui_rotate,Text:ui_text,Mask:ui_mask,Icon:ui_icon,Draw:ui_draw,Filter:ui_filter};var BI_EXPRESSION_MINSIZE_WHEN_TOP_POSITION='1300';var HISTORY_MENU='history';var HISTORY_PANEL_CLASS_NAME='tie-panel-history';var CLASS_NAME_ON='on';var ZOOM_BUTTON_TYPE={ZOOM_IN:'zoomIn',HAND:'hand'};var Ui=function(){function Ui(element,options,actions){_classCallCheck(this,Ui);this.options=this._initializeOption(options);this._actions=actions;this.submenu=false;this.imageSize={};this.uiSize={};this._locale=new locale(this.options.locale);this.theme=new theme(this.options.theme);this.eventHandler={};this._submenuChangeTransection=false;this._selectedElement=null;this._mainElement=null;this._editorElementWrap=null;this._editorElement=null;this._menuBarElement=null;this._subMenuElement=null;this._makeUiElement(element);this._setUiSize();this._initMenuEvent=false;this._makeSubMenu();this._attachHistoryEvent();this._attachZoomEvent();}
_createClass(Ui,[{key:"destroy",value:function destroy(){this._removeUiEvent();this._destroyAllMenu();this._selectedElement.innerHTML='';assignmentForDestroy(this);}},{key:"setUiDefaultSelectionStyle",value:function setUiDefaultSelectionStyle(option){return extend_default()({applyCropSelectionStyle:true,applyGroupSelectionStyle:true,selectionStyle:{cornerStyle:'circle',cornerSize:16,cornerColor:'#fff',cornerStrokeColor:'#fff',transparentCorners:false,lineWidth:2,borderColor:'#fff'}},option);}},{key:"resizeEditor",value:function resizeEditor(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},uiSize=_ref.uiSize,_ref$imageSize=_ref.imageSize,imageSize=_ref$imageSize===void 0?this.imageSize:_ref$imageSize;if(imageSize!==this.imageSize){this.imageSize=imageSize;}
if(uiSize){this._setUiSize(uiSize);}
var _this$_getCanvasMaxDi=this._getCanvasMaxDimension(),width=_this$_getCanvasMaxDi.width,height=_this$_getCanvasMaxDi.height;var editorElementStyle=this._editorElement.style;var menuBarPosition=this.options.menuBarPosition;editorElementStyle.height="".concat(height,"px");editorElementStyle.width="".concat(width,"px");this._setEditorPosition(menuBarPosition);this._editorElementWrap.style.bottom="0px";this._editorElementWrap.style.top="0px";this._editorElementWrap.style.left="0px";this._editorElementWrap.style.width="100%";var selectElementClassList=this._selectedElement.classList;if(menuBarPosition==='top'&&this._selectedElement.offsetWidth<BI_EXPRESSION_MINSIZE_WHEN_TOP_POSITION){selectElementClassList.add('tui-image-editor-top-optimization');}else{selectElementClassList.remove('tui-image-editor-top-optimization');}}},{key:"toggleZoomButtonStatus",value:function toggleZoomButtonStatus(type){var targetClassList=this._buttonElements[type].classList;targetClassList.toggle(CLASS_NAME_ON);if(type===ZOOM_BUTTON_TYPE.ZOOM_IN){this._buttonElements[ZOOM_BUTTON_TYPE.HAND].classList.remove(CLASS_NAME_ON);}else{this._buttonElements[ZOOM_BUTTON_TYPE.ZOOM_IN].classList.remove(CLASS_NAME_ON);}}},{key:"offZoomInButtonStatus",value:function offZoomInButtonStatus(){var zoomInClassList=this._buttonElements[ZOOM_BUTTON_TYPE.ZOOM_IN].classList;zoomInClassList.remove(CLASS_NAME_ON);}},{key:"changeHandButtonStatus",value:function changeHandButtonStatus(enabled){var handClassList=this._buttonElements[ZOOM_BUTTON_TYPE.HAND].classList;handClassList[enabled?'add':'remove'](CLASS_NAME_ON);}},{key:"changeHelpButtonEnabled",value:function changeHelpButtonEnabled(buttonType,enableStatus){var buttonClassList=this._buttonElements[buttonType].classList;buttonClassList[enableStatus?'add':'remove']('enabled');}},{key:"_initializeOption",value:function _initializeOption(options){return extend_default()({loadImage:{path:'',name:''},locale:{},menuIconPath:'',menu:['resize','crop','flip','rotate','draw','shape','icon','text','mask','filter'],initMenu:'',uiSize:{width:'100%',height:'100%'},menuBarPosition:'bottom'},options);}},{key:"_setUiSize",value:function _setUiSize(){var uiSize=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.options.uiSize;var elementDimension=this._selectedElement.style;elementDimension.width=uiSize.width;elementDimension.height=uiSize.height;}},{key:"_makeSubMenu",value:function _makeSubMenu(){var _this=this;forEach_default()(this.options.menu,function(menuName){var _context;var SubComponentClass=SUB_UI_COMPONENT[menuName.replace(/^[a-z]/,function($0){return $0.toUpperCase();})];_this._makeMenuElement(menuName);_this._buttonElements[menuName]=_this._menuBarElement.querySelector(".tie-btn-".concat(menuName));_this[menuName]=new SubComponentClass(_this._subMenuElement,{locale:_this._locale,makeSvgIcon:bind_default()(_context=_this.theme.makeMenSvgIconSet).call(_context,_this.theme),menuBarPosition:_this.options.menuBarPosition,usageStatistics:_this.options.usageStatistics});});}},{key:"_attachHistoryEvent",value:function _attachHistoryEvent(){var _context2,_context3,_context4;this.on(eventNames.EXECUTE_COMMAND,bind_default()(_context2=this._addHistory).call(_context2,this));this.on(eventNames.AFTER_UNDO,bind_default()(_context3=this._selectPrevHistory).call(_context3,this));this.on(eventNames.AFTER_REDO,bind_default()(_context4=this._selectNextHistory).call(_context4,this));}},{key:"_attachZoomEvent",value:function _attachZoomEvent(){var _this2=this;this.on(eventNames.HAND_STARTED,function(){_this2.offZoomInButtonStatus();_this2.changeHandButtonStatus(true);});this.on(eventNames.HAND_STOPPED,function(){return _this2.changeHandButtonStatus(false);});}},{key:"_makeUiElement",value:function _makeUiElement(element){var _context5;var selectedElement;if(element.nodeType){selectedElement=element;}else{selectedElement=document.querySelector(element);}
var selector=getSelector(selectedElement);selectedElement.classList.add('tui-image-editor-container');selectedElement.innerHTML=controls({locale:this._locale,biImage:this.theme.getStyle('common.bi'),loadButtonStyle:this.theme.getStyle('loadButton'),downloadButtonStyle:this.theme.getStyle('downloadButton'),menuBarPosition:this.options.menuBarPosition})+mainContainer({locale:this._locale,biImage:this.theme.getStyle('common.bi'),commonStyle:this.theme.getStyle('common'),headerStyle:this.theme.getStyle('header'),loadButtonStyle:this.theme.getStyle('loadButton'),downloadButtonStyle:this.theme.getStyle('downloadButton'),submenuStyle:this.theme.getStyle('submenu')});this._selectedElement=selectedElement;this._selectedElement.classList.add(this.options.menuBarPosition);this._mainElement=selector('.tui-image-editor-main');this._editorElementWrap=selector('.tui-image-editor-wrap');this._editorElement=selector('.tui-image-editor');this._helpMenuBarElement=selector('.tui-image-editor-help-menu');this._menuBarElement=selector('.tui-image-editor-menu');this._subMenuElement=selector('.tui-image-editor-submenu');this._buttonElements={download:this._selectedElement.querySelectorAll('.tui-image-editor-download-btn'),load:this._selectedElement.querySelectorAll('.tui-image-editor-load-btn')};this._addHelpMenus();this._historyMenu=new ui_history(this._buttonElements[HISTORY_MENU],{locale:this._locale,makeSvgIcon:bind_default()(_context5=this.theme.makeMenSvgIconSet).call(_context5,this.theme)});this._activateZoomMenus();}},{key:"_activateZoomMenus",value:function _activateZoomMenus(){var _this3=this;forEach_default()(ZOOM_HELP_MENUS,function(menu){_this3.changeHelpButtonEnabled(menu,true);});}},{key:"_makeHelpMenuWithPartition",value:function _makeHelpMenuWithPartition(){var _context6;return concat_default()(_context6=[]).call(_context6,_toConsumableArray(ZOOM_HELP_MENUS),[''],_toConsumableArray(COMMAND_HELP_MENUS),[''],_toConsumableArray(DELETE_HELP_MENUS));}},{key:"_addHelpMenus",value:function _addHelpMenus(){var _this4=this;var helpMenuWithPartition=this._makeHelpMenuWithPartition();forEach_default()(helpMenuWithPartition,function(menuName){if(!menuName){_this4._makeMenuPartitionElement();}else{_this4._makeMenuElement(menuName,['normal','disabled','hover'],'help');_this4._buttonElements[menuName]=_this4._helpMenuBarElement.querySelector(".tie-btn-".concat(menuName));}});}},{key:"_makeMenuPartitionElement",value:function _makeMenuPartitionElement(){var partitionElement=document.createElement('li');var partitionInnerElement=document.createElement('div');partitionElement.className=cls('item');partitionInnerElement.className=cls('icpartition');partitionElement.appendChild(partitionInnerElement);this._helpMenuBarElement.appendChild(partitionElement);}},{key:"_makeMenuElement",value:function _makeMenuElement(menuName){var _context7,_context8;var useIconTypes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:['normal','active','hover'];var menuType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'normal';var btnElement=document.createElement('li');var menuItemHtml=this.theme.makeMenSvgIconSet(useIconTypes,menuName);this._addTooltipAttribute(btnElement,menuName);btnElement.className=concat_default()(_context7=concat_default()(_context8="tie-btn-".concat(menuName," ")).call(_context8,cls('item')," ")).call(_context7,menuType);btnElement.innerHTML=menuItemHtml;if(menuType==='normal'){this._menuBarElement.appendChild(btnElement);}else{this._helpMenuBarElement.appendChild(btnElement);}}},{key:"_addHelpActionEvent",value:function _addHelpActionEvent(){var _this5=this;forEach_default()(HELP_MENUS,function(helpName){_this5.eventHandler[helpName]=function(event){return _this5._actions.main[helpName](event);};_this5._buttonElements[helpName].addEventListener('click',_this5.eventHandler[helpName]);});}},{key:"_removeHelpActionEvent",value:function _removeHelpActionEvent(){var _this6=this;forEach_default()(HELP_MENUS,function(helpName){_this6._buttonElements[helpName].removeEventListener('click',_this6.eventHandler[helpName]);});}},{key:"_addHistory",value:function _addHistory(command){if(!isSilentCommand(command)){var historyTitle=typeof command==='string'?{name:command}:getHistoryTitle(command);this._historyMenu.add(historyTitle);}}},{key:"initHistory",value:function initHistory(){this._historyMenu.init();}},{key:"clearHistory",value:function clearHistory(){this._historyMenu.clear();}},{key:"_selectPrevHistory",value:function _selectPrevHistory(){this._historyMenu.prev();}},{key:"_selectNextHistory",value:function _selectNextHistory(){this._historyMenu.next();}},{key:"toggleHistoryMenu",value:function toggleHistoryMenu(event){var target=event.target;var item=target.closest(".".concat(HISTORY_PANEL_CLASS_NAME));if(item){return;}
var historyButtonClassList=this._buttonElements[HISTORY_MENU].classList;historyButtonClassList.toggle('opened');}},{key:"_addTooltipAttribute",value:function _addTooltipAttribute(element,tooltipName){element.setAttribute('tooltip-content',this._locale.localize(tooltipName.replace(/^[a-z]/g,function($0){return $0.toUpperCase();})));}},{key:"_addDownloadEvent",value:function _addDownloadEvent(){var _this7=this;this.eventHandler.download=function(){return _this7._actions.main.download();};forEach_default()(this._buttonElements.download,function(element){element.addEventListener('click',_this7.eventHandler.download);});}},{key:"_removeDownloadEvent",value:function _removeDownloadEvent(){var _this8=this;forEach_default()(this._buttonElements.download,function(element){element.removeEventListener('click',_this8.eventHandler.download);});}},{key:"_addLoadEvent",value:function _addLoadEvent(){var _this9=this;this.eventHandler.loadImage=function(event){return _this9._actions.main.load(event.target.files[0]);};forEach_default()(this._buttonElements.load,function(element){element.addEventListener('change',_this9.eventHandler.loadImage);});}},{key:"_removeLoadEvent",value:function _removeLoadEvent(){var _this10=this;forEach_default()(this._buttonElements.load,function(element){element.removeEventListener('change',_this10.eventHandler.loadImage);});}},{key:"_addMainMenuEvent",value:function _addMainMenuEvent(menuName){var _this11=this;this.eventHandler[menuName]=function(){return _this11.changeMenu(menuName);};this._buttonElements[menuName].addEventListener('click',this.eventHandler[menuName]);}},{key:"_addSubMenuEvent",value:function _addSubMenuEvent(menuName){var _this12=this;this[menuName].addEvent(this._actions[menuName]);this[menuName].on(eventNames.INPUT_BOX_EDITING_STARTED,function(){return _this12.fire(eventNames.INPUT_BOX_EDITING_STARTED);});this[menuName].on(eventNames.INPUT_BOX_EDITING_STOPPED,function(){return _this12.fire(eventNames.INPUT_BOX_EDITING_STOPPED);});}},{key:"_addMenuEvent",value:function _addMenuEvent(){var _this13=this;forEach_default()(this.options.menu,function(menuName){_this13._addMainMenuEvent(menuName);_this13._addSubMenuEvent(menuName);});}},{key:"_removeMainMenuEvent",value:function _removeMainMenuEvent(){var _this14=this;forEach_default()(this.options.menu,function(menuName){_this14._buttonElements[menuName].removeEventListener('click',_this14.eventHandler[menuName]);_this14[menuName].off(eventNames.INPUT_BOX_EDITING_STARTED);_this14[menuName].off(eventNames.INPUT_BOX_EDITING_STOPPED);});}},{key:"getEditorArea",value:function getEditorArea(){return this._editorElement;}},{key:"activeMenuEvent",value:function activeMenuEvent(){if(this._initMenuEvent){return;}
this._addHelpActionEvent();this._addDownloadEvent();this._addMenuEvent();this._initMenu();this._historyMenu.addEvent(this._actions.history);this._initMenuEvent=true;}},{key:"_removeUiEvent",value:function _removeUiEvent(){this._removeHelpActionEvent();this._removeDownloadEvent();this._removeLoadEvent();this._removeMainMenuEvent();this._historyMenu.removeEvent();}},{key:"_destroyAllMenu",value:function _destroyAllMenu(){var _this15=this;forEach_default()(this.options.menu,function(menuName){_this15[menuName].destroy();});this._historyMenu.destroy();}},{key:"initCanvas",value:function initCanvas(){var _this16=this;var loadImageInfo=this._getLoadImage();if(loadImageInfo.path){this._actions.main.initLoadImage(loadImageInfo.path,loadImageInfo.name).then(function(){_this16.activeMenuEvent();});}
this._addLoadEvent();var gridVisual=document.createElement('div');gridVisual.className=cls('grid-visual');var grid="<table>\n           <tr><td class=\"dot left-top\"></td><td></td><td class=\"dot right-top\"></td></tr>\n           <tr><td></td><td></td><td></td></tr>\n           <tr><td class=\"dot left-bottom\"></td><td></td><td class=\"dot right-bottom\"></td></tr>\n         </table>";gridVisual.innerHTML=grid;this._editorContainerElement=this._editorElement.querySelector('.tui-image-editor-canvas-container');this._editorContainerElement.appendChild(gridVisual);}},{key:"_getLoadImage",value:function _getLoadImage(){return this.options.loadImage;}},{key:"changeMenu",value:function changeMenu(menuName){var toggle=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var discardSelection=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(!this._submenuChangeTransection){this._submenuChangeTransection=true;this._changeMenu(menuName,toggle,discardSelection);this._submenuChangeTransection=false;}}},{key:"_changeMenu",value:function _changeMenu(menuName,toggle,discardSelection){if(this.submenu){this._buttonElements[this.submenu].classList.remove('active');this._mainElement.classList.remove("tui-image-editor-menu-".concat(this.submenu));if(discardSelection){this._actions.main.discardSelection();}
this._actions.main.changeSelectableAll(true);this[this.submenu].changeStandbyMode();}
if(this.submenu===menuName&&toggle){this.submenu=null;}else{this._buttonElements[menuName].classList.add('active');this._mainElement.classList.add("tui-image-editor-menu-".concat(menuName));this.submenu=menuName;this[this.submenu].changeStartMode();}
this.resizeEditor();}},{key:"_initMenu",value:function _initMenu(){if(this.options.initMenu){var evt=document.createEvent('MouseEvents');evt.initEvent('click',true,false);this._buttonElements[this.options.initMenu].dispatchEvent(evt);}
if(this.icon){this.icon.registerDefaultIcon();}}},{key:"_getCanvasMaxDimension",value:function _getCanvasMaxDimension(){var _this$_editorContaine=this._editorContainerElement.style,maxWidth=_this$_editorContaine.maxWidth,maxHeight=_this$_editorContaine.maxHeight;var width=parse_float_default()(maxWidth);var height=parse_float_default()(maxHeight);return{width:width,height:height};}},{key:"_setEditorPosition",value:function _setEditorPosition(menuBarPosition){var _this$_getCanvasMaxDi2=this._getCanvasMaxDimension(),width=_this$_getCanvasMaxDi2.width,height=_this$_getCanvasMaxDi2.height;var editorElementStyle=this._editorElement.style;var top=0;var left=0;if(this.submenu){if(menuBarPosition==='bottom'){if(height>this._editorElementWrap.scrollHeight-150){top=(height-this._editorElementWrap.scrollHeight)/2;}else{top=150/2*-1;}}else if(menuBarPosition==='top'){if(height>this._editorElementWrap.offsetHeight-150){top=150/2-(height-(this._editorElementWrap.offsetHeight-150))/2;}else{top=150/2;}}else if(menuBarPosition==='left'){if(width>this._editorElementWrap.offsetWidth-248){left=248/2-(width-(this._editorElementWrap.offsetWidth-248))/2;}else{left=248/2;}}else if(menuBarPosition==='right'){if(width>this._editorElementWrap.scrollWidth-248){left=(width-this._editorElementWrap.scrollWidth)/2;}else{left=248/2*-1;}}}
editorElementStyle.top="".concat(top,"px");editorElementStyle.left="".concat(left,"px");}}]);return Ui;}();customEvents_default().mixin(Ui);var ui=(Ui);var instance_filter=__webpack_require__(381);var filter_default=__webpack_require__.n(instance_filter);;var ImageTracer=function(){function ImageTracer(){_classCallCheck(this,ImageTracer);this.versionnumber='1.2.4';this.optionpresets={default:{corsenabled:false,ltres:1,qtres:1,pathomit:8,rightangleenhance:true,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:false,scale:1,roundcoords:1,viewbox:false,desc:false,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:0.01,linefilter:true,rightangleenhance:false},sharp:{qtres:0.01,linefilter:false},detailed:{pathomit:0,roundcoords:2,ltres:0.5,qtres:0.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:0.01,linefilter:true,numberofcolors:16,strokewidth:2},artistic2:{qtres:0.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:true,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:false,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}};this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]];this.gks=[[0.27901,0.44198,0.27901],[0.135336,0.228569,0.272192,0.228569,0.135336],[0.086776,0.136394,0.178908,0.195843,0.178908,0.136394,0.086776],[0.063327,0.093095,0.122589,0.144599,0.152781,0.144599,0.122589,0.093095,0.063327],[0.049692,0.069304,0.089767,0.107988,0.120651,0.125194,0.120651,0.107988,0.089767,0.069304,0.049692]];this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}];}
_createClass(ImageTracer,[{key:"imageToSVG",value:function imageToSVG(url,callback,options){var _this=this;options=this.checkoptions(options);this.loadImage(url,function(canvas){callback(_this.imagedataToSVG(_this.getImgdata(canvas),options));},options);}},{key:"imagedataToSVG",value:function imagedataToSVG(imgd,options){options=this.checkoptions(options);var td=this.imagedataToTracedata(imgd,options);return this.getsvgstring(td,options);}},{key:"imageToTracedata",value:function imageToTracedata(url,callback,options){var _this2=this;options=this.checkoptions(options);this.loadImage(url,function(canvas){callback(_this2.imagedataToTracedata(_this2.getImgdata(canvas),options));},options);}},{key:"imagedataToTracedata",value:function imagedataToTracedata(imgd,options){options=this.checkoptions(options);var ii=this.colorquantization(imgd,options);var tracedata;if(options.layering===0){tracedata={layers:[],palette:ii.palette,width:ii.array[0].length-2,height:ii.array.length-2};for(var colornum=0;colornum<ii.palette.length;colornum+=1){var tracedlayer=this.batchtracepaths(this.internodes(this.pathscan(this.layeringstep(ii,colornum),options.pathomit),options),options.ltres,options.qtres);tracedata.layers.push(tracedlayer);}}else{var ls=this.layering(ii);if(options.layercontainerid){this.drawLayers(ls,this.specpalette,options.scale,options.layercontainerid);}
var bps=this.batchpathscan(ls,options.pathomit);var bis=this.batchinternodes(bps,options);tracedata={layers:this.batchtracelayers(bis,options.ltres,options.qtres),palette:ii.palette,width:imgd.width,height:imgd.height};}
return tracedata;}},{key:"checkoptions",value:function checkoptions(options){options=options||{};if(typeof options==='string'){options=options.toLowerCase();if(this.optionpresets[options]){options=this.optionpresets[options];}else{options={};}}
var ok=keys_default()(this.optionpresets['default']);for(var k=0;k<ok.length;k+=1){if(!options.hasOwnProperty(ok[k])){options[ok[k]]=this.optionpresets['default'][ok[k]];}}
return options;}},{key:"colorquantization",value:function colorquantization(imgd,options){var arr=[];var idx=0;var cd;var cdl;var ci;var paletteacc=[];var pixelnum=imgd.width*imgd.height;var i;var j;var k;var cnt;var palette;for(j=0;j<imgd.height+2;j+=1){arr[j]=[];for(i=0;i<imgd.width+2;i+=1){arr[j][i]=-1;}}
if(options.pal){palette=options.pal;}else if(options.colorsampling===0){palette=this.generatepalette(options.numberofcolors);}else if(options.colorsampling===1){palette=this.samplepalette(options.numberofcolors,imgd);}else{palette=this.samplepalette2(options.numberofcolors,imgd);}
if(options.blurradius>0){imgd=this.blur(imgd,options.blurradius,options.blurdelta);}
for(cnt=0;cnt<options.colorquantcycles;cnt+=1){if(cnt>0){for(k=0;k<palette.length;k+=1){if(paletteacc[k].n>0){palette[k]={r:Math.floor(paletteacc[k].r/paletteacc[k].n),g:Math.floor(paletteacc[k].g/paletteacc[k].n),b:Math.floor(paletteacc[k].b/paletteacc[k].n),a:Math.floor(paletteacc[k].a/paletteacc[k].n)};}
if(paletteacc[k].n/pixelnum<options.mincolorratio&&cnt<options.colorquantcycles-1){palette[k]={r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255),a:Math.floor(Math.random()*255)};}}}
for(i=0;i<palette.length;i+=1){paletteacc[i]={r:0,g:0,b:0,a:0,n:0};}
for(j=0;j<imgd.height;j+=1){for(i=0;i<imgd.width;i+=1){idx=(j*imgd.width+i)*4;ci=0;cdl=1024;for(k=0;k<palette.length;k+=1){cd=Math.abs(palette[k].r-imgd.data[idx])+Math.abs(palette[k].g-imgd.data[idx+1])+Math.abs(palette[k].b-imgd.data[idx+2])+Math.abs(palette[k].a-imgd.data[idx+3]);if(cd<cdl){cdl=cd;ci=k;}}
paletteacc[ci].r+=imgd.data[idx];paletteacc[ci].g+=imgd.data[idx+1];paletteacc[ci].b+=imgd.data[idx+2];paletteacc[ci].a+=imgd.data[idx+3];paletteacc[ci].n+=1;arr[j+1][i+1]=ci;}}}
return{array:arr,palette:palette};}},{key:"samplepalette",value:function samplepalette(numberofcolors,imgd){var idx;var palette=[];for(var i=0;i<numberofcolors;i+=1){idx=Math.floor(Math.random()*imgd.data.length/4)*4;palette.push({r:imgd.data[idx],g:imgd.data[idx+1],b:imgd.data[idx+2],a:imgd.data[idx+3]});}
return palette;}},{key:"samplepalette2",value:function samplepalette2(numberofcolors,imgd){var idx;var palette=[];var ni=Math.ceil(Math.sqrt(numberofcolors));var nj=Math.ceil(numberofcolors/ni);var vx=imgd.width/(ni+1);var vy=imgd.height/(nj+1);for(var j=0;j<nj;j+=1){for(var i=0;i<ni;i+=1){if(palette.length===numberofcolors){break;}else{idx=Math.floor((j+1)*vy*imgd.width+(i+1)*vx)*4;palette.push({r:imgd.data[idx],g:imgd.data[idx+1],b:imgd.data[idx+2],a:imgd.data[idx+3]});}}}
return palette;}},{key:"generatepalette",value:function generatepalette(numberofcolors){var palette=[];var rcnt;var gcnt;var bcnt;if(numberofcolors<8){var graystep=Math.floor(255/(numberofcolors-1));for(var i=0;i<numberofcolors;i+=1){palette.push({r:i*graystep,g:i*graystep,b:i*graystep,a:255});}}else{var colorqnum=Math.floor(Math.pow(numberofcolors,1/3));var colorstep=Math.floor(255/(colorqnum-1));var rndnum=numberofcolors-colorqnum*colorqnum*colorqnum;for(rcnt=0;rcnt<colorqnum;rcnt+=1){for(gcnt=0;gcnt<colorqnum;gcnt+=1){for(bcnt=0;bcnt<colorqnum;bcnt+=1){palette.push({r:rcnt*colorstep,g:gcnt*colorstep,b:bcnt*colorstep,a:255});}}}
for(rcnt=0;rcnt<rndnum;rcnt+=1){palette.push({r:Math.floor(Math.random()*255),g:Math.floor(Math.random()*255),b:Math.floor(Math.random()*255),a:Math.floor(Math.random()*255)});}}
return palette;}},{key:"layering",value:function layering(ii){var layers=[];var val=0;var ah=ii.array.length;var aw=ii.array[0].length;var n1;var n2;var n3;var n4;var n5;var n6;var n7;var n8;var i;var j;var k;for(k=0;k<ii.palette.length;k+=1){layers[k]=[];for(j=0;j<ah;j+=1){layers[k][j]=[];for(i=0;i<aw;i+=1){layers[k][j][i]=0;}}}
for(j=1;j<ah-1;j+=1){for(i=1;i<aw-1;i+=1){val=ii.array[j][i];n1=ii.array[j-1][i-1]===val?1:0;n2=ii.array[j-1][i]===val?1:0;n3=ii.array[j-1][i+1]===val?1:0;n4=ii.array[j][i-1]===val?1:0;n5=ii.array[j][i+1]===val?1:0;n6=ii.array[j+1][i-1]===val?1:0;n7=ii.array[j+1][i]===val?1:0;n8=ii.array[j+1][i+1]===val?1:0;layers[val][j+1][i+1]=1+n5*2+n8*4+n7*8;if(!n4){layers[val][j+1][i]=0+2+n7*4+n6*8;}
if(!n2){layers[val][j][i+1]=0+n3*2+n5*4+8;}
if(!n1){layers[val][j][i]=0+n2*2+4+n4*8;}}}
return layers;}},{key:"layeringstep",value:function layeringstep(ii,cnum){var layer=[];var ah=ii.array.length;var aw=ii.array[0].length;var i;var j;for(j=0;j<ah;j+=1){layer[j]=[];for(i=0;i<aw;i+=1){layer[j][i]=0;}}
for(j=1;j<ah;j+=1){for(i=1;i<aw;i+=1){layer[j][i]=(ii.array[j-1][i-1]===cnum?1:0)+(ii.array[j-1][i]===cnum?2:0)+(ii.array[j][i-1]===cnum?8:0)+(ii.array[j][i]===cnum?4:0);}}
return layer;}},{key:"pathscan",value:function pathscan(arr,pathomit){var paths=[];var pacnt=0;var pcnt=0;var px=0;var py=0;var w=arr[0].length;var h=arr.length;var dir=0;var pathfinished=true;var holepath=false;var lookuprow;for(var j=0;j<h;j+=1){for(var i=0;i<w;i+=1){if(arr[j][i]===4||arr[j][i]===11){px=i;py=j;paths[pacnt]={};paths[pacnt].points=[];paths[pacnt].boundingbox=[px,py,px,py];paths[pacnt].holechildren=[];pathfinished=false;pcnt=0;holepath=arr[j][i]===11;dir=1;while(!pathfinished){paths[pacnt].points[pcnt]={};paths[pacnt].points[pcnt].x=px-1;paths[pacnt].points[pcnt].y=py-1;paths[pacnt].points[pcnt].t=arr[py][px];if(px-1<paths[pacnt].boundingbox[0]){paths[pacnt].boundingbox[0]=px-1;}
if(px-1>paths[pacnt].boundingbox[2]){paths[pacnt].boundingbox[2]=px-1;}
if(py-1<paths[pacnt].boundingbox[1]){paths[pacnt].boundingbox[1]=py-1;}
if(py-1>paths[pacnt].boundingbox[3]){paths[pacnt].boundingbox[3]=py-1;}
lookuprow=this.pathscan_combined_lookup[arr[py][px]][dir];arr[py][px]=lookuprow[0];dir=lookuprow[1];px+=lookuprow[2];py+=lookuprow[3];if(px-1===paths[pacnt].points[0].x&&py-1===paths[pacnt].points[0].y){pathfinished=true;if(paths[pacnt].points.length<pathomit){paths.pop();}else{paths[pacnt].isholepath=!!holepath;if(holepath){var parentidx=0,parentbbox=[-1,-1,w+1,h+1];for(var parentcnt=0;parentcnt<pacnt;parentcnt++){if(!paths[parentcnt].isholepath&&this.boundingboxincludes(paths[parentcnt].boundingbox,paths[pacnt].boundingbox)&&this.boundingboxincludes(parentbbox,paths[parentcnt].boundingbox)){parentidx=parentcnt;parentbbox=paths[parentcnt].boundingbox;}}
paths[parentidx].holechildren.push(pacnt);}
pacnt+=1;}}
pcnt+=1;}}}}
return paths;}},{key:"boundingboxincludes",value:function boundingboxincludes(parentbbox,childbbox){return parentbbox[0]<childbbox[0]&&parentbbox[1]<childbbox[1]&&parentbbox[2]>childbbox[2]&&parentbbox[3]>childbbox[3];}},{key:"batchpathscan",value:function batchpathscan(layers,pathomit){var bpaths=[];for(var k in layers){if(!layers.hasOwnProperty(k)){continue;}
bpaths[k]=this.pathscan(layers[k],pathomit);}
return bpaths;}},{key:"internodes",value:function internodes(paths,options){var ins=[];var palen=0;var nextidx=0;var nextidx2=0;var previdx=0;var previdx2=0;var pacnt;var pcnt;for(pacnt=0;pacnt<paths.length;pacnt+=1){ins[pacnt]={};ins[pacnt].points=[];ins[pacnt].boundingbox=paths[pacnt].boundingbox;ins[pacnt].holechildren=paths[pacnt].holechildren;ins[pacnt].isholepath=paths[pacnt].isholepath;palen=paths[pacnt].points.length;for(pcnt=0;pcnt<palen;pcnt+=1){nextidx=(pcnt+1)%palen;nextidx2=(pcnt+2)%palen;previdx=(pcnt-1+palen)%palen;previdx2=(pcnt-2+palen)%palen;if(options.rightangleenhance&&this.testrightangle(paths[pacnt],previdx2,previdx,pcnt,nextidx,nextidx2)){if(ins[pacnt].points.length>0){ins[pacnt].points[ins[pacnt].points.length-1].linesegment=this.getdirection(ins[pacnt].points[ins[pacnt].points.length-1].x,ins[pacnt].points[ins[pacnt].points.length-1].y,paths[pacnt].points[pcnt].x,paths[pacnt].points[pcnt].y);}
ins[pacnt].points.push({x:paths[pacnt].points[pcnt].x,y:paths[pacnt].points[pcnt].y,linesegment:this.getdirection(paths[pacnt].points[pcnt].x,paths[pacnt].points[pcnt].y,(paths[pacnt].points[pcnt].x+paths[pacnt].points[nextidx].x)/2,(paths[pacnt].points[pcnt].y+paths[pacnt].points[nextidx].y)/2)});}
ins[pacnt].points.push({x:(paths[pacnt].points[pcnt].x+paths[pacnt].points[nextidx].x)/2,y:(paths[pacnt].points[pcnt].y+paths[pacnt].points[nextidx].y)/2,linesegment:this.getdirection((paths[pacnt].points[pcnt].x+paths[pacnt].points[nextidx].x)/2,(paths[pacnt].points[pcnt].y+paths[pacnt].points[nextidx].y)/2,(paths[pacnt].points[nextidx].x+paths[pacnt].points[nextidx2].x)/2,(paths[pacnt].points[nextidx].y+paths[pacnt].points[nextidx2].y)/2)});}}
return ins;}},{key:"testrightangle",value:function testrightangle(path,idx1,idx2,idx3,idx4,idx5){return path.points[idx3].x===path.points[idx1].x&&path.points[idx3].x===path.points[idx2].x&&path.points[idx3].y===path.points[idx4].y&&path.points[idx3].y===path.points[idx5].y||path.points[idx3].y===path.points[idx1].y&&path.points[idx3].y===path.points[idx2].y&&path.points[idx3].x===path.points[idx4].x&&path.points[idx3].x===path.points[idx5].x;}},{key:"getdirection",value:function getdirection(x1,y1,x2,y2){var val=8;if(x1<x2){if(y1<y2){val=1;}else if(y1>y2){val=7;}else{val=0;}}else if(x1>x2){if(y1<y2){val=3;}else if(y1>y2){val=5;}else{val=4;}}else if(y1<y2){val=2;}else if(y1>y2){val=6;}else{val=8;}
return val;}},{key:"batchinternodes",value:function batchinternodes(bpaths,options){var binternodes=[];for(var k in bpaths){if(!bpaths.hasOwnProperty(k)){continue;}
binternodes[k]=this.internodes(bpaths[k],options);}
return binternodes;}},{key:"tracepath",value:function tracepath(path,ltres,qtres){var pcnt=0;var segtype1;var segtype2;var seqend;var smp={};smp.segments=[];smp.boundingbox=path.boundingbox;smp.holechildren=path.holechildren;smp.isholepath=path.isholepath;while(pcnt<path.points.length){var _context;segtype1=path.points[pcnt].linesegment;segtype2=-1;seqend=pcnt+1;while((path.points[seqend].linesegment===segtype1||path.points[seqend].linesegment===segtype2||segtype2===-1)&&seqend<path.points.length-1){if(path.points[seqend].linesegment!==segtype1&&segtype2===-1){segtype2=path.points[seqend].linesegment;}
seqend+=1;}
if(seqend===path.points.length-1){seqend=0;}
smp.segments=concat_default()(_context=smp.segments).call(_context,this.fitseq(path,ltres,qtres,pcnt,seqend));if(seqend>0){pcnt=seqend;}else{pcnt=path.points.length;}}
return smp;}},{key:"fitseq",value:function fitseq(path,ltres,qtres,seqstart,seqend){var _context2;if(seqend>path.points.length||seqend<0){return[];}
var errorpoint=seqstart,errorval=0,curvepass=true,px,py,dist2;var tl=seqend-seqstart;if(tl<0){tl+=path.points.length;}
var vx=(path.points[seqend].x-path.points[seqstart].x)/tl,vy=(path.points[seqend].y-path.points[seqstart].y)/tl;var pcnt=(seqstart+1)%path.points.length,pl;while(pcnt!=seqend){pl=pcnt-seqstart;if(pl<0){pl+=path.points.length;}
px=path.points[seqstart].x+vx*pl;py=path.points[seqstart].y+vy*pl;dist2=(path.points[pcnt].x-px)*(path.points[pcnt].x-px)+(path.points[pcnt].y-py)*(path.points[pcnt].y-py);if(dist2>ltres){curvepass=false;}
if(dist2>errorval){errorpoint=pcnt;errorval=dist2;}
pcnt=(pcnt+1)%path.points.length;}
if(curvepass){return[{type:'L',x1:path.points[seqstart].x,y1:path.points[seqstart].y,x2:path.points[seqend].x,y2:path.points[seqend].y}];}
var fitpoint=errorpoint;curvepass=true;errorval=0;var t=(fitpoint-seqstart)/tl,t1=(1-t)*(1-t),t2=2*(1-t)*t,t3=t*t;var cpx=(t1*path.points[seqstart].x+t3*path.points[seqend].x-path.points[fitpoint].x)/-t2,cpy=(t1*path.points[seqstart].y+t3*path.points[seqend].y-path.points[fitpoint].y)/-t2;pcnt=seqstart+1;while(pcnt!=seqend){t=(pcnt-seqstart)/tl;t1=(1-t)*(1-t);t2=2*(1-t)*t;t3=t*t;px=t1*path.points[seqstart].x+t2*cpx+t3*path.points[seqend].x;py=t1*path.points[seqstart].y+t2*cpy+t3*path.points[seqend].y;dist2=(path.points[pcnt].x-px)*(path.points[pcnt].x-px)+(path.points[pcnt].y-py)*(path.points[pcnt].y-py);if(dist2>qtres){curvepass=false;}
if(dist2>errorval){errorpoint=pcnt;errorval=dist2;}
pcnt=(pcnt+1)%path.points.length;}
if(curvepass){return[{type:'Q',x1:path.points[seqstart].x,y1:path.points[seqstart].y,x2:cpx,y2:cpy,x3:path.points[seqend].x,y3:path.points[seqend].y}];}
var splitpoint=fitpoint;return concat_default()(_context2=this.fitseq(path,ltres,qtres,seqstart,splitpoint)).call(_context2,this.fitseq(path,ltres,qtres,splitpoint,seqend));}},{key:"batchtracepaths",value:function batchtracepaths(internodepaths,ltres,qtres){var btracedpaths=[];for(var k in internodepaths){if(!internodepaths.hasOwnProperty(k)){continue;}
btracedpaths.push(this.tracepath(internodepaths[k],ltres,qtres));}
return btracedpaths;}},{key:"batchtracelayers",value:function batchtracelayers(binternodes,ltres,qtres){var btbis=[];for(var k in binternodes){if(!binternodes.hasOwnProperty(k)){continue;}
btbis[k]=this.batchtracepaths(binternodes[k],ltres,qtres);}
return btbis;}},{key:"roundtodec",value:function roundtodec(val,places){return Number(val.toFixed(places));}},{key:"svgpathstring",value:function svgpathstring(tracedata,lnum,pathnum,options){var _context3,_context4;var layer=tracedata.layers[lnum],smp=layer[pathnum],str='',pcnt;if(options.linefilter&&smp.segments.length<3){return str;}
str=concat_default()(_context3="<path ".concat(options.desc?concat_default()(_context4="desc=\"l ".concat(lnum," p ")).call(_context4,pathnum,"\" "):'')).call(_context3,this.tosvgcolorstr(tracedata.palette[lnum],options),"d=\"");if(options.roundcoords===-1){var _context5;str+=concat_default()(_context5="M ".concat(smp.segments[0].x1*options.scale," ")).call(_context5,smp.segments[0].y1*options.scale," ");for(pcnt=0;pcnt<smp.segments.length;pcnt++){var _context6,_context7;str+=concat_default()(_context6=concat_default()(_context7="".concat(smp.segments[pcnt].type," ")).call(_context7,smp.segments[pcnt].x2*options.scale," ")).call(_context6,smp.segments[pcnt].y2*options.scale," ");if(smp.segments[pcnt].hasOwnProperty('x3')){var _context8;str+=concat_default()(_context8="".concat(smp.segments[pcnt].x3*options.scale," ")).call(_context8,smp.segments[pcnt].y3*options.scale," ");}}
str+='Z ';}else{var _context9;str+=concat_default()(_context9="M ".concat(this.roundtodec(smp.segments[0].x1*options.scale,options.roundcoords)," ")).call(_context9,this.roundtodec(smp.segments[0].y1*options.scale,options.roundcoords)," ");for(pcnt=0;pcnt<smp.segments.length;pcnt++){var _context10,_context11;str+=concat_default()(_context10=concat_default()(_context11="".concat(smp.segments[pcnt].type," ")).call(_context11,this.roundtodec(smp.segments[pcnt].x2*options.scale,options.roundcoords)," ")).call(_context10,this.roundtodec(smp.segments[pcnt].y2*options.scale,options.roundcoords)," ");if(smp.segments[pcnt].hasOwnProperty('x3')){var _context12;str+=concat_default()(_context12="".concat(this.roundtodec(smp.segments[pcnt].x3*options.scale,options.roundcoords)," ")).call(_context12,this.roundtodec(smp.segments[pcnt].y3*options.scale,options.roundcoords)," ");}}
str+='Z ';}
for(var hcnt=0;hcnt<smp.holechildren.length;hcnt++){var hsmp=layer[smp.holechildren[hcnt]];if(options.roundcoords===-1){if(hsmp.segments[hsmp.segments.length-1].hasOwnProperty('x3')){var _context13;str+=concat_default()(_context13="M ".concat(hsmp.segments[hsmp.segments.length-1].x3*options.scale," ")).call(_context13,hsmp.segments[hsmp.segments.length-1].y3*options.scale," ");}else{var _context14;str+=concat_default()(_context14="M ".concat(hsmp.segments[hsmp.segments.length-1].x2*options.scale," ")).call(_context14,hsmp.segments[hsmp.segments.length-1].y2*options.scale," ");}
for(pcnt=hsmp.segments.length-1;pcnt>=0;pcnt--){var _context16;str+="".concat(hsmp.segments[pcnt].type," ");if(hsmp.segments[pcnt].hasOwnProperty('x3')){var _context15;str+=concat_default()(_context15="".concat(hsmp.segments[pcnt].x2*options.scale," ")).call(_context15,hsmp.segments[pcnt].y2*options.scale," ");}
str+=concat_default()(_context16="".concat(hsmp.segments[pcnt].x1*options.scale," ")).call(_context16,hsmp.segments[pcnt].y1*options.scale," ");}}else{if(hsmp.segments[hsmp.segments.length-1].hasOwnProperty('x3')){var _context17;str+=concat_default()(_context17="M ".concat(this.roundtodec(hsmp.segments[hsmp.segments.length-1].x3*options.scale)," ")).call(_context17,this.roundtodec(hsmp.segments[hsmp.segments.length-1].y3*options.scale)," ");}else{var _context18;str+=concat_default()(_context18="M ".concat(this.roundtodec(hsmp.segments[hsmp.segments.length-1].x2*options.scale)," ")).call(_context18,this.roundtodec(hsmp.segments[hsmp.segments.length-1].y2*options.scale)," ");}
for(pcnt=hsmp.segments.length-1;pcnt>=0;pcnt--){var _context20;str+="".concat(hsmp.segments[pcnt].type," ");if(hsmp.segments[pcnt].hasOwnProperty('x3')){var _context19;str+=concat_default()(_context19="".concat(this.roundtodec(hsmp.segments[pcnt].x2*options.scale)," ")).call(_context19,this.roundtodec(hsmp.segments[pcnt].y2*options.scale)," ");}
str+=concat_default()(_context20="".concat(this.roundtodec(hsmp.segments[pcnt].x1*options.scale)," ")).call(_context20,this.roundtodec(hsmp.segments[pcnt].y1*options.scale)," ");}}
str+='Z ';}
str+='" />';if(options.lcpr||options.qcpr){for(pcnt=0;pcnt<smp.segments.length;pcnt++){if(smp.segments[pcnt].hasOwnProperty('x3')&&options.qcpr){var _context21,_context22,_context23,_context24,_context25,_context26,_context27,_context28,_context29,_context30,_context31,_context32,_context33,_context34;str+=concat_default()(_context21=concat_default()(_context22=concat_default()(_context23="<circle cx=\"".concat(smp.segments[pcnt].x2*options.scale,"\" cy=\"")).call(_context23,smp.segments[pcnt].y2*options.scale,"\" r=\"")).call(_context22,options.qcpr,"\" fill=\"cyan\" stroke-width=\"")).call(_context21,options.qcpr*0.2,"\" stroke=\"black\" />");str+=concat_default()(_context24=concat_default()(_context25=concat_default()(_context26="<circle cx=\"".concat(smp.segments[pcnt].x3*options.scale,"\" cy=\"")).call(_context26,smp.segments[pcnt].y3*options.scale,"\" r=\"")).call(_context25,options.qcpr,"\" fill=\"white\" stroke-width=\"")).call(_context24,options.qcpr*0.2,"\" stroke=\"black\" />");str+=concat_default()(_context27=concat_default()(_context28=concat_default()(_context29=concat_default()(_context30="<line x1=\"".concat(smp.segments[pcnt].x1*options.scale,"\" y1=\"")).call(_context30,smp.segments[pcnt].y1*options.scale,"\" x2=\"")).call(_context29,smp.segments[pcnt].x2*options.scale,"\" y2=\"")).call(_context28,smp.segments[pcnt].y2*options.scale,"\" stroke-width=\"")).call(_context27,options.qcpr*0.2,"\" stroke=\"cyan\" />");str+=concat_default()(_context31=concat_default()(_context32=concat_default()(_context33=concat_default()(_context34="<line x1=\"".concat(smp.segments[pcnt].x2*options.scale,"\" y1=\"")).call(_context34,smp.segments[pcnt].y2*options.scale,"\" x2=\"")).call(_context33,smp.segments[pcnt].x3*options.scale,"\" y2=\"")).call(_context32,smp.segments[pcnt].y3*options.scale,"\" stroke-width=\"")).call(_context31,options.qcpr*0.2,"\" stroke=\"cyan\" />");}
if(!smp.segments[pcnt].hasOwnProperty('x3')&&options.lcpr){var _context35,_context36,_context37;str+=concat_default()(_context35=concat_default()(_context36=concat_default()(_context37="<circle cx=\"".concat(smp.segments[pcnt].x2*options.scale,"\" cy=\"")).call(_context37,smp.segments[pcnt].y2*options.scale,"\" r=\"")).call(_context36,options.lcpr,"\" fill=\"white\" stroke-width=\"")).call(_context35,options.lcpr*0.2,"\" stroke=\"black\" />");}}
for(var hcnt=0;hcnt<smp.holechildren.length;hcnt++){var hsmp=layer[smp.holechildren[hcnt]];for(pcnt=0;pcnt<hsmp.segments.length;pcnt++){if(hsmp.segments[pcnt].hasOwnProperty('x3')&&options.qcpr){var _context38,_context39,_context40,_context41,_context42,_context43,_context44,_context45,_context46,_context47,_context48,_context49,_context50,_context51;str+=concat_default()(_context38=concat_default()(_context39=concat_default()(_context40="<circle cx=\"".concat(hsmp.segments[pcnt].x2*options.scale,"\" cy=\"")).call(_context40,hsmp.segments[pcnt].y2*options.scale,"\" r=\"")).call(_context39,options.qcpr,"\" fill=\"cyan\" stroke-width=\"")).call(_context38,options.qcpr*0.2,"\" stroke=\"black\" />");str+=concat_default()(_context41=concat_default()(_context42=concat_default()(_context43="<circle cx=\"".concat(hsmp.segments[pcnt].x3*options.scale,"\" cy=\"")).call(_context43,hsmp.segments[pcnt].y3*options.scale,"\" r=\"")).call(_context42,options.qcpr,"\" fill=\"white\" stroke-width=\"")).call(_context41,options.qcpr*0.2,"\" stroke=\"black\" />");str+=concat_default()(_context44=concat_default()(_context45=concat_default()(_context46=concat_default()(_context47="<line x1=\"".concat(hsmp.segments[pcnt].x1*options.scale,"\" y1=\"")).call(_context47,hsmp.segments[pcnt].y1*options.scale,"\" x2=\"")).call(_context46,hsmp.segments[pcnt].x2*options.scale,"\" y2=\"")).call(_context45,hsmp.segments[pcnt].y2*options.scale,"\" stroke-width=\"")).call(_context44,options.qcpr*0.2,"\" stroke=\"cyan\" />");str+=concat_default()(_context48=concat_default()(_context49=concat_default()(_context50=concat_default()(_context51="<line x1=\"".concat(hsmp.segments[pcnt].x2*options.scale,"\" y1=\"")).call(_context51,hsmp.segments[pcnt].y2*options.scale,"\" x2=\"")).call(_context50,hsmp.segments[pcnt].x3*options.scale,"\" y2=\"")).call(_context49,hsmp.segments[pcnt].y3*options.scale,"\" stroke-width=\"")).call(_context48,options.qcpr*0.2,"\" stroke=\"cyan\" />");}
if(!hsmp.segments[pcnt].hasOwnProperty('x3')&&options.lcpr){var _context52,_context53,_context54;str+=concat_default()(_context52=concat_default()(_context53=concat_default()(_context54="<circle cx=\"".concat(hsmp.segments[pcnt].x2*options.scale,"\" cy=\"")).call(_context54,hsmp.segments[pcnt].y2*options.scale,"\" r=\"")).call(_context53,options.lcpr,"\" fill=\"white\" stroke-width=\"")).call(_context52,options.lcpr*0.2,"\" stroke=\"black\" />");}}}}
return str;}},{key:"getsvgstring",value:function getsvgstring(tracedata,options){var _context55,_context56,_context57;options=this.checkoptions(options);var w=tracedata.width*options.scale;var h=tracedata.height*options.scale;var svgstr=concat_default()(_context55="<svg ".concat(options.viewbox?concat_default()(_context56="viewBox=\"0 0 ".concat(w," ")).call(_context56,h,"\" "):concat_default()(_context57="width=\"".concat(w,"\" height=\"")).call(_context57,h,"\" "),"version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" desc=\"Created with imagetracer.js version ")).call(_context55,this.versionnumber,"\" >");for(var lcnt=0;lcnt<tracedata.layers.length;lcnt+=1){for(var pcnt=0;pcnt<tracedata.layers[lcnt].length;pcnt+=1){if(!tracedata.layers[lcnt][pcnt].isholepath){svgstr+=this.svgpathstring(tracedata,lcnt,pcnt,options);}}}
svgstr+='</svg>';return svgstr;}},{key:"compareNumbers",value:function compareNumbers(a,b){return a-b;}},{key:"torgbastr",value:function torgbastr(c){var _context58,_context59,_context60;return concat_default()(_context58=concat_default()(_context59=concat_default()(_context60="rgba(".concat(c.r,",")).call(_context60,c.g,",")).call(_context59,c.b,",")).call(_context58,c.a,")");}},{key:"tosvgcolorstr",value:function tosvgcolorstr(c,options){var _context61,_context62,_context63,_context64,_context65,_context66,_context67;return concat_default()(_context61=concat_default()(_context62=concat_default()(_context63=concat_default()(_context64=concat_default()(_context65=concat_default()(_context66=concat_default()(_context67="fill=\"rgb(".concat(c.r,",")).call(_context67,c.g,",")).call(_context66,c.b,")\" stroke=\"rgb(")).call(_context65,c.r,",")).call(_context64,c.g,",")).call(_context63,c.b,")\" stroke-width=\"")).call(_context62,options.strokewidth,"\" opacity=\"")).call(_context61,c.a/255.0,"\" ");}},{key:"appendSVGString",value:function appendSVGString(svgstr,parentid){var div;if(parentid){div=document.getElementById(parentid);if(!div){div=document.createElement('div');div.id=parentid;document.body.appendChild(div);}}else{div=document.createElement('div');document.body.appendChild(div);}
div.innerHTML+=svgstr;}},{key:"blur",value:function blur(imgd,radius,delta){var i,j,k,d,idx,racc,gacc,bacc,aacc,wacc;var imgd2={width:imgd.width,height:imgd.height,data:[]};radius=Math.floor(radius);if(radius<1){return imgd;}
if(radius>5){radius=5;}
delta=Math.abs(delta);if(delta>1024){delta=1024;}
var thisgk=this.gks[radius-1];for(j=0;j<imgd.height;j++){for(i=0;i<imgd.width;i++){racc=0;gacc=0;bacc=0;aacc=0;wacc=0;for(k=-radius;k<radius+1;k++){if(i+k>0&&i+k<imgd.width){idx=(j*imgd.width+i+k)*4;racc+=imgd.data[idx]*thisgk[k+radius];gacc+=imgd.data[idx+1]*thisgk[k+radius];bacc+=imgd.data[idx+2]*thisgk[k+radius];aacc+=imgd.data[idx+3]*thisgk[k+radius];wacc+=thisgk[k+radius];}}
idx=(j*imgd.width+i)*4;imgd2.data[idx]=Math.floor(racc/wacc);imgd2.data[idx+1]=Math.floor(gacc/wacc);imgd2.data[idx+2]=Math.floor(bacc/wacc);imgd2.data[idx+3]=Math.floor(aacc/wacc);}}
var himgd=new Uint8ClampedArray(imgd2.data);for(j=0;j<imgd.height;j++){for(i=0;i<imgd.width;i++){racc=0;gacc=0;bacc=0;aacc=0;wacc=0;for(k=-radius;k<radius+1;k++){if(j+k>0&&j+k<imgd.height){idx=((j+k)*imgd.width+i)*4;racc+=himgd[idx]*thisgk[k+radius];gacc+=himgd[idx+1]*thisgk[k+radius];bacc+=himgd[idx+2]*thisgk[k+radius];aacc+=himgd[idx+3]*thisgk[k+radius];wacc+=thisgk[k+radius];}}
idx=(j*imgd.width+i)*4;imgd2.data[idx]=Math.floor(racc/wacc);imgd2.data[idx+1]=Math.floor(gacc/wacc);imgd2.data[idx+2]=Math.floor(bacc/wacc);imgd2.data[idx+3]=Math.floor(aacc/wacc);}}
for(j=0;j<imgd.height;j++){for(i=0;i<imgd.width;i++){idx=(j*imgd.width+i)*4;d=Math.abs(imgd2.data[idx]-imgd.data[idx])+Math.abs(imgd2.data[idx+1]-imgd.data[idx+1])+Math.abs(imgd2.data[idx+2]-imgd.data[idx+2])+Math.abs(imgd2.data[idx+3]-imgd.data[idx+3]);if(d>delta){imgd2.data[idx]=imgd.data[idx];imgd2.data[idx+1]=imgd.data[idx+1];imgd2.data[idx+2]=imgd.data[idx+2];imgd2.data[idx+3]=imgd.data[idx+3];}}}
return imgd2;}},{key:"loadImage",value:function loadImage(url,callback,options){var img=new Image();if(options&&options.corsenabled){img.crossOrigin='Anonymous';}
img.src=url;img.onload=function(){var canvas=document.createElement('canvas');canvas.width=img.width;canvas.height=img.height;var context=canvas.getContext('2d');context.drawImage(img,0,0);callback(canvas);};}},{key:"getImgdata",value:function getImgdata(canvas){var context=canvas.getContext('2d');return context.getImageData(0,0,canvas.width,canvas.height);}},{key:"drawLayers",value:function drawLayers(layers,palette,scale,parentid){scale=scale||1;var w,h,i,j,k;var div;if(parentid){div=document.getElementById(parentid);if(!div){div=document.createElement('div');div.id=parentid;document.body.appendChild(div);}}else{div=document.createElement('div');document.body.appendChild(div);}
for(k in layers){if(!layers.hasOwnProperty(k)){continue;}
w=layers[k][0].length;h=layers[k].length;var canvas=document.createElement('canvas');canvas.width=w*scale;canvas.height=h*scale;var context=canvas.getContext('2d');for(j=0;j<h;j+=1){for(i=0;i<w;i+=1){context.fillStyle=this.torgbastr(palette[layers[k][j][i]%palette.length]);context.fillRect(i*scale,j*scale,scale,scale);}}
div.appendChild(canvas);}}}],[{key:"tracerDefaultOption",value:function tracerDefaultOption(){return{pathomit:100,ltres:0.1,qtres:1,scale:1,strokewidth:5,viewbox:false,linefilter:true,desc:false,rightangleenhance:false,pal:[{r:0,g:0,b:0,a:255},{r:255,g:255,b:255,a:255}]};}}]);return ImageTracer;}();;var action=({getActions:function getActions(){return{main:this._mainAction(),shape:this._shapeAction(),crop:this._cropAction(),resize:this._resizeAction(),flip:this._flipAction(),rotate:this._rotateAction(),text:this._textAction(),mask:this._maskAction(),draw:this._drawAction(),icon:this._iconAction(),filter:this._filterAction(),history:this._historyAction()};},_mainAction:function _mainAction(){var _this=this;var exitCropOnAction=function exitCropOnAction(){if(_this.ui.submenu==='crop'){_this.stopDrawingMode();_this.ui.changeMenu('crop');}};var setAngleRangeBarOnAction=function setAngleRangeBarOnAction(angle){if(_this.ui.submenu==='rotate'){_this.ui.rotate.setRangeBarAngle('setAngle',angle);}};var setFilterStateRangeBarOnAction=function setFilterStateRangeBarOnAction(filterOptions){if(_this.ui.submenu==='filter'){filter_default()(_this.ui).setFilterState(filterOptions);}};var onEndUndoRedo=function onEndUndoRedo(result){setAngleRangeBarOnAction(result);setFilterStateRangeBarOnAction(result);return result;};var toggleZoomMode=function toggleZoomMode(){var zoomMode=_this._graphics.getZoomMode();_this.stopDrawingMode();if(zoomMode!==zoomModes.ZOOM){_this.startDrawingMode(drawingModes.ZOOM);_this._graphics.startZoomInMode();}else{_this._graphics.endZoomInMode();}};var toggleHandMode=function toggleHandMode(){var zoomMode=_this._graphics.getZoomMode();_this.stopDrawingMode();if(zoomMode!==zoomModes.HAND){_this.startDrawingMode(drawingModes.ZOOM);_this._graphics.startHandMode();}else{_this._graphics.endHandMode();}};var initFilterState=function initFilterState(){if(filter_default()(_this.ui)){filter_default()(_this.ui).initFilterCheckBoxState();}};return extend_default()({initLoadImage:function initLoadImage(imagePath,imageName){return _this.loadImageFromURL(imagePath,imageName).then(function(sizeValue){exitCropOnAction();_this.ui.initializeImgUrl=imagePath;_this.ui.resizeEditor({imageSize:sizeValue});_this.clearUndoStack();_this._invoker.fire(eventNames.EXECUTE_COMMAND,historyNames.LOAD_IMAGE);});},undo:function undo(){if(!_this.isEmptyUndoStack()){exitCropOnAction();_this.deactivateAll();_this.undo().then(onEndUndoRedo);}},redo:function redo(){if(!_this.isEmptyRedoStack()){exitCropOnAction();_this.deactivateAll();_this.redo().then(onEndUndoRedo);}},reset:function reset(){exitCropOnAction();_this.loadImageFromURL(_this.ui.initializeImgUrl,'resetImage').then(function(sizeValue){exitCropOnAction();initFilterState();_this.ui.resizeEditor({imageSize:sizeValue});_this.clearUndoStack();_this._initHistory();});},delete:function _delete(){_this.ui.changeHelpButtonEnabled('delete',false);exitCropOnAction();_this.removeActiveObject();_this.activeObjectId=null;},deleteAll:function deleteAll(){exitCropOnAction();_this.clearObjects();_this.ui.changeHelpButtonEnabled('delete',false);_this.ui.changeHelpButtonEnabled('deleteAll',false);},load:function load(file){if(!isSupportFileApi()){alert('This browser does not support file-api');}
_this.ui.initializeImgUrl=url_default().createObjectURL(file);_this.loadImageFromFile(file).then(function(sizeValue){exitCropOnAction();initFilterState();_this.clearUndoStack();_this.ui.activeMenuEvent();_this.ui.resizeEditor({imageSize:sizeValue});_this._clearHistory();_this._invoker.fire(eventNames.EXECUTE_COMMAND,historyNames.LOAD_IMAGE);})['catch'](function(message){return promise_default().reject(message);});},download:function download(){var dataURL=_this.toDataURL();var imageName=_this.getImageName();var blob,type,w;if(isSupportFileApi()&&window.saveAs){blob=base64ToBlob(dataURL);type=blob.type.split('/')[1];if(imageName.split('.').pop()!==type){imageName+=".".concat(type);}
saveAs(blob,imageName);}else{w=window.open();w.document.body.innerHTML="<img src='".concat(dataURL,"'>");}},history:function history(event){_this.ui.toggleHistoryMenu(event);},zoomIn:function zoomIn(){_this.ui.toggleZoomButtonStatus('zoomIn');_this.deactivateAll();toggleZoomMode();},zoomOut:function zoomOut(){_this._graphics.zoomOut();},hand:function hand(){_this.ui.offZoomInButtonStatus();_this.ui.toggleZoomButtonStatus('hand');_this.deactivateAll();toggleHandMode();}},this._commonAction());},_iconAction:function _iconAction(){var _this2=this;return extend_default()({changeColor:function changeColor(color){if(_this2.activeObjectId){_this2.changeIconColor(_this2.activeObjectId,color);}},addIcon:function addIcon(iconType,iconColor){_this2.startDrawingMode('ICON');_this2.setDrawingIcon(iconType,iconColor);},cancelAddIcon:function cancelAddIcon(){_this2.ui.icon.clearIconType();_this2.changeSelectableAll(true);_this2.changeCursor('default');_this2.stopDrawingMode();},registerDefaultIcons:function registerDefaultIcons(type,path){var iconObj={};iconObj[type]=path;_this2.registerIcons(iconObj);},registerCustomIcon:function registerCustomIcon(imgUrl,file){var imagetracer=new ImageTracer();imagetracer.imageToSVG(imgUrl,function(svgstr){var _svgstr$match=svgstr.match(/path[^>]*d="([^"]*)"/),_svgstr$match2=_slicedToArray(_svgstr$match,2),svgPath=_svgstr$match2[1];var iconObj={};iconObj[file.name]=svgPath;_this2.registerIcons(iconObj);_this2.addIcon(file.name,{left:100,top:100});},ImageTracer.tracerDefaultOption());}},this._commonAction());},_drawAction:function _drawAction(){var _this3=this;return extend_default()({setDrawMode:function setDrawMode(type,settings){_this3.stopDrawingMode();if(type==='free'){_this3.startDrawingMode('FREE_DRAWING',settings);}else{_this3.startDrawingMode('LINE_DRAWING',settings);}},setColor:function setColor(color){_this3.setBrush({color:color});}},this._commonAction());},_maskAction:function _maskAction(){var _this4=this;return extend_default()({loadImageFromURL:function loadImageFromURL(imgUrl,file){return _this4.loadImageFromURL(_this4.toDataURL(),'FilterImage').then(function(){_this4.addImageObject(imgUrl).then(function(){url_default().revokeObjectURL(file);});_this4._invoker.fire(eventNames.EXECUTE_COMMAND,historyNames.LOAD_MASK_IMAGE);});},applyFilter:function applyFilter(){_this4.applyFilter('mask',{maskObjId:_this4.activeObjectId});}},this._commonAction());},_textAction:function _textAction(){var _this5=this;return extend_default()({changeTextStyle:function changeTextStyle(styleObj,isSilent){if(_this5.activeObjectId){_this5.changeTextStyle(_this5.activeObjectId,styleObj,isSilent);}}},this._commonAction());},_rotateAction:function _rotateAction(){var _this6=this;return extend_default()({rotate:function rotate(angle,isSilent){_this6.rotate(angle,isSilent);_this6.ui.resizeEditor();_this6.ui.rotate.setRangeBarAngle('rotate',angle);},setAngle:function setAngle(angle,isSilent){_this6.setAngle(angle,isSilent);_this6.ui.resizeEditor();_this6.ui.rotate.setRangeBarAngle('setAngle',angle);}},this._commonAction());},_shapeAction:function _shapeAction(){var _this7=this;return extend_default()({changeShape:function changeShape(changeShapeObject,isSilent){if(_this7.activeObjectId){_this7.changeShape(_this7.activeObjectId,changeShapeObject,isSilent);}},setDrawingShape:function setDrawingShape(shapeType){_this7.setDrawingShape(shapeType);}},this._commonAction());},_cropAction:function _cropAction(){var _this8=this;return extend_default()({crop:function crop(){var cropRect=_this8.getCropzoneRect();if(cropRect&&!isEmptyCropzone(cropRect)){_this8.crop(cropRect).then(function(){_this8.stopDrawingMode();_this8.ui.resizeEditor();_this8.ui.changeMenu('crop');_this8._invoker.fire(eventNames.EXECUTE_COMMAND,historyNames.CROP);})['catch'](function(message){return promise_default().reject(message);});}},cancel:function cancel(){_this8.stopDrawingMode();_this8.ui.changeMenu('crop');},preset:function preset(presetType){switch(presetType){case'preset-square':_this8.setCropzoneRect(1/1);break;case'preset-3-2':_this8.setCropzoneRect(3/2);break;case'preset-4-3':_this8.setCropzoneRect(4/3);break;case'preset-5-4':_this8.setCropzoneRect(5/4);break;case'preset-7-5':_this8.setCropzoneRect(7/5);break;case'preset-16-9':_this8.setCropzoneRect(16/9);break;default:_this8.setCropzoneRect();_this8.ui.crop.changeApplyButtonStatus(false);break;}}},this._commonAction());},_resizeAction:function _resizeAction(){var _this9=this;return extend_default()({getCurrentDimensions:function getCurrentDimensions(){return _this9._graphics.getCurrentDimensions();},preview:function preview(actor,value,lockState){var currentDimensions=_this9._graphics.getCurrentDimensions();var calcAspectRatio=function calcAspectRatio(){return currentDimensions.width/currentDimensions.height;};var dimensions={};switch(actor){case'width':dimensions.width=value;if(lockState){dimensions.height=value/calcAspectRatio();}else{dimensions.height=currentDimensions.height;}
break;case'height':dimensions.height=value;if(lockState){dimensions.width=value*calcAspectRatio();}else{dimensions.width=currentDimensions.width;}
break;default:dimensions=currentDimensions;}
_this9._graphics.resize(dimensions).then(function(){_this9.ui.resizeEditor();});if(lockState){_this9.ui.resize.setWidthValue(dimensions.width);_this9.ui.resize.setHeightValue(dimensions.height);}},lockAspectRatio:function lockAspectRatio(lockState,min,max){var _this9$_graphics$getC=_this9._graphics.getCurrentDimensions(),width=_this9$_graphics$getC.width,height=_this9$_graphics$getC.height;var aspectRatio=width/height;if(lockState){if(width>height){var pMax=max/aspectRatio;var pMin=min*aspectRatio;_this9.ui.resize.setLimit({minWidth:pMin>min?pMin:min,minHeight:min,maxWidth:max,maxHeight:pMax<max?pMax:max});}else{var _pMax=max*aspectRatio;var _pMin=min/aspectRatio;_this9.ui.resize.setLimit({minWidth:min,minHeight:_pMin>min?_pMin:min,maxWidth:_pMax<max?_pMax:max,maxHeight:max});}}else{_this9.ui.resize.setLimit({minWidth:min,minHeight:min,maxWidth:max,maxHeight:max});}},resize:function resize(){var dimensions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!dimensions){dimensions=_this9._graphics.getCurrentDimensions();}
_this9.resize(dimensions).then(function(){_this9._graphics.setOriginalDimensions(dimensions);_this9.stopDrawingMode();_this9.ui.resizeEditor();_this9.ui.changeMenu('resize');})['catch'](function(message){return promise_default().reject(message);});},reset:function reset(){var standByMode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var dimensions=_this9._graphics.getOriginalDimensions();_this9.ui.resize.setWidthValue(dimensions.width,true);_this9.ui.resize.setHeightValue(dimensions.height,true);_this9._graphics.resize(dimensions).then(function(){if(!standByMode){_this9.stopDrawingMode();_this9.ui.resizeEditor();_this9.ui.changeMenu('resize');}});}},this._commonAction());},_flipAction:function _flipAction(){var _this10=this;return extend_default()({flip:function flip(flipType){return _this10[flipType]();}},this._commonAction());},_filterAction:function _filterAction(){var _this11=this;return extend_default()({applyFilter:function applyFilter(applying,type,options,isSilent){if(applying){_this11.applyFilter(type,options,isSilent);}else if(_this11.hasFilter(type)){_this11.removeFilter(type);}}},this._commonAction());},setReAction:function setReAction(){var _this12=this;this.on({undoStackChanged:function undoStackChanged(length){if(length){_this12.ui.changeHelpButtonEnabled('undo',true);_this12.ui.changeHelpButtonEnabled('reset',true);}else{_this12.ui.changeHelpButtonEnabled('undo',false);_this12.ui.changeHelpButtonEnabled('reset',false);}
_this12.ui.resizeEditor();},redoStackChanged:function redoStackChanged(length){if(length){_this12.ui.changeHelpButtonEnabled('redo',true);}else{_this12.ui.changeHelpButtonEnabled('redo',false);}
_this12.ui.resizeEditor();},objectActivated:function objectActivated(obj){var _context,_context2;_this12.activeObjectId=obj.id;_this12.ui.changeHelpButtonEnabled('delete',true);_this12.ui.changeHelpButtonEnabled('deleteAll',true);if(obj.type==='cropzone'){_this12.ui.crop.changeApplyButtonStatus(true);}else if(index_of_default()(_context=['rect','circle','triangle']).call(_context,obj.type)>-1){_this12.stopDrawingMode();if(_this12.ui.submenu!=='shape'){_this12.ui.changeMenu('shape',false,false);}
_this12.ui.shape.setShapeStatus({strokeColor:obj.stroke,strokeWidth:obj.strokeWidth,fillColor:fill_default()(obj)});_this12.ui.shape.setMaxStrokeValue(Math.min(obj.width,obj.height));}else if(obj.type==='path'||obj.type==='line'){if(_this12.ui.submenu!=='draw'){_this12.ui.changeMenu('draw',false,false);_this12.ui.draw.changeStandbyMode();}}else if(index_of_default()(_context2=['i-text','text']).call(_context2,obj.type)>-1){if(_this12.ui.submenu!=='text'){_this12.ui.changeMenu('text',false,false);}
_this12.ui.text.setTextStyleStateOnAction(obj);}else if(obj.type==='icon'){_this12.stopDrawingMode();if(_this12.ui.submenu!=='icon'){_this12.ui.changeMenu('icon',false,false);}
_this12.ui.icon.setIconPickerColor(fill_default()(obj));}},addText:function addText(pos){var _this12$ui$text=_this12.ui.text,fill=_this12$ui$text.textColor,fontSize=_this12$ui$text.fontSize,fontStyle=_this12$ui$text.fontStyle,fontWeight=_this12$ui$text.fontWeight,underline=_this12$ui$text.underline;var fontFamily='Noto Sans';_this12.addText('Double Click',{position:pos.originPosition,styles:{fill:fill,fontSize:fontSize,fontFamily:fontFamily,fontStyle:fontStyle,fontWeight:fontWeight,underline:underline}}).then(function(){_this12.changeCursor('default');});},addObjectAfter:function addObjectAfter(obj){var _context3;if(obj.type==='icon'){_this12.ui.icon.changeStandbyMode();}else if(index_of_default()(_context3=['rect','circle','triangle']).call(_context3,obj.type)>-1){_this12.ui.shape.setMaxStrokeValue(Math.min(obj.width,obj.height));_this12.ui.shape.changeStandbyMode();}},objectScaled:function objectScaled(obj){var _context4,_context5;if(index_of_default()(_context4=['i-text','text']).call(_context4,obj.type)>-1){_this12.ui.text.fontSize=toInteger(obj.fontSize);}else if(index_of_default()(_context5=['rect','circle','triangle']).call(_context5,obj.type)>=0){var width=obj.width,height=obj.height;var strokeValue=_this12.ui.shape.getStrokeValue();if(width<strokeValue){_this12.ui.shape.setStrokeValue(width);}
if(height<strokeValue){_this12.ui.shape.setStrokeValue(height);}}},selectionCleared:function selectionCleared(){_this12.activeObjectId=null;if(_this12.ui.submenu==='text'){_this12.changeCursor('text');}else if(!includes(['draw','crop','resize'],_this12.ui.submenu)){_this12.stopDrawingMode();}}});},_historyAction:function _historyAction(){var _this13=this;return{undo:function undo(count){return _this13.undo(count);},redo:function redo(count){return _this13.redo(count);}};},_commonAction:function _commonAction(){var _this14=this,_context6,_context7,_context8,_context9;var TEXT=drawingModes.TEXT,CROPPER=drawingModes.CROPPER,SHAPE=drawingModes.SHAPE,ZOOM=drawingModes.ZOOM,RESIZE=drawingModes.RESIZE;return{modeChange:function modeChange(menu){switch(menu){case drawingMenuNames.TEXT:_this14._changeActivateMode(TEXT);break;case drawingMenuNames.CROP:_this14.startDrawingMode(CROPPER);break;case drawingMenuNames.SHAPE:_this14._changeActivateMode(SHAPE);_this14.setDrawingShape(_this14.ui.shape.type,_this14.ui.shape.options);break;case drawingMenuNames.ZOOM:_this14.startDrawingMode(ZOOM);break;case drawingMenuNames.RESIZE:_this14.startDrawingMode(RESIZE);break;default:break;}},deactivateAll:bind_default()(_context6=this.deactivateAll).call(_context6,this),changeSelectableAll:bind_default()(_context7=this.changeSelectableAll).call(_context7,this),discardSelection:bind_default()(_context8=this.discardSelection).call(_context8,this),stopDrawingMode:bind_default()(_context9=this.stopDrawingMode).call(_context9,this)};},mixin:function mixin(ImageEditor){extend_default()(ImageEditor.prototype,this);}});var isArray=__webpack_require__(602);var isArray_default=__webpack_require__.n(isArray);var forEachOwnProperties=__webpack_require__(5573);var forEachOwnProperties_default=__webpack_require__.n(forEachOwnProperties);;var Component=function(){function Component(name,graphics){_classCallCheck(this,Component);this.name=name;this.graphics=graphics;}
_createClass(Component,[{key:"fire",value:function fire(){var context=this.graphics;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}
return this.graphics.fire.apply(context,args);}},{key:"setCanvasImage",value:function setCanvasImage(name,oImage){this.graphics.setCanvasImage(name,oImage);}},{key:"getCanvasElement",value:function getCanvasElement(){return this.graphics.getCanvasElement();}},{key:"getCanvas",value:function getCanvas(){return this.graphics.getCanvas();}},{key:"getCanvasImage",value:function getCanvasImage(){return this.graphics.getCanvasImage();}},{key:"getImageName",value:function getImageName(){return this.graphics.getImageName();}},{key:"getEditor",value:function getEditor(){return this.graphics.getEditor();}},{key:"getName",value:function getName(){return this.name;}},{key:"setImageProperties",value:function setImageProperties(setting,withRendering){this.graphics.setImageProperties(setting,withRendering);}},{key:"setCanvasCssDimension",value:function setCanvasCssDimension(dimension){this.graphics.setCanvasCssDimension(dimension);}},{key:"setCanvasBackstoreDimension",value:function setCanvasBackstoreDimension(dimension){this.graphics.setCanvasBackstoreDimension(dimension);}},{key:"adjustCanvasDimension",value:function adjustCanvasDimension(){this.graphics.adjustCanvasDimension();}},{key:"adjustCanvasDimensionBase",value:function adjustCanvasDimensionBase(){this.graphics.adjustCanvasDimensionBase();}}]);return Component;}();var component=(Component);;function imageLoader_createSuper(Derived){var hasNativeReflectConstruct=imageLoader_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function imageLoader_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var imageOption={padding:0,crossOrigin:'Anonymous'};var ImageLoader=function(_Component){_inherits(ImageLoader,_Component);var _super=imageLoader_createSuper(ImageLoader);function ImageLoader(graphics){_classCallCheck(this,ImageLoader);return _super.call(this,componentNames.IMAGE_LOADER,graphics);}
_createClass(ImageLoader,[{key:"load",value:function load(imageName,img){var _this=this;var promise;if(!imageName&&!img){var canvas=this.getCanvas();canvas.backgroundImage=null;canvas.renderAll();promise=new(promise_default())(function(resolve){_this.setCanvasImage('',null);resolve();});}else{promise=this._setBackgroundImage(img).then(function(oImage){_this.setCanvasImage(imageName,oImage);_this.adjustCanvasDimension();return oImage;});}
return promise;}},{key:"_setBackgroundImage",value:function _setBackgroundImage(img){var _this2=this;if(!img){return promise_default().reject(rejectMessages.loadImage);}
return new(promise_default())(function(resolve,reject){var canvas=_this2.getCanvas();canvas.setBackgroundImage(img,function(){var oImage=canvas.backgroundImage;if(oImage&&oImage.getElement()){resolve(oImage);}else{reject(rejectMessages.loadingImageFailed);}},imageOption);});}}]);return ImageLoader;}(component);var imageLoader=(ImageLoader);;var CORNER_TYPE_TOP_LEFT='tl';var CORNER_TYPE_TOP_RIGHT='tr';var CORNER_TYPE_MIDDLE_TOP='mt';var CORNER_TYPE_MIDDLE_LEFT='ml';var CORNER_TYPE_MIDDLE_RIGHT='mr';var CORNER_TYPE_MIDDLE_BOTTOM='mb';var CORNER_TYPE_BOTTOM_LEFT='bl';var CORNER_TYPE_BOTTOM_RIGHT='br';var CORNER_TYPE_LIST=[CORNER_TYPE_TOP_LEFT,CORNER_TYPE_TOP_RIGHT,CORNER_TYPE_MIDDLE_TOP,CORNER_TYPE_MIDDLE_LEFT,CORNER_TYPE_MIDDLE_RIGHT,CORNER_TYPE_MIDDLE_BOTTOM,CORNER_TYPE_BOTTOM_LEFT,CORNER_TYPE_BOTTOM_RIGHT];var NOOP_FUNCTION=function NOOP_FUNCTION(){};function cornerTypeValid(selectedCorner){return index_of_default()(CORNER_TYPE_LIST).call(CORNER_TYPE_LIST,selectedCorner)>=0;}
function getScaleBasis(diffX,diffY){return diffX>diffY?'width':'height';}
var Cropzone=fabric.fabric.util.createClass(fabric.fabric.Rect,{initialize:function initialize(canvas,options,extendsOptions){options=extend_default()(options,extendsOptions);options.type='cropzone';this.callSuper('initialize',options);this._addEventHandler();this.canvas=canvas;this.options=options;},canvasEventDelegation:function canvasEventDelegation(eventName){var _context;var delegationState='unregistered';var isRegistered=this.canvasEventTrigger[eventName]!==NOOP_FUNCTION;if(isRegistered){delegationState='registered';}else if(index_of_default()(_context=[eventNames.OBJECT_MOVED,eventNames.OBJECT_SCALED]).call(_context,eventName)<0){delegationState='none';}
return delegationState;},canvasEventRegister:function canvasEventRegister(eventName,eventTrigger){this.canvasEventTrigger[eventName]=eventTrigger;},_addEventHandler:function _addEventHandler(){var _this$canvasEventTrig,_context2,_context3,_context4,_context5;this.canvasEventTrigger=(_this$canvasEventTrig={},_defineProperty(_this$canvasEventTrig,eventNames.OBJECT_MOVED,NOOP_FUNCTION),_defineProperty(_this$canvasEventTrig,eventNames.OBJECT_SCALED,NOOP_FUNCTION),_this$canvasEventTrig);this.on({moving:bind_default()(_context2=this._onMoving).call(_context2,this),scaling:bind_default()(_context3=this._onScaling).call(_context3,this)});fabric.fabric.util.addListener(document,'keydown',bind_default()(_context4=this._onKeyDown).call(_context4,this));fabric.fabric.util.addListener(document,'keyup',bind_default()(_context5=this._onKeyUp).call(_context5,this));},_renderCropzone:function _renderCropzone(ctx){var cropzoneDashLineWidth=7;var cropzoneDashLineOffset=7;var originalFlipX=this.flipX?-1:1;var originalFlipY=this.flipY?-1:1;var originalScaleX=originalFlipX/this.scaleX;var originalScaleY=originalFlipY/this.scaleY;ctx.scale(originalScaleX,originalScaleY);this._fillOuterRect(ctx,'rgba(0, 0, 0, 0.5)');if(this.options.lineWidth){this._fillInnerRect(ctx);this._strokeBorder(ctx,'rgb(255, 255, 255)',{lineWidth:this.options.lineWidth});}else{this._strokeBorder(ctx,'rgb(0, 0, 0)',{lineDashWidth:cropzoneDashLineWidth});this._strokeBorder(ctx,'rgb(255, 255, 255)',{lineDashWidth:cropzoneDashLineWidth,lineDashOffset:cropzoneDashLineOffset});}
ctx.scale(1/originalScaleX,1/originalScaleY);},_render:function _render(ctx){this.callSuper('_render',ctx);this._renderCropzone(ctx);},_fillOuterRect:function _fillOuterRect(ctx,fillStyle){var _this$_getCoordinates=this._getCoordinates(),x=_this$_getCoordinates.x,y=_this$_getCoordinates.y;ctx.save();ctx.fillStyle=fillStyle;ctx.beginPath();ctx.moveTo(x[0]-1,y[0]-1);ctx.lineTo(x[3]+1,y[0]-1);ctx.lineTo(x[3]+1,y[3]+1);ctx.lineTo(x[0]-1,y[3]+1);ctx.lineTo(x[0]-1,y[0]-1);ctx.closePath();ctx.moveTo(x[1],y[1]);ctx.lineTo(x[1],y[2]);ctx.lineTo(x[2],y[2]);ctx.lineTo(x[2],y[1]);ctx.lineTo(x[1],y[1]);ctx.closePath();fill_default()(ctx).call(ctx);ctx.restore();},_fillInnerRect:function _fillInnerRect(ctx){var _this$_getCoordinates2=this._getCoordinates(),outerX=_this$_getCoordinates2.x,outerY=_this$_getCoordinates2.y;var x=this._caculateInnerPosition(outerX,(outerX[2]-outerX[1])/3);var y=this._caculateInnerPosition(outerY,(outerY[2]-outerY[1])/3);ctx.save();ctx.strokeStyle='rgba(255, 255, 255, 0.7)';ctx.lineWidth=this.options.lineWidth;ctx.beginPath();ctx.moveTo(x[0],y[1]);ctx.lineTo(x[3],y[1]);ctx.moveTo(x[0],y[2]);ctx.lineTo(x[3],y[2]);ctx.moveTo(x[1],y[0]);ctx.lineTo(x[1],y[3]);ctx.moveTo(x[2],y[0]);ctx.lineTo(x[2],y[3]);ctx.stroke();ctx.closePath();ctx.restore();},_caculateInnerPosition:function _caculateInnerPosition(outer,size){var position=[];position[0]=outer[1];position[1]=outer[1]+size;position[2]=outer[1]+size*2;position[3]=outer[2];return position;},_getCoordinates:function _getCoordinates(){var _context6,_context7;var canvas=this.canvas,width=this.width,height=this.height,left=this.left,top=this.top;var halfWidth=width/2;var halfHeight=height/2;var canvasHeight=canvas.getHeight();var canvasWidth=canvas.getWidth();return{x:map_default()(_context6=[-(halfWidth+left),-halfWidth,halfWidth,halfWidth+(canvasWidth-left-width)]).call(_context6,Math.ceil),y:map_default()(_context7=[-(halfHeight+top),-halfHeight,halfHeight,halfHeight+(canvasHeight-top-height)]).call(_context7,Math.ceil)};},_strokeBorder:function _strokeBorder(ctx,strokeStyle,_ref){var lineDashWidth=_ref.lineDashWidth,lineDashOffset=_ref.lineDashOffset,lineWidth=_ref.lineWidth;var halfWidth=this.width/2;var halfHeight=this.height/2;ctx.save();ctx.strokeStyle=strokeStyle;if(ctx.setLineDash){ctx.setLineDash([lineDashWidth,lineDashWidth]);}
if(lineDashOffset){ctx.lineDashOffset=lineDashOffset;}
if(lineWidth){ctx.lineWidth=lineWidth;}
ctx.beginPath();ctx.moveTo(-halfWidth,-halfHeight);ctx.lineTo(halfWidth,-halfHeight);ctx.lineTo(halfWidth,halfHeight);ctx.lineTo(-halfWidth,halfHeight);ctx.lineTo(-halfWidth,-halfHeight);ctx.stroke();ctx.restore();},_onMoving:function _onMoving(){var height=this.height,width=this.width,left=this.left,top=this.top;var maxLeft=this.canvas.getWidth()-width;var maxTop=this.canvas.getHeight()-height;this.left=clamp(left,0,maxLeft);this.top=clamp(top,0,maxTop);this.canvasEventTrigger[eventNames.OBJECT_MOVED](this);},_onScaling:function _onScaling(fEvent){var selectedCorner=fEvent.transform.corner;var pointer=this.canvas.getPointer(fEvent.e);var settings=this._calcScalingSizeFromPointer(pointer,selectedCorner);this.scale(1).set(settings);this.canvasEventTrigger[eventNames.OBJECT_SCALED](this);},_calcScalingSizeFromPointer:function _calcScalingSizeFromPointer(pointer,selectedCorner){var isCornerTypeValid=cornerTypeValid(selectedCorner);return isCornerTypeValid&&this._resizeCropZone(pointer,selectedCorner);},adjustRatioCropzoneSize:function adjustRatioCropzoneSize(_ref2){var width=_ref2.width,height=_ref2.height,leftMaker=_ref2.leftMaker,topMaker=_ref2.topMaker,maxWidth=_ref2.maxWidth,maxHeight=_ref2.maxHeight,scaleTo=_ref2.scaleTo;width=maxWidth?clamp(width,1,maxWidth):width;height=maxHeight?clamp(height,1,maxHeight):height;if(!this.presetRatio){if(this._withShiftKey){if(width>height){height=width;}else if(height>width){width=height;}}
return{width:width,height:height,left:leftMaker(width),top:topMaker(height)};}
if(scaleTo==='width'){height=width/this.presetRatio;}else{width=height*this.presetRatio;}
var maxScaleFactor=Math.min(maxWidth/width,maxHeight/height);if(maxScaleFactor<=1){var _context8;var _map=map_default()(_context8=[width,height]).call(_context8,function(v){return v*maxScaleFactor;});var _map2=_slicedToArray(_map,2);width=_map2[0];height=_map2[1];}
return{width:width,height:height,left:leftMaker(width),top:topMaker(height)};},_getCropzoneRectInfo:function _getCropzoneRectInfo(){var _this$canvas=this.canvas,canvasWidth=_this$canvas.width,canvasHeight=_this$canvas.height;var _this$getBoundingRect=this.getBoundingRect(false,true),rectTop=_this$getBoundingRect.top,rectLeft=_this$getBoundingRect.left,rectWidth=_this$getBoundingRect.width,rectHeight=_this$getBoundingRect.height;return{rectTop:rectTop,rectLeft:rectLeft,rectWidth:rectWidth,rectHeight:rectHeight,rectRight:rectLeft+rectWidth,rectBottom:rectTop+rectHeight,canvasWidth:canvasWidth,canvasHeight:canvasHeight};},_resizeCropZone:function _resizeCropZone(_ref3,corner){var x=_ref3.x,y=_ref3.y;var _this$_getCropzoneRec=this._getCropzoneRectInfo(),rectWidth=_this$_getCropzoneRec.rectWidth,rectHeight=_this$_getCropzoneRec.rectHeight,rectTop=_this$_getCropzoneRec.rectTop,rectLeft=_this$_getCropzoneRec.rectLeft,rectBottom=_this$_getCropzoneRec.rectBottom,rectRight=_this$_getCropzoneRec.rectRight,canvasWidth=_this$_getCropzoneRec.canvasWidth,canvasHeight=_this$_getCropzoneRec.canvasHeight;var resizeInfoMap={tl:{width:rectRight-x,height:rectBottom-y,leftMaker:function leftMaker(newWidth){return rectRight-newWidth;},topMaker:function topMaker(newHeight){return rectBottom-newHeight;},maxWidth:rectRight,maxHeight:rectBottom,scaleTo:getScaleBasis(rectLeft-x,rectTop-y)},tr:{width:x-rectLeft,height:rectBottom-y,leftMaker:function leftMaker(){return rectLeft;},topMaker:function topMaker(newHeight){return rectBottom-newHeight;},maxWidth:canvasWidth-rectLeft,maxHeight:rectBottom,scaleTo:getScaleBasis(x-rectRight,rectTop-y)},mt:{width:rectWidth,height:rectBottom-y,leftMaker:function leftMaker(){return rectLeft;},topMaker:function topMaker(newHeight){return rectBottom-newHeight;},maxWidth:canvasWidth-rectLeft,maxHeight:rectBottom,scaleTo:'height'},ml:{width:rectRight-x,height:rectHeight,leftMaker:function leftMaker(newWidth){return rectRight-newWidth;},topMaker:function topMaker(){return rectTop;},maxWidth:rectRight,maxHeight:canvasHeight-rectTop,scaleTo:'width'},mr:{width:x-rectLeft,height:rectHeight,leftMaker:function leftMaker(){return rectLeft;},topMaker:function topMaker(){return rectTop;},maxWidth:canvasWidth-rectLeft,maxHeight:canvasHeight-rectTop,scaleTo:'width'},mb:{width:rectWidth,height:y-rectTop,leftMaker:function leftMaker(){return rectLeft;},topMaker:function topMaker(){return rectTop;},maxWidth:canvasWidth-rectLeft,maxHeight:canvasHeight-rectTop,scaleTo:'height'},bl:{width:rectRight-x,height:y-rectTop,leftMaker:function leftMaker(newWidth){return rectRight-newWidth;},topMaker:function topMaker(){return rectTop;},maxWidth:rectRight,maxHeight:canvasHeight-rectTop,scaleTo:getScaleBasis(rectLeft-x,y-rectBottom)},br:{width:x-rectLeft,height:y-rectTop,leftMaker:function leftMaker(){return rectLeft;},topMaker:function topMaker(){return rectTop;},maxWidth:canvasWidth-rectLeft,maxHeight:canvasHeight-rectTop,scaleTo:getScaleBasis(x-rectRight,y-rectBottom)}};return this.adjustRatioCropzoneSize(resizeInfoMap[corner]);},isValid:function isValid(){return this.left>=0&&this.top>=0&&this.width>0&&this.height>0;},_onKeyDown:function _onKeyDown(_ref4){var keyCode=_ref4.keyCode;if(keyCode===keyCodes.SHIFT){this._withShiftKey=true;}},_onKeyUp:function _onKeyUp(_ref5){var keyCode=_ref5.keyCode;if(keyCode===keyCodes.SHIFT){this._withShiftKey=false;}}});var cropzone=(Cropzone);;function cropper_createSuper(Derived){var hasNativeReflectConstruct=cropper_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function cropper_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var MOUSE_MOVE_THRESHOLD=10;var DEFAULT_OPTION={presetRatio:null,top:-10,left:-10,height:1,width:1};var Cropper=function(_Component){_inherits(Cropper,_Component);var _super=cropper_createSuper(Cropper);function Cropper(graphics){var _context,_context2,_context3,_context4,_context5;var _this;_classCallCheck(this,Cropper);_this=_super.call(this,componentNames.CROPPER,graphics);_this._cropzone=null;_this._startX=null;_this._startY=null;_this._withShiftKey=false;_this._listeners={keydown:bind_default()(_context=_this._onKeyDown).call(_context,_assertThisInitialized(_this)),keyup:bind_default()(_context2=_this._onKeyUp).call(_context2,_assertThisInitialized(_this)),mousedown:bind_default()(_context3=_this._onFabricMouseDown).call(_context3,_assertThisInitialized(_this)),mousemove:bind_default()(_context4=_this._onFabricMouseMove).call(_context4,_assertThisInitialized(_this)),mouseup:bind_default()(_context5=_this._onFabricMouseUp).call(_context5,_assertThisInitialized(_this))};return _this;}
_createClass(Cropper,[{key:"start",value:function start(){if(this._cropzone){return;}
var canvas=this.getCanvas();canvas.forEachObject(function(obj){obj.evented=false;});this._cropzone=new cropzone(canvas,extend_default()({left:0,top:0,width:0.5,height:0.5,strokeWidth:0,cornerSize:10,cornerColor:'black',fill:'transparent'},CROPZONE_DEFAULT_OPTIONS,this.graphics.cropSelectionStyle));canvas.discardActiveObject();canvas.add(this._cropzone);canvas.on('mouse:down',this._listeners.mousedown);canvas.selection=false;canvas.defaultCursor='crosshair';fabric.fabric.util.addListener(document,'keydown',this._listeners.keydown);fabric.fabric.util.addListener(document,'keyup',this._listeners.keyup);}},{key:"end",value:function end(){var canvas=this.getCanvas();var cropzone=this._cropzone;if(!cropzone){return;}
canvas.remove(cropzone);canvas.selection=true;canvas.defaultCursor='default';canvas.off('mouse:down',this._listeners.mousedown);canvas.forEachObject(function(obj){obj.evented=true;});this._cropzone=null;fabric.fabric.util.removeListener(document,'keydown',this._listeners.keydown);fabric.fabric.util.removeListener(document,'keyup',this._listeners.keyup);}},{key:"changeVisibility",value:function changeVisibility(visible){if(this._cropzone){this._cropzone.set({visible:visible});}}},{key:"_onFabricMouseDown",value:function _onFabricMouseDown(fEvent){var canvas=this.getCanvas();if(fEvent.target){return;}
canvas.selection=false;var coord=canvas.getPointer(fEvent.e);this._startX=coord.x;this._startY=coord.y;canvas.on({'mouse:move':this._listeners.mousemove,'mouse:up':this._listeners.mouseup});}},{key:"_onFabricMouseMove",value:function _onFabricMouseMove(fEvent){var canvas=this.getCanvas();var pointer=canvas.getPointer(fEvent.e);var x=pointer.x,y=pointer.y;var cropzone=this._cropzone;if(Math.abs(x-this._startX)+Math.abs(y-this._startY)>MOUSE_MOVE_THRESHOLD){canvas.remove(cropzone);cropzone.set(this._calcRectDimensionFromPoint(x,y,cropzone.presetRatio));canvas.add(cropzone);canvas.setActiveObject(cropzone);}}},{key:"_calcRectDimensionFromPoint",value:function _calcRectDimensionFromPoint(x,y){var presetRatio=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var canvas=this.getCanvas();var canvasWidth=canvas.getWidth();var canvasHeight=canvas.getHeight();var startX=this._startX;var startY=this._startY;var left=clamp(x,0,startX);var top=clamp(y,0,startY);var width=clamp(x,startX,canvasWidth)-left;var height=clamp(y,startY,canvasHeight)-top;if(this._withShiftKey&&!presetRatio){if(width>height){height=width;}else if(height>width){width=height;}
if(startX>=x){left=startX-width;}
if(startY>=y){top=startY-height;}}else if(presetRatio){height=width/presetRatio;if(startX>=x){left=clamp(startX-width,0,canvasWidth);}
if(startY>=y){top=clamp(startY-height,0,canvasHeight);}
if(top+height>canvasHeight){height=canvasHeight-top;width=height*presetRatio;if(startX>=x){left=clamp(startX-width,0,canvasWidth);}
if(startY>=y){top=clamp(startY-height,0,canvasHeight);}}}
return{left:left,top:top,width:width,height:height};}},{key:"_onFabricMouseUp",value:function _onFabricMouseUp(){var cropzone=this._cropzone;var listeners=this._listeners;var canvas=this.getCanvas();canvas.setActiveObject(cropzone);canvas.off({'mouse:move':listeners.mousemove,'mouse:up':listeners.mouseup});}},{key:"getCroppedImageData",value:function getCroppedImageData(cropRect){var canvas=this.getCanvas();var containsCropzone=canvas.contains(this._cropzone);if(!cropRect){return null;}
if(containsCropzone){canvas.remove(this._cropzone);}
var imageData={imageName:this.getImageName(),url:canvas.toDataURL(cropRect)};if(containsCropzone){canvas.add(this._cropzone);}
return imageData;}},{key:"getCropzoneRect",value:function getCropzoneRect(){var cropzone=this._cropzone;if(!cropzone.isValid()){return null;}
return{left:cropzone.left,top:cropzone.top,width:cropzone.width,height:cropzone.height};}},{key:"setCropzoneRect",value:function setCropzoneRect(presetRatio){var canvas=this.getCanvas();var cropzone=this._cropzone;canvas.discardActiveObject();canvas.selection=false;canvas.remove(cropzone);cropzone.set(presetRatio?this._getPresetPropertiesForCropSize(presetRatio):DEFAULT_OPTION);canvas.add(cropzone);canvas.selection=true;if(presetRatio){canvas.setActiveObject(cropzone);}}},{key:"_getPresetPropertiesForCropSize",value:function _getPresetPropertiesForCropSize(presetRatio){var _context6,_context7;var canvas=this.getCanvas();var originalWidth=canvas.getWidth();var originalHeight=canvas.getHeight();var standardSize=originalWidth>=originalHeight?originalWidth:originalHeight;var getScale=function getScale(value,orignalValue){return value>orignalValue?orignalValue/value:1;};var width=standardSize*presetRatio;var height=standardSize;var scaleWidth=getScale(width,originalWidth);var _map=map_default()(_context6=[width,height]).call(_context6,function(sizeValue){return sizeValue*scaleWidth;});var _map2=_slicedToArray(_map,2);width=_map2[0];height=_map2[1];var scaleHeight=getScale(height,originalHeight);var _map3=map_default()(_context7=[width,height]).call(_context7,function(sizeValue){return fixFloatingPoint(sizeValue*scaleHeight);});var _map4=_slicedToArray(_map3,2);width=_map4[0];height=_map4[1];return{presetRatio:presetRatio,top:(originalHeight-height)/2,left:(originalWidth-width)/2,width:width,height:height};}},{key:"_onKeyDown",value:function _onKeyDown(e){if(e.keyCode===keyCodes.SHIFT){this._withShiftKey=true;}}},{key:"_onKeyUp",value:function _onKeyUp(e){if(e.keyCode===keyCodes.SHIFT){this._withShiftKey=false;}}}]);return Cropper;}(component);var cropper=(Cropper);;function component_flip_createSuper(Derived){var hasNativeReflectConstruct=component_flip_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function component_flip_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var flip_Flip=function(_Component){_inherits(Flip,_Component);var _super=component_flip_createSuper(Flip);function Flip(graphics){_classCallCheck(this,Flip);return _super.call(this,componentNames.FLIP,graphics);}
_createClass(Flip,[{key:"getCurrentSetting",value:function getCurrentSetting(){var canvasImage=this.getCanvasImage();return{flipX:canvasImage.flipX,flipY:canvasImage.flipY};}},{key:"set",value:function set(newSetting){var setting=this.getCurrentSetting();var isChangingFlipX=setting.flipX!==newSetting.flipX;var isChangingFlipY=setting.flipY!==newSetting.flipY;if(!isChangingFlipX&&!isChangingFlipY){return promise_default().reject(rejectMessages.flip);}
extend_default()(setting,newSetting);this.setImageProperties(setting,true);this._invertAngle(isChangingFlipX,isChangingFlipY);this._flipObjects(isChangingFlipX,isChangingFlipY);return promise_default().resolve({flipX:setting.flipX,flipY:setting.flipY,angle:this.getCanvasImage().angle});}},{key:"_invertAngle",value:function _invertAngle(isChangingFlipX,isChangingFlipY){var canvasImage=this.getCanvasImage();var angle=canvasImage.angle;if(isChangingFlipX){angle*=-1;}
if(isChangingFlipY){angle*=-1;}
canvasImage.rotate(parse_float_default()(angle)).setCoords();}},{key:"_flipObjects",value:function _flipObjects(isChangingFlipX,isChangingFlipY){var canvas=this.getCanvas();if(isChangingFlipX){canvas.forEachObject(function(obj){obj.set({angle:parse_float_default()(obj.angle*-1),flipX:!obj.flipX,left:canvas.width-obj.left}).setCoords();});}
if(isChangingFlipY){canvas.forEachObject(function(obj){obj.set({angle:parse_float_default()(obj.angle*-1),flipY:!obj.flipY,top:canvas.height-obj.top}).setCoords();});}
canvas.renderAll();}},{key:"reset",value:function reset(){return this.set({flipX:false,flipY:false});}},{key:"flipX",value:function flipX(){var current=this.getCurrentSetting();return this.set({flipX:!current.flipX,flipY:current.flipY});}},{key:"flipY",value:function flipY(){var current=this.getCurrentSetting();return this.set({flipX:current.flipX,flipY:!current.flipY});}}]);return Flip;}(component);var component_flip=(flip_Flip);;function rotation_createSuper(Derived){var hasNativeReflectConstruct=rotation_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function rotation_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var Rotation=function(_Component){_inherits(Rotation,_Component);var _super=rotation_createSuper(Rotation);function Rotation(graphics){_classCallCheck(this,Rotation);return _super.call(this,componentNames.ROTATION,graphics);}
_createClass(Rotation,[{key:"getCurrentAngle",value:function getCurrentAngle(){return this.getCanvasImage().angle;}},{key:"setAngle",value:function setAngle(angle){var oldAngle=this.getCurrentAngle()%360;angle%=360;var canvasImage=this.getCanvasImage();var oldImageCenter=canvasImage.getCenterPoint();canvasImage.set({angle:angle}).setCoords();this.adjustCanvasDimension();var newImageCenter=canvasImage.getCenterPoint();this._rotateForEachObject(oldImageCenter,newImageCenter,angle-oldAngle);return promise_default().resolve(angle);}},{key:"_rotateForEachObject",value:function _rotateForEachObject(oldImageCenter,newImageCenter,angleDiff){var canvas=this.getCanvas();var centerDiff={x:oldImageCenter.x-newImageCenter.x,y:oldImageCenter.y-newImageCenter.y};canvas.forEachObject(function(obj){var objCenter=obj.getCenterPoint();var radian=fabric.fabric.util.degreesToRadians(angleDiff);var newObjCenter=fabric.fabric.util.rotatePoint(objCenter,oldImageCenter,radian);obj.set({left:newObjCenter.x-centerDiff.x,top:newObjCenter.y-centerDiff.y,angle:(obj.angle+angleDiff)%360});obj.setCoords();});canvas.renderAll();}},{key:"rotate",value:function rotate(additionalAngle){var current=this.getCurrentAngle();return this.setAngle(current+additionalAngle);}}]);return Rotation;}(component);var rotation=(Rotation);;function freeDrawing_createSuper(Derived){var hasNativeReflectConstruct=freeDrawing_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function freeDrawing_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var FreeDrawing=function(_Component){_inherits(FreeDrawing,_Component);var _super=freeDrawing_createSuper(FreeDrawing);function FreeDrawing(graphics){var _this;_classCallCheck(this,FreeDrawing);_this=_super.call(this,componentNames.FREE_DRAWING,graphics);_this.width=12;_this.oColor=new fabric.fabric.Color('rgba(0, 0, 0, 0.5)');return _this;}
_createClass(FreeDrawing,[{key:"start",value:function start(setting){var canvas=this.getCanvas();canvas.isDrawingMode=true;this.setBrush(setting);}},{key:"setBrush",value:function setBrush(setting){var brush=this.getCanvas().freeDrawingBrush;setting=setting||{};this.width=setting.width||this.width;if(setting.color){this.oColor=new fabric.fabric.Color(setting.color);}
brush.width=this.width;brush.color=this.oColor.toRgba();}},{key:"end",value:function end(){var canvas=this.getCanvas();canvas.isDrawingMode=false;}}]);return FreeDrawing;}(component);var freeDrawing=(FreeDrawing);;var ARROW_ANGLE=30;var CHEVRON_SIZE_RATIO=2.7;var TRIANGLE_SIZE_RATIO=1.7;var RADIAN_CONVERSION_VALUE=180;var ArrowLine=fabric.fabric.util.createClass(fabric.fabric.Line,{type:'line',initialize:function initialize(points){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.callSuper('initialize',points,options);this.arrowType=options.arrowType;},_render:function _render(ctx){var _this$calcLinePoints=this.calcLinePoints(),fromX=_this$calcLinePoints.x1,fromY=_this$calcLinePoints.y1,toX=_this$calcLinePoints.x2,toY=_this$calcLinePoints.y2;var linePosition={fromX:fromX,fromY:fromY,toX:toX,toY:toY};this.ctx=ctx;ctx.lineWidth=this.strokeWidth;this._renderBasicLinePath(linePosition);this._drawDecoratorPath(linePosition);this._renderStroke(ctx);},_renderBasicLinePath:function _renderBasicLinePath(_ref){var fromX=_ref.fromX,fromY=_ref.fromY,toX=_ref.toX,toY=_ref.toY;this.ctx.beginPath();this.ctx.moveTo(fromX,fromY);this.ctx.lineTo(toX,toY);},_drawDecoratorPath:function _drawDecoratorPath(linePosition){this._drawDecoratorPathType('head',linePosition);this._drawDecoratorPathType('tail',linePosition);},_drawDecoratorPathType:function _drawDecoratorPathType(type,linePosition){switch(this.arrowType[type]){case'triangle':this._drawTrianglePath(type,linePosition);break;case'chevron':this._drawChevronPath(type,linePosition);break;default:break;}},_drawTrianglePath:function _drawTrianglePath(type,linePosition){var decorateSize=this.ctx.lineWidth*TRIANGLE_SIZE_RATIO;this._drawChevronPath(type,linePosition,decorateSize);this.ctx.closePath();},_drawChevronPath:function _drawChevronPath(type,_ref2,decorateSize){var _this=this;var fromX=_ref2.fromX,fromY=_ref2.fromY,toX=_ref2.toX,toY=_ref2.toY;var ctx=this.ctx;if(!decorateSize){decorateSize=this.ctx.lineWidth*CHEVRON_SIZE_RATIO;}
var _ref3=type==='head'?[fromX,fromY]:[toX,toY],_ref4=_slicedToArray(_ref3,2),standardX=_ref4[0],standardY=_ref4[1];var _ref5=type==='head'?[toX,toY]:[fromX,fromY],_ref6=_slicedToArray(_ref5,2),compareX=_ref6[0],compareY=_ref6[1];var angle=Math.atan2(compareY-standardY,compareX-standardX)*RADIAN_CONVERSION_VALUE/Math.PI;var rotatedPosition=function rotatedPosition(changeAngle){return _this.getRotatePosition(decorateSize,changeAngle,{x:standardX,y:standardY});};ctx.moveTo.apply(ctx,_toConsumableArray(rotatedPosition(angle+ARROW_ANGLE)));ctx.lineTo(standardX,standardY);ctx.lineTo.apply(ctx,_toConsumableArray(rotatedPosition(angle-ARROW_ANGLE)));},getRotatePosition:function getRotatePosition(distance,angle,referencePosition){var radian=angle*Math.PI/RADIAN_CONVERSION_VALUE;var x=referencePosition.x,y=referencePosition.y;return[distance*Math.cos(radian)+x,distance*Math.sin(radian)+y];}});var arrowLine=(ArrowLine);;function line_createSuper(Derived){var hasNativeReflectConstruct=line_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function line_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var Line=function(_Component){_inherits(Line,_Component);var _super=line_createSuper(Line);function Line(graphics){var _context,_context2,_context3;var _this;_classCallCheck(this,Line);_this=_super.call(this,componentNames.LINE,graphics);_this._width=12;_this._oColor=new fabric.fabric.Color('rgba(0, 0, 0, 0.5)');_this._listeners={mousedown:bind_default()(_context=_this._onFabricMouseDown).call(_context,_assertThisInitialized(_this)),mousemove:bind_default()(_context2=_this._onFabricMouseMove).call(_context2,_assertThisInitialized(_this)),mouseup:bind_default()(_context3=_this._onFabricMouseUp).call(_context3,_assertThisInitialized(_this))};return _this;}
_createClass(Line,[{key:"setHeadOption",value:function setHeadOption(setting){var _setting$arrowType=setting.arrowType,arrowType=_setting$arrowType===void 0?{head:null,tail:null}:_setting$arrowType;this._arrowType=arrowType;}},{key:"start",value:function start(){var setting=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var canvas=this.getCanvas();canvas.defaultCursor='crosshair';canvas.selection=false;this.setHeadOption(setting);this.setBrush(setting);canvas.forEachObject(function(obj){obj.set({evented:false});});canvas.on({'mouse:down':this._listeners.mousedown});}},{key:"setBrush",value:function setBrush(setting){var brush=this.getCanvas().freeDrawingBrush;setting=setting||{};this._width=setting.width||this._width;if(setting.color){this._oColor=new fabric.fabric.Color(setting.color);}
brush.width=this._width;brush.color=this._oColor.toRgba();}},{key:"end",value:function end(){var canvas=this.getCanvas();canvas.defaultCursor='default';canvas.selection=true;canvas.forEachObject(function(obj){obj.set({evented:true});});canvas.off('mouse:down',this._listeners.mousedown);}},{key:"_onFabricMouseDown",value:function _onFabricMouseDown(fEvent){var canvas=this.getCanvas();var _canvas$getPointer=canvas.getPointer(fEvent.e),x=_canvas$getPointer.x,y=_canvas$getPointer.y;var points=[x,y,x,y];this._line=new arrowLine(points,{stroke:this._oColor.toRgba(),strokeWidth:this._width,arrowType:this._arrowType,evented:false});this._line.set(fObjectOptions.SELECTION_STYLE);canvas.add(this._line);canvas.on({'mouse:move':this._listeners.mousemove,'mouse:up':this._listeners.mouseup});this.fire(eventNames.ADD_OBJECT,this._createLineEventObjectProperties());}},{key:"_onFabricMouseMove",value:function _onFabricMouseMove(fEvent){var canvas=this.getCanvas();var pointer=canvas.getPointer(fEvent.e);this._line.set({x2:pointer.x,y2:pointer.y});this._line.setCoords();canvas.renderAll();}},{key:"_onFabricMouseUp",value:function _onFabricMouseUp(){var canvas=this.getCanvas();this.fire(eventNames.OBJECT_ADDED,this._createLineEventObjectProperties());this._line=null;canvas.off({'mouse:move':this._listeners.mousemove,'mouse:up':this._listeners.mouseup});}},{key:"_createLineEventObjectProperties",value:function _createLineEventObjectProperties(){var params=this.graphics.createObjectProperties(this._line);var _this$_line=this._line,x1=_this$_line.x1,x2=_this$_line.x2,y1=_this$_line.y1,y2=_this$_line.y2;return extend_default()({},params,{startPosition:{x:x1,y:y1},endPosition:{x:x2,y:y2}});}}]);return Line;}(component);var line=(Line);;function component_text_createSuper(Derived){var hasNativeReflectConstruct=component_text_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function component_text_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var defaultStyles={fill:'#000000',left:0,top:0};var resetStyles={fill:'#000000',fontStyle:'normal',fontWeight:'normal',textAlign:'tie-text-align-left',underline:false};var DBCLICK_TIME=500;var text_Text=function(_Component){_inherits(Text,_Component);var _super=component_text_createSuper(Text);function Text(graphics){var _context,_context2,_context3,_context4,_context5;var _this;_classCallCheck(this,Text);_this=_super.call(this,componentNames.TEXT,graphics);_this._defaultStyles=defaultStyles;_this._isSelected=false;_this._selectedObj={};_this._editingObj={};_this._listeners={mousedown:bind_default()(_context=_this._onFabricMouseDown).call(_context,_assertThisInitialized(_this)),select:bind_default()(_context2=_this._onFabricSelect).call(_context2,_assertThisInitialized(_this)),selectClear:bind_default()(_context3=_this._onFabricSelectClear).call(_context3,_assertThisInitialized(_this)),scaling:bind_default()(_context4=_this._onFabricScaling).call(_context4,_assertThisInitialized(_this)),textChanged:bind_default()(_context5=_this._onFabricTextChanged).call(_context5,_assertThisInitialized(_this))};_this._textarea=null;_this._ratio=1;_this._lastClickTime=new Date().getTime();_this._editingObjInfos={};_this.isPrevEditing=false;return _this;}
_createClass(Text,[{key:"start",value:function start(){var _this2=this;var canvas=this.getCanvas();canvas.selection=false;canvas.defaultCursor='text';canvas.on({'mouse:down':this._listeners.mousedown,'selection:created':this._listeners.select,'selection:updated':this._listeners.select,'before:selection:cleared':this._listeners.selectClear,'object:scaling':this._listeners.scaling,'text:changed':this._listeners.textChanged});canvas.forEachObject(function(obj){if(obj.type==='i-text'){_this2.adjustOriginPosition(obj,'start');}});this.setCanvasRatio();}},{key:"end",value:function end(){var _this3=this;var canvas=this.getCanvas();canvas.selection=true;canvas.defaultCursor='default';canvas.forEachObject(function(obj){if(obj.type==='i-text'){if(obj.text===''){canvas.remove(obj);}else{_this3.adjustOriginPosition(obj,'end');}}});canvas.off({'mouse:down':this._listeners.mousedown,'selection:created':this._listeners.select,'selection:updated':this._listeners.select,'before:selection:cleared':this._listeners.selectClear,'object:selected':this._listeners.select,'object:scaling':this._listeners.scaling,'text:changed':this._listeners.textChanged});}},{key:"adjustOriginPosition",value:function adjustOriginPosition(text,editStatus){var originX='center',originY='center';if(editStatus==='start'){originX='left';originY='top';}
var _text$getPointByOrigi=text.getPointByOrigin(originX,originY),left=_text$getPointByOrigi.x,top=_text$getPointByOrigi.y;text.set({left:left,top:top,originX:originX,originY:originY});text.setCoords();}},{key:"add",value:function add(text,options){var _this4=this;return new(promise_default())(function(resolve){var _context6;var canvas=_this4.getCanvas();var newText=null;var selectionStyle=fObjectOptions.SELECTION_STYLE;var styles=_this4._defaultStyles;_this4._setInitPos(options.position);if(options.styles){styles=extend_default()(styles,options.styles);}
if(!isExisty_default()(options.autofocus)){options.autofocus=true;}
newText=new fabric.fabric.IText(text,styles);selectionStyle=extend_default()({},selectionStyle,{originX:'left',originY:'top'});newText.set(selectionStyle);newText.on({mouseup:bind_default()(_context6=_this4._onFabricMouseUp).call(_context6,_this4)});canvas.add(newText);if(options.autofocus){newText.enterEditing();newText.selectAll();}
if(!canvas.getActiveObject()){canvas.setActiveObject(newText);}
_this4.isPrevEditing=true;resolve(_this4.graphics.createObjectProperties(newText));});}},{key:"change",value:function change(activeObj,text){var _this5=this;return new(promise_default())(function(resolve){activeObj.set('text',text);_this5.getCanvas().renderAll();resolve();});}},{key:"setStyle",value:function setStyle(activeObj,styleObj){var _this6=this;return new(promise_default())(function(resolve){forEach_default()(styleObj,function(val,key){if(activeObj[key]===val&&key!=='fontSize'){styleObj[key]=resetStyles[key]||'';}},_this6);if('textDecoration'in styleObj){extend_default()(styleObj,_this6._getTextDecorationAdaptObject(styleObj.textDecoration));}
activeObj.set(styleObj);_this6.getCanvas().renderAll();resolve();});}},{key:"getText",value:function getText(activeObj){return activeObj.text;}},{key:"setSelectedInfo",value:function setSelectedInfo(obj,state){this._selectedObj=obj;this._isSelected=state;}},{key:"isSelected",value:function isSelected(){return this._isSelected;}},{key:"getSelectedObj",value:function getSelectedObj(){return this._selectedObj;}},{key:"setCanvasRatio",value:function setCanvasRatio(){var canvasElement=this.getCanvasElement();var cssWidth=parse_int_default()(canvasElement.style.maxWidth,10);var originWidth=canvasElement.width;this._ratio=originWidth/cssWidth;}},{key:"getCanvasRatio",value:function getCanvasRatio(){return this._ratio;}},{key:"_getTextDecorationAdaptObject",value:function _getTextDecorationAdaptObject(textDecoration){return{underline:textDecoration==='underline',linethrough:textDecoration==='line-through',overline:textDecoration==='overline'};}},{key:"_setInitPos",value:function _setInitPos(position){position=position||this.getCanvasImage().getCenterPoint();this._defaultStyles.left=position.x;this._defaultStyles.top=position.y;}},{key:"_onInput",value:function _onInput(){var ratio=this.getCanvasRatio();var obj=this._editingObj;var textareaStyle=this._textarea.style;textareaStyle.width="".concat(Math.ceil(obj.width/ratio),"px");textareaStyle.height="".concat(Math.ceil(obj.height/ratio),"px");}},{key:"_onKeyDown",value:function _onKeyDown(){var _this7=this;var ratio=this.getCanvasRatio();var obj=this._editingObj;var textareaStyle=this._textarea.style;set_timeout_default()(function(){obj.text(_this7._textarea.value);textareaStyle.width="".concat(Math.ceil(obj.width/ratio),"px");textareaStyle.height="".concat(Math.ceil(obj.height/ratio),"px");},0);}},{key:"_onBlur",value:function _onBlur(){var ratio=this.getCanvasRatio();var editingObj=this._editingObj;var editingObjInfos=this._editingObjInfos;var textContent=this._textarea.value;var transWidth=editingObj.width/ratio-editingObjInfos.width/ratio;var transHeight=editingObj.height/ratio-editingObjInfos.height/ratio;if(ratio===1){transWidth/=2;transHeight/=2;}
this._textarea.style.display='none';editingObj.set({left:editingObjInfos.left+transWidth,top:editingObjInfos.top+transHeight});if(textContent.length){this.getCanvas().add(editingObj);var params={id:stamp(editingObj),type:editingObj.type,text:textContent};this.fire(eventNames.TEXT_CHANGED,params);}}},{key:"_onScroll",value:function _onScroll(){this._textarea.scrollLeft=0;this._textarea.scrollTop=0;}},{key:"_onFabricScaling",value:function _onFabricScaling(fEvent){var obj=fEvent.target;obj.fontSize=obj.fontSize*obj.scaleY;obj.scaleX=1;obj.scaleY=1;}},{key:"_onFabricTextChanged",value:function _onFabricTextChanged(props){this.fire(eventNames.TEXT_CHANGED,props.target);}},{key:"_onFabricSelectClear",value:function _onFabricSelectClear(fEvent){var obj=this.getSelectedObj();this.isPrevEditing=true;this.setSelectedInfo(fEvent.target,false);if(obj){if(obj.text===''){this.getCanvas().remove(obj);}}}},{key:"_onFabricSelect",value:function _onFabricSelect(fEvent){this.isPrevEditing=true;this.setSelectedInfo(fEvent.target,true);}},{key:"_onFabricMouseDown",value:function _onFabricMouseDown(fEvent){var obj=fEvent.target;if(obj&&!obj.isType('text')){return;}
if(this.isPrevEditing){this.isPrevEditing=false;return;}
this._fireAddText(fEvent);}},{key:"_fireAddText",value:function _fireAddText(fEvent){var obj=fEvent.target;var e=fEvent.e||{};var originPointer=this.getCanvas().getPointer(e);if(!obj){this.fire(eventNames.ADD_TEXT,{originPosition:{x:originPointer.x,y:originPointer.y},clientPosition:{x:e.clientX||0,y:e.clientY||0}});}}},{key:"_onFabricMouseUp",value:function _onFabricMouseUp(fEvent){var target=fEvent.target;var newClickTime=new Date().getTime();if(this._isDoubleClick(newClickTime)&&!target.isEditing){target.enterEditing();}
if(target.isEditing){this.fire(eventNames.TEXT_EDITING);}
this._lastClickTime=newClickTime;}},{key:"_isDoubleClick",value:function _isDoubleClick(newClickTime){return newClickTime-this._lastClickTime<DBCLICK_TIME;}}]);return Text;}(component);var component_text=(text_Text);;function component_icon_createSuper(Derived){var hasNativeReflectConstruct=component_icon_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function component_icon_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var pathMap={arrow:'M 0 90 H 105 V 120 L 160 60 L 105 0 V 30 H 0 Z',cancel:'M 0 30 L 30 60 L 0 90 L 30 120 L 60 90 L 90 120 L 120 90 '+'L 90 60 L 120 30 L 90 0 L 60 30 L 30 0 Z'};var icon_Icon=function(_Component){_inherits(Icon,_Component);var _super=component_icon_createSuper(Icon);function Icon(graphics){var _context,_context2,_context3;var _this;_classCallCheck(this,Icon);_this=_super.call(this,componentNames.ICON,graphics);_this._oColor='#000000';_this._pathMap=pathMap;_this._type=null;_this._iconColor=null;_this._handlers={mousedown:bind_default()(_context=_this._onFabricMouseDown).call(_context,_assertThisInitialized(_this)),mousemove:bind_default()(_context2=_this._onFabricMouseMove).call(_context2,_assertThisInitialized(_this)),mouseup:bind_default()(_context3=_this._onFabricMouseUp).call(_context3,_assertThisInitialized(_this))};return _this;}
_createClass(Icon,[{key:"setStates",value:function setStates(type,iconColor){this._type=type;this._iconColor=iconColor;}},{key:"start",value:function start(){var canvas=this.getCanvas();canvas.selection=false;canvas.on('mouse:down',this._handlers.mousedown);}},{key:"end",value:function end(){var canvas=this.getCanvas();canvas.selection=true;canvas.off({'mouse:down':this._handlers.mousedown});}},{key:"add",value:function add(type,options){var _this2=this;return new(promise_default())(function(resolve,reject){var canvas=_this2.getCanvas();var path=_this2._pathMap[type];var selectionStyle=fObjectOptions.SELECTION_STYLE;var icon=path?_this2._createIcon(path):null;_this2._icon=icon;if(!icon){reject(rejectMessages.invalidParameters);}
icon.set(extend_default()({type:'icon',fill:_this2._oColor},selectionStyle,options,_this2.graphics.controlStyle));canvas.add(icon).setActiveObject(icon);resolve(_this2.graphics.createObjectProperties(icon));});}},{key:"registerPaths",value:function registerPaths(pathInfos){var _this3=this;forEach_default()(pathInfos,function(path,type){_this3._pathMap[type]=path;},this);}},{key:"setColor",value:function setColor(color,obj){this._oColor=color;if(obj&&obj.get('type')==='icon'){obj.set({fill:this._oColor});this.getCanvas().renderAll();}}},{key:"getColor",value:function getColor(obj){return fill_default()(obj);}},{key:"_createIcon",value:function _createIcon(path){return new fabric.fabric.Path(path);}},{key:"_onFabricMouseDown",value:function _onFabricMouseDown(fEvent){var _this4=this;var canvas=this.getCanvas();this._startPoint=canvas.getPointer(fEvent.e);var _this$_startPoint=this._startPoint,left=_this$_startPoint.x,top=_this$_startPoint.y;this.add(this._type,{left:left,top:top,fill:this._iconColor}).then(function(){_this4.fire(eventNames.ADD_OBJECT,_this4.graphics.createObjectProperties(_this4._icon));canvas.on('mouse:move',_this4._handlers.mousemove);canvas.on('mouse:up',_this4._handlers.mouseup);});}},{key:"_onFabricMouseMove",value:function _onFabricMouseMove(fEvent){var canvas=this.getCanvas();if(!this._icon){return;}
var moveOriginPointer=canvas.getPointer(fEvent.e);var scaleX=(moveOriginPointer.x-this._startPoint.x)/this._icon.width;var scaleY=(moveOriginPointer.y-this._startPoint.y)/this._icon.height;this._icon.set({scaleX:Math.abs(scaleX*2),scaleY:Math.abs(scaleY*2)});this._icon.setCoords();canvas.renderAll();}},{key:"_onFabricMouseUp",value:function _onFabricMouseUp(){var canvas=this.getCanvas();this.fire(eventNames.OBJECT_ADDED,this.graphics.createObjectProperties(this._icon));this._icon=null;canvas.off('mouse:down',this._handlers.mousedown);canvas.off('mouse:move',this._handlers.mousemove);canvas.off('mouse:up',this._handlers.mouseup);}}]);return Icon;}(component);var component_icon=(icon_Icon);;var mask_Mask=fabric.fabric.util.createClass(fabric.fabric.Image.filters.BlendImage,{applyTo:function applyTo(pipelineState){if(!this.mask){return;}
var canvas=pipelineState.canvasEl;var width=canvas.width,height=canvas.height;var maskCanvasEl=this._createCanvasOfMask(width,height);var ctx=canvas.getContext('2d');var maskCtx=maskCanvasEl.getContext('2d');var imageData=ctx.getImageData(0,0,width,height);this._drawMask(maskCtx,canvas,ctx);this._mapData(maskCtx,imageData,width,height);pipelineState.imageData=imageData;},_createCanvasOfMask:function _createCanvasOfMask(width,height){var maskCanvasEl=fabric.fabric.util.createCanvasElement();maskCanvasEl.width=width;maskCanvasEl.height=height;return maskCanvasEl;},_drawMask:function _drawMask(maskCtx){var mask=this.mask;var maskImg=mask.getElement();var angle=mask.angle,left=mask.left,scaleX=mask.scaleX,scaleY=mask.scaleY,top=mask.top;maskCtx.save();maskCtx.translate(left,top);maskCtx.rotate(angle*Math.PI/180);maskCtx.scale(scaleX,scaleY);maskCtx.drawImage(maskImg,-maskImg.width/2,-maskImg.height/2);maskCtx.restore();},_mapData:function _mapData(maskCtx,imageData,width,height){var data=imageData.data,imgHeight=imageData.height,imgWidth=imageData.width;var sourceData=data;var len=imgWidth*imgHeight*4;var maskData=maskCtx.getImageData(0,0,width,height).data;for(var i=0;i<len;i+=4){sourceData[i+3]=maskData[i];}}});var extension_mask=(mask_Mask);;var Sharpen=fabric.fabric.util.createClass(fabric.fabric.Image.filters.Convolute,{type:'Sharpen',initialize:function initialize(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0];}});var sharpen=(Sharpen);;var Emboss=fabric.fabric.util.createClass(fabric.fabric.Image.filters.Convolute,{type:'Emboss',initialize:function initialize(){this.matrix=[1,1,1,1,0.7,-1,-1,-1,-1];}});var emboss=(Emboss);;var ColorFilter=fabric.fabric.util.createClass(fabric.fabric.Image.filters.BaseFilter,{type:'ColorFilter',initialize:function initialize(options){if(!options){options={};}
this.color=options.color||'#FFFFFF';this.threshold=options.threshold||45;this.x=options.x||null;this.y=options.y||null;},applyTo:function applyTo(canvas){var canvasEl=canvas.canvasEl;var context=canvasEl.getContext('2d');var imageData=context.getImageData(0,0,canvasEl.width,canvasEl.height);var data=imageData.data;var threshold=this.threshold;var filterColor=fabric.fabric.Color.sourceFromHex(this.color);var i,len;if(this.x&&this.y){filterColor=this._getColor(imageData,this.x,this.y);}
for(i=0,len=data.length;i<len;i+=4){if(this._isOutsideThreshold(data[i],filterColor[0],threshold)||this._isOutsideThreshold(data[i+1],filterColor[1],threshold)||this._isOutsideThreshold(data[i+2],filterColor[2],threshold)){continue;}
data[i]=data[i+1]=data[i+2]=data[i+3]=0;}
context.putImageData(imageData,0,0);},_isOutsideThreshold:function _isOutsideThreshold(color1,color2,threshold){var diff=color1-color2;return Math.abs(diff)>threshold;},_getColor:function _getColor(imageData,x,y){var color=[0,0,0,0];var data=imageData.data,width=imageData.width;var bytes=4;var position=(width*y+x)*bytes;color[0]=data[position];color[1]=data[position+1];color[2]=data[position+2];color[3]=data[position+3];return color;}});var colorFilter=(ColorFilter);;function component_filter_createSuper(Derived){var hasNativeReflectConstruct=component_filter_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function component_filter_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var filters=fabric.fabric.Image.filters;filters.Mask=extension_mask;filters.Sharpen=sharpen;filters.Emboss=emboss;filters.ColorFilter=colorFilter;var filter_Filter=function(_Component){_inherits(Filter,_Component);var _super=component_filter_createSuper(Filter);function Filter(graphics){_classCallCheck(this,Filter);return _super.call(this,componentNames.FILTER,graphics);}
_createClass(Filter,[{key:"add",value:function add(type,options){var _this=this;return new(promise_default())(function(resolve,reject){var sourceImg=_this._getSourceImage();var canvas=_this.getCanvas();var imgFilter=_this._getFilter(sourceImg,type);if(!imgFilter){imgFilter=_this._createFilter(sourceImg,type,options);}
if(!imgFilter){reject(rejectMessages.invalidParameters);}
_this._changeFilterValues(imgFilter,options);_this._apply(sourceImg,function(){canvas.renderAll();resolve({type:type,action:'add',options:options});});});}},{key:"remove",value:function remove(type){var _this2=this;return new(promise_default())(function(resolve,reject){var sourceImg=_this2._getSourceImage();var canvas=_this2.getCanvas();var options=_this2.getOptions(type);if(!sourceImg.filters.length){reject(rejectMessages.unsupportedOperation);}
_this2._removeFilter(sourceImg,type);_this2._apply(sourceImg,function(){canvas.renderAll();resolve({type:type,action:'remove',options:options});});});}},{key:"hasFilter",value:function hasFilter(type){return!!this._getFilter(this._getSourceImage(),type);}},{key:"getOptions",value:function getOptions(type){var sourceImg=this._getSourceImage();var imgFilter=this._getFilter(sourceImg,type);if(!imgFilter){return null;}
return extend_default()({},imgFilter.options);}},{key:"_changeFilterValues",value:function _changeFilterValues(imgFilter,options){forEach_default()(options,function(value,key){if(!isUndefined_default()(imgFilter[key])){imgFilter[key]=value;}});forEach_default()(imgFilter.options,function(value,key){if(!isUndefined_default()(options[key])){imgFilter.options[key]=options[key];}});}},{key:"_apply",value:function _apply(sourceImg,callback){sourceImg.filters.push();var result=sourceImg.applyFilters();if(result){callback();}}},{key:"_getSourceImage",value:function _getSourceImage(){return this.getCanvasImage();}},{key:"_createFilter",value:function _createFilter(sourceImg,type,options){var filterObj;var fabricType=this._getFabricFilterType(type);var ImageFilter=fabric.fabric.Image.filters[fabricType];if(ImageFilter){filterObj=new ImageFilter(options);filterObj.options=options;sourceImg.filters.push(filterObj);}
return filterObj;}},{key:"_getFilter",value:function _getFilter(sourceImg,type){var imgFilter=null;if(sourceImg){var fabricType=this._getFabricFilterType(type);var length=sourceImg.filters.length;var item,i;for(i=0;i<length;i+=1){item=sourceImg.filters[i];if(item.type===fabricType){imgFilter=item;break;}}}
return imgFilter;}},{key:"_removeFilter",value:function _removeFilter(sourceImg,type){var _context;var fabricType=this._getFabricFilterType(type);sourceImg.filters=filter_default()(_context=sourceImg.filters).call(_context,function(value){return value.type!==fabricType;});}},{key:"_getFabricFilterType",value:function _getFabricFilterType(type){return type.charAt(0).toUpperCase()+slice_default()(type).call(type,1);}}]);return Filter;}(component);var component_filter=(filter_Filter);var shapeResizeHelper=__webpack_require__(1801);var shapeResizeHelper_default=__webpack_require__.n(shapeResizeHelper);;var FILTER_OPTION_MAP={pixelate:'blocksize',blur:'blur'};var POSITION_DIMENSION_MAP={x:'width',y:'height'};var FILTER_NAME_VALUE_MAP=flipObject(FILTER_OPTION_MAP);var cachedCanvasImageElement=null;function getFillImageFromShape(shapeObj){var _getCustomProperty=getCustomProperty(shapeObj,'patternSourceCanvas'),patternSourceCanvas=_getCustomProperty.patternSourceCanvas;var _patternSourceCanvas$=patternSourceCanvas.getObjects(),_patternSourceCanvas$2=_slicedToArray(_patternSourceCanvas$,1),fillImage=_patternSourceCanvas$2[0];return fillImage;}
function rePositionFilterTypeFillImage(shapeObj){var angle=shapeObj.angle,flipX=shapeObj.flipX,flipY=shapeObj.flipY;var fillImage=getFillImageFromShape(shapeObj);var rotatedShapeCornerDimension=getRotatedDimension(shapeObj);var right=rotatedShapeCornerDimension.right,bottom=rotatedShapeCornerDimension.bottom;var width=rotatedShapeCornerDimension.width,height=rotatedShapeCornerDimension.height;var diffLeft=(width-shapeObj.width)/2;var diffTop=(height-shapeObj.height)/2;var cropX=shapeObj.left-shapeObj.width/2-diffLeft;var cropY=shapeObj.top-shapeObj.height/2-diffTop;var left=width/2-diffLeft;var top=height/2-diffTop;var fillImageMaxSize=Math.max(width,height)+Math.max(diffLeft,diffTop);var _calculateFillImageDi=calculateFillImageDimensionOutsideCanvas({shapeObj:shapeObj,left:left,top:top,width:width,height:height,cropX:cropX,cropY:cropY,flipX:flipX,flipY:flipY,right:right,bottom:bottom});var _calculateFillImageDi2=_slicedToArray(_calculateFillImageDi,4);left=_calculateFillImageDi2[0];top=_calculateFillImageDi2[1];width=_calculateFillImageDi2[2];height=_calculateFillImageDi2[3];fillImage.set({angle:flipX===flipY?-angle:angle,left:left,top:top,width:width,height:height,cropX:cropX,cropY:cropY,flipX:flipX,flipY:flipY});setCustomProperty(fillImage,{fillImageMaxSize:fillImageMaxSize});}
function makeFilterOptionFromFabricImage(imageObject){var _context;return map_default()(_context=imageObject.filters).call(_context,function(filter){var _Object$keys=keys_default()(filter),_Object$keys2=_slicedToArray(_Object$keys,1),key=_Object$keys2[0];return _defineProperty({},FILTER_NAME_VALUE_MAP[key],filter[key]);});}
function calculateFillImageDimensionOutsideCanvas(_ref2){var shapeObj=_ref2.shapeObj,left=_ref2.left,top=_ref2.top,width=_ref2.width,height=_ref2.height,cropX=_ref2.cropX,cropY=_ref2.cropY,flipX=_ref2.flipX,flipY=_ref2.flipY,right=_ref2.right,bottom=_ref2.bottom;var overflowAreaPositionFixer=function overflowAreaPositionFixer(type,outDistance,imageLeft,imageTop){return calculateDistanceOverflowPart({type:type,outDistance:outDistance,shapeObj:shapeObj,flipX:flipX,flipY:flipY,left:imageLeft,top:imageTop});};var originalWidth=width,originalHeight=height;var _calculateDimensionLe=calculateDimensionLeftTopEdge(overflowAreaPositionFixer,{left:left,top:top,width:width,height:height,cropX:cropX,cropY:cropY});var _calculateDimensionLe2=_slicedToArray(_calculateDimensionLe,4);left=_calculateDimensionLe2[0];top=_calculateDimensionLe2[1];width=_calculateDimensionLe2[2];height=_calculateDimensionLe2[3];var _calculateDimensionRi=calculateDimensionRightBottomEdge(overflowAreaPositionFixer,{left:left,top:top,insideCanvasRealImageWidth:width,insideCanvasRealImageHeight:height,right:right,bottom:bottom,cropX:cropX,cropY:cropY,originalWidth:originalWidth,originalHeight:originalHeight});var _calculateDimensionRi2=_slicedToArray(_calculateDimensionRi,4);left=_calculateDimensionRi2[0];top=_calculateDimensionRi2[1];width=_calculateDimensionRi2[2];height=_calculateDimensionRi2[3];return[left,top,width,height];}
function calculateDimensionRightBottomEdge(overflowAreaPositionFixer,_ref3){var left=_ref3.left,top=_ref3.top,insideCanvasRealImageWidth=_ref3.insideCanvasRealImageWidth,insideCanvasRealImageHeight=_ref3.insideCanvasRealImageHeight,right=_ref3.right,bottom=_ref3.bottom,cropX=_ref3.cropX,cropY=_ref3.cropY,originalWidth=_ref3.originalWidth,originalHeight=_ref3.originalHeight;var width=insideCanvasRealImageWidth,height=insideCanvasRealImageHeight;var _cachedCanvasImageEle=cachedCanvasImageElement,canvasWidth=_cachedCanvasImageEle.width,canvasHeight=_cachedCanvasImageEle.height;if(right>canvasWidth&&cropX>0){width=originalWidth-Math.abs(right-canvasWidth);}
if(bottom>canvasHeight&&cropY>0){height=originalHeight-Math.abs(bottom-canvasHeight);}
var diff={x:(insideCanvasRealImageWidth-width)/2,y:(insideCanvasRealImageHeight-height)/2};forEach_default()(['x','y'],function(type){var cropDistance2=diff[type];if(cropDistance2>0){var _overflowAreaPosition=overflowAreaPositionFixer(type,cropDistance2,left,top);var _overflowAreaPosition2=_slicedToArray(_overflowAreaPosition,2);left=_overflowAreaPosition2[0];top=_overflowAreaPosition2[1];}});return[left,top,width,height];}
function calculateDimensionLeftTopEdge(overflowAreaPositionFixer,_ref4){var left=_ref4.left,top=_ref4.top,width=_ref4.width,height=_ref4.height,cropX=_ref4.cropX,cropY=_ref4.cropY;var dimension={width:width,height:height};forEach_default()(['x','y'],function(type){var cropDistance=type==='x'?cropX:cropY;var compareSize=dimension[POSITION_DIMENSION_MAP[type]];var standardSize=cachedCanvasImageElement[POSITION_DIMENSION_MAP[type]];if(compareSize>standardSize){var outDistance=(compareSize-standardSize)/2;dimension[POSITION_DIMENSION_MAP[type]]=standardSize;var _overflowAreaPosition3=overflowAreaPositionFixer(type,outDistance,left,top);var _overflowAreaPosition4=_slicedToArray(_overflowAreaPosition3,2);left=_overflowAreaPosition4[0];top=_overflowAreaPosition4[1];}
if(cropDistance<0){var _overflowAreaPosition5=overflowAreaPositionFixer(type,cropDistance,left,top);var _overflowAreaPosition6=_slicedToArray(_overflowAreaPosition5,2);left=_overflowAreaPosition6[0];top=_overflowAreaPosition6[1];}});return[left,top,dimension.width,dimension.height];}
function makeFillPatternForFilter(canvasImage,filterOption,patternSourceCanvas){var copiedCanvasElement=getCachedCanvasImageElement(canvasImage);var fillImage=makeFillImage(copiedCanvasElement,canvasImage.angle,filterOption);patternSourceCanvas.add(fillImage);var fabricProperty={fill:new fabric.fabric.Pattern({source:patternSourceCanvas.getElement(),repeat:'no-repeat'})};setCustomProperty(fabricProperty,{patternSourceCanvas:patternSourceCanvas});return fabricProperty;}
function resetFillPatternCanvas(patternSourceCanvas){var _patternSourceCanvas$3=patternSourceCanvas.getObjects(),_patternSourceCanvas$4=_slicedToArray(_patternSourceCanvas$3,1),innerImage=_patternSourceCanvas$4[0];var _getCustomProperty2=getCustomProperty(innerImage,'fillImageMaxSize'),fillImageMaxSize=_getCustomProperty2.fillImageMaxSize;fillImageMaxSize=Math.max(1,fillImageMaxSize);patternSourceCanvas.setDimensions({width:fillImageMaxSize,height:fillImageMaxSize});patternSourceCanvas.renderAll();}
function reMakePatternImageSource(shapeObj,canvasImage){var _getCustomProperty3=getCustomProperty(shapeObj,'patternSourceCanvas'),patternSourceCanvas=_getCustomProperty3.patternSourceCanvas;var _patternSourceCanvas$5=patternSourceCanvas.getObjects(),_patternSourceCanvas$6=_slicedToArray(_patternSourceCanvas$5,1),fillImage=_patternSourceCanvas$6[0];var filterOption=makeFilterOptionFromFabricImage(fillImage);patternSourceCanvas.remove(fillImage);var copiedCanvasElement=getCachedCanvasImageElement(canvasImage,true);var newFillImage=makeFillImage(copiedCanvasElement,canvasImage.angle,filterOption);patternSourceCanvas.add(newFillImage);}
function getCachedCanvasImageElement(canvasImage){var reset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!cachedCanvasImageElement||reset){cachedCanvasImageElement=canvasImage.toCanvasElement();}
return cachedCanvasImageElement;}
function calculateDistanceOverflowPart(_ref5){var type=_ref5.type,shapeObj=_ref5.shapeObj,outDistance=_ref5.outDistance,left=_ref5.left,top=_ref5.top,flipX=_ref5.flipX,flipY=_ref5.flipY;var shapePointNavigation=getShapeEdgePoint(shapeObj);var shapeNeighborPointNavigation=[[1,2],[0,3],[0,3],[1,2]];var linePointsOutsideCanvas=calculateLinePointsOutsideCanvas(type,shapePointNavigation,shapeNeighborPointNavigation);var reatAngles=calculateLineAngleOfOutsideCanvas(type,shapePointNavigation,linePointsOutsideCanvas);var startPointIndex=linePointsOutsideCanvas.startPointIndex;var diffPosition=getReversePositionForFlip({outDistance:outDistance,startPointIndex:startPointIndex,flipX:flipX,flipY:flipY,reatAngles:reatAngles});return[left+diffPosition.left,top+diffPosition.top];}
function getReversePositionForFlip(_ref6){var outDistance=_ref6.outDistance,startPointIndex=_ref6.startPointIndex,flipX=_ref6.flipX,flipY=_ref6.flipY,reatAngles=_ref6.reatAngles;var rotationChangePoint1=outDistance*Math.cos(reatAngles[0]*Math.PI/180);var rotationChangePoint2=outDistance*Math.cos(reatAngles[1]*Math.PI/180);var isForward=startPointIndex===2||startPointIndex===3;var diffPosition={top:isForward?rotationChangePoint1:rotationChangePoint2,left:isForward?rotationChangePoint2:rotationChangePoint1};if(isReverseLeftPositionForFlip(startPointIndex,flipX,flipY)){diffPosition.left=diffPosition.left*-1;}
if(isReverseTopPositionForFlip(startPointIndex,flipX,flipY)){diffPosition.top=diffPosition.top*-1;}
return diffPosition;}
function calculateLinePointsOutsideCanvas(type,shapePointNavigation,shapeNeighborPointNavigation){var minimumPoint=0;var minimumPointIndex=0;forEach_default()(shapePointNavigation,function(point,index){if(point[type]<minimumPoint){minimumPoint=point[type];minimumPointIndex=index;}});var _shapeNeighborPointNa=_slicedToArray(shapeNeighborPointNavigation[minimumPointIndex],2),endPointIndex1=_shapeNeighborPointNa[0],endPointIndex2=_shapeNeighborPointNa[1];return{startPointIndex:minimumPointIndex,endPointIndex1:endPointIndex1,endPointIndex2:endPointIndex2};}
function calculateLineAngleOfOutsideCanvas(type,shapePointNavigation,linePointsOfOneVertexIndex){var _context2;var startPointIndex=linePointsOfOneVertexIndex.startPointIndex,endPointIndex1=linePointsOfOneVertexIndex.endPointIndex1,endPointIndex2=linePointsOfOneVertexIndex.endPointIndex2;var horizontalVerticalAngle=type==='x'?180:270;return map_default()(_context2=[endPointIndex1,endPointIndex2]).call(_context2,function(pointIndex){var startPoint=shapePointNavigation[startPointIndex];var endPoint=shapePointNavigation[pointIndex];var diffY=startPoint.y-endPoint.y;var diffX=startPoint.x-endPoint.x;return Math.atan2(diffY,diffX)*180/Math.PI-horizontalVerticalAngle;});}
function isReverseLeftPositionForFlip(startPointIndex,flipX,flipY){return(!flipX&&flipY||!flipX&&!flipY)&&startPointIndex===0||(flipX&&flipY||flipX&&!flipY)&&startPointIndex===1||(!flipX&&!flipY||!flipX&&flipY)&&startPointIndex===2||(flipX&&!flipY||flipX&&flipY)&&startPointIndex===3;}
function isReverseTopPositionForFlip(startPointIndex,flipX,flipY){return(flipX&&!flipY||!flipX&&!flipY)&&startPointIndex===0||(!flipX&&!flipY||flipX&&!flipY)&&startPointIndex===1||(flipX&&flipY||!flipX&&flipY)&&startPointIndex===2||(!flipX&&flipY||flipX&&flipY)&&startPointIndex===3;}
function getShapeEdgePoint(shapeObj){return[shapeObj.getPointByOrigin('left','top'),shapeObj.getPointByOrigin('right','top'),shapeObj.getPointByOrigin('left','bottom'),shapeObj.getPointByOrigin('right','bottom')];}
function getRotatedDimension(shapeObj){var _getShapeEdgePoint=getShapeEdgePoint(shapeObj),_getShapeEdgePoint2=_slicedToArray(_getShapeEdgePoint,4),_getShapeEdgePoint2$=_getShapeEdgePoint2[0],ax=_getShapeEdgePoint2$.x,ay=_getShapeEdgePoint2$.y,_getShapeEdgePoint2$2=_getShapeEdgePoint2[1],bx=_getShapeEdgePoint2$2.x,by=_getShapeEdgePoint2$2.y,_getShapeEdgePoint2$3=_getShapeEdgePoint2[2],cx=_getShapeEdgePoint2$3.x,cy=_getShapeEdgePoint2$3.y,_getShapeEdgePoint2$4=_getShapeEdgePoint2[3],dx=_getShapeEdgePoint2$4.x,dy=_getShapeEdgePoint2$4.y;var left=Math.min(ax,bx,cx,dx);var top=Math.min(ay,by,cy,dy);var right=Math.max(ax,bx,cx,dx);var bottom=Math.max(ay,by,cy,dy);return{left:left,top:top,right:right,bottom:bottom,width:right-left,height:bottom-top};}
function makeFillImage(copiedCanvasElement,currentCanvasImageAngle,filterOption){var _context3;var fillImage=new fabric.fabric.Image(copiedCanvasElement);forEach_default()(extend_default().apply(void 0,concat_default()(_context3=[{}]).call(_context3,_toConsumableArray(filterOption))),function(value,key){var fabricFilterClassName=capitalizeString(key);var filter=new fabric.fabric.Image.filters[fabricFilterClassName](_defineProperty({},FILTER_OPTION_MAP[key],value));fillImage.filters.push(filter);});fillImage.applyFilters();setCustomProperty(fillImage,{originalAngle:currentCanvasImageAngle,fillImageMaxSize:Math.max(fillImage.width,fillImage.height)});shapeResizeHelper_default().adjustOriginToCenter(fillImage);return fillImage;};function shape_createSuper(Derived){var hasNativeReflectConstruct=shape_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function shape_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var SHAPE_INIT_OPTIONS=extend_default()({strokeWidth:1,stroke:'#000000',fill:'#ffffff',width:1,height:1,rx:0,ry:0},SHAPE_DEFAULT_OPTIONS);var DEFAULT_TYPE='rect';var DEFAULT_WIDTH=20;var DEFAULT_HEIGHT=20;function makeFabricFillOption(options,canvasImage,createStaticCanvas){var fillOption=fill_default()(options);var fillType=getFillTypeFromOption(fill_default()(options));var fill=fillOption;if(fillOption.color){fill=fillOption.color;}
var extOption=null;if(fillType==='filter'){var newStaticCanvas=createStaticCanvas();extOption=makeFillPatternForFilter(canvasImage,filter_default()(fillOption),newStaticCanvas);}else{extOption={fill:fill};}
return extend_default()({},options,extOption);}
var shape_Shape=function(_Component){_inherits(Shape,_Component);var _super=shape_createSuper(Shape);function Shape(graphics){var _context,_context2,_context3,_context4,_context5;var _this;_classCallCheck(this,Shape);_this=_super.call(this,componentNames.SHAPE,graphics);_this._shapeObj=null;_this._type=DEFAULT_TYPE;_this._options=extend_default()({},SHAPE_INIT_OPTIONS);_this._isSelected=false;_this._startPoint={};_this._withShiftKey=false;_this._handlers={mousedown:bind_default()(_context=_this._onFabricMouseDown).call(_context,_assertThisInitialized(_this)),mousemove:bind_default()(_context2=_this._onFabricMouseMove).call(_context2,_assertThisInitialized(_this)),mouseup:bind_default()(_context3=_this._onFabricMouseUp).call(_context3,_assertThisInitialized(_this)),keydown:bind_default()(_context4=_this._onKeyDown).call(_context4,_assertThisInitialized(_this)),keyup:bind_default()(_context5=_this._onKeyUp).call(_context5,_assertThisInitialized(_this))};return _this;}
_createClass(Shape,[{key:"start",value:function start(){var canvas=this.getCanvas();this._isSelected=false;canvas.defaultCursor='crosshair';canvas.selection=false;canvas.uniformScaling=true;canvas.on({'mouse:down':this._handlers.mousedown});fabric.fabric.util.addListener(document,'keydown',this._handlers.keydown);fabric.fabric.util.addListener(document,'keyup',this._handlers.keyup);}},{key:"end",value:function end(){var canvas=this.getCanvas();this._isSelected=false;canvas.defaultCursor='default';canvas.selection=true;canvas.uniformScaling=false;canvas.off({'mouse:down':this._handlers.mousedown});fabric.fabric.util.removeListener(document,'keydown',this._handlers.keydown);fabric.fabric.util.removeListener(document,'keyup',this._handlers.keyup);}},{key:"setStates",value:function setStates(type,options){this._type=type;if(options){this._options=extend_default()(this._options,options);}}},{key:"add",value:function add(type,options){var _this2=this;return new(promise_default())(function(resolve){var canvas=_this2.getCanvas();var extendOption=_this2._extendOptions(options);var shapeObj=_this2._createInstance(type,extendOption);var objectProperties=_this2.graphics.createObjectProperties(shapeObj);_this2._bindEventOnShape(shapeObj);canvas.add(shapeObj).setActiveObject(shapeObj);_this2._resetPositionFillFilter(shapeObj);resolve(objectProperties);});}},{key:"change",value:function change(shapeObj,options){var _this3=this;return new(promise_default())(function(resolve,reject){if(!isShape(shapeObj)){reject(rejectMessages.unsupportedType);}
var hasFillOption=getFillTypeFromOption(fill_default()(options))==='filter';var _this3$graphics=_this3.graphics,canvasImage=_this3$graphics.canvasImage,createStaticCanvas=_this3$graphics.createStaticCanvas;shapeObj.set(hasFillOption?makeFabricFillOption(options,canvasImage,createStaticCanvas):options);if(hasFillOption){_this3._resetPositionFillFilter(shapeObj);}
_this3.getCanvas().renderAll();resolve();});}},{key:"makeFillPropertyForUserEvent",value:function makeFillPropertyForUserEvent(shapeObj){var fillType=getFillTypeFromObject(shapeObj);var fillProp={};if(fillType===SHAPE_FILL_TYPE.FILTER){var fillImage=getFillImageFromShape(shapeObj);var filterOption=makeFilterOptionFromFabricImage(fillImage);fillProp.type=fillType;fillProp.filter=filterOption;}else{fillProp.type=SHAPE_FILL_TYPE.COLOR;fillProp.color=fill_default()(shapeObj)||'transparent';}
return fillProp;}},{key:"processForCopiedObject",value:function processForCopiedObject(shapeObj,originalShapeObj){this._bindEventOnShape(shapeObj);if(getFillTypeFromObject(shapeObj)==='filter'){var fillImage=getFillImageFromShape(originalShapeObj);var filterOption=makeFilterOptionFromFabricImage(fillImage);var newStaticCanvas=this.graphics.createStaticCanvas();shapeObj.set(makeFillPatternForFilter(this.graphics.canvasImage,filterOption,newStaticCanvas));this._resetPositionFillFilter(shapeObj);}}},{key:"_createInstance",value:function _createInstance(type,options){var instance;switch(type){case'rect':instance=new fabric.fabric.Rect(options);break;case'circle':instance=new fabric.fabric.Ellipse(extend_default()({type:'circle'},options));break;case'triangle':instance=new fabric.fabric.Triangle(options);break;default:instance={};}
return instance;}},{key:"_extendOptions",value:function _extendOptions(options){var selectionStyles=fObjectOptions.SELECTION_STYLE;var _this$graphics=this.graphics,canvasImage=_this$graphics.canvasImage,createStaticCanvas=_this$graphics.createStaticCanvas;options=extend_default()({},SHAPE_INIT_OPTIONS,this._options,selectionStyles,options);return makeFabricFillOption(options,canvasImage,createStaticCanvas);}},{key:"_bindEventOnShape",value:function _bindEventOnShape(shapeObj){var self=this;var canvas=this.getCanvas();shapeObj.on({added:function added(){self._shapeObj=this;shapeResizeHelper_default().setOrigins(self._shapeObj);},selected:function selected(){self._isSelected=true;self._shapeObj=this;canvas.uniformScaling=true;canvas.defaultCursor='default';shapeResizeHelper_default().setOrigins(self._shapeObj);},deselected:function deselected(){self._isSelected=false;self._shapeObj=null;canvas.defaultCursor='crosshair';canvas.uniformScaling=false;},modified:function modified(){var currentObj=self._shapeObj;shapeResizeHelper_default().adjustOriginToCenter(currentObj);shapeResizeHelper_default().setOrigins(currentObj);},modifiedInGroup:function modifiedInGroup(activeSelection){self._fillFilterRePositionInGroupSelection(shapeObj,activeSelection);},moving:function moving(){self._resetPositionFillFilter(this);},rotating:function rotating(){self._resetPositionFillFilter(this);},scaling:function scaling(fEvent){var pointer=canvas.getPointer(fEvent.e);var currentObj=self._shapeObj;canvas.setCursor('crosshair');shapeResizeHelper_default().resize(currentObj,pointer,true);self._resetPositionFillFilter(this);}});}},{key:"_onFabricMouseDown",value:function _onFabricMouseDown(fEvent){if(!fEvent.target){this._isSelected=false;this._shapeObj=false;}
if(!this._isSelected&&!this._shapeObj){var canvas=this.getCanvas();this._startPoint=canvas.getPointer(fEvent.e);canvas.on({'mouse:move':this._handlers.mousemove,'mouse:up':this._handlers.mouseup});}}},{key:"_onFabricMouseMove",value:function _onFabricMouseMove(fEvent){var _this4=this;var canvas=this.getCanvas();var pointer=canvas.getPointer(fEvent.e);var startPointX=this._startPoint.x;var startPointY=this._startPoint.y;var width=startPointX-pointer.x;var height=startPointY-pointer.y;var shape=this._shapeObj;if(!shape){this.add(this._type,{left:startPointX,top:startPointY,width:width,height:height}).then(function(objectProps){_this4.fire(eventNames.ADD_OBJECT,objectProps);});}else{this._shapeObj.set({isRegular:this._withShiftKey});shapeResizeHelper_default().resize(shape,pointer);canvas.renderAll();this._resetPositionFillFilter(shape);}}},{key:"_onFabricMouseUp",value:function _onFabricMouseUp(){var _this5=this;var canvas=this.getCanvas();var startPointX=this._startPoint.x;var startPointY=this._startPoint.y;var shape=this._shapeObj;if(!shape){this.add(this._type,{left:startPointX,top:startPointY,width:DEFAULT_WIDTH,height:DEFAULT_HEIGHT}).then(function(objectProps){_this5.fire(eventNames.ADD_OBJECT,objectProps);});}else if(shape){shapeResizeHelper_default().adjustOriginToCenter(shape);this.fire(eventNames.OBJECT_ADDED,this.graphics.createObjectProperties(shape));}
canvas.off({'mouse:move':this._handlers.mousemove,'mouse:up':this._handlers.mouseup});}},{key:"_onKeyDown",value:function _onKeyDown(e){if(e.keyCode===keyCodes.SHIFT){this._withShiftKey=true;if(this._shapeObj){this._shapeObj.isRegular=true;}}}},{key:"_onKeyUp",value:function _onKeyUp(e){if(e.keyCode===keyCodes.SHIFT){this._withShiftKey=false;if(this._shapeObj){this._shapeObj.isRegular=false;}}}},{key:"_resetPositionFillFilter",value:function _resetPositionFillFilter(shapeObj){if(getFillTypeFromObject(shapeObj)!=='filter'){return;}
var _getCustomProperty=getCustomProperty(shapeObj,'patternSourceCanvas'),patternSourceCanvas=_getCustomProperty.patternSourceCanvas;var fillImage=getFillImageFromShape(shapeObj);var _getCustomProperty2=getCustomProperty(fillImage,'originalAngle'),originalAngle=_getCustomProperty2.originalAngle;if(this.graphics.canvasImage.angle!==originalAngle){reMakePatternImageSource(shapeObj,this.graphics.canvasImage);}
var originX=shapeObj.originX,originY=shapeObj.originY;shapeResizeHelper_default().adjustOriginToCenter(shapeObj);shapeObj.width*=shapeObj.scaleX;shapeObj.height*=shapeObj.scaleY;shapeObj.rx*=shapeObj.scaleX;shapeObj.ry*=shapeObj.scaleY;shapeObj.scaleX=1;shapeObj.scaleY=1;rePositionFilterTypeFillImage(shapeObj);changeOrigin(shapeObj,{originX:originX,originY:originY});resetFillPatternCanvas(patternSourceCanvas);}},{key:"_fillFilterRePositionInGroupSelection",value:function _fillFilterRePositionInGroupSelection(shapeObj,activeSelection){if(activeSelection.scaleX!==1||activeSelection.scaleY!==1){activeSelection.addWithUpdate();}
var angle=shapeObj.angle,left=shapeObj.left,top=shapeObj.top;fabric.fabric.util.addTransformToObject(shapeObj,activeSelection.calcTransformMatrix());this._resetPositionFillFilter(shapeObj);shapeObj.set({angle:angle,left:left,top:top});}}]);return Shape;}(component);;function zoom_createSuper(Derived){var hasNativeReflectConstruct=zoom_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function zoom_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var zoom_MOUSE_MOVE_THRESHOLD=10;var DEFAULT_SCROLL_OPTION={left:0,top:0,width:0,height:0,stroke:'#000000',strokeWidth:0,fill:'#000000',opacity:0.4,evented:false,selectable:false,hoverCursor:'auto'};var DEFAULT_VERTICAL_SCROLL_RATIO={SIZE:0.0045,MARGIN:0.003,BORDER_RADIUS:0.003};var DEFAULT_HORIZONTAL_SCROLL_RATIO={SIZE:0.0066,MARGIN:0.0044,BORDER_RADIUS:0.003};var DEFAULT_ZOOM_LEVEL=1.0;var ZOOM_CHANGED=eventNames.ZOOM_CHANGED,ADD_TEXT=eventNames.ADD_TEXT,TEXT_EDITING=eventNames.TEXT_EDITING,OBJECT_MODIFIED=eventNames.OBJECT_MODIFIED,KEY_DOWN=eventNames.KEY_DOWN,KEY_UP=eventNames.KEY_UP,HAND_STARTED=eventNames.HAND_STARTED,HAND_STOPPED=eventNames.HAND_STOPPED;var Zoom=function(_Component){_inherits(Zoom,_Component);var _super=zoom_createSuper(Zoom);function Zoom(graphics){var _context,_context2,_context3,_context4,_context5,_context6,_context7,_context8,_context9,_context10,_context11,_context12;var _this;_classCallCheck(this,Zoom);_this=_super.call(this,componentNames.ZOOM,graphics);_this.zoomArea=null;_this._startPoint=null;_this._centerPoints=[];_this.zoomLevel=DEFAULT_ZOOM_LEVEL;_this.zoomMode=zoomModes.DEFAULT;_this._listeners={startZoom:bind_default()(_context=_this._onMouseDownWithZoomMode).call(_context,_assertThisInitialized(_this)),moveZoom:bind_default()(_context2=_this._onMouseMoveWithZoomMode).call(_context2,_assertThisInitialized(_this)),stopZoom:bind_default()(_context3=_this._onMouseUpWithZoomMode).call(_context3,_assertThisInitialized(_this)),startHand:bind_default()(_context4=_this._onMouseDownWithHandMode).call(_context4,_assertThisInitialized(_this)),moveHand:bind_default()(_context5=_this._onMouseMoveWithHandMode).call(_context5,_assertThisInitialized(_this)),stopHand:bind_default()(_context6=_this._onMouseUpWithHandMode).call(_context6,_assertThisInitialized(_this)),zoomChanged:bind_default()(_context7=_this._changeScrollState).call(_context7,_assertThisInitialized(_this)),keydown:bind_default()(_context8=_this._startHandModeWithSpaceBar).call(_context8,_assertThisInitialized(_this)),keyup:bind_default()(_context9=_this._endHandModeWithSpaceBar).call(_context9,_assertThisInitialized(_this))};var canvas=_this.getCanvas();_this.aspectRatio=canvas.width/canvas.height;_this._verticalScroll=new fabric.fabric.Rect(DEFAULT_SCROLL_OPTION);_this._horizontalScroll=new fabric.fabric.Rect(DEFAULT_SCROLL_OPTION);canvas.on(ZOOM_CHANGED,_this._listeners.zoomChanged);_this.graphics.on(ADD_TEXT,bind_default()(_context10=_this._startTextEditingHandler).call(_context10,_assertThisInitialized(_this)));_this.graphics.on(TEXT_EDITING,bind_default()(_context11=_this._startTextEditingHandler).call(_context11,_assertThisInitialized(_this)));_this.graphics.on(OBJECT_MODIFIED,bind_default()(_context12=_this._stopTextEditingHandler).call(_context12,_assertThisInitialized(_this)));return _this;}
_createClass(Zoom,[{key:"attachKeyboardZoomEvents",value:function attachKeyboardZoomEvents(){fabric.fabric.util.addListener(document,KEY_DOWN,this._listeners.keydown);fabric.fabric.util.addListener(document,KEY_UP,this._listeners.keyup);}},{key:"detachKeyboardZoomEvents",value:function detachKeyboardZoomEvents(){fabric.fabric.util.removeListener(document,KEY_DOWN,this._listeners.keydown);fabric.fabric.util.removeListener(document,KEY_UP,this._listeners.keyup);}},{key:"_startTextEditingHandler",value:function _startTextEditingHandler(){this.isTextEditing=true;}},{key:"_stopTextEditingHandler",value:function _stopTextEditingHandler(){this.isTextEditing=false;}},{key:"_startHandModeWithSpaceBar",value:function _startHandModeWithSpaceBar(e){if(this.withSpace||this.isTextEditing){return;}
if(e.keyCode===keyCodes.SPACE){this.withSpace=true;this.startHandMode();}}},{key:"_endHandModeWithSpaceBar",value:function _endHandModeWithSpaceBar(e){if(e.keyCode===keyCodes.SPACE){this.withSpace=false;this.endHandMode();}}},{key:"startZoomInMode",value:function startZoomInMode(){if(this.zoomArea){return;}
this.endHandMode();this.zoomMode=zoomModes.ZOOM;var canvas=this.getCanvas();this._changeObjectsEventedState(false);this.zoomArea=new fabric.fabric.Rect({left:0,top:0,width:0.5,height:0.5,stroke:'black',strokeWidth:1,fill:'transparent',hoverCursor:'zoom-in'});canvas.discardActiveObject();canvas.add(this.zoomArea);canvas.on('mouse:down',this._listeners.startZoom);canvas.selection=false;canvas.defaultCursor='zoom-in';}},{key:"endZoomInMode",value:function endZoomInMode(){this.zoomMode=zoomModes.DEFAULT;var canvas=this.getCanvas();var _this$_listeners=this._listeners,startZoom=_this$_listeners.startZoom,moveZoom=_this$_listeners.moveZoom,stopZoom=_this$_listeners.stopZoom;canvas.selection=true;canvas.defaultCursor='auto';canvas.off({'mouse:down':startZoom,'mouse:move':moveZoom,'mouse:up':stopZoom});this._changeObjectsEventedState(true);canvas.remove(this.zoomArea);this.zoomArea=null;}},{key:"start",value:function start(){this.zoomArea=null;this._startPoint=null;this._startHandPoint=null;}},{key:"end",value:function end(){this.endZoomInMode();this.endHandMode();}},{key:"startHandMode",value:function startHandMode(){this.endZoomInMode();this.zoomMode=zoomModes.HAND;var canvas=this.getCanvas();this._changeObjectsEventedState(false);canvas.discardActiveObject();canvas.off('mouse:down',this._listeners.startHand);canvas.on('mouse:down',this._listeners.startHand);canvas.selection=false;canvas.defaultCursor='grab';canvas.fire(HAND_STARTED);}},{key:"endHandMode",value:function endHandMode(){this.zoomMode=zoomModes.DEFAULT;var canvas=this.getCanvas();this._changeObjectsEventedState(true);canvas.off('mouse:down',this._listeners.startHand);canvas.selection=true;canvas.defaultCursor='auto';this._startHandPoint=null;canvas.fire(HAND_STOPPED);}},{key:"_onMouseDownWithZoomMode",value:function _onMouseDownWithZoomMode(_ref){var target=_ref.target,e=_ref.e;if(target){return;}
var canvas=this.getCanvas();canvas.selection=false;this._startPoint=canvas.getPointer(e);this.zoomArea.set({width:0,height:0});var _this$_listeners2=this._listeners,moveZoom=_this$_listeners2.moveZoom,stopZoom=_this$_listeners2.stopZoom;canvas.on({'mouse:move':moveZoom,'mouse:up':stopZoom});}},{key:"_onMouseMoveWithZoomMode",value:function _onMouseMoveWithZoomMode(_ref2){var e=_ref2.e;var canvas=this.getCanvas();var pointer=canvas.getPointer(e);var x=pointer.x,y=pointer.y;var zoomArea=this.zoomArea,_startPoint=this._startPoint;var deltaX=Math.abs(x-_startPoint.x);var deltaY=Math.abs(y-_startPoint.y);if(deltaX+deltaY>zoom_MOUSE_MOVE_THRESHOLD){canvas.remove(zoomArea);zoomArea.set(this._calcRectDimensionFromPoint(x,y));canvas.add(zoomArea);}}},{key:"_calcRectDimensionFromPoint",value:function _calcRectDimensionFromPoint(x,y){var canvas=this.getCanvas();var canvasWidth=canvas.getWidth();var canvasHeight=canvas.getHeight();var _this$_startPoint=this._startPoint,startX=_this$_startPoint.x,startY=_this$_startPoint.y;var min=Math.min;var left=min(startX,x);var top=min(startY,y);var width=clamp(x,startX,canvasWidth)-left;var height=clamp(y,startY,canvasHeight)-top;return{left:left,top:top,width:width,height:height};}},{key:"_onMouseUpWithZoomMode",value:function _onMouseUpWithZoomMode(){var zoomLevel=this.zoomLevel;var zoomArea=this.zoomArea;var _this$_listeners3=this._listeners,moveZoom=_this$_listeners3.moveZoom,stopZoom=_this$_listeners3.stopZoom;var canvas=this.getCanvas();var center=this._getCenterPoint();var x=center.x,y=center.y;if(!this._isMaxZoomLevel()){this._centerPoints.push({x:x,y:y,prevZoomLevel:zoomLevel,zoomLevel:zoomLevel+1});zoomLevel+=1;canvas.zoomToPoint({x:x,y:y},zoomLevel);this._fireZoomChanged(canvas,zoomLevel);this.zoomLevel=zoomLevel;}
canvas.off({'mouse:move':moveZoom,'mouse:up':stopZoom});canvas.remove(zoomArea);this._startPoint=null;}},{key:"_getCenterPoint",value:function _getCenterPoint(){var _this$zoomArea=this.zoomArea,left=_this$zoomArea.left,top=_this$zoomArea.top,width=_this$zoomArea.width,height=_this$zoomArea.height;var _this$_startPoint2=this._startPoint,x=_this$_startPoint2.x,y=_this$_startPoint2.y;var aspectRatio=this.aspectRatio;if(width<zoom_MOUSE_MOVE_THRESHOLD&&height<zoom_MOUSE_MOVE_THRESHOLD){return{x:x,y:y};}
return width>height?{x:left+aspectRatio*height/2,y:top+height/2}:{x:left+width/2,y:top+width/aspectRatio/2};}},{key:"zoom",value:function zoom(_ref3){var x=_ref3.x,y=_ref3.y;var zoomLevel=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.zoomLevel;var canvas=this.getCanvas();var centerPoints=this._centerPoints;for(var i=centerPoints.length-1;i>=0;i-=1){if(centerPoints[i].zoomLevel<zoomLevel){break;}
var _centerPoints$pop=centerPoints.pop(),prevX=_centerPoints$pop.x,prevY=_centerPoints$pop.y,prevZoomLevel=_centerPoints$pop.prevZoomLevel;canvas.zoomToPoint({x:prevX,y:prevY},prevZoomLevel);this.zoomLevel=prevZoomLevel;}
canvas.zoomToPoint({x:x,y:y},zoomLevel);if(!this._isDefaultZoomLevel(zoomLevel)){this._centerPoints.push({x:x,y:y,zoomLevel:zoomLevel,prevZoomLevel:this.zoomLevel});}
this.zoomLevel=zoomLevel;this._fireZoomChanged(canvas,zoomLevel);}},{key:"zoomOut",value:function zoomOut(){var centerPoints=this._centerPoints;if(!centerPoints.length){return;}
var canvas=this.getCanvas();var point=centerPoints.pop();var x=point.x,y=point.y,prevZoomLevel=point.prevZoomLevel;if(this._isDefaultZoomLevel(prevZoomLevel)){canvas.setViewportTransform([1,0,0,1,0,0]);}else{canvas.zoomToPoint({x:x,y:y},prevZoomLevel);}
this.zoomLevel=prevZoomLevel;this._fireZoomChanged(canvas,this.zoomLevel);}},{key:"resetZoom",value:function resetZoom(){var canvas=this.getCanvas();canvas.setViewportTransform([1,0,0,1,0,0]);this.zoomLevel=DEFAULT_ZOOM_LEVEL;this._centerPoints=[];this._fireZoomChanged(canvas,this.zoomLevel);}},{key:"_isMaxZoomLevel",value:function _isMaxZoomLevel(){return this.zoomLevel>=5.0;}},{key:"_movePointOfZoom",value:function _movePointOfZoom(_ref4){var deltaX=_ref4.x,deltaY=_ref4.y;var centerPoints=this._centerPoints;if(!centerPoints.length){return;}
var canvas=this.getCanvas();var zoomLevel=this.zoomLevel;var point=centerPoints.pop();var originX=point.x,originY=point.y,prevZoomLevel=point.prevZoomLevel;var x=originX-deltaX;var y=originY-deltaY;canvas.zoomToPoint({x:originX,y:originY},prevZoomLevel);canvas.zoomToPoint({x:x,y:y},zoomLevel);centerPoints.push({x:x,y:y,prevZoomLevel:prevZoomLevel,zoomLevel:zoomLevel});this._fireZoomChanged(canvas,zoomLevel);}},{key:"_onMouseDownWithHandMode",value:function _onMouseDownWithHandMode(_ref5){var target=_ref5.target,e=_ref5.e;if(target){return;}
var canvas=this.getCanvas();if(this.zoomLevel<=DEFAULT_ZOOM_LEVEL){return;}
canvas.selection=false;this._startHandPoint=canvas.getPointer(e);var _this$_listeners4=this._listeners,moveHand=_this$_listeners4.moveHand,stopHand=_this$_listeners4.stopHand;canvas.on({'mouse:move':moveHand,'mouse:up':stopHand});}},{key:"_onMouseMoveWithHandMode",value:function _onMouseMoveWithHandMode(_ref6){var e=_ref6.e;var canvas=this.getCanvas();var _canvas$getPointer=canvas.getPointer(e),x=_canvas$getPointer.x,y=_canvas$getPointer.y;var deltaX=x-this._startHandPoint.x;var deltaY=y-this._startHandPoint.y;this._movePointOfZoom({x:deltaX,y:deltaY});}},{key:"_onMouseUpWithHandMode",value:function _onMouseUpWithHandMode(){var canvas=this.getCanvas();var _this$_listeners5=this._listeners,moveHand=_this$_listeners5.moveHand,stopHand=_this$_listeners5.stopHand;canvas.off({'mouse:move':moveHand,'mouse:up':stopHand});this._startHandPoint=null;}},{key:"_changeScrollState",value:function _changeScrollState(_ref7){var viewport=_ref7.viewport,zoomLevel=_ref7.zoomLevel;var canvas=this.getCanvas();canvas.remove(this._verticalScroll);canvas.remove(this._horizontalScroll);if(this._isDefaultZoomLevel(zoomLevel)){return;}
var canvasWidth=canvas.width;var canvasHeight=canvas.height;var tl=viewport.tl,tr=viewport.tr,bl=viewport.bl;var viewportWidth=tr.x-tl.x;var viewportHeight=bl.y-tl.y;var horizontalScrollWidth=viewportWidth*viewportWidth/canvasWidth;var horizontalScrollHeight=viewportHeight*DEFAULT_HORIZONTAL_SCROLL_RATIO.SIZE;var horizontalScrollLeft=clamp(tl.x+tl.x/canvasWidth*viewportWidth,tl.x,tr.x-horizontalScrollWidth);var horizontalScrollMargin=viewportHeight*DEFAULT_HORIZONTAL_SCROLL_RATIO.MARGIN;var horizontalScrollBorderRadius=viewportHeight*DEFAULT_HORIZONTAL_SCROLL_RATIO.BORDER_RADIUS;this._horizontalScroll.set({left:horizontalScrollLeft,top:bl.y-horizontalScrollHeight-horizontalScrollMargin,width:horizontalScrollWidth,height:horizontalScrollHeight,rx:horizontalScrollBorderRadius,ry:horizontalScrollBorderRadius});var verticalScrollWidth=viewportWidth*DEFAULT_VERTICAL_SCROLL_RATIO.SIZE;var verticalScrollHeight=viewportHeight*viewportHeight/canvasHeight;var verticalScrollTop=clamp(tl.y+tl.y/canvasHeight*viewportHeight,tr.y,bl.y-verticalScrollHeight);var verticalScrollMargin=viewportWidth*DEFAULT_VERTICAL_SCROLL_RATIO.MARGIN;var verticalScrollBorderRadius=viewportWidth*DEFAULT_VERTICAL_SCROLL_RATIO.BORDER_RADIUS;this._verticalScroll.set({left:tr.x-verticalScrollWidth-verticalScrollMargin,top:verticalScrollTop,width:verticalScrollWidth,height:verticalScrollHeight,rx:verticalScrollBorderRadius,ry:verticalScrollBorderRadius});this._addScrollBar();}},{key:"_changeObjectsEventedState",value:function _changeObjectsEventedState(){var evented=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var canvas=this.getCanvas();canvas.forEachObject(function(obj){obj.evented=evented;});}},{key:"_addScrollBar",value:function _addScrollBar(){var _this2=this;var canvas=this.getCanvas();canvas.add(this._horizontalScroll);canvas.add(this._verticalScroll);if(this.scrollBarTid){clearTimeout(this.scrollBarTid);}
this.scrollBarTid=set_timeout_default()(function(){canvas.remove(_this2._horizontalScroll);canvas.remove(_this2._verticalScroll);},3000);}},{key:"_isDefaultZoomLevel",value:function _isDefaultZoomLevel(zoomLevel){return zoomLevel===DEFAULT_ZOOM_LEVEL;}},{key:"_fireZoomChanged",value:function _fireZoomChanged(canvas,zoomLevel){canvas.fire(ZOOM_CHANGED,{viewport:canvas.calcViewportBoundaries(),zoomLevel:zoomLevel});}},{key:"mode",get:function get(){return this.zoomMode;}}]);return Zoom;}(component);var zoom=(Zoom);;var drawingMode_createMessage=errorMessage.create;var drawingMode_errorTypes=errorMessage.types;var DrawingMode=function(){function DrawingMode(name){_classCallCheck(this,DrawingMode);this.name=name;}
_createClass(DrawingMode,[{key:"getName",value:function getName(){return this.name;}},{key:"start",value:function start(){throw new Error(drawingMode_createMessage(drawingMode_errorTypes.UN_IMPLEMENTATION,'start'));}},{key:"end",value:function end(){throw new Error(drawingMode_createMessage(drawingMode_errorTypes.UN_IMPLEMENTATION,'stop'));}}]);return DrawingMode;}();var drawingMode=(DrawingMode);;function drawingMode_cropper_createSuper(Derived){var hasNativeReflectConstruct=drawingMode_cropper_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function drawingMode_cropper_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var CropperDrawingMode=function(_DrawingMode){_inherits(CropperDrawingMode,_DrawingMode);var _super=drawingMode_cropper_createSuper(CropperDrawingMode);function CropperDrawingMode(){_classCallCheck(this,CropperDrawingMode);return _super.call(this,drawingModes.CROPPER);}
_createClass(CropperDrawingMode,[{key:"start",value:function start(graphics){var cropper=graphics.getComponent(componentNames.CROPPER);cropper.start();}},{key:"end",value:function end(graphics){var cropper=graphics.getComponent(componentNames.CROPPER);cropper.end();}}]);return CropperDrawingMode;}(drawingMode);var drawingMode_cropper=(CropperDrawingMode);;function drawingMode_freeDrawing_createSuper(Derived){var hasNativeReflectConstruct=drawingMode_freeDrawing_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function drawingMode_freeDrawing_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var FreeDrawingMode=function(_DrawingMode){_inherits(FreeDrawingMode,_DrawingMode);var _super=drawingMode_freeDrawing_createSuper(FreeDrawingMode);function FreeDrawingMode(){_classCallCheck(this,FreeDrawingMode);return _super.call(this,drawingModes.FREE_DRAWING);}
_createClass(FreeDrawingMode,[{key:"start",value:function start(graphics,options){var freeDrawing=graphics.getComponent(componentNames.FREE_DRAWING);freeDrawing.start(options);}},{key:"end",value:function end(graphics){var freeDrawing=graphics.getComponent(componentNames.FREE_DRAWING);freeDrawing.end();}}]);return FreeDrawingMode;}(drawingMode);var drawingMode_freeDrawing=(FreeDrawingMode);;function lineDrawing_createSuper(Derived){var hasNativeReflectConstruct=lineDrawing_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function lineDrawing_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var LineDrawingMode=function(_DrawingMode){_inherits(LineDrawingMode,_DrawingMode);var _super=lineDrawing_createSuper(LineDrawingMode);function LineDrawingMode(){_classCallCheck(this,LineDrawingMode);return _super.call(this,drawingModes.LINE_DRAWING);}
_createClass(LineDrawingMode,[{key:"start",value:function start(graphics,options){var lineDrawing=graphics.getComponent(componentNames.LINE);lineDrawing.start(options);}},{key:"end",value:function end(graphics){var lineDrawing=graphics.getComponent(componentNames.LINE);lineDrawing.end();}}]);return LineDrawingMode;}(drawingMode);var lineDrawing=(LineDrawingMode);;function drawingMode_shape_createSuper(Derived){var hasNativeReflectConstruct=drawingMode_shape_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function drawingMode_shape_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var ShapeDrawingMode=function(_DrawingMode){_inherits(ShapeDrawingMode,_DrawingMode);var _super=drawingMode_shape_createSuper(ShapeDrawingMode);function ShapeDrawingMode(){_classCallCheck(this,ShapeDrawingMode);return _super.call(this,drawingModes.SHAPE);}
_createClass(ShapeDrawingMode,[{key:"start",value:function start(graphics){var shape=graphics.getComponent(componentNames.SHAPE);shape.start();}},{key:"end",value:function end(graphics){var shape=graphics.getComponent(componentNames.SHAPE);shape.end();}}]);return ShapeDrawingMode;}(drawingMode);var drawingMode_shape=(ShapeDrawingMode);;function drawingMode_text_createSuper(Derived){var hasNativeReflectConstruct=drawingMode_text_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function drawingMode_text_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var TextDrawingMode=function(_DrawingMode){_inherits(TextDrawingMode,_DrawingMode);var _super=drawingMode_text_createSuper(TextDrawingMode);function TextDrawingMode(){_classCallCheck(this,TextDrawingMode);return _super.call(this,drawingModes.TEXT);}
_createClass(TextDrawingMode,[{key:"start",value:function start(graphics){var text=graphics.getComponent(componentNames.TEXT);text.start();}},{key:"end",value:function end(graphics){var text=graphics.getComponent(componentNames.TEXT);text.end();}}]);return TextDrawingMode;}(drawingMode);var drawingMode_text=(TextDrawingMode);;function drawingMode_icon_createSuper(Derived){var hasNativeReflectConstruct=drawingMode_icon_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function drawingMode_icon_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var IconDrawingMode=function(_DrawingMode){_inherits(IconDrawingMode,_DrawingMode);var _super=drawingMode_icon_createSuper(IconDrawingMode);function IconDrawingMode(){_classCallCheck(this,IconDrawingMode);return _super.call(this,drawingModes.ICON);}
_createClass(IconDrawingMode,[{key:"start",value:function start(graphics){var icon=graphics.getComponent(componentNames.ICON);icon.start();}},{key:"end",value:function end(graphics){var icon=graphics.getComponent(componentNames.ICON);icon.end();}}]);return IconDrawingMode;}(drawingMode);var drawingMode_icon=(IconDrawingMode);;function drawingMode_zoom_createSuper(Derived){var hasNativeReflectConstruct=drawingMode_zoom_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function drawingMode_zoom_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var ZoomDrawingMode=function(_DrawingMode){_inherits(ZoomDrawingMode,_DrawingMode);var _super=drawingMode_zoom_createSuper(ZoomDrawingMode);function ZoomDrawingMode(){_classCallCheck(this,ZoomDrawingMode);return _super.call(this,drawingModes.ZOOM);}
_createClass(ZoomDrawingMode,[{key:"start",value:function start(graphics){var zoom=graphics.getComponent(componentNames.ZOOM);zoom.start();}},{key:"end",value:function end(graphics){var zoom=graphics.getComponent(componentNames.ZOOM);zoom.end();}}]);return ZoomDrawingMode;}(drawingMode);var drawingMode_zoom=(ZoomDrawingMode);;var cachedUndoDataForChangeDimension=null;function setCachedUndoDataForDimension(undoData){cachedUndoDataForChangeDimension=undoData;}
function getCachedUndoDataForDimension(){return cachedUndoDataForChangeDimension;}
function makeSelectionUndoData(obj,undoDatumMaker){var undoData;if(obj.type==='activeSelection'){var _context;undoData=map_default()(_context=obj.getObjects()).call(_context,function(item){var angle=item.angle,left=item.left,top=item.top,scaleX=item.scaleX,scaleY=item.scaleY,width=item.width,height=item.height;fabric.fabric.util.addTransformToObject(item,obj.calcTransformMatrix());var result=undoDatumMaker(item);item.set({angle:angle,left:left,top:top,width:width,height:height,scaleX:scaleX,scaleY:scaleY});return result;});}else{undoData=[undoDatumMaker(obj)];}
return undoData;}
function makeSelectionUndoDatum(id,obj,isSelection){return isSelection?{id:id,width:obj.width,height:obj.height,top:obj.top,left:obj.left,angle:obj.angle,scaleX:obj.scaleX,scaleY:obj.scaleY}:extend_default()({id:id},obj);};function component_resize_createSuper(Derived){var hasNativeReflectConstruct=component_resize_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function component_resize_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var resize_Resize=function(_Component){_inherits(Resize,_Component);var _super=component_resize_createSuper(Resize);function Resize(graphics){var _this;_classCallCheck(this,Resize);_this=_super.call(this,componentNames.RESIZE,graphics);_this._dimensions=null;_this._originalDimensions=null;return _this;}
_createClass(Resize,[{key:"getCurrentDimensions",value:function getCurrentDimensions(){var canvasImage=this.getCanvasImage();if(!this._dimensions&&canvasImage){var width=canvasImage.width,height=canvasImage.height;this._dimensions={width:width,height:height};}
return this._dimensions;}},{key:"getOriginalDimensions",value:function getOriginalDimensions(){return this._originalDimensions;}},{key:"setOriginalDimensions",value:function setOriginalDimensions(dimensions){this._originalDimensions=dimensions;}},{key:"resize",value:function resize(dimensions){var canvasImage=this.getCanvasImage();var width=canvasImage.width,height=canvasImage.height,scaleX=canvasImage.scaleX,scaleY=canvasImage.scaleY;var dimensionsWidth=dimensions.width,dimensionsHeight=dimensions.height;var scaleValues={scaleX:dimensionsWidth?dimensionsWidth/width:scaleX,scaleY:dimensionsHeight?dimensionsHeight/height:scaleY};if(scaleX!==scaleValues.scaleX||scaleY!==scaleValues.scaleY){canvasImage.set(scaleValues).setCoords();this._dimensions={width:canvasImage.width*canvasImage.scaleX,height:canvasImage.height*canvasImage.scaleY};}
this.adjustCanvasDimensionBase();return promise_default().resolve();}},{key:"start",value:function start(){var dimensions=this.getCurrentDimensions();this.setOriginalDimensions(dimensions);}},{key:"end",value:function end(){}}]);return Resize;}(component);var component_resize=(resize_Resize);;function drawingMode_resize_createSuper(Derived){var hasNativeReflectConstruct=drawingMode_resize_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=construct_default()(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}
function drawingMode_resize_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!(construct_default()))return false;if((construct_default()).sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(construct_default()(Boolean,[],function(){}));return true;}catch(e){return false;}}
var ResizeDrawingMode=function(_DrawingMode){_inherits(ResizeDrawingMode,_DrawingMode);var _super=drawingMode_resize_createSuper(ResizeDrawingMode);function ResizeDrawingMode(){_classCallCheck(this,ResizeDrawingMode);return _super.call(this,drawingModes.RESIZE);}
_createClass(ResizeDrawingMode,[{key:"start",value:function start(graphics){var resize=graphics.getComponent(componentNames.RESIZE);resize.start();}},{key:"end",value:function end(graphics){var resize=graphics.getComponent(componentNames.RESIZE);resize.end();}}]);return ResizeDrawingMode;}(drawingMode);var drawingMode_resize=(ResizeDrawingMode);;var DEFAULT_CSS_MAX_WIDTH=1000;var DEFAULT_CSS_MAX_HEIGHT=800;var EXTRA_PX_FOR_PASTE=10;var cssOnly={cssOnly:true};var backstoreOnly={backstoreOnly:true};var Graphics=function(){function Graphics(element){var _context,_context2,_context3,_context4,_context5,_context6,_context7,_context8,_context9,_context10,_context11;var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},cssMaxWidth=_ref.cssMaxWidth,cssMaxHeight=_ref.cssMaxHeight;_classCallCheck(this,Graphics);this.canvasImage=null;this.cssMaxWidth=cssMaxWidth||DEFAULT_CSS_MAX_WIDTH;this.cssMaxHeight=cssMaxHeight||DEFAULT_CSS_MAX_HEIGHT;this.cropSelectionStyle={};this.targetObjectForCopyPaste=null;this.imageName='';this._objects={};this._canvas=null;this._drawingMode=drawingModes.NORMAL;this._drawingModeMap={};this._componentMap={};this._handler={onMouseDown:bind_default()(_context=this._onMouseDown).call(_context,this),onObjectAdded:bind_default()(_context2=this._onObjectAdded).call(_context2,this),onObjectRemoved:bind_default()(_context3=this._onObjectRemoved).call(_context3,this),onObjectMoved:bind_default()(_context4=this._onObjectMoved).call(_context4,this),onObjectScaled:bind_default()(_context5=this._onObjectScaled).call(_context5,this),onObjectModified:bind_default()(_context6=this._onObjectModified).call(_context6,this),onObjectRotated:bind_default()(_context7=this._onObjectRotated).call(_context7,this),onObjectSelected:bind_default()(_context8=this._onObjectSelected).call(_context8,this),onPathCreated:bind_default()(_context9=this._onPathCreated).call(_context9,this),onSelectionCleared:bind_default()(_context10=this._onSelectionCleared).call(_context10,this),onSelectionCreated:bind_default()(_context11=this._onSelectionCreated).call(_context11,this)};this._setObjectCachingToFalse();this._setCanvasElement(element);this._createDrawingModeInstances();this._createComponents();this._attachCanvasEvents();this._attachZoomEvents();}
_createClass(Graphics,[{key:"destroy",value:function destroy(){var wrapperEl=this._canvas.wrapperEl;this._canvas.clear();wrapperEl.parentNode.removeChild(wrapperEl);this._detachZoomEvents();}},{key:"_attachZoomEvents",value:function _attachZoomEvents(){var zoom=this.getComponent(componentNames.ZOOM);zoom.attachKeyboardZoomEvents();}},{key:"_detachZoomEvents",value:function _detachZoomEvents(){var zoom=this.getComponent(componentNames.ZOOM);zoom.detachKeyboardZoomEvents();}},{key:"deactivateAll",value:function deactivateAll(){this._canvas.discardActiveObject();return this;}},{key:"renderAll",value:function renderAll(){this._canvas.renderAll();return this;}},{key:"add",value:function add(objects){var _this$_canvas;var theArgs=[];if(isArray_default()(objects)){theArgs=objects;}else{theArgs.push(objects);}
(_this$_canvas=this._canvas).add.apply(_this$_canvas,_toConsumableArray(theArgs));}},{key:"contains",value:function contains(target){return this._canvas.contains(target);}},{key:"getObjects",value:function getObjects(){var _context12;return slice_default()(_context12=this._canvas.getObjects()).call(_context12);}},{key:"getObject",value:function getObject(id){return this._objects[id];}},{key:"remove",value:function remove(target){this._canvas.remove(target);}},{key:"removeAll",value:function removeAll(includesBackground){var _context13;var canvas=this._canvas;var objects=slice_default()(_context13=canvas.getObjects()).call(_context13);canvas.remove.apply(canvas,_toConsumableArray(this._canvas.getObjects()));if(includesBackground){canvas.clear();}
return objects;}},{key:"removeObjectById",value:function removeObjectById(id){var objects=[];var canvas=this._canvas;var target=this.getObject(id);var isValidGroup=target&&target.isType('group')&&!target.isEmpty();if(isValidGroup){canvas.discardActiveObject();target.forEachObject(function(obj){objects.push(obj);canvas.remove(obj);});}else if(canvas.contains(target)){objects.push(target);canvas.remove(target);}
return objects;}},{key:"getObjectId",value:function getObjectId(object){var key=null;for(key in this._objects){if(this._objects.hasOwnProperty(key)){if(object===this._objects[key]){return key;}}}
return null;}},{key:"getActiveObject",value:function getActiveObject(){return this._canvas._activeObject;}},{key:"getActiveObjectIdForRemove",value:function getActiveObjectIdForRemove(){var activeObject=this.getActiveObject();var type=activeObject.type,left=activeObject.left,top=activeObject.top;var isSelection=type==='activeSelection';if(isSelection){var group=new fabric.fabric.Group(_toConsumableArray(activeObject.getObjects()),{left:left,top:top});return this._addFabricObject(group);}
return this.getObjectId(activeObject);}},{key:"isReadyRemoveObject",value:function isReadyRemoveObject(){var activeObject=this.getActiveObject();return activeObject&&!activeObject.isEditing;}},{key:"getActiveObjects",value:function getActiveObjects(){var activeObject=this._canvas._activeObject;return activeObject&&activeObject.type==='activeSelection'?activeObject:null;}},{key:"getActiveSelectionFromObjects",value:function getActiveSelectionFromObjects(objects){var canvas=this.getCanvas();return new fabric.fabric.ActiveSelection(objects,{canvas:canvas});}},{key:"setActiveObject",value:function setActiveObject(target){this._canvas.setActiveObject(target);}},{key:"setCropSelectionStyle",value:function setCropSelectionStyle(style){this.cropSelectionStyle=style;}},{key:"getComponent",value:function getComponent(name){return this._componentMap[name];}},{key:"getDrawingMode",value:function getDrawingMode(){return this._drawingMode;}},{key:"startDrawingMode",value:function startDrawingMode(mode,option){if(this._isSameDrawingMode(mode)){return true;}
this.stopDrawingMode();var drawingModeInstance=this._getDrawingModeInstance(mode);if(drawingModeInstance&&drawingModeInstance.start){drawingModeInstance.start(this,option);this._drawingMode=mode;}
return!!drawingModeInstance;}},{key:"stopDrawingMode",value:function stopDrawingMode(){if(this._isSameDrawingMode(drawingModes.NORMAL)){return;}
var drawingModeInstance=this._getDrawingModeInstance(this.getDrawingMode());if(drawingModeInstance&&drawingModeInstance.end){drawingModeInstance.end(this);}
this._drawingMode=drawingModes.NORMAL;}},{key:"zoom",value:function zoom(_ref2,zoomLevel){var x=_ref2.x,y=_ref2.y;var zoom=this.getComponent(componentNames.ZOOM);zoom.zoom({x:x,y:y},zoomLevel);}},{key:"getZoomMode",value:function getZoomMode(){var zoom=this.getComponent(componentNames.ZOOM);return zoom.mode;}},{key:"startZoomInMode",value:function startZoomInMode(){var zoom=this.getComponent(componentNames.ZOOM);zoom.startZoomInMode();}},{key:"endZoomInMode",value:function endZoomInMode(){var zoom=this.getComponent(componentNames.ZOOM);zoom.endZoomInMode();}},{key:"zoomOut",value:function zoomOut(){var zoom=this.getComponent(componentNames.ZOOM);zoom.zoomOut();}},{key:"startHandMode",value:function startHandMode(){var zoom=this.getComponent(componentNames.ZOOM);zoom.startHandMode();}},{key:"endHandMode",value:function endHandMode(){var zoom=this.getComponent(componentNames.ZOOM);zoom.endHandMode();}},{key:"resetZoom",value:function resetZoom(){var zoom=this.getComponent(componentNames.ZOOM);zoom.resetZoom();}},{key:"toDataURL",value:function toDataURL(options){var cropper=this.getComponent(componentNames.CROPPER);cropper.changeVisibility(false);var dataUrl=this._canvas&&this._canvas.toDataURL(options);cropper.changeVisibility(true);return dataUrl;}},{key:"setCanvasImage",value:function setCanvasImage(name,canvasImage){if(canvasImage){stamp(canvasImage);}
this.imageName=name;this.canvasImage=canvasImage;}},{key:"setCssMaxDimension",value:function setCssMaxDimension(maxDimension){this.cssMaxWidth=maxDimension.width||this.cssMaxWidth;this.cssMaxHeight=maxDimension.height||this.cssMaxHeight;}},{key:"adjustCanvasDimension",value:function adjustCanvasDimension(){this.adjustCanvasDimensionBase(this.canvasImage.scale(1));}},{key:"adjustCanvasDimensionBase",value:function adjustCanvasDimensionBase(){var canvasImage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!canvasImage){canvasImage=this.canvasImage;}
var _canvasImage$getBound=canvasImage.getBoundingRect(),width=_canvasImage$getBound.width,height=_canvasImage$getBound.height;var maxDimension=this._calcMaxDimension(width,height);this.setCanvasCssDimension({width:'100%',height:'100%','max-width':"".concat(maxDimension.width,"px"),'max-height':"".concat(maxDimension.height,"px")});this.setCanvasBackstoreDimension({width:width,height:height});this._canvas.centerObject(canvasImage);}},{key:"setCanvasCssDimension",value:function setCanvasCssDimension(dimension){this._canvas.setDimensions(dimension,cssOnly);}},{key:"setCanvasBackstoreDimension",value:function setCanvasBackstoreDimension(dimension){this._canvas.setDimensions(dimension,backstoreOnly);}},{key:"setImageProperties",value:function setImageProperties(setting,withRendering){var canvasImage=this.canvasImage;if(!canvasImage){return;}
canvasImage.set(setting).setCoords();if(withRendering){this._canvas.renderAll();}}},{key:"getCanvasElement",value:function getCanvasElement(){return this._canvas.getElement();}},{key:"getCanvas",value:function getCanvas(){return this._canvas;}},{key:"getCanvasImage",value:function getCanvasImage(){return this.canvasImage;}},{key:"getImageName",value:function getImageName(){return this.imageName;}},{key:"addImageObject",value:function addImageObject(imgUrl){var _context14,_this=this;var callback=bind_default()(_context14=this._callbackAfterLoadingImageObject).call(_context14,this);return new(promise_default())(function(resolve){fabric.fabric.Image.fromURL(imgUrl,function(image){callback(image);resolve(_this.createObjectProperties(image));},{crossOrigin:'Anonymous'});});}},{key:"getCenter",value:function getCenter(){return this._canvas.getCenter();}},{key:"getCropzoneRect",value:function getCropzoneRect(){return this.getComponent(componentNames.CROPPER).getCropzoneRect();}},{key:"setCropzoneRect",value:function setCropzoneRect(mode){this.getComponent(componentNames.CROPPER).setCropzoneRect(mode);}},{key:"getCroppedImageData",value:function getCroppedImageData(cropRect){return this.getComponent(componentNames.CROPPER).getCroppedImageData(cropRect);}},{key:"setBrush",value:function setBrush(option){var drawingMode=this._drawingMode;var compName=componentNames.FREE_DRAWING;if(drawingMode===drawingModes.LINE_DRAWING){compName=componentNames.LINE;}
this.getComponent(compName).setBrush(option);}},{key:"setDrawingShape",value:function setDrawingShape(type,options){this.getComponent(componentNames.SHAPE).setStates(type,options);}},{key:"setIconStyle",value:function setIconStyle(type,iconColor){this.getComponent(componentNames.ICON).setStates(type,iconColor);}},{key:"registerPaths",value:function registerPaths(pathInfos){this.getComponent(componentNames.ICON).registerPaths(pathInfos);}},{key:"changeCursor",value:function changeCursor(cursorType){var canvas=this.getCanvas();canvas.defaultCursor=cursorType;canvas.renderAll();}},{key:"hasFilter",value:function hasFilter(type){return this.getComponent(componentNames.FILTER).hasFilter(type);}},{key:"setSelectionStyle",value:function setSelectionStyle(styles){extend_default()(fObjectOptions.SELECTION_STYLE,styles);}},{key:"setObjectProperties",value:function setObjectProperties(id,props){var object=this.getObject(id);var clone=extend_default()({},props);object.set(clone);object.setCoords();this.getCanvas().renderAll();return clone;}},{key:"getObjectProperties",value:function getObjectProperties(id,keys){var object=this.getObject(id);var props={};if(isString_default()(keys)){props[keys]=object[keys];}else if(isArray_default()(keys)){forEachArray_default()(keys,function(value){props[value]=object[value];});}else{forEachOwnProperties_default()(keys,function(value,key){props[key]=object[key];});}
return props;}},{key:"getObjectPosition",value:function getObjectPosition(id,originX,originY){var targetObj=this.getObject(id);if(!targetObj){return null;}
return targetObj.getPointByOrigin(originX,originY);}},{key:"setObjectPosition",value:function setObjectPosition(id,posInfo){var targetObj=this.getObject(id);var x=posInfo.x,y=posInfo.y,originX=posInfo.originX,originY=posInfo.originY;if(!targetObj){return false;}
var targetOrigin=targetObj.getPointByOrigin(originX,originY);var centerOrigin=targetObj.getPointByOrigin('center','center');var diffX=centerOrigin.x-targetOrigin.x;var diffY=centerOrigin.y-targetOrigin.y;targetObj.set({left:x+diffX,top:y+diffY});targetObj.setCoords();return true;}},{key:"getCanvasSize",value:function getCanvasSize(){var image=this.getCanvasImage();return{width:image?image.width:0,height:image?image.height:0};}},{key:"createStaticCanvas",value:function createStaticCanvas(){var staticCanvas=new fabric.fabric.StaticCanvas();staticCanvas.set({enableRetinaScaling:false});return staticCanvas;}},{key:"_getDrawingModeInstance",value:function _getDrawingModeInstance(modeName){return this._drawingModeMap[modeName];}},{key:"_setObjectCachingToFalse",value:function _setObjectCachingToFalse(){fabric.fabric.Object.prototype.objectCaching=false;}},{key:"_setCanvasElement",value:function _setCanvasElement(element){var selectedElement;var canvasElement;if(element.nodeType){selectedElement=element;}else{selectedElement=document.querySelector(element);}
if(selectedElement.nodeName.toUpperCase()!=='CANVAS'){canvasElement=document.createElement('canvas');selectedElement.appendChild(canvasElement);}
this._canvas=new fabric.fabric.Canvas(canvasElement,{containerClass:'tui-image-editor-canvas-container',enableRetinaScaling:false});}},{key:"_createDrawingModeInstances",value:function _createDrawingModeInstances(){this._register(this._drawingModeMap,new drawingMode_cropper());this._register(this._drawingModeMap,new drawingMode_freeDrawing());this._register(this._drawingModeMap,new lineDrawing());this._register(this._drawingModeMap,new drawingMode_shape());this._register(this._drawingModeMap,new drawingMode_text());this._register(this._drawingModeMap,new drawingMode_icon());this._register(this._drawingModeMap,new drawingMode_zoom());this._register(this._drawingModeMap,new drawingMode_resize());}},{key:"_createComponents",value:function _createComponents(){this._register(this._componentMap,new imageLoader(this));this._register(this._componentMap,new cropper(this));this._register(this._componentMap,new component_flip(this));this._register(this._componentMap,new rotation(this));this._register(this._componentMap,new freeDrawing(this));this._register(this._componentMap,new line(this));this._register(this._componentMap,new component_text(this));this._register(this._componentMap,new component_icon(this));this._register(this._componentMap,new component_filter(this));this._register(this._componentMap,new shape_Shape(this));this._register(this._componentMap,new zoom(this));this._register(this._componentMap,new component_resize(this));}},{key:"_register",value:function _register(map,module){map[module.getName()]=module;}},{key:"_isSameDrawingMode",value:function _isSameDrawingMode(mode){return this.getDrawingMode()===mode;}},{key:"_calcMaxDimension",value:function _calcMaxDimension(width,height){var wScaleFactor=this.cssMaxWidth/width;var hScaleFactor=this.cssMaxHeight/height;var cssMaxWidth=Math.min(width,this.cssMaxWidth);var cssMaxHeight=Math.min(height,this.cssMaxHeight);if(wScaleFactor<1&&wScaleFactor<hScaleFactor){cssMaxWidth=width*wScaleFactor;cssMaxHeight=height*wScaleFactor;}else if(hScaleFactor<1&&hScaleFactor<wScaleFactor){cssMaxWidth=width*hScaleFactor;cssMaxHeight=height*hScaleFactor;}
return{width:Math.floor(cssMaxWidth),height:Math.floor(cssMaxHeight)};}},{key:"_callbackAfterLoadingImageObject",value:function _callbackAfterLoadingImageObject(obj){var centerPos=this.getCanvasImage().getCenterPoint();obj.set(fObjectOptions.SELECTION_STYLE);obj.set({left:centerPos.x,top:centerPos.y,crossOrigin:'Anonymous'});this.getCanvas().add(obj).setActiveObject(obj);}},{key:"_attachCanvasEvents",value:function _attachCanvasEvents(){var canvas=this._canvas;var handler=this._handler;canvas.on({'mouse:down':handler.onMouseDown,'object:added':handler.onObjectAdded,'object:removed':handler.onObjectRemoved,'object:moving':handler.onObjectMoved,'object:scaling':handler.onObjectScaled,'object:modified':handler.onObjectModified,'object:rotating':handler.onObjectRotated,'path:created':handler.onPathCreated,'selection:cleared':handler.onSelectionCleared,'selection:created':handler.onSelectionCreated,'selection:updated':handler.onObjectSelected});}},{key:"_onMouseDown",value:function _onMouseDown(fEvent){var _this2=this;var event=fEvent.e,target=fEvent.target;var originPointer=this._canvas.getPointer(event);if(target){var type=target.type;var undoData=makeSelectionUndoData(target,function(item){return makeSelectionUndoDatum(_this2.getObjectId(item),item,type==='activeSelection');});setCachedUndoDataForDimension(undoData);}
this.fire(eventNames.MOUSE_DOWN,event,originPointer);}},{key:"_onObjectAdded",value:function _onObjectAdded(fEvent){var obj=fEvent.target;if(obj.isType('cropzone')){return;}
this._addFabricObject(obj);}},{key:"_onObjectRemoved",value:function _onObjectRemoved(fEvent){var obj=fEvent.target;this._removeFabricObject(stamp(obj));}},{key:"_onObjectMoved",value:function _onObjectMoved(fEvent){var _this3=this;this._lazyFire(eventNames.OBJECT_MOVED,function(object){return _this3.createObjectProperties(object);},fEvent.target);}},{key:"_onObjectScaled",value:function _onObjectScaled(fEvent){var _this4=this;this._lazyFire(eventNames.OBJECT_SCALED,function(object){return _this4.createObjectProperties(object);},fEvent.target);}},{key:"_onObjectModified",value:function _onObjectModified(fEvent){var target=fEvent.target;if(target.type==='activeSelection'){var items=target.getObjects();for_each_default()(items).call(items,function(item){return item.fire('modifiedInGroup',target);});}
this.fire(eventNames.OBJECT_MODIFIED,target,this.getObjectId(target));}},{key:"_onObjectRotated",value:function _onObjectRotated(fEvent){var _this5=this;this._lazyFire(eventNames.OBJECT_ROTATED,function(object){return _this5.createObjectProperties(object);},fEvent.target);}},{key:"_lazyFire",value:function _lazyFire(eventName,paramsMaker,target){var _this6=this;var existEventDelegation=target&&target.canvasEventDelegation;var delegationState=existEventDelegation?target.canvasEventDelegation(eventName):'none';if(delegationState==='unregistered'){target.canvasEventRegister(eventName,function(object){_this6.fire(eventName,paramsMaker(object));});}
if(delegationState==='none'){this.fire(eventName,paramsMaker(target));}}},{key:"_onObjectSelected",value:function _onObjectSelected(fEvent){var target=fEvent.target;var params=this.createObjectProperties(target);this.fire(eventNames.OBJECT_ACTIVATED,params);}},{key:"_onPathCreated",value:function _onPathCreated(obj){var _obj$path$getCenterPo=obj.path.getCenterPoint(),left=_obj$path$getCenterPo.x,top=_obj$path$getCenterPo.y;obj.path.set(extend_default()({left:left,top:top},fObjectOptions.SELECTION_STYLE));var params=this.createObjectProperties(obj.path);this.fire(eventNames.ADD_OBJECT,params);}},{key:"_onSelectionCleared",value:function _onSelectionCleared(){this.fire(eventNames.SELECTION_CLEARED);}},{key:"_onSelectionCreated",value:function _onSelectionCreated(fEvent){var target=fEvent.target;var params=this.createObjectProperties(target);this.fire(eventNames.OBJECT_ACTIVATED,params);this.fire(eventNames.SELECTION_CREATED,fEvent.target);}},{key:"discardSelection",value:function discardSelection(){this._canvas.discardActiveObject();this._canvas.renderAll();}},{key:"changeSelectableAll",value:function changeSelectableAll(selectable){this._canvas.forEachObject(function(obj){obj.selectable=selectable;obj.hoverCursor=selectable?'move':'crosshair';});}},{key:"createObjectProperties",value:function createObjectProperties(obj){var predefinedKeys=['left','top','width','height','fill','stroke','strokeWidth','opacity','angle'];var props={id:stamp(obj),type:obj.type};extend_default()(props,getProperties(obj,predefinedKeys));if(includes(['i-text','text'],obj.type)){extend_default()(props,this._createTextProperties(obj,props));}else if(includes(['rect','triangle','circle'],obj.type)){var shapeComp=this.getComponent(componentNames.SHAPE);extend_default()(props,{fill:shapeComp.makeFillPropertyForUserEvent(obj)});}
return props;}},{key:"_createTextProperties",value:function _createTextProperties(obj){var predefinedKeys=['text','fontFamily','fontSize','fontStyle','textAlign','textDecoration','fontWeight'];var props={};extend_default()(props,getProperties(obj,predefinedKeys));return props;}},{key:"_addFabricObject",value:function _addFabricObject(obj){var id=stamp(obj);this._objects[id]=obj;return id;}},{key:"_removeFabricObject",value:function _removeFabricObject(id){delete this._objects[id];}},{key:"resetTargetObjectForCopyPaste",value:function resetTargetObjectForCopyPaste(){var activeObject=this.getActiveObject();if(activeObject){this.targetObjectForCopyPaste=activeObject;}}},{key:"pasteObject",value:function pasteObject(){var _this7=this;if(!this.targetObjectForCopyPaste){return promise_default().resolve([]);}
var targetObject=this.targetObjectForCopyPaste;var isGroupSelect=targetObject.type==='activeSelection';var targetObjects=isGroupSelect?targetObject.getObjects():[targetObject];var newTargetObject=null;this.discardSelection();return this._cloneObject(targetObjects).then(function(addedObjects){if(addedObjects.length>1){newTargetObject=_this7.getActiveSelectionFromObjects(addedObjects);}else{var _addedObjects=_slicedToArray(addedObjects,1);newTargetObject=_addedObjects[0];}
_this7.targetObjectForCopyPaste=newTargetObject;_this7.setActiveObject(newTargetObject);});}},{key:"_cloneObject",value:function _cloneObject(targetObjects){var _this8=this;var addedObjects=map_default()(targetObjects).call(targetObjects,function(targetObject){return _this8._cloneObjectItem(targetObject);});return promise_default().all(addedObjects);}},{key:"_cloneObjectItem",value:function _cloneObjectItem(targetObject){var _this9=this;return this._copyFabricObjectForPaste(targetObject).then(function(clonedObject){var objectProperties=_this9.createObjectProperties(clonedObject);_this9.add(clonedObject);_this9.fire(eventNames.ADD_OBJECT,objectProperties);return clonedObject;});}},{key:"_copyFabricObjectForPaste",value:function _copyFabricObjectForPaste(targetObject){var _this10=this;var addExtraPx=function addExtraPx(value,isReverse){return isReverse?value-EXTRA_PX_FOR_PASTE:value+EXTRA_PX_FOR_PASTE;};return this._copyFabricObject(targetObject).then(function(clonedObject){var left=clonedObject.left,top=clonedObject.top,width=clonedObject.width,height=clonedObject.height;var _this10$getCanvasSize=_this10.getCanvasSize(),canvasWidth=_this10$getCanvasSize.width,canvasHeight=_this10$getCanvasSize.height;var rightEdge=left+width/2;var bottomEdge=top+height/2;clonedObject.set(extend_default()({left:addExtraPx(left,rightEdge+EXTRA_PX_FOR_PASTE>canvasWidth),top:addExtraPx(top,bottomEdge+EXTRA_PX_FOR_PASTE>canvasHeight)},fObjectOptions.SELECTION_STYLE));return clonedObject;});}},{key:"_copyFabricObject",value:function _copyFabricObject(targetObject){var _this11=this;return new(promise_default())(function(resolve){targetObject.clone(function(cloned){var shapeComp=_this11.getComponent(componentNames.SHAPE);if(isShape(cloned)){shapeComp.processForCopiedObject(cloned,targetObject);}
resolve(cloned);});});}},{key:"getCurrentDimensions",value:function getCurrentDimensions(){var resize=this.getComponent(componentNames.RESIZE);return resize.getCurrentDimensions();}},{key:"getOriginalDimensions",value:function getOriginalDimensions(){var resize=this.getComponent(componentNames.RESIZE);return resize.getOriginalDimensions();}},{key:"setOriginalDimensions",value:function setOriginalDimensions(dimensions){var resize=this.getComponent(componentNames.RESIZE);resize.setOriginalDimensions(dimensions);}},{key:"resize",value:function resize(dimensions){var resize=this.getComponent(componentNames.RESIZE);return resize.resize(dimensions);}}]);return Graphics;}();customEvents_default().mixin(Graphics);var graphics=(Graphics);;var MOUSE_DOWN=eventNames.MOUSE_DOWN,OBJECT_MOVED=eventNames.OBJECT_MOVED,OBJECT_SCALED=eventNames.OBJECT_SCALED,OBJECT_ACTIVATED=eventNames.OBJECT_ACTIVATED,OBJECT_ROTATED=eventNames.OBJECT_ROTATED,OBJECT_ADDED=eventNames.OBJECT_ADDED,imageEditor_OBJECT_MODIFIED=eventNames.OBJECT_MODIFIED,imageEditor_ADD_TEXT=eventNames.ADD_TEXT,ADD_OBJECT=eventNames.ADD_OBJECT,imageEditor_TEXT_EDITING=eventNames.TEXT_EDITING,TEXT_CHANGED=eventNames.TEXT_CHANGED,ICON_CREATE_RESIZE=eventNames.ICON_CREATE_RESIZE,ICON_CREATE_END=eventNames.ICON_CREATE_END,SELECTION_CLEARED=eventNames.SELECTION_CLEARED,SELECTION_CREATED=eventNames.SELECTION_CREATED,ADD_OBJECT_AFTER=eventNames.ADD_OBJECT_AFTER;var ImageEditor=function(){function ImageEditor(wrapper,options){var _context,_context2,_context3,_context4,_context5,_context6,_context7,_context8,_context9,_context10,_context11,_context12,_context13,_context14,_context15,_context16;_classCallCheck(this,ImageEditor);options=extend_default()({includeUI:false,usageStatistics:true},options);this.mode=null;this.activeObjectId=null;if(options.includeUI){var UIOption=options.includeUI;UIOption.usageStatistics=options.usageStatistics;this.ui=new ui(wrapper,UIOption,this.getActions());options=this.ui.setUiDefaultSelectionStyle(options);}
this._invoker=new invoker();this._graphics=new graphics(this.ui?this.ui.getEditorArea():wrapper,{cssMaxWidth:options.cssMaxWidth,cssMaxHeight:options.cssMaxHeight});this._handlers={keydown:bind_default()(_context=this._onKeyDown).call(_context,this),mousedown:bind_default()(_context2=this._onMouseDown).call(_context2,this),objectActivated:bind_default()(_context3=this._onObjectActivated).call(_context3,this),objectMoved:bind_default()(_context4=this._onObjectMoved).call(_context4,this),objectScaled:bind_default()(_context5=this._onObjectScaled).call(_context5,this),objectRotated:bind_default()(_context6=this._onObjectRotated).call(_context6,this),objectAdded:bind_default()(_context7=this._onObjectAdded).call(_context7,this),objectModified:bind_default()(_context8=this._onObjectModified).call(_context8,this),createdPath:this._onCreatedPath,addText:bind_default()(_context9=this._onAddText).call(_context9,this),addObject:bind_default()(_context10=this._onAddObject).call(_context10,this),textEditing:bind_default()(_context11=this._onTextEditing).call(_context11,this),textChanged:bind_default()(_context12=this._onTextChanged).call(_context12,this),iconCreateResize:bind_default()(_context13=this._onIconCreateResize).call(_context13,this),iconCreateEnd:bind_default()(_context14=this._onIconCreateEnd).call(_context14,this),selectionCleared:bind_default()(_context15=this._selectionCleared).call(_context15,this),selectionCreated:bind_default()(_context16=this._selectionCreated).call(_context16,this)};this._attachInvokerEvents();this._attachGraphicsEvents();this._attachDomEvents();this._setSelectionStyle(options.selectionStyle,{applyCropSelectionStyle:options.applyCropSelectionStyle,applyGroupSelectionStyle:options.applyGroupSelectionStyle});if(options.usageStatistics){sendHostName();}
if(this.ui){this.ui.initCanvas();this.setReAction();this._attachColorPickerInputBoxEvents();}
fabric.fabric.enableGLFiltering=false;}
_createClass(ImageEditor,[{key:"_attachColorPickerInputBoxEvents",value:function _attachColorPickerInputBoxEvents(){var _this=this;this.ui.on(eventNames.INPUT_BOX_EDITING_STARTED,function(){_this.isColorPickerInputBoxEditing=true;});this.ui.on(eventNames.INPUT_BOX_EDITING_STOPPED,function(){_this.isColorPickerInputBoxEditing=false;});}},{key:"_detachColorPickerInputBoxEvents",value:function _detachColorPickerInputBoxEvents(){this.ui.off(eventNames.INPUT_BOX_EDITING_STARTED);this.ui.off(eventNames.INPUT_BOX_EDITING_STOPPED);}},{key:"_setSelectionStyle",value:function _setSelectionStyle(selectionStyle,_ref){var applyCropSelectionStyle=_ref.applyCropSelectionStyle,applyGroupSelectionStyle=_ref.applyGroupSelectionStyle;if(selectionStyle){this._graphics.setSelectionStyle(selectionStyle);}
if(applyCropSelectionStyle){this._graphics.setCropSelectionStyle(selectionStyle);}
if(applyGroupSelectionStyle){this.on('selectionCreated',function(eventTarget){if(eventTarget.type==='activeSelection'){eventTarget.set(selectionStyle);}});}}},{key:"_attachInvokerEvents",value:function _attachInvokerEvents(){var _context17,_context18,_this2=this;var UNDO_STACK_CHANGED=eventNames.UNDO_STACK_CHANGED,REDO_STACK_CHANGED=eventNames.REDO_STACK_CHANGED,EXECUTE_COMMAND=eventNames.EXECUTE_COMMAND,AFTER_UNDO=eventNames.AFTER_UNDO,AFTER_REDO=eventNames.AFTER_REDO,HAND_STARTED=eventNames.HAND_STARTED,HAND_STOPPED=eventNames.HAND_STOPPED;this._invoker.on(UNDO_STACK_CHANGED,bind_default()(_context17=this.fire).call(_context17,this,UNDO_STACK_CHANGED));this._invoker.on(REDO_STACK_CHANGED,bind_default()(_context18=this.fire).call(_context18,this,REDO_STACK_CHANGED));if(this.ui){var canvas=this._graphics.getCanvas();this._invoker.on(EXECUTE_COMMAND,function(command){return _this2.ui.fire(EXECUTE_COMMAND,command);});this._invoker.on(AFTER_UNDO,function(command){return _this2.ui.fire(AFTER_UNDO,command);});this._invoker.on(AFTER_REDO,function(command){return _this2.ui.fire(AFTER_REDO,command);});canvas.on(HAND_STARTED,function(){return _this2.ui.fire(HAND_STARTED);});canvas.on(HAND_STOPPED,function(){return _this2.ui.fire(HAND_STOPPED);});}}},{key:"_attachGraphicsEvents",value:function _attachGraphicsEvents(){var _this$_graphics$on;this._graphics.on((_this$_graphics$on={},_defineProperty(_this$_graphics$on,MOUSE_DOWN,this._handlers.mousedown),_defineProperty(_this$_graphics$on,OBJECT_MOVED,this._handlers.objectMoved),_defineProperty(_this$_graphics$on,OBJECT_SCALED,this._handlers.objectScaled),_defineProperty(_this$_graphics$on,OBJECT_ROTATED,this._handlers.objectRotated),_defineProperty(_this$_graphics$on,OBJECT_ACTIVATED,this._handlers.objectActivated),_defineProperty(_this$_graphics$on,OBJECT_ADDED,this._handlers.objectAdded),_defineProperty(_this$_graphics$on,imageEditor_OBJECT_MODIFIED,this._handlers.objectModified),_defineProperty(_this$_graphics$on,imageEditor_ADD_TEXT,this._handlers.addText),_defineProperty(_this$_graphics$on,ADD_OBJECT,this._handlers.addObject),_defineProperty(_this$_graphics$on,imageEditor_TEXT_EDITING,this._handlers.textEditing),_defineProperty(_this$_graphics$on,TEXT_CHANGED,this._handlers.textChanged),_defineProperty(_this$_graphics$on,ICON_CREATE_RESIZE,this._handlers.iconCreateResize),_defineProperty(_this$_graphics$on,ICON_CREATE_END,this._handlers.iconCreateEnd),_defineProperty(_this$_graphics$on,SELECTION_CLEARED,this._handlers.selectionCleared),_defineProperty(_this$_graphics$on,SELECTION_CREATED,this._handlers.selectionCreated),_this$_graphics$on));}},{key:"_attachDomEvents",value:function _attachDomEvents(){document.addEventListener('keydown',this._handlers.keydown);}},{key:"_detachDomEvents",value:function _detachDomEvents(){document.removeEventListener('keydown',this._handlers.keydown);}},{key:"_onKeyDown",value:function _onKeyDown(e){var ctrlKey=e.ctrlKey,keyCode=e.keyCode,metaKey=e.metaKey;var isModifierKey=ctrlKey||metaKey;if(isModifierKey){if(keyCode===keyCodes.C){this._graphics.resetTargetObjectForCopyPaste();}else if(keyCode===keyCodes.V){this._graphics.pasteObject();this.clearRedoStack();}else if(keyCode===keyCodes.Z){this.undo()['catch'](function(){});}else if(keyCode===keyCodes.Y){this.redo()['catch'](function(){});}}
var isDeleteKey=keyCode===keyCodes.BACKSPACE||keyCode===keyCodes.DEL;var isRemoveReady=this._graphics.isReadyRemoveObject();if(!this.isColorPickerInputBoxEditing&&isRemoveReady&&isDeleteKey){e.preventDefault();this.removeActiveObject();}}},{key:"removeActiveObject",value:function removeActiveObject(){var activeObjectId=this._graphics.getActiveObjectIdForRemove();this.removeObject(activeObjectId);}},{key:"_onMouseDown",value:function _onMouseDown(event,originPointer){this.fire(eventNames.MOUSE_DOWN,event,originPointer);}},{key:"_pushAddObjectCommand",value:function _pushAddObjectCommand(obj){var command=factory_command.create(commandNames.ADD_OBJECT,this._graphics,obj);this._invoker.pushUndoStack(command);}},{key:"_pushModifyObjectCommand",value:function _pushModifyObjectCommand(obj){var _this3=this;var type=obj.type;var props=makeSelectionUndoData(obj,function(item){return makeSelectionUndoDatum(_this3._graphics.getObjectId(item),item,type==='activeSelection');});var command=factory_command.create(commandNames.CHANGE_SELECTION,this._graphics,props);command.execute(this._graphics,props);this._invoker.pushUndoStack(command);}},{key:"_onObjectActivated",value:function _onObjectActivated(props){this.fire(eventNames.OBJECT_ACTIVATED,props);}},{key:"_onObjectMoved",value:function _onObjectMoved(props){this.fire(eventNames.OBJECT_MOVED,props);}},{key:"_onObjectScaled",value:function _onObjectScaled(props){this.fire(eventNames.OBJECT_SCALED,props);}},{key:"_onObjectRotated",value:function _onObjectRotated(props){this.fire(eventNames.OBJECT_ROTATED,props);}},{key:"getDrawingMode",value:function getDrawingMode(){return this._graphics.getDrawingMode();}},{key:"clearObjects",value:function clearObjects(){return this.execute(commandNames.CLEAR_OBJECTS);}},{key:"deactivateAll",value:function deactivateAll(){this._graphics.deactivateAll();this._graphics.renderAll();}},{key:"discardSelection",value:function discardSelection(){this._graphics.discardSelection();}},{key:"changeSelectableAll",value:function changeSelectableAll(selectable){this._graphics.changeSelectableAll(selectable);}},{key:"_initHistory",value:function _initHistory(){if(this.ui){this.ui.initHistory();}}},{key:"_clearHistory",value:function _clearHistory(){if(this.ui){this.ui.clearHistory();}}},{key:"execute",value:function execute(commandName){var _context19,_this$_invoker,_context20;for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}
var theArgs=concat_default()(_context19=[this._graphics]).call(_context19,args);return(_this$_invoker=this._invoker).execute.apply(_this$_invoker,concat_default()(_context20=[commandName]).call(_context20,_toConsumableArray(theArgs)));}},{key:"executeSilent",value:function executeSilent(commandName){var _context21,_this$_invoker2,_context22;for(var _len2=arguments.length,args=new Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2];}
var theArgs=concat_default()(_context21=[this._graphics]).call(_context21,args);return(_this$_invoker2=this._invoker).executeSilent.apply(_this$_invoker2,concat_default()(_context22=[commandName]).call(_context22,_toConsumableArray(theArgs)));}},{key:"undo",value:function undo(){var _this4=this;var iterationCount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var promise=promise_default().resolve();for(var i=0;i<iterationCount;i+=1){promise=promise.then(function(){return _this4._invoker.undo();});}
return promise;}},{key:"redo",value:function redo(){var _this5=this;var iterationCount=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var promise=promise_default().resolve();for(var i=0;i<iterationCount;i+=1){promise=promise.then(function(){return _this5._invoker.redo();});}
return promise;}},{key:"zoom",value:function zoom(_ref2){var x=_ref2.x,y=_ref2.y,zoomLevel=_ref2.zoomLevel;this._graphics.zoom({x:x,y:y},zoomLevel);}},{key:"resetZoom",value:function resetZoom(){this._graphics.resetZoom();}},{key:"loadImageFromFile",value:function loadImageFromFile(imgFile,imageName){if(!imgFile){return promise_default().reject(rejectMessages.invalidParameters);}
var imgUrl=url_default().createObjectURL(imgFile);imageName=imageName||imgFile.name;return this.loadImageFromURL(imgUrl,imageName).then(function(value){url_default().revokeObjectURL(imgFile);return value;});}},{key:"loadImageFromURL",value:function loadImageFromURL(url,imageName){if(!imageName||!url){return promise_default().reject(rejectMessages.invalidParameters);}
return this.execute(commandNames.LOAD_IMAGE,imageName,url);}},{key:"addImageObject",value:function addImageObject(imgUrl){if(!imgUrl){return promise_default().reject(rejectMessages.invalidParameters);}
return this.execute(commandNames.ADD_IMAGE_OBJECT,imgUrl);}},{key:"startDrawingMode",value:function startDrawingMode(mode,option){return this._graphics.startDrawingMode(mode,option);}},{key:"stopDrawingMode",value:function stopDrawingMode(){this._graphics.stopDrawingMode();}},{key:"crop",value:function crop(rect){var data=this._graphics.getCroppedImageData(rect);if(!data){return promise_default().reject(rejectMessages.invalidParameters);}
return this.loadImageFromURL(data.url,data.imageName);}},{key:"getCropzoneRect",value:function getCropzoneRect(){return this._graphics.getCropzoneRect();}},{key:"setCropzoneRect",value:function setCropzoneRect(mode){this._graphics.setCropzoneRect(mode);}},{key:"_flip",value:function _flip(type){return this.execute(commandNames.FLIP_IMAGE,type);}},{key:"flipX",value:function flipX(){return this._flip('flipX');}},{key:"flipY",value:function flipY(){return this._flip('flipY');}},{key:"resetFlip",value:function resetFlip(){return this._flip('reset');}},{key:"_rotate",value:function _rotate(type,angle,isSilent){var result=null;if(isSilent){result=this.executeSilent(commandNames.ROTATE_IMAGE,type,angle);}else{result=this.execute(commandNames.ROTATE_IMAGE,type,angle);}
return result;}},{key:"rotate",value:function rotate(angle,isSilent){return this._rotate('rotate',angle,isSilent);}},{key:"setAngle",value:function setAngle(angle,isSilent){return this._rotate('setAngle',angle,isSilent);}},{key:"setBrush",value:function setBrush(option){this._graphics.setBrush(option);}},{key:"setDrawingShape",value:function setDrawingShape(type,options){this._graphics.setDrawingShape(type,options);}},{key:"setDrawingIcon",value:function setDrawingIcon(type,iconColor){this._graphics.setIconStyle(type,iconColor);}},{key:"addShape",value:function addShape(type,options){options=options||{};this._setPositions(options);return this.execute(commandNames.ADD_SHAPE,type,options);}},{key:"changeShape",value:function changeShape(id,options,isSilent){var executeMethodName=isSilent?'executeSilent':'execute';return this[executeMethodName](commandNames.CHANGE_SHAPE,id,options);}},{key:"addText",value:function addText(text,options){text=text||'';options=options||{};return this.execute(commandNames.ADD_TEXT,text,options);}},{key:"changeText",value:function changeText(id,text){text=text||'';return this.execute(commandNames.CHANGE_TEXT,id,text);}},{key:"changeTextStyle",value:function changeTextStyle(id,styleObj,isSilent){var executeMethodName=isSilent?'executeSilent':'execute';return this[executeMethodName](commandNames.CHANGE_TEXT_STYLE,id,styleObj);}},{key:"_changeActivateMode",value:function _changeActivateMode(type){if(type!=='ICON'&&this.getDrawingMode()!==type){this.startDrawingMode(type);}}},{key:"_onTextChanged",value:function _onTextChanged(target){this.fire(eventNames.TEXT_CHANGED,target);}},{key:"_onIconCreateResize",value:function _onIconCreateResize(originPointer){this.fire(eventNames.ICON_CREATE_RESIZE,originPointer);}},{key:"_onIconCreateEnd",value:function _onIconCreateEnd(originPointer){this.fire(eventNames.ICON_CREATE_END,originPointer);}},{key:"_onTextEditing",value:function _onTextEditing(){this.fire(eventNames.TEXT_EDITING);}},{key:"_onAddText",value:function _onAddText(event){this.fire(eventNames.ADD_TEXT,{originPosition:event.originPosition,clientPosition:event.clientPosition});}},{key:"_onAddObject",value:function _onAddObject(objectProps){var obj=this._graphics.getObject(objectProps.id);this._invoker.fire(eventNames.EXECUTE_COMMAND,getObjectType(obj.type));this._pushAddObjectCommand(obj);}},{key:"_onObjectAdded",value:function _onObjectAdded(objectProps){this.fire(OBJECT_ADDED,objectProps);this.fire(ADD_OBJECT_AFTER,objectProps);}},{key:"_onObjectModified",value:function _onObjectModified(obj){if(obj.type!==OBJ_TYPE.CROPZONE){this._invoker.fire(eventNames.EXECUTE_COMMAND,getObjectType(obj.type));this._pushModifyObjectCommand(obj);}}},{key:"_selectionCleared",value:function _selectionCleared(){this.fire(SELECTION_CLEARED);}},{key:"_selectionCreated",value:function _selectionCreated(eventTarget){this.fire(SELECTION_CREATED,eventTarget);}},{key:"registerIcons",value:function registerIcons(infos){this._graphics.registerPaths(infos);}},{key:"changeCursor",value:function changeCursor(cursorType){this._graphics.changeCursor(cursorType);}},{key:"addIcon",value:function addIcon(type,options){options=options||{};this._setPositions(options);return this.execute(commandNames.ADD_ICON,type,options);}},{key:"changeIconColor",value:function changeIconColor(id,color){return this.execute(commandNames.CHANGE_ICON_COLOR,id,color);}},{key:"removeObject",value:function removeObject(id){var _this$_graphics$getOb=this._graphics.getObject(id),type=_this$_graphics$getOb.type;return this.execute(commandNames.REMOVE_OBJECT,id,getObjectType(type));}},{key:"hasFilter",value:function hasFilter(type){return this._graphics.hasFilter(type);}},{key:"removeFilter",value:function removeFilter(type){return this.execute(commandNames.REMOVE_FILTER,type);}},{key:"applyFilter",value:function applyFilter(type,options,isSilent){var executeMethodName=isSilent?'executeSilent':'execute';return this[executeMethodName](commandNames.APPLY_FILTER,type,options);}},{key:"toDataURL",value:function toDataURL(options){return this._graphics.toDataURL(options);}},{key:"getImageName",value:function getImageName(){return this._graphics.getImageName();}},{key:"clearUndoStack",value:function clearUndoStack(){this._invoker.clearUndoStack();}},{key:"clearRedoStack",value:function clearRedoStack(){this._invoker.clearRedoStack();}},{key:"isEmptyUndoStack",value:function isEmptyUndoStack(){return this._invoker.isEmptyUndoStack();}},{key:"isEmptyRedoStack",value:function isEmptyRedoStack(){return this._invoker.isEmptyRedoStack();}},{key:"resizeCanvasDimension",value:function resizeCanvasDimension(dimension){if(!dimension){return promise_default().reject(rejectMessages.invalidParameters);}
return this.execute(commandNames.RESIZE_CANVAS_DIMENSION,dimension);}},{key:"destroy",value:function destroy(){var _this6=this;this.stopDrawingMode();this._detachDomEvents();this._graphics.destroy();this._graphics=null;if(this.ui){this._detachColorPickerInputBoxEvents();this.ui.destroy();}
forEach_default()(this,function(value,key){_this6[key]=null;},this);}},{key:"_setPositions",value:function _setPositions(options){var centerPosition=this._graphics.getCenter();if(isUndefined_default()(options.left)){options.left=centerPosition.left;}
if(isUndefined_default()(options.top)){options.top=centerPosition.top;}}},{key:"setObjectProperties",value:function setObjectProperties(id,keyValue){return this.execute(commandNames.SET_OBJECT_PROPERTIES,id,keyValue);}},{key:"setObjectPropertiesQuietly",value:function setObjectPropertiesQuietly(id,keyValue){this._graphics.setObjectProperties(id,keyValue);}},{key:"getObjectProperties",value:function getObjectProperties(id,keys){var object=this._graphics.getObject(id);if(!object){return null;}
return this._graphics.getObjectProperties(id,keys);}},{key:"getCanvasSize",value:function getCanvasSize(){return this._graphics.getCanvasSize();}},{key:"getObjectPosition",value:function getObjectPosition(id,originX,originY){return this._graphics.getObjectPosition(id,originX,originY);}},{key:"setObjectPosition",value:function setObjectPosition(id,posInfo){return this.execute(commandNames.SET_OBJECT_POSITION,id,posInfo);}},{key:"resize",value:function resize(dimensions){return this.execute(commandNames.RESIZE_IMAGE,dimensions);}}]);return ImageEditor;}();action.mixin(ImageEditor);customEvents_default().mixin(ImageEditor);var imageEditor=(ImageEditor);;var ICON=componentNames.ICON;var addIcon_command={name:commandNames.ADD_ICON,execute:function execute(graphics,type,options){var _this=this;var iconComp=graphics.getComponent(ICON);return iconComp.add(type,options).then(function(objectProps){_this.undoData.object=graphics.getObject(objectProps.id);return objectProps;});},undo:function undo(graphics){graphics.remove(this.undoData.object);return promise_default().resolve();}};factory_command.register(addIcon_command);var addIcon=((null&&(addIcon_command)));;var addImageObject_command={name:commandNames.ADD_IMAGE_OBJECT,execute:function execute(graphics,imgUrl){var _this=this;return graphics.addImageObject(imgUrl).then(function(objectProps){_this.undoData.object=graphics.getObject(objectProps.id);return objectProps;});},undo:function undo(graphics){graphics.remove(this.undoData.object);return promise_default().resolve();}};factory_command.register(addImageObject_command);var addImageObject=((null&&(addImageObject_command)));;var addObject_command={name:commandNames.ADD_OBJECT,execute:function execute(graphics,object){return new(promise_default())(function(resolve,reject){if(!graphics.contains(object)){graphics.add(object);resolve(object);}else{reject(rejectMessages.addedObject);}});},undo:function undo(graphics,object){return new(promise_default())(function(resolve,reject){if(graphics.contains(object)){graphics.remove(object);resolve(object);}else{reject(rejectMessages.noObject);}});}};factory_command.register(addObject_command);var addObject=((null&&(addObject_command)));;var SHAPE=componentNames.SHAPE;var addShape_command={name:commandNames.ADD_SHAPE,execute:function execute(graphics,type,options){var _this=this;var shapeComp=graphics.getComponent(SHAPE);return shapeComp.add(type,options).then(function(objectProps){var id=objectProps.id;_this.undoData.object=graphics.getObject(id);return objectProps;});},undo:function undo(graphics){graphics.remove(this.undoData.object);return promise_default().resolve();}};factory_command.register(addShape_command);var addShape=((null&&(addShape_command)));;var TEXT=componentNames.TEXT;var addText_command={name:commandNames.ADD_TEXT,execute:function execute(graphics,text,options){var _this=this;var textComp=graphics.getComponent(TEXT);if(this.undoData.object){var undoObject=this.undoData.object;return new(promise_default())(function(resolve,reject){if(!graphics.contains(undoObject)){graphics.add(undoObject);resolve(undoObject);}else{reject(rejectMessages.redo);}});}
return textComp.add(text,options).then(function(objectProps){var id=objectProps.id;var textObject=graphics.getObject(id);_this.undoData.object=textObject;setCachedUndoDataForDimension(makeSelectionUndoData(textObject,function(){return makeSelectionUndoDatum(id,textObject,false);}));return objectProps;});},undo:function undo(graphics){graphics.remove(this.undoData.object);return promise_default().resolve();}};factory_command.register(addText_command);var addText=((null&&(addText_command)));;var FILTER=componentNames.FILTER;var cachedUndoDataForSilent=null;function makeUndoData(type,prevfilterOption,options){var undoData={};if(type==='mask'){undoData.object=options.mask;}
undoData.options=prevfilterOption;return undoData;}
var applyFilter_command={name:commandNames.APPLY_FILTER,execute:function execute(graphics,type,options,isSilent){var filterComp=graphics.getComponent(FILTER);if(type==='mask'){var maskObj=graphics.getObject(options.maskObjId);if(!(maskObj&&maskObj.isType('image'))){return promise_default().reject(rejectMessages.invalidParameters);}
extend_default()(options,{mask:maskObj});graphics.remove(options.mask);}
if(!this.isRedo){var prevfilterOption=filterComp.getOptions(type);var undoData=makeUndoData(type,prevfilterOption,options);cachedUndoDataForSilent=this.setUndoData(undoData,cachedUndoDataForSilent,isSilent);}
return filterComp.add(type,options);},undo:function undo(graphics,type){var filterComp=graphics.getComponent(FILTER);if(type==='mask'){var mask=this.undoData.object;graphics.add(mask);graphics.setActiveObject(mask);return filterComp.remove(type);}
if(this.undoData.options){return filterComp.add(type,this.undoData.options);}
return filterComp.remove(type);}};factory_command.register(applyFilter_command);var applyFilter=((null&&(applyFilter_command)));;var changeIconColor_ICON=componentNames.ICON;var changeIconColor_command={name:commandNames.CHANGE_ICON_COLOR,execute:function execute(graphics,id,color){var _this=this;return new(promise_default())(function(resolve,reject){var iconComp=graphics.getComponent(changeIconColor_ICON);var targetObj=graphics.getObject(id);if(!targetObj){reject(rejectMessages.noObject);}
_this.undoData.object=targetObj;_this.undoData.color=iconComp.getColor(targetObj);iconComp.setColor(color,targetObj);resolve();});},undo:function undo(graphics){var iconComp=graphics.getComponent(changeIconColor_ICON);var _this$undoData=this.undoData,icon=_this$undoData.object,color=_this$undoData.color;iconComp.setColor(color,icon);return promise_default().resolve();}};factory_command.register(changeIconColor_command);var changeIconColor=((null&&(changeIconColor_command)));;var changeShape_SHAPE=componentNames.SHAPE;var changeShape_cachedUndoDataForSilent=null;function changeShape_makeUndoData(options,targetObj){var undoData={object:targetObj,options:{}};forEachOwnProperties_default()(options,function(value,key){undoData.options[key]=targetObj[key];});return undoData;}
var changeShape_command={name:commandNames.CHANGE_SHAPE,execute:function execute(graphics,id,options,isSilent){var shapeComp=graphics.getComponent(changeShape_SHAPE);var targetObj=graphics.getObject(id);if(!targetObj){return promise_default().reject(rejectMessages.noObject);}
if(!this.isRedo){var undoData=changeShape_makeUndoData(options,targetObj);changeShape_cachedUndoDataForSilent=this.setUndoData(undoData,changeShape_cachedUndoDataForSilent,isSilent);}
return shapeComp.change(targetObj,options);},undo:function undo(graphics){var shapeComp=graphics.getComponent(changeShape_SHAPE);var _this$undoData=this.undoData,shape=_this$undoData.object,options=_this$undoData.options;return shapeComp.change(shape,options);}};factory_command.register(changeShape_command);var changeShape=((null&&(changeShape_command)));;var changeText_TEXT=componentNames.TEXT;var changeText_command={name:commandNames.CHANGE_TEXT,execute:function execute(graphics,id,text){var textComp=graphics.getComponent(changeText_TEXT);var targetObj=graphics.getObject(id);if(!targetObj){return promise_default().reject(rejectMessages.noObject);}
this.undoData.object=targetObj;this.undoData.text=textComp.getText(targetObj);return textComp.change(targetObj,text);},undo:function undo(graphics){var textComp=graphics.getComponent(changeText_TEXT);var _this$undoData=this.undoData,textObj=_this$undoData.object,text=_this$undoData.text;return textComp.change(textObj,text);}};factory_command.register(changeText_command);var changeText=((null&&(changeText_command)));;var changeTextStyle_TEXT=componentNames.TEXT;var changeTextStyle_cachedUndoDataForSilent=null;function changeTextStyle_makeUndoData(styles,targetObj){var undoData={object:targetObj,styles:{}};forEachOwnProperties_default()(styles,function(value,key){var undoValue=targetObj[key];undoData.styles[key]=undoValue;});return undoData;}
var changeTextStyle_command={name:commandNames.CHANGE_TEXT_STYLE,execute:function execute(graphics,id,styles,isSilent){var textComp=graphics.getComponent(changeTextStyle_TEXT);var targetObj=graphics.getObject(id);if(!targetObj){return promise_default().reject(rejectMessages.noObject);}
if(!this.isRedo){var undoData=changeTextStyle_makeUndoData(styles,targetObj);changeTextStyle_cachedUndoDataForSilent=this.setUndoData(undoData,changeTextStyle_cachedUndoDataForSilent,isSilent);}
return textComp.setStyle(targetObj,styles);},undo:function undo(graphics){var textComp=graphics.getComponent(changeTextStyle_TEXT);var _this$undoData=this.undoData,textObj=_this$undoData.object,styles=_this$undoData.styles;return textComp.setStyle(textObj,styles);}};factory_command.register(changeTextStyle_command);var changeTextStyle=((null&&(changeTextStyle_command)));;var clearObjects_command={name:commandNames.CLEAR_OBJECTS,execute:function execute(graphics){var _this=this;return new(promise_default())(function(resolve){_this.undoData.objects=graphics.removeAll();resolve();});},undo:function undo(graphics){graphics.add(this.undoData.objects);return promise_default().resolve();}};factory_command.register(clearObjects_command);var clearObjects=((null&&(clearObjects_command)));;var FLIP=componentNames.FLIP;var flip_command={name:commandNames.FLIP_IMAGE,execute:function execute(graphics,type){var flipComp=graphics.getComponent(FLIP);this.undoData.setting=flipComp.getCurrentSetting();return flipComp[type]();},undo:function undo(graphics){var flipComp=graphics.getComponent(FLIP);return flipComp.set(this.undoData.setting);}};factory_command.register(flip_command);var command_flip=((null&&(flip_command)));;var IMAGE_LOADER=componentNames.IMAGE_LOADER;var loadImage_command={name:commandNames.LOAD_IMAGE,execute:function execute(graphics,imageName,imgUrl){var _context;var loader=graphics.getComponent(IMAGE_LOADER);var prevImage=loader.getCanvasImage();var prevImageWidth=prevImage?prevImage.width:0;var prevImageHeight=prevImage?prevImage.height:0;var objects=filter_default()(_context=graphics.removeAll(true)).call(_context,function(objectItem){return objectItem.type!=='cropzone';});for_each_default()(objects).call(objects,function(objectItem){objectItem.evented=true;});this.undoData={name:loader.getImageName(),image:prevImage,objects:objects};return loader.load(imageName,imgUrl).then(function(newImage){return{oldWidth:prevImageWidth,oldHeight:prevImageHeight,newWidth:newImage.width,newHeight:newImage.height};});},undo:function undo(graphics){var loader=graphics.getComponent(IMAGE_LOADER);var _this$undoData=this.undoData,objects=_this$undoData.objects,name=_this$undoData.name,image=_this$undoData.image;graphics.removeAll(true);graphics.add(objects);return loader.load(name,image);}};factory_command.register(loadImage_command);var loadImage=((null&&(loadImage_command)));;var removeFilter_FILTER=componentNames.FILTER;var removeFilter_command={name:commandNames.REMOVE_FILTER,execute:function execute(graphics,type){var filterComp=graphics.getComponent(removeFilter_FILTER);this.undoData.options=filterComp.getOptions(type);return filterComp.remove(type);},undo:function undo(graphics,type){var filterComp=graphics.getComponent(removeFilter_FILTER);var options=this.undoData.options;return filterComp.add(type,options);}};factory_command.register(removeFilter_command);var removeFilter=((null&&(removeFilter_command)));;var removeObject_command={name:commandNames.REMOVE_OBJECT,execute:function execute(graphics,id){var _this=this;return new(promise_default())(function(resolve,reject){_this.undoData.objects=graphics.removeObjectById(id);if(_this.undoData.objects.length){resolve();}else{reject(rejectMessages.noObject);}});},undo:function undo(graphics){graphics.add(this.undoData.objects);return promise_default().resolve();}};factory_command.register(removeObject_command);var removeObject=((null&&(removeObject_command)));;var resizeCanvasDimension_command={name:commandNames.RESIZE_CANVAS_DIMENSION,execute:function execute(graphics,dimension){var _this=this;return new(promise_default())(function(resolve){_this.undoData.size={width:graphics.cssMaxWidth,height:graphics.cssMaxHeight};graphics.setCssMaxDimension(dimension);graphics.adjustCanvasDimension();resolve();});},undo:function undo(graphics){graphics.setCssMaxDimension(this.undoData.size);graphics.adjustCanvasDimension();return promise_default().resolve();}};factory_command.register(resizeCanvasDimension_command);var resizeCanvasDimension=((null&&(resizeCanvasDimension_command)));;var ROTATION=componentNames.ROTATION;var rotate_cachedUndoDataForSilent=null;function rotate_makeUndoData(rotationComp){return{angle:rotationComp.getCurrentAngle()};}
var rotate_command={name:commandNames.ROTATE_IMAGE,execute:function execute(graphics,type,angle,isSilent){var rotationComp=graphics.getComponent(ROTATION);if(!this.isRedo){var undoData=rotate_makeUndoData(rotationComp);rotate_cachedUndoDataForSilent=this.setUndoData(undoData,rotate_cachedUndoDataForSilent,isSilent);}
return rotationComp[type](angle);},undo:function undo(graphics){var rotationComp=graphics.getComponent(ROTATION);var _this$args=_slicedToArray(this.args,3),type=_this$args[1],angle=_this$args[2];if(type==='setAngle'){return rotationComp[type](this.undoData.angle);}
return rotationComp.rotate(-angle);}};factory_command.register(rotate_command);var command_rotate=((null&&(rotate_command)));;var setObjectProperties_command={name:commandNames.SET_OBJECT_PROPERTIES,execute:function execute(graphics,id,props){var _this=this;var targetObj=graphics.getObject(id);if(!targetObj){return promise_default().reject(rejectMessages.noObject);}
this.undoData.props={};forEachOwnProperties_default()(props,function(value,key){_this.undoData.props[key]=targetObj[key];});graphics.setObjectProperties(id,props);return promise_default().resolve();},undo:function undo(graphics,id){var props=this.undoData.props;graphics.setObjectProperties(id,props);return promise_default().resolve();}};factory_command.register(setObjectProperties_command);var setObjectProperties=((null&&(setObjectProperties_command)));;var setObjectPosition_command={name:commandNames.SET_OBJECT_POSITION,execute:function execute(graphics,id,posInfo){var targetObj=graphics.getObject(id);if(!targetObj){return promise_default().reject(rejectMessages.noObject);}
this.undoData.objectId=id;this.undoData.props=graphics.getObjectProperties(id,['left','top']);graphics.setObjectPosition(id,posInfo);graphics.renderAll();return promise_default().resolve();},undo:function undo(graphics){var _this$undoData=this.undoData,objectId=_this$undoData.objectId,props=_this$undoData.props;graphics.setObjectProperties(objectId,props);graphics.renderAll();return promise_default().resolve();}};factory_command.register(setObjectPosition_command);var setObjectPosition=((null&&(setObjectPosition_command)));;var changeSelection_command={name:commandNames.CHANGE_SELECTION,execute:function execute(graphics,props){if(this.isRedo){for_each_default()(props).call(props,function(prop){graphics.setObjectProperties(prop.id,prop);});}else{this.undoData=getCachedUndoDataForDimension();}
return promise_default().resolve();},undo:function undo(graphics){var _context;for_each_default()(_context=this.undoData).call(_context,function(datum){graphics.setObjectProperties(datum.id,datum);});return promise_default().resolve();}};factory_command.register(changeSelection_command);var changeSelection=((null&&(changeSelection_command)));;var RESIZE=componentNames.RESIZE;var resize_command={name:commandNames.RESIZE_IMAGE,execute:function execute(graphics,dimensions){var resizeComp=graphics.getComponent(RESIZE);var originalDimensions=resizeComp.getOriginalDimensions();if(!originalDimensions){originalDimensions=resizeComp.getCurrentDimensions();}
this.undoData.dimensions=originalDimensions;return resizeComp.resize(dimensions);},undo:function undo(graphics){var resizeComp=graphics.getComponent(RESIZE);return resizeComp.resize(this.undoData.dimensions);}};factory_command.register(resize_command);var command_resize=((null&&(resize_command)));;var src=(imageEditor);}();__webpack_exports__=__webpack_exports__["default"];return __webpack_exports__;})();});